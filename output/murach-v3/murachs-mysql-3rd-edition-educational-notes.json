{
  "concepts": {
    "content": {
      "id": "content",
      "title": "Content",
      "definition": "",
      "difficulty": "intermediate",
      "page_references": [
        1,
        3,
        5,
        6,
        7,
        9,
        10,
        11,
        12,
        13,
        14,
        15,
        16,
        17,
        18,
        19,
        20,
        21,
        23,
        24,
        25,
        26,
        27,
        28,
        29,
        30,
        31,
        32,
        33,
        34,
        35,
        36,
        37,
        38,
        39,
        40,
        41,
        42,
        43,
        44,
        45,
        46,
        47,
        48,
        49,
        50,
        51,
        52,
        53,
        54,
        55,
        56,
        57,
        58,
        59,
        60,
        61,
        62,
        63,
        64,
        65,
        66,
        67,
        68,
        69,
        70,
        71,
        72,
        73,
        74,
        75,
        76,
        77,
        78,
        79,
        80,
        81,
        82,
        83,
        84,
        85,
        86,
        87,
        88,
        89,
        90,
        91,
        93,
        94,
        95,
        96,
        97,
        98,
        99,
        100,
        101,
        102,
        103,
        104,
        105,
        106,
        107,
        108,
        109,
        110,
        111,
        112,
        113,
        114,
        115,
        116,
        117,
        118,
        119,
        120,
        121,
        122,
        123,
        124,
        125,
        126,
        127,
        128,
        129,
        130,
        131,
        132,
        133,
        134,
        135,
        136,
        137,
        138,
        139,
        140,
        141,
        142,
        143,
        144,
        145,
        146,
        147,
        148,
        149,
        150,
        151,
        152,
        153,
        154,
        155,
        156,
        157,
        158,
        159,
        160,
        161,
        162,
        163,
        164,
        165,
        166,
        167,
        169,
        170,
        171,
        172,
        173,
        174,
        175,
        176,
        177,
        178,
        179,
        180,
        181,
        182,
        183,
        184,
        185,
        187,
        189,
        190,
        191,
        192,
        193,
        194,
        195,
        196,
        197,
        198,
        199,
        200,
        201,
        202,
        203,
        204,
        205,
        206,
        207,
        208,
        209,
        210,
        211,
        212,
        213,
        214,
        215,
        216,
        217,
        218,
        219,
        220,
        221,
        222,
        223,
        224,
        225,
        226,
        227,
        228,
        229,
        230,
        231,
        232,
        233,
        234,
        235,
        236,
        237,
        238,
        239,
        240,
        241,
        242,
        243,
        244,
        245,
        246,
        247,
        248,
        249,
        251,
        252,
        253,
        254,
        255,
        256,
        257,
        258,
        259,
        260,
        261,
        262,
        263,
        264,
        265,
        266,
        267,
        268,
        269,
        270,
        271,
        272,
        273,
        274,
        275,
        277,
        278,
        279,
        280,
        281,
        282,
        283,
        284,
        285,
        286,
        287,
        288,
        289,
        290,
        291,
        292,
        293,
        294,
        295,
        296,
        297,
        298,
        299,
        300,
        301,
        302,
        303,
        304,
        305,
        306,
        307,
        308,
        309,
        310,
        311,
        312,
        313,
        314,
        315,
        316,
        317,
        318,
        319,
        320,
        321,
        323,
        325,
        326,
        327,
        328,
        329,
        330,
        331,
        332,
        333,
        334,
        335,
        336,
        337,
        338,
        339,
        340,
        341,
        342,
        343,
        344,
        345,
        346,
        347,
        348,
        349,
        350,
        351,
        352,
        353,
        354,
        355,
        356,
        357,
        358,
        359,
        361,
        362,
        363,
        364,
        365,
        366,
        367,
        368,
        369,
        370,
        371,
        372,
        373,
        374,
        375,
        376,
        377,
        378,
        379,
        380,
        381,
        382,
        383,
        384,
        385,
        386,
        387,
        388,
        389,
        390,
        391,
        392,
        394,
        395,
        396,
        397,
        398,
        399,
        401,
        402,
        403,
        404,
        405,
        406,
        407,
        408,
        409,
        410,
        411,
        412,
        413,
        414,
        415,
        416,
        417,
        418,
        419,
        421,
        422,
        423,
        424,
        425,
        426,
        427,
        428,
        429,
        430,
        431,
        432,
        433,
        434,
        435,
        436,
        437,
        438,
        439,
        440,
        441,
        442,
        443,
        444,
        445,
        446,
        447,
        449,
        450,
        451,
        452,
        453,
        454,
        455,
        456,
        457,
        458,
        459,
        460,
        461,
        462,
        463,
        464,
        465,
        466,
        467,
        468,
        469,
        470,
        471,
        472,
        473,
        474,
        475,
        476,
        477,
        478,
        479,
        480,
        481,
        482,
        483,
        484,
        485,
        486,
        487,
        488,
        489,
        490,
        491,
        492,
        493,
        494,
        495,
        497,
        498,
        499,
        500,
        501,
        502,
        503,
        504,
        505,
        506,
        507,
        508,
        509,
        510,
        511,
        513,
        514,
        515,
        516,
        517,
        518,
        519,
        520,
        521,
        522,
        523,
        524,
        525,
        526,
        527,
        528,
        529,
        530,
        531,
        532,
        533,
        534,
        536,
        537,
        538,
        539,
        540,
        541,
        543,
        544,
        545,
        546,
        547,
        548,
        549,
        550,
        551,
        552,
        553,
        554,
        555,
        556,
        557,
        558,
        559,
        560,
        561,
        562,
        563,
        564,
        565,
        566,
        567,
        568,
        569,
        570,
        571,
        572,
        573,
        574,
        575,
        576,
        577,
        578,
        579,
        580,
        581,
        583,
        584,
        585,
        586,
        587,
        588,
        589,
        590,
        591,
        592,
        593,
        594,
        595,
        596,
        597,
        598,
        599,
        600,
        601,
        602,
        603,
        604,
        605,
        606,
        607,
        608,
        609,
        610,
        611,
        613,
        614,
        615,
        616,
        617,
        618,
        619,
        621,
        622,
        623,
        624,
        625,
        626,
        627,
        628,
        629,
        631,
        632,
        633,
        634,
        635,
        636,
        637,
        638,
        639,
        640,
        641,
        642,
        643,
        644,
        646
      ],
      "sections": {
        "content": {
          "text": ", ___ _ \n. --· . \n. -\n-.. \n.. \n-- . \n,. -\nMASTER THE SQL STATEMENTS \ntl1at every application developer needs \nfor retrieving and updating the data \nin a MySQL database \nD SIGN DATABASES IKE A PRO \nand code tl1e SQL state1nents tl1at create \ndatabases, tables, indexes, and ,ie,vs \nGAIN PROFESSIONAL SKILLS \nlike using transactions, stored procedures, \nfunctions, triggers, and events \nGET STARTED AS A DBA \nby learning l1ow to configure tl1e server, \nmanage security, and create bacluips\n\n3RD EDITION \nJoel Murach\n\nTRAINING & REFERENCE \n3RD EDITION \nJoel Murach \nM IKE M URACH & A SSOCIATES, I NC. \n4340 N. Knoll Ave. • Fresno, CA 93722 \nwww.murach.com • murachbooks@murach.com\n\nEditorial team \nAuthor: \nWriter/Editor: \nEditorial Support: \nProduction: \nJoel Murach \nAnne Boehm \nSteven Mannion \nSamantha Walker \nBooks on general-purpose programming languages \nMurach's Python Programming \nMurach's Java Programming \nMurach's C++ Programming \nMurach's C# \nMurach 's Visual Basic \nBooks for web developers \nMurach's HTML5 and CSS3 \nMurach's JavaScript and)Query \nMurach's PHP and MySQL \nMurach.'s Java Servlets and JSP \nMurach's ASP.NET Web Progra11iming with C# \nBooks for database programmers \nMurach 's MySQL \nMurach's SQL Server for Developers \nMurach's Oracle SQL and PLJSQL for Developers \nFor more on Murach books, \nplease visit us at www.murach.com \n© 2019, Mike Murach & Associates, Inc. \nAll rights reserved. \nPrinted in the United States of America \n10 9 8 7 6 5 4 3 2 1 \nISBN: 978-1-943872-36-7\n\nContent \nIntroduction \nSection 1 An introduction to MySQL \nChapter 1 \nChapter 2 \nChapter 3 \nChapter 4 \nChapter 5 \nAn introduction to relational databases \nHow to use MySQL Workbench and other development tools \nHow to retrieve data from a single table \nHow to retrieve data from two or more tables \nHow to insert, update, and delete data \nSection 2 More SQL skills as you need them \nChapter 6 \nChapter 7 \nChapter 8 \nChapter 9 \nHow to code summary queries \nHow to code subqueries \nHow to work with data types \nHow to use functions \nSection 3 Database design and implementation \nChapter 10 \nChapter 11 \nChapter 12 \nHow to design a database \nHow to create databases, tables, and indexes \nHow to create views \nSection 4 Stored program development \nChapter 13 \nChapter 14 \nChapter 15 \nChapter 16 \nLanguage skills for writing stored programs \nHow to use transactions and locking \nHow to create stored procedures and functions \nHow to create triggers and events \nSection 5 Database administration \nChapter 17 \nChapter 18 \nChapter 19 \nAn introduction to database administration \nHow to secure a database \nHow to backup and restore a database \nAppendixes \nAppendix A \nAppendix B \nHow to install the software for this book on Windows \nHow to install the software for this book on macOS \n• •• \nXlll \n3 \n41 \n73 \n113 \n149 \n169 \n199 \n231 \n257 \n305 \n341 \n381 \n401 \n429 \n445 \n477 \n493 \n523 \n563 \n593 \n601\n\n•• \nExpanded contents \nVI I \nExpanded contents \nSection 1 An introduction to MySQL \n============= \nChapter 1 \nAn introduction to relational databases \nAn introduction to client/server systems ......................................... 4 \nThe hardware con1ponents of a client/server system ...................................................... 4 \nThe software components of a client/server syste111 ....................................................... 6 \nOther client/server architectures .................................................................................... 8 \nAn introduction to the relational database model ......................... 10 \nHow a table is organized ............................................................................................... 10 \nHow tables are related ................................................................................................... 12 \nHow columns are defined ............................................................................................. 14 \nHow to read a database diagram ................................................................................... 16 \nAn introduction to SQL and SQL-based systems ......................... 18 \nA brief history of SQL .................................................................................................. 18 \nA comparison of Oracle, DB2, Microsoft SQL Server, and MySQL ........................... 20 \nThe SQL statements ......................................................................... 22 \nAn introduction to the SQL statements ........................................................................ 22 \nHow to work with database objects .............................................................................. 24 \nHow to query a sin.gle table ........................................................................................... 26 \nHow to join data from two or more tables .................................................................... 28 \nHow to add, update, and delete data in a table ............................................................. 30 \nSQL coding guidelines ................................................................................................. 32 \nHow to use SQL from an application program .............................. 34 \nCommon options for accessing MySQL data ............................................................... 34 \nPHP code that retrieves data from MySQL .................................................................. 36 \nJava code that retrieves data from MySQL ................................................................... 38 \nChapter 2 \nHow to use MySQL Workbench \nand other development tools \nAn introduction to MySQL Workbench ........................................... 42 \nThe Home page of MySQL Workbench ....................................................................... 42 \nHow to open a database connection .............................................................................. 44 \nHow to start and stop the database server .................................................................... 46 \nHow to navigate through the database objects ............................................................. 48 \nHow to view and edit the data for a table ..................................................................... 50 \nHow to view and edit the column definitions for a table .............................................. 52 \nHow to use MySQL Workbench to run SQL statements ............... 54 \nHow to enter and execute a SQL statement .................................................................. 54 \nHow to use snippets ...................................................................................................... 56 \nHow to handJe syntax errors ......................................................................................... 58 \nHow to open and. save SQL scripts ............................................................................... 60 \nHow to enter and execute SQL scripts .......................................................................... 62 \nHow to use the MySQL Reference Manual ..................................... 64 \nHow to view the manual ............................................................................................... 64 \nHow to look up information .......................................................................................... 64 \nHow to use the MySQL Command Line Client ............................... 66 \nHow to start and stop the MySQL Command Line Client ........................................... 66 \nHow to use the MySQL Command Line Client to work with a database .................... 68\n\n••• \nVIII \nExpanded contents \nChapter 3 \nHow to retrieve data from a single table \nAn introduction to the SELECT statement ..................................... 74 \nThe basic syntax of the SELECT statement ................................................................. 74 \nSELECT statement examples ....................................................................................... 76 \nHow to code the SELECT clause ..................................................... 78 \nHow to code column specifications .............................................................................. 78 \nHow to name the columns in a result set using aliases ................................................ 80 \nHow to code arithmetic expressions ............................................................................. 82 \nHow to use the CONCAT function to join strings ........................................................ 84 \nHow to use functions with strings, dates, and numbers ............................................... 86 \nHow to test expressions by coding statements without FROM clauses ....................... 88 \nHow to eliminate duplicate rows .................................................................................. 90 \nHow to code the WHERE clause ..................................................... 92 \nHow to use the compariso11 operators ........................................................................... 92 \nHow to use the AND, OR, and NOT logical operators ................................................ 94 \nHow to ·use the IN\" operator ........................................................................................... 96 \nHow to use the BETWEEN operator ............................................................................ 98 \nHow to use the LIKE and REG EXP operators .......................................................... 100 \nHow to use the IS NULL clause ................................................................................. I 02 \nHow to code the ORDER BY clause .............................................. 104 \nHow to sort by a column name ................................................................................... 104 \nHow to sort by an alias, expression, or colun1n number ............................................. 106 \nHow to code the LIMIT clause ....................................................... 108 \nHow to limit the number of rows ................................................................................ 108 \nHow to return a range of rows .................................................................................... 108 \nChapter 4 \nHow to retrieve data from two or more tables \nHow to work with inner joins ......................................................... 114 \nHow to code an inner join ........................................................................................... 114 \nHow to use table aliases ................................................................................................. 116 \nHow to join to a table in another database .................................................................. 118 \nHow to use compound join conditions ........................................................................ 120 \nHow to use a self-join .................................................................................................. 122 \nHow to join more than_ two ta.bl es ............................................................................... 124 \nHow to use the in1plicit in11er join syntax ................................................................... 126 \nHow to work with outer joins ......................................................... 128 \nHow to code a·n outer join ........................................................................................... 128 \nOuter join examples .................................................................................................... 130 \nOther skills for working with joins ................................................ 134 \nHow to join tables with the USING keyword ............................................................. 134 \nHow to join tables with the NATURAL keyword ...................................................... 136 \nHow to use c·rossjoins ................................................................................................ 138 \nHow to work with unions ................................................................ 140 \nHow to code a union ................................................................................................... 140 \nA union that combi11es result sets frorn different tables ............................................. 140 \nA union that combines result sets from the same tables ............................................ 142 \nA union that si1nulates a full outer join ...................................................................... 144\n\n• \nExpanded contents \nIX \nChapter 5 \nHow to insert, update, and delete data \nHow to create test tables ............................................................... 150 \nHow to create the tables for this book ........................................................................ 150 \nHow to create a copy of a table ................................................................................... 150 \nHow to inser,t new rows .................................................................. 152 \nHow to insert a single row .......................................................................................... 152 \nHow to insert multiple rows ........................................................................................ 152 \nH.ow to insert default values and null vaJues .............................................................. 154 \nHow to use a subquery in an INSERT statement ....................................................... 156 \nHow to update existing rows ......................................................... 158 \nHow to update rows .................................................................................................... 158 \nHow to use a subquery in an UPDATE statement ...................................................... 160 \nHow to delete existing rows ........................................................... 162 \nHow to delete rows ........................................................................................................ 162 \nHow to use a subquery in a DELETE statement ........................................................ 162 \nSection 2 More SQL skills as you need them \nChapter 6 \nHow to code summary queries \nHow to work with aggregate functions ......................................... 170 \nHow to code aggregate functions ................................................................................ 170 \nQueries that use aggregate functions .......................................................................... 172 \nHow to group and summarize data ............................................... 174 \nHow to code the GROUP BY and HAVING clauses ................................................. 174 \nQueries that use the GROUP BY and HAVING clauses ............................................ 176 \nHow the HAVING clause compares to the WHERE clause ...................................... 178 \nHow to code compound search conditions ................................................................. 180 \nHow to use the WITH ROLLUP operator .................................................................. 182 \nHow to use the GROUPING fu nction ........................................................................ 184 \nHow to code aggregate window functions ................................... 188 \nHow the aggregate window functions work ............................................................... 188 \nHow to use frames ................................................................................... ..................... 190 \nHow to use named windows ........................................................................................ 194 \nChapter 7 \nHow to code subqueries \nAn introduction to subqueries ...................................................... 200 \nWhere to code subqueries ............................................................................................. 200 \nWhen to use subqueries ............................................................................................... 202 \nHow to code subqueries in the WHERE clause ........................... 204 \nHow to use the IN operator ......................................................................................... 204 \nHow to use the comparison operators ......................................................................... 206 \nHow to use the ALL keyword ......................................................... 208 \nHow to use the ANY and SOME keywords ............................................................... 210 \nHow to code correlated subqueries ............................................................................. 212 \nHow to use the EXISTS operator ............................................................................... 214 \nHow to code subqueries in other clauses .................................... 216 \nHow to code subqueries in the HAVING cJause ........................................................ 216 \nHow to code subqueries in the SELECT clause ......................................................... 216 \nHow to code subqueries in the FROM clause ............................................................. 218\n\nX \nExpanded contents \nHow to work with complex queries ............................................... 220 \nA complex query that uses subqueries ........................................................................ 220 \nA procedure for building complex queries ................................................................ 222 \nHow to work with common table expressions ............................. 224 \nHow to code a CTE ..................................................................................................... 224 \nHow to code a recursive CTE ..................................................................................... 226 \nChapter 8 \nHow to work with data types \nThe data types ................................................................................. 232 \nOverview ....................................................................................................................... 232 \nThe character types ..................................................................................................... 234 \nThe integer types ......................................................................................................... 236 \nThe fixed-point and floating-point types .................................................................... 238 \nThe date and time types .............................................................................................. 240 \nThe ENUM and SET types ......................................................................................... 244 \nThe large object types ................................................................................................. 246 \nHow to convert data ........................................................................ 248 \nHow implicit data conversion works ........................................................................... 248 \nHow to convert data using the CAST and CONVERT functions .............................. 250 \nHow to convert data using the FORMAT and CHAR functions ............................... 252 \nChapter 9 \nHow to use functions \nHow to work with string data ......................................................... 258 \nA sum mary of the string functions ............................................................................. 258 \nExamples that use string functions ............................................................................. 260 \nHow to sort by a string column that contains nun1bers .............................................. 262 \nHow to parse a string .................................................................................................. 264 \nHow to work with numeric data ..................................................... 266 \nHow to use the numeric functions .............................................................................. 266 \nHow to search for floating-point numbers .................................................................. 268 \nHow to work with date/time data ................................................... 270 \nHow to get the current date and time .......................................................................... 270 \nHow to parse dates and times with date/time functions ............................................ 272 \nHow to parse dates and times with the EXTRACT function ..................................... 274 \nHow to format dates and times ................................................................................... 276 \nHow to perform calculations on dates and times ....................................................... 278 \nHow to search for a date ............................................................................................. 280 \nHow to search for a time ............................................................................................. 282 \nOther functions you should know about ...................................... 284 \nHow to use the CASE fu nction ................................................................................... 284 \nHow to use the IF, IFNULL, and COALESCE functions .......................................... 286 \nHow to use the regular expression functjons .............................................................. 288 \nHow to use the ranking functions ............................................................................... 292 \nHow to use the analytic functions ....................................................................................... 296 \nSection 3 Database design and implementation \nChapter 10 How to design a database \nHow to design a data structure ..................................................... 306 \nThe basic steps for designing a data structure ............................................................ 306 \nHow to identify the data elements .............................................................................. 308\n\n• \nExpanded contents \nXI \nHow to subdivide the data elements ........................................................................... 310 \nHow to identify the tables and assign colu1nns .......................................................... 312 \nHow to identify the primary and foreign keys ............................................................ 314 \nHow to enforce the relationships between tables ....................................................... 316 \nHow normalizatio·n works .......................................... \nH \n••• • •••• •\n•\n• •• •\n•\n•\n••\n•\n•\n•\n• •• •\n•\n•\n• •• • •• •\n•\n• •••• •\n• •• •\n•\n• 318 \nHow to identify the colun1 ns to be indexed ................................................................ 320 \nHow to normalize a data structure ................................................ 322 \nThe seven nor111a I forms ............................................................................................. 322 \nHow to apply the first normal forn1 ............................................................................ 324 \nHow to apply the second normal form ........................................................................ 326 \nHow to apply the third normal form ........................................................................... 328 \nWhen and how to denormalize a data structure ......................................................... 330 \nHow to use MySQL Workbench for database design ................. 332 \nHow to open an existing EER model .......................................................................... 332 \nHow to create a new EER model ................................................................................ 332 \nHow to work w itb an EER 1n odel ............................................................................... 334 \nHow to work with an EER diagran1 ............................................................................ 336 \nChapter 11 \nHow to create databases, tables, and indexes \nHow to work with databases .......................................................... 342 \nHow to create and drop a database ............................................................................. 342 \nHow to select a. database ............................................................................................. 342 \nHow to work with tables ................................................................. 344 \nHow to create a. table ................................................................................................... 344 \nHow to code a primary key constraint. ....................................................................... 346 \nHow to code a foreign key constraint ......................................................................... 348 \nHow to alter the columns of a table ............................................................................ 350 \nHow to alter the constraints of a table ........................................................................ 352 \nHow to rename, truncate, and drop a table ................................................................. 354 \nHow to work with indexes .............................................................. 356 \nHow to create an index ................................................................................................ 356 \nHow to dJ·op an index .................................................................................................... 356 \nA script that creates a database .................................................... 358 \nHow to use MySQL Workbench ..................................................... 362 \nHow to work with the columns of a table ................................................................... 362 \nHow to work with the indexes of a table ..................................................................... 364 \nHow to work with the foreign keys of a table ............................................................. 366 \nHow to work with character sets and collations .......................... 368 \nAn introduction to character sets and collations ........................................................ 368 \nHow to view character sets and collations .................................................................. 370 \nHow to specify a character set and a collation ........................................................... 372 \nHow to work with storage engines ................................................ 374 \nAn introduction to storage engines ............................................................................. 374 \nHow to view storage engines ...................................................................................... 374 \nHow to specify a storage engine ................................................................................. 376\n\n•• \nXII \nExpanded contents \nChapter 12 How to create views \nAn introduction to views ................................................................ 382 \nHow views work .......................................................................................................... 3 82 \nBenefits of using views ............................................................................................... 384 \nHow to work with views .................................................................. 386 \nHow to create a view ................................................................................................... 3 86 \nHow to create an updatable view ................................................................................ 390 \nHow to use the WITH CHECK OPTION clause ....................................................... 392 \nHow to insert or delete rows through a view .............................................................. 394 \nHow to alter or drop a view ........................................................................................ 396 \nSection 4 Stored program= develop==m= e=n=t======~ \nChapter 13 Language skills for writing stored programs \nAn introduction to stored programs ............................................. 402 \nFour types of stored programs .................................................................................... 402 \nA script that creates and calls a stored procedure ...................................................... 402 \nA summary of statements for coding stored programs .............................................. 404 \nHow to write procedural code ....................................................... 406 \nHow to display data ..................................................................................................... 406 \nHow to declare and set variables ................................................................................ 408 \nHow to code IF statements .......................................................................................... 410 \nHow to code CASE statements ................................................................................... 412 \nHow to code loops ........................................................................................................... 414 \nHow to use a cursor ........................................................................................................ 416 \nHow to declare a condition handler ............................................................................ 418 \nHow to use a condition handler .................................................................................. 420 \nHow to use multiple condition handlers ..................................................................... 424 \nChapter 14 How to use transactions and locking \nHow to work with transactions ...................................................... 430 \nHow to conllllit and rollback transactions .................................................................. 430 \nHow to work with save points ..................................................................................... 432 \nHow to work with concurrency and locking ................................. 434 \nHow concurrency and locking are related .................................................................. 434 \nThe four concurrency problems that locks can prevent .............................................. 436 \nHow to set the transaction isolation level ................................................................... 438 \nHow to lock selected rows .......................................................................................... 440 \nHow to preve.nt deadlocks .............................................................................................. 442 \nChapter 15 How to create stored procedures and functions \nHow to code stored procedures .................................................... 446 \nHow to create and cal 1 a stored procedure ................................................................. 446 \nHow to code input and output paran1eters .................................................................. 448 \nHow to set a default value for a para1neter ................................................................. 450 \nHow to validate parameters and raise errors .............................................................. 452 \nA stored procedure tl1at inserts a row ......................................................................... 454 \nHow to work with user variables ................................................................................ 458 \nHow to work with dynamic SQL ................................................................................ 460 \nHow to drop a stored procedure .................................................................................. 462 \nHow to code stored functions ....................................................... 464 \nHow to create and cal I a function ............................................................................... 464\n\n••• \nExpanded contents \nXI 11 \nHow to use function characteristics ............................................................................ 466 \nA function that calculates balance due ....................................................................... 468 \nHow to drop a function ............................................................................................... 470 \nHow to use Workbench with procedures \nand functions .................................................................................. 472 \nHow to view and edit to red routines ......................................................................... 472 \nHow to create stored routines ..................................................................................... 472 \nHow to drop stored routines ........................................................................................ 472 \nChapter 16 How to create triggers and events \nHow to work with triggers .............................................................. 478 \nHow to create a BEFORE trigger ............................................................................... 478 \nHow to use a trigger to enforce data consistency ....................................................... 480 \nHow to create an AFTER trigger ............................................................................... 482 \nHow to view or drop triggers ...................................................................................... 484 \nHow to work with events ................................................................ 486 \nHow to turn the event scheduler on or off .................................................................. 486 \nHow to create an event ................................................................................................ 486 \nHow to view, alter, or drop events .............................................................................. 488 \nSection 5 Database administration \nChapter 17 An introduction to database administration \nDatabase administration concepts ............................................... 494 \nDatabase administrator responsibilities ...................................................................... 494 \nTypes of database files ................................................................................................ 496 \nTypes of log fi Jes .......................................................................................................... 496 \nHow to monitor the server ............................................................. 498 \nHow to view the server status ...................................................................................... 498 \nHow to view a11d kill processes .................................................................................. 500 \nHow to view the status variables ................................................................................ 502 \nHow to view the system variables ............................................................................... 504 \nHow to configure the server .......................................................... 506 \nHow to set system variables using MySQL Workbench ............................................. 506 \nHow to set system variables using a text editor .......................................................... 508 \nHow to set system variables using the SET statement ................................................ 510 \nHow to work with logging .............................................................. 512 \nHow to enable and disable logging ............................................................................. 512 \nHow to configure logging ........................................................................................... 514 \nHow to view text-based logs ....................................................................................... 516 \nHow to manage logs ..................................................................................................... 518 \nChapter 18 How to secure a database \nAn introduction to user accounts ................................................. 524 \nAn introduction to SQL statements for user accounts ................................................ 524 \nA sum 1nary of privileges ............................................................................................ 526 \nThe four privilege levels ............................................................................................. 530 \nThe grant tables in the mysql database ....................................................................... 530 \nHow to work with users and privileges ........................................ 532 \nHow to create, rename, and drop users ....................................................................... 532 \nHow to specify user account names ........................................................................... 534 \nHow to grant privileges ............................................................................................... 536\n\n• \nXIV \nExpanded contents \nHow to view privileges ............................................................................................... 538 \nHow to revoke privileges ............................................................................................ 540 \nHow to change passwords ........................................................................................... 542 \nA script that creates users ........................................................................................... 544 \nHow to work with roles ................................................................... 546 \nHow to create, manage, and drop roles ....................................................................... 546 \nA script that creates users and roles ........................................................................... 550 \nHow to use MySQL Workbench ..................................................... 552 \nHow to work with users and privileges ....................................................................... 552 \nHow to connect as a user for testing ........................................................................... 556 \nChapter 19 How to backup and restore a database \nStrategies for backing up and restoring a database ................... 564 \nA backup strategy ....................................................................................................... 564 \nA 1·estoi·e strategy ........................................................................................................ 564 \nHow to back-up a database ............................................................ 566 \nHow to use 1n.ysqldump to back up a database ........................................................... 566 \nA SQL script file for a database backup ..................................................................... 568 \nHow to set advanced options for a database backup .................................................. 572 \nHow to restore a database ............................................................. 574 \nHow to use a SQL script file to restore a full backup ................................................. 574 \nHow to execute statements in the binary log .............................................................. 576 \nHow to import and export data ...................................................... 578 \nHow to export data to a file ......................................................................................... 578 \nHow to import data from a file ................................................................................... 580 \nHow to check and repair tables ..................................................... 582 \nHow to use the CHECK TABLE statement ................................................................ 582 \nHow to repair a My ISAM table .................................................................................. 584 \nHow to repair an InnoDB table ................................................................................... 584 \nHow to use the mysqlcheck program .......................................................................... 586 \nHow to use the 1nyisa1nchk program .......................................................................... 588 \nAppendix A How to install the software for this book \non Windows \nHow to install the software from mysql.com ............................... 594 \nHow to install the MySQL Community Server .......................................................... 594 \nHow to install MySQL Workbench ............................................................................ 594 \nHow to install the software from murach.com ............................. 596 \nHow to install the source files for tbis book ............................................................... 596 \nHow to create the databases for this book .................................................................. 598 \nHow to 1·estore the databases ...................................................................................... 598 \nAppendix B How to install the software for this book \non macOS \nHow to install the software from mysql.com ............................... 602 \nHow to install the MySQL Co1nmunity Server .......................................................... 602 \nHow to install MySQL Workbench ............................................................................ 604 \nHow to install the software from murach.com ............................. 606 \nHow to install the source files for this book ............................................................... 606 \nHow to create the databases for this book .................................................................. 608 \nHow to restore the databases ...................................................................................... 608\n\nIntroduction \nSince its release in 2000, MySQL has become the world's most popular open-\nsource database. It has been used by everyone from hobbyists to the world's \nlargest companies to deliver cost-effective, high-performance, scalable database \napplications .. . the type of applications that the web is built on. In fact, MySQL \nhas been used as the database for many high-profile websites, including \nWikipedia, Facebook, and Twitter. So knowing MySQL is a plus for any \ndeveloper today. \nWho this book is for \nThis book is designed for developers who are new to MySQL, as well as \ndevelopers who have been using MySQL for years but who still aren't getting \nthe most from it. It shows how to code all the SQL statements that developers \nneed for their applications, and it shows how to code these statements so they run \nefficiently. \nThis book is also a good choice for anyone who wants to learn standard \nSQL. Since SQL is a standard language for accessing database data, most of the \nSQL code in this book will work with any database management system. As a \nresult, once you use this book to learn how to use SQL to work with a MySQL \ndatabase, you can transfer most of what you have learned to another database \nmanagement system, such as Oracle, SQL Server, or DB2. \nThis book is also the right.first book for anyone who wants to become a \ndatabase administrator. Although this book doesn't present all of the advanced \nskills that are needed by a DBA, it will get you started. Then, when you complete \nthis book, you'll be prepared for more advanced books on the subject. \n5 reasons why you'll learn faster with this book \n• \nUnlike most MySQL books, this one starts by showing you how to query an \nexisting database rather than how to create a new database. Why? Because \nthat's what you're most likely to need to do first on the job. Once you master \nthose skills, you can learn how to design and implement a database if you\n\n• \nXVI \nIntroduction \nneed to do that. Or, you can learn how to work with other database features \nlike transactions or stored procedures if you need to do that. \n• \nUnlike most MySQL books, this one shows you how to use MySQL \nWorkbench to enter and run your SQL statements. MySQL Workbench is a \ngraphical tool that's an intuitive and user-friendly alternative to the MySQL \nCommand Line Client, a command-line program that has been around sin,ce \nthe beginning of MySQL. In 011r experience, using MySQL Workbench \ninstead of the command line helps you learn more quickly. \n• \nLike all of our books, this one includes hundreds of examples that range \nfrom the simple to the complex. That way, you can quickly get the idea of \nhow a feature works from the simple examples, but you'll also see how the \nfeature is used in the real world from the complex examples. \n• \nLike all of our books, this one has exercises at the end of each chapter that \ngive you hands-on experience by letting you practice what you've learned. \nThese exercises also encourage you to experiment and to apply what you've \nlearned in new ways. \n• \nIf you page through this book, you'll see that all of the info1·mation is \npresented in ''paired pages,\" with the essential syntax, examples, and \nguidelines on the right page and the perspective and extra explanation on \nthe left page. This helps you learn more with less reading, and it is the ideal \nreference format when you need to refresh your memory about how to do \nsomething. \nWhat you'll learn in this book \n• \nIn section 1, you'll learn the concepts and terms you need for working with \nany database. Yot1'll learn how to use MySQL Workbench to work with a \ndatabase and run SQL statements. You'll also learn all the SQL skills for \nretrieving data from a database and for adding, updating, and deleting that \ndata. These skills are the critical SQL skills that you'll need to get started. \n• \nIn section 2, you can learn more SQL skills as you need them. You can \nlearn how to sun1marize the data that you retrieve. You can learn how \nto code subqueries. You can learn about the types of data that MySQL \ns11pports. And you can learn how to use MySQL functions in your SQL \nstaten1ents. These advanced skills are sure to raise your expertise even if \nyou already have SQL experience. \n• \nIn section 3, you'll learn how to design a database. This includes learning \nhow to use MySQL Workbench to create an EER ( enhanced entity-\nrelationship) model for your database. Then, you'll learn how to implement \nthat design by using the DDL (Data Definition Language) statements \nthat are a part of SQL. When you're done, you'll be able to design and \nimplement your own database. In addition, you'll gain valuable perspective \nthat will make you a better SQL programmer, even if you never have to \ndesign a database.\n\n•• \nIntroduction. \nXVI I \n• \nIn section 4, you'll learn how to use MySQL to create stored procedures, \nfunctions, triggers, and events. In addition, you'll learn how to manage \ntransactions and locking. These features allow you to create programs \nmade up of multiple SQL statements that can be stored in the database \nand accessed as needed, either to run on their own or to use in application \nprograms ... a great productivity booster! So once you master these features, \nyou'll have a powerful set of MySQL skills. \n• \nIn section 5, you'll learn a starting set of skills for becoming a database \nadministrator (DBA). These skills include how to secure a database, how to \nback up a database, and how to restore a database. \nWhat software you need for this book \nAlthough you should be able to use this book with most versions of MySQL, \nwe recommend that you use: \n• \nMySQL Community Server 8.0 or higher \n• \nMySQL Workbench 8.0 or higher \nBoth of these products can be downloaded for free from MySQL's website. And \nappendixes A (for Windows) and B (for macOS) provide complete instructions \nfor installing them. \nSince the MySQL server is backwards compatible, all of the SQL statements \npresented in this book should also work with future versions of MySQL. In \naddition, most statements presented in this book work with earlier versions of \nMySQL, and we have done our best to identify any statements that don't. \nIf you use MySQL Workbench 8.0, all of the skills presented in this book \nshould work exactly as described. However, MySQL Workbench is being actively \ndeveloped, so its functionality is improving all the time. As a result, you may \nwant to use a later version of MySQL Workbench. If you do, the skills presented \nin this book may not work exactly as described, but they sl1ould work similarly. \nWhat you can download from our website \nYou can download all the source code for this book from our website. That \nincludes: \n• \nA script file that creates the three databases used by this book \n• \nThe source code for all of the examples in this book \n• \nThe solutions to the exercises that are at the end of each chapter \nAgai11, appendixes A (Windows) and B (macOS) provide complete instructions \nfor installing these items on yot1r computer.\n\n••• \nXVI 11 \nIntroduction \nSupport materials for trainers and instructors \nIf you're a corporate trainer or a college instructor who would like to use \nthis book for a course, we've created a set of instructional materials that include: \n(1) a complete set of PowerPoint slides that you can use to review and reinforce \nthe content of the book; (2) instructional objectives that describe the skills a \nstudent should have upon completion of each chapter; (3) test banks that measure \nmastery of those skills; (4) additional exercises that aren't in this book; and (5) \nsolutions to those exercises. \nTo learn more about these instructional materials, please go to our website \nat www.murachforinstructors.com if you're an instructor. Or if you're a trainer, \nplease go to www.murach.co1n and click on the Coursewa,·e for Traine,·s link, or \ncontact Kelly at 1-800-221-5528 or kelly@murach.com. \nPlease let me know how this book works for you \nWhen I started this book, I had two goals. First, I wanted to get you started \nwith MySQL as quickly and easily as possible. Second, I wanted to raise your \ndatabase development skills to a professional level. \nNow, I thank you for buying this book. I wish you all the best with your \nMySQL development. And if you have any comments about this book, I'd love to \nhear from you. \nJoelMurach,Author \njoel@murach.com\n\nAn introduction to MySQL \nBefore you begin to learn how to write SQL statements that work with \nMySQL, you need to understand some concepts and terms related to SQL \nand relational databases. That's what you'll learn in chapter 1. In addition, \nyou'll need to learn about some of the tools you can use to work with a \nMySQL database. That's what you'll learn in chapter 2. \nAfter that, you'll be ready to learn about the most important SQL \nstatements. In chapter 3, you'll learn how to use the SELECT statement \nto retrieve data from a single table. In chapter 4, you'll learn how to use \nthe SELECT statement to retrieve data from two or more tables. And in \nchapter 5, you'll learn how to use the INSERT, UPDATE, and DELETE \nstatements to add, update, and delete rows. At that point, you'll have all of \nthe background and skills that you need to work with the rest of this book.\n\nAn introduction \nto relational databases \nThis chapter presents the concepts and term.~ that you should understand \nbefore }rou begin learning how to \\Vork \\Vith a SQL database such as 1'1ySQL. \nAlthough thi chapter doesn't present the coding details. it doe pre. ent an \no~·en·ie\"'' of the most importa.11t type ot· SQL staten1ents that are presented in \nthis book. \nAn introduction to client/server systems ·····~····················~·4 \n·n1e l1ardware co1nponeru of a cl1entlser,er sy!den1 ...................................... 4 \n·rhe . ot l\\vare con1ponents at a client/. er,,er S)' ten1 ........................................ 6 \n01.he1 cl ie r1t/.ser, er architec1 ut es ..................................................................... & \nAn intr,oductlon to the relational database model ............ 10 \nHo\\\\' a table is 01gan1zed ........................................ - ..................................... 10 \nHo'\\\\' r:ible~ are re lated .................................. --· ................... -· .............................................. 12 \nHo\\.v column!! are uelined .............................................................................. 14 \nHov.• Lo read a database diagratn .................................................................... 16 \n... \nAn introduction to SQL and SOL-based systems ............. 18 \nA briet J1i tor) ot SQL ............................................................... .., ................................ .-......................... _ ... 18 \nA co111par1sot1 oJ Orucle. 082. ~1 icrt)s.oft SQL Sen,er. and My QL ........... 20 \nThe SOL stateme.nts ................................................................ 22 \nAn 1nuoducuon to the SQL ~ta1e1nenb ................................................... ·-···21 \nHov.• 10 v.ork '\"itJ1 database objel.L'i ... - ..................................... ·-················· 24 \nHo\\\\ to query a ;;;1ngle table ........................................................................... 26 \nHow to join data lrorn 1,-.0 or 1nore tables ..................................................... 28 \nHov.• Lo add, update, and dele1e dam in a rab1e .............................................. 30 \nSQL codtng guidelines ...... - ............. - ................... ~ ................. - ........... ._ ............. - ............................. ._ ... - ... .32 \nHow to use SQL from an application program .................. 34 \nComn1on opt1ons for acces ing MySQL data ................................................ 34 \nPHP code tJ1at reLrieves data from ~fySQL ................................................... 36 \nJava code that retrLeve~ daca I ron1 ~1)1SQL ................................................... 38 \nPerspective ..................................... _. ......................................... 40\n\n4 \nSection 1 \nAn introduction to MySQL \nAn introduction \nto client/server syste111s \nIn case you aren't familiar with client/server systems, the topics that follow \nintroduce you to their essential hardware and software components. When \nyou use SQL to access a MySQL database, that system is often a client/server \nsystem. \nThe hardware components \nof a client/server system \nFigure 1-1 presents the three hardware components of a client/server \nsystem: the clients, the network, and the server. The clients are usually the PCs \nthat are already available on the desktops throughout a company. Clients can also \nbe mobile devices like laptops, tablets, and smrutphones. And the network is the \ncabling, communication lines, network interface cards, hubs, routers, and other \ncomponents that connect the clients and the server. \nThe server, commonly referred to as a database server, is a con1puter that \nhas enough processor speed, inte1·nal memory (RAM), and disk storage to store \nthe files and databases of the system and provide services to the clients of the \nsystem. This computer can be a high-powered PC, a 1nidrange system like \nan IBM Power System or Unix system, or even a mainframe system. When a \nsystem consists of networks, midrange systems, and mainframe systems, often \nspread throughout the country or world, it is commonly referred to as an enter-\nprise system. \nTo back up the files of a client/server system, a server usually has a backup \ndisk drive or some other form of offline storage. It often has one or more printers \nor specialized devices that can be shared by the users of the system. And it can \nprovide programs or services like e-mail that can be accessed by all the users of \nthe system. \nIn a simple client/server system, the clients and the server are part of a \nlocal area network (LAN). However, two or more LANs that reside at separate \ngeographical locations can be connected as part of a larger network such as a \nwide area network (WAN). In addition, individual systems or networks can be \nconnected over the Internet.\n\nCl1t1pter 1 \nAi, i11trodi1ctio11 to 1?latio1,al datal1t1ses \n5 \nA simple client/server system \nI \nDatabase Server \nNetwork \nClient \nClient \nClient \nThe three hardware components of a client/server system \n• \nThe clie111.r are the PC . • Mac . or workstation. of the system. Tl1ey can also be \nmobile de,1ice like laptops. tablet~, and smartphones. \n• \nThe set1rer is a con1puter that stores the files and database of· the system and \nprovide services to the clients. W11en it stores dntabnses. itls often referred to as a \ndatab,1~~e sen·er. \n• \nThe 11en,•ork con. i ts of the cabling. communication line , and other component \nthat connect the clienu and the erver ot· lhe . y tem. \nClient/server system implementations \n• \nIn a si1nple clie11t/sen•er S)'Ste111 like the one above. the sen·er i t),.pically a \nhigh-po\\vered PC that comn1unicate \\vith the clients o er a local area nen,•ork \n(IAN). \n• \nThe er,·er can aJ o be a n1idrange sy. tern, like a t1 IBM Po\\ver Sy tern or a Unix \nyste111. or it can be a mainframe . y ten1. \n• \nA client/server system can also con ist of one or more PC-b~ed S)'Stems, one \nor n1ore n1idrange system , and a mainfran1e ystem in dispersed geographical \nlocations. Thi. type ot· system is commonly referred to as an e11terprise S)·ste11-1. \n• \nlndi\\,idual sy ten1s and LAN can be connected and share data over larger pfi,,ate \nnetwork .. such as a li1ide area 11et,,·ork (\\VA.A~. or a public net\\\\'Ork like the Internet. \nFigure 1-1 \nThe hardware components of a client/server system\n\n6 \nSection 1 \nAn introduction to MySQL \nThe software components \nof a client/server system \nFigure 1-2 presents the software components of a typical client/server \nsystem. Here, the server requires a database management system (DBMS) like \nMySQL or Microsoft SQL Server. This DBMS manages the databases that are \nstored on the server. \nIn contrast to a server, each client requires application software to perform \nuseful work. This can be a purchased software package like a financial \naccounting package, or it can be custom software that's developed for a specific \napplication. \nAlthough the application software is run on the client, it uses data that's \nstored on the server. To do that, it uses a data access AP/ (application program-\n1ning interface). Since the technique you use to work with an API depends on the \nprogramming language and API you're using, you won't learn those techniques \nin this book. Instead, you'll learn about a standard language called SQL \n(Structured Query Language) that lets any application communicate with any \nDBMS. (In conversation, SQL is pronounced as either S-Q-L or sequel.) \nOnce the software for both client and server is installed, the client commu-\nnicates with the server via SQL queries (or just queries) that are passed to the \nDBMS through the API. After the client sends a query to the DBMS, the DBMS \ninterprets the query and sends the results back to the client. \nIn a client/server system, the processing is divided between the clients and \nthe server. In this figure, for example, the DBMS on the server processes the \nrequests that are made by the application running on the client. Theoretically, at \nleast, this balances the workload between the clients and the server so the systen1 \nworks more efficiently.\n\nCl1apter 1 \nAn introduction to relational databases \n7 \nClient software, server software, and the SQL interface \nClient \nApplication software \nData access API \nServer software \nSQL queries \nResults \nI \nDatabase Server \nDatabase management system \nDatabase \n• \nTo store and manage the databases of the client/server system, each server requires \na database management systeni (DBMS) like MySQL. \n• \nThe processing that's done by the DBMS is typically referred to as back-end \nprocessing, and the database server is referred to as the back end. \nClient software \n• \nThe application software does the work that the user wants to do. This type of \nsoftware can be purchased or developed. \n• \nThe data access API (application programming interface) provides the interface \nbetween the application program and the DBMS. For example, for Java applica-\ntions, the most common data access API for MySQL is JDBC (Java Database \nConnectivity). \n• \nThe processing that's done by the client software is typically referred to as \nfront-end processing, and the client is typically referred to as the front end. \nThe SQL interface \n• \nThe application software communicates with the DBMS by sending SQL queries \nthrough the data access API. When the DBMS receives a query, it provides a \nservice like returning the requested data (the query results) to the client. \n• \nSQL stands for Structured Query Language, which is the standard language for \nworking with a relational database. \nClient/server versus file-handling systems \n• \nIn a client/server system, the processing done by an application is typically divided \nbetween the client and the server. \n• \nIn a file-handling system, all of the processing is done on the clients. Although the \nclients may access data that's stored in files on the server, none of the processing is \ndone by the server. As a result, a file-handling system isn't a client/server system. \nFigure 1-2 \nThe software components of a client/server system\n\n8 \nSection 1 \nAn introduction to MySQL \nOther client/server architectures \nIn its simplest form, a client/server system consists of a single database \nserver a.nd one or more clients. Many client/server systems today, though, \ninclude additional servers. For example, figure 1-3 shows two client/server \nsystems that include an additional server between the clients and the database \nserver. \nThe first illustration is for a simple networked system. With this system, only \nthe user interface for an application runs on the client. The rest of the processing \nthat's done by the application is stored in one or more business coniponents on \nthe application server. Then, the client sends requests to the application server \nfor processing. If the request involves accessing data in a database, the applica-\ntion server formulates the appropriate query and passes it on to the database \nserver. The results of th.e query are then sent back to the application server, \nwhich processes the results and sends the appropriate respon.se back to the client. \nSimilar processing is done by a web-based system, as illustrated by the \nsecond example in this figure. In thjs case, though, a web brotvser running on \nthe client is used to send requests to a web application running on a web server \nsomewhere on the Internet. The web application, in turn, can use web services \nto perform some of its processing. Then, the web application or web service can \npass requests for data on to the database server. \nAlthough this figure shot1ld give you an idea of how client/server systems \ncan be configured, you should realize that they can be much more complicated \nthan what's shown here. For example, business components can be distributed \nover any number of application servers, and those components can communicate \nwith databases on any number of database servers. Similarly, the web applica-\ntions and services in a web-based system can be distributed over numerous web \nservers that access numerous database servers. In most cases, though, you don't \nneed to know how a system is configured to use SQL. \nBefore I go on, you should know that client/server systems aren't the only \nsystems that support SQL. For example, traditional mainframe systems and \nnewer thin client systems also use SQL. Unlike client/server systems, though, \nmost of the processing for these types of systems is done by a mainframe or \nanother high-powered machine. The terminals or PCs that are connected to the \nsystem do little or no work.\n\nCl1apter 1 \nAn introduction to relational databases \n9 \nA networked system that uses an application server \nClient \nUser interface \nUser request \nSQL queries \n-------► ,_______.--------. \n~ \n◄ \nResponse \nI \n◄ \nApplication Server \nBusiness components \nResults \nI \nDatabase Server \nDBMS \nDatabase \nA simple web-based system \nClient \nWeb browser \nDescription \n◄ \nUser request \nResponse \nInternet \nUser request \nSQL queries \n---------►-- 1---t \n- ------------ .,____ \n◄ \nResponse \n,...,_-1--\\~\n◄---­\nResults \nI \nWeb Server \nWeb applications \nWeb services \nI \nDatabase Server \nDBMS \nDatabase \n• \nIn addition to a database server and clients, a client/server system can include \nadditional servers, such as application servers and web servers. \n• \nApplication servers are typically used to store business comporients that do part \nof the processing of the application. In particular, these components are used to \nprocess database requests from the user interface running on the client. \n• \nWeb servers are typically used to store web applications and web services. Web \napplications are applications that are designed to run on a web server. Web services \nare like business components, except that, like web applications, they are designed \nto run on a web server. \n• \nIn a web-based system, a web browser running on a client sends a request to a web \nserver over the Internet. Then, the web server processes the request and passes any \nrequests for data on to the database server. \n• \nMore complex system architectures can include two or more application servers, \nweb servers, and database servers. \nFigure 1-3 \nOther client/server architectures\n\n10 \nSection 1 \nAn introduction to MySQL \nAn introduction \nto the relational database model \nIn 1970, Dr. E. F. Codd developed a model for a new type of database called \na relational database. Thjs type of database eliminated some of the problems \nthat were associated with standard files and other database designs. By using the \nrelational model, you can reduce data redundancy, which saves disk storage and \nleads to efficient data retrieval. You can also view and manipulate data in a way \nthat is both intuitive and efficient. Today, relational databases are the de facto \nstandard for database applications. \nHow a table is organized \nThe model for a relational database states that data is stored in one or more \ntables. It also states that each table can be viewed as a two-dimensional matrix \nconsisting of rows and columns. This is illustrated by the relational table in \nfigure 1-4. Each row in this table contains information about a single vendor. \nIn practice, the rows and columns of a relational database table are often \nreferred to by the more traditional terms, records and.fields. In fact, some \nsoftware packages use one set of terms, some use the other, and some use a \ncombination. In this book, I llSe the terms rows and columns because those are \nthe terms used by MySQL. \nIn general, each table is modeled after a real-world entity such as a vendor \nor an invoice. Then, the columns of the table represent the attributes of the entity \nsuch as name, address, and phone number. And each row of the table represents \none instance of the entity. A value is stored at the intersection of each row and \ncolu1nn, sometimes called a cell. \nIf a table contains one or more columns that uniquely identify each row \nin the table, you can define these columns as the primary key of the table. For \ninstance, the primary key of the Vendors table in this figure is the vendor_id \ncolumn. In this example, the primary key consists of a single column. However, \na primary key can also consist of two or more columns, in which case it's called \na composite primary key. \nIn addition to primary keys, some database management systems let you \ndefine additional keys that uniquely identify each row in a table. If, for example, \nthe vendor_name column in the Vendors table contains unique data, it can be \ndefined as a non-priniary key. In MySQL, this is called a unique key. \nIndexes provide an efficient way of accessing the rows in a table based on \nthe values in one or more columns. Because applications typically access the \nrows in a table by referring to their key values, an index is automatically created \nfor each key you define. However, you can define indexes for other columns as \nwell. If, for example, you frequently need to sort the Vendor rows by zip code, \nyou can set t1p an index for that column. Like a key, an index can include one or \nmore columns.\n\nCl1apter 1 \nAn introduction to relational databases \n11 \nThe Vendors table in an Accounts Payable database \nPrimary key \nColumns \nvendor_id \nvendor _name \nvendor _address 1 \nvendor _address2 \nvendor_city r. \n-\n-\n► \n1 \nUS Postal Service \nAttn: Supt. Window Services \nPO Box 7005 \nMadison \n-\n2 \nNational Inft>rmation Data Ctr \nPOBox96621 \nU®!I \nWashington \n3 \nRegister of Copyrights \nLibrary Of Congress \nU©!I \nWashington \n4 \nJobtrak \n1990 Westwood Blvd Ste 260 \nUOO!I \nLos Angeles \n5 \nNewbrige Book Clubs \n3000 Cindel Drive \num,, \nWashington \n6 \nCa&fomia Chamber Of Commerce \n3255 Ramos Cir \nIU!l!I \nSacramento \n7 \nTowne Advertiser's Mailing Svcs \nKevin Minder \n3441 W Macarthur Blvd \nSanta Ana \n8 \nBFI Industries \nPOBox9369 \nliW!I \nFresno \n9 \nPacific Gas & Electric \nBox 52001 \n\"®'' \nSan Franciscc \n10 \nRobbins Mobile Lode And Key \n'1669N Fresno \nIM!I \nFresno \n11 \nBill Marvin aectric Inc \n4583EHome \nIU9!1 \nFresno \n12 \nOty Of Fresno \nPO Box 2069 \nm!t!I \nFresno \n'V \n< \n> \nConcepts \n• \nA relational database consists of tables. Tables consist of rows and columns, which \ncan also be referred to as records and fields. \n• \nA table is typically modeled after a real-world entity, such as an invoice or a \nvendor. \n• \nA colu1nn represents some attribute of the entity, such as the amount of an invoice \nor a vendor's address. \n• \nA row contains a set of values for a single instance of the entity, such as one invoice \nor one vendor. \n• \nThe intersection of a row and a column is so1netimes called a cell. A cell stores a \nsingle value. \n• \nMost tables have a primary key that unjquely identifies each row in the table. The \nprimary key is usually a single column, but it can also consist of two or more \ncolumns. If a primary key uses two or more columns, it's called a composite \npriniary key. \n• \nIn addition to primary keys, some database management systems let you define one \nor more non-primary keys. In MySQL, these keys are called unique keys. Like a \nprimary key, a non-primary key uniquely identifies each row in tl1e table. \n• \nA table can also be defined with one or more indexes. An index provides an \nefficient way to access data from a table based on the values in specific columns. \nAn index is automatically created for a table's primary and non-primary keys. \nFigure 1-4 \nHow a database table is organized \n- Rows\n\n12 \nSection 1 \nAn introduction to MySQL \nHow tables are related \nThe tables in a database can be related to other tables by values in specific \ncolumns. The two tables shown in figure 1-5 illustrate this concept. Here, each \nrow in the Vendors table is related to one or more rows in the Invoices table. This \nis called a one-to-niany relationship. \nTypically, relationships exist between the primary key in one table and the \nforeign key in another table. The foreign key is simply one or more columns in a \ntable that refer to a primary key in another table. In this figure, for example, the \nvendor_id column is the foreign key in the Invoices table and is used to create \nthe relationship between the Vendors table and the Invoices table. \nAlthough one-to-many relationships are the most common, two tables can \nalso have a one-to-one or many-to-many relationship. If a table has a one-to-one \nrelationship with another table, the data in the two tables could be stored in a \nsingle table. Because of that, one-to-one relationships are used infrequently. \nIn contrast, a many-to-many relationship is usually implemented by using \nan intermediate table that has a one-to-many relationship with the two tables in \nthe many-to-many relationship. In other words, a many-to-many relationship can \nusually be broken down into two one-to-many relationships. \nIf yo11 define a foreign key for a table in MySQL, you can have the foreign \nkey enforce referential integrity. When MySQL enforces referential integrity, \nit makes sure that any changes to the data in the database don't create invalid \nrelationships between tables. For example, if you try to add a row to the Invoices \ntable with a vendor_id value that doesn't exist in the Vendors table, MySQL \nwon't add the row and will display an error. This helps to maintain the integrity \nof the data that's stored in the database.\n\nCl1apter 1 \nAn introduction to relational databases \n13 \nThe relationship between the Vendors and Invoices tables in the database \nPrimary key \nl vendorjd \nvendor name \nvendor address 1 \nvendor _address2 \nvendor_dty \"' \n-\n-\n0@11 \n-\n112 \nOffice Depot \nFile No 81901 \nLos Angeles \n113 \nPoftstar \n4697 W Jacquelyn A-ve \n1®11 \nFresno \n114 \nPostmaster \nPostage Due Technician \n1900 E Street \nFresno \n115 \nRoadway Package System, Inc \nDept la 21095 \n0©11 \nPasadena \n116 \nState of California \nEmployment Development Dept PO Box 826276 \nSacramento \n117 \nSuburban Propane \n2874 S Cherry Ave \nH@il \nFresno \n118 \nUnocal \nP.O. Box 860070 \nHPHI \nPasadena \n119 \nYesmed, Inc \nPO Box 2061 \nHW!I \nFresno \n120 \nData forms NI est \n1617W. Shaw Avenue \nSuite F \nFresno \n121 \nZylka Design \n3'167 W Shaw Ave :.103 \nHW!I \nFresno \n-\n122 \nUnited Parcel Service \nP.O. Box 505820 \nIIL9!1 \nReno \n-\n-\n123 \nFederal Express Corporation \nP.O. Box 1140 \nDept A \nMemphis \n\\; \n• \n< \n> \ninvoicejd \nvendor_ld \ninvoice_number \ninvoice_date \ninvoice_ total \npayment_total \ncredit_total \ntermsjd \n-\n~-\n-\n123 \n963253245 \n2018-06-10 \n40.75 \n40.75 \no.oo \nl 56 \n86 \n367447 \n2018-06-11 \n2433.00 \n2433.00 \n0.00 \n57 \n103 \n7SC-90227 \n2018-06-11 \n1367.50 \n1367.50 \n0.00 \n-\n123 \n963253256 \n2018-06· 11 \n53.25 \n53.25 \n0.00 \n--\n-\n123 \n4-314-3057 \n2018-06-11 \n13.75 \n13.75 \no.oo \nJJ \n. \n60 \n122 \n989319~7 \n2018-06-12 \n2312.20 \n2312.20 \n0.00 \nI~: \n115 \n2494'6731 \n2018-06-15 \n25.67 \n25.67 \n0.00 \n. \n123 \n963253269 \n2018-06-15 \n26.75 \n26.75 \no.oo \n• \n63 \n122 \n989319-427 \n2018-06-16 \n2115.81 \n2115.81 \n0.00 \n. \n. \n123 \n963253267 \n2018--06-17 \n23.50 \n23.50 \n0.00 \nI - , \n. \n< \nForeign key \nConcepts \n• \nThe vendor_id column in the Invoices table is called aforeign key because it \nidentifies a related row in the Vendors table. A table may contain one or more \nforeign keys. \n3 \n1 \n5 \n3 \n3 \n3 \n4 \n3 \n3 \n3 \n• \nWhen you define a foreign key for a table in MySQL, you can have that foreign key \nenforce referential integrity. Then, MySQL makes sure that any changes to the data \nin the database don't create invalid relationships between tables. \n• \nThe most common type of relationship is a one-to-many relationship as illustrated \nby the Vendors and Invoices tables. A table can also have a one-to-one relationship \nor a many-to-many relation,ship with another table. \nFigure 1-5 \nHow tables are related \n> \nI \" \n• \n---\nV\n\n14 \nSection 1 \nAn introduction to MySQL \nHow columns are defined \nWhen you define a column in a table, you assign properties to it as indicated \nby the design of the Invoices table in figure 1-6. The most critical property for \na column is its data type, which determines the type of information that can be \nstored in the column. With MySQL, you can choose from the data types listed in \nthis figure as well as several other data types that are described in chapter 8. As \nyou define each column in a table, you generally try to assign the data type that \nminimizes the use of disk storage because that improves the performance of the \nqueries later. \nIn addition to a data type, you must identify whether the column can store a \nnull value (or just null). A null represents a value that's unknown, unavailable, \nor not applicable. In this figure, th.e columns that have the NN (not null) box \nchecked don't allow null values. If you don't allow null values for a column, you \nmust provide a value for that column when you store a new row in the table. \nYou can also assign a default value to each column. Then, that value is \nassigned to the column if another value isn't provided. As you can see, three of \nthe columns of the Invoices table have a default value. You '11 learn more about \nhow to work with null and defa1tlt values later in this book. \nEach table can also contain a numeric column whose value is generated \nautomatically by the DBMS. In MySQL, a column like this is called an auto \nincremen.t column. You'll learn more about defining auto increment columns \nin chapter 11. For now, just note that the primary key of both the Vendors and \nInvoices tables-vendor_id and invoice _id-are auto increment columns.\n\nThe columns of the Invoices table \nColumn Name \nDatatype \nPK \nNIii \ninvoice_id \n[N'T{ll) \n0 \n121 \nvendor_id \nIN'T{ll) \n□ 0 \ninvoice_number \nVARCHAR{SO) \n□ 0 \ninvoice_date \nDATE \n□ 121 \nlnvoice_toti.i \nD ECIMAL(9,2) \n□ 121 \npayment_total \nDECIMAL{9,2) \n□ 0 \ncredjt_toti.i \nDECIMAL(9,2) \n□ 121 \nterms Id \nINT(ll) \n□ 0 \ninvoice_due_dare \nDATE \n□ 121 \npayment_dat e \nDATE \n□ □ \n□ □ \nColumn Name: \nO,arset/CoDation: \nComments: \nCommon MySQL data types \nType \nDescription \nCl1apter 1 \nAn introduction to relational databases \n15 \nUQ \nB \nUN \nZf \nAI \n□ □ □ □ 0 \n□ □ □ □ □ \n□ □ □ □ □ \n□ □ □ □ □ \n□ □ □ □ □ \n□ □ □ □ □ \n□ □ □ □ □ \n□ □ □ □ □ \n□ □ □ □ □ \n□ □ □ □ □ \n□ □ □ □ □ \nData Type: \nDefault: \nStorage: \nV-rb.Jal \nPrrnary Key \nBrlary \nG \n□ \n□ \n□ \n□ \n□ \n□ \n□ \n□ \n□ \n□ \n□ \nDefaultJExpression \n·o.oo· \n'0.00' \nNULL \nStored \nNotNul \nUnsigned \nUnique \nZero Al \nAuto Increment \nGenerated \nCHAR, VARCHAR \nINT, DECIMAL \nFLOAT \nA string of letters, symbols, and numbers. \nDATE \nDescription \nInteger and deci111al numbers that contain an exact value. \nFloating-point numbers that contain an approximate value. \nDates and times. \n• \nThe data type that's assigned to a column determines the type of information that \ncan be stored in the column. \n• \nEach column definition also indicates whether or not it can contain null values. A \nnull value indicates that the value of the column is unknown. \n• \nA column can also be defined with a def a ult value. Then, that value is used if \nanother value isn't provided when a row is added to the table. \n• \nA column can also be defined as an auto increment column. An auto increment \ncolumn is a numeric column whose value is generated automatically when a row is \nadded to the table. \nFigure 1-6 \nHow columns are defined\n\n16 \nSection 1 \nAn introduction to MySQL \nHow to read a database diagram \nWhen working with relational databases, you can use an entity-relationship \n(ER) diagrani to show how the tables in a database are defined and related. Or, \nyou can use a newer version of an ER diagram known as an enhanced \nentity-relationship (EER) diagram. In figure 1-7, for example, you can see an \nEER diagram for the AP (Accounts Payable) database that's used throughout this \nbook. This diagram shows that the database contains five related tables: Vendors, \nTerms, Invoices, Invoice_Line_Items, and General_Ledger_Accounts. \nFor each table, this diagran1 shows how the columns are defined. For \nexample, it shows that the Vendors table has 12 columns. It shows the name \nand data type for each column. It uses a key icon to show that the primary key \nfor this table is the vendor id column. And it uses a dark diamond icon to show \nthat the table has two columns that are foreign keys: default_terms_id and \ndefault account number. \n-\n-\nThis diagram also shows how the tables are related. To do that, it places a \nconnector symbol between the tables. For example, the connector between the \nVendors and Invoices table shows that these tables have a one-to-many relation-\nship. On this connector, the symbol closest to the Invoices table indicates that \nmany invoices can exist for each vendor, and the symbol closest to the Vendors \ntable shows that only one vendor can exist for each invoice. If you study the \nprimary and foreign keys for these tables, you can deduce that these tables are \ndesigned to be joined on the vendor_id column that's in both tables. \nSimilarly, this diagram shows that there's a one-to-many relationship \nbetween the Terms and Vendors table. In other words, each terms of payment \ncan have many vendors, but each vendor can only have one default ter1ns of \npayment. If you study the primary and foreign keys for these tables, you can \ndeduce that these tables are designed to be joined on the terms_id column of the \nTerms table and the default terms id column of the Vendors table. \n-\n-\nMost of the tables in this diagram begin with a single column that defines \nthe primary key for the table. However, the Invoice_Line_ltems table begins with \ntwo columns (invoice_id and invoice_sequence) that define the primary key for \nthis table. In other words, since the invoice_id column doesn't uniquely identify \nthe line item, the primary key must include the invoice_sequence column so it \ncan uniquely identify each row. \nIn chapter 10, you'll learn how to use MySQL Workbench to create and \nwork with EER diagrams. For now, you just need to understand how to read the \ndiagram presented in this figure so you can understand the relationships between \nthe tables in the AP database.\n\nCl1apter 1 \nAn introduction to relational databases \nAn EER diagram for the AP (Accounts Payable) database \n:J vendoes \nveidorjd INT \nveidor_nane VARQ-IAA(SO) \nvaidor_addressl VARCHAR{SO) \nveidor_address2 VARCHAR(SO) \nve,dor_city VARQ-INl(SO) \nveidor_state Q-IAA(2) \nveidor_zip_code VAACHAR(20) \nveidor_phone VAACHAR(SO) \nveidor_contactjast_name V M CHAR(SO) \nveidor_contact_first_nan e VARQ-IM (SO) \ndefault_termsjd INT \ndefaul t_crcount_number INT \nf \nI \nI f \n~ general_ledger_acoounts • \naccou,t_number INT \naccouit_descriptia, V AACHAR( SO) \nT \nI \nI \nI \n► \n► \n• • \n-\n-\n--I \nI \nI \n--\nt+---, \nI \nI \nI \nI \nI --\nt __________ _ \nDescription \n':J WI\\IS \nrermsjd INT \n• \nl \nrerms_des:ription VARQ-IM (SO} \nrerm s_due_days INT \n► \n:] irwoices \ni nwi ce Jd INT \nvmdorJd INT \nirwoice_number VARCHAR(SO) \ninvoice_date DATE \ni nwi ce _ lotal DECIMAL(9 ,2) \npa~ e, t_total DECIMAL{9,2) \ncredrt_total DEOMAL(9,2) \nterm s _id INT \ninwice_due_date DATE \npa~ent_date DATE \n► \n: \n. -\n1ft . -\n::] irwoiceJine_ Jb.J:.s \ninwi ce jd INT \ninwice_!equence INT \nacmu,t_number INT \nlinejlem_amount DECIMAL{9,2} \nhnejtem_desaipton VARCHAR(lOO) \n► \n• \nAn entity-relationship (ER) diagram or enhanced entity-relationship (EER) \ndiagram can be used to show how the tables in a database are defmed and related. \nFigure 1-7 \nHow to read a database diagram \n17\n\n18 \nSection 1 \nAn introduction to MySQL \nAn introduction to SQL \nand SQL-based systems \nIn the topics that follow, you '11 learn how SQL and SQL-based database \nmanagement systems evolved. In addition, you'll lea111 how some of the most \npopular SQL-based systems compare. \nA brief history of SQL \nPrior to the release of the frrst relational database management system, each \ndatabase had a unique physical structure and a unique programming language \nthat the programmer had to understand. That all changed with the advent of SQL \nand the relational database management system. \nFigure 1-8 lists the important events in the history of SQL. In 1970, \nDr. E. F. Codd published an article that described the relational database model \nhe had been working on with a research team at IBM. Then, in 1979, Relational \nSoftware, Inc. released the first relational database management system, \ncalled Oracle. This RDBMS ran on a minicomputer and used SQL as its query \nlanguage. This product was widely successful, and the company later changed its \nname to Oracle to reflect that success. \nIn 1982, IBM released its first commercial SQL-based RDBMS, called \nSQUDS (SQUData S)1stem). This was followed in 1985 by DB2 (Database 2). \nBoth systems ran only on IBM mainframe computers. Later, DB2 was ported to \nother operating systems, including Unix and Windows. Today, it continues to be \nIBM's premier database system. \nDuring the 1980s, other SQL-based database syste1ns, including SQL \nServer, were developed. Although each of these systems used SQL as its query \nlanguage, each implementation was unique. That began to change in 1989, \nwhen the American National Standards Institute (ANSI) published its first set \nof standards for a database query language. As each database manufacturer \nhas attempted to co1nply with these standards, their implementations of SQL \nhave become more similar. However, each still has its own dialect of SQL that \nincludes additions, or exte11sions, to the standards. \nAlthough you should be aware of the SQL standards, they will have little \neffect on your job as a MySQL programmer. The main benefit of the standards \nis that the basic SQL statements are the same in each dialect. As a result, once \nyou've learned one dialect, it's relatively easy to learn another. On the other \nhand, porting applications that use SQL from one type of database to another \noften requires substantial changes. \n1995 saw the first release of MySQL, which was used internally by the \ncompany that developed it, MySQL AB. In 2000, MySQL became an \nopen-source database. Since then, MySQL has become one of the most popular \ndatabases, especially for web applications. In 2008, MySQL was acquired by \nSun Microsystems, and in 2010, Oracle acquired Sun.\n\nCl1apter 1 \nAn introduction to relational databases \n19 \nImportant events in the history of SQL \nVear \nEvent \n1970 \nDr. E. F. Codd deveJoped the relational database model. \n1979 \nRelational Software, Inc. (later renamed Oracle) released the fii-st relatio11al DBMS, Oracle. \n1982 \nIBM released their first relational database system, SQL/DS (SQL/Data System). \n1985 \nIBM released DB2 (Database 2). \n1987 \nMicrosoft released SQL Server. \n1989 \nThe American National Standards Institute (ANSI) published the first set of standards for a \ndatabase query language, called ANSI/ISO SQL-89, or SQLI. \n1992 \nANSI published revised standards (ANSI/ISO SQL-92, or SQL2) that were more stringent \nthan SQLl arid incorporated many new features. These standards introduced levels of \ncompliance, or levels of conforn1ance, that indicated the extent to which a dialect met the \nstandards. \n1995 \nMySQL AB released MySQL for internal use. \n1999 \nANSI published SQL3 (ANSI/ISO SQL: 1999). These standards incorporated new features, \nincluding suppo1t for objects. Levels of compliance were dropped and were replaced by a \ncore specification that defined the essential elements for compliance. plus nine packages. \nEach package is designed to serve a specific market niche. \n2000 \nMySQL became an open-source database. \n2003 \nANSI pubJished SQlA (ANSI/ISO SQL:2003). These stan.dards introduced XML-related \nfeatures, standardized sequences, and identity columns. \n2006 \nANSI published SQL:2006, which defined bow SQL can be used with XML. These \nstandards also allowed applications to integrate XQuery into their SQL code. \n2008 \nSun Microsystems acquired MySQL. \n2008 \nANSI published SQL:2008. These standards introduced INSTEAD OF triggers and the \nTRUNCATE statement. \n2010 \nOracle acquired Sun Microsystems and MySQL. Soon after the acquisitio11, many of the \noriginal developers of MySQL left and begin working on a fork of the open-source code \nnamed MariaDB. \n2016 \nANSI published SQL:2016, which includes support for regt1lar expressions and JavaScript \nObject Notation (JSON). \nDescription \n• \nAlthough SQL is a standard langt1age, each vendor has its own SQL dialect, or \nvariant, that may include extensions to the standards. \nHow knowing ''standard SQL'' helps you \n• \nThe most basic SQL statements are the same for all SQL dialects. \n• \nOnce you have learned one SQL dialect, you can easily learn other dialects. \nHow knowing ''standard SQL'' does not help you \n• \nAny non-trivial application will require modification when moved from one SQL \ndatabase to another. \nFigure 1-8 \nA brief history of SQL\n\n20 \nSection 1 \nAn introduction to MySQL \nSoon after Oracle's acquisition of MySQL, many of the original developers \nof MySQL left and began working on a fork of the open-source code named \nMariaDB. One of MariaDB's stated goals is to remain free and open-source \nwhile maintaining high compatibility with MySQL so it can be used as a drop-in \nreplacement for MySQL. As a result, many large companies, including Google \nand Wikipedia, have switched from MySQL to MariaDB. \nA comparison of Oracle, DB2, Microsoft SQL \nServer, and MySQL \nAlthough this book is about MySQL, you may want to know about some \nof the other SQL-based relational database management systems. Figure \n1-9 compares MySQL with three other popular databases: Oracle, DB2, and \nMicrosoft (MS) SQL Server. \nOracle has a huge installed base of customers and continues to dominate the \nmarketplace, especially for servers running the Unix or Linux operating system. \nOracle works well for large systems and has a reputation for being extremely \nreliable. However, it also has a reputation for being expensive and difficult to \nuse. \nDB2 was originally designed to run on IBM mainframe systems and \ncontinues to be the premier database for those systems. It also dominates in \nhybrid envil.-onments where IBM mainframes and newer servers must coexist. \nAlthough it has a reputation for being expensive, it also has a reputation for \nbeing reliable and easy to use. \nSQL Server was designed by Microsoft to run on Windows and is widely \nused for small- to medium-sized departmental systems. It has a reputation for \nbeing inexpensive and easy to use. However, it also has a reputation for not \nscaling well for systems with a lai·ge number of users. \nMySQL runs on all major operating systems and is widely used for web \napplications. MySQL is an open-source database, which means that any devel-\noper can view and improve its source code. In addition, the MySQL Community \nServer is free for most users, although Oracle also sells an Enterprise Edition of \nMySQL that has advanced features. \nOne of the main differences between MySQL and SQL Server is that \nMySQL runs under most operating systems including Unix, Linux, Windows, \nmacOS, and IBM's z/OS. In contrast, SQL Server only runs under Windows and \nLinux, and the Linux version was just released in 2017. Since many developers \nconsider z/OS and Unix to be more stable and secure than Windows, most large \ncompanies use z/OS or Unix as the operating system for the servers that store \nthe databases for mission-critical applications. As a result, they can't use SQL \nServer and must use Oracle, DB2, or MySQL. \nIf you search the Internet, you '11 find that dozens of other relational database \nproducts are also available. These include proprietary databases like Inforrnix, \nSybase, and Tera.data. And they include open-source databases like PostgreSQL \nand MariaDB.\n\nCl1apter 1 \nAn introduction to relational databases \n21 \nA comparison of Oracle, D82, SQL Server, and MySQL \nOracle \nD82 \nSQL Server \nMySQL \nRelease year \n1979 \n1985 \n1987 \n2000 \nPlatforms \nUnix/Linux \nOS/390, z/0S \nWindows \nUnix/Linux \nOS/390, z/OS \nUnix/Ljnux \nLinux \nWindows \nW.indows \nWindows \nmacOS \nmacOS \nmacOS \nz/OS \nDescription \n• \nOracle is typically used for large, mission-critical systems that run on one or more \nUnix servers. \n• \nDB2 is typically used for large, mission-critical systems that run on legacy IBM \nmainframe systems using the z/OS or OS/390 operating system. \n• \nMicrosoft (MS) SQL Server is typically used for small- to medium-sized systems \nthat run on one or more Windows servers. \n• \nMySQL is a popular open-source database that runs on all major operating systems \nand is commonly used for web applications. \nFigure 1-9 \nA comparison of Oracle, DB2, SQL Server, and MySQL\n\n22 \nSection 1 \nAn introduction to MySQL \nThe SQL state111ents \nIn the topics that follow, you '11 learn about some of the SQL statements \nprovided by MySQL. You can use some of these statements to manipulate \nthe data in a database, and you can use others to work with database objects. \nAlthough you may not be able to code these statements after reading these \ntopics, you should have a good idea of how they work. Then, you' 11 be better \nprepared to learn the details of coding these statements when they're presented \nin the rest of this book. \nAn introduction to the SQL statements \nFigure 1-10 summarizes some of the most common SQL statements. These \nstatements can be divided into two categories. The statements that work with \nthe data in a database are called the data manipulation language (DML). These \nstate1nents are presented in the first group in this figure, and these are the state-\nments that application programmers use the most. \nThe statements that create databases and work with the objects within a \ndatabase are called the data definition language (DDL). On large systems, these \nstate1nents are used exclusively by database administrators (DBAs). It's the \nDBA's job to maintain existing databases, tune them for faster performance, and \ncreate new databases. On smaller systems, though, the SQL programmer may fill \nthe role of the DBA.\n\nCl1apter 1 \nAn introduction to relational databases \n23 \nSQL statements used to work with data (DML) \nStatement \nDescription \nSELECT \nINSERT \nUPDATE \nDELETE \nRetrieves data from one or more tables. \nAdds new rows to a table. \nChanges existing rows in a table. \nDeletes existing rows from a table. \nSQL statements used to work with database objects (DDL) \nStatement \nDescription \nCREATE DATABASE \nCREATE TABLE \nCREATE INDEX \nALTER TABLE \nALTER INDEX \nDROP DATABASE \nDROP TABLE \nDROP INDEX \nDescription \nCreates a new database on the server. \nCreates a new table in a database. \nCreates a new index for a table. \nChanges the definition of an existing table. \nChanges the structure of an existing index. \nDeletes an existing database and all of its tables. \nDeletes an existing table. \nDeletes an existing index. \n• \nThe SQL statements can be divided into two categories: the data manipulation \nlanguage ( DML) that lets you work with the data in the database and the data \ndefinition language (DDL) that lets you work with the objects in the database. \n• \nMySQL programmers typically work with the DML statements, while database \nadministrato1·s (DBAs) use the DDL statements. \nFigure 1-10 \nAn introduction to the SQL statements\n\n24 \nSection 1 \nAn introduction to MySQL \nHow to work with database objects \nTo give yot1 an idea of how you use the DDL statements shown in the \nprevious figure, figure 1-11 presents some examples. Here, the first example \ncreates a database named AP. Then, the second example selects that database. As \na result, the rest of the statements in this figure are run against the AP database. \nThe third example creates the Invoices table that's used throughout this \nchapter. If you don't understand all of this code right now, don't worry. You'll \nlearn how to code statements like this in chapter 11. For now, just realize that \nthis statement defmes each column in the table, including its data type, whether \nor not it allows null values, and its default value if it has one. \nIn addition, the third example defines the primary and foreign key columns \nfor the table. These definitions are one type of constraint. Since the Invoices \ntable includes foreign keys to the Vendors and Ter1ns tables, these tables must be \ncreated before the Invoices table. Conversely, before you can delete the Vendors \nand Terms tables, you must delete the Invoices table. \nThe fourth example in this figure changes the Invoices table by adding a \ncolumn to it. Like the statement that created the table, this statement specifies \nthe attributes of the new column. Then, the fifth example deletes the column that \nwas just added. \nThe sixth example creates an index on the Invoices table. In this case, the \nindex is for the vendor_id column, which is used frequently to access the table. \nThen, the last example deletes the index that was just added.\n\nCl1apter 1 \nAn introduction to relational databases \n25 \nA statement that creates a new database \nCREATE DATABASE ap \nA statement that selects the current database \nUSE ap \nA statement that creates a new table \nCREATE TABLE invoices \n( \n) \ninvoice_ id \nvendor_ id \ninvoice_nwnber \ninvoice date \ninvoice_ total \npayment_ total \ncredit_total \nterms_ id \nINT \nINT \nVARCHAR ( 5 0) \nDATE \nDECIMAL(9,2) \nDECIMAL(9,2) \nDECIMAL(9,2) \nINT \ninvoice_due_date \nDATE \npayment_date \nDATE, \nCONSTRAINT invoices_ fk_vendors \nFOREIGN KEY (vendor id) \nREFERENCES vendors (vendor_id), \nCONSTRAINT invoices_ fk_terms \nFOREIGN KEY (terms_ id) \nREFERENCES terms (terms id) \nPRIMARY KEY \nNOT NULL, \nNOT NULL, \nNOT NULL, \nNOT NULL, \nNOT NULL, \nNOT NULL, \nA statement that adds a new column to a table \nALTER TABLE invoices \nADD balance_due DECIMAL(9,2) \nA statement that deletes the new column \nALTER TABLE invoices \nDROP COLUMN balance_due \nA statement that creates an index on the table \nCREATE INDEX invoices_vendor_ id_ index \nON invoices (vendor_ id) \nA statement that deletes the new index \nDROP INDEX invoices_vendor_ id_ index \nON invoices \nFigure 1-11 \nTypical statements for working with database objects \nAUTO_ INCREMENT, \nDEFAULT 0, \nDEFAULT 0,\n\n26 \nSection 1 \nAn introduction to MySQL \nHow to query a single table \nFigure 1-12 shows how to use a SELECT statement to query a single table \nin a database. To start, this figure shows some of the columns and rows of the \nInvoices table. Then, in the SELECT statement that follows, the SELECT clause \nnames the columns to be retrieved, and the FROM clause names the table that \ncontains the columns, called the base table. In this case, six columns will be \nretrieved from the Invoices table. \nNote that the last column, balance_due, is calculated from three other \ncolumns in the table. In other words, a column by the name of balance_due \ndoesn't actually exist in the database. This type of column is called a calculated \nvalue, and it exists only in the results of the query. \nIn addition to the SELECT and FROM clauses, this SELECT statement \nincludes a WHERE clause and an ORDER BY clause. The WHERE clause gives \nthe criteria for the rows to be selected. In this case, a row is selected only if it bas \na balance due that's greater than zero. Finally, the returned rows are sorted by the \ninvoice date column. \nThis figure also shows the result set (or result table) that's returned by the \nSELECT statement. A result set is a logical table that's created temporarily \nwithin the database. When an application requests data from a database, it \nreceives a result set.\n\nCl1apter 1 \nAn introduction to relational databases \n27 \nThe Invoices base table \ninvoice_id \nvendor _id \ninvoice_number \ninvoice _date \ninvoice_total \npayment_total \ncredit_total \nterms_id \"' \n► \n1 \n122 \n989319-457 \n2018-04-08 \n3813.33 \n3813.33 \n0.00 \n3 \n2 \n123 \n2632532'11 \n2018-04-10 \n40.20 \n40.20 \n0.00 \n3 \n3 \n123 \n963253234 \n2018-04-13 \n138.75 \n138.75 \n0.00 \n3 \n4 \n123 \n2-000-2993 \n2018-04-16 \n144.70 \n144.70 \n0.00 \n3 \n5 \n123 \n963253251 \n2018-04-16 \n15.50 \n15.50 \n0.00 \n3 \n.., \n< \n> \nA SELECT statement that retrieves and sorts selected columns and rows \nfrom the Invoices table \nSELECT invoic e_ number, invoice_date, invoice_total, \npayment_total, credit_ total, \ninvoice_total - payment_total - credit_ total AS balance_due \nFROM invoices \nWHERE invoice_ total - payment_total - credit_ total > 0 \nORDER BY invoice_date \nThe result set defined by the SELECT statement \ninvoice_number \ninvoice_date \ninvoice_total \npayment_total \ncredit_total \nbalance_due \n-\n► \n39104 \n2018-07-10 \n85.31 \n0.00 \n0.00 \n85.31 \n963253264 \n2018-07-18 \n52.25 \n0.00 \n0.00 \n52.25 \n31361833 \n2018-07-21 \n579.42 \n0.00 \n0.00 \n579.42 \n263253268 \n2018-07-21 \n59.97 \n0.00 \n0.00 \n59.97 \n263253270 \n2018-07-22 \n67.92 \n0.00 \n0.00 \n67.92 \n-\n-\nConcepts \n• \nYou use the SELECT statement to retrieve selected columns and rows from a base \ntable. The result of a SELECT statement is a result table, or result set, like the one \nshown above. \n• \nA result set can include calculated values that are calculated from columns in the \ntable. \n• \nA SELECT statement is commonly referred to as a quer)'· \nFigure 1-12 \nHow to query a single table \n\"' \nI \n-\n.., \nl\n\n28 \nSection 1 \nAn introduction to MySQL \nHow to join data from two or more tables \nFigure 1-13 presents a SELECT statement that retrieves data from two \ntables. This type of operation is called ajoin because the data from the two \ntables is joined together into a single result set. For example, the SELECT state-\nment in this figure joins data from the Invoices and Vendors tables. \nAn inner join is the most common type of join. When you use an inner join, \nrows from the two tables in the join are included in the result table only if their \nrelated columns match. These matching columns are specified in the FROM \nclause of the SELECT statement. In the SELECT statement in this figure, for \nexample, rows from the Invoices and Vendors tables are included only if the \nvalue of the vendor id column in the Vendors table matches the value of the \n-\nvendor_id column in one or more rows in the Invoices table. If there aren't any \ninvoices for a particular vendor, that vendor won't be included in the result set. \nAlthough this figure shows only how to join data from two tables, you can \nextend this syntax to join data from three or more tables. If, for example, you \nwant to include line item data from a table named Invoice Line Ite1ns in the \n-\n-\nresults shown in this figure, you can code the FROM clause of the SELECT \nstatement like this: \nFROM vendors \n• \n• \nINNER JOIN invoices \nON vendors.vendor_ id = invoices.vendor_ id \nINNER JOIN invoice_ line_ items \nON invoices.invoice_ id = invoice_ line_ items.invoice_id \nThen, in the SELECT clause, you can include any of the columns in the \nInvoice_Line_Items table. \nIn addition to inner joins, most relational databases including MySQL \nsupport other types of joins such as outer joins. An outer join lets you include \nall rows from a table even if the other table doesn't have a matching row. You'll \nlearn more about the different types of joins in chapter 4.\n\nCl1apter 1 \nAn introduction to relational databases \n29 \nA SELECT statement that joins data from the Vendors and Invoices tables \nSELECT vendor_name, invoice_number, invoic e_date, invoice_total \nFROM vendors INNER JOIN invoices \nON vendors.vendor_ id = invoices.vendor_ id \nWHERE invoice_ total >= 500 \nORDER BY vendor_narn~, invoice_total DESC \nThe result set defined by the SELECT statement \nl vendor _name \ninvoice number \ninvoice date \nlnv0tee total \n-\nFederal Express Corporation \n9632532.30 \n2018-07-07 \n739.20 \nFord Motor Credit Company \n9982771 \n2018-07-24 \n503.20 \nFranchise Tax Board \nRTR-72-3662-X \n2018-05-25 \n1600.00 \nFresno County Tax Collector \nP02-88077S7 \n2018-05-03 \n856.92 \nIBM \nQS45443 \n2018-06-09 \n1083.58 \nIngram \n31359783 \n2018-06-03 \n1575.00 \nIngram \n31361833 \n2018-07-21 \n579.42 \nMalloy Lithographing Inc \n0-2058 \n2018-05-28 \n37966.19 \nConcepts \n• \nA join lets you combine data from two or more tables into a single result set. \n• \nThe most common type of join is an inner join. This type of join returns rows from \nboth tables only if their related columns match. \n• \nAn outer join returns rows from one table in the join even if the other table doesn' t \ncontain a matching row. \nFigure 1-13 \nHow to join data from two or more tables \n' \n~\n\n30 \nSection 1 \nAn introduction to MySQL \nHow to add, update, and delete data in a table \nFigure 1-14 shows how you can use the INSERT, UPDATE, and DELETE \nstatements to modify the data in a table. In this figure, for example, the first \nstatement is an INSERT statement that adds a row to the Invoices table. To do \nthat, the INSERT clause names the columns whose values are supplied in the \nVALUES clause. \nIn chapter 5, you'll learn more about specifying column names and values. \nFor now, just note that you have to specify a value for a column unless it's a \ncolumn that allows null values or a column that's defined with a default value. \nThe two UPDATE statements in this figure show how to change the data in \none or more rows of a table. The first statement, for example, assigns a value of \n35.89 to the credit total column of the invoice in the Invoices table with invoice \nnumber 367447. The second statem.ent adds 30 days to the invoice due date for \neach row in the Invoices table whose terms id column has a value of 4. \nTo delete rows from a table, you use the DELETE statement. For exainple, \nthe frrst DELETE statement in this figure deletes the invoice with invoice \nnumber 4-342-8069 from the Invoices table. The second DELETE statement \ndeletes all invoices with a balance due of zero. However, since the Invoices table \nhas a foreign key that references the Invoice_Line_Items table, these DELETE \nstatements won't work unless the invoice doesn't contain any line items. One \nway to get these DELETE statements to work is to delete the co1responding \nrows from the Invoice_Line_Items table first.\n\nCl1apter 1 \nAn introduction to relational databases \n31 \nA statement that adds a row to the Invoices table \nINSERT INTO invoices \n(vendor_ id, invoice_ nwnber, invoice_ date, \ninvoice_ total, terms_ id, invoice_due_ dat e ) \nVALUES \n(12, \n1 3289175 1 , \n'2018-07-18', 165, 3, ' 2 018-08-17') \nA statement that changes the value of the credit_total column \nfor a selected row in the Invoices table \nUPDATE invoices \nSET credit_ total = 35.89 \nWHERE invoice DtJmhFJr = '367447' \nA statement that changes the values in the invoice_due_date column \nfor all invoices with the specified terms_id \nUPDATE invoices \nSET invoic e _due_date = DATE_ ADD (invoice_ due_date, INTERVAL 30 DAY) \nWHERE terms_ id = 4 \nA statement that deletes a selected invoice from the Invoices table \nDELETE FROM invoices \nWHERE invoice_ number = '4-342-8069' \nA statement that deletes all paid invoices from the Invoices table \nDELETE FROM invoic es \nWHERE invoice_ total -\npayment_ total - credit total= 0 \nConcepts \n• \nYou use the INSERT statement to add rows to a table. \n• \nYou use the UPDATE statement to change the values in one or more rows of a table \nbased on the condition you specify. \n• \nYou use the DELETE statement to delete one or more rows from a table based on \nthe condition you specify. \nWarning \n• \nIf you 're new to SQL statements, please don't execute the statements above until \nyou read chapter 5 and understa.nd the effect that these statements can have on the \ndatabase. \nFigure 1-14 \nHow to add, update, and delete data in a table\n\n32 \nSection 1 \nAn introduction to MySQL \nSQL coding guidelines \nSQL is a freefor111 language. That means that you can include line breaks, \nspaces, and indentation without affecting the way the database interprets the \ncode. In addition, SQL isn't case-sensitive like so1ne languages. That means that \nyou can use uppercase or lowercase letters or a combination of the two without \naffecting the way the database interprets the code. \nAlthough you can code SQL statements with a freeform style, we suggest \nthat you follow the coding recommendations presented in figure 1-15. The \nexamples in this figure illustrate the value of these coding recommendations. The \nfirst example presents an unformatted SELECT statement that's difficult to read. \nIn contrast, this statement is much easier to read after our coding recommenda-\ntions are applied as shown in the second example. \nThe third example illustrates how to code a block comment. This type of \ncomment is typically coded at the beginning of a group of statements and is used \nto document the entire group. Block comments can also be used within a state-\nment to describe blocks of code, but that's not common. \nThe fourth example in this figure includes a single-line comment. This type \nof comment is typically used to document a single statement or line of code. A \nsingle-line comment can be coded on a separate line as shown in this example, \nor it can be coded at the end of a line of code. In either case, the comment is \ndelimited by the end of the line. \nAlthough many programmers sp1·inkle their code with comments, that \nshouldn't be necessary if yot1 write your code so it's easy to read and understand. \nInstead, you should use comments only to clarify sections of code that are diffi-\ncult to understand. Then, if you change the code, you should be sure to change \nthe comments too. Otherwise, the comments won't accurately represent what the \ncode does, which will make the code even more difficult to understand.\n\nCl1apter 1 \nAn introduction to relational databases \n33 \nA SELECT statement that's difficult to read \nselect invoice_ n11mber, invoice_date, invoice_ total, \npayment_ total, credit_ total, invoice_ total -\npayment_ total -\ncredit_ total as balance_due from invoices where invoice_ total -\npayment_ total - credit_ total > 0 order by invoice_ date \nA SELECT statement that's coded with a readable style \nSELECT invoice_n,irnber, invoice_ date, invoice_ total, \npayment_ total, credit_ total, \ninvoice_ total -\npayment_ total - credit_ total AS balance_due \nFROM invoices \nWHERE invoice_ total -\npayment_ total - credit_ total > 0 \nORDER BY invoice_ date \nA SELECT statement with a block comment \nI* \nAuthor: Joel Murach \nDate: 8/22/2018 \n*I \nSELECT invoice_ number, invoice_date, invoice_ total, \ninvoice_ total -\npayment_ total - credit_ total AS balance_due \nFROM invoices \nA SELECT statement with a single-line comment \n-- The fourth column calculates the balance due \nSELECT invoice_number, invoice_date, invoice_ total, \ninvoice_ total - payment_ total - credit_ total AS balance_due \nFROM invoices \nCoding recommendations \n• \nCapitalize all keywords, and use lowercase for the other code in a SQL statement. \n• \nSeparate the words in names with underscores, as in invoice_number. \n• \nStart each clause on a new line. \n• \nBreak long clauses into multiple lines and indent continued lines. \n• \nUse comments only for portions of code that are difficult to understand. Then, make \nsure that the comments are correct and up-to-date. \nHow to code a comment \n• \nTo code a block comment, type /* at the start of the block and :~/ at the end. \n• \nTo code a single-line comment, type -- followed by the comment. \nDescription \n• \nLine breaks, white space, indentation, and capitalization have no effect on the \noperation of a statement. \n• \nComments can be used to document what a statement does or what specific parts of \nthe code do. They are not executed by the system. \nFigure 1-15 \nSQL coding guidelines\n\n34 \nSection 1 \nAn introduction to MySQL \nHow to use SQL \nfron, an application progran, \nThis book teaches you how to use SQL from within the MySQL environ-\nment. However, SQL is commonly used from application programs too. So in \nthe topics that follow, you' 11 get a general idea of how that works. \nAs you'll see, there's a lot involved in accessing a MySQL database from an \napplication program. That's why most application programmers use a framework \nthat makes it easier to execute SQL statements against a database. In some cases, \napplication programmers create their own framework by writing utility classes \nand data access classes. In other cases, application programmers use an existing \nframework that provides the classes they need. \nCommon options for accessing MySQL data \nFigure 1-16 shows three ways to access a MySQL database when you use \na programming language to write a custom application. The technique that's \nused varies depending on the language that's used to develop the application. \nHowever, most modem languages provide an API that allows you to connect to a \nMySQL database. \nAn API uses a piece of software known as a database dt·iver to commL1nicate \nwith the database. For some languages, the database driver is built in. For others, \nyou need to download and install a database driver. \nTo access a MySQL database from a PHP application, for example, you \ntypically choose from two APis. Some programmers prefer to use the mysqli \n(MySQL Improved Extensiori) API. Other programmers prefer to use the newer \nPDO (PHP Data Objects) API. Neither of these APis requires a database driver, \nsince that driver is typically included as part of the PHP language. \nOn the other hand, to access a MySQL database from a Java application, you \ntypically use the JDBC (Java Database Connectivity) API. This API requires a \ndriver to communicate with MySQL. In most cases, you can use the Connector/J \ndriver that's available from the MySQL website to connect a Java application to \na MySQL database. \nAlthough it's more common to use MySQL with non-Microsoft languages \nsuch as PHP and Java, it's possible to use MySQL with Microsoft .NET \nlanguages such as C# and Visual Basic. However, the .NET platform doesn't \ninclude a database driver by default, so you typically need to download and \ninstall the Connector/Net driver that's available from the MySQL website. Then, \nyou can use the ADO.NET API to access a MySQL database.\n\nCl1apter 1 \nAn introduction to relational databases \n35 \nCommon options for accessing MySQL data \nTwo commonly used MySQL drivers \nName \nDescription \nConnector/ J \nConnects Java applications to a MySQL database. \nConnector / Net \nConnects .NET applications to a MySQL database. \nDescription \n• \nTo work with a MySQL database, an application uses a data access API. For \nexample, PHP uses the mysqli API or the PDO API, Java uses the JDBC API, and \n.NET languages like C# and Visual Basic use the ADO.NET API. \n• \nMost modem programming languages provide an API that you can use to access \nMySQL. \n• \nSome programming languages include a piece of software known as a database \ndriver for the API that it uses to access MySQL. For example, PHP includes a \nMySQL driver for both the mysqli and PDQ APis. As a result, you typically don't \nneed to install a database driver when you use PHP. \n• \nSome programming languages don't provide a database driver to communicate \nwith a MySQL database. For example, Java doesn't include a MySQL driver for the \nJDBC API. As a result, you typically need to install a database driver such as the \nConnector/J driver before you can use Java to access MySQL. \nFigure 1-1 6 \nCommon options for accessing MySQL data\n\n36 \nSection 1 \nAn introduction to MySQL \nPHP code that retrieves data from MySQL \nFigure 1-17 presents PHP code that t1ses the PDO API to execute a SQL \nstatement against a MySQL database. This code displays information from the \nVendors and Invoices tables. It creates the PDO objects used by the application \nand then uses them to display the data that's retrieved. \nIf you have some PHP programming experience, you shouldn't have much \ntrouble understanding this code. If you don't have PHP experience, that's fine \ntoo. In that case, focus on how this code uses the PDQ API to execute SQL \nagainst a MySQL database. If you want to learn more about using PHP to work \nwith a database, we recommendMitrach's PHP and MySQL. \nThe code in this figure begins by defining a PHP script. Within this script, \nthe first statement stores a SELECT statement in a variable named $query. Then, \nthe next three statements create variables that store the information that's needed \nto connect to a MySQL database named AP that's running on the same computer \nas the PHP application. That includes variables that specify a usemame of \n''ap_tester'' and a password of ''sesame''. \nHere, the same script that created the database also created the ap_tester. \nThis user has limited privileges. In particular, it can only access the AP database, \nnot other databases. In addition, it can only work with the data in the database, \nnot modify the structure of the database. As a result, when writing code, it's \n1nore secure to connect to the database as the ap_tester than to connect as a \nglobal user such as the root user that has all privileges on all databases. \nAfter specifying the connection information, this code uses these variables \nto create a PDO object that represents a connection to the database. If this code \nisn't able to create a PDQ object, an error known as a PDOException occurs, and \nthe application displays an error message and ends. Otherwise, this code uses the \nPDQ object to prepare the SELECT statement. Then, it executes that statement, \ngets all rows from the result set, and stores them in a variable named $rows. \nAt this point, the HTML tags begin displaying an HTML page. Within the \n<body> tag, a PHP script loops through each row in the result set and displays \nthat data on the HTML page. In particular, it displays the vendor_name, \ninvoice_number, and invoice_total columns. Here, the PHP function named \nnumber_format is used to apply formatting to the invoice_total column. \nAlthough this code may seem complicated, there's only one statement in this \nfigure that uses SQL. That's the statement that specifies the SELECT statement \nto be executed. Of course, if an application updates data, it can execute INSERT, \nUPDATE, and DELETE statements as well. With the skills that you'll learn in \nthis book, though, you won't have any trouble coding the SQL statements you \nneed.\n\nCl1apter 1 \nPHP code that retrieves data from MySQL \n<?php \n$query= \nAn introduction to relational databases \n\"SELECT vendor_name, invoice_number, invoice_total! \nFROM vendors INNER JOIN invoices \nON vendors . vendor_ id = invoices.vendor_ id \nWHERE invoice_total >= 500 \nORDER BY vendor_narne, invoice_total \n$dsn = 'mysql:host=localhost;dbname=ap•; \n$username = 'ap_ tester'; \n$password= •sesame•; \ntry { \nfl • , \n$db= new PDO($dsn, $username, $password); \n} catch (PDOException $e) { \n$error_message = $e->getMessage(); \necho $error_message; \nexit(); \n} \n$statement= $db->prepare($query); \n$statement->execute(); \n$rows= $statement->fetchAll(); \n?> \n<!DOCTYPE html> \n<html> \n<head> \n<title>DB Test</title> \n</head> \n<body> \n<hl>Invoices with totals over 500:</hl> \n<?php foreach ($rows as $row) : ?> \n<p> \nVendor: <?php echo $row['vendor_ name']; ?><br/> \nInvoice No: <?php echo $row['invoice_number•]; ?><br/> \nTotal: $<?php echo number_format($row['invoice_total'], 2); ?> \n</p> \n<?php endforeach; ?> \n</body> \n</html> \nNote \n• \nFor this code to run con·ectly with MySQL 8.0 or later, you must be using a \nrecent version of PHP that includes a PDQ driver that supports MySQL 8.0's \nnew default authentication plug-in ( caching_sha2_password), or you must use \nMySQL's older authentication plug-in (mysql_native~password). \nFigure 1-17 \nPHP code that retrieves data from MySQL \n37\n\n38 \nSection 1 \nAn introduction to MySQL \nJava code that retrieves data from MySQL \nFigure 1-18 presents Java code that uses the JDBC API to execute a SQL \nstatement against a MySQL database. This code displays information from the \nVendors and Invoices tables. \nIf you have some Java programming experience, you shouldn't have much \ntrouble understanding this code. If you don't have Java experience, that's fine \ntoo. In that case, focus on how this code uses an API to execute SQL against \na MySQL database. If you want to learn more about using Java to work with \na database, we recommend Murach 's Java Programming and Murach 's Java \nServlets and JSP. \nBefore this code can be executed, a database driver must be installed. To \ndo that, you can download the Connector/I database driver from the MySQL \nwebsite. Then, you can add the JAR file for that driver to the libraries that are \navailable to your application. \nThe code in this figure begins by importing all classes in the java.sql \npackage. These classes define JDBC objects like the Connection object that are \nused to access a MySQL database. \nWithin the main method, the first statement stores a SQL SELECT statement \nin a variable named query. Then, the next three statements create variables that \nstore the information that's needed to connect to a MySQL database named AP \nthat's running on the same computer as the Java application on port 3306. That \nincludes variables that specify a username of ''ap_tester'' and a password of \n''sesame''. \nLike the previous figID·e, the code in this figure connects as the ap_tester \ninstead of the root user for secu1·ity reasons. For more information about the \nap_tester, please refer to the previous figure. \nAfter specifying the connection information, this code uses a \ntry-with-resources statement to create the Connection, PreparedStatement, \nand ResultSet objects that are needed to display the data. Since the try-with-\nresources statement was introduced with Java SE 7, it won't work with earlier \nversions of Java. If this statement isn't able to create these objects, an error \nknown as a SQLException occurs, and the application prints an error message \nand ends. Otherwise, this code uses the Connection and PreparedStatement \nobjects to execute the SELECT statement, and it stores the result set in a \nResultSet object. \nNext, this code uses the get methods of the ResultSet object to retrieve the \nvalues that are stored in the vendor_name, invoice_number, and invoice_total \ncolumns. Here, the getString method is used to get the VARCHAR data and the \ngetDouble 1nethod is used to get tl1e DECIMAL data. Finally, the NumberFormat \nclass is used to apply currency formatting to the invoice_total column, and the \nvalues are printed to the console.\n\nCl1apter 1 \nAn introduction to relational databases \nJava code that retrieves data from MySQL \npackage murach.ap; \n' \nt \n' \n1 * \nimpor Java.sq. ; \nimport java.text.NwnberFormat; \npublic class DBTestApp { \npublic static void main(String args[]) { \n} \n} \nString query \n= \"SELECT vendor_narne, invoice_n,1rnber, invoice_total \" \n+ \"FROM vendors :INNER JO:IN invoices\" \n+\n\" \nON vendors.vendor_ id = invoices.vendor_id\" \n+ \"WHERE invoice_total >= 500\" \n+ \"ORDER BY vendor_name, invoice_total DESC\"; \nString dbUrl = \"jdbc:mysql://localhost:3306/ap\"; \nString username = \n11ap_tester 11 ; \nString password= \"sesame\"; \n// define common JDBC objects \ntry (Connection connection= DriverManager.getConnection( \ndbUrl, username, password); \nPreparedStatement ps = connection.prepareStatement(query); \nResultSet rs= ps.executeQuery()) { \n// Display the results of a SELECT statement \nSystem.out.println(\":Invoices with totals over 500:\\n\"); \nwhile (rs.next()) { \n} \nString vendorName = rs.getString(\"vendor_name\"); \nString invoiceNlimber = rs. getString ( \"invoice_nwnber 11 ) \n; \ndouble invoiceTotal = rs.getDouble(\"invoice_ total\"); \nNwnberFormat currency= NumberFormat.getCurrency:Instance(); \nString invoiceTotalString = currency.format(invoiceTotal); \nSystem.out.println( \n\"Vendor: \n+ \":Invoice No: \n+ \n0 Total: \n\"+ vendorName + \n11 \\n11 \n11 + invoiceNwnber + \n11 \\n\" \n11 \n+ invoiceTotalString + \"\\n\"); \n} catch (SQLException e) { \nSystem.out.println(e.getMessage()); \n} \nDescription \n• \nBefore you can use Java to work with MySQL, you must install a database driver. \nTo do that, you can download the JAR file for the driver and add it to the libraries \nthat are available to your Java application. \n• \nTo execute a SQL statement from a Java application, you can use JDBC objects \nsuch as the Connection, PreparedStatement, and ResultSet objects. \nFigure 1-18 \nJava code that retrieves data from MySQL \n39\n\n40 \nSection 1 \nAn introduction to MySQL \nPerspective \nTo help you understand how SQL is used from an application program, \nthis chapter has introduced you to the hardware and software components \nof a client/server system. It has also described how relational databases are \norganized and how you use some of the SQL statements to work with the data \nin a relational database. With that as background, you're now ready to start \nusing MySQL. In the next chapter, then, you'll leain how to use some of the \ntools for working with a MySQL database. \nTerms \nclient \nserver \ndatabase server \nnetwork \nclient/server system \nlocal area network \n(LAN) \nenterprise system \nwide area network \n(WAN) \ndatabase management \nsystem (DBMS) \nback end \napplication software \nAPI ( application \n• \nprogralilllling \ninterface) \ndata access API \nJDBC (Java Database \nConnectivity) \nfront end \nSQL (Structured Query \nLanguage) \nquery \nquery results \napplication server \nweb server \nbusiness component \nweb application \nweb service \nweb browser \nthin client \nrelational database \ntable \nrow \ncolumn \nrecord \nfield \ncell \nvalue \nprimary key \ncomposite primary key \nnon-primary key \nunique key \nindex \nforeign key \none-to-many \nrelationship \none-to-one relationship \nmany-to-many \nrel a ti onshi p \nreferential integrity \ndata type \nnull value \ndefault value \nat1to increment column \nentity-relationship \n(ER) diagram \nenhanced entity-\nrelationship (EER) \ndiagram \nrelational database \nmanagement \nsystem (RDBMS) \nSQL dialect \nSQL extension \nopen-source database \ndata manipulation \nlanguage (DML) \ndata definition \nlanguage (DDL) \ndatabase administrator \n(DBA) \nconstraint \nbase table \nresult set \ncalculated value \n• \n• \n]Oln \n• \n• \n• \nmner JOin \nouter join \ncomment \nblock comment \nsingle-line comment \ndatabase driver \nmysqli \nPDO \nADO.NET\n\nHow to use \nMySQL Workbench \nand other development tools \nIn the last chapter, you learned about some of the SQL statements that you can \nuse to work with the data in a relational database. Before you learn the details \nof coding these statements, however, you need to learn how to use MySQL \nWorkbench to enter and execute SQL statements. In addition, you should learn \nhow to use the MySQL Reference manual, and you should at least be familiar \nwith the MySQL Command Line Client. \nAn introduction to MySQL Workbench .............................. 42 \nThe Home page of MySQL Workbench ........................................................ 42 \nHow to open a database connection ............................................................. 44 \nHow to start and stop the database server .................................................... 46 \nHow to navigate through the database objects .............................................. 48 \nHow to view and edit the data for a table ...................................................... 50 \nHow to view and edit the column definitions for a table ............................... 52 \nHow to use MySQL Workbench \nto run SQL statements ......................................................... 54 \nHow to enter and execute a SQL statement ................................................... 54 \nHow to use snippets ....................................................................................... 56 \nHow to handle syntax errors .......................................................................... 58 \nHow to open and save SQL scripts ............................................................... 60 \nHow to enter and execute SQL scripts .......................................................... 62 \nHow to use the MySQL Reference Manual ........................ 64 \nHow to view the mant1al ............................................................................... 64 \nHow to look up information ......................................................................... 64 \nHow to use the MySQL Command Line Client .................. 66 \nHow to start and stop the MySQL Command Line Client ........................... 66 \nHow to use the MySQL Command. Line Client to work \nwith a database ................................................................................................. 68 \nPerspective ........................................................................... 70\n\n42 \nSection 1 \nArz introduction to MySQL \nAn introduction to MySQL Workbench \nMySQL Workbench is a free graphical tool that makes it easy to work with \nMySQL. We recommend using this tool as you work through this book. This \nchapter shows how to work with version 8.0. However, with some minor varia-\ntions, the skills presented in this chapter should work for later versions as well. \nThe Home page of MySQL Workbench \nWhen you start MySQL Workbench, it displays its Home page as shown \nin figure 2-1. This page is divided into three tabs: Welcome, Models, and \nMigration. \nThe MySQL Connections section of the Welcome tab contains links that \nyou can t1se to open a connection to a MySQL server. Then, you can use that \nconnection to code and run SQL statements. By default, this tab contains one \nconnection that allows you to connect as the root user to a MySQL server that's \nrunning on the local computer. In this book, this is the only connection you will \nneed. However, if necessary, you can click the (±) icon to the right of MySQL \nConnections to create other connections. \nThe Welcome tab also contains links to MySQL Workbench documentation, \nblogs, and forums. This book doesn't show how to use these links, but you may \nfind them useft1l, especially after you have learned the basic skills for working \nwith MySQL that are described in this book. \nThe Models tab contains links that let you create a database diagram from \na type of data model known as an BER model. You can also use this tab to open \nexisting BER models or to create new ones. Then, you can work with BER \ndiagrams that correspond with these models. To learn more about this, you can \nread chapter 10. \nYou can return to the Home page by clicking on the tab with the house icon \non it near the top left comer of the Workbench window. In this figure, the Home \ntab is the only tab that's shown, but you'll see some other tabs in the next few \nfigures.\n\nCliapter 2 \nHow to use MySQL Workbench and other develop,nent tools \n43 \nThe Home page of MySQL Workbench \nIii MysQL Workbench \n□ \nX \nFile \nEdit \nView \nDatabase \nTools \nScnpbng \nHelp \nWelcome to MySQL Workbench \nMySQL Workbench is the official graphical user interface {GUI) tool for MySQL It allows you to design, \ncreate and browse your database schemas, work with database objects and insert data as well as \ndesign and run SQL queries to work with stored data. You can also migrate schemas and data from other \ndatabase vendors to your MySQL database. \nBrowse Docun,entation > \nMySQL Connections (±) © \nLocal instance MySQL80 \nroot \nlocalhost3306 \nRead the Blog > \nDiscuss on the Forums > \n~ Filter connections \nDescription \n• \nThe Home page of MySQL Workbench is divided into three tabs displayed at the \nleft side of the window: Welcome, Models, and Migration. \n• \nYou can use the MySQL Connections section of the Welcome tab to start and stop \nthe database server and to code and run SQL statements. \n• \nYou can use the links on the Welcome tab to view the documentation for using \nMySQL Workbench, view the MySQL Workbench blog, and view and join in the \nMySQL Workbench forum. \n• \nYou can use the Models tab to create and work with EER models. \n• \nYou can use the Migration tab to migrate other databases to MySQL and to copy a \ndatabase from one instance of MySQL to another. \n• \nYou can return to the Home page by clicking the tab with the house icon. This tab \nis always displayed in the top left corner of the Workbench window. \nNote \n• \nIn so1ne cases, you'll get an ''Unsupported Operating System'' 1nessage when you \nstart MySQL Workbench. This happens, for example, when you start MySQL \nWorkbench 8.0 on Wmdows 7. If you click the OK button when this message is \ndisplayed, MySQL Workbench should work fine. This is a known bug that should \nbe fixed in a future release of Workbench. \nFigure 2-1 \nThe Home page of MySQL Workbench \nX\n\n44 \nSection 1 \nArz introduction to MySQL \nHow to open a database connection \nBefore you can work with a database, you need to connect to the database \nserver. When you start MySQL Workbench, the MySQL Connections section \ndisplays a list of saved connections. \nBy default, MySQL Workbench has one saved connection in this list. This \nconnection is named ''Local instance MySQL80'', and it connects as the root \nuser to a MySQL server that's running on port 3306 of the local host computer. \n(This assumes that you're using MySQL version 8.0. If you're using another \nversion, the number at the end of the connection name will be different.) \nSince this is what you want when you 're frrst getting started, you typically \nuse this connection to connect to the server. To do that, click the connection and \nenter the password for the root user if you 're prompted for it. If you installed \nMySQL Workbench following the directions in appendix A (Windows) or B \n(macOS), the password for the root user is ''sesame80.\" \nFigure 2-2 shows the dialog box that MySQL Workbench displays to prompt \nfor a password. This dialog box shows that it's attempting to use the root user to \nconnect to a MySQL server running on port 3306 of the local host. In addition \nto entering a password in this dialog box, you can select the ''Save password in \nvault'' option to save the password so you don't have to enter it every time you \nconnect to this server. Then, if you ever want to clear the password from the \nvault, you can right-click the connection, select the Edit Connection item, and \nclick the Clear button. \nIf you need to connect as another user, or if you need to connect to a \nMySQL server running on a different computer, you can use MySQL Workbench \nto edit the connection parameters for a connection. To do that, right-click the \nconnection and select the Edit Connections item. This displays a dialog box \nthat lets you specify the parameters for the connection such as the usemame, \nhostname, and port number. \nIf you want to add a new connection to the Home tab, you can click the ® \nicon to the right of MySQL Connections, enter a name for the connection, and \nspecify the parameters for the connection. Then, this connection appears in the \nlist of connections, and you can click it to use it.\n\nCliapter 2 \nHow to use MySQL Workbench and other develop,nent tools \n45 \nThe dialog box for opening database connections \nMySQL Workbench \nD \nX \nFile \n&!rt \nV.t!!N \nDatabase \nToots \nSonpbng \nHelp \nWelcome to MySQL Workbench \ni1 Connect II' t,Ay'> - [ Servtr \nMySQL Workbench I \ncreate and brows \ndesign and run SQL q --\n\\ \nrT1 \nBrowse Docuri \nMySQL Connections @ © \nLocal instance MySQLSO \nDescription \nroot \nlocalhosn3306 \nPlease enter password for the \nfollowing service: \nService: Mysql~t3306 \nUser: root \nPassword: \nD Save password In vaut \nI OK I \ncance \nallows you to design. \nert data as well as \nas and data from other \nthe Forums> \no. filter connections \n• \nTo connect as the root user to an instance of MySQL that's running on the local \nhost computer, click the stored connection named ''Local instance MySQL80'', and \nenter the password for the root user if prompted. \n• \nTo save the password for a connection so you don't have to enter it every time, \ncheck the ''Save password in vault'' option when you 're prompted fo1· your \npassword. \n• \nTo clear the password from the vault so you are prompted for your password, \nright-click the connection, select the Edit Connection item, click the Clear button \nfor the password, and click the Close button. \n• \nTo edit the connection parameters for a connection, right-click the connection, \nselect the Edit Connection item, enter the connection parameters, and click the \nClose button. This lets you specify the usemame, the host address, the port number, \nand other connection parameters. \n• \nTo add a new connection to the Welcome tab of the Home page, click the (±) icon \nto the right of MySQL Connections, enter the connection pararneters, and click the \nOK button. Then, the connection appears in the list of connections. \nFigure 2-2 \nHow to open a database connection \nX\n\n46 \nSection 1 \nArz introduction to MySQL \nHow to start and stop the database server \nIf you installed MySQL on your computer as described in appendix A \n(Windows) or B (1nacOS), the database server starts automatically when you \nstart your computer. This piece of software is sometimes refe1red to as the \ndatabase service or database engine. It receives SQL statements that are passed \nto it, processes them, and returns the results. \nBefore you can work with a MySQL database, the database server must \nbe started. To check whether the MySQL database server is running on your \ncomputer, you can use the Startup/Shutdown option of MySQL Workbench as \nshown in figure 2-3. Then, if the server isn't already running, you can start it \nby clicking on the Start Server button. When you do that, MySQL Workbench \ndisplays a message that indicates the status of the MySQL server, and it displays \nthe Stop Server button. \nYou may also want to stop the database server from time to time. For \nexample, you can stop the server if you aren't going to be using it and you want \nto free the resources on yotrr compt1ter. Or, you can stop the server if the port \nthat is being used by the MySQL database server conflicts with another program. \nThen, when you want to work with the database server again, you can start it. \nThe easiest way to stop the database server is to use the Stop Server button \nthat's available from the Startup/Shutdown option of the Navigator window \nof MySQL Workbench as described in this figure. When you click this button, \nMySQL Workbench displays a message when the MySQL server has success-\nfully stopped, and it displays the Start Server button. \nWhen you're running the MySQL database server on your own computer \nfor training purposes, you can stop the database server whenever you want. \nHowever, if a database server is running in a production environment, you \nshould make sure that all users are logged off and that no applications are using \nthe database server before you stop it.\n\nCliapter 2 \nHow to use MySQL Workbench and other develop,nent tools \nThe Startup/Shutdown option of MySQL Workbench \nfil MySQL Workbench \nD \n6 \nlocal instance MySOl.80 ,c \nFile \nEdit \nV.t!N \nOueiy \nDatabase \nSeiver \nTools \nScnpbng \nHelp \nMANAGEMtNT \n0 Server Status \n-\n.J. Client Connections \n.J. Users and PrMleoes \n(........-\ne Status and System Variables \n.!i Data Ellport \n.!, Data Import/Restore \nINSTANCE '-\"!I \n0 Startup / Shutdown \nA Server log.s \n/' Options File \nPERFORMANCE \nC Dashboard \n8'J Performance Reports \n€\" Performance Schema Sdup \nAdm,nrrtrman Schemas \nlnformabon \nNo ob)ect selected \nObJed lr.fo \nSes_sron \nConnertlon ~opened. \nLocal nstancr MySQU!O \nStartup / Shutdown MySQL Server \nThe database~ Is sUJlll)ed, To start the Server, use the 'Start Server•button \nThe database server rnstance rs ~= \nSlart Server \nIf you stop the server, neither you nor your appkallons can use the d\"t:abase and al a.rent aimections wl be do5ed • \n2018· 11-01 11: 36: ,;a · WoridJench 'I'll use and slid commands to start/stop thrs rns1ance \n2018·11-01 U:36:48 ·Sever rsn.rnio \nFROM /IJ'4t-E.·21ll5-K.err: \n2018·U-01T18:37:'\\2 o Sysll!m) (MY-013105} [Server C:'frcvarn Fles\\'-1ySQt.'f-1ySQl Server 8.0~',nysqld.exe: Normal srotdom. \n2018-11-01T 18:37:44 o Wal'nl'lgj (MY-O 10909) [Server C: 'f'r.ogram Aes'f,lySQL 'f,1ySQt Server 8,0'bwlynysqld.exe: Faong dooe of \nt!Tead 27 user: 'root', \n201S·l1-0IT18:37:'14 O WarnlnO] (MY-010909} [Server C:'f'raoram Fles't1ySQL'M}'SQl Server 8.0lp,n'mysqld.exe: l'«dnlJ close of \nt!Yead 28 user: 'root'. \n2018·11-01 U :37:50 -Server stop done. \nFROM ANl-1:-2015-K.err: \n20l8·.U-01Tl8:37:'19 0 Syste11) (MY-010910} [Server C:'f'rao,arnFtles'f,1ySQl.'MySQl Server 8.0'p,'fnysqld.e~ S!Mdowncomplete \n(mysqld 8.0. 13) MySQl Comml.nty Server · GPl. \n2018-11-01 11137:52 •ChecldnoseM!f status. .. \n2018·1!-0I U:37:52 • MySQI. ser,er is CIJITently ru-ri,g \n2018-11-01 U:-37:52 • Trying ta aimed ID MySQl ... \n2018·11-0l U:37:52 -Can'taimect ID MySQl ser,er on 'loallost' (10061) {2003) \n2018·11-0l 11:37:52 -~ \nserver rs notnn,fng \n2018-11-01 11:37:52 -Chedcng serve- status ... \n2018-11-0 l 11: 37: 52 • Tryr,o ID connect ID MySQl ... \nRen-esh Status \nClear- Messages \nCopy ID Q:t>oard \nHow to stop and start the database server \n1. Display the Welcome tab of the MySQL Workbench Home page. \n2. Click the connection to the local server. This should connect you to the local \nMySQL server as the root user. If necessary, enter the password for the root user. \n3. In the Navigator window, if necessary, click on the Administration tab. Then, select \nthe Startup/Shutdown option from the Instance category. \n4. Click the Stop Server button to stop the database server. Or, click the Start Server \nbutton to start it. \nDescription \n• \nAfter you install MySQL, the database server usually starts automatically each \nti1ne you start your computer. \n• \nThe database server can also be referred to as the database service or the database \n• \nengine. \n• \nIf you aren't able to use Workbench to start and stop the database server, you may \nneed to edit your connection so it points to the correct instance of MySQL. To do \nthat, right-click the connection on the Welco1ne tab of the Home page, select the \nEdit Connection item, click the System Profile tab, and edit the service name. For \nMySQL 8.0 on Windows, the service name is typically ''MySQL80''. \nFigure 2-3 \nHow to start and stop the database server \nX \n47\n\n48 \nSection 1 \nArz introduction to MySQL \nHow to navigate through the database objects \nAfter you connect to a database server, you can use the Schemas category of \nthe Navigator window to navigate through the database objects in the databases \non the server, as shown in figure 2-4. As you can see, these objects include \ntables, views, stored procedures, and functions. For this chapter, however, you \ncan focus on the tables. Later in this book, you'll learn more about views, stored \nprocedures, and functions. \nIn this figure, I double-clicked the node for the AP database (schema) in the \nSchemas tab of the Navigator window to select it and view the database objects \nit contains (tables, views, stored procedures, and functions). Then, I expanded \nthe Tables node to view all of the tables in the AP database. \nTo work with a node or an object, you can right-click it to display a \ncontext-sensitive menu. Then, you can select a command from that menu. For \nexample, you can right-click the node for the AP database to display a list of \ncommands for working with that database.\n\nCliapter 2 \nHow to use MySQL Workbench and other develop,nent tools \n49 \nThe tables available for the AP database \nII MysQL Workbench \nA \nlocal instance MySOL80 ,c \nFile \nEdit \nV.t!N \nOue,y \no~tabase \nServer \nTools \nScnpbng \nHelp \nSOifM\n~AS _____ \n6~ .. \no e 1 , \nti n \n1 ~ \n1 \nq, I \nF~ter objects \n\"' U ap \n• \nTables \n► Ill oeneralJedger_a,counts \n► El lnvoice_archlve \n► El ,nvoiceJ,ne_ltems \n► ■ Invoices \n► m \ntenns \n► Ii vendor_conracts \n► II vendor.: \nVi~'S \n~ \nStored Procedures \n'al Functions \n► \nel( \n► \nom \n► \nsys \nAdnunlstratJon \nSche_mas \nlnforr-at.on \nffo obJect srlected \n1 \n~ \nJ Lrito 1000rov.'S \n• I '4i, I '<I Q. \nD \nX \n> \nOW...,,. / Ft<ch \nOb,e<t Info \nSecss,on \nDescription \n• \nEach database (or sche,na) provides access to the database objects that are \navailable. These database objects include tables, views, stored procedures, and \nfunctions. \n• \nOn some systems, the Navigator window provides Administration and Schemas \ntabs that you can use to display the Administration and Schemas categories. On \nother systems, the Navigator window displays the Administration category above \nthe Schemas category. \n• \nTo display the databases for the current connection, you can use the Navigator \nwindow to view the Schemas category. \n• \nTo navigate through the database objects for a database, click the arrows to the left \nof each of the nodes in the Navigator window to expand or collapse the node. \n• \nTo work with a node or an object, right-click the node or object and select a \ncommand from the resulting menu. \nFigure 2-4 \nHow to navigate through the database objects\n\n50 \nSection 1 \nArz introduction to MySQL \nHow to view and edit the data for a table \nTo view the data for a table, you can right-click the table name and select the \nSelect Rows - Limit 1000 command. In figure 2-5, for example, I selected this \ncommand for the Invoices table. This displayed the data for the table in a Result \ngrid. In addition, it displayed information about the SELECT statement that was \nused to retrieve the data in the Output tab. \nTo insert, edit, and delete the rows in the table, you can use the buttons at \nthe top of the Result grid. Then, to apply the changes to the table, you can click \nthe Apply button at the bottom of the Result grid. Or, if you want to cancel the \nchanges, you can click the Revert button.\n\nCliapter 2 \nHow to use MySQL Workbench and other develop,nent tools \nThe data for the Invoices table displayed in the Result grid \nResult grid \nII MysQL Workbench \nfl. \nLocal instance MySQL80 x \nFile \nEdit \nView \nQuery \nDatabase \nServer \nTools \nScnp!Jng \nHelp \n~a, ,gator \nSCHEMAS \nQ. ,RI~ obJects \n,, U a p \n• li!;l Tables \nQuayl \nIii.I Q I f !if -Q. \nI \n1 • \nSELECT • FROM ap.invoic_es; \n< \nrn I 1.m1 to 1000 rows \n· 1>() 1 \n□ \n► ii general_ledger_acc_ounJS \nI Reult Grid l L1 t\\. Fi1lel-11o1 .. , I \n11 Edi, ~ Lb .J;> I Bci>o<t/1,nport, \n~ \nJwra,pCol<:cn.tw: u \n► ill] lnvolce_archlve \n► il!l ,nvoice_hne_,tems \nlnVOiee_id \nvendor_id \nlnll0ite _ nu:nber \nlnYOiee _date \nlnvOicr - total \npayment_total \nt_total \nterms_ld \n► 0 lnvolces \n► \n1 \n122 \n989319-457 \n2018-0+-08 \n3813.33 \n3813.33 \n0.00 \n3 \n2018 \n► Ill tenns \n2 \n123 \n26lli32.41 \n2018.o+lO \n40.20 \n40.10 \n0.00 \n3 \n2018 \n► Q vendor_contacts \n3 \n123 \n963253234 \n2018-0+13 \n138.75 \n138.75 \n0.00 \n3 \n2018< \n► El vendor.; \n4 \n123 \n2-000·299.3 \n201.8-0+16 \n144.70 \ni+l.70 \n0.00 \n3 \n2018< \nVi~ \n5 \n123 \n963253251 \n2018-0+16 \n15.50 \n15.50 \n0.00 \n3 \n2018< \n~ \nStored Procedures \n6 \n123 \n963253261 \n2018-0+16 \n'1275 \n42.75 \no.oo \n3 \n2018< \n~ \nFunctions \n7 \n123 \n9632532.37 \n201.8-04-21 \nin.so \nin.so \n0.00 \n3 \n2018-C \n► \nex \n8 \n89 \n125520-1 \n2018-0+2'1 \n95.00 \n95.00 \no.oo \n1 \n2018< \n► \nom \n9 \n121 \n97/488 \n2018-04-24 \n601.95 \n601.95 \no.oo \n3 \n2018< \n► \nsys \n< \nAdm,mstrabon \nSchenas \n,nvolces 2 x \nO'l)C. \n\" \nijl .Action Output \nX \nForni \nEder \nTable: invoices \nColumns: \njnyojcc id \nn t( 11) Al Fl< \n() \n1 11 48:53 SELECT • FROM ap .n1101ees LIMIT 0. 1000 \nOumion / F.ttt, \n0.000 sec / 0 000 sec \nvendor_id \n1nt{ll) \nnv01a_~ \n,archN(5::) \n~~tt,ttc \n~(i,2) \n~~~ta =~t~ \nObject ls>fo \nSession \nDescription \n• \nTo view the data for a table, right-click the table in the Navigator window and \nselect the Select Rows - Limit 1000 comn1and to display it in a Result grid. \n• \nTo edit the data for a table, view the data. Then, you can use the buttons at the top \nof the Result grid to insert, update, and delete rows. \n• \nTo apply the changes to the table, click the Apply button at the bottom of the tab. \nTo cancel the changes, click the Revert button. \nFigure 2-5 \nHow to view and edit the data for a table \n51\n\n52 \nSection 1 \nArz introduction to MySQL \nHow to view and edit the column definitions \nfor a table \nIf you want to edit a column definition for a table, you can use the technique \ndescribed in figure 2-6 to display the column definitions for the table. In this \nfigure, for example, the column definitions for the Vendors table are displayed. \nAt this point, you can view information about each column of the table such as \nits name and data type. \nOnce you display the column definitions for a table, you can use the \nColumns tab to add a column, delete a column, or modify a column. For \nexample, you can add a new column by entering it at the bottom of the list. You \ncan delete a column by right-clicking on it and selecting the Delete command. \nYou can change the name of a column by selecting the column and then clicking \non the name and editing it. You can change the data type of a column by \nselecting the column and then clicking on its data type and selecting another data \ntype from the drop-down list that appears. And so on. \nMost of the time, you won't want to use MySQL Workbench to edit the \ncolumn definitions for a table. Instead, you'll want to edit the scripts that create \nthe database so you can easily recreate the database later. In chapter 11, you'll \nlearn more about creating and modifying the column definitions for a table using \nboth techniques.\n\nCliapter 2 \nHow to use MySQL Workbench and other develop,nent tools \nThe column definitions for the Vendors table \n8 MySQL Workbench \n6 \nLocal insmnce MySQLSO X \nFile \nEdit \nVif!!N \nQuery \nDatabase \nSenter \nTools \nScnptmo \nHelp \nQue,y1 \nSCHEMAS \nTable Name: lvendc.-s \nJ Sdtema: ap \nq, I \nRI~ ob)ects \nT .J ap \nOwset/Colation: \nutfBni>'l \n-\nv j utf8mb'1_0900_ v \nEngine: \nlmo06 \nT'cl Tables \n► \ngeneral_ledger_accounts \n► \nfnvo1ce_archlve \n► \nmvoice_lme_iteJT'6 \n► \nInvokes \n► \nte_rms \n► II vendor_contacts \nT \nvendors \n►[;:) Co lumns \n► \nInd!!RS \n► ~ \nFore:ion Keys \n► \nTriggers \nViews \nstorNI Procedures \n'i!5J Functions \n► \nex \n► \nom \n► \nsys \nAdministration ~as \n• for, \nuo \nTable: vendors \nColumns: \nlnt(ll) \nAIPK \nvardia \nva<cha \nvarcha \nvar cha \nchar(2: \nComments: \nCoumName \nvendor_id \nvendor_name \nJ vendor _addressl \n; vie_ndor _address2 \nvendor_dty \nvendor_sta2 \nvendor_zip_codt \nvendor_phone \nvendor_contact_last_name \nvie_ndor _contact_firsLname \n~ ddault_terms_id \n~ ddauft_account_number \n< \nColum Name.: \nCharset/Cola6on: \nComments: \nDatatype \nINT(U) \nVARCHAA(SO} \nVAACHAA(SO) \nVARCHAA(SO) \nVAACHAA(SO} \nCHAR{2) \nVARCHAA(20) \nVARCHAA(SO) \nVARCHAR(SO) \nVARCHAA(SO} \n!Nl{l 1) \n!Nl{U) \nPK \nl'-N \nUQ \nB \n~ lF \n0 \n0 D D D D \nD \nE2l \nE2I D D D \nD D D D D D \n□ D □ D D □ \n□ E2I \n□ □ □ □ \n□ E2I \n□ □ D □ \n□ 0 \n□ D D □ \n□ D D D D □ \nD D □ □ D □ \n□ D D □ D □ \n□ E2I \n□ □ D □ \n□ E2I \n□ D D □ \nData Type: \nDefalJt: \nStarage: \nVirtual \nPrimary Key \nBnarv \nAutolncr~t \nvendor id \nvendor_naml! \nveocb _address! \nvendor _address2 \nvendc<_oty \nvendor _state \nvendor _zlp_code \nvendor _phone \nVatchll \nvarcha \nColu111ns \nIndexes \nForeign Keys \nTrfggers \nPartitioning \nOptions \nvarcha v \nAl \nE2l \nD \nD \nD \nD \nD \nD \n□ \nD \nD \nD \nD \n□ \nV \n.. \nG \nOefault,bilresslon \nD \nD \nD \nD \nD \n□ \n□ \nD \nD \nD \nD \nD \nSto,-ed \nNULL \nNULL \nNULL \nNULL \nNULL \nNotl'd \nUrtqie \nu~ \naroMlf \n> \nven<!or _contact_l!9!l'l_name \nObject Info \nSession \nApply \nRevert \nDescription \n• \nTo view the column definitions for a table, right-click the table name in the \nNavigator window and select the Alter Table command. Then, select the Columns \ntab at the bottom of the window that's displayed to view the column definitions for \nthe table. \n• \nTo edit the column definitions for a table, view the column definitions. Then, you \ncan t1se the resulting window to add new columns and modify and delete existing \ncolumns. \n• \nFor more information about creating and modifying tables, see chapter 11. \nFigure 2-6 \nHow to view and edit the column definitions \nX \nV \n53\n\n54 \nSection 1 \nArz introduction to MySQL \nHow to use MySQL Workbench \nto run SQL staten,ents \nBesides letting you review the design of a database, MySQL Workbench is a \ngreat tool for entering and running SQL statements. \nHow to enter and execute a SQL statement \nWhen you first connect to a MySQL server in MySQL Workbench, a SQL \nEditor tab is automatically opened. Figure 2-7 shows how to use the SQL editor \nto enter and execute a SQL statement. The easiest way to open a SQL Editor tab \nis to click the Create New SQL Tab button in the SQL Editor toolbar or p1·ess the \nCtrl+ T keys. \nOnce you open a SQL tab, you can use standard techniques to enter or edit a \nSQL statement. As you enter statements, you'll notice that MySQL Workbench \nautomatically applies colors to various elements. For example, it displays \nkeywords in blue. This makes your state1nents easier to read and understand and \ncan help you identify coding en·ors. \nTo execute a single SQL statement like the one in this figure, you can press \nCtrl+Enter or click the Execute Current Statement button in the SQL Editor \ntoolbar. If the statement returns data, that data is displayed below the SQL editor \nin a corresponding Result grid. In this figure, for example, the result set returned \nby the SELECT statement is displayed. If necessary, you can adjust the height \nof the Result grid by dragging the bar that separates the SQL Editor tab from the \nResult grid. \nBefore you execute a SQL statement, make sure you've selected a database \nby double-clicking the database in the Navigator window. Otherwise, you'll get \nan error message like this: \nError Code: 1046. No database selected \nSimilarly, if you haven't selected the co1Tect database, you'll get an error \nmessage that says the table doesn't exist. For exan1ple, if the EX database is \nselected when you attempt to retrieve data from the Vendors table, you' 11 get an \nerror message like this: \nError Code: 1146. Table •ex.vendors' doesn't exist \nTo fix this, you can double-click the AP database to select it.\n\nCliapter 2 \nHow to use MySQL Workbench and other develop,nent tools \nA SELECT statement and its results \nCreate New \nSQL Tab button \n11 M \norkbench \n6 \n/ wcat tns:tance MySQL.80 X \nExecute Current \nStatement button \nFile 1 -1 V!e'N \nQuery \nDatabase \nSaver \nT oals \nSc · · no \nHelp \nQuery 1 \nX \nSQL \neditor \nSCHEMAS \n~ I \nFil~ ob]l!CIS \n,, J ap \nu .,,. \nl\"'\"'I \nUmil to 100(hows \n• I 1-9 I ~ Q. l1l ~ \n• \nTables \n► Ell 9enual_led9l!l'_accounts \n► iJ invoice_archlve \n► El lnvoice_ll~_,t,ms \n► ii Invoices \n► \nterms \n► el ve.ndor_contacts \n\" El vendors \n► t-1 Columns \n► \nIndexes \n► \nForeigo Keys \n►~Triggers \nVi~ \n'al Stored Procedures \n!?Ii Funrtlnn~ \nAdml11istrallon Sch~as \nll'form.won \nTable: vendors \nColumns: \nvernlor ld \nvendor_name \nvendor _addressl \nvendor _address2 \nvt'fldor -dty \nvendor _state \n... \nlnl{I I) \nAlPK \nvard,a \nvarcha \nvarc:ha \nvarcha \ndiar(2 \"' \nl • \nSELECT vendor_naee, vendor_city, vendor_state \n2 \nFR0'-1 vendors \n3 \nORDER 8Y ve ndor_nam~ \n< \nvendor_name \n► \nAbbev 0~ F\\lnlsmgs \nAmencan Booksde's Assoc \nAmerican Elqlress \nASC~ \nAscom Hasler Maino Systems \nAT&T \nAztekl.cbel \nBaker & Taylor Books \nBertelsmam indus1Jy Svcs. Inc \n6fl tndUstrles \nBil Jon6 \nBil Marvn Electnc Inc \nBlanchartf & Johnson Associates \nBkietross \nBlue Shield of California \nBouche,- Cwmncabons Inc \nearners Pub\\shino ~v \nCal State Termite \nvendor_dty \nFresno \nTarrytown \nvendor _state \nCA \nNY \nLos Angdes \nCA \nFresno \nSheltot'I \nPhoenix \nAnahesn \nOwtotte \nValenoa \nFresno \nCA \nCT \nA1. \nCA \nNC \nCA \nCA \nSacrament!> \nCA \nFresno \nCA \nMssion Viejo \nCA \n())cnard \nCA \nMahe.Tl \nCA \nFortWashi... PA \nTuel.ala! \nm \nSelma \nCA \nFresno \nCA \nResult \ngrid \nD \nX \n□ \n... \n\"' \nFeld \nTvi-\n> \nObJect Info \nSession \nCalifumia Business Machines \nvendors 1 >< \n0 ReadOnly \nDescription \n• \nTo open a new SQL tab, press Ctrl+T or click the Create New SQL Tab button ( \n) \nin the SQL Editor toolbar. \n• \nTo select the current database, double-click it in the Schemas tab of the Navigator \nwindow. This displays the selected database in bold. \n• \nTo enter a SQL statement, type it into the SQL editor. \n• \nAs you enter the text for a statement, the SQL editor applies color to various \nelements, such as SQL keywords, to make them easy to identify. \n• \nTo execute a SQL statement, press Ctrl+Enter or click the Execute Current \nStatement button ({if) in the SQL Editor toolbar. If the statement retrieves data, the \ndata is displayed in a Result grid below the SQL tab. \nFigure 2-7 \nHow to enter and execute a SOL statement \n55\n\n56 \nSection 1 \nArz introduction to MySQL \nHow to use snippets \nYou can think of the srzippets that come with MySQL Workbench as a \nlibrary of SQL syntax. This library is divided into statements that you can use \nto manage a database, define objects in a database, and manipulate the data in \na database. You can also create your own snippets that provide custom code. \nIn fact, you're more likely to create your own snippets than you are to use \nthe built-in snippets. That's because the syntax that's provided for the bt1ilt-in \nsnippets is much more complex than what you typically need. \nFigure 2-8 shows how to use snippets. To start, if the SQL Additions window \nisn't displayed, you can display it by clicking on the rightmost button at the 1ight \nside of the SQL Editor tab. Then, you can display the snippets tab and use the \ndrop-down list at the top of the tab to select a category of snippets. In this figUI·e, \nfor example, the My Snippets category is displayed. From here, you can select a \nsnippet and then click the Insert Snippet button to enter the snippet into the SQL \nEditor tab. Finally, you can edit the snippet code so it's appropriate for your SQL \nstatement. \nIn this figure, the snippet contains code that I wrote for joining the vendors, \ninvoices, and invoice_line_items tables. To create this snippet, I entered it into \na SQL Editor tab and then clicked the Add New Snippet button. By saving this \nstatement as a snippet, I can now use it anytime I want to join these tru·ee tables \ninstead of having to type it each time. \nFor now, don't wo1Ty if you don't understand the SQL statement p1·esented \nin this figure. The main point is that you can use the Snippets tab to save and \nretrieve a variety of SQL code. As you learn more about SQL statements, you'll \nsee how useful this can be.\n\nCliapter 2 \nHow to use MySQL Workbench and other develop,nent tools \n57 \nThe SQL Additions tab with a snippet created by a user \n■ \nMysQL Workbench \nA \nLocal instance MySQLSO x \nFile \nEdit \nView \nQuery \nDatabase \nServer \nTools \nScnptmg \nHelp \nq_ 11,ter objects \n• @ ap \n►~Tables \nV,ev.-s \n'5l Stored Procedures \n'al Functions \n► \nex \n► \nom \n► \nsys \nDescription \nSQl ~dd1i:Jons \nQ Q I f' W ~ I~ I \nlmlto 1000rows \n• I ..(> I My~s \n1 ♦ \nSELECT a \n2 \nfRCf'I vendor-s v \n3 \nJOIII invoices i \n4 \nOIi v. vendor id % i. vendor id \n-\n-\n5 \nJOill invoice_line_iteflls li \n6 \nOH i. invoice id = li. invoice id \n-\n-\n0 \nX \n• \nThe SQL Additions window contains context help and snippets. Snippets contain \nthe syntax for many common SQL statements. You can use the snippets to guide \nyou as you create a SQL statement. You can also create your own snippets and save \nthem for later use. \n• \nThe SQL Additions window is displayed to the right of the SQL Editor tab by \ndefault. If this window isn't displayed, you can display it by clicking the rightmost \nbutton (□) at the right side of the SQL Editor toolbar. Then, you can click the \nSnippets tab to display the available snippets. \n• \nThe snippets are organized into categories. To display any category of snippets, \nselect the category from the drop-down list at the top of the Snippets tab. \n• \nTo enter a snippet into a SQL editor, select the snippet and then click the Insert \nSnippet button (~\nat the top of the Snippets tab. Then, edit the snippet code so it's \nappropriate for your SQL statement. \n• \nTo replace code in the SQL editor with a snippet, select the code, select the snippet \nyou want to replace it with, and then click the Replace Current Text button ( ~ ). \n• \nTo create your own snippet, enter the code for the snippet into a SQL editor tab. \nThen, select the category where you want to save the snippet, click the Save \nSnippet button ( 1-¢) in the SQL Editor toolbar, and enter a name for the snippet. \n• \nTo delete a snippet, right-click it in the Snippets tab and select the Delete Snippet \nitem. \nFigure 2-8 \nHow to use the Snippets tab\n\n58 \nSection 1 \nArz introduction to MySQL \nHow to handle syntax errors \nIf an error occurs during the execution of a SQL statement, MySQL \nWorkbench displays a message that includes the error numbe1· and a brief \ndescription of the error. In figure 2-9, for example, the message displays an error \nnumber of 1146 and a brief description that says ''Table ap.vendor doesn't exist.\" \nIn this example, the problem is that the Vendor table doesn't exist in the \ndatabase. To fix the problem, you need to edit the SQL statement so the table is \nVendors instead of Vendor. Then, you should be able to successfully run the SQL \nstatement. \nThis figure also lists some other common causes of errors. As you can see, \nmost e1Tors are caused by incorrect syntax. However, it's also common to get an \nerror if you have selected the wrong database. If, for example, you have selected \nthe EX database and you try to run a statement that refers to tables in the AP \ndatabase, you will get an error. Regardless of what's causing the problem, you \ncan usually identify and correct the problem without much trouble. In some \ncases, though, it may be diffict1lt to figure out the cause of an error. Then, you \ncan usually get more information about the error by searching the Internet or by \nsearching the MySQL Reference Manual as described later in this chapter.\n\nCliapter 2 \nHow to use MySQL Workbench and other develop,nent tools \nHow to handle syntax errors \niJ MySQL Workbench \nD \nX \n4i-\nLocal inslance MySOl.80 X \nFile \n&lit v,_ 0uef)' \nOatabas-e \nServer \nTools \nScnpb119 \nHelp \niil'Hi1 _________________________ _ \nSCKEMAS \nc;i Q I ~ lll' fl \nI~ I \nQ I Lmit to 1000rows \n• I \nq_ [niter obJeds \ny § ap \n1 • \nSE~ECT vendor_name, vendor_city, vendor_shrte \n2 \nFR0'1 vendor \nT \nTables \n3 \nORDER BV vendor _nam~ \n► II Qeneral_ledger_accounts \n► II lnvolce_archlve \n► II lnvolce:_line:_ltems \n► \nInvoices \n► II terms \n► 8 ve:ndor_contacls \n► \nvendors \nViews \n'rJl Stored Procedures \ni;ai Funcbons \n► \nex \n► \nom \n► \nsys \nAdministration \nSchemas \nTable: vendors \nColumns: \nvendor id \nvendor_name \nvendor llddress l \nvendor -address2 \nvendof =dty \nvendor _state \nObJe:ct Info \nSession \n< \n014)1 \n,. \n[jl .Action Outpt.d \nIt \nrrM \n.1,aion \nMltSH9\" \nOurmon I Fttcl\\ \nll'lt,U) \nO \n1 12.19:45 SELECT vendor_name. vendor_cty. vend«_slal... &rorCode: 1146 Table 'ap.vendor' doesn\\ eiosl \n0.000 sec \nAJPK \nvarcha \nv11rd'la \nvarcha \n~archa \nchar(! .., \nCommon causes of errors \n• \nHaving the wrong database selected \n• \nMisspelling the name of a table or column \n• \nMisspelling a keyword \n• \nOmitting the closing quotation mark for a character string \nDescription \n• \nIf an error occurs during the execution of a SQL statement, MySQL Workbench \ndisplays a message in the Output tab that includes an error code and a brief descrip-\ntion of the error. \n• \nMost errors are caused by incorrect syntax and can be corrected without any \nadditional assistance. Otherwise, you can usually get more information about \nan error by searching for the error code or description in the MySQL Reference \nManual or on the Internet. \nFigure 2-9 \nHow to handle syntax errors \n> \n59\n\n60 \nSection 1 \nArz introduction to MySQL \nHow to open and save SQL scripts \nIn MySQL, a script is a file that contains one or more SQL statements. To \ncreate a script, you enter the state1nents you want it to include into a SQL Editor \ntab. You '11 learn more about that in the next figure. Then, you can click the Save \nbutton or press Ctrl+S to save the script as described in figure 2-10. \nOnce you've saved a script, you can open it later. To do that, you can click \nthe Open SQL Script File button in the SQL Editor toolbar, or you can press \nCtrl+Shift+O. In this figure, the dialog box that's displayed shows the script files \nthat have been saved for chapter 2. These files are created when you download \nand install the source code for this book. Note that the names of these files have \nthe .sql extension. (If you're using Windows 10 and the file extensions aren't \ndisplayed, you can display them by opening the File Explorer, displaying the \nView tab, and selecting the ''File name extensions'' option in the Show/hide \ngroup.) \nOnce you open a script, you can run it as shown in the next figure. You can \nalso t1se it as the basis for a new SQL script. To do that, just modify it any way \nyou want. Then, you can save it as a new script by pressing the Ctrl+Shift+S \nkeys or selecting the File➔ Save Script As command. \nThe screen in this figure shows the tabs for two script files that have been \nopened. After you open two or more scripts, you can switch between them by \nclicking on the appropriate tab. Then, you can cut, copy, and paste code from \none script to another.\n\nCliapter 2 \nHow to use MySQL Workbench and other develop,nent tools \nThe Open SQL Script dialog box \nOpen SQL Script \nFile button \nD \nX \n._....., ms_tance MySQL.80 X \nv~N \nQue,y \nDatabase \nServer \nTools \nScriJ>lino \nHelp \navu;ator \nSOifMAS \nq, I \nF\\ltl!r ob)«ts \n\" J ap \n\" \nTables \n► II 9eneral_led9er_accounts \nI \nQuery 1 \nselect_ ~endor _mb rna!Jon \nI Limll to 1000 rows \nJ • \nSELECT vendor_natie, vcndor_city, vendor_strte \n2 \nfRc»1 vendors \n3 \nORDER BY vendor name; \n► Ill invoice_archlve \n► EJ lnvolce_llne_ltern, \n► Ii) Invoices \n► II terms \n► Iii vendor _contacts \n► iJ vendors \nVlews \nOpen SQl Scnpt \n~ \nv 't \n« book_scripts > ch02 \nOrganize T \nNew folder \nv \n~ \nSearch chil2 \nX \n.P \n[I 0 \nA \n1!,. Windows (C:) \nExamView \ninetpub \nLogs \nmurach \n\" \nName \nDate modified \nTyp \ntai Stored Procedures \n,:jl Functions \n► \nex \n► \nom \nselect_vendor_city_state.sql \nselect_vendor_inform8tion.sql \nsel«t_ vendor_tot11l_due.sql \n12/19'2014 9:52 AM \n12/29/2014 9:52 AM \nll/29/201.49:52 At,1 \nSQl \n► \nsys \nAdmlnistnllon Scb=as \nlniorrnat ~n \nTable: vendors \nColumns: \nvendor 1d \n< \nCn.'!pUt \n... \no1I Adlon Ouu:,ut \nmysql \nPerflogs \nProgram Files \nProgram Files (x86) \nSWSmp \nV \n( \nFile name: I select_vendor_total_due.sql \nV \nvcndor_namc \nve-m addressl \nvendor -addrcss2 \nvendor: city \nvendor _state \nObJect: Info \nSession \nW'lt{l l) \nAlPK \nvarcha \nvarcha \nvartha \nvard'la \ndw(2 V \nv J \nSQl Files (°.sql) \nOpen \nCancel \n] \nDescription \n• \nA SQL script is a ftle that contains one or more SQL statements. \n• \nTo open a file that contains a SQL script, click the Open SQL Script File button in \nthe SQL Editor toolbar or press the Ctrl+Shift+O keys. Then, use the Open SQL \nScript dialog box to locate and open the SQL script. \n• \nWhen you open a SQL script, MySQL Workbench displays it in its own SQL \nEditor tab. To switch between open scripts, select the appropriate tab. \n• \nTo cut, copy, and paste code from one SQL script to another, use the standard \ntechniques. \n• \nTo save a SQL statement to a script file, click the Save btttton in the SQL Editor \ntoolbar or press Ctrl+S. Then, use the Save SQL Script dialog box to specify a \nlocation and name for the file. \n• \nTo save a script you've modified to a new file, press the Ctrl+Shift+S keys or select \nthe File➔Save Script As command. \nFigure 2-1 O \nHow to open and save SQL scripts \n61\n\n62 \nSection 1 \nArz introduction to MySQL \nHow to enter and execute SQL scripts \nIn the last topic, you saw a SQL script that contained a single SQL state-\nment. However, a SQL sc1ipt typically contains multiple statements. Figure 2-11 \nshows how to enter and execute scripts like that. \nWhen you code multiple SQL statements within a script, you must code a \nsemicolon at the end of each statement. For example, this figure shows a script \nthat contains two SELECT statements. To execute both of these statements, you \ncan press the Ctrl+Shift+Enter keys, or you can click the Execute SQL Script \nbutton in the SQL Editor toolbar. When you do, the results of each script are \ndisplayed in a separate Result g1·id. To switch between Result grids, you can \nclick on the tabs that are displayed below the current Result grid. \nIf you want to execute a single SQL statement that's stored within a script, \nyou can do that by moving the insertion point into the statement and pressing the \nCtrl+Enter keys or clicking the Execute Current Statement button. Then, if the \nstatement retrieves data, the data is displayed in a single Result grid. \nIf you need to, you can also execute two or more statements in a script. To \ndo that, you select the statements and then press the Ctrl+Shift+Enter keys or \nclick the Execute SQL Script button. This is useful if a script contains many \nstatements and you just want to execute some of them.\n\nCliapter 2 \nHow to use MySQL Workbench and other develop,nent tools \nA SQL script and its results \nExecute SOL \nScript button \n■ \nMySQL Workbench \n6 \nlocal ins!ance MySQLBO x \nFile \nEdit \n1/,e,, \nQue,y \nDatabffe \nServer \nTools \nNaV19atOC\" \nSCHEMAS \n~ I ~to 1000rows \n• I ~ I \n0.. Llli L!!J \nq_ IAl:rr ~1$ \nT J ap \n1 • \nSELECT vendor_name, vendor_city \n2 \nFR<Y-1 vendors \nT \nTables \n► II gcneral_ledger_accounts \n► 6J lnvoice_archlve \n► \ninvoiu_line_items \n3 \nl,lfERE vendor_id: \n; \n4 \n5 • \nSELECT COUttT(*) AS number_of_invoices, \n6 \nSUM(invoice_total - payment_total - credit_total) AS total_due \n7 \nFRCJ1 invoices \n► \nInvoice \n► II terms \n8 \ni..HERE vendor id= \n; \n► El vendor_contacts \n< \nD \nX \n> \n► C vcndo3 \n-\nVitv,'S \nI Result Grid \nJJ t'\\ F.l.r Row11 ~I---~' f>ll>o<t: Eg I w~ eel c.ontent: IA \n□ \n1211 Stored Procedures \n'al fundions \n► \ne,,. \n► \nom \n► \nsys \nAaminls~on Schemas \nTable: vetdors \nColumns: \nvendor id \nvendor name \nvendor address 1 \nvendor :address2 \nvendor_oty \nvendor _state \nObJect Info \nSession \nDescription \nI \nvendor_~ \nvendcr_oty \n► \nIBM \nSanfraooscx> \nvendors 1 x \nResult 2 \n.Jutp..l \n,., \nC, Action Ou!pul \nnt(Ul \nAIPK \nvarcha \nVill'a>a \nvard,a \nvl!\"tha \nchar(Z: .., \n• \nTun• \nAction \nMHD;i• \n0 \n1 12.53.11 SELECT vendor_narne. vendol'_c:iy FROM VEn... 1 row~) retuned \n0 \n2 12:53.11 SELECTCOUNTOASrunber_of_lnvoices, \n.. \nlrow(s)rllh.med \n0 Reac!Orly \no.mmn I Foteh \n0.000 sec / 0.000 sec: \n0.000 sec/ OJ)OO sec \n• \nWhen you code a script that contains more than one statement, you must code a \nsemicolon at the end of each statement. \n• \nTo run an entire SQL script, press the Ctrl+Shift+Enter keys or click the Execute \nSQL Script button ('I ) that's located just to the left of the Execute Current \nStatement button in the SQL Editor toolbar. \n• \nWhen you run a SQL script, the results of each statement that returns data are \ndisplayed in a separate Result grid. To switch between these Result grids, you can \nclick on the tabs that are displayed below the current Result grid. \n• \nTo execute one SQL statement within a script, move the insertion point into that \nstatement and press the Ctrl + Enter keys or click the Execute Current Statement \nbutton ( fi). If the statement retrieves data, the data is displayed in a Result grid. \n• \nTo execute two or more statements within a script, select them in the editor and \nthen press the Ctrl+Shift+Enter keys or click the Execute SQL Script button. \nFigure 2-11 \nHow to enter and execute SQL scripts \n63\n\n64 \nSection 1 \nArz introduction to MySQL \nHow to use the MySQL Reference \nManual \nFigure 2-12 shows how to use another useful tool for working with the \nMySQL database: the MySQL Reference Manual. In most cases, you'll use \na web browser to view this manual directly from the Internet. That way, you \ncan be sure that the information is always up-to-date. However, you can also \ndownload this manual and save it on your hard drive. Either way, you can use \nthe MySQL Reference Manual to quickly look up detailed technical information \nabout the MySQL database, including information about SQL statements and \nfunctions. \nHow to view the manual \nYou can view the MySQL Reference Manual by using a web browser to go \nto the web address shown at the top of this figure. Here, the Reference Manual \nfor version 8.0 of MySQL is displayed. However, you can easily select another \nversion by selecting it from the drop-down list at the right side of the page. \nHow to look up information \nOnce you've navigated to the correct ve1·sion of the MySQL Reference \nManual, it's easy to look up information. To do that, you can use the links in \nthe left sidebar to drill down to the information that you're looking for. When \nyou find the topic you want, you can click it to display it in the main part of the \nwindow. Then, if you want to navigate back up the hierarchy of information, \nyou can use the breadcrumb links ac1·oss the top of the page. In this figure, fo1· \nexample, you can click the ''MySQL 8.0 Reference Manual'' link to return to the \nHorne page for the manual. Or, you can click the ''General Information'' link to \nnavigate to that page. \nAnother easy way to look up information is to search for a specific word or \nphrase. To do that, type the word or phrase in the ''Search this Ma11ual'' text box \nlocated at the top of the sidebar and click the Search icon or press the Enter key. \nThen, you can click the links in the search results to view infor1nation about the \nsearch terms.\n\nCliapter 2 \nHow to use MySQL Workbench and other develop,nent tools \nThe web address for the MySQL 8.0 Reference Manual \nhttps://dev.rrwsgl.com/doc/refman/8.0/en/ \nA web page from the MySQL Reference Manual \nB MySQL MySQL 8.0 'le!erence \n)( \n+ \nD \nC \ni \nhnps dev.mysql.com oc/refman/8.0/en/manual-1nfo.html \n* e \n= \nThe v10rld s most popula Of)\"'JI source database 0. \nContact MySQL I Login I Register \nMyS~ . \nMYSQL.COM \nOOWNLO.-\\DS \nDOCUMENTATION \nDEVELO?ER ZOl~E \nQ. \nA Documentation Home \nMySQL 8.0 Reference Manual \nPreface and Legal Notices \n., General Information \nAbout This Manual \nTypographical and Syntax Convenoons \n> overview of the MY5QL Database \nManagement System \n• What Is New In MySQL 8.0 \n• Server and Status vanables and \nopoons Added, Deprecated, or \nRem011ed jr) MY5QL 8.0 \nDescription \nMySQL 8.0 Reference Manual I General lnformaOOl'I I About Ths Manua \nversion 8.0 \n¥ \n1.1 About This Manual \nThis 1s the Reference Manual for the MySQL Database System, version 8.0, \nthrough release 8.0.15. Differences between minor versions of MySQL 8.0 are \nnoted In the present text with reference to release numbers (8.0. x). For license \n1nformatlon, see the Legal Notices . \nThis manual Is not intended for use with older versions of the MySQL software \ndue to the many functional and other differences between MY5QL 8.0 and \nprevious versions. If you are using an earlier release of the MySQL software, \nplease refer to the appropnate manual. For example, MY5QL 5. 7 Reference \nMonuol covers the S.7 senes of MySQL software releases . \nBecause this manual serves as a reference, It does not provide general \n• \nTo view the MySQL Reference Manual, go to the MySQL website and select the \ncorrect version of the manual. The web address for MySQL 8.0 is shown above. \n• \nTo view a chapter, click the link for the chapter in the table of contents on the right \nside of the page. \n• \nTo return to the Home page for the manual, click the Start icon ( \nthat's displayed at the top of the left sidebar. \nfor the manual \n• \nTo search for a particular word or plu·ase, type the word or phrase in the ''Search \nthis Manual'' text box in the left sidebar and click the Search icon or press the \nEnter key. Then, you can scroll through the results and click links to get more \ninformation. \n• \nYou can also download the MySQL Reference Manual. However, it typically makes \nsense to use it online. \nFigure 2-12 \nHow to use the MySQL Reference Manual \n65\n\n66 \nSection 1 \nArz introduction to MySQL \nHow to use the MySQL Co111111and Line \nClient \nBefore MySQL Workbench was available, programmers used a \ncommand-line tool known as the MySQL Command Line Client to connect \nto a MySQL server and work with it. This tool is also known as the MySQL \ncommand line. Although you may never need this tool, you shot1ld at least \nbe aware that it exists. This tool comes with MySQL, and it can be useful if \nMySQL Workbench isn't installed on the system that you're using. \nHow to start and stop the MySQL Command Line \nClient \nFigure 2-13 shows how to start and stop the MySQL Command Line Client \nin Windows. Although this figure shows the Command Prompt window that's \navailable from Windows, you can use the MySQL Command Line Client on \nother operating systems too. In particular, on macOS, you can use the Terminal \nwindow to start the MySQL Command Line Client. \nWhen you use Windows, there's an easy way to start the MySQL Command \nLine Client if you want to log in as the root user for the database server that's \nrunning on the local computer. To do that, you just select the MySQL Command \nLine Client command from the Start menu. Then, MySQL will prompt you for \na password. If you enter the password correctly, you will be logged on to the \ndatabase server as the root user. \nIn some cases, you'll need to use a command line to start the MySQL \nCommand Line Client instead of using the Start menu. For example, you may \nneed to do that if you want to log into a database that's running on a different \ncomputer, if you want to log in as a user other than the root user, or if you 're \nusing another operating system such as macOS. In those cases, you can open \na command line and change the directory to the bin dil·ectory for the MySQL \ninstallation. Then, you can execute the mysql command and supply the param-\neters that are needed to connect to the database server. \nIf the MySQL server is located on a remote computer, you can specify \n-h, followed by the host name of the computer, and -u, followed by a valid \nusername. In addition, you specify -p so MySQL prompts you for a valid \npassword. Although it can take some experimentation to get these connection \nparameters right, you only need to figure this out once. \nOnce you enter a valid password for the specified username, the MySQL \nCommand Line Client displays a welcome message and a command line that \nlooks like this: \nmy sql> \nFrom this prompt, you can enter any statement that works with MySQL. When \nyou're done, you can exit the MySQL Command Line Client by entering ''exit'' \nor ''quit'' followed by a semicolon.\n\nCliapter 2 \nHow to use MySQL Workbench and other develop,nent tools \n67 \nThe MySQL Command Line Client displayed by Windows \n■ \nMySQL 8.0 Command Line Client \n□ \nX \nHow to start the MySQL Command Line Client (Windows only) \nStart➔ All Programs ➔ \nMySQL➔ MySQL Server 8.0➔ MySQL 8.0 Command Line Client \nHow to start the MySQL Command Line Client from the command line \nFor Windows \ncd \\ Program Files\\ MySQL\\ MySQL Server 8.0 \\ bin \nmysql -u r oot -p \nFor macOS \ncd / usr/ local/ mysql / bin \n. / mysql -u root -p \nHow the mysql command works \nThe syntax \nmysql -h hostname -u username -p \nExamples \nmysql - u ap_ tester -p \nmysql -h localhost -u root -p \nmysql -h murach. com -u ap_tester -p \nHow to exit from the MySQL Command Line Client \nmysql>exit; \nDescription \n• \nMySQL provides a command-line client program called the MySQL Command \nLine Client that lets you enter SQL statements that work with MySQL databases. \nThis program is also known as the MySQL command line. \n• \nFor Windows, use a Command Prompt window to start the MySQL Command Line Client. \n• \nFor macOS, use a Terminal window to start the MySQL Command Line Client. \n• \nTo stop the MySQL Command Line Client, enter ''exit'' or ''quit'' at the cominand \nline, followed by a semicolon. \n• \nMySQL 8.0 also includes a Unicode version of the command-line client program. For more \ninformation on this program, you can refer to section 4.5.1.6.2 of the reference manual. \nFigure 2-1 3 \nHow to start and stop the MySQL Command Line Client\n\n68 \nSection 1 \nArz introduction to MySQL \nHow to use the MySQL Command Line Client \nto work with a database \nOnce the MySQL Command Line Client is connected to a database server, \nyou can use it to run SQL statements that work with the databases that are \navailable from that server. When you enter a statement, you must end it with a \nsemicolon. Otherwise, the mysql command line displays a second line when you \npress the Enter key like this: \nmysql> show databases \n-> \nThis shows that the MySQL Command Line Client is waiting for you to finish \nyour statement. To finish a statement and execute it, you just type a semicolon \nand press the Enter key. \nFigure 2-14 shows how to execute tlu·ee SQL statements. Here, I entered all \nthree of these statements in lowercase letters. That's because SQL isn't case-\nsensitive, and lowercase letters are easier to type. \nTo list the names of the databases stored on a server, you use the SHOW \nDATABASES statement as illustrated by the first example. Here, the ''ap'', ''ex'', \nand ''om'' databases are the databases that are created when you install our \ndownloadable databases as described in appendixes A and B. The \n''information_schema'', ''performance_schema'', and ''mysql'' databases are \ninternal databases that are used by the MySQL server. And the ''sys'' database \nis a database that comes with MySQL and can be used to interpret data in the \n''performance_schema'' database. \nTo select the database that you want to work with, you can enter a USE \nstatement as illustrated by the second example. Here, the AP database is \nselected, and the message after this statement says ''Database changed'' to \nindicate that the statement was successful. After you select a database, the \ncommands and statements that you enter will work with that database. \nTo retrieve data from the database, you use a SELECT statement as illus-\ntrated by the third example. Here, the vendor_name column from the Vendors \ntable is displayed. Note, however, that the result set is limited to only the first \nfive rows. When you successfully execute a SELECT statement, the MySQL \nCommand Line Client displays a message giving the nu1nber of rows that are \nincluded in the result set and the amount of time it took to run the query. In this \ncase, it took less than 1/100 of a second to run the query.\n\nCliapter 2 \nHow to use MySQL Workbench and other develop,nent tools \n69 \nHow to list the names of all databases managed by the server \nmysql> show databases; \n+--------------------+ \nI Database \nI \n+--------------------+ \nI ap \nI \nI \nI \nI \nex \ninformation \nmysql \nschema I \nI \nI \nI \nI \nom \nperformance_ schema \nsys \nI \nI \nI \nI \n+--------------------+ \n7 rows in set (0.00 sec) \nHow to select a database for use \nmysql> use ap; \nDatabase changed \nHow to select data from a database \nmysql> select vendor_name from vendors limit 5; \n+------------------------------+ \nI vendor_name \n+------------------------------+ \nI Abbey Office Furnishings \nI American Booksellers Assoc \nI American Express \nI ASC Signs \nI Ascom Hasler Mailing Systems \n+------------------------------+ \n5 rows in set (0.00 sec) \nDescription \n• \nYou can use the MySQL Command Line Client to work with any of the databases \nrunning on the database server. To do that, you can use any SQL statement that \nworks with a MySQL database. \n• \nTo execute a SQL statement, type the statement on the command line, followed by \na semicolon. Then, press the Enter key. \n• \nTo show a list of all available databases, you can use the SHOW DATABASES \nstatement. \n• \nTo select the database that you want to work with, you can use the USE statement. \n• \nSQL statements aren't case-sensitive. As a result, when using the MySQL \nCommand Line Client, most programmers enter their statements in lowercase \nletters beca11se they 're easier to type. \nFigure 2-14 \nHow to use the MySQL Command Line Client to work with a database\n\n70 \nSection 1 \nArz introduction to MySQL \nPerspective \nIn this chapter, you learned how to use MySQL Workbench to start and \nstop a MySQL server and to enter and execute SQL statements. With that \nas background, you're ready to go on to the next chapter, where you'll start \nlearning the details of coding your own SQL state1nents. \nTerms \nMySQL Workbench \ndatabase server \ndatabase service \ndatabase engine \ndatabase object \nschema \nsnippet \nSQL script \nMySQL Reference manual \nMySQL Command Line Client \nBefore you start the exercises ... \nBefore you start the exercises for this chapte1·, you need to install the MySQL \nServer and MySQL Workbench. In addition, you need to download and install \nthe source files for this book, and you need to create the databases and tables for \nthis book. The procedures for doing all of these tasks are provided in appendix \nA (Windows) and B (macOS). \nExercises \nIn these exercises, you'll use MySQL Workbench to review the tables in the AP \ndatabase. In addition, you'll use MySQL Workbench to enter SQL statements \nand run them against these tables. \nMake sure the MySQL server is running \n1. \nStart MySQL Workbench and open a connection for the root user. \n2. \nCheck whether the MySQL server is running. If it isn't, start it. When you're \ndone, close the Startup/Shutdown tab. \nUse MySQL Workbench to review the Accounts Payable (AP) \ndatabase \n3. \nIn the Navigato1· window, expand the node for the AP database so you can see \nall of the database objects it contains. \n4. \nView the data for the Vendors and Invoices tables.\n\nCliapter 2 \nHow to use MySQL Workbench and other develop,nent tools \n71 \n5. \nNavigate through the database objects and view the column definitions for at \nleast the Vendors and Invoices tables. \nUse MySQL Workbench to enter and run SQL statements \n6. \nDouble-click the AP database to select it. When you do that, MySQL \nWorkbench should display the database in bold. \n7. \nOpen a SQL Editor tab. Then, enter and run this SQL statement: \nSELECT vendor_ namA FROM vendors \n8. \nDelete thee at the end of vendor_name and run the statement again. Note the \nerror number and the description of the error. \n9. \nOpen another SQL Editor tab. Then, enter and run this statement: \nSELECT COUNT(*) AS nwnber_ of_ invoices, \nSUM(invoice_total) AS grand_ invoice_total \nFROM invoices \nUse MySQL Workbench to open and run scripts \n10. Open the select_vendor_city_state script that's in the \nc:\\rnu1·ach\\mysql\\scripts\\ch02 directory. Note that this script contains just one \nSQL statement. Then, run the statement. \n11. Open the select_ vendor_total_due script that's in the ch02 directory. Note that \nthis opens another SQL Editor tab. \n12. Open the select_ vendor_info1·mation script that's in the ch02 directory. Notice \nthat this script contains two SQL statements that end with semicolons (scroll \ndown if you need to). \n13. Press the Ctrl+Shift+Enter keys or click the Execute SQL Script button to tun \nboth of the statements in this script. Note that this displays the results in two \nResult grids. Make sure to view the results of both SELECT statements. \n14. Move the insertion point into the frrst statement and press Ctrl+Enter to run \njust that statement. \n15. Move the insertion point into the second statement and press Ctrl+Enter to run \njust that statement. \n16. Exit from MySQL Workbench.\n\nHow to retrieve data \nfrom a single table \nIn this chapter, you'll learn how to code SELECT statements that 1·etrieve data \nfrom a single table. The skills covered here are the essential ones that apply to \nany SELECT statement you code ... no matter how many tables it operates on, \nno matter how complex the retrieval. So you'll want to be sure you have a good \nunderstanding ot· the material in this chapter before you go on to the chapters \nthat follow. \nAn introduction to the SELECT statement ........................ 74 \nThe basic syntax of the SELECT statement .................................................. 74 \nSELECT statement examples ........................................................................ 76 \nHow to code the SELECT clause ........................................ 78 \nHow to code column specifications ............................................................... 78 \nHow to name the columns in a result set using aliases ................................. 80 \nHow to code arithmetic expressions .............................................................. 82 \nHow to use the CONCAT function to join strings ....................................... 84 \nHow to use functions with strings, dates, and n11mbers ................................ 86 \nHow to test expressions by coding statements without FROM clauses ........ 88 \nHow to eliminate duplicate rows .................................................................. 90 \nHow to code the WHERE clause ......................................... 92 \nHow to use the comparison operators ........................................................... 92 \nHow to use the AND, OR, and NOT logical operators ................................. 94 \nHow to use the IN operator ............................................................................ 96 \nHow to use the BETWEEN operator ............................................................ 98 \nHow to use the LIKE and REGEXP operators ........................................... 100 \nHow to use the IS NULL clause .................................................................. 102 \nHow to code the OR DER BY clause ................................. 104 \nHow to sort by a column narne .................................................................... 104 \nHow to sort by an alias, expression, or column number ............................. 106 \nHow to code the LIM IT clause ........................................... 108 \nHow to limit the number of rows ................................................................. 108 \nHow to return a range of rows ..................................................................... 108 \nPerspective ......................................................................... 110\n\n74 \nSection 1 \nArz introduction to MySQL \nAn introduction \nto the SELECT staten,ent \nTo get you started quickly, this chapter begins by presenting the basic syntax \nof the SELECT statement. Then, it presents several examples that should give \nyou an overview of how this statement works. \nThe basic syntax of the SELECT statement \nFigure 3-1 presents the basic syntax of the SELECT statement. The syntax \nsummary at the top of this figure uses conventions that are similar to those used \nin other programming manuals. Capitalized words are keywords that you have \nto type exactly as shown. In contras~ you have to provide replacements for \nthe lowercase words. For example, you can enter a list of columns in place of \nselect_list, and you can enter a table name in place of table_source. \nBeyond that, you can omit the clauses enclosed in brackets ( [] ). If you \ncompare the syntax in this figure with the coding examples in the next figure, \nyou should easily see how the two are related. \nThis syntax summary has been simplified so you can focus on the five main \nclauses of the SELECT stateme·nt: SELECT, FROM, WHERE, ORDER BY, \nand LIMIT. Most SELECT statements contain the frrst four of these clauses. \nHowever, only the SELECT clause is required. \nThe SELECT clause is al ways the first clause in a SELECT statement. It \nidentifies the columns in the result set. These columns are retrieved from the \nbase tables named in the FROM clause. Since this chapter focuses on retrieving \ndata from a single table, the examples in this chapter use FROM clau.ses that \nname a single base table. In the next chapter, though, you'll learn how to retrieve \ndata from two or more tables. \nThe WHERE, ORDER BY, and LIMIT clauses ru·e optional. The \nORDER BY clause determines how the rows in the result set are sorted, and \nthe WHERE clause determines which rows in the base table are included in the \nresult set. The WHERE clause specifies a search condition that's used to filter \nthe rows in the base table. When this condition is true, the row is included in the \nresult set. \nThe LIMIT clause limits the number of rows in the result set. In contrast to \nthe WHERE clause, which uses a search condition, the LIMIT clause simply \nreturns a specified number of rows, regardless of the size of the full result set. Of \ncotrrse, if the result set has fewer rows than are specified by the LIMIT clause, \nall the rows in the result set are returned.\n\nChapter 3 \nHow to retrieve datafrom a single table \n75 \nThe basic syntax of the SELECT statement \nSELECT select_ list \n[FROM table_ source] \n[WHERE search condition] \n[ORDER BY order_by_ list] \n[LIMIT row_ limit] \nThe five clauses of the SELECT statement \nClause \nDescription \nSELECT \nFROM \nWHERE \nORDER BY \nLIMIT \nDescription \nDescribes the columns in the result set. \nNames the base table from which the query retrieves the data. \nSpecifies the conditions that must be met for a row to be included ia tbe result set. \nSpecifies how to sort the rows in the result set. \nSpecifies the number of rows to return. \n• \nYou use the basic SELECT statement shown above to retrieve the columns speci-\nfied in the SELECT clause from the base table specified in the FROM clause and \nstore them in a result set. \n• \nThe WHERE clause is used to filter the rows in the base table so that only those \nrows that match the search condition are included in the result set. If you omit the \nWHERE clause, all of the rows in the base table are included. \n• \nThe search condition of a WHERE clause consists of one or more Boolean expres-\nsions that result in a true, false, or null value. If the combination of all the expres-\nsions is a t1ue value, the row being tested is included in the result set. Otherwise, \nit's not. \n• \nIf you include the ORDER BY clause, the rows in the result set are sorted in the \nspecified sequence. Otherwise, the sequence of the rows is not guaranteed by \nMySQL. \n• \nIf you include the LIMIT clause, the result set that's retrieved is limited to a speci-\nfied number of 1·ows. If you omit this clause, all rows that match are returned. \n• \nYou 1nust code the clauses in the 01·der shown or you'll get a syntax error. \nNote \n• \nThe syntax shown above does not include all of the clauses of the SELECT state-\nment. You '11 learn about the other clauses later in this book. \nFigure 3-1 \nThe basic syntax of the SELECT statement\n\n76 \nSection 1 \nArz introduction to MySQL \nSELECT statement examples \nFigure 3-2 presents five SELECT statement examples. All of these state-\nments retrieve data from the Invoices table that you expe1imented with in the last \nchapter. After each statement, you can see its result set as displayed by MySQL \nWorkbench. In these examples, a horizontal or vertical sc1·oll bar indicates that \nthe result set contains more rows or columns than can be displayed at one time. \nThe first statement in this figure retrieves all of the rows and columns from \nthe Invoices table. Here, an asterisk (*) is used as a shorthand to indicate that \nall of the columns should be retrieved, and the WHERE and LIMIT clauses are \nomitted so all of the rows in the table are retrieved. In addition, this statement \ndoesn't include an ORDER BY clause, so the rows are in primary key sequence. \nThe second statement retrieves selected columns from the Invoices table. \nThese columns are listed in the SELECT clause. Like the first statement, this \nstatement doesn't include a WHERE or a LIMIT clause, so all the rows are \nretrieved. Then, the ORDER BY clause causes the rows to be sorted by the \ninvoice_total column in descending order, from largest to smallest. \nThe third statement also lists the columns to be retrieved. In this case, \nthough, the last column is calculated from two columns in the base table, \ncredit_total and payment_total, and the resulting column is given the name \ntotal_credits. In addition, the WHERE clause specifies that only the invoice \nwhose invoice_id column has a value of 17 should be retrieved. \nThe fourth SELECT statement includes a WHERE clause whose condition \nspecifies a range of values. In this case, only invoices with invoice dates between \n06/01/2018 and 06/30/2018 are retrieved. In addition, the rows in the result set \nare sorted by invoice date. \nThe last statement in this figure shows another example of the WHERE \nclause. In this case, only those rows with invoice totals greater than 50,000 are \nretrieved. Since none of the rows in the Invoices table satisfy this condition, the \nresult set is empty.\n\nChapter 3 \nHow to retrieve datafrom a single table \n77 \nA SELECT statement that retrieves all the data from the Invoices table \nSELECT* FROM invoices \ninvoice_id \nvendor_id \ninvoice_number \ninvoice_date \ninvoice_total \npayment_total \ncredit_total \ntermsjd \n~\n1 \n122 \n989319-457 \n2018-04-08 \n3813.33 \n3813.33 \n0.00 \n3 \n2 \n123 \n263253241 \n2018-04-10 \n40.20 \n40. 20 \n0.00 \n3 \n3 \n123 \n963253234 \n2018-04-13 \n138.75 \n1.38. 75 \n0.00 \n3 \n< \n(114 rows) \nA SELECT statement that retrieves three columns from each row, \nsorted in descending sequence by invoice total \nSELECT invoice_number, invoice_date, invoice_ total \nFROM invoices \nORDER BY invoice_total DESC \ninvoice number \ninvoice date \ninvoice total \n-\n-\n-\n-;-l o-20sa \n2018-05-28 \n37966.19 \nP-0259 \n2018-07-19 \n2688L40 \n0-2060 \n2018-07-24 \n23517. 58 \n( 114 rows ) \nIt,. \n\\I \n> \nl.-\n1; \nA SELECT statement that retrieves two columns and a calculated value \nfor a specific invoice \nSELECT invoice_ id, invoice_total, \ncredit total+ payment_total AS total credits \n• \n• \nFROM invoices \nWHERE invoice_ id = 17 \ninvoice_id \ninvoice_total \ntotal_credits \n--I \n► \n17 \n10.00 \n10.00 \nA SELECT statement that retrieves all invoices between given dates \nSELECT invoice_ n11mher, invoice_date, invoice_total \nFROM invoices \nWHERE invoice date BETWEEN '2018-06-01' AND \n1 2018-06-30' \nORDER BY invoice_date \n_J invoice_number \ninvoice date \n-\ninvoice total \n-\n► \n989319·-437 \n2018-06-01 \n2765.36 \nlll-92R-10094 \n2018-06-01 \n19.67 \n40318 \n2018-06-01 \n21842.00 \n(37 rows ) \nA SELECT statement that returns an empty result set \nSELECT invoice_number, invoice_date, invoice_ total \nFROM invoices \nWHERE invoice_ total > 50000 \ninvoice_number \ninvoice date \ninvoice tot.al \n-\n-\nFigure 3-2 \nSELECT statement examples \n,_ . \n1. \n'\n\n78 \nSection 1 \nArz introduction to MySQL \nHow to code the SELECT clause \nNow that you have a general idea of how the main clauses of a SELECT \nstatement work, you're ready to learn the details for coding the frrst clause, the \nSELECT clause. You can use this clause to specify the columns for a result set. \nHow to code column specifications \nFigure 3-3 begins by presenting a more detailed syntax for the SELECT \nclause. In this syntax, you can choose between the items in a syntax summary \nthat are separated by pipes ( I ), and you can omit items enclosed in brackets \n( [] ). If you have a choice between two or more optional items, the default item \nis underlined. And if an element can be coded multiple times in a statement, it's \nfollowed by an ellipsis ( ... ). \nThis figure continues by summarizing four techniques you can use to specify \nthe columns for a result set. First, you can code an asterisk in the SELECT \nclause to retrieve all of the columns in the base table. When you use this \ntechnique, MySQL returns the columns in the order that they are defined in the \nbase table. \nSecond, you can code a list of column names from the base table separated \nby commas. In this figure, for instance, the second example specifies three \ncolumns that are in the Vendors table. \nThird, you can code an expression that t1ses arithmetic operators. The result \nof an expression is a single value. In this figure, for instance, the third example \nuses an expression to subtract the payment_total and credit_total columns from \nthe invoice total column and return the balance due. \nFourth, you can code an expression that uses functions. In this figure, for \ninstance, the fourth example uses the CONCAT function to join a column named \nfirst_name, a space, and a column named last_name. Here, two single quotes are \nused to identify the literal value for the space. \nWhen you code the SELECT clause, you should include only the columns \nyou need. For example, you shouldn't code an asterisk to retrieve all the columns \nunless you need all the columns. That's because the amount of data that's \nretrieved can affect system performance. This is particularly important if you 're \ndeveloping SQL statements that will be used by application programs. \nFor now, don't worry if you don't completely understand all four techniques. \nIn the next four figures, you'll learn 1nore about how they work.\n\nChapter 3 \nHow to retrieve datafrom a single table \n79 \nThe expanded syntax of the SELECT clause \nSELECT [ALLIDISTINCT] \ncolumn_ specification [[AS] result_ column] \n[, column_ specification [[AS] result_ column]J ... \nFour ways to code column specifications \nSource \nOption \nSyntax \nBase table value \nAll columns \nColumn name \nCalculated value \nResult of a calculation \nResult of a function \n* \ncolumn_11a1ne \nArithmetic expressions (see figure 3-5) \nFunctions (see figures 3-6 and 3-7) \nColumn specifications that use base table values \nThe * is used to retrieve all columns \nSELECT* \nColumn names are used to retrieve specific columns \nSELECT vendor_ name, vendor_ city, vendor_ state \nColumn specifications that use calculated values \nAn arithmetic expression that calculates the balance due \nSELECT invoice_ total -\npayment_ total - credit_ total AS balance_due \nA function that returns the full name \nSELECT CONCAT(first_ name, ' ', last_name) AS full_ name \nDescription \n• \nUse SELECT * only when you need to retrieve all of the columns from a table. \nOtherwise, list the names of the columns you need. \n• \nAn expression is a combination of column names and operators that evaluate to a \nsingle value. In the SELECT clause, you can code expressions that include one or \nmore arithmetic operators and expressions that include one or more functions. \n• \nAfter each column specification, you can code an AS clause to specify the name for \nthe column in the result set. See figure 3-4 for details. \nNote \n• \nThe ALL and DISTINCT keywords specify whether or not duplicate rows are \nrettn·ned. See figlll·e 3-9 for details. \nFigure 3-3 \nHow to code column specifications\n\n80 \nSection 1 \nArz introduction to MySQL \nHow to name the columns \nin a result set using aliases \nBy default, MySQL gives a column in a result set the same name as the \ncolumn in the base table. If the column is based on a calculated value, it's \nassigned a name based on the expression for the value. However, whenever you \nwant, you can specify a different name known as a column alias as shown in \nfigure 3-4. \nTo assign a column alias, you code the column specification followed by \nthe AS keyword and the new name as shown by the first example in this figure. \nHere, the statement creates an alias of ''Invoice Number'' for the invoice_number \ncolumn, ''Date'' for the invoice_date column, and ''Total'' for the invoice_total \ncolumn. To include a space in the alias for the first column, this statement \nencloses that alias in double quotes ( \" ). \nThe second example in this figure shows what happens when you don't \nassign an alias to a calculated column. In that case, MySQL automatically \nassigns the column an alias that's the same as the column's expression. Since the \nexpressions for many calculated values are cumbersome, you typically assign a \nshorter alias for calculated values as shown throughout the rest of this chapter.\n\nChapter 3 \nHow to retrieve datafrom a single table \n81 \nA SELECT statement that renames the columns in the result set \nSELECT invoice_number AS \"Invoice Number\", invoice_date AS Date, \ninvoice total AS Total \nFROM invoices \nInvoice Number \nDate \nTotal \n► \n989319-457 \n2018-04-08 \n3813.33 \n263253241 \n2018-04-10 \n-10.20 \n963253234 \n2018-04-13 \n138. 75 \n2-000-2993 \n2018-04-16 \n144. 70 \n963253251 \n2018-04-16 \n15.50 \n963253261 \n2018-04-16 \n42.75 \n(114 rows) \nA SELECT statement that doesn't name a calculated column \nSELECT invoice_number, invoice_date, invoice_total, \ninvoice_total - payment_total - credit_total \nFROM invoices \n~ \ninvoice_number \ninvoice date \ninvoice total \ninvoice_tot.al - payment_total - credit_tot.al \n-\n-\n2018-04-08 \n3813, 33 \n0.00 \n► \n989319-457 \n1263253241 \n2018-04-10 \n\"10. 20 \n0.00 \n1963253234 \n2018-04-13 \n138.75 \n0.00 \n2-000-2993 \n2018-04-16 \n144.70 \n0.00 \n963253251 \n2018-04-16 \n15.50 \n0.00 \n1963253261 \n2018-04-16 \n42. 75 \n0.00 \n(114 rows) \nDescription \n• \nBy default, a column in the result set is given the same name as the column in \nthe base table. If that's not what you want, you can specify a substitute name, or \ncolumn alias, for the column. \n• \nTo specify an alias for a column, use the AS phrase. Although the AS keyword is \noptional, I recommend you code it for readability. \n• \nIf you don't specify an alias for a column that's based on a calculated value, \nMySQL uses the expression for the calculated value as the column name. \n• \nTo include spaces or special characters in an alias, enclose the alias in double \nquotes ( \" ) or single quotes ( ' ). \nFigure 3-4 \nHow to name the columns in a result set using aliases \nV \n-\n\n82 \nSection 1 \nArz introduction to MySQL \nHow to code arithmetic expressions \nFigure 3-5 shows how to code arithmetic expressions. To start, it summarizes \nthe arithmetic operators you can use in this type of expression. Then, it presents \nthree examples that show bow you use these operators. \nThe SELECT statement in the fu·st example includes an arithmetic expres-\nsion that calculates the balance due for an invoice. This expression subtracts \nthe payment_total and credit_total columns from the invoice_total column. The \nresulting column is given an alias of balance_due. \nWhen MySQL evaluates an arithmetic expression, it performs the operations \nfrom left to right based on the order of precedence. To start, MySQL performs \nmultiplication, division, and modulo operations. Then, it performs addition and \nsubtraction operations. \nIf that's not what you want, you can use parentheses to specify how an \nexpression is evaluated. Then, MySQL evaluates the expressions in the inner-\nmost sets of parentheses first, followed by the expressions in outer sets of \nparentheses. Within each set of parentheses, MySQL evaluates the expression \nfrom left to right in the order of precedence. \nIf you want, you can also use parentheses to clarify an expression even if \nthey're not needed for the expression to be evaluated properly. However, you \nshould avoid cluttering your SQL statements with unnecessary parentheses. \nTo show how pai·entheses and the order of precedence affect the evaluation \nof an expression, consider the second example in this figure. Here, the expres-\nsions in the second and third columns both perform the same operations. These \nexpressions use one column name (invoice_id) that returns a number and two \nliteral values for numbers (7 and 3). When you code a literal value for a number, \nyou don't need to enclose it in quotes. \nWhen MySQL evaluates the exp1·ession in the second column, it perfo1ms \nthe multiplication operation before the addition operation because multiplica-\ntion comes before addition in the order of precedence. When MySQL evaluates \nthe expression in the third column, though, it perfor1ns the addition operation \nfirst because it's enclosed in parentheses. Because of this, these two expressions \nreturn different values as shown in the result set. \nAlthough you're probably familiar with the addition, subtraction, multipli-\ncation, and division operators, you may not be familiar with the MOD (%) or \nDIV operators. MOD returns the remainder of a division of two integers, and \nDIV returns the integer quotient of two numbers. These are shown in the third \nexample in this figure. Here, the second column contains the quotient of the \ntwo numbers, which MySQL automatically converts from an integer value to a \ndecimal value. Then, the third column uses the DIV operator to return the integer \nquotient of the same division operation. The fourth column uses the modt1lo \noperator to return the remainder of the division operation. \nBefore going on, you should notice that the second and third SELECT \nstatements include an ORDER BY clause that sorts the result set in ascending \nsequence by the invoice_id column. Although you might think that this would \nbe the default, that's not the case with MySQL. Instead, the rows in a result set \nare returned in the most efficient way. If you want the rows returned in a specific \nsequence, then, you need to include the ORDER BY clause.\n\nChapter 3 \nHow to retrieve datafrom a single table \n83 \nThe arithmetic operators in order of precedence \nOperator \nName \nOrder of precedence \n* \nMultiplication \n1 \nI \nDivisio11 \n1 \nDIV \nInteger division \n1 \n~ \n0 \n(MOD) \nModulo (remainder) \n1 \n+ \nAddition \n2 \n-\nSubtraction \n2 \nA SELECT statement that calculates the balance due \nSELECT invoice_total, payment_total, credit_total, \ninvoice_total - payment_ total - credit_ total AS balance_due \nFROM invoices \ninvoice_ total \npayment_total \naedit_total \nbalance_due \n► \n3813.33 \n38L3.33 \n0.00 \n0.00 \n40.20 \n40.20 \n0.00 \n0.00 \n1 m . 75 \n138.75 \n0.00 \n0.00 \nUse parentheses to control the sequence of operations \nSELECT invoice_ id, \ninvoice_id + 7 * 3 AS multiply_first, \n(invoice_id + 7) * 3 AS add first \nFROM invoices \nORDER BY invoice_id \ninvoice_id \nmultiply _first \nadd_first \n► \n1 \n22 \n24 \n2 \n23 \n27 \n3 \n24 \n30 \nUse the DIV and modulo operators \nSELECT invoice_ id, \ninvoice_id / 3 AS decimal_quotient, \ninvoice_id DIV 3 AS integer_quotient, \ninvoice_id % 3 AS remainder \nFROM invoices \nORDER BY invoice_id \n_J invorce_id \ndecimal_quotient \ninteger _quotient \nremainder \n► \n1 \n0.3333 \n0 \n1 \n2 \n0.6667 \n0 \n2 \nI \n3 \n1.0000 \nl \n0 \nDescription \n'--\n. \n'--\n• \nUnless parentheses are used, the operations in an expression take place from left to right \nin the order of precedence. For arithmetic expressions, MySQL performs multiplication, \ndivision, and modulo operations first. Then, it performs addition and subtraction operations. \n• \nWhen necessary, you can use parentheses to override or clarify the sequence of operations. \nFigure 3-5 \nHow to code arithmetic expressions\n\n84 \nSection 1 \nArz introduction to MySQL \nHow to use the CONCAT function \nto join strings \nFigure 3-6 presents the CONCAT function and shows you how to use it to \njoin, or concatenate, strings. In MySQL, a string can contain any combination of \ncharacters, and a function performs an operation and returns a value. To code a \nfunction, you begin by entering its name followed by a set of parentheses. If the \nfunction requires an argument, or parameter, you enter it within the parentheses. \nIf the function takes more than one argument, you separate them with commas. \nIn this figure, the first example shows how to use the CONCAT function to \njoin the vendor_city and vendor_state columns in the Vendors table. Since this \nexample doesn't assign an alias to this column, MySQL automatically assigns \nthe expression formula as the column name. In addition, there isn't a space \nbetween the vendor_state and the vendor_city in the result set. Since this makes \nthe data difficult to read, this string should be formatted as shown in the second \nor third example. \nThe second example shows how to format a string expression by adding \nspaces and punctuation. Here, the vendor_city column is concatenated with a \nliteral value for a string that contains a comma and a space. Then, the \nvendor_state column is concatenated with that result, followed by a literal value \nfor a string that contains a single space and the vendor_zip_code column. \nTo code a string literal, you can enclose the value in either single quotes ( ' ) \nor double quotes ( \" ). Occasionally, you may need to include a single quote as \nan apostrophe within a literal value for a string. If you're using single quotes \naround the literal, however, MySQL will misinterpret the aposn·ophe as the end \nof the string. To solve this, you can code two single quotation marks in a row as \nshown by the third example. Or, you can use double quotes like this: \nCONCAT(vendor_name, \"'s Address: \") AS vendor\n\nChapter 3 \nHow to retrieve data from a single table \n85 \nThe syntax of the CONCAT function \nCONCAT(stringl[, string2] ... } \nHow to concatenate string data \nSELECT vendor_ city, vendor_ state, CONCAT(vendor_city, vendor_ state} \nFROM vendors \n~ \nvendor _city \nvendor _state \nCONCAT(vendor _city, vendor _state) -\nWI \nMadisonWI \n► \nMadison \nWashington \nDC \n\\~ashingtonDC \n(122 rows) \nHow to format string data using literal values \nSELECT vendor_name, \nCONCAT(vendor_city, \nAS address \nFROM vendors \nvendor _name \naddress \n----, \n', ', vendor_ state, \n► \nUS Postal Service \nNational Information Data Ctr \nMadison, WI 53707 \nWashington, DC 20120 \n(122 rows} \nHow to include apostrophes in literal values \n1 \n1 , \nvendor_ zip_code) \nSELECT CONCAT(vendor_name, '' 's Address: ') AS Vendor, \nCONCAT(vendor_city, ', ', vendor_state, ' ', vendor_ zip_code} \nAS Address \nFROM vendors \nVendor \nAddress \n► \nUS Postal Service's Address: \nMadison, WI 53707 \nNational Information Data Ctr's Address: \n\\n/ashington, DC 20120 \n(122 rows) \nDescription \n• \nAn expression can include any of the functions that are supported by MySQL. A \nfunction performs an operation and returns a value. \nl.-\nI\\ \n\\I \n• \nTo code a function, code the function name followed by a set of parentheses. Within \nthe parentheses, code any parameters, or arguments, required by the function. If a \nfunction requires two or more arguments, separate them with commas. \n• \nTo code a literal value for a string, enclose one or more characters within single \nquotes ( ' ) or double quotes ( \" ). \n• \nTo include a single quote within a literal value for a string, code two single quotes. \nOr, use double quotes instead of single quotes to start and end the literal value. \n• \nTo join, or concatenate, two or more string columns or literal values, use the \nCONCAT function. \nFigure 3-6 \nHow to use the CONCAT function to join strings\n\n86 \nSection 1 \nArz introduction to MySQL \nHow to use functions with strings, dates, \nand numbers \nFigure 3-7 shows how to work with three more functions. The LEFf \nfunctio11 operates on strings, the DATE_FORMAT function operates on dates, \nand the ROUND function operates on numbers. For now, don't worry about the \ndetails of how the functions shown here work, because you'll learn more about \nall of these functions in chapter 9. Instead, just focus on how they're used in \ncolumn specifications. \nThe first example in this figure shows how to use the LEFT function to \nextract the first character of the vendor_contact_frrst_name and \nvendor_contact_last_name columns. The frrst parameter of this function speci-\nfies the string value, and the second parameter specifies the number of charac-\nters to return. Then, this statement concatenates the results of the two LEFT \nfunctions to form initials as shown in the result set. \nThe second example shows how to use the DATE_FORMAT function \nto change the format used to display date values. This function requires two \nparameters. The first parameter is the date value to be formatted and the second \nis a format string that uses specific values as placeholders for the various parts \nof the date. The first column in this example renrrns the invoice_date column in \nthe default MySQL date format, ''yyyy-mm-dd''. Since this format isn't used as \noften in the USA, the second column is formatted in the more typical \n''mm/dd/yy'' format. In the third column, the invoice date is in another format \nthat's commonly used. In chapter 9, you'll leait1 1nore about specifying the \nformat string for the DATE_FORMAT function. \nThe third example uses the ROUND function to round the value of the \ninvoice total column to the nearest dollai· and nearest dime. This function can \n-\naccept eitl1er one or two parameters. The first parameter specifies the number to \nbe rounded and the optional second parameter specifies the number of decimal \nplaces to keep. If the second parameter is omitted, the function rounds to the \nnearest integer.\n\nChapter 3 \nHow to retrieve datafrom a single table \n87 \nThe syntax of the LEFT, DATE_FORMAT, and ROUND functions \nLEFT(string, number_of_characters) \nDATE_ FORMAT (date, format_string) \nROUND(number[, number_of_decimal_places]) \nA SELECT statement that uses the LEFT function \nSELECT vendor_ contact_ first_name, vendor_contact_ last_ name, \nCONCAT(LEFT(vendor_ contact_first_ namA, 1 ) , \nLEFT (vendor_ contact_ last_ namA, 1)) AS initials \nFROM vendors \nvendor _contact_first_name \nvendor contact last name \ninitials \n-\n- -\n► \nFrancesco \nAlberto \nFA \nI Ania \nIrvin \nAI \nLukas \nLiana \nLL \n(122 rows ) \nA SELECT statement that uses the DATE FORMAT function \nSELECT invoice_date, \nDATE_ FORMAT(invoice_date, •~oro/%d /%y') AS 'MM/ DD/YY', \nDATE_ FORMAT{invoice_date, ' %e-%b-%Y') AS 'DD-Mon-YYYY' \nFROM invoices \nORDER BY invoice_date \ninvoice_date \n~ \n2018-04-08 \n2018-04-10 \nI 20 18-04-13 \n(114 rows) \nMM/00/'(Y \n04/08/18 \n04/10/18 \n04/ 13/18 \nDD-Mon-YYYY \n8-Apr-2018 \n10--Apr-2018 \n13-Apr-2018 \nA SELECT statement that uses the ROUND function \nSELECT invoice_date, invoice_total, \nROUND(invoice_ total) AS nearest_dollar, \nROUND (invoice_ total, 1) AS nearest_dime \nFROM invoices \nORDER BY invoice date \nI invoice_date \ninvoice _total \nnearest_dollar \nnearest_dime \n► \n2018--04-08 \n3813.33 \n3813 \n3813.3 \n2018-04-10 \n40.20 \n40 \n40.2 \n2018-04-13 \n138.75 \n139 \n138.8 \n( 114 rows ) \nDescription \n• \nWhen using the DATE_FORMAT function to specify the format of a date, you use \nthe percent sign (%) to identify a format code. For example, a format code of m \nreturns the month number with a leading zero if necessary. For more information \nabout these codes, see chapter 9. \n• \nFor more information about using functions, see chapter 9. \nFigure 3-7 \nHow to use functions with strings, dates, and numbers \nI\\ \n'--\nV\n\n88 \nSection 1 \nArz introduction to MySQL \nHow to test expressions by coding statements \nwithout FROM clauses \nWhen you use MySQL, you don't have to code FROM clat1ses in SELECT \nstatements. This makes it easy for you to code SELECT statements that test \nexpressions and functions like those that you've seen in this chapter. Instead of \ncoding column specifications in the SELECT clause, you use literals or functions \nto supply the test values you need. And you code column aliases to display \nthe results. Then, once you're sure that the code works as you intend it to, you \ncan add the FROM clause and replace the literals or functions with the correct \ncolumn specifications. \nFigure 3-8 shows how to test expressions. Here, the first example tests \nan arithmetic expression using numeric literals that make it easy to verify the \nresults. The remaining examples test the functions that you saw in figure 3-7. If \nyou compare these statements, you'll see that the second and fourth examples \nsimply replace the column specifications in figure 3-7 with literal values. The \nthird example uses another function, CURRENT_DATE, to supply a date value \nin place of the invoice_date column that's coded in figure 3-7.\n\nChapter 3 \nHow to retrieve datafrom a single table \n89 \nFour SELECT statements without FROM clauses \nExample 1 : Testing a calculation \nSELECT 1000 * (1 + .1) AS \n1110% More Than 1000\" \n10°/4 More Than 1000 \n---I \n--\n► \n1100.0 \n\"'-~------;;;==========------;================~!' \nExample 2: Testing the CON CAT function \nSELECT \"Ed\" AS first_name, \"Williams\" AS last_ name, \nCONCAT(LEFT(\"Ed\", 1), LEFT(\"Williams\", 1)) AS initials \nI first_name \nlast_name \ninitials \n~ \nEd \nWllliams \nE\\ft/ \nExample 3: Testing the DATE_FORMAT function \nSELECT CURRENT_DATE, \nDATE_ FORMAT(CURRENT_ DATE, •~orn/%d/%y') AS 'MM/DD/YY', \nDATE_ FORMAT(CURRENT_ DATE, \n1 %e-~ob-%Y 1 ) \nAS 'DD-Mon-YYYY' \nI CURRENT _DATE \nMM/DO/YY \nDD+ion-YYYY \n► \n2018-11-06 \n11/06/18 \n6-Nov-2018 \nExample 4: Testing the ROUND function \nSELECT 12345.6789 AS value, \nROUND(12345.6789) AS nearest_dollar, \nROUND(12345.6789, 1) AS nearest_ dime \nI value \nnearest_dollar \nnearest_dime \n► \n12345.6789 \n12346 \n12345.7 \nDescription \n• \nWith MySQL, you don't have to code a FROM clause. This makes it easy to test \nexpressions that include arithmetic operators and functions. \n• \nThe CURRENT _DATE function returns the current date. The parentheses are \noptional for this function. \nFigure 3-8 \nHow to test expressions \nI\n\n90 \nSection 1 \nArz introduction to MySQL \nHow to eliminate duplicate rows \nBy default, all of the rows in the base table that satisfy the search condition \nin the WHERE clause are included in the result set. In some cases, though, that \nmeans that the result set will contain duplicate rows, or rows whose column \nvalues are identical. If that's not what you want, you can include the DISTINCT \nkeyword in the SELECT clause to eliminate the duplicate rows. \nFigure 3-9 shows how this works. Here, both SELECT statements retrieve \nthe vendor_city and vendor_state columns from the Vendors table. The frrst \nstatement doesn't include the DISTINCT keyword. Because of that, the same \ncity and state can appear in the result set more than once. In the results shown \nin this figure, for example, you can see that Anaheim CA occurs twice and \nBoston MA occurs three times. In contrast, the second statement includes the \nDISTINCT keyword, so each city and state combination is included only once.\n\nChapter 3 \nHow to retrieve data from a single table \n91 \nA SELECT statement that returns all rows \nSELECT vendor_ city, vendor_ state \nFROM vendors \nORDER BY vendor_city \n~ \nvendor _city \nvendor _state \n► \nAnaheim \nCA \nAnaheim \nCA \nAnn Arbor \nMI \nI Auburn Hils \nMl \nBoston \nMA \njBoston \nMA \nMA \n1Boston \n(122 rows) \nA SELECT statement that eliminates duplicate rows \nSELECT DISTINCT vendor_city, vendor_ state \nFROM vendors \nORDER BY vendor_city \n_J vendor _city \nvendor _state \n► \nAnaheim \nCA \nI Ann Arbor \nMl \nAuburn Hils \nMI \n1Bostcn \nMA \nBrea \nCA \n, Carol Stream \nIL \nI Charlotte \nNC \n(53 rows ) \nDescription \n• \nThe DISTINCT keyword prevents duplicate (identical) rows from being included in \nthe result set. DISTINCTROW is a synonym for DISTINCT. \n• \nThe ALL keyword causes all rows matching the search condition to be included in \nthe result set, regardless of whether rows are duplicated. Since this is the defat1lt, \nyou'll usually omit the ALL keyword. \n• \nTo use the DISTINCT or ALL keyword, code it immediately after the SELECT \nkeyword as shown above. \nFigure 3-9 \nHow to eliminate duplicate rows\n\n92 \nSection 1 \nArz introduction to MySQL \nHow to code the WHERE clause \nEarlier in this chapter, I mentioned that to improve performance, you should \ncode your SELECT statements so they retrieve o.nly the columns you need. That \ngoes for retrieving rows too: The fewer rows you retrieve, the more efficient the \nstatement will be. Because of that, yot1 typically include a WHERE clat1se on \nyour SELECT statements with a search condition that filters the 1·ows in the base \ntable so only the rows you need are retrieved. In the topics that follow, you '11 \nlearn a variety of ways to code this clause. \nHow to use the comparison operators \nFigure 3-10 shows how to t1se the comparison operato,·s in the search \ncondition of a WHERE clause to compare two expressions. If the result of the \ncomparison is true, the row being tested is included in the query results. \nThe examples in this figure show how to use the comparison operators. The \nfirst WHERE clause, for example, uses the equal operator(=) to retrieve only \nthose rows whose vendor_state column has a value of 'IA' . Here, the state code \nis a string literal so it must be enclosed in single or double quotes. In contrast, \nthe second WHERE clause uses the greater than (>) operator to retrieve only \nthose rows that have a balance greater than zero. In this case, zero (0) is a \nnumeric literal so it isn't enclosed in quotes. \nThe third WHERE clause shows another way to retrieve all the invoices with \na balance due by rean·anging the comparison expression. Like the second clause, \nit uses the greater than operator. Instead of comparing the balance due to a valt1e \nof zero, however, it compares the invoice total to the total of the payments and \ncredits that have been applied to the invoice. \nThe fourth WHERE clause shows how you can use comparison operators \nother than equal wit11 string data. In this example, the less than operator (<)is \nused to compare the value of the vendor_name column to a literal string that \ncontains the letter M. That causes the query to return all vendors with names that \nbegin with the letters A through L. \nYou can also use the comparison operators with date literals, as shown by the \nfifth and sixth WHERE clauses. The fifth clause reti·ieves rows with invoice dates \non or before July 31, 2018, and the sixth clause retrieves rows with invoice dates \non 01· after July 1, 2018. Like literal values for strings, literal values for dates \nmust be enclosed in single or double quotes. Also, literal values for dates must \nuse this format: YYYY-MM-DD. This is the default date format used by MySQL. \nThe last two WHERE clauses show how you can test for a not-equal condi-\ntion. In both cases, only rows with a credit total that isn 't equal to zero are \n1·etrieved. \nWhenever possible, you should compare expressions that have similar data \ntypes. If you compare expressions that have different data types, MySQL implic-\nitly converts the data type for you. Generally, this implicit conversion is accept-\nable. However, implicit conversions can occasionally yield unexpected results. \nTo prevent this, you can explicitly convert the data type by using the CAST or \nCONVERT functions, which you'll learn about in chapter 8.\n\nChapter 3 \nHow to retrieve datafrom a single table \n93 \nThe syntax of the WHERE clause with comparison operators \nWHERE expression_ l operator expression_ 2 \nThe comparison operators \n= \nEqual \n< \nLess than \n> \nGreater than \n< = \nLess than or equal to \n> = \nGreater than or equal to \n<> \nNot equal \n! = \nNot equal \nExamples of WHERE clauses that retrieve ... \nVendors located in Iowa \nWHERE vendor_ state = 'IA' \nInvoices with a balance due (two variations) \nWHERE invoice_total -\npayment_ total - credit_ total > 0 \nWHERE invoice_ total > payment_total + credit total \nVendors with names from A to L \nWHERE vendor_name < 'M' \nInvoices on or before a specified date \nWHERE invoice date <= '2018-07-31' \nInvoices on or after a specified date \nWHERE invoice_date >= '2018-07-01' \nInvoices with credits that don't equal zero (two variations) \nWHERE credit_ total <> 0 \nWHERE credit_ total != 0 \nDescription \n• \nYou can use a comparison operator to compare any two expressions. Since MySQL \nautomatically converts the data for comparison, the expressions may be of unlike \ndata types. However, the comparison may sometimes produce unexpected results. \n• If the result of a compaiison is a true value, the row being tested is included in the \nresult set. If it's a false or null value, the row isn't included. \n• \nTo use a string literal or a date literal in a comparison, enclose it in quotes. To use a \nnumeric literal, enter the number without quotes. \n• \nCharacter comparisons perforrr1ed on MySQL databases are not case-sensitive. So, \nfor example, 'CA' and 'ca' are considered equivalent. \n• \nIf you compare a null value using one of these comparison operators, the result is \nalways a null value. To test for null values, use the IS NULL clause presented in \nfigure 3-15. \nFigure 3-1 O \nHow to use the comparison operators\n\n94 \nSection 1 \nArz introduction to MySQL \nHow to use the AND, OR, \nand NOT logical operators \nFigure 3-11 shows how to use logical operators in a WHERE clause. You \ncan use the AND and OR operators to combine two or more search conditions \ninto a compound conditiori. And you can use the NOT operator to negate a \nsearch condition. The examples in this figure show how these operators work. \nThe first two examples show the AND and OR operators. When you use \nthe AND operator, both conditions must be true. So, in the first example, only \nthose vendors in the state of New Jersey and the city of Springfield are retrieved \nfrom the Vendors table. When you use the OR operator, though, only 011e of the \nconditions must be true. So, in the second example, all the vendors in the state of \nNew Jersey and all the vendors in the city of Pittsburg (no matter what state) are \nretrieved. \nThe third example shows how to use the NOT operator to negate a condi-\ntion. Here, vendors that are not in the state of California are returned. The fourth \nexample shows a compound condition that uses two NOT operators. This condi-\ntion is difficult to understand. To make it easier to understand, you can rewrite \nthis condition to remove the NOT operators as shown in the fifth example. \nThe last two examples in this figure show how the order of precedence for \nthe logical operators and the use of parentheses affect the result of a search \ncondition. By default, the NOT operator is evaluated first, followed by AND, \nand then by OR. However, you can use parentheses to override the order of \nprecedence or to clarify a logical expression, just as you can with aritlunetic \n• \nexpressions. \nIn the next to last example, for instance, no parentheses are used, so the \ntwo conditions connected by the AND operator are evaluated first. In the last \nexample, though, parentheses are used so the two conditions connected by the \nOR operator are evaluated first. If you take a minute to review the results in this \nfigure, you should quickly see how these two conditions differ.\n\nChapter 3 \nHow to retrieve datafrom a single table \n95 \nThe syntax of the WHERE clause with logical operators \nWHERE [NOT] search_condition_ l \n{ANDIOR} [NOT] search_ condition_ 2 \nExamples of WHERE clauses that use logical operators \nThe AND operator \nWHERE vendor_state = 'NJ' AND vendor_city = 'Springfield' \nThe OR operator \nWHERE vendor_state = 'NJ' OR vendor_city = 'Pittsburg' \nThe NOT operator \nWHERE NOT vendor_state = 'CA' \nThe NOT operator in a complex search condition \n• • • \nWHERE NOT {invoice_ total >= 5000 OR NOT invoice_date <= '2018-08-01') \nThe same condition rephrased to eliminate the NOT operator \nWHERE invoice_ total < 5000 AND invoice_date <= '2018-08-01' \nA compound condition without parentheses \nWHERE invoice_date > '2018-07-03' OR invoice_total > 500 \nAND invoice_ total -\npayment_total - credit_ total > O \ninvoice_number \ninvoice_date \ninvoice_total \nbalance_due \n-\n-\n► \n203339-13 \n2018-07-05 \n17.50 \n0.00 \n111-92R-10093 \n2018-07-06 \n39.n \n0,00 \n963253258 \n2018-07-06 \n111.00 \n0.00 \n{33 rows ) \nThe same compound condition with parentheses \nWHERE (invoice_date > '2018-07-03' OR invoice_ total > 500) \nAND invoice_ total - payment_total - credit_total > 0 \n~ \ninvoice-:..number \ninvoice_date \ninvoice_total \nbalance_due \n2018~7-10 \n85.31 \n85.31 \n► \n39104 \n1963253264 \n2018-07-18 \n52.25 \n52.25 \n31361833 \n2018-07-21 \n579.42 \n579.42 \n{11 rows) \nDescription \n• \nYou can use the AND and OR logical operators to create compound conditions that \nconsist of two or more conditions. You use the AND operator to specify that the \nsearch must satisfy both of the conditions, and you use the OR operator to specify \nthat the search must satisfy at least one of the conditions. \n• \nYou can use the NOT operator to negate a condition. Because this can make the \nsearch condition unclear, you should rephrase the condition if possible so it doesn't \nuse NOT. \n• \nWhen MySQL evaluates a compound condition, it evaluates the operators in this \nsequence: (1) NOT, (2) AND, and (3) OR. You can use parentheses to override this \norder of precedence or to clarify the sequence in which the operations are evaluated. \nFigure 3-11 \nHow to use the AND, OR, and NOT logical operators\n\n96 \nSection 1 \nAn introduction to MySQL \nHow to use the IN operator \nFigure 3-12 shows how to code a WHERE clause that uses the IN operator. \nWhen you use this operator, the value of the test expression is compared with the \nlist of expressions in the IN phrase. If the test expression is equal to one of the \nexpressions in the list, the row is included in the query results. This is shown by \nthe first example in this figure, which returns all rows whose terms_id column is \nequal to 1, 3, or 4. \nYou can also use the NOT operator with the IN phrase to test for a value \nthat's not in a list of expressions. This is shown by the second example. Here, \nonly those vendors that aren't in California, Nevada, or Oregon are retrieved. \nAt the top of this figure, the syntax of the IN phrase shows that you can code \na subquery in place of a list of expressions. As you'll learn in chapter 7, subque-\nries are a powerful feature. For now, though, you should know that a subquery is \nsimply a SELECT statement within another statement. \nIn the third example, for instance, a subquery is used to return a list of \nvendor_id values for vendors who have invoices dated July 18, 2018. Then, the \nWHERE clause retrieves a row only if the vendor_id is in that list. Note that for \nthis to work, the subquery must return a single col11mn, in this case, vendor_id.\n\nChapter 3 \nHow to retrieve data from a sin.gle table \n97 \nThe syntax of the WHERE clause with an IN phrase \nWHERE test_expression [NOT] IN \n({subquerylexpression_ l [, expression_2 ] ... }) \nExamples of the IN phrase \nAn IN phrase with a list of numeric literals \nWHERE terms_ id IN (1, 3, 4) \nAn IN phrase preceded by NOT \nWHERE vendor_ state NOT IN ('CA', 'NV', 'OR') \nAn IN phrase with a subquery \nWHERE vendor id IN \n(SELECT vendor id \nFROM invoices \nWHERE invoice_date = \n1 2018-07-18 1\n) \nDescription \n• \nYou can use the IN phrase to test whether an expression is equal to a value in a list \nof expressions. Each of the expressions in the list is automatically converted to the \nsame type of data as the test expression. \n• \nThe list of expressions can be coded in any order without affecting the order of the \nrows in the result set. \n• \nYou can use the NOT operator to test for an expression that's not in the list of \n• \nexpressions. \n• \nYou can also compare the test expression to the items in a list returned by a \nsubquery. You'll learn more about coding subqueries in chapter 7. \nFigure 3-12 \nHow to use the IN operator\n\n98 \nSection 1 \nAn introduction to MySQL \nHow to use the BETWEEN operator \nFigure 3-13 shows how to use the BETWEEN operator in a WHERE clause. \nWhen you use this operator, the value of a test expression is compared to the \nrange of values specified in the BETWEEN phrase. If the value falls within this \nrange, the row is included in the query results. \nThe first example in this figure shows a simple WHERE clause that uses the \nBETWEEN operator. It retrieves invoices with invoice dates between June 1, \n2018 and June 30, 2018. Note that the range is inclusive, so invoices with invoice \ndates of June 1 and June 30 are included in the results. \nThe second example shows how to use the NOT operator to select rows \nthat aren't within a given range. In this case, vendors with zip codes that aren't \nbetween 93600 and 93799 are included in the results. \nThe third example shows bow you can use a calculated value in the test \nexpression. Here, the payment_total and credit_total columns are subtracted \nfrom the invoice_total column to give the balance due. Then, this value is \ncompared to the range specified in the BETWEEN pln·ase. \nThe last example shows how you can use calculated values in the \nBETWEEN phrase. Here, the frrst value is the credit_total column and the \nsecond value is the credit_total column plus 500. So the results include all those \ninvoices where the amount paid is between the credit amount and $500 more \nthan the credit amount.\n\nChapter 3 \nHow to retrieve datafrom a sin.gle table \n99 \nThe syntax of the WHERE clause with a BETWEEN phrase \nWHERE test_expression [NOT] BETWEEN begin_ expression AND end_ expression \nExamples of the BETWEEN phrase \nA BETWEEN phrase with literal values \nWHERE invoice_date BETWEEN '2018-06-01' AND '2018-06-30' \nA BETWEEN phrase preceded by NOT \nWHERE vendor_ zip_ code NOT BETWEEN 93600 AND 93799 \nA BETWEEN phrase with a test expression coded as a calculated value \nWHERE invoice_total -\npayment_total - credit_total BETWEEN 200 AND 500 \nA BETWEEN phrase with the upper and lower limits \ncoded as calculated values \nWHERE payment_ total BETWEEN credit_total AND credit_total + 500 \nDescription \n• \nYou can use the BETWEEN phrase to test whether an expression falls within a \nrange of values. The lower limit must be coded as the frrst expression, and the \nupper limit must be coded as the second expression. Otherwise, MySQL returns an \nempty result set. \n• \nThe two expressions used in the BETWEEN phrase for the range of values are \ninclusive. That is, the result set includes values that are equal to the upper or lower \nlimit. \n• \nYou can use the NOT operator to test for an expression that's not within the given \nrange. \nFigure 3-13 \nHow to use the BETWEEN operator\n\n100 \nSection 1 \nAn introduction to MySQL \nHow to use the LIKE and REGEXP operators \nTo retrieve rows that match a specific string pattern, or mask, you can use \nthe LIKE or REGEXP operators as shown in figure 3-14. The LIKE operator is \nan older operator that lets you search for simple string patterns. When you use \nthis operator, the mask can contain one or both of the wildcard symbols shown \nin the first table in this figure. \nIn contrast to the LIKE operator, the REGEXP operator allows you to create \ncomplex string patterns known as regular expressions. To do that, you can use \nthe special characters and constructs shown in the second table in this figure. \nAlthough creating regular expressions can be tricky at frrst, they allow you to \nsearch for virtually any string pattern. \nIn the first example in this figure, the LIKE phrase specifies that all vendors \nin cities that start with the letters SAN should be included in the query results. \nHere, the percent sign (%) indicates that any character or characters can follow \nthese three letters. So San Diego and Santa Ana are both included in the results. \nThe second example selects all vendors whose vendor name starts with the \nletters COMPU, followed by any one character, the letters ER, and any charac-\nters after that. The vendor names Compuserve and Computerworld both match \nthat pattern. \nIn the third example, the REGEXP phrase searches for the letters SA within \nthe vendor_city column. Since the letters can be in any position within the string, \nboth Pasadena and Santa Ana are included in the results. \nThe next two examples demonstrate how to use REGEXP to match a pattern \nto the beginning or end of the string being tested. In the fourth example, the \n1nask /\\SA matches the letters SA at the beginning of vendor_city, as in Santa \nAna and Sacramento. In contrast, the mask NA$ matches the letters NA at the \nend of vendor_city, as shown in the fifth example. \nThe sixth example uses the pipe ( I ) character to search fo1· either of two \nstring patterns: RS or SN. In this case, the first pattern would match Traverse \nCity and the second would match Fresno, so both are included in the result set. \nThe last four examples use brackets to specify multiple values. In the \nseventh example, the vendor_state column is searched for values that contain \nthe letter N followed by either C or V. That excludes NJ and NY. In contrast, the \neighth example searches for states that contain the letter N followed by any letter \nfrom A to J. Trus excludes NV and NY. \nThe ninth example searches the values in the vendor_contact_last_name \ncolumn for a name that can be spelled two different ways: Damien or Damion. \nTo do that, the mask specifies the two possible characters in the fifth position, E \nand 0 , within brackets. In the final example, the REGEXP phrase searches for a \nvendor_city that ends with any letter, a vowel, and then the letter N. \nBoth the LIKE and REGEXP operators provide powerful functionality for \nfinding information in a database. However, searches that use these operators \nsometimes run slowly since they can't use a table's indexes. As a result, you \nshould only use these operators when necessary.\n\nChapter 3 \nHow to retrieve data from a sin.gle table \n101 \nThe syntax of the WHERE clause with a LIKE phrase \nWHERE match_expression [NOT] LIKE pattern \nThe syntax of the WHERE clause with a REGEXP phrase \nWHERE match_expression [NOT] REGEXP pattern \nLIKE wildcards \nSymbol \nDescription \n~ \n0 \nMatches any string of zero or more characters. \nMatches any single character. \nREGEXP special characters and constructs \nCharacter/Construct \nDescription \nA \n$ \n• \nMatches the pattern to the beginning of the value being tested. \nMatches the pattern to the end of tl1e value being tested. \nMatches any single character . \n[charlist] \n[charl-char2] \nMatches any single character listed within the brackets. \nMatches any single character within the given range. \nSeparates two string patterns and matches either one. \nWHERE clauses that use the LIKE and REGEXP operators \nExample \nResults that match the mask \nWHERE vendor_city LIKE 'SAN%' \nWHERE vendor_nam~ LIKE \n1 COMPU_ER%1 \nWHERE vendor_city REGEXP \n1 SA 1 \nWHERE vendor_city REGEXP ,,.SA' \nWHERE vendor_ city REGEXP 'NA$' \nWHERE vendor_city REGEXP 'RSISN' \nWHERE vendor state REGEXP 'N[CV] 1 \nWHERE vendor_state REGEXP 'N[A-J] I \nWHERE vendor_contact_ last_ name REGEXP 'DAMI[EO]N' \nWHERE vendor_city REGEXP '[A-Z] [AEIOU]N$' \nDescription \n\"San Dieoo\" \"Santa Ana\" \nt, \n, \n\"Compus!rr,ve\", \"Comput~world\" \n\"Pasadena\" \"Santa Ana\" \n-\n' -\n\"Sa.11ta Ana'', \"Sacramento\" \n\"Gardena\" \"Pasadena\" \"Santa Ana\" \n-\n' \n-\n' \n-\n\"Trave!],e City\", \"Frefil}o\" \n\"NC\" and \"NV\" but not \"NJ\" or \"NY\" \n\"NC\" and \"NJ\" but not \"NV\" or \"NY\" \n\"Damien'' and \"Damion\" \n\"Boston\" \"Mclean\" \"Oberlin\" \n=\n• \n=\n• \n-\n• \nYou use the LIKE and REGEXP operators to retrieve rows that match a string pattern, \ncalled a mask. The mask determines which values in the column satisfy the condition. \n• \nThe mask for a LIKE phrase can contain special symbols, called wildcards. The mask \nfor a REGEXP phrase can contain special characters and constructs. Masks aren't \ncase-sensitive. \n• \nIf you use the NOT keyword, only those 1·ows with values that don't match the string \npattern are included in the result set. \n• \nMost LIKE and REGEXP phrases significantly degrade performance compared to \nother types of searches, so use the1n only when necessary. \nFigure 3-14 \nHow to use the LIKE and REGEXP operators\n\n102 \nSection 1 \nAn introduction to MySQL \nFor the sake of brevity, this chapter only presents the most common symbols \nthat are used in regular expressions. However, MySQL supports most of the \nsymbols that ru:e standard for creating regular expressions. Fo1· more information \nabout creating regular expressions, please consult the online MySQL Reference \nManual. If you 're familiar with using regular expressions in other programming \nlanguages such as PHP, you'll fmd that they work similarly in MySQL. \nIn addition to the REGEXP operator, MySQL 8.0 provides some new \nfunctions that work with regular expressions. You'll learn about these functions \nin chapter 9 when you learn about some other functions for working with strings. \nHow to use the IS NULL clause \nIn chapter 1, you learned that a column can contain a null value. A null value \nis typically used to indicate that a value is not known. A null value is not the \nsame as an empty string (' '). An empty st1·ing is typically used to indicate that \nthe value is known, and it doesn't exist. \nIf you're working with a database that allows null values, you need to know \nhow to test for them in search conditions. To do that, you use the IS NULL \nclause as shown in figm·e 3-15. \nThis figure uses a table named Null_Sample to show how to search for \nnull values. This table contains two columns: invoice id and invoice total. The \n-\n-\nvalues in this table are displayed in the first example. \nThe second example shows what happens when you retrieve all the rows \nwith invoice_total equal to zero. In this case, the row that has a null value isn't \nincluded in the resttlt set. As the third example shows, this row isn't included in \nthe result set when invoice_total isn't equal to zero either. Instead, you have to \nuse the IS NULL clause to retrieve rows with null values, as shown by the fourth \nexample. \nYou can also use the NOT operator with the IS NULL clause, as shown by \nthe last example. When you use this operator, all of the rows that don't contain \nnull values are included in the query results.\n\nChapter 3 \nHow to retrieve data f rom a sin.gle table \n103 \nThe syntax of the WHERE clause with the IS NULL clause \nWHERE expression IS [NOT] NULL \nThe contents of the Null_Sample table \nSELECT * FROM null_ sample \ninvoice_id \n► \n1 \n2 \n3 \n4 \n5 \ninvoice_total \n125.00 \n0.00 \n2199.99 \n0.00 \nA SELECT statement that retrieves rows with zero values \nSELECT* FROM null_ sample \nWHERE invoice_ total = 0 \ninvoice_id \n► \n2 \ns \ninvoice total \n0.00 \n0.00 \n-\nA SELECT statement that retrieves rows with non-zero values \nSELECT* FROM null_ sample \nWHERE invoice_ total <> O \ninvoice id \ninvoice total \n-\n-\n-\n► \n1 \n125.00 \n4 \n2199.99 \nA SELECT statement that retrieves rows with null values \nSELECT* FROM null_ sample \nWHERE invoic e _ t otal IS NULL \ninvoice id \ninvoice_total \n► \n3 \nIUIJII \nA SELECT statement that retrieves rows without null values \nSELECT* \nFROM null_ sample \nWHERE invoice_ total IS NOT NULL \ninvoice_id \ninvoice_total \n-\n► I i \n125.00 \n2 \n0.00 \n4 \n2199.99 \n5 \n0.00 \nDescription \n• \nA null value represents a value that's unknown, unavailable, or not applicable. It \nisn't the same as a zero or an empty string(\"). \nFigure 3-15 \nHow to use the IS NULL clause \nI \nV\n\n104 \nSection 1 \nAn introduction to MySQL \nHow to code the ORDER BY clause \nThe ORDER BY clause specifies the sort order for the rows in a 1·esult set. \nIn most cases, you '11 use column names from the base table to specify the sort \norder as you saw in some of the examples earlier in this chapter. However, you \ncan also use other techniques to sort the rows in a result set, as described in the \ntopics that follow. \nHow to sort by a column name \nFigure 3-16 presents the expanded syntax of the ORDER BY clause. This \nsyntax shows that you can sort by one or more expressions in either ascending \nor descending sequence. The three examples in this figure show how to code this \nclause for expressions that involve column names. \nThe first two examples show how to sort the rows in a result set by a \nsingle column. In the frrst example, the rows in the Vendors table are sorted in \nascending sequence by the vendor_name column. Since ascending is the default \nsequence, the ASC keyword can be omitted. In the second example, the rows are \nsorted by the vendor_name column in descending sequence. \nTo sort by more than one column, you simply list the names in the ORDER \nBY clause separated by commas as shown in the third example. This can be \nreferred to as a nested sort because one sort is nested within another. Here, \nthe rows in the Vendors table are first sorted by the vendor_state column in \nascending sequence. Then, within each state, the rows are sorted by the \nvendor_city column in ascending sequence. Finally, within each city, the rows \nare sorted by the vendor_name column in ascending sequence.\n\nChapter 3 \nHow to retrieve data from a sin.gle table \n105 \nThe expanded syntax of the ORDER BY clause \nORDER BY expression [ASCIDESC] [, expression [ASCIDESC]] ••. \nAn ORDER BY clause that sorts by one column in ascending sequence \nSELECT vendor_name, \nCONCAT(vendor_city, ', ', vendor_ state, ' ', vendor_ zip_ code) AS address \nFROM vendors \nORDER BY vendor_name \n..-------------------------------------, \nI vendor _name \naddress \n~ \n1 \n----, \n► \nAbbey Office Furnishings \nFresno, CA 93722 \n-\nAmencan Booksellers Assoc \nTarryto1A'rl, NY 10591 \nAmerican Express \nLos Angeles, CA 90096 \nASC Signs \nFresno, CA 93703 \nAn ORDER BY clause that sorts by one column in descending sequence \nSELECT vendor_name, \nCONCAT(vendor_city, ', •, vendor_ state, ' •, vendor_ zip_code) AS address \nFROM vendors \nORDER BY vendor_name DESC \nJ vendor _name \naddress \n► I Zylka Design \nFresno, CA 93711 \nZlp Print &. Copy Center \nFresno, CA 93777 \nZee Medical Service Co \nWashington, IA 52353 \nYesmed, Inc \nFresno, CA 93718 \nAn ORDER BY clause that sorts by three columns \nSELECT vendor_name, \nCONCAT(vendor_city, ', •, vendor_ state, ' ', vendor_ zip_code) AS address \nFROM vendors \nORDER BY vendor_ state, vendor_city, vendor_name \nvendor _name \naddress \n► \nAT&T \nPhoenix, AZ 85062 \nComputer Library \nPhoenix, AZ 85023 \nWells Fargo Bank \nPhoenix, AZ 85038 \nAztek Labe.l \nAnaheim, CA 92807 \nDescription \n• \nThe ORDER BY clause specifies how you want the rows in the result set sorted. \nYou can sort by one or more columns, and you can sort each column in either \nascending (ASC) or descending (DESC) sequence. ASC is the default. \n• \nBy default, in an ascending sort, special characters appear frrst in the sort \nsequence, followed by numbers, then letters. Thls sort order is determined by the \ncharacter set used by the server, wbjch you can change when you start the server. \n• \nNull values appear frrst in the sort sequence, even if you 're using DESC. \n• \nYou can sort by any column in the base table regardless of whether it's included \nin the SELECT clause. \nFigure 3-16 \nHow to sort by a column name \nA \n1--\n\"\"\n\n106 \nSection 1 \nAn introduction to MySQL \nHow to sort by an alias, expression, \nor column number \nFigure 3-17 presents three more techniques that you can use to specify sort \ncolumns. FiI·st, you can use a column alias that's defined in the SELECT clause. \nThe first SELECT statement in this figure, for example, sorts by a column \nnamed Address, which is an alias for the concatenation of the vendor_city, \nvendor_state, and vendor_zip_code columns. Notice that within the Address \ncolumn, the result set is also sorted by the vendor_name column. \nYou can also use an arithmetic or string expression in the ORDER BY \nclause, as shown by the second example in this figure. Here, the expression \nconsists of the vendor_contact_last_name column concatenated with the \nvendor_contact_first_name column. Notice that neither of these columns is \nincluded in the SELECT clause. Although MySQL allows this coding technique, \nmany other SQL dialects don't. \nThe last example in this figure shows how you can use column numbers to \nspecify a sort order. To use this technique, you code the number that corresponds \nto the column of the result set, where 1 is the first column, 2 is the second \ncolumn, and so on. In this example, the ORDER BY clause sorts the result set \nby the second column, which contains the concatenated address, then by the first \ncolumn, which contains the vendor name. As a result, this statement returns the \nsame result set that's returned by the first statement. \nHowever, the statement that uses column numbers is more difficult to \nread because you have to look at the SELECT clause to see what columns the \nnumbers refer to. In addition, if you add or remove columns from the SELECT \nclause, you may also have to change the ORDER BY clause to reflect the new \ncolumn positions. As a result, you should avoid using this technique in most \nsituations.\n\nChapter 3 \nHow to retrieve data from a sin.gle table \n107 \nAn ORDER BY clause that uses an alias \nSELECT vendor_name, \nCONCAT(vendor_city, ', ', vendor_ state, \nFROM vendors \nORDER BY address, vendor_name \nvendor _name \n► \nAztek Label \nBlue Shield of Califomla \nMalloy Lithographing Inc \nData Reproductions Corp \naddress \nAnaheim, CA 92807 \nAnaheim, CA 92850 \nAnn Arbor, MI 48106 \nAuburn Hills, MI 48326 \n• •, vendor_ zip_ code} AS address \nAn ORDER BY clause that uses an expression \nSELECT vendor_name, \nCONCAT(vendor_city, ', •, vendor_ state, \nFROM vendors \nORDER BY CONCAT(vendor_contact_last_name, \nvendor _name \n-\n► \nDristas Groom & McCormick \nInternal Revenue Service \nUS Postal Service \nYale Industrial Trucks-Fresno \naddress \nFresno, CA 93720 \nFresno, CA 93888 \nMadison, WI 53707 \nFresno, CA 93706 \n• •, vendor_ zip_code} AS address \nvendor contact first name} \n-\n-\n-\nAn ORDER BY clause that uses column positions \nSELECT vendor_ name, \nCONCAT(vendor_city, ', •, vendor_ state, ' ', vendor_ zip_code} AS address \nFROM vendors \nORDER BY 2, 1 \nvendor _name \naddress \n-\n► \nArtek Label \nAnaheim, CA 92807 \nBlue Shield of California \nAnahevn, CA 92850 \nMalloy Lithographing Inc \nAnn Arbor, MI 48106 \nData Reproductions Corp \nAuburn Kills, MI 4832-6 \nDescription \n• \nThe ORDER BY clause can include a column alias that's specified in the SELECT \nclause if the column alias does not include spaces. \n• \nThe ORDER BY clause can include any valid expression. The expression can refer \nto any column in the base table, even if it isn't included in the result set. \n• \nThe ORDER BY clause can use numbers to specify the columns to use for sorting. \nIn that case, 1 represents the frrst column in the result set, 2 represents the second \ncolumn, and so on. \nFigure 3-17 \nHow to sort by an alias, expression, or column number\n\n108 \nSection 1 \nAn introduction to MySQL \nHow to code the LIMIT clause \nThe LIMIT clause specifies the maximum number of rows that are returned \nin the result set. For most queries, you want to see the entire result set so you \nwon't use this clause. However, there may be times when you want to retrieve \njust a subset of a larger result set. \nFigure 3-18 presents the expanded syntax of the LIMIT clause. This clause \ncan take one or two arguments as shown by the three examples in this figure. \nHow to limit the number of rows \nIn its simplest form, you code the LIMIT clause with a single numeric \nargument. Then, the number of rows in the result set is, at most, the number you \nspecify. But if the result set is smaller than the number you specify, the LIMIT \nclause has no effect. \nIn the first example, the SELECT state1nent includes the LIMIT 5 clause, so \nthe entire result set is five rows. Without the LIMIT clause, this statement would \nreturn 114 rows. Because the result set is sorted by invoice_total in descending \nsequence, this result set represents the five largest invoices. \nHow to return a range of rows \nIf you code the optional offset argument of the LIMIT clause, it represents \nan offset, or starting point for the result set. This offset starts from a value of 0, \nwhich refers to the first row in the result set. In the second example, then, the \noffset is 2 so the result set starts with the third invoice. Then, since the row count \nis 3, the result set contains just 3 rows. \nSimilarly, the third example bas an offset of 100, so the result set starts with \nrow 101. Note that the row count for the LIMIT clause in this example is 1000. \nSince the table contains only 114 rows, though, the result set contains just the \nlast 14 rows in the table.\n\nChapter 3 \nHow to retrieve data from a sin.gle table \n109 \nThe expanded syntax of the LIMIT clause \nLIMIT [offset,] row_count \nA SELECT statement with a LIMIT clause that starts with the first row \nSELECT vendor_ id, invoice_ total \nFROM invoices \nORDER BY invoice_total DESC \nLIMIT 5 \nvendorjd \ninvoice_ total \n-\n► \n110 \n37966.19 \n110 \n26881 .40 \n110 \n23517.58 \n72 \n21842.00 \n110 \n20551. 18 \nA SELECT statement with a LIMIT clause that starts with the third row \nSELECT invoice_ id, vendor_ id, invoice_ total \nFROM invoices \nORDER BY invoice_ id \nLIMIT 2, 3 \ninvoice id -\nvendor_id \ninvoice total \n-\n-\n► \n3 \n123 \n138.75 \n4 \n123 \n144.70 \n5 \n123 \n15.50 \nA SELECT statement with a LIMIT clause that starts with the 101 st row \nSELECT invoice_ id, vendor_ id, invoice_total \nFROM invoices \nORDER BY invoice id \nLIMIT 100, 1000 \ninvoice id -\nvendor_id \ninvoice_total \n-\n► \n101 \n123 \n30.75 \n102 \n110 \n20551.18 \n103 \n122 \n2051.59 \n104 \n123 \n44.44 \n(14 rows ) \nDescription \n• \nYou can use the LIMIT clause to limit the number of rows returned by the SELECT \nstatement. This clause takes one or two intege1· arguments. \n• \nIf you code a single argument, it specifies the maximum row count, beginning with \nthe first row. If you code both arguments, the offset specifies the first row to return, \nwhere the offset of the first row is 0. \n• If you want to retrieve all of the rows from a certain offset to the end of the result \nset, code -1 for the row count. \n• \nTypically, you'll use an ORDER BY clause whenever you use the LIMIT clause. \nFigure 3-18 \nHow to code the LIMIT clause \n'\n\n110 \nSection 1 \nAn introduction to MySQL \nPerspective \nThe goal of this chapter has been to teach you the basic skills for coding \nSELECT statements. As a result, you'll use these skills in almost every \nSELECT statement you code. \nAs you'll see in the next chapter and in chapters 6 and 7, though, there's \na lot more to coding SELECT statements than what's presented here. In these \nchapters, then, you'll learn additional skills for coding SELECT statements. \nWhen you complete these chapters, you' 11 know everything you need to know \nabout retrieving data from a MySQL database. \nTerms \nkeyword \nbase table \nsearch condition \nfilter \nBoolean expression \n• \nexpression \ncolumn alias \narithmetic expression \narithmetic operator \norder of precedence \nliteral value \nstring \nfunction \nargument \nExercises \nparameter \nconcatenate \ncomparison operator \nlogical operator \ncompound condition \nsubquery \nstring patten1 \nmask \nwildcard \nregular expression \nnull value \nnested sort \noffset \nRun some of the examples in this chapter \nIn these exercises, you '11 use MySQL Workbench to run some of the scripts for \nthe examples in this chapter. This assumes that you already know how to use \nMySQL Workbench, as described in chapter 2. \n1. \nStart MySQL Workbench. \n2. \nOpen the script named 3-02.sql that you should fmd in this directory: \nc:\\murach\\rnysql\\book_scripts\\ch03. When it opens, you should see all of the \nqueries for figure 3-2. Note that each of these queries has a semicolon at the \nend of it. \n3. \nMove the insertion point into the first query and press Ctrl+Enter or click on \nthe Exectite Current Statement button to run the query. This shows you the \ndata that's in the Invoices table that you'll be working with in this chapter. \n4. \nMove the insertion point into the second query and run it.\n\nChapter 3 \nHow to retrieve data from a sin.gle table \n111 \n5. \nOpen the script named 3-05.sql in the ch03 directory. Then, run the second \nquery. When you do, you '11 see that the 1·esult set is in sequence by the \ninvoice id column. \n6. \nDelete the ORDER BY clause from the SELECT statement and run the query \nagain. Scroll through the result set to see that the rows are no longer in a \nparticular sequence. When you 're done, close the script without saving the \nchanges. \n7. \nOpen and run the queries for any of the other examples in this chapter that \nyou're interested in reviewing. \nEnter and run your own SELECT statements \nIn these exercises, you'll enter and run your own SELECT statements. To do \nthat, you can open the script for an example that is similar to the state1nent you \nneed to write, copy the statement into a new SQL tab, and modify the statement. \nThat can save you both time and syntax errors. \n8. \nWrite a SELECT statement that returns three columns fro1n the Vendors table: \nvendor_11ame, vendor_contact_last_naine, and vendor_contact_first_naine. \nThen, run this statement to make sure it works correctly. \nAdd an ORDER BY clause to this state1nent that sorts the result set by last \nname and then first name, both in ascending sequence. Then, run this state-\nment again to make sure it works correctly. This is a good way to build and \ntest a statement, one clause at a time. \n9. \nWrite a SELECT statement that returns one column from the Vendors table \nnamed full_name that joins the vendor_contact_last_name and \nvendor contact first name columns. \n-\n-\n-\nFor1nat this column with the last name, a co1nma, a space, and the first 11arne \nlike this: \nDoe, John \nSort the result set by last name and then first name in ascending sequence. \nReturn only the contacts whose last name begins with the letter A, B, C, or E. \nThis should retrieve 41 rows. \n10. Write a SELECT statement that returns these column names and data from \nthe Invoices table: \nDue Date \nThe invoice due date column \nInvoice Total \nThe invoice total colu1nn \n10% \nlOo/o of the value of invoice total \nPlus lOo/o \nThe value of invoice_total plus 10% \nReturn only the rows with an invoice total that's greater than or equal to 500 \nand less than or equal to 1000. This should retrieve 12 rows. \nSort the result set in descending sequence by invoice_due_date.\n\n112 \nSection 1 \nAn introduction to MySQL \n11. Write a SELECT statement that returns these columns from the Invoices \ntable: \ninvoice number \n-\ninvoice total \n-\npayment_credit_total \nbalance_due \nThe invoice number column \n-\nThe invoice total column \nSum of the payment_total and credit_total \ncolumns \nThe invoice total column minus the \npayment_total and credit_total columns \nReturn only invoices that have a balance due that's greater than $50. \nSort the result set by balance due in descending sequence. \nUse the LIMIT clause so the result set contains only the rows with the 5 \nlargest balances. \nWork with nulls and test expressions \n12. Write a SELECT statement that returns these columns from the Invoices \ntable: \ninvoice number \n-\ninvoice date \n-\nbalance due \npayment_date \nThe invoice_number column \nThe invoice date column \nThe invoice_tota] column minus the payment_total \nand credit total columns \nThe payment_date column \nReturn only the rows where the payment_date column contains a null value. \nThis should retrieve 11 rows. \n13. Write a SELECT statement without a FROM clause that uses the \nc ·URRENT DATE function to return the current date in its default format. \nUse the DATE FORMAT function to format the current date in this format: \nnun-dd-yyyy \nThis displays the month, day, and four-digit year of the current date. \nGive this column an alias of current_date. To do that, you must enclose the \nalias in quotes since that name is already used by the CURRENT_DATE \nfunction. \n14. Write a SELECT statement without a FROM clause that creates a row with \nthese columns: \nstarting_principal \ninterest \nprincipal_plus_interest \nStarting principal of $50,000 \n6.5% of the principal \nThe principal plus the interest \nTo calculate the third column, add the expressions you used fo1· the first two \ncolumns.\n\nHow to retrieve data \nfrom two or more tables \nln the last chapter, you lea111ed how to create result sets that contain data from a \nsingle table. Now, this chapter shows you how to create result sets that contain \ndata from two or more tables. To do that, you can use an inner join, an outer \n• \n• \n• \nJOin, or a union. \nHow to work with inner joins ............................................. 114 \nHow to code an i11ner join ............................................................................ 114 \nHow to use table aliases ............................................................................... 116 \nHow to join to a table in another database .................................................. 118 \nHow to use compound join conditions ........................................................ 120 \nHow to use a self-join .................................................................................. 122 \nHow to join more than two tables ................................................................ 124 \nHow to use the implicit inner join syntax .................................................... 126 \nHow to work with outer joins ............................................. 128 \nHow to code an outer join ............................................................................ 128 \nOuter join examples ...................................................................................... 130 \nOther skills for working with joins .................................... 134 \nHow to join tables with the USING keyword .............................................. 134 \nHow to join tables with the NATURAL keyword ....................................... 136 \nHow to use cross joins ....................................................................................... 138 \nHow to work with unions ................................................... 140 \nHow to code a union .................................................................................... 140 \nA union that combines result sets from different tables .............................. 140 \nA union that combines result sets from the same tables ............................. 142 \nA union that simulates a full outer join ....................................................... 144 \nPerspective ......................................................................... 146\n\n114 \nSection 1 \nAn introduction to MySQL \nHow to work with inner joins \nA join lets you combine columns from two or more tables into a single result \nset. To start, this chapter shows how to code the most common type of join, an \n• \n• \n• \ninner JOtn. \nHow to code an inner join \nFigure 4-1 shows how to use the explicit syntax to code an inner join. This \nsyntax is also called the SQL-92 syritax because it was introduced by the SQL-92 \nstandards. It's generally considered a best p1·actice to use this syntax. \nTo join data from two tables, you code the names of the two tables in the \nFROM clause along with the JOIN keyword and an ON phrase that specifies \nthe join condition. The join condition indicates how the two tables should be \ncompared. In most cases, they're compared based on the relationship between \nthe primary key of the first table and a foreign key of the second table. \nIn this figure, for example, the SELECT statement joins data from the \nVendors and Invoices tables based on the vendor_id column in each table. Since \nthe join condition uses the equal operator, the value of the vendor_id column in a \nrow in the Vendors table must match the vendor_id in a row in the Invoices table \nfor that row to be included in the result set. In other words, only vendors with \none or more invoices are included. Although you code most inner joins using \nthe equal operator, you can compare two tables based on other conditions too. \nFor example, you can use the greater than or less than operators for an inner join \ncondition. \nIn this figure, the Vendors table is joined with the Invoices table using \na column that has the same name in both tables: vendor_id. As a result, the \ncolumns must be qualified so MySQL can tell which table they come from. To \ncode a qualified column name, you can enter the table name and a pe1iod in front \nof the column name. In this figure, the SELECT statement only uses quali-\nfied column names in the join condition. However, you must qualify a column \nname anywhere it appears in the statement if the same name occurs in both \ntables. If you don't, MySQL returns an error indicating that the column name is \nambiguous.\n\nChapter 4 \nHow to retrieve data f rom two or m.ore tables \n115 \nThe explicit syntax for an inner join \nSELECT select_ list \nFROM table_ l \n[INNER] JOIN table_ 2 \nON join_condition_ l \n[[INNER] JOIN table_ 3 \nON join_condition_ 2] ... \nAn inner join of the Vendors and Invoices tables \nSELECT invoice_number, vendor_name \nFROM vendors INNER JOIN invoices \nON vendors.vendor_ id = invoices.vendor_id \nORDER BY invoice_number \ninvoice_number \nvendor name \n-\n-\n► \n0-2058 \nMalloy Lithographing Inc \n0-2060 \nMalloy Lithographing Inc \n0-2436 \nMalloy Lithographing Inc \n1-200-5164 \nFederal Express Corporation \n1-202-2978 \nFederal Express Corporation \n10843 \nYesmed,Inc \n(114 rows ) \nDescription \n• \nA join combines columns from two or more tables into a result set based on the \njoin conditions you specify. For an inner join, only those rows that satisfy the join \ncondition are included in the result set. \n• \nA join condition names a column in each of the two tables involved in the join and \nindicates how the two columns should be compared. In most cases, you use the \nequal operator to retrieve rows with matching columns. However, you can also use \nany of the other comparison operators in a join condition. \n• \nTables are typically joined on the relationship between the primary key in one table \nand a foreign key in the other table. However, you can also join tables based on \nrelationships not defined in the database. These are called ad hoc r·elationships. \n• \nIf the two co]umns in a join condition have the same name, you must qualify them \nwith the table name so MySQL can distinguish between them. To code a qitalified \ncolumn name, type the table name, followed by a period, followed by the column \nname. \nNote \n• \nThe INNER keyword is optional and is seldom used. \nFigure 4-1 \nHow to code an inner join \n\" L\n\n116 \nSection 1 \nAn introduction to MySQL \nHow to use table aliases \nWhen you name a table to be joined in the FROM clause, you can refer to \nthe table by an alias as shown in figure 4-2. A table alias is an alternative table \nname that's typically just a letter or two. This makes it easier to qualify the \ncolumn names in the rest of the statement, and it makes the query easier to code \nand read, especially when the table names are long. \nThe first example in this figure joins data from the Vendors and Invoices \ntables. Here, both tables have been assigned aliases that consist of a single letter. \nThe second example only assigns an alias to the second table, not the first. \nHere, the alias shortens the name of the Invoice_Line_Items table to just \nLine_ltems. As a result, the shorter name can be used to refer to the invoice_id \ncolumn of the table in the join condition. Although you can use this technique \nwhen you code a query, most programmers use abbreviations of the table names \nas shown in the first example and throughout the rest of this chapter. \nAfter you assign a table alias, you must use the alias in ,place of the original \ntable name throughout the query. Otherwise, MySQL returns an error message \ninstead of a result set.\n\nChapter 4 \nHow to retrieve data f rom two or m.ore tables \n117 \nThe syntax for an inner join that uses table aliases \nSELECT select_ list \nFROM table_ l al \n[INNER] JOIN table_ 2 a2 \nON al.colwnn_ name operator a2.colwnn_name \n[[INNER] JOIN table_ 3 a3 \nON a2.colwnn_ name operator a3.colwnn_name] ••• \nAliases for all tables \nSELECT invoice_number, vendor_name, invoice_due_date, \ninvoice_ total - payment_total - credit total AS balance due \nFROM vendors v JOIN invoices i \nON v.vendor_ id = i.vendor_ id \nWHERE invoice_total - payment_total - credit total> 0 \nORDER BY invoice_due_date DESC \ninvoice_nurnber \nvendor _name \ninvoice_due_date \nbalance_due \n► \n547480102 \nBlue Cross \n2018-08-31 \n224.00 \n0-2436 \nMalloy Lithographing Inc \n2018-08-30 \n10976.06 \n9982nl \nFord Motor Crecfrt Company \n2018-08-23 \n503. 20 \nP-0608 \nMalloy Lithographing Inc \n2018-08-22 \n19351.18 \n(11 rows) \nAn alias for only one table \nSELECT invoice_n.11mhAr, line_ item_ amnunt, line_ item_description \nFROM invoices JOIN invoice_line_ items line_ items \nON invoices.invoice id= line items.invoice id \nWHERE account_number = 540 \nORDER BY invoice date \nf invoice_number \nline item amount \nline j tern_ desoiption \n-\n-\n► \nm211-001 \n478.00 \nPubftshers Marketing \n972110 \n207. 78 \nProspect &st \n133560 \n175-.00 \nCard deck advertising \n197/522 \n765.13 \nCatalog design \n(6 rows ) \nDescription \n• \nA table cilias is an alternative table name assigned in the FROM clause. You can use \nan alias, which is typically just a letter or two, to make a SQL statement easier to \ncode and read. \n• \nIf you assign an alias to a table, you must use that alias to refer to the table \nthroughout your query. You can't use the original table name. \n• \nYou ca11 use an alias for one table in a join without using an alias for another table. \nFigure 4-2 \nHow to use table aliases \nL \nV \n1\n\n118 \nSection 1 \nAn introduction to MySQL \nHow to join to a table in another database \nIf you use the procedure described in appendix A (Windows) or appendix \nB (macOS) of this book to create the databases for this book, all of the tables \nare organized into three databases, which are also known as sche,nas. First, all \ntables pertaining to accounts payable such as the Vendors and Invoices tables are \nstored in the database, or schema, named AP. Then, all tables pertaining to order \nmanagement are stored in a database named OM. Finally, all tables that are used \nby the smaller examples presented in this book are stored in a database named \nEX. \nWhen you use MySQL Workbench to run a query against a database, you \ndon't need to qualify any table name with its database name. For example, when \nyou run a query against the AP database, you don't need to qualify the Vendors \ntable with the name of the database. \nHowever, you may occasionally need to join to a table that's in another \ndatabase. To do that, you must qualify the table name in the other database by \nprefixing the table name with the database name. For example, let's say you need \nto join the Vendors table in the AP database with the Customers table in the OM \ndatabase. To do that, you need to qualify the Customers table with the name of \nthe database as shown in figt1re 4-3.\n\nChapter 4 \nHow to retrieve data from two or m.ore tables \n119 \nThe syntax of a table name that's qualified with a database name \ndatabase_name.table_ name \nJoin to a table in another database \nSELECT vendor_ name, customer_ last_ name, customer_ first_ name, \nvendor_state AS state, vendor_city AS city \nFROM vendors v \nJOIN om.customers c \nON v.vendor_ zip_code = c.customer_ zip \nORDER BY state, city \n~ \nvendor name \nrustomer _last_name \nrustomer first name \nWells Fa~go Bank \n-\n-\nMarissa \nKyle \nAzteklabel \nIrvin \nAnia \nZylka Design \nHolbrooke \nRashad \nLou Gentile's Flower Basket \nDamien \nDeborah \nCostco \nNeftaly \nThalia \nCostco \nHo!brooke \nRashad \nShields Design \nDamien \nDeborah \nWakefield Co \nHolbrooke \nRashad \nWakefield Co \nNeftaly \nThaffa \nGary McKeighan Insl.l' ance \nNeftaly \nThalia \nGary Mc:Keighan lnsllance \nHolbrooke \nRashad \nDigital Dreamwori<s \nNeftaly \nThaffa \n(37 rows) \nDescription \nstate \ncity \nAl. \nPhoenix \nCA \nAnaheim \nCA \nFresno \nCA \nFresno \nCA \nFresno \nCA \nFresno \nCA \nFresno \nCA \nFresno \nCA \nFresno \nCA \nFresno \nCA \nFresno \nCA \nFresno \n• \nA MySQL server can store tables in multiple databases. These databases are \nsometimes refe1Ted to as schemas. \n• \nWhen you run a SELECT statement against one database, you can join to a table in \nanother database if you have appropriate privileges. To do that, you must prefix the \ntable name in the other database with the name of that database. \nFigure 4-3 \nHow to join to a table in another database\n\n120 \nSection 1 \nAn introduction to MySQL \nHow to use compound join conditions \nAlthough a join condition typically consists of a single comparison, you can \ninclude two or more co1nparisons in a join condition using the AND and OR \noperators. Figure 4-4 shows how this works. \nThe query in tllis figure uses the AND operator to return the frrst and last \nnames of all customers in the Customers table whose frrst and last names also \nexist in the Employees table. Since Thomas Hardy is the only name that exists in \nboth tables, this is the only row that's returned in the result set for this query.\n\nChapter 4 \nHow to retrieve data from two or m.ore tables \nThe Customers table \nrustomerJd \nrustomer _last_name \nrustomer _first_name \ncustomer _address \nrustomer _city \nrustomer _state \"\" \n► \n1 \nAnders \nMaria \n345WinchellPI \n2 \nTrujillo \nAna \n1298 E Smathers St \n3 \nMoreno \nAntonio \n6925 N Parkland Ave \n4 \nHardy \nThomas \n83 d'Urberville Ln \n5 \nBerglund \nChristina \n22717E 73rd Ave \n6 \nMoos \nHanna \n1778 N Bovine Ave \n7 \nCiteaux \nFred \n1234Main St \n< \n(24 rows) \nThe Employees table \nemployeejd \nlast_name \nfirst_name \ndepartment_JlUJTiber \nmanagerJd \n► \n1 \nSmith \nCindy \n2. \nOOJ◄I \n2 \nJones \n8mer \n4 \n1 \n3 \nSimonian \nRalph \n2 \n2. \n4 \nHernandez \nOlivia \n1 \n9 \n5 \nAaronsen \nRobert \n2. \n4 \n6 \nWatson \nDenise \n6 \n8 \n7 \nHardy \nThomas \n5 \n2 \n(9 rows) \nAn inner join with two conditions \nSELECT customer_first_ name, customer_ last_name \nFROM customers c JOIN employees e \nON c.customer first name= e.first_ name \nAND c.customer_ last_name = e.last_name \nrustomer _first_name \nrustomer last name \n-\n-\n--+--\n► \nThomas \nHardy \n(1 row) \nDescription \nAnderson \nIN \nBenton \nAR \nPuyaftup \n'vVA \nCasterbridge \nGA \nDubuque \nIA \nPeona \nIL \nNormal \nIL \n• \nA join condition can include two or more conditions connected by AND or OR \noperators. \nFigure 4-4 \nHow to use compound join conditions \nL \n'V \n> \n121\n\n122 \nSection 1 \nAn introduction to MySQL \nHow to use a self-join \nA self-join. joins a table to itself. Although self-joins are rare, they are \nsometimes useful for retrieving data that can't be retrieved any other way. For \nexample, figure 4-5 presents a self-join that returns rows from the Vendors table \nwhere the vendor is in a city and state that has at least one other vendor. In other \nwords, it does not return a vendor if that vendor is the only vendor in that city \nand state. \nSince this example uses the same table twice, it must use aliases to distin-\nguish one occurrence of the table from the other. In addition, this query must \nqualify each column name with a table alias since every column occurs in both \ntables. \nThen, the join condition uses three comparisons. The first two match the \nvendor_city and vendor_state columns in the two tables. As a result, the query \nreturns rows for vendors that are in the same city and state as another vendor. \nHowever, since a vendor resides in the same city and state as itself, a third \ncomparison is included to exclt1de rows that match a vendor with itself. To do \nthat, this condition uses the not-equal operator to compare the vendor_name \ncolumns in the two tables. \nIn addition, this statement includes the DISTINCT keyword. That way, a \nvendor appears only once in the result set. Otherwise, a vendor would appear \nonce for every other row with a matching city and state. For example, if a vendor \nis in a city and state that has nine other vendors in that city and state, this query \nwould return nine rows for that vendor. \nThis example also shows how you can use columns other than key columns \nin a join condition. Keep in nund, however, that this is an unusual situation and \nyou 're not likely to code joins like this often.\n\nChapter 4 \nHow to retrieve data f rom two or m.ore tables \n123 \nA self-join that returns vendors from cities in common with other vendors \nSELECT DISTINCT vl.vendor_name, vl.vendor_ city, \nvl.vendor_ state \nFROM vendors vl JOIN vendors v2 \nON vl.vendor_city = v2.vendor_city AND \nvl.vendor_state = v2.vendor_state AND \nvl.vendor_name <> v2.vendor_name \nORDER BY vl.vendor_state, vl.vendor_city \n__l vendor _name \nvendor_dty \nvendor _state \n► \nComputer Library \nPhoenix \nAZ \nAT&T \nPhoenix \nAZ \nWells Fargo Bank \nPhoenix \nAZ \nAztel< Label \nAnaheim \nCA \nBlue Shield of California \nAnaheim \nCA \nAbbey Office Fumshings \nFresno \nCA \n1 \nCalifornia Business Machines \nFresno \nCA \nPostmaster \nFresno \nCA \n(84 rows) \nDescription \n• \nA self-join is a join that joins a table with itself. \n• \nWhen you code a self-join, you must use aliases for the tables, and you must \nqualify each column name with the alias. \nFigure 4-5 \nHow to use a self-join\n\n124 \nSection 1 \nAn introduction to MySQL \nHow to join more than two tables \nSo far, this chapter has only showed how to join data from two tables. \nHowever, it's common for programmers to need to join data from more than \ntwo tables. For example, it's not unheard of to need to join 10 or more tables. \nFortunately, once you code the join condition correctly, you can often reuse it. \nThe SELECT statement in figure 4-6 joins data from four tables: Vendors, \nInvoices, Invoice_Line_Items, and General_Ledger_Accounts. Each of the \njoins is based on the relationship between the primary key of one table and a \nforeign key of the other table. For example, the account_number column is the \nprimary key of the General_Ledger_Accounts table and a foreign key of the \nInvoice Line Items table. \n-\n-\nThis SELECT statement also begins to show how table aliases make a state-\nment easier to code and read. Here, the one-letter and two-letter aliases that are \nused for the tables allow you to code the ON clause more concisely.\n\nChapter 4 \nHow to retrieve data from two or m.ore tables \nA statement that joins four tables \nSELECT vendor_name, invoice_number, invoice_date, \nline_ item_amount, account_description \nFROM vendors v \nJOIN invoices i \nON v.vendor_id = i.vendor_id \nJOIN invoice_line_ items li \nON i.invoice_id = li.invoice_ id \nJOIN general_ledger_accounts gl \nON li. account_number = gl. account_n11mher \nWHERE invoice_total - payment_total - credit_total > 0 \nORDER BY vendor_name, line_item_amount DESC \nL \nvendor _name \ninvoice number \ninvoice date \nline item amount \naccount_desaiption \n-\n-\n-\n-\n► \nBlueO-oss \n547480102 \n2018-08-01 \n224.00 \nGroup Insurance \nCardinal Business Media, Inc. \n134116 \n2018-07·28 \n90.36 \nDirect Mail AdverbStng \nData Reproductions Corp \n39104 \n2018-07-10 \n85.31 \nBook Printing Costs \nFederal Express Corporation \n263253270 \n2018-07·22 \n67.92 \nFreight \nFederal Express Corporation \n263253268 \n2018-07-21 \n59.97 \nFreight \nFederal Express Corporation \n963253264 \n2018-07·18 \n52.25 \nFreight \nFederal Express Corporation \n263253273 \n2018-07·22 \n30.75 \nFreight \nI \nFord Motor Credit Company \n9982nl \n2018-07·24 \n503.20 \nTravel and Accomodations \n(11 rows ) \nDescription \n• \nYou can think of a multi-table join as a series of two-table joins proceeding from \nleft to right. \nFigure 4-6 \nHow to join more than two tables \n125\n\n126 \nSection 1 \nAn introduction to MySQL \nHow to use the implicit inner join syntax \nAlthough it's generally considered a best practice to use the explicit inner \njoin syntax described earlier in this chapter, MySQL also provides the implicit \ninner join syntax shown in figure 4-7. This syntax was widely used prior to the \nintroduction of the explicit syntax. You should be familiar with the older implicit \nsyntax mainly because you may need to maintain existing SQL statements that \nuse it. \nWhen you use the implicit syntax for an inner join, you code the tables in the \nFROM clause separated by commas. Then, you code the join conditions in the \nWHERE clause. \nThe first SELECT statement joins data from the Vendors and Invoices tables. \nLike the SELECT statement shown in figure 4-1, this statement joins these tables \non an equal comparison between the vendor_id columns in the two tables. In this \ncase, though, the comparison is coded as the search condition of the WHERE \nclause. However, both of these statements return the same result set. \nThe second SELECT statement uses the implicit syntax to join data from \nfour tables. This is the same join you saw in figure 4-6. In this example, the three \njoin conditions are combined in the WHERE clause using the AND operator. In \naddition, an AND operator is used to combine the join conditions with the search \ncondition. \nBecause the explicit syntax for joins lets you separate join conditions from \nsearch conditions, statements that use the explicit syntax are typically easier to \nread than those that use the implicit syntax. In addition, the explicit syntax helps \nyou avoid a common coding mistake with the implicit syntax: omitting the join \ncondition. As you '11 learn later in this chapter, an implicit join without a join \ncondition results in a cross join, which can 1·etum a lru·ge number of rows. For \nthese reasons, we recommend that you use the explicit syntax in all your new \nSQL code.\n\nChapter 4 \nHow to retrieve data from two or m.ore tables \n127 \nThe implicit syntax for an inner join \nSELECT select_list \nFROM table_ l, table_ 2 [, table_ 3] ••• \nWHERE table_ l.column_name operator table_2.column_name \n[AND table_2.column_name operator table_ 3.column_name] ••• \nJoin the Vendors and Invoices tables \nSELECT invoice_n,,rnber, vendor_name \nFROM vendors v, invoices i \nWHERE v.vendor_id = i.vendor_id \nORDER BY invoice_ n11mbP.r \ninvoice number \n-\nvendor _name \n-\n► \n0-2058 \nMalloy Lithographing Inc \n0-2060 \nMalloy Lithographing Inc \n0-2436 \nMalloy Lithographing Inc \n1-200-5164 \nFederal Express Corporation \n1-202-2978 \nFederal Express Corporation \n10843 \nYesmed, Inc \n(114 rows) \nJoin four tables \nSELECT vendor_name, invoice_number, invoice_date, \nline_item_amount, account_description \nFROM \nvendors v, invoices i, invoice_line_ items li, \ngeneral_ledger_accounts gl \nWHERE v.vendor id= i.vendor id \nAND i.invoice_id = li.invoice_id \nAND li. account_n,,rnbP.r = gl. account_number \nAND invoice_total - payment_total - credit_total > 0 \nORDER BY vendor_name, line_item_amount DESC \n_ l vendor _name \n► \nBlue Cross \nCardinal Business Mec.fia, Inc. \nData Reproductions Corp \nFederal Express Corporation \nFederal Express Corporation \nFederal Express Corporation \nFederal Express Corporation \ninvoice number \n547480102 \n134116 \n39104 \n263253270 \n263253268 \n963253264 \n263253273 \nFord Motor Credit Company \n9982n1 \n(11 rows) \nDescription \ninvoice_date \n2018-08-01 \n2018-07-28 \n2018-07-10 \n2018-07-22 \n2018-07-21 \n2018-07-18 \n2018-07-22 \n6ne_item_amoun t \naccount_ description \n224,00 \nGroup Insurance \n90.36 \nDirect Mail Advertising \n85.31 \nBook Prinbng Costs \n67.92 \nFreight \n59. 97 \nFreight \n52,25 \nFreight \n30. 75 \nFreight \n2018-07-24 \n503.20 \nTravel and Accomodations \n• \nInstead of coding a join condition in the FROM clause, you can code it in the \nWHERE clause along with any seai·ch conditions. In that case, you list the tables in \nthe FROM clause separated by commas. \n• \nThis syntax for coding joins is referred to as the implicit syntax. It was used prior to \nthe SQL-92 standards, which introduced the explicit syntax. \nFigure 4-7 \nHow to use the implicit inner join syntax \nI\n\n128 \nSection 1 \nAn introduction to MySQL \nHow to work with outer joins \nAlthough inner joins are the most common type of join, MySQL also \nsupports outer joins. Unlike an inner join, an outer join returns all of the rows \nfrom one of the tables involved in the join, regardless of whether the join condi-\ntion is true. \nHow to code an outer join \nFigure 4-8 presents the explicit syntax for coding an outer join. Because this \nsy.ntax is similar to the explicit syntax for inner joins, you shouldn't have any \ntrouble understanding how it works. The main difference is that you include the \nLEFT or RIGHT keyword to specify the type of outer join you want to perform. \nYou can also include the OUTER keyword, but it's optional and is usually \nomitted. \nWhen you use a left outer join, the result set includes all the rows from \nthe first, or left, table. Similarly, when you use a right outer join, the result set \nincludes all the rows from the second, or right, table. \nThe example in this figure illustrates a left outer join. Here, the Vendors \ntable is joined with the Invoices table. In addition, the result set includes vendor \nrows even if no matching invoices are found. In that case, null values are \nreturned for the columns in the Invoices table.\n\nChapter 4 \nHow to retrieve data f rom two or m.ore tables \n129 \nThe explicit syntax for an outer join \nSELECT select_ list \nFROM table_ l \n{LEFTIRIGHT} [OUTER] JOIN table_ 2 \nON join_condition_ l \n[{LEFTIRIGHT} [OUTER] JOIN table_ 3 \nON join_condition_ 2] ... \nWhat outer joins do \nJoins of this type \nRetrieve unmatched rows from \nLeft outer join \nRight outer join \nA left outer join \nThe first (left) table \nThe second (right) table \nSELECT vendor_ name, invoice_number, invoice_total \nFROM vendors LEFT JOIN invoices \nON vendors.vendor_ id = invoices.vendor_id \nORDER BY vendor_name \n_J vendor _name \n► \nAbbey Office Furnishings \nAmerican Booksellers Assoc \nAmerican Express \n-\nASCSigns \nI \nAse.om Hasler Mailing Systems \n(202 rows) \nDescription \ninvoice_number \nnvoice_total \n203339-13 \n17.50 \nl)QJ!t \n'®'' \nHWSI \nUPJII \nOPill \nUl9!1 \nl:tt!I \n• \nAn outer join 1·etrieves all rows that satisfy the join condition, plus unmatched rows \nin the left or right table. \n• \nIn most cases, you use the equal operator to retrieve rows with matching columns. \nHowever, you can also use any of the other comparison operators. \n• \nWhen a row with unmatched columns is retrieved, any columns from the other \ntable that are included in the result set are given null values. \nNote \n• \nThe OUTER keyword is optional and typically omitted. \nFigure 4-8 \nHow to code an outer join\n\n130 \nSection 1 \nAn introduction to MySQL \nOuter join examples \nTo give yot1 a better understanding of how outer joins work, figure 4-9 \nshows four more examples. To start, part 1 of this figure shows the Departments \ntable, the Employees table, and the Projects table from the EX database. These \ntables are used by the examples shown in parts 2 and 3 of this figure. In addition, \nthey're used in other examples later in this chapter. \nThe first example performs a left outer join on the Departments and \nEmployees tables. Here, the join condition joins the tables based on the values in \ntheir department_number columns. Then, the result set produced by this state-\nment, shows that department number 3 (Operations) is included in the result set \neven though none of the employees in the Employees table work in that depart-\nment. As a result, MySQL assigns a null value to the last_name column from \nthat table. \nThe second example uses a right outer join to join the Departments and \nEmployees table. In this case, all of the rows from the Employees table are \nincluded in the result set. However, two of the employees, Locario and Watson, \nare assigned to a department that doesn't exist in the Departments table. If \nthe department_number column in the Employees table had been defined as \na foreign key to the Departments table, this would not have been allowed by \nMySQL. In this case, though, a foreign key wasn't defi11ed, so null values are \nreturned for the department_name column in these two rows. \nWhen coding outer joins, it's a common practice to avoid using right joins. \nTo do that, yot1 can substitute a left outer join for a right outer join by reversing \nthe order of the tables in the FROM clause and using the LEFT keyword instead \nof RIGHT. This often makes it easier to read statements that join more than two \ntables. \nThe tlru:d example shows that you can use outer joins to work with more \nthan two tables. To do that, you use skills similar to those that you use to work \nwith inner joins with more than two tables. In this example, the statement uses \nleft outer joins to join all three tables: Departments, Employees, and Projects. \nBecause of this, the result set uses a null value to show that none of the \nemployees are assigned to the Operations department. In addition, the result set \nuses null values to show that two employees, Hardy and Jones, aren't assigned to \na project. \nThe fourth example shows that you can combine inner joins and outer joins \nin the same query. Here, the query works like the third example, but it uses \nan inner join for the frrst join instead of a left outer join. Because of this, the \nresult set doesn't include a row for the Operations department. However, it still \ndisplays the rows for the two employees, Hardy and Jones, that aren't assigned \nto a project.\n\nChapter 4 \nHow to retrieve data from two or m.ore tables \n131 \nThe Departments table \ndepartment_number \ndepartment_name \n-\n► \n1 \nAccounting \n2 \nPayroU \n3 \nOperations \n4 \nPersonnel \n5 \nMaintenance \nThe Employees table \nI employeejd \nlast_name \nfirst_name \ndepartment_number \nmanager,Jd \n► \n1 \nSmith \nCindy \n2 \nU®Mi \n2 \nJones \nElmer \n4 \n1 \n3 \nSimonian \nRalph \n2 \n2 \n4 \nHernandez \nOlivia \n1 \n9 \n5 \nAaronsen \nRobert \n2 \n4 \n6 \nWatson \nDenise \n6 \n8 \n7 \nHardy \nThomas \n5 \n2 \n8 \nO'Leary \nRhea \n4 \n9 \n9 \nLocario \nPaulo \n6 \n1 \nThe Projects table \n_j project_number \nemployee_id \n► \nPlOll \n8 \nPlOll \n4 \nP1012 \n3 \nP1012 \n1 \nP1012 \ns \nP1013 \n6 \nP1013 \n9 \nP1014 \n10 \nDescription \n• \nThe examples in this figure use the Departments, Employees, and Projects tables \nfrom the EX database. \nFigure 4-9 \nOuter join examples (part 1 of 3) \n17\n\n132 \nSection 1 \nAn introduction to MySQL \nA left outer join \nSELECT department_ name, d.department_number, last_name \nFROM departments d \nLEFT JOIN employees e \nON d.department_number = e.department_number \nORDER BY department_name \ndepartment_name \ndepartment_number \nlast_name \n► \nAccounting \n1 \nHernandez \nMaintenance \ns \nHardy \nOperations \n3 \nHlf191 \nPayroO \n2 \nSmith \nPayroU \n2 \nSimonian \nPayroO \n2 \nAaronsen \nPersonnel \n4 \nJones \nPersonnel \n4 \nO'Leary \n(8 rows) \nA right outer join \nSELECT department_ name, e.department_number, last_name \nFROM departments d \nRIGHT JOIN employees e \nON d.department_number = e.department_number \nORDER BY department_name \ndeparbnent_name \ndeparbnent_number \nlast name \n-\n-\n► \n6 \nWatson \n6 \nLocario \nAccounting \n1 \nHernandez \nMahtenance \ns \nHardy \nPayroD \n2 \nSmith \nPayroO \n2 \nSimonian \nPayroll \n2 \nAaronsen \nPersonnel \n4 \nJones \nPersonnel \n4 \nO'leary \n(9 rows) \nDescription \n• \nA left outer join returns unmatched rows from the first (left) table. \n• \nA right outer join returns unmatched rows from the second (right) table. \nFigure 4-9 \nOuter join examples (part 2 of 3)\n\nChapter 4 \nHow to retrieve data from two or m.ore tables \nJoin three tables using left outer joins \nSELECT department_ name, last_name, project_nwnber \nFROM departments d \nLEFT JOIN employees e \nON d.department_nwnber = e.department_ nwnber \nLEFT JOIN projects p \nON e.employee_ id = p.employee_ id \nORDER BY department_name, last_name \n__l department_name \nlast name \nproject_number \n-\n► \nAccounting \nHernandez \nPlOll \nMaintenance \nHardy \nIU991 \nOperations \nD©91 \n11®11 \nPayroD \nAaronsen \nPlOU \nPayroU \nSimonian \nPlOU \nPayroll \nSmith \nPlOU \nPersonnel \nJones \nOWII \nPersonnel \nO'Leary \nP1011 \n(8 rows ) \nCombine an outer and an inner join \nSELECT department_name, last_name, project_nwnber \nFROM departments d \nJOIN employees e \nON d. department_nwnber = e. department_ n11mber \nLEFT JOIN projects p \nON e.employee_ id = p.employee_ id \nORDER BY department_name, last_name \n~ \n~ \ndepartment_name \nlast name \nproject_number \n-\nAccounting \nHernandez \nP10 11 \nMaintenance \nHardy \nIU991 \nPayroD \nAaronsen \nPlOU \nPayroll \nSimonian \nPlOU \nPayroll \nSmith \nPlOU \nPersonnel \nJones \n0®91 \nPersonnel \nO'Leary \nPlOll \n( 7 rows) \nDescription \n• \nYou can use outer joins to join multiple tables. \n• \nYou can combine inner and outer joins within a single SELECT statement. \nFigure 4-9 \nOuter join examples (part 3 of 3) \n133\n\n134 \nSection 1 \nAn introduction to MySQL \nOther skills for working with joins \nNow that you know how to work with inner and outer joins, you 're ready to \nlearn how to join tables with the USING and NATURAL keywords. In addition, \nyou're ready to learn about another type of join, called a cross join. \nHow to join tables with the USING keyword \nWhen you use the equal operator to join two tables on a common column, \nthe join can be referred to as an equijoin (or an eqiti-join). When you code an \nequijoin, it's common for the columns that are being compared to have the same \nname. For joins like these, you can simplify the query with the USING keyword. \nTo do that, you code a USING clause instead of an ON clause to specify the join \nas shown in figure 4-10. \nThe first example in this figure shows how to join the Vendors and Invoices \ntables on the vendor id column with a USING clause. This returns the same \nresults as the query shown in figure 4-1 that uses the ON clause. However, the \nUSING clause only works because the vendor_id column exists in both the \nVendors and Invoices tables. \nThe second example shows how to join the Departments, Employees, and \nProjects tables with the USING keyword. Here, the first USING clause uses an \ninner join to join the Departments table to the Employees table on the depart-\nment_number column. Then, the second USING clause uses a left join to join \nthe Employees table to the Projects table on the employee_id column. This \nshows that you can use a USING clause for both inner and outer joins, and this \nquery returns the same result as the last query shown in figure 4-9. \nIn some rare cases, you may want to join tables by multiple columns. To \ndo that with a USING clause, you can code multiple column names within the \nparentheses, separating the column names with commas. This yields the same \nresult as coding two equijoins connected with the AND operator. \nSince the USING clause is more concise than the ON clause, it can make \nyour code easier to read and maintain. As a result, it often makes sense to use the \nUSING clause when you're developing new statements. However, if you can't \nget the USING clause to work correctly because of the way your database is \nstructured, you can always use the ON clause instead.\n\nChapter 4 \nHow to retrieve data from two or m.ore tables \n135 \nThe syntax for a join that uses the USING keyword \nSELECT select_list \nFROM table_ l \n[{LEFT IRIGHT} [OUTER]] JOIN table_ 2 \nUSING (join_colwnn_ l[, join_colwnn_ 2] ••• ) \n[[{LEFT IRIGHT} [OUTER]] JOIN table_ 3 \nUSING (join_ colwnn_ l[, join_colwnn_ 2] ••• )] • •• \nUse the USING keyword to join two tables \nSELECT invoice_number, vendor_name \nFROM vendors \nJOIN invoices USING (vendor_ id) \nORDER BY invoice_number \ninvoice_number \nvendor name \n-\n-\n-\n► \n0-2058 \nMalloy Lithographing Inc \n0-2060 \nMalloy Lithographing Inc \n0-2436 \nMalloy Lithographing Inc \n1-200-5164 \nFederal Express Corporation \n1-202-2978 \nFederal Express Corporation \n10843 \nYesmed, Inc \n(114 rows) \nUse the USING keyword to join three tables \nSELECT department_name, last_name, project_number \nFROM departments \nJOIN employees USING (department_ number) \nLEFT JOIN projects USING (employee_id) \nORDER BY department_name \nf department_name \nlast name \nproject_number \n-\n-\n► \nAccounting \nHernandez \nP1011 \nMaintenance \nHardy \n00991 \nPayroD \nSimonian \nPlOU \nPayroll \nSmi1h \nPlOU \nPayroll \nAaronsen \nPlOU \nPersonnel \nO'Leary \nP1011 \nPersonnel \nJones \nt:[991 \n(7 rows) \nDescription \n• \nYou can use the USING keyword to simplify the syntax for joining tables. \n• \nThe join can be an inner join or an outer join. \n• \nThe tables must be joined by a column that bas the same name in both tables. \n• \nTo include multiple colu1nns, separate them with commas. \n• \nThe join must be an equijoin, which means that the equals operator is used to \ncompare the two columns. \nFigure 4-1 0 \nHow to join tables with the USING keyword \nL \nI \nI\n\n136 \nSection 1 \nAn introduction to MySQL \nHow to join tables with the NATURAL keyword \nFigure 4-11 shows how to use the NATURAL keyword to code a natural \njoin. When you code a natural join, you don't specify the column that's used to \njoin the two tables. Instead, the database automatically joins the two tables based \non all columns in the two tables that have the same name. As a result, this type \nof join only works correctly if the database is designed in a certain way. \nFor instance, if you use a natural join to join the Vendors and Invoices tables \nas shown in the first example, the join works correctly because these tables only \nhave one column in common: the vendor_id column. As a result, the database \njoins these two tables on the vendor_id column. However, if these tables had \nanother column in common, this query would attempt to join these tables on \nboth columns and wot1ld yield unexpected results. \nIn addition, you may get unexpected results if you use natural joins for \ncomplex queries. In that case, you can use the USING or ON clause to explicitly \nspecify the join since these clauses give you more control over the join. If neces-\nsary, you can mix a natural join with the USING or ON clause within a single \nSELECT statement. In this figure, for example, the second SELECT statement \nuses a natural join for the first join and a USING clat1se for the second join. The \nresult is the same as the result for the second statement in figure 4-10. \nFinally, since natural joins don't explicitly specify the join colu1nn, they may \nnot work correctly if the structure of the database changes later. So although \nnatural joins are easy to code, you'll usually want to avoid using them for \nproduction code.\n\nChapter 4 \nHow to retrieve data f rom two or m.ore tables \n137 \nThe syntax for a join that uses the NATURAL keyword \nSELECT select_ list \nFROM table_ l \nNATURAL JOIN table_ 2 \n[NATURAL JOIN table 3] ••• \nUse the NATURAL keyword to join tables \nSELECT invoice_n,,rnber, vendor_name \nFROM vendors \nNATURAL JOIN invoices \nORDER BY invoice_ n11mhP.r \ninvoice number \nvendor _name \n-\n-\n► \n0-2058 \nMalloy Lithographing Inc \n0-2060 \nMalloy Lithographing Inc \no-2.q36 \nMalloy Lithographing Inc \n1-200-5164 \nFederal Express Corporation \n1-202-2978 \nFederal Express Corporation \n108-13 \nYesmed, Inc \n(114 rows) \nUse the NATURAL keyword in a statement that joins three tables \nSELECT departrnent_name AS dept_name, last_name, project_number \nFROM departments \nNATURAL JOIN employees \nLEFT JOIN projects USING (employee_ id) \nORDER BY departme.nt_name \ndept_name \nlast_name \nproject_number \n► \nAccounting \nHernandez \nPlOll \nMaintenance \nHardy \nUPJ!I \nPayroD \nSimonian \nPlOU \nPayroD \nSmith \nP1012 \nPayroD \nAaronsen \nP1012 \nPersonnel \nO'Leary \nPlDll \nPersonnel \nJones \nIIOJ!I \n(7 rows ) \nDescription \n• \nYou can use the NATURAL keyword to create a natural join that joins two tables \nbased on all columns in the two tables that have the same name. \n• \nAlthough the code for a nat1rral join is shorter than the code for joins that use \nthe ON or USING clause, a natural join only works correctly for ce1tain types of \ndatabase structures. In addition, a natural join often yields unexpected results for \ncomplex queries. As a rest1lt, it's more common to t1se the ON or USING clause to \njoin tables. \nFigure 4-11 \nHow to join tables with the NATURAL keyword\n\n138 \nSection 1 \nAn introduction to MySQL \nHow to use cross joins \nA cross join produces a result set that includes each row from the first \ntable joined with each row fro1n the second table. The result set is known as \nthe Cartesian product of the tables. Figure 4-12 shows how to code a cross join \nusing either the explicit or implicit syntax. \nTo use the explicit syntax, you include the CROSS JOIN keywords between \nthe two tables in the FROM clause. Because of the way a cross join works, you \ndon't code an ON clause that includes a join condition. The same is true when \nyou use the implicit syntax. In that case, you simply list the tables in the FROM \nclause and omit the join condition from the WHERE clause. \nThe two SELECT statements in this figure illustrate how cross joins work. \nBoth of these statements combine data from the Departments and Employees \ntables. For both statements, the result is a table that includes 45 rows. That's \neach of the five rows in the Departments table combined with each of the nine \nrows in the Employees table. Although this result set is relatively small, you can \nimagine how large it would be if the tables included hundreds or thousands of \nrows. \nAs you study these examples, you should realize that cross joins have few \npractical uses. As a result, you'll rarely, if ever, need to use one. In fact, you're \nmost likely to code a cross join by accident if you use the implicit join syntax \nand forget to code the join condition in the WHERE clause. That's one of the \nreasons why it's generally considered a good practice to use the explicit join \nsyntax.\n\nChapter 4 \nHow to retrieve data f rom two or m.ore tables \n139 \nHow to code a cross join using the explicit syntax \nThe explicit syntax for a cross join \nSELECT select_list \nFROM table_ l CROSS JOIN table_ 2 \nA cross join that uses the explicit syntax \nSELECT departments.department_number, department_name, employee_id, \nlast name \nFROM departments CROSS JOIN employees \nORDER BY departments. department_n,,rnber \ndepartment_number \ndepartment_name \nemployeejd \nlast_name \n► \n1 \nAccounting \n2 \nJones \n1 \nAccounting \n7 \nHardy \n1 \nAccounting \n4 \nHernandez \n1 \nAccounbng \n1 \nSmith \n1 \nAccounting \n9 \nLocar10 \n(45 rows) \nHow to code a cross join using the implicit syntax \nThe implicit syntax for a cross join \nSELECT select_ list \nFROM table_l, table_2 \nA cross join that uses the implicit syntax \nSELECT departments. department_n,1rnber, department_name, employee_id, \nlast name \nFROM departments, employees \nORDER BY departments.department_number \ndepartment_number \ndepartment_name \nemployee_id \nlast name \n-\n► \n1 \nAccounting \n2 \nJones \n1 \nAccounting \n7 \nHardy \n1 \nAccounting \n4 \nHernandez \n1 \nAccounting \n1 \nSrruth \n1 \nAccounting \n9 \nLocario \n(45 rows) \nDescription \n• \nA cross join joins each row from the first table with each row from the second \ntable. The resuJt set returned by a cross join is known as a Cartesian product. \nFigure 4-12 \nHow to use cross joins \n'--\n\n140 \nSection 1 \nAn introduction to MySQL \nHow to work with unions \nLike a join, a uriion combines data from two or more tables. Instead of \ncombining columns from base tables, however, a union combines rows from two \nor more result sets. \nHow to code a union \nFigure 4-13 shows how to code a union. To start, you use the UNION \nkeyword to connect two or more SELECT statements. For this to work, the result \nof each SELECT statement must have the same number of columns, and the data \ntypes of the corresponding columns in each table must be compatible. \nIn this figure, we have indented all of the SELECT statements that are \nconnected by the UNION operator to make it easier to see how this statement \nworks. However, in a production environment, it's common to see the SELECT \nstatements and the UNION operator coded at the same level of indentation. \nIf you want to sort the result of a union operation, you can code an ORDER \nBY clause after the last SELECT statement. In an ORDER BY clause, you must \nuse the column names that are specified in the frrst SELECT statement. That's \nbecause the column names in the first SELECT statement are the ones that are \nused in the final result set. \nBy default, a union operation removes duplicate rows from the result set. \nIf that's not what you want, you can include the ALL keyword. In most cases, \nthough, you'll omit this keyword. \nA union that combines result sets \nfrom different tables \nThe example in figure 4-13 shows how to use a union to combine data from \ntwo different tables. In this case, the Active_Invoices table contains invoices with \noutstanding balances, and the Paid_Invoices table contains invoices that have \nbeen paid in full. Both of these tables have the same structure as the Invoices \ntable that's been used in this book so far. \nThis union operation combines the rows in both tables that have an invoice \ndate on or after June 1, 2018. Here, the first SELECT statement includes a \ncolumn named source that contains a literal value of ''Active.\" Then, the second \nSELECT statement includes a column by the same name, but it contains a literal \nvalue of ''Paid.\" This column is used to indicate which table each row in the \nresult set came from. \nAlthough this column is assigned the same name in both SELECT state-\nments, you don't have to use the same name for corresponding columns. That's \nbecause the corresponding relationships are determined by the order in which the \ncolumns are coded in the SELECT clauses, not by their names. When you use \ncolumn aliases, though, you'll typically assign the same name to corresponding \ncolumns so the statement is easier to understand.\n\nChapter 4 \nHow to retrieve data f rom two or m.ore tables \n141 \nThe syntax for a union operation \nSELECT_ statement_ l \nUNION [ALL] \nSELECT_ statement_ 2 \n[UNION [ALL] \nSELECT_ statement_ 3] ... \n[ORDER BY order_by_ list] \nA union that combines result sets from two different tables \nSELECT 'Active• AS source, invoice_number, invoice_date, invoice_total \nFROM active_ invoices \nWHERE invoice_date >= '2018-06-01' \nUNION \nSELECT 'Paid' AS source, invoice_numher, invoice_date, invoice total \nFROM paid_ invoices \nWHERE invoice_date >= \n1 2018-06-01 1 \nORDER BY invoice_ total DESC \nsource \ninvoice_number \ninvoice_date \ninvOlce _total \n-\n► \nActive \n40318 \n2018-07-18 \n21842.00 \nPaid \nP02-3772 \n2018-06-03 \n7125.3-1 \nPaid \n10843 \n2018-06-0-1 \n4901.26 \nPaid \n77290 \n2018-06-04 \n1750.00 \nPaid \nRTR-72-3662-X \n2018-06-0-1 \n1600.00 \nPaid \n75C-90227 \n2018-06-06 \n1367.50 \nPaid \nP02-88D77S7 \n2018-06-06 \n856.92 \nActive \nI7n71-001 \n2018-06-05 \n662.00 \nI \nActive \n9982nl \n2018-06-03 \n503.20 \n(22 rows) \nDescription \n• \nA union combines the result sets of two or more SELECT statements into one \nresult set. \n• \nEach result set must return the same number of columns, and the corresponding \ncolumns in each result set must have compatible data types. \n• \nBy default, a union eliminates duplicate rows. If you want to include duplicate \nrows, code the ALL keyword. \n• \nThe column names in the final result set are taken from the first SELECT clause. \nColumn aliases assigned by the other SELECT clauses have no effect on the final \nresult set. \n• \nTo sort the rows in the fmal result set, code an ORDER BY clause after the last \nSELECT statement. This clause must refer to the column names assigned in the \nfirst SELECT clause. \nFigure 4-13 \nHow to combine result sets from different tables\n\n142 \nSection 1 \nAn introduction to MySQL \nA union that combines result sets \nfrom the same tables \nThe first example in figure 4-14 shows how to use unions to combine result \nsets created from a single table. In this example, rows from the Invoices table \nthat have a balance due are combined with rows from the same table that ru:e \npaid in full. As in the previous figure, a column named source is added at the \nbeginning of each result set. That way, the final result set indicates whether each \ninvoice is active or paid. \nThe second example shows how to use unions to combine result sets created \nfrom the same two tables after they have been joined. Here, each SELECT \nstate1nent joins data from the Invoices and Vendors tables. The frrst SELECT \nstatement retrieves invoices with totals greater than $10,000. Then, it calculates \na payment of 33% of the invoice total. The two other SELECT statements are \nsimilar. The second one retiieves invoices with totals between $500 and $10,000 \nand calculates a 50% payment. And the third one retrieves invoices with totals \nless than $500 and sets the payment amount at 100% of the total. Although \nthis isn't the n1ost practical example, it helps illustrate the flexibility of union \noperations. \nIn both of these examples, the same column aliases are assigned in each \nSELECT statement. Although the aliases in the second and third SELECT state-\nments are optional, they make the query easier to read. In particular, they make \nit easy to see that the three SELECT statements have the same number and types \nof columns.\n\nChapter 4 \nHow to retrieve data from two or m.ore tables \nA union that combines result sets from a single table \nSELECT 'Active' AS source, invoice_number, invoice_date, invoice_total \nFROM invoices \nWHERE invoice_ total - payment_total - credit_ total > 0 \nUNION \nSELECT 'Paid' AS source, invoice_ number, invoice_date, invoice_ total \nFROM invoices \nWHERE invoice_total - payment_total - credit_total <= 0 \nORDER BY invoice_total DESC \nsource \ninvoice_number \ninvoice_date \ninvoice_total \n-\n► \nPaid \n0-2058 \n2018-05-28 \n37966.19 \nPaid \nP-0259 \n2018-07-19 \n26881.40 \nPaid \n0-2060 \n2018-07-24 \n23517.58 \nPaid \n40318 \n2018-06--01 \n21842.00 \nActive \nP-0608 \n2018-07-23 \n20551.18 \nActive \n0-2436 \n2018,-07-31 \n10976.06 \n(114 rows ) \nA union that combines result sets from the same two tables \nL , \nV \nSELECT invoice_number, vendor_name, '33% Payment' AS payment_type, \ninvoice_total AS total, invoice_total * 0.333 AS payment \nFROM invoices JOIN vendors \nON invoices.vendor_id = vendors.vendor_ id \nWHERE invoice_total > 10000 \nUNION \nSELECT invoice_number, vendor_ name, '50% Payment' AS payment_type, \ninvoice_total AS total, invoice_total * 0.5 AS payment \nFROM invoices JOIN vendors \nON invoices.vendor_ id = vendors.vendor_ id \nWHERE invoice total BETWEEN 500 AND 10000 \nUNION \nSELECT invoice_number, vendor_ name, 'Full amount' AS payment_type, \ninvoice_total AS total, invoice_total AS payment \nFROM invoices JOIN vendors \nON invoices.vendor_ id = vendors.vendor_ id \nWHERE invoice total < 500 \nORDER BY payment_type, vendor_name, invoice_ number \n-\n► \ninvoice_number \n40318 \n0-2058 \n0-2060 \n0-2436 \nP-0259 \nP-0608 \n509786 \n(114 rows ) \nvendor _name \nData Reproductions Corp \nMalloy Lithographing Inc \nMalloy Lithographing Inc \nMalloy Lithographing Inc \nMaUoy Lithographing Inc \nMalloy Lithographing Inc \nBertelsmann Industry Svcs. Inc \npayment_type \n33o/o Payment \n33%Payment \n33%Payment \n33%Payment \n33%Payment \n33% Payment \n50°/4 Payment \ntotal \n21842.00 \n37966.19 \n23517. 58 \n10976.06 \n26881.40 \n20551.18 \n6g,.q().25 \npayment \n7273.38600 \n126-42. 74127 \n7831.35414 \n3655.02798 \n8951.50620 \n6843.54294 \n3470.12500 \nFigure 4-14 \nHow to combine result sets from the same tables \n-\nI---\nI \n143\n\n144 \nSection 1 \nAn introduction to MySQL \nA union that simulates a full outer join \nAfull outer join. returns unmatched rows from both the left and right tables. \nAlthough MySQL doesn't provide language for coding a full outer join, you can \nsimulate a full outer join by coding a union that combines the result sets for a \nleft outer join and a right outer join as shown in figu1·e 4-15. \nThe example in this figure uses the UNION keyword to combine the result \nsets for the left and 1ight outer joins shown in figure 4-9. As a result, this \nexample returns all the rows from the Departments and Employees tables even if \nthese rows don't have matching columns in the other table. \nTo make it easier to identify the unmatched rows, this statement includes \nthe department_number column from both tables. This shows that two rows in \nthe Employees table don't have matching rows in the Departments table, and \nit shows that one row in the Departments table doesn't have a matching row in \nthe Employees table. In other words, two employees haven't been assigned to a \ndepartment, and one depa1tment doesn't have any employees.\n\nChapter 4 \nHow to retrieve data from two or m.ore tables \n145 \nA union that simulates a full outer join \nSELECT department_name AS dept_name, d.department_ n11mber AS d_ dept_no, \ne.department_number AS e _dept_no, last_ name \nFROM departments d \nLEFT JOIN employees e \nON d. department_number = e. department_ n11mber \nUNION \nSELECT department_ name AS dept_name, d.department_number AS d_ dept_ no, \ne.department_number AS e _dept_no, last_ name \nFROM departments d \nRIGHT JOIN employees e \nON d. department_number = e. department_ n11mber \nORDER BY dept_name \n► \ndept_name \nAccounting \nMaintenance \nOperations \nPayroll \nPayroll \nPayroll \nI \nPersonnel \nPersonnel \n(10 rows ) \nDescription \nd_dept_no \n01611 \nffi991 \n1 \n5 \n3 \n2 \n2 \n2 \n4 \n4 \ne_dept_no \nlast_name \n6 \nWatson \n6 \nlocario \n1 \nHernandez \n5 \nHardy \n001!1 \nlit!lil \n2 \nSmith \n2 \nSimonian \n2 \nAaronsen \n4 \nJones \n4 \nOleary \n• \nWhen you use afull outer join, the result set includes all the 1·ows from both tables. \n• \nMySQL doesn't provide language keywords for full outer joins, but you can \nsimulate a full outer join by using the UNION keyword to combine the result sets \nfrom a left outer join and a right outer join. \nFigure 4-15 \nHow to simulate a full outer join\n\n146 \nSection 1 \nAn introduction to MySQL \nPerspective \nIn this chapter, you learned a variety of techniques for combining data \nfrom two or more tables into a single result set. In particular, you learned how \nto use the explicit syntax to code inner joins. Of all the techniques presented in \nthis chapter, this is the one you'll use most often. So you'll want to be sure you \nunderstand it thorough! y before you go on. \nTerms \n• \n• \nJOin \njoin condition \n• \n• \n• \nmner JOtn \nad hoc relationship \nqualified column name \nexplicit syntax \nSQL-92 syntax \ntable alias \nschema \nself-join \nExercises \nimplicit syntax \nouter join \nleft outer join \nright outer join \n• • \n• \neqUIJOlll \nnatural join \n• \n• \ncross JOtn \nCa1tesian product \n• \nunion \nfull outer join \n1. \nWrite a SELECT statement that returns all columns from the Vendors table \ninner-joined with all columns from the Invoices table. This should return 114 \nrows. Hint: You can use an asterisk(*) to select the columns from both tables. \n2. \nWrite a SELECT statement that returns these four columns: \nvendor name \n-\ninvoice number \ni11voice date \nbalance due \nThe vendor_name column from the Vendors table \nThe invoice number column from the Invoices table \nThe invoice date coltrmn from the Invoices table \nThe invoice_total column minus the payment_total \nand credit_total columns from the Invoices table \nUse these aliases for the tables: v for Vendors and i for Invoices. \nReturn one row for each invoice with a non-zero balance. This should return \n11 rows. \nSort the result set by vendor_name in ascending order. \n3. \nWrite a SELECT statement that returns these three columns: \nvendor name \n-\ndefault account \n-\ndescription \nThe vendor name column from the Vendors table \n-\nThe default account number column from the \n-\n-\nVendors table \nThe account_description column from the \nGeneral_Ledger_Accounts table \nReturn one row for eac.h vendor. This should return 122 rows. \nSort the result set by account_description and then by vendor_name.\n\nChapter 4 \nHow to retrieve data from two or m.ore tables \n147 \n4. \nWrite a SELECT statement that returns these five columns: \nvendor name \ninvoice date \n-\ninvoice number \nli_sequence \nIi amount \nThe vendor name column from the Vendors table \n-\nThe invoice date column from the Invoices table \n-\nThe invoice number column from the Invoices table \nThe invoice_sequence column from the \nInvoice_Line_Items table \nThe line item amount column from the \n-\n-\nInvoice_Line_Items table \nUse aliases for the tables. This should return 118 rows. \nSort the final result set by vendor_name, invoice_date, invoice_number, and \n• \n• \n1n voice _sequence. \n5. \nWrite a SELECT statement that returns three columns: \nvendor id \nvendor name \ncontact_name \nThe vendor id column from the Vendors table \nThe vendor name column from the Vendors table \nA concatenation of the vendor_contact_first_name \nand vendor_contact_last_name columns with a space \nbetween \nReturn one row for each vendor whose contact has the same last name as \nanother vendor's contact. This should return 2 rows. Hint: Use a self-join to \ncheck that the vendor_id columns aren't equal but the \nvendor _contact_last_name colu,nns are equal. \nSort the result set by vendor_contact_last_name. \n6. \nWrite a SELECT statement that returns these three columns: \naccount number \n-\naccount_ description \ninvoice id \nThe account number column from the \nGeneral_Ledger_Accounts table \nThe account_description column from the \nGeneral_Ledger_Accounts table \nThe invoice id column from the \n-\nInvoice Line Items table \n-\n-\nReturn one row for each account number that has never been used. This \nshould return 54 rows. Hint: Use an outer join and only return rows where the \ninvoice_id column contains a null value. \nRemove the invoice_id column from the SELECT clause. \nSort the final result set by the account_number column. \n7. \nUse the UNION operator to generate a result set consisting of two columns \nfrom the Vendors table: vendor_name and vendor_state. If the vendor is in \nCalifornia, the vendor_state value should be ''CA''; otherwise, the \nvendor_state value should be ''Outside CA.\" Sort the final result set by \nvendor name.\n\nHow to insert, update, \nand delete data \nln the last two chapters, you learned how to code the SELECT statement to \nretrieve and summarize data. Now, you'll learn how to code the INSERT, \nUPDATE, and DELETE statements to modify the data in a table. When you 're \ndone with this chapter, you' 11 know bow to code the four statements that are \nused every day by professional application developers. \nAs you read this chapter, keep in mind that by defau]t, MySQL automati-\ncally conunits changes to the database immediately after each INSERT, \nUPDATE, or DELETE statement is executed. Usually, that's what you want. \nIf it isn't, you can refer to chapter 14 to learn how to turn off auto-commit \nmode. \nHow to create test tables ................................................... 150 \nHow to create the tables for this book ......................................................... 150 \nHow to create a copy of a table .................................................................... 150 \nHow to insert new rows ..................................................... 152 \nHow to insert a single row ........................................................................... 152 \nHow to insert multiple rows ......................................................................... 152 \nHow to insert default values and null values ............................................... 154 \nHow to use a subquery in an INSERT statement ........................................ 156 \nHow to update existing rows ............................................. 158 \nHow to update rows ..................................................................................... 158 \nHow to use a subquery in an UPDATE statement ....................................... 160 \nHow to delete existing rows .............................................. 162 \nHow to delete rows ................. ...................................................................... 162 \nHow to use a subquery in a DELETE statement ......................................... 162 \nPerspective ......................................................................... 164\n\n150 \nSection 1 \nAn introduction to MySQL \nHow to create test tables \nBefore you begin experimenting with INSERT, UPDATE, and DELETE \nstatements, you need to make sure that your experimentation won't affect ''live'' \ndata that's used by other people at your business or school. \nHow to create the tables for this book \nIf you 're only working with the tables for this book, you can use the proce-\ndure shown in appendix A (Windows) or B (1nacOS) to create the tables for this \nbook. Then, you can experiment all you want without worrying about how much \nyou change these tables. If yot1 ever want to restore these tables to their original \nstate, you can use the procedure shown in the appendix to do that. \nHow to create a copy of a table \nIf you're working with tables that are running on a server that's available \nfrom your business or school, it's usually a good idea to create a copy of some \nor all of a table before you do any testing. To do that, you can use the CREATE \nTABLE AS statement with a SELECT statement as shown in figure 5-1 . When \nyou use this technique, the result set that's defmed by the SELECT statem.ent \nis copied into a new table. Then, you can experiment all you want with the test \ntable and delete it when you 're done. \nWhen you use this technique to create tables, MySQL only copies the \ncolumn definitions and data. In other words, MySQL doesn't retain other parts \nof the column definitions such as primary keys, foreign keys, and indexes. As \na result, when you experiment with copied tables, you may get different results \nthan you would get with the original tables. Still, this is usually preferable to \nexperimenting with live data. \nThe examples in this figure show how to use the CREATE TABLE AS \nstatement. Here, the frrst example copies all of the columns from all of the \nrows in the Invoices table into a new table named Invoices_ Copy. The second \nexample copies all of the columns in the Invoices table into a new table named \nOld_lnvoices, but only for rows where the balance due is zero. And the third \nexample c1·eates a table that contains summary data from the Invoices table. \nWhen you're done experimenting with test tables, you can use the DROP \nTABLE statement that's shown in this figure to delete any tables you don't need \nanymore. In this figure, for instance, the fourth example shows how to drop the \nOld Invoices table. \n-\n\nClzapter 5 \nHow to insert, update, and delete data \n151 \nThe syntax of the CREATE TABLE AS statement \nCREATE TABLE table_name AS select_ statement \nCreate a complete copy of the Invoices table \nCREATE TABLE invoices_copy AS \nSELECT* \nFROM invoices \nCreate a partial copy of the Invoices table \nCREATE TABLE old_ invoices AS \nSELECT* \nFROM invoices \nWHERE invoice_ total - payment_total - credit_total = 0 \nCreate a table with summary rows from the Invoices table \nCREATE TABLE vendor_balances AS \nSELECT vendor_ id, SUM(invoice_total) AS sum_of_ invoices \nFROM invoices \nWHERE (invoice_total - payment_total - credit_total) <> 0 \nGROUP BY vendor_ id \nDelete a table \nDROP TABLE old invoices \nDescription \n• \nYou can use the CREATE TABLE AS statement to create a new table based on the \nresult set defined by a SELECT state1nent. \n• \nEach column name in the SELECT clause must be unique. If you use calculated \nvalues in the select list, you 1nust name the column. \n• \nYou can code the other clauses of the SELECT statement just as yo11 would for any \nother SELECT statement, inclucling grouping, aggregates, joins, and subqueries. \n• If you code the CREATE TABLE AS statement as shown above, the table you \nname must not exist. If it does, you must delete the table by using the DROP \nTABLE statement before you execute the CREATE TABLE AS statement. \n• \nWhen you use the CREATE TABLE AS state1nent to create a table, only the \ncolumn definitions and data are copied. Definitions of primary keys, foreign keys, \nindexes, and so on are not included in the new table. \nFigure 5-1 \nHow to create a table from a SELECT statement\n\n152 \nSection 1 \nAn introduction to MySQL \nHow to insert new rows \nTo add rows to a table, you use the INSERT statement. In most cases, you \nuse this statement to add a single row to a table. However, you can also use it to \nadd multiple rows to a table. \nHow to insert a single row \nFigure 5-2 starts by showing how to code INSERT statements that inse1·t \na single row. Because the examples in this figure i11sert rows into the Invoices \ntable, this figure reviews the column definitions for this table. This shows the \nsequence of the columns in the table and which columns have default values or \nallow null values. It also shows that invoice_id is an auto increment column. \nWhen you code an INSERT statement, you name the table on the INSERT \nclause, followed by an optional list of columns. Then, you list the values to be \ninserted on the VALUES clause. \nThe first two examples in this figure illustrate how this works. The frrst \nexample doesn't include a column list. Because of that, the VALUES clause must \ninclude a value for every column in the table, and those values must be listed \nin the same sequence that the columns appear in the table. That way, MySQL \nknows which value to assign to which column. Notice that this statement uses \nthe NULL keyword to assign a null value to the payment_date column. You'll \nlearn more about using this keyword in the next figure. \nThe second INSERT statement includes a column list. However, this list \ndoesn't include four columns. It doesn't include the invoice id column since \nMySQL automatically increments this column if a value isn't specified. It \ndoesn't include the payment_total and credit_total columns since these columns \nprovide a default value of 0. And it doesn't include the payment_date column \nsince this column allows a null value. In addition, the columns aren't listed in the \nsame sequence as the columns in the table. When you include a list of columns, \nyou can code the columns in any sequence you like. Then, you just need to be \nsure you code the values in the VALUES clause in the same sequence. \nWhen you specify the values for the columns to be inserted, you must be \nsure that those values are compatible with the data types of the columns. For \nexample, you must enclose literal values for dates and strings within quotes. \nHowever, the quotes are optional when you code literal values for numbers. \nYou'll learn more about working with data types in chapter 8. For now, just \nrealize that if any of the values aren't compatible with the corresponding column \ndata types, MySQL returns an etTor and the row isn't inse1·ted. \nHow to insert multiple rows \nThe third example in figure 5-2 shows how to insert multiple rows. When \nyou do that, yot1 follow the same rules as you do for inserting a single row. Then, \nyou separate each list of values with a comma. This technique is often useful \nwhen you need to create a script that inserts data into a database.\n\nClzapter 5 \nHow to insert, update, and delete data \n153 \nThe syntax of the INSERT statement \nINSERT [INTO] table_ name [(column_ list)] \nVALUES (expression_ l[, expression_ 2] ... ) [, \n(expression_ l[, expression_ 2] ... )] ... \nThe column definitions for the Invoices table \ninvoice_ id \nINT \nNOT NULL \nvendor id \nINT \nNOT NULL, \ninvoice_ number \nVARCHAR ( 5 0) \nNOT NULL, \ninvoice_date \nDATE \nNOT NULL, \ninvoice_ total \nDECIMAL(9,2) \nNOT NULL, \npayment_ total \nDECIMAL(9,2) \nNOT NULL \ncredit_ total \nDECIMAL(9,2) \nNOT NULL \nterms id \nINT \nNOT NULL, \ninvoice_due_date \nDATE \nNOT NULL, \npayment_date \nDATE \nInsert a single row without using a column list \nINSERT INTO invoices VALUES \nAUTO_ INCREMENT, \nDEFAULT 0, \nDEFAULT 0, \n( 115, 9 7 , \n' 4 5 6 7 8 9 ' , \n' 2018-08-01 ' , 8 3 4 4 . 5 0, 0 , 0, 1, ' 2018-0 8 - 31 ' , NULL) \n( 1 row affected) \nInsert a single row using a column list \nINSERT INTO invoices \n(vendor_ id, invoice_number, invoice_ total, terms_ id, invoice_ date, \ninvoice_due_ date) \nVALUES \n( 97 I \nI 456789 I I \n8344 • 50 I \n1, \nI 2018-08-01 I I \nI 2018-08-31 1 ) \n( 1 row affected ) \nInsert multiple rows \nINSERT INTO invoices VALUES \n( 116 , 9 7 , \n' 4 5 6 7 01 ' , \n' 2 018 - 0 8 - 0 2 ' , 2 7 0 . 5 0 , 0 , 0 , 1, ' 2 0 18 - 0 9 - 01 ' , NULL) , \n( 117, 97, '456791', '2018-08-03', 4390. 00, 0, 0, 1, '2018-09-02', NULL), \n(118, 97, \n1 456792', '2018-08-03', 565.60, 0, 0, 1, '2018-09-02', NULL) \n( 3 rows affected) \nDescription \n• \nYou use the INSERT statement to add one or more rows to a table. \n• \nIn the INSERT clause, you specify the name of the table that you want to add a row \nto, along with an optional column list. The INTO keyword is also optional. \n• \nIn the VALUES clause, you specify the values to be inserted. If you don't include a \ncolumn list in the INSERT clause, you must specify the column values in the same \norder as in the table, and you must code a value for each column. If you include a \ncolumn list, you must specify the column values in the same order as in the column \nlist, and you can omit columns that have default values, accept null values, or are \nautomatically generated. \n• \nTo insert a null value into a colt1mn, you can use the NULL keyword. To insert a \ndefault value or to have MySQL generate a value for an auto increment column, \nyou can use the DEFAULT keyword. For more information, see figure 5-3. \nFigure 5-2 \nHow to insert rows\n\n154 \nSection 1 \nAn introduction to MySQL \nHow to insert default values and null values \nIf a column allows null values, you can use the INSERT statement to insert \na null value into that column. Si1nilarly, if a column is defined with a default \nvalue, you can use the INSERT statement to inse1t that value. Finally, if a \ncolumn is defined as an auto increment column, you can have MySQL generate \na value for the column. The technique you use depends on whether the INSERT \nstatement includes a column list, as shown by the examples in figure 5-3. \nAll of these INSERT statements use a table named Color_Sample from \nthe EX database. This table contains the three columns shown at the top of this \nfigure. The first column, color_id, is defined so MySQL automatically generates \nits value whenever necessary. The second column, color_number, is defined with \na default value of 0. And the third column, color_name, is defined so it allows \nnull values. \nThe first two statements show how to assign an automatically incremented \nvalue, a default value, or a null value using a column list. To do that, you omit \nthe column from the list. In the first statement, for example, the column list \nnames only the color_number column. As a result, MySQL automatically \nassigns a value of 1 to the color_id column (assuming the table doesn't contain \nany rows) and a null value to the color_name column. Similarly, in the second \nstatement, the column list na1nes only the color_name column. As a result, \nMySQL assigns a value of 2 to the color_id column and a value of O to the \ncolo1· number column. \nThe next three statements show how to assign an automatically incremented, \ndefault, or null value to a column without including a column list. To do that, \nyou can use the DEFAULT and NULL keywords. For example, the third state-\nment specifies a value for the colo1·_name column, but uses the DEFAULT \nkeyword for the color_id and color_number columns. As a result, MySQL \nassigns an automatically incremented value of 3 to the color_id column and a \ndefault value of O to the color_number column. The fourth statement uses the \nNULL keyword to assign a null value to the color_name column. Finally, the \nfifth statement shows what happens if you use the DEFAULT keyword for the \nfirst two columns and the NULL keyword for the third column.\n\nClzapter 5 \nHow to insert, update, and delete data \n155 \nThe column definitions for the Color_Sample table \ncolor_ id \ncolor_number \ncolor_name \nINT \nINT \nVARCHAR { 5 0) \nNOT NULL \nNOT NULL \nAUTO_ INCREMENT, \nDEFAULT O, \nFive INSERT statements for the Color_Sample table \nINSERT INTO color_ sample {color_number) \nVALUES {606) \nINSERT INTO color_ sample {color_ namA) \nVALUES {'Yellow') \nINSERT INTO color_ sample \nVALUES {DEFAULT, DEFAULT, 'Orange') \nINSERT INTO color_ sample \nVALUES (DEFAULT, 808, NULL) \nINSERT INTO color_ sample \nVALUES (DEFAULT, DEFAULT, NULL) \nThe Color_Sample table after the rows have been inserted \ncolor Jd \ncolor _number \ncolor_name \n► \n1 \n606 \nUM!I \n2 \n0 \nYellow \n3 \n0 \nOrange \n.q \n808 \n\"®'' \n5 \n0 \nH®!I \nDescription \n• If a column is defined so it allows null values, you can use the NULL keyword in \nthe list of values to insert a null value into that column. \n• \nIf a column is defined with a default va]11e, you can use the DEFAULT keyword in \nthe list of values to insert the default value for t11at column. \n• If a column is defined as an auto increment column, you can use the DEFAULT \nkeyword in the list of values to have MySQL generate the value for the column. \n• If you include a column list, you can omit columns with default values and null \nvalues. Then, the default value or null value is assigned automatically. You can also \nomit an auto increment column. Then, MySQL generates the value for the column. \nFigure 5-3 \nHow to insert default values and null values\n\n156 \nSection 1 \nAn introduction to MySQL \nHow to use a subquery in an INSERT statement \nA subquery is just a SELECT statement that's coded within another SQL \nstatement. Since you ah·eady know how to code SELECT statements, you \nshouldn't have much trouble coding subqueries as described in this chapter. \nThen, in chapter 7, you'll learn more about coding subqueries. \nFigure 5-4 shows how to code a subquery in an INSERT statement. Here, \nboth examples use a SELECT statement instead of a VALUES clause. As a \nresult, the subquery specifies the values for the new rows by selecting these \nvalues from another table. \nBoth examples retrieve rows from the Invoices table and insert them into a \ntable named Invoice_Archive. This table is defined with the same columns as the \nInvoices table. However, the invoice_id column isn't defined as an auto incre-\nment column, and the payment_total and credit_total columns aren't defined \nwith default values. As a result, you must include values for these columns. \nThe first example shows how you can use a subquery in an INSERT state-\nment without a column list. In this example, the SELECT clause of the subquery \nuses an asterisk to retrieve all the columns in the Invoices table. Then, after \nMySQL applies the search condition in the WHERE clause, all the rows in the \nresult set are inserted into the Invoice Archive table. \nThe second example shows how you can use a subquery in an INSERT state-\n1nent with a column list. Just as when you use the VALUES clause, you can list \nthe columns in any sequence. However, the columns must be listed in the same \nsequence in the SELECT clause of the subquery. In addition, yot1 can omit auto \nincrement columns, columns that are defined with default values, and columns \nthat allow null values. \nWhen you code a subquery in an INSERT statement, you don't code paren-\ntheses around the SELECT statement. That's because the SELECT statement is \ncoded instead of the VALUES clause. However, when you code a subquery in \nthe WHERE clause of an UPDATE or INSERT statement, you do code paren-\ntheses around the SELECT statement. Later in this chapter, you'll see some \nexamples of this. \nBefo1·e you execute an INSERT statement that uses a subquery, you should \nmake sure that the rows and columns retrieved by the subquery are the ones \nyou want to insert. To do that, you can execute the SELECT statement by itself. \nThen, when you're sure it retrieves the co1Tect data, you can add the INSERT \nclause to insert the rows into another table.\n\nClzapter 5 \nHow to insert, update, and delete data \n157 \nThe syntax for using a subquery to insert one or more rows \nINSERT [INTO] table_ name [(column_ list)] select_statement \nInsert paid invoices into the lnvoice_Archive table \nINSERT INTO invoice_archive \nSELECT* \nFROM invoices \nWHERE invoice_ total - payment_total - credit_total = 0 \n(103 rows affected) \nThe same statement with a column list \nINSERT INTO invoice archive \n(invoice_id, vendor_ id, invoice_number, invoice_total, credit_ total, \npayment_total, terms_id, invoice_date, invoice_due_date) \nSELECT \ninvoice_ id, vendor_ id, invoice_number, invoice_ total, credit_ total, \npayment_total, terms_ id, invoice_date, invoice_due_date \nFROM invoices \nWHERE invoice total - payment_total - credit_total = 0 \n(103 rows affected) \nDescription \n• \nA subquery is a SELECT statement that's coded within another SQL statement. \n• \nTo insert rows selected from one or more tables into another table, you can code a \nsubquery in place of the VALUES clause. Then, MySQL inserts the rows returned \nby the subquery into the target table. For this to work, the target table must already \n. \nexist. \n• \nThe rules for working with a column list are the same as they are for any INSERT \nstatement. \nFigure 5-4 \nHow to use a subquery in an INSERT statement\n\n158 \nSection 1 \nAn introduction to MySQL \nHow to update existing rows \nTo modify the data in one or 1nore rows of a table, you use the UPDATE \nstatement. Although most of the UPDATE statements you code will perform \nsimple updates, you can also code more complex UPDATE statements that \ninclude subqueries if necessary. \nHow to update rows \nFigure 5-5 presents the syntax of the UPDATE statement. Most UPDATE \nstatements include all three of the clauses shown here. The UPDATE clause \nnames the table to be updated. The SET clause names the columns to be updated \nand the values to be assigned to those columns. And the WHERE clause speci-\nfies the condition a row must meet to be updated. \nWhen you use MySQL Workbench, you should realize that it will execute \nan UPDATE statement only if the condition on the WHERE clause refers to a \nprimary or foreign key. That's because, by default, Workbench runs in ''safe \nupdate'' mode. If that's not what you want, you can turn safe update mode off \nas described in this figure. For example, because the WHERE clause in the first \nand third UPDATE statements in this figure refer to the invoice_number column, \nwhich isn't a key column, you have to turn safe mode off to execute them. \nThe first UPDATE statement modifies the values of two columns in the \nInvoices table: payment_date and payment_total. Since the WHERE clause in \nthis statement identifies a single row, MySQL only updates the columns in that \nrow. In this example, the values for the columns are coded as a literal values. You \nshould realize, though, that you can assign any valid expression to a column as \nlong as it evaluates to a value that's compatible with the data type of the column. \nYou can also use the NULL keyword to assign a null value to a column that \nallows nulls, and you can use the DEFAULT keyword to assign the default value \nto a column that's defined with a default value. \nThe second UPDATE statement modifies a single column in the Invoices \ntable: terms_id. This time, however, the WHERE clause specifies that all the \nrows for vendor 95 should be updated. Since this vendor has six rows in the \nInvoices table, MySQL updates all six rows. \nThe third UPDATE statement shows how you can use an expression to \nassign a value to a column. In this case, the expression increases the value of \nthe credit_total column by 100. Like the first UPDATE state1nent, this state1nent \nupdates a single row. \nBefore you execute an UPDATE statement, you may want to make sure that \nyou've selected the correct rows. To do that, you can code a SELECT statement \nwith the same seai·ch condition. Then, if the SELECT statement returns the \ncorrect rows, you can copy its WHERE clause into your UPDATE statement.\n\nClzapter 5 \nHow to insert, update, and delete data \n159 \nThe syntax of the UPDATE statement \nUPDATE table_name \nSET column_name_ l = expression_l[, column name 2 = expression_ 2] ..• \n[WHERE search_ condition] \nUpdate two columns for a single row \nUPDATE invoices \nSET payment_date = '2018-09-21', \npayment_ total = 19351.18 \nWHERE invoice_number = \n1 97/522 1 \n(1 row affected) \nUpdate one column for multiple rows \nUPDATE invoices \nSET terms_ id = 1 \nWHERE vendor_ id = 95 \n(6 rows affected) \nUpdate one column for one row \nUPDATE invoices \nSET credit_ total = credit_ total + 100 \nWHERE invoice_ D11mbP.r = '97 /522' \n(1 row affected) \nDescription \n• \nYou use the UPDATE statement to modify one or more rows in a table. \n• \nIn the SET clause, you name each column and its new value. Yott can specify the \nvalue for a column as a literal or an expression. \n• \nIn the WHERE clause, you can specify the conditions that 1nust be met for a row to \nbe updated. \n• \nYou can use the DEFAULT and NULL keywords to specify default and null values \nas described in figure 5-3. \n• \nBy default, MySQL Workbench 1uns in safe update mode. That prevents you from \nupdating rows if the WHERE clause is omitted or doesn't 1·efer to a primary key or \nforeign key column. \n• \nTo get around the restrictions of safe update mode, you can turn this mode off. To \ndo that, select the Edit➔ \nPreferences command, select the SQL Editor node, change \nthe ''Safe Updates'' option, and restart MySQL Workbench. \nWarning \n• \nIf you turn off safe update mode and omit the WHERE clause, all rows in the table \nwill be updated. \nFigure 5-5 \nHow to update rows\n\n160 \nSection 1 \nAn introduction to MySQL \nHow to use a subquery in an UPDATE statement \nWhen you code the search condition on the WHERE clause of an UPDATE \nstatement, you can include a subquery to identify the rows to be updated. \nFigUI·e 5-6 presents two statements that ill11strate how you do that. \nIn the frrst statement, a subquery is used in the WHERE clause to identify \nthe invoices to be updated. This subquery returns the vendor_id value for the \nvendor in the Vendors table with the name ''Pacific Bell.\" Then, all the invoices \nwith that vendor_id value are updated. \nThe second UPDATE statement also uses a subquery in the WHERE clause. \nThis subquery returns a list of the vendor_id values for all vendors in Califorrtia, \nArizona, and Nevada. Then, the IN operator is used to update all the invoices \nwith vendor_id values in that list. Although this subquery returns 80 vendors, \nmany of these vendors don't have invoices. As a result, the UPDATE statement \nonly affects 40 invoices. \nTo execute the second UPDATE statement from MySQL Workbench, you \nhave to turn safe update mode off. That's because the WHERE clause in this \nstatement uses the IN operator.\n\nUpdate all invoices for a vendor \nUPDATE invoices \nSET terms id= 1 \nWHERE vendor_ id = \n(SELECT vendor_ id \nFROM vendors \nClzapter 5 \nHow to insert, update, and delete data \n161 \nWHERE vendor_name = 'Pacific Bell' ) \n(6 rows affected) \nUpdate the terms for all invoices for vendors in three states \nUPDATE invoice s \nSET terms_ id = 1 \nWHERE vendor_ id IN \n(SELECT vendor_ id \nFROM vendors \nWHERE vendor_ state IN ( 'CA', 'AZ', 'NV' )) \n(40 rows affected) \nDescription \n• \nYou can code a subquery in the WHERE clause of an UPDATE statement to \nprovide one 01· more values used in the search condition. \nFigure 5-6 \nHow to use a subquery in an UPDATE statement\n\n162 \nSection 1 \nAn introduction to MySQL \nHow to delete existing rows \nTo delete one or more rows from a table, you use the DELETE statement. If \nnecessary, you can use subqueries in a DELETE statement to help identify the \nrows to be deleted. \nHow to delete rows \nFigure 5-7 presents the syntax of the DELETE statement along with four \nexamples that show how it works. To start, the DELETE clause specifies the \nname of the table and must include the FROM keyword. \nThe WHERE clause specifies a search condition that identifies the rows to \nbe deleted. Although this clause is optional, you'll almost always include it. If \nyou don't, you could inadvertently delete all of the rows in the table. Fortunately, \nM ySQL Workbench runs in safe t1pdate mode by default, which prevents a \nDELETE statement from executing if it doesn't include a WHERE clause that \nrefers to a primary key or foreign key column. \nIf you want to make sure that you've selected the correct rows before you \ndelete them, you can code a SELECT statement that retrieves those rows. Then, \nonce you're sure the SELECT state1nent is retii eving the con·ect rows, you can \nconvert the SELECT statement to a DELETE statement. \nThe first DELETE statement in this figure deletes a single row from the \nGeneral_Ledger_Accounts table. To do that, it specifies the account_number \nvalue of the row to be deleted in the WHERE clause. The second DELETE \nstatement deletes a single row from the Invoice_Line_ltems table. To do that, \nit specifies the invoice_id value and the invoice_sequence value of the row to \nbe deleted in the WHERE clause. Finally, the third DELETE statement deletes \nfour rows from the Invoice_Line_Items table. To do that, it specifies 12 as the \ninvoice id value of the row to be deleted. Since the invoice for this ID has four \nline items, this deletes all four line items. \nIf you try to delete a row that has one or more related rows in another table, \nMySQL typically returns an error message and doesn't delete the row. For \nexample, MySQL returns an error message if you attempt to delete a row from \nthe Vendors table that has related rows in the Invoices table. Usually, that's what \nyou want. \nHow to use a subquery in a DELETE statement \nIf you want to delete a row from the Vendors table that has related rows in \nthe Invoices table, you need to start by deleting the rows in the \nInvoice_Line_Items table for the vendor's invoices. To do that, you can use \na subquery as shown in the fourth example in figure 5-7. Here, the subquery \nselects all the invoice IDs for the vendor from the Invoices table. Then, the \nDELETE statement deletes all the invoice line items with those IDs.\n\nThe syntax of the DELETE statement \nDELETE FROM table_name \n[WHERE search_ condition] \nDelete one row \nDELETE FROM general_ledger_accounts \nWHERE account_ number = 306 \n(1 row affected) \nClzapter 5 \nHow to insert, update, and delete data \n163 \nDelete one row using a compound condition \nDELETE FROM invoice_ line_items \nWHERE invoice id= 78 AND invoice_ sequence = 2 \n(1 row affected) \nDelete multiple rows \nDELETE FROM invoice_line_ items \nWHERE invoice id= 12 \n(4 rows affected) \nUse a subquery in a DELETE statement \nDELETE FROM invoice_line_ items \nWHERE invoice_ id IN \n(SELECT invoice_ id \nFROM invoices \nWHERE vendor id= 115) \n(4 rows affected) \nDescription \n• \nYou can use the DELETE statement to delete one or more rows from the table you \nname in the DELETE clause. \n• \nYou specify the conditions that must be met for a row to be deleted in the WHERE \nclause. \n• \nYou can use a subquery within the WHERE clause. \n• \nA foreign key constraint may prevent you from deleting a row. In that case, you can \nonly delete the row if you delete all child rows for that row first. \n• \nBy default, MySQL Workbench runs in safe update mode. That prevents you from \ndeleting rows if the WHERE clause is omitted or doesn't refer to a primary key or \nforeign key column. For information on turning safe update mode off, see figure \n5-5. \nWarning \n• \nIf you tum safe update mode off and omit th.e WHERE clause from a DELETE \nstatement, all the rows in the table will be deleted. \nFigure 5-7 \nHow to delete rows\n\n164 \nSection 1 \nAn introduction to MySQL \nPerspective \nIn this chapter, you learned how to use the INSERT, UPDATE, and \nDELETE statements to modify the data in a database. In chapters 10 and 11, \nyou'll learn more about how table definitions can affect the way these state-\nments work. And in chapter 14, you'll leam more about executing gi·oups of \nINSERT, UPDATE, and DELETE statements as a single transaction. \nTerm \nsubquery \nExercises \nTo test whether a table has been modified correctly as you do these exercises, \nyou can write and run an appropriate SELECT statement. Or, when you 're \nusing MySQL Workbench, you can right-click on a table name in the Navigator \nwindow and select the Select Rows - Limit 1000 command to display the data \nfor the table in a Result tab. To refresh the data in this tab after modifying the \ntable data, click the Refresh button in the toolbar at the top of the tab. \n1. \nWrite an INSERT statement that adds this row to the Terms table: \nterms id: \n-\nterms_ description: \nterms_due_days: \n6 \nNet due 120 days \n120 \nUse MySQL Workbench to review the column definitions for the Terms table, \nand include a column list with the required colu1nns in the INSERT statement. \n2. \nWrite an UPDATE statement that modifies the row you just added to the \nTerms table. This statement should change the terms_description column to \n''Net due 125 days'', and it should change the terms_due_days column to 125. \n3. \nWrite a DELETE statement that deletes the row you added to the Terrns table \nin exercise 1. \n4. \nWrite an INSERT statement that adds this row to the Invoices table: \ninvoice id: \nvendor id: \n-\ninvoice number: \n-\ninvoice date: \n-\ninvoice total: \n-\npayment_ total: \ncredit total: \nterms id: \ninvoice due date: \n-\n-\npayment_ date: \nThe next automatically generated ID \n32 \nAX-014-027 \n8/1/2018 \n$434.58 \n$0.00 \n$0.00 \n2 \n8/31/2018 \nnull \nWrite this statement without using a column list.\n\nClzapter 5 \nHow to insert, update, and delete data \n165 \n5. \nWrite an INSERT statement that adds these rows to the Invoice Line Items \ntable: \n• \n• \n1nvo1ce _sequence: \naccount number: \nline item amount: \n-\n-\nline _item_ description: \n1 \n160 \n$180.23 \nHard drive \n2 \n527 \n$254.35 \n-\n-\nExchange Server update \nSet the invoice_id column of these two rows to the invoice ID that was gener-\nated by MySQL for the invoice you added in exercise 4. \n6. \nWrite an UPDATE statement that modifies the invoice you added in exercise \n4. This statement should change the credit_total column so it's 10% of the \ninvoice_total column, and it should change the payment_total column so the \nsum of the payment_total and credit_total columns are equal to the \ninvoice total column. \n-\n7. \nWrite an UPDATE statement that modifies the Vendors table. Change the \ndefault account number column to 403 for the vendor with an ID of 44. \n-\n-\n8. \nWrite an UPDATE statement that modifies the Invoices table. Change the \nterms_id column to 2 for each invoice that's for a vendor with a \ndefa11lt_terms_id of 2. \n9. \nWrite a DELETE statement that deletes the row that you added to the Invoices \ntable in exercise 4. When you execute this statement, it will produce an error \nsince the invoice has 1·elated rows in the Invoice_Line_Items table. To fix that, \nprecede the DELETE statement with another DELETE statement that deletes \nthe line items for this invoice. (Remember that to code two or more statements \nin a script, you must end each statement with a semicolon.)\n\nMore SQL skills \nas you need them \nIn section 1, you learned a professio11al subset of SQL skills that you can \nuse to work with data in an existing database. Now, in this section, you \ncan add to those skills by learning new skills whenever you need them. To \nmake that possible, each chapter in this section has been designed as an \nindependent module. As a result, you can read these chapters in whatever \nsequence you prefer. \nIn chapter 6, you '11 learn how to summarize the data that you retrieve. \nIn chapter 7, you'll learn more about coding subqueries. In chapter 8, \nyou'll learn more about the types of data that MySQL suppo11s. And \nin chapter 9, you'll learn how to use MySQL functions in your SQL \nstatements.\n\nHow to code summary \n• \nqueries \nln this chapter, you'll learn how to code queries that summarize data. For \nexample, you can use summary queries to report sales totals by vendor or \nstate. Similarly, you can use summary queries to get a count of the number \nof i11voices that were processed each day of the month. But first, you'll learn \nhow to use a special type of function called an aggregate function. Aggregate \nfunctions allow you to do jobs like calculate averages, summarize totals, or find \nthe highest value for a given column, and you'll use them in summary queries. \nHow to work with aggregate functions ............................ 170 \nHow to code aggregate functions ................................................................ 170 \nQueries that use aggregate functions ........................................................... 172 \nHow to group and summarize data ................................... 174 \nHow to code the GROUP BY and HAVING clauses .................................. 174 \nQueries that use the GROUP BY and HAVING clauses ............................. 176 \nHow the HA YING clause compares to the WHERE clause ....................... 178 \nHow to code compound search conditions .................................................. 180 \nHow to use the WITH ROLLUP operator ................................................... 182 \nHow to use the GROUPING function ......................................................... 184 \nHow to code aggregate window functions ...................... 188 \nHow the aggregate window functions work ................................................ 188 \nHow to L1se fra1nes ....................................................................................... 1.90 \nHow to use named windows ........................................................................ 194 \nPerspective ......................................................................... 196\n\n170 \nSection 2 \nMore SQL skills cts you need them \nHow to work with aggregate functions \nIn chapter 3, you learned how to use scalar functions, which operate on a \nsingle value and return a single value. In this chapter, you '11 learn how to use \naggregate functions, which operate on a series of values and return a single \nsummary value. Because aggregate functions typically operate on the values \nin columns, they are sometimes referred to as column functions. A query that \ncontains one or more aggregate functions is typically refe1red to as a su,nmary \nquery. \nHow to code aggregate functions \nFigure 6-1 presents the syntax of the most common aggregate functions. \nMost of these functions operate on an expression. Typically, the expression is \njust a column name. For example, you could get the average of all values in the \ninvoice total column like this: \nAVG(invoice t otal) \nHowever, an expression can also be more complex. In this figure, for example, \nthe expression that's coded for the SUM function calculates the balance due of \nan invoice using the invoice_total, payment_total, and credit_total columns. The \nresult is a single value that represents the total amount due for all the selected \ninvoices. In this case, the WHERE clause selects only those invoices with a \nbalance due. \nWhen you t1se these ft1nctions, you can also code the ALL or DISTINCT \nkeyword. The ALL keyword is the default, which means that all values are \nincluded in the calculation. The exceptions are null values, which are excluded \nfrom all these functions except for COUNT(*). \nIf you don't want duplicate values included, you can code the DISTINCT \nkeyword. In most cases, you'll use DISTINCT only with the COUNT function \nas shown in the next figure. You won't use it with MIN or MAX because it has \nno effect on those functions. And it doesn't usually make sense to use it with the \nAVG and SUM functions. \nUnlike the other aggregate functions, you can't use the ALL or DISTINCT \nkeywords or an expression with COUNT(*). Instead, you code this function \nexactly as shown in the syntax. The value returned by this function is the number \nof rows in the base table that satisfy the search condition of the query, including \nrows with null values. In this figure, for example, the COUNT(*) function in the \nquery indicates that the Invoices table contains 11 invoices with a balance due.\n\nChapter 6 \nHow to code sum1ncary queries \n171 \nThe syntax of the aggregate functions \nFunction syntax \nResult \nAVG{[ALLIDISTINCT] expression) \nSUM{[ALLIDISTINCT] expression) \nMIN{[ALLjDISTINCT] expression) \nMAX{[ALLIDISTINCT] expression) \nCOUNT{[ALLIDISTINCT] expression) \nCOUNT{*) \nThe average of lhe non-nu_ll values in the expression. \nThe total of the non-nt1ll values in the expression. \nThe lowest non-null value in the expression. \nThe highest non-null value in the expression. \nThe number of non-null values in the expression. \nThe number of rows selected by the query. \nA summary query that counts unpaid invoices and calculates the total due \nSELECT COUNT{*) AS number_ of_ invoices, \nSUM(invoice_total -\npayment_total - credit_total) AS total_due \nFROM invoices \nWHERE invoice total -\npayment_total -\ncredit total> 0 \nnumber _of_invokes \ntotal_due \n• \n► \n11 \n32020.42 \nDescription \n• \nAggregate functions, also called column functions, perform a calculation on the \nvalues in a set of selected rows. \n• \nA sitmmary query is a SELECT statement that includes one or more aggregate \nfunctions. \n• \nThe expression you specify for the AVG and SUM functions must result in a \nnumeric value. The expression for the MIN, MAX, and COUNT ft.1nctions can \nresult in a numeric, date, or string value. \n• \nBy default, all values are included in the calculation regardless of whether they're \nduplicated. If you want to omit duplicate values, code the DISTINCT keyword. \nThis keyword is typically used with the COUNT function. \n• \nAll of the aggregate functions except for COUNT(*) ignore null values. \n• \nIf you code an aggregate function in the SELECT clause, that clause can include \nnon-agg1·egate columns from the base table if that column is functionally dependent \non an aggregate column. See figure 6-3 for more information. \nFigure 6-1 \nHow to code aggregate functions\n\n172 \nSection 2 \nMore SQL skills cts you need them \nQueries that use aggregate functions \nThis figure presents four more queries that use aggregate functions. The \nfirst two queries use the COUNT(*) function to count the number of rows in the \nInvoices table that satisfy the search condition. In both cases, only those invoices \nwith invoice dates after 1/1/2018 are included in the count. In addition, the first \nquery uses the AVG function to calculate the average amount of those invoices \nand the SUM function to calculate the total amount of those invoices. In contrast, \nthe second query uses the MIN and MAX functions to get the minimum and \nmaximum invoice amounts. \nAlthough the MIN, MAX, and COUNT functions are typically used on \ncolumns that contain numeric data, they can also be used on columns that \ncontain character or date data. In the third query, for example, they're used \non the vendor_name column in the Vendors table. Here, the MIN function \nreturns the name of the vendor that's lowest in the sort sequence, the MAX \nfunction returns the name of the vendor that's highest in the so1t sequence, and \nthe COUNT ft1nction returns the total number of vendors. Note that since the \nvendor_name column can't contain null values, the COUNT(*) function would \nhave returned the same result. \nThe fourth query shows how using the DISTINCT keyword can affect \nthe result of a COUNT function. Here, the first COUNT function uses the \nDISTINCT keyword to count the number of vendors that have invoices dated \n1/1/2018 or later in the Invoices table. To do that, it looks for distinct values in \nthe vendor_id column. In contrast, since the second COUNT function doesn't \ninclude the DISTINCT keyword, it counts every invoice that's dated 1/1/2018 \nor later. Although you could use the COUNT(*) function instead, this example \nuses COUNT(vendor_id) to clearly show the difference between coding and not \ncoding the DISTINCT keyword. \nWith two exceptions, a SELECT clause that contains an aggregate function \ncan contain only aggregate functions. The first exception is if the column specifi-\ncation results in a literal value. This is shown by the first column in the first two \nqueries in figure 6-2. The second exception is if the query includes a GROUP \nBY clause. Then, the SELECT clause can include any columns specified in the \nGROUP BY clause as shown in the next two figures.\n\nChapter 6 \nHow to code sum1n.ary queries \n173 \nA summary query that uses the COUNT(*), AVG, and SUM functions \nSELECT 'After 1/1/2018' AS selection_date, \nCOUNT(*) AS number_of_ invoices, \nROUND{AVG{invoice_total), 2) AS avg_ invoice_amt, \nSUM{invoice_total) AS total_ invoice_amt \nFROM invoices \nWHERE invoice_date > '2018-01-01' \nselection_date \nnumber _of _lnvOJces \navg_ilvoice_amt \ntotal_invoice_amt \n► \nAfter 1/1/2018 \n114 \n1879.74 \n214290.51 \nA summary query that uses the MIN and MAX functions \nSELECT 'After 1/1/2018' AS selection_date, \nCOUNT { *) AS n11mh~r_of_ invoices, \nMAX{invoice_total) AS highest_ invoice_ total, \nMIN(invoice_total) AS lowest_ invoice_total \nFROM invoices \nWHERE invoice date> '2018-01-01' \nseJection_date \n► \nAfter 1/1/2018 \nnumber _of Jnvoices \n114 \nhighest_invoice_total \nlowest_invoice_total \n37966.19 \n6.00 \nA summary query that works on non-numeric columns \nSELECT MIN{vendor_name) AS first_vendor, \nMAX{vendor_name) AS last_vendor, \nCOUNT(vendor_name) AS number_of_vendors \nFROM vendors \nI flrst_vendor \n► I Abbey Office Furnishings \nlast_vendor \nZylka Design \nnumber _of _vendors \n122 \nA summary query that uses the DISTINCT keyword \nSELECT COUNT(DISTINCT vendor_ id) AS number_of_vendors, \nCOUNT{vendor_ id) AS number_of_ invoices, \nROUND(AVG(invoice_ total), 2) AS avg_ invoice_amt, \nSUM(invoice_total) AS total_ invoice_ amt \nFROM invoices \nWHERE invoice_date > '2018-01-01' \nnumber _of_vendors \nnumber _of_involces \navg_invoic:e_amt \ntotal_invoice_amt \n-\n-\n► \n34 \n114 \n1879.74 \n214290.51 \nDescription \n• \nTo cot1nt all of the selected 1·ows, you typically use the COUNT(*) function. \nAlternately, you can use the COUNT function with the name of any column that \ncan't contain null values. \n• \nTo cot1nt only the rows with unique values in a specified column, you can code \nthe COUNT function with the DISTINCT keyword followed by the name of the \ncolumn. \nFigure 6-2 \nQueries that use aggregate functions\n\n17 4 \nSection 2 \nMore SQL skills cts you need them \nHow to group and summarize data \nNow that you understand how aggregate functions work, you're ready to \nlearn how to group data and use aggregate functions to summarize the data in \neach group. To do that, you can use two new clauses of the SELECT statement: \nGROUP BY and HAVING. \nHow to code the GROUP BY and HAVING clauses \nFigure 6-3 shows the syntax of the SELECT statement with the GROUP BY \nand HAVING clauses. The GROUP BY clause determines how the selected rows \nare grouped, and the HAVING clause determines which groups are included in \nthe final results. These clauses are coded after the WHERE clause but before the \nORDER BY clause. That makes sense because the WHERE clause is applied \nbefore the rows are grouped, and the ORDER BY clause is applied after the rows \nare grouped. \nIn the GROUP BY clause, you list one or more columns or expressions \nseparated by commas. Then, the rows in the result set are grouped by those \ncolumns or expressions in ascending sequence. That means that a single row is \nreturned for each unique set of values in the GROUP BY columns. In this figure, \nfor instance, the frrst example groups the results by a single column. In the next \nfigure, you can see examples that group by multiple columns. \nThis example calculates the average invoice amount for each vendor who has \ninvoices in the Invoices table. To do that, it uses a GROUP BY clause to group \nthe invoices by vendor_id. As a result, the AVG function calculates the average \nof the invoice_total column for each group rather than for the entire result set. \nThe example in this figure also includes a HAVING clause. The search \ncondition in this clause specifies that only those vendors with invoices that \naverage over $2,000 should be included. Note that this condition must be applied \nafter the rows are grouped and the average for each group has been calculated. \nIn addition to the AVG function, the SELECT clause includes the vendor_id \ncolumn. That's usually what you want since the rows are grouped by this \ncolumn. However, if you don't want to include the coluID11s used in the GROUP \nBY clause in the SELECT clause, you don't have to. \nIn most cases, the SELECT clause for a statement that includes a GROUP \nBY clause will only include the columns that are used for grouping, along with \nthe aggi·egate functions. However, you can also include expressions that result \nin a constant value as well as columns that are functionally dependent on a \ncolumn that's used for grouping. For a column to be functionally dependent on a \ngrouping column, the grouping column must be a primary key for the column in \nthe SELECT clause or it must be unique and not allow null values. \nThe second example illusu·ates how this works. This example gets the \nvendor name, vendor state, and the average invoice total for each vendor. \nTo do that, it joins the Vendors and Invoices table and groups the rows by \nvendor_name. Although the vendor_state column isn't included in the GROUP \nBY clause, it can be included in the SELECT clause because the vendor_name \ncolumn is a unique colt1mn that can't contain null values. Because of that, the \nvendor_state colu1nn is functionally dependent on it.\n\nChapter 6 \nHow to code sum1ncary queries \n175 \nThe syntax of a SELECT statement with GROUP BY and HAVING clauses \nSELECT select_list \nFROM table_ source \n[WHERE search_ condition] \n[GROUP BY group_by_ list] \n[HAVING search_condition] \n[ORDER BY order_by_ list] \nA summary query that calculates the average invoice amount by vendor \nSELECT vendor_ id, ROUND(AVG(invoice_total), 2) AS average_ invoice_amount \nFROM invoices \nGROUP BY vendor_ id \nHAVING AVG(invoice_total) > 2000 \nORDER BY average_ invoice_amount DESC \nvendor id \naverage_lnvoice_amount \n► \n110 \n23978.48 \n72 \n10963.66 \n104 \n7125.34 \n99 \n6940.25 \n119 \n4901.26 \n122 \n2575.33 \n86 \n2433.00 \n100 \n2184.50 \n(8 rows) \nA summary query that includes a functionally dependent column \nSELECT vendor_ name, ~endor_ state, \nROUND(AVG(invoice_total), 2) AS average_ invoice_amount \nFROM vendors JOIN invoices ON vendors.vendor_ id = invoices.vendor_ id \nGROUP BY vendor_narn~ \nHAVING AVG(invoice total) > 2000 \nORDER BY average_ invoice_amount DESC \nDescription \n• \nThe GROUP BY clause groups the rows of a result set based on one or more columns or \nexpressions. To include two or more columns or expressions, separate them by commas. \n• If you include aggregate functions in the SELECT clause, the aggregate is calculated for \neach group specified by the GROUP BY clause. \n• If you include two or more colu1nns or expressions in the GROUP BY clause, they form \na hierarchy where each column or expression is subordinate to the previous one. \n• \nThe HAVING clause specifies a search condition for a group or an aggregate. MySQL \napplies this condition after it groups the rows that satisfy the search condition in the \nWHERE clause. \n• \nWhen a SELECT statement includes a GROUP BY clause, the SELECT clause can \ninclude the columns used for grouping, aggregate functions, and expressions that \nresult in a constant value. \n• \nThe SELECT clause can also include columns that are functionally dependent on a \ncolumn used fo1· grouping. To be functionally dependent, the grouping column must \nbe a primary key of the table that contains the column in the SELECT clause or it \nmust be unique and not allow null values. \nFigure 6-3 \nHow to code the GROUP BY and HAVING clauses\n\n176 \nSection 2 \nMore SQL skills cts you need them \nQueries that use the GROUP BY \nand HAVING clauses \nFigure 6-4 presents three more queries that group data. The first query in this \nfigure groups the rows in the Invoices table by vendor_id and returns a count of \nthe number of invoices for each vendor. \nThe second query shows how you can group by mo1·e than one column. \nHere, a join is used to combine the vendor_state and vendor_city columns from \nthe Vendors table with a count and average of the invoices in the Invoices table. \nBecause the rows are grouped by both state and city, a row is returned for each \nstate and city combination. \nThe third query is identical to the second query except that it includes a \nHAVING clause. This clause uses the COUNT function to limit the state and city \ngroups that are included in the result set to those that have two or more invoices. \nIn other words, it excludes groups that have only one invoice. \nWith MySQL 8.0.12 and earlier, the GROUP BY clause sorted the columns \nin ascending sequence by default. Then, to change that sequence, you could \ncode the DESC keyword after the column name in the GROUP BY clause. You \ncould also code the ASC keyword to make it clear that the rows were sorted in \nascending sequence. And, yot1 could improve the performance of a query by \ncoding an ORDER BY NULL clause so the result set wasn't sorted at all. \nWith MySQL 8.0.13 and later, the columns in a GROUP BY clause are \nno longer sorted by default. In addition, you can no longer specify the ASC or \nDESC keywords on this clause. Instead, you must code an ORDER BY clause \nto sort the rows in a result set. Otherwise, MySQL doesn't guarantee the sort \nsequence.\n\nChapter 6 \nHow to code sum1ncary queries \n177 \nA summary query that counts the number of invoices by vendor \nSELECT vendor_ id, COUNT(*) AS invoice_qty \nFROM invoices \nGROUP BY vendor_ id \nI vendor Jd \nlnvoice_Qty \n► \n34 \n2 \n37 \n3 \n48 \n1 \n72 \n2 \n(34 rows ) \nA summary query that calculates the number of invoices \n\"\"' \nIce \n. \n-\nand the average invoice amount for the vendors in each state and city \nSELECT vendor_state, vendor_city, COUNT(*) AS invoice_qty, \nROUND(AVG(invoice_total), 2) AS invoice_avg \nFROM invoices JOIN vendors \nON invoices.vendor id= vendors.vendor id \nGROUP BY vendor_state, vendor_city \nORDER BY vendor_state, vendor_city \nvendor _state \nvendor _city \nnvolce_qty \ninv01ce_avg \n-\n► \nAZ. \nPhoenix \n1 \n662.00 \nCA \nFresno \n19 \n1208.75 \nCA \nLos Angeles \n1 \n503.20 \nCA \nOxnard \n3 \n188.00 \n(20 rows) \nA summary query that limits the groups \nto those with two or more invoices \nSELECT vendor_ state, vendor_city, COUNT(*) AS invoice_qty, \nROUND(AVG(invoice_total), 2) AS invoice_avg \nFROM invoices JOIN vendors \nON invoices.vendor_ id = vendors.vendor_id \nGROUP BY vendor_state, vendor_city \nHAVING COUNT(*) >= 2 \nORDER BY vendor_state, vendor_city \nvendor state \n-\n-\n► \nCA \nCA \nCA \n(12 rows) \nDescription \nvendor_dty \nFresno \nOxnard \nPasadena \nSacramento \ninvoice_Qty \n111voice_avg \n19 \n1208.75 \n3 \n188,00 \n5 \n196. 12 \n7 \n253.00 \nI\\ \n1--\n\\I \n• \nWith MySQL 8.0.12 and earlier, the GROUP BY clause sorted the columns in ascending \nsequence by default. Then, to change the sort sequence, you could code the DESC \nkeyword after the column name in the GROUP BY clause. In addition, to get your results \nfaster, you cot1ld code an ORDER BY NULL clause to prevent MySQL from sorting the \nrows in the GROUP BY clause. \n• \nWith MySQL 8.0.13 and later, the columns in a GROUP BY clause are no longer sorted by \ndefault, and you can't code the ASC or DESC keyword on this clause. Instead, you must \nuse the ORDER BY clause to specify the sort sequence. \nFigure 6-4 \nQueries that use the GROUP BY and HAVING clauses\n\n178 \nSection 2 \nMore SQL skills cts you need them \nHow the HAVING clause compares \nto the WHERE clause \nAs you've seen, you can limit the groups included in a result set by coding \na search condition in the HAVING clause. In addition, you can apply a search \ncondition to each row before it's included in a group. To do that, you code the \nsearch condition in the WHERE clause just as you would for any SELECT state-\nment. To make sure you understand the differences between search conditions \ncoded in the HAVING and WHERE clauses, figure 6-5 presents two examples. \nThe first example groups the invoices in the Invoices table by vendor name \nand calculates a count and average invoice amount for each group. Then, the \nHA VINO clause limits the groups in the result set to those that have an average \ninvoice total greater than $500. \nIn contrast, the second example includes a WHERE clause that limits the \ninvoices included in the groups to those that have an invoice total greater than \n$500. In other words, the search condition in this example is applied to every \nrow. In the previous example, it was applied to each group of rows. As a result, \nthese examples show that there are eight invoices for Zylka Design in the \nInvoices table, but only seven of them are over $500. \nBeyond this, there are two differences in the expressions that you can \ninclude in the WHERE and HAVING clauses. First, the HAVING clause can \ninclude aggregate functions as shown in the frrst example, but the WHERE \nclause can't. That's because the search condition in a WHERE clause is applied \nbefore the rows are grouped. Second, although the WHERE clause can refer to \nany column in the base tables, the HAVING clause can only refer to columns \nincluded in the SELECT clause. That's because it filters the summarized result \nset that's defmed by the SELECT, FROM, WHERE, and GROUP BY clauses. In \nother words, it doesn't filter the base tables.\n\nChapter 6 \nHow to code sum1ncary queries \n179 \nA summary query with a search condition in the HAVING clause \nSELECT vendor_name, \nCOUNT(*) AS invoice_qty, \nROUND{AVG{invoice_total), 2) AS invoice_ avg \nFROM vendors JOIN invoices \nON vendors.vendor_ id = invoices.vendor_ id \nGROUP BY vendor_ name \nHAVING AVG{invoice_total) > 500 \nORDER BY invoice_qty DESC \nvendor_name \ninvoice_qty \nlnvoice_avg \n► \nUnited Parcel Service \n9 \n2575.33 \nZylka Design \n8 \n867.53 \nMaftoy lithographing Inc \n5 \n23978.48 \nIBM \n2 \n600.06 \n(19 rows) \nA summary query with a search condition in the WHERE clause \nSELECT vendor_name, \nCOUNT{*) AS invoice_qty, \nROUND(AVG(invoice_total), 2) AS invoice_avg \nFROM vendors JOIN invoices \nON vendors.vendor_ id = invoices.vendor_id \nWHERE invoice_total > 500 \nGROUP BY vendor_ name \nORDER BY invoice_qty DESC \nvendor _name \ninvoice_qty \n• \n• \nnvotCe_avg \n► \nUnrted Parcel Service \n9 \n2575.33 \nZylka Design \n7 \n9~.67 \nMaDoy lithographing Inc \n5 \n23978.48 \nIngram \n2 \n1on.21 \n{20 rows) \nDescription \nI\\ \n-\n.,__ \n• \nWhen you include a WHERE clat1se in a SELECT statement that uses grouping \nand aggregates, MySQL applies the search condition before it groups the rows and \ncalculates the aggregates. \n• \nWhen you include a HAVING clause in a SELECT statement that uses grouping \nand aggregates, MySQL applies the search condition after it groups the rows and \ncalculates the aggregates. \n• \nA WHERE clause can refer to any colwnn in the base tables. \n• \nA HAVING clause can only refer to a column included in the SELECT clause. \n• \nA WHERE clause can't contain aggregate ft1nctions. \n• \nA HAVING clause can contain aggregate functions. \nFigure 6-5 \nHow the HAVING clause compares to the WHERE clause \nI\n\n180 \nSection 2 \nMore SQL skills cts you need them \nHow to code compound search conditions \nYou can code compound search conditions in a HAVING clause just as you \ncan in a WHERE clause. The first example in figure 6-6 shows how this works. \nThis query groups invoices by invoice date and calculates a count of the invoices \nand the sum of the invoice totals for each date. In addition, the HA YING clause \nspecifies three conditions. First, the invoice date must be between 5/1/2018 and \n5/31/2018. Second, the invoice count must be greater than 1. And third, the sum \nof the invoice totals must be greater than $100. \nIn the HAVING clause of this query, the second and third conditions include \naggregate functions. As a result, they must be coded in the HAVING clause. The \nfrrst condition, however, doesn't include an aggregate function, so it could be \ncoded in either the HAVING or WHERE clause. The second example shows this \ncondition coded in the WHERE clause. Either way, both queries return the same \nresult set. \nSo, where should you code your search conditions? In general, I think \nqueries are easier to 1·ead when they include al] the search conditions in the \nHAVING clause. However, if you prefer to code non-aggregate search conditions \nin the WHERE clause, that's OK too.\n\nChapter 6 \nHow to code sum1ncary queries \n181 \nA summary query with a compound condition in the HAVING clause \nSELECT \ninvoice_date, \nCOUNT(*) AS invoice_qty, \nSUM(invoice total) AS invoice_ sum \nFROM invoices \nGROUP BY invoice_date \nHAVING invoice_date BETWEEN '2018-05-01' AND '2018-05-31' \nAND COUNT(*) > 1 \nAND SUM(invoice_total) > 100 \nORDER BY invoice_date DESC \nThe same query coded with a WHERE clause \nSELECT \ninvoice_date, \nCOUNT(*) AS invoice_qty, \nSUM(invoice_total) AS invoice_ sum \nFROM invoices \nWHERE invoice_ date BETWEEN '2018-05-01' AND '2018-05-31' \nGROUP BY invoice_date \nHAVING COUNT(*) > 1 \nAND SUM(invoice_total) > 100 \nORDER BY invoice_ date DESC \nThe result set returned by both queries \ninvoice_date \ninvoice_qty \n• \n• \nmvo,ce_sum \n► \n2018-05-31 \n2 \n453.75 \n2018-05-25 \n3 \n220L15 \n2018-05-23 \n2 \n347. 75 \n2018-05-21 \n2 \n8078.44 \n2018-05-13 \n3 \n1888.95 \n2018-05-11 \n2 \n5009.51 \n2018-05-03 \n2 \n866.87 \n(7 rows) \nDescription \n• \nYou can use the AND and OR operators to code compound search conditions in a \nHAVING clause just as you can in a WHERE clause. \n• \nIf a search condition includes an aggregate function, it must be coded in the \nHAVING clause. Otherwise, it can be coded in either the HAVING or the WHERE \nclause. \nFigure 6-6 \nHow to code compound search conditions\n\n182 \nSection 2 \nMore SQL skills cts you need them \nHow to use the WITH ROLLUP operator \nSo far, this chapter has discussed standard SQL keywords and functions. \nHowever, MySQL provides an extension to standard SQL that's useful for \nsummarizing data: the WITH ROLLUP operator. \nYou can use the WITH ROLLUP operator to add one or more summary rows \nto a result set that uses gi·ouping and aggregates. The two examples in figure 6-7 \nshow how this works. \nThe first example shows how the WITH ROLLUP operator works when you \ngroup by a single column. This statement groups the invoices by vendor_id and \ncalculates an invoice count and invoice total for each vendor group. In addition, \nsince the GROUP BY clause includes the WITH ROLLUP operator, this query \nadds a summary row to the end of the result set. This row summaiizes all of the \naggregate columns in the result set. In this case, it summarizes the invoice_count \nand invoice_total columns. Since the vendor_id column can't be summarized, \nit's assigned a null value. \nThe second query in this figure shows how the WITH ROLLUP operator \nworks when you group by two columns. This query groups vendors by state \nand city and counts the number of vendors in each group. Then, this query adds \nsummary rows for each state, and it adds a final summary row at the end of the \nresult set. \nBefore MySQL 8.0.13, you couldn't use the use an ORDER BY clause to \nsort a result set if the GROUP BY clause included the WITH ROLLUP operator. \nInstead, you had to sort the individual columns by coding the ASC or DESC \nkeyword after the column name in the GROUP BY clause. With MySQL 8.0.13 \nand later, however, you can't code the ASC or DESC keyword on the GROUP \nBY clause. Instead, if you want to sort the result set, you can now use an \nORDER BY clause. Keep in mind, though, that when you use WITH ROLLUP, \nthe result set is sorted by the columns in the GROUP BY clause in ascending \nsequence by default. So you'll only code an ORDER BY clause if you want to \nchange this sequence.\n\nChapter 6 \nHow to code sum1ncary queries \n183 \nA summary query that includes a final summary row \nSELECT vendor_ id, COUNT(*) AS invoice_count, \nSUM(invoice_ total) AS invoice_total \nFROM invoices \nGROUP BY vendor_ id WITH ROLLUP \nvendorj d \n111voice_cou,t \ninvolce_total \n119 \n1 \n~01.26 \n121 \n8 \n6940.25 \n122 \n9 \n2Jln .96 \n123 \n47 \n4378.02 \nlml!!I \n114 \n214290.51 \n(35 rows) \n-\n~ .., \nA summary query that includes a summary row for each grouping level \nSELECT vendor_ state, vendor_city, COUNT(*) AS qty_vendors \nFROM vendors \nWHERE vendor_ state IN ( • IA• , \n•NJ• ) \nGROUP BY vendor_state, vendor_city WITH ROLLUP \nvendor _state \nvendor_dty \nqty_ vendors \n► \nIA \nFairfield \n1 \nIA \nWashington \n1 \nIA \nom,, \n2 \nNJ \nEast Brunswick \n2 \nNJ \nFairfield \n1 \nNJ \nWashington \n1 \nNJ \nHW!I \n4 \nml \n11111!1 \n6 \nDescription \n• \nYou can use the WITH ROLLUP operator in the GROUP BY clause to add \nsummary rows to the final result set. \n• \nThe WITH ROLLUP operator adds a summary row for each group specified in the \nGROUP BY clause. It also adds a summary row to the end of the result set that \nsummarizes the entire result set. \n• \nIf the GROUP BY clause specifies a single group, the WITH ROLLUP operator \nonly adds the fmal summary row. \n• \nWith MySQL 8.0.12 and earlier, you couldn't use the ORDER BY clause with the \nWITH ROLLUP operator. Instead, to sort individual columns, you coded the ASC \nor DESC keyword after the column in the GROUP BY clause. \n• \nWith MySQL 8.0.13 and later, you can't code the ASC or DESC keyword on the \nGROUP BY clause. However, you can now include an ORDER BY clause to sort \nthe result set when the GROUP BY clause includes WITH ROLLUP. \n• \nWith MySQL 8.0.12 and earlier, you couldn't use the DISTINCT keyword in any \nof the aggregate functions when you used the WITH ROLLUP operator. With \nMySQL 8.0.13 and later, you can use the DISTINCT keyword. \nFigure 6-7 \nHow to use the WITH ROLLUP operator\n\n184 \nSection 2 \nMore SQL skills cts you need them \nHow to use the GROUPING function \nWhen you group by a column that can contain null values, the result of the \ngrouping can be a null value. In addition, when you use the WITH ROLLUP \noperator to summarize a column that can contain null values, the summary row \nwill contain a null value in that column. Because of that, it can be difficult to \ndistinguish between the null values due to grouping and the null values due to \n• \n• \nsummanz1ng. \nThe first query in figure 6-8 illustrates how this works. Here, the query \nincludes the invoice date and payment date from the Invoices table, as well as \nthe sum of the invoice totals and the sum of the invoice balances. The first five \nrows in the result set are for the same invoice date. Both the first and the last of \nthose five rows contains a null value in the Payment Date column. The first row \ncontains a null value because one or more of the invoices for that invoice date \ncontain a null value. The last row contains a null value because it is a summary \nrow for all of the invoices for that invoice date. Without studying this result set \ncarefully, though, it's difficult to tell which null values are for summary rows \nand which aren't. \nTo help distinguish between these null values, you can use the GROUPING \nfunction that was introduced with MySQL 8.0. This function evaluates the \nexpression you specify to determine if the expression results in a null value \nbecause it's in a sum1nary row. If it does, the GROUPING function returns a \nvalue of 1. Otherwise, it returns a value of 0. \nThis is illustrated by the second query in this figure. This query is the \nsame as the first query except that it uses IF and GROUPING functions for the \ninvoice_date and pay1nent_date columns in the SELECT clause. You'll learn \nabout the IF function in chapter 9. For now, just realize that it evaluates the \nexpression in the first argument and returns the second argument if the expres-\nsion is true or the third argument if it's not. \nIn this case, the first argument of each IF function is a GROUPING function. \nThese GROUPING functions test if the invoice_date or payment_date column \ncontains a null value because it's in a summary row. If so, the IF function returns \nthe literal value that's specified by the second argument. Otherwise, it returns \nthe value of the column grouping that's specified by the third argument. If \nyou compare the results of this query with the results of the first query, you'll \nsee that it's now obvious which rows are summary rows because they contain \nliteral values instead of null values. This is a common use for the GROUPING \nfunction.\n\nChapter 6 \nHow to code sum1ncary queries \n185 \nThe basic syntax of the GROUPING function \nGROUPING (expression) \nA summary query that uses WITH ROLLUP on a table with null values \nSELECT invoice_date, payment_date, \nSUM(invoice_total) AS invoice_total, \nSUM(invoice_total - credit_total - payment_total) AS balance_due \nFROM invoices \nWHERE invoice_date BETWEEN '2018-07-24' AND \n1 2018-07-31 1 \nGROUP BY invoice_date, payment_date WITH ROLLUP \ninvoice_date \npayment_date \nInvoice_ total \nbalance_ due \n► \n2018-07-24 \n0®91 \n503.20 \n503.20 \n2018-07-24 \n2018-08-19 \n3689.99 \n0.00 \n2018-07-24 \n2018-08-23 \n67.00 \n0.00 \n2018-07-24 \n2018-08-27 \n23517.58 \n0.00 \n2018-07-24 \nHPJII \n27777.n \n503.20 \n2018-07-25 \n2018-08-22 \n1000.'16 \n0,00 \n2018-07-25 \nl®!I \n1000.-46 \n0.00 \n2018-07-28 \nUQl!I \n90.36 \n90.36 \n2018-07-28 \nHW!I \n90.36 \n90.36 \n2018-07-30 \n2018-09-03 \n22.57 \n0.00 \n2018--0 7-30 \n®J!I \n22.57 \no.oo \n2018-07-31 \nlllij!i \n10976.06 \n10976.06 \n~&,;8-07-31 \nil®!I \n10976.06 \n10976.06 \nHW!I \n39867.22 \n11569.62 \nA query that substitutes literals for nulls in summary rows \nSELECT IF(GROUPI:NG(invoice_ date) = 1 , 'Grand totals', invoice_ date) \nAS invoice_date, \nIF(GROUPI:NG(payment_ date) = 1 , 'Invoice date totals', payment_ date) \nAS payme.nt_date, \nSUM(invoice_total) AS invoice_total, \nSUM(invoice_total - credit_total - payment_ total) AS balance_ due \nFROM invoices \nWHERE invoice_date BETWEEN '2018-07-24' AND \n1 2018-07-31 1 \nGROUP BY invoice_date, payment_date WITH ROLLUP \nJ \ninvoice_date \npayment_date \nInvoice_ total \nbalance _due \nH©il \n► \n2018-07-24 \n503.20 \n503.20 \n2018-07-24 \n2018-08-19 \n3689.99 \n0.00 \n2018-07-24 \n2018-08-23 \n67.00 \no.oo \n2018-07-24 \n2018-08-27 \n23517.58 \n0.00 \n2018-07-24 \nInvoice date totals \nL777/.77 \n503.20 \n2018-07-25 \n2018-08-22 \n1000.-46 \n0.00 \n2018-07-25 \nInvoice date totals \n1000.-46 \n0.00 \n2018-07-28 \nllill!I \n90.36 \n90.36 \n2018-07-28 \nInvoice date totals \n90.36 \n90.36 \n2018-07-30 \n2018-09-03 \n22.57 \n0.00 \n2018-07-30 \nInvoice date totals \n22.57 \n0.00 \n2018-07-31 \nUt!HI \n10976.06 \n10976.06 \n2018-07-31 \nInvoice date totals \n10976.06 \n10976.06 \nGrand totals \nInvoice date totals \n39867.22 \n11569.62 \nDescription \n• \nThe GROUPING function returns 1 if the expression is null because it's in a \nsummary row. Otherwise, it returns 0. \nFigure 6-8 \nHow to use the GROUPING function (part 1 of 2)\n\n186 \nSection 2 \nMore SQL skills cts you need them \nPart 2 of figure 6-8 shows another common use for the GROUPING \nfunction. The query in this example is identical to the second one in part 1 \nof this figure, except that it includes a HAVING clause. This clause uses the \nGROUPING function to filter the result set so only the summary rows are \nincluded. To do that, it checks if this function returns a value of 1 for the \ninvoice_date or payment_date column.\n\nChapter 6 \nHow to code sum1n.ary queries \n187 \nA query that displays only summary rows \nSELECT IF(GROUPING(invoice_date) = l , 'Grand totals', invoice_date) \nAS invoice_date, \nIF(GROUPING (payment_date) = l , 'Invoice date totals', payment_date) \nAS payment_date, \nSUM(invoice_total) AS invoice_total, \nSUM(invoice_ total - credit_ total - payment_total) AS balance_due \nFROM invoices \nWHERE invoice_date BETWEEN '2018-07-24' AND '2018-07- 31' \nGROUP BY invoice_date, payment_date WITH ROLLUP \nHAVING GROUPING(invoice date) = 1 OR GROUPING{payment date)\n= ~ \n• \n-\n-\ninvoice _date \npayment_date \ninvoice_total \nbalance_due \n► \n2018-07-24 \nInvoice date totals \nl.7111. n \n503.20 \n2018-07-25 \nInvoice date totals \n1000.46 \n0.00 \n2018-07-28 \nInvoice date l'Otals \n90.36 \n90.36 \n2018-07-30 \nInvoice date totals \n22.57 \n0.00 \n2018-07·31 \nInvoice date totals \n10976.06 \n10976.06 \nGrand totals \nInvoice date totals \n39867.22 \n11569.62 \n. .., \nDescription \n• \nThe GROUPING function is co1nmo1tly used to replace the nulls that are gener-\nated by WITH ROLLUP with literal values. To do that, you can use it with the IF \nfunction as shown in this figure. \ni \n' \n' \n• \nThe IF function evaluates the expression in the frrst argument and returns the \nsecond argument if the expression is true and the third argument if the expression is \nfalse. See chapter 9 for more information on this function. \n• \nIf you want to display just the summary rows produced by the WITH ROLL UP \noperator, you can include one or more GROUPING functions in the HAVING \nclause. \n• \nIn addition to the SELECT and HA VINO clauses, you can code the GROUPING \nfunction in the ORDER BY clause. \nFigure 6-8 \nHow to use the GROUPING function (part 2 of 2) \n'\n\n188 \nSection 2 \nMore SQL skills cts you need them \nHow to code aggregate \nwindow functions \nIn the topics that follow, you '11 learn how to use the aggregate window \nfunctions that were introduced with MySQL 8.0. You can use the window \nfunctions with any of the aggregate functions you learned about in this chapter. \nHow the aggregate window functions work \nEarlier in this chapter, you learned how to use some of the aggregate \nfunctions with the GROUP BY clause to group and summarize data. When \nyou use GROUP BY, a single row is returned for each unique set of values in \nthe grouped columns. If a result set is grouped by the vendor_id column, for \nexample, only one row is returned for each vendor, and that vendor is summa-\nrized by the aggregate functions that are included in the SELECT clause. \nAggregate window functions are similar except that the groups, or partitions, \nai:en't collapsed to a single row. Instead, all of the rows in the result set are \nreturned. \nFigure 6-9 illustJ:ates how this works. To start, you code an aggregate \nwindow function by including the OVER clause. This clause defines the window \nthat's used by the aggregate function. A window consists of all of the rows that \nare needed to evaluate the function for the current row. You'll learn more about \nhow this works as you review the examples that follow. \nThe fust example in this figure shows a SELECT statement that includes \ntwo aggregate window functions. Both of these functions use the SUM function \nto calculate a total of the invoice_total column. However, the OVER clause for \nthe first function is empty, which means that all of the rows in the result set \nare included in a single partition. Because of that, the total_invoices column \ncontains the same value for each column, which is the total of all of the invoices \nin the result set. In this case, to calculate the total of all invoices, the SUM \nfunction for each row needs a window into all of the other rows in the result set. \nBy contrast, the second window function in this query uses the PARTITION \nBY clause to partition the result set by the vendor_id column. That way, the sum \nof the invoice totals is calculated for each vendor instead of for all vendors. You \ncan see the result of this function in the vendor_total column. In this case, to \ncalculate the total of all invoices for each vendor, the SUM function for each row \nneeds a window into all the other rows for the same vendor. That means that if \nthe fust row for vendor 110 is the current row, it needs a window into the other \nfour rows for that vendor. \nIf you want to sort the rows within each partition, you can code the ORDER \nBY clause on the OVER clause. This is illustrated by the second example in this \nfigure. Here, the second aggregate window fi.1nction indicates that the invoices \nfor eacl1 vendor should be sorted by the invoice_total column. If you compare \nthe sequence of the invoices for vendor 110 in this result set with the sequence in \nthe first result set, you shouldn't have any trouble understanding how this works.\n\nChapter 6 \nHow to code sum1ncary queries \n189 \nThe basic syntax of the OVER clause \nOVER{[PARTITION BY expressionl [, expression2] ••• \n[ORDER BY expressionl [ASCjDESC] [, expression2 [ASC IDESC]] ••• ) \nA SELECT statement with two aggregate window functions \nSELECT vendor_ id, invoice_date, invoice_ total, \nSUM{invoice_total) OVER() AS total_ invoices, \nSUM{invoice_ total) OVER(PARTITION BY vendor_ id) AS vendor_total \nFROM invoices \nWHERE invoice_total > 5000 \n,- I vendor_id \ninvoice_date \n1nvolce_total \ntotal_invoices \nvendor _total \n► \n72 \n2018-06-01 \n21842.00 \n155800.00 \n21842.00 \n99 \n2018-06-18 \n6940.25 \n155800.00 \n6940.25 \n104 \n2018-05-21 \n7125.34 \n155800.00 \n7125.34 \n110 \n2018-05-28 \n37966.19 \n155800.00 \n119892.41 \n110 \n2018-07-19 \n26881.-10 \n155800.00 \n119892.41 \n110 \n2018-07-23 \n20551.18 \n155800.00 \n119892.41 \n110 \n2018-07-24 \n23517.58 \n155800.00 \n119892.41 \n110 \n2018-07-31 \n10976.06 \n155800.00 \n119892.41 \nA SELECT statement that includes a cumulative total \nSELECT vendor_ id, invoice_date, invoice_total, \nSUM{invoice_total ) OVER() AS total_ invoices, \nSUM{invoice_total) OVER(PARTITION BY vendor_ id \nORDER BY invoice_ total) AS vendor_total \nFROM invoices \nWHERE invoice_total > 5000 \nvendor id \ninvoice date \ninvoice total \ntotal invoices \nvendor total \n-\n-\n-\n-\n-\n► \n72 \n2018-06-01 \n21842.00 \n155800.00 \n21842.00 \n99 \n2018-06-18 \n6940.25 \n155800.00 \n6940.25 \n104 \n2018-05-21 \n7125.34 \n155800.00 \n7125.34 \n110 \n2018-07-31 \n10976.06 \n155800.00 \n10976.06 \n110 \n2018--07-23 \n20551.18 \n155800.00 \n31527.24 \n110 \n2018-07-24 \n23517.58 \n155800.00 \n55044.82 \n110 \n2018-07-19 \n26881.40 \n155800.00 \n81926.22 \n110 \n2018-05-28 \n37966.19 \n155800.00 \n119892.41 \nDescription \n• \nThe window functions can be used with all of the aggregate functions listed in \nfigure 6-1, as well as others. \n• \nUnlike aggregate functions that use GROUP BY, the groups, or partitions, in an \naggregate window function are not collapsed to a single row. \n• \nA window consists of all of the rows that are needed to calculate the aggregate \nvalue for the current row. \n• \nTo treat an aggregate function as a window function, you include an OVER clause \nthat indicates how to partition the rows in the result set. \n' \n• If you code an e1npty OVER clause, the entire result set is treated as a single partition. \n• If you code an OVER clause with a PARTITION BY clause, the aggregate function \nis performed on each partition. \n• \nIf you code an ORDER BY clause on the OVER clause, the rows within each parti-\ntion are sorted and the values from one row to the next are cumulative. \nFigure 6-9 \nHow the aggregate window functions work\n\n190 \nSection 2 \nMore SQL skills cts you need them \nAnother difference between these two result sets are the values in the \nvendor_total column for vendor 110. That's because, when you code the \nORDER BY clause, the frame includes all of the rows from the start of the parti-\ntion through the current row. You'll learn more about defining frames explicitly \nin the next figure. For now, just realize that a frame consists of one or more rows \nwithin a partition relative to the current row. \nFor the SUM function, this means that the column contains a cumulative \ntotal for each vendor. To see how this works, you can compare the values in \nthe vendor total column with the values in the invoice total column for vendor \n-\n-\n110. Here, the values for the first row are the same. However, the second row \nin the vendor_total column contains the value of the first row plus the value of \nthe second row in the invoice total colunm. The third row in the vendor total \n-\n-\ncolumn contains the value of the second row plus the value of the thit·d row in \nthe invoice total column. And so on. \nHow to use frames \nIn addition to partitioning the rows in the result set for an aggregate \nfunction, you can create a frame that defines a subset of the current partition. \nBecause a frame is relative to the current row, it can move within a partition as \nthe current row changes. As you'll see, that makes it easy to calculate cumulative \ntotals and moving averages. \nFigure 6-10 shows the syntax for defining a frame. To start, you can code the \nROWS or RANGE keyword. If you use ROWS, the frame is detemuned by the \nnumber of rows before and after the current row. If yot1 use RANGE, the frame \nis deter111jned by the value of the rows before and after the current row. In some \ncases, you can get the same result with either ROWS or RANGE. In othe1· cases, \nthough, you'll need to use one or the other to get the result you want. You'll see \nexamples of that in a minute. \nFollowing the ROWS or RANGE keyword, you can specify just the starting \nrow for the frame or both the starting and ending rows. If you specify just the \nstarting row, the ending row is the current row. To specify both a starting and \nending row, you code a BETWEEN clause. \nTo indicate where a frame starts or ends, you can code any of the values \nin the table shown in thls figure. To illustrate, the first example in thls figure \nshows how to defme a frame that includes the first row in the partition up to \nand including the current row. To do that, it uses the ROWS keyword followed \nby a BETWEEN clause that specifies the starting and ending rows. In this case, \nUNBOUNDED PRECEDING indicates that the frame starts at the first row in \nthe partition, and CURRENT ROW indicates that the frame ends at the current \nrow. Then, because the rows in the partitions are sorted, the column contains \ncumulative values. \nNote that, because the frame ends at the current row, you could also define \nthe frame like this: \nROWS UNBOUNDED PRECEDI NG\n\nChapter 6 \nHow to code sum1n.ary queries \n191 \nThe syntax for defining a frame \n{ROWS I RANGE} {frame_start I BETWEEN frame_ start AND frame_ end} \nPossible values for frame start and frame end \nValue \nDescription \nThe frame starts or ends with the current row. \nThe frame starts or ends with the first row in the partition. \nThe frame starts or ends with the last row in the partition. \nCURRENT ROW \nUNBOUNDED PRECEDING \nUNBOUNDED FOLLOWING \nexpr PRECEDING \nWith ROWS, the frame starts expr rows before the current row. With \nRANGE, the frame starts with the first row before the current row \nwhose value is expr less than tl1e value of the cun·ent row. \nexpr FOLLOWING \nWith ROWS, the frame starts expr rows after the current row. With \nRANGE, the frame starts with the last row after the current row whose \nvalue is expr greater than the value of the current row. \nA SELECT statement that defines a frame \nSELECT vendor_ id, invoice_date, invoice_total, \nSUM{invoice_total) OVER{) AS total_ invoices, \nSUM(invoice_total) OVER(PARTITION BY vendor_id ORDER BY invoice date \nROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) \nAS vendor_total \nFROM invoices \nWHERE invoice_date BETWEEN '2018-04-01' AND '2018-04-30' \nvendor_id \nlnvoice_date \ninvoice_total \ntotal_invoices \nvendor _total \n► \n89 \n2018--04-24 \n95.00 \n5828.18 \n95.00 \n95 \n2018-04-30 \n16.33 \n5828.18 \n16.33 \n96 \n2018-04-26 \n66200 \n5828. 18 \n662.00 \n121 \n2018-04-24 \n601.95 \n5828.18 \n601.95 \n122 \n2018-04-08 \n3813.33 \n5828.18 \n3813.33 \n123 \n2018-04-10 \n40.20 \n5828. 18 \n40.20 \n123 \n2018-0+13 \n138.75 \n5828.18 \n178.95 \n123 \n2018-04-16 \n144.70 \n5828.18 \n323.65 \n123 \n2018-04-16 \n15.50 \n5828. 18 \n339. 15 \n123 \n2018-04-16 \n42.75 \n5828.18 \n381.90 \n123 \n2018-04-21 \n172.50 \n5828.18 \n554.40 \n123 \n2018-04-24 \n42.67 \n5828. 18 \n597.07 \n123 \n2018-0+25 \n4250 \n5828.18 \n639.57 \n. \n''I\"' \nDescription \n• \nA frame can be defined as the number of rows before and after the current row \n(ROWS) or a range of values based on the value of the current row (RANGE). \n• \nIf you specify just the starting row for a frame, the ending row is the current row. \nTo specify both a starting and ending row, you use the BETWEEN clause. When \nyou use BETWEEN, the starting row for a frame must not come after the ending \nrow. \nI \n• \nIf an ORDER BY clause is included in the OVER clause and you use the ROWS \nkeyword, values are accumulated up to and including the current row as shown above. \nFigure 6-1 O \nHow to use frames (part 1 of 2)\n\n192 \nSection 2 \nMore SQL skills cts you need them \nIn that case, the ending row defaults to the cun·ent row. You can also omit the \nframe definition entirely, since it's the default when you include ORDER BY on \nthe OVER clause. You saw how that worked in the previous figure. \nPart 2 of figure 6-10 presents two more queries that use frames. The fust \nquery is almost identical to the one in part 1 of this figure. The only difference is \nthat it uses the RANGE keyword instead of the ROWS keyword. Because of that, \nthe frame includes all of the rows within the partition, along with the current row \nand any of its peers. In this case, a peer is a row that has the same value as other \nrows in the sort column. In this example, for instance, the result set includes \nthree invoices dated 2018-04-16 for vendor 123. If you look at the vendor_total \ncolumn for these rows, you'll see that they all contain the same value. That's \nbecause the value of the invoice total colu1nn for all three of these rows is \nincluded in the accumulation for the rows. \nThe second example in this figure illustrates a common use for frames. \nHere, a moving average is calculated for the invoice totals. A moving average is \nan average that's calculated on the current row plus a specified number of rows \nbefore and after the current row. It's particularly useful when working with data \nover a period of time to eliminate short-term fluctuations so long-term trends \nbecome more obvious. \nIn this example, a three-month average is calculated for the sum of invoice \ntotals. To do that, the RANGE keyword is coded with a BETWEEN clause \nthat indicates that the invoice total for the current month, one month before the \ncun·ent month, and one month after the current month should be used to calcu-\nlate the average. The three-month average for month 5, for example, is calculated \nby adding the values in the invoice_total column for months 4, 5, and 6 and \ndividing by 3. \nNote that when you calculate a moving average, there isn't a row before \nthe first row to include in the average. Because of that, the average for that row \nincludes just the invoice totals for the current row and the next row. Similarly, the \naverage for the last row includes just the invoice totals for the current row and \nthe previous row. \nThis query also uses the MONTH function in the SELECT clause, the \nORDER BY clause for the OVER clause, and the GROUP BY clause. This \nfunction extracts the numeric month from a date. You'll learn about this function \nas well as other functions for working with dates in chapter 9.\n\nChapter 6 \nHow to code sum1ncary queries \n193 \nA SELECT statement that creates peer groups \nSELECT vendor_ id, invoice_date, invoice_ total, \nSUM(invoice_total} OVER(} AS total_ invoices, \nSUM(invoice_total} OVER(PARTITION BY vendor_id ORDER BY invoice_date \nRANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW} \nAS vendor_total \nFROM invoices \nWHERE invoice_date BETWEEN '2018-04-01' AND '2018-04-30' \nvendor_id \ninvolce_date \ninvoice_total \ntotal _invoices \nvendor _total \n► \n89 \n2018-04-24 \n95.00 \n5828. 18 \n95.00 \n95 \n2018-04-30 \n16.33 \n5828. 18 \n16.3\"3 \n96 \n2018-04-26 \n662..00 \n5828. 18 \n662.00 \n121 \n2018-04-24 \n601.95 \n5828. 18 \n60L95 \n122 \n2018-04-08 \n3813.33 \n5828.18 \n3813.33 \n123 \n2018-04-10 \n40.20 \n5828. 18 \n'10. 20 \n123 \n2018-04-13 \n138. 75 \n5828. 18 \n178.95 \n-\n123 \n2018-04-16 \n144. 70 \n5828.18 \n381.90 \n123 \n2018-04-16 \n15.50 \n5828.18 \n381.90 \nPeer group \n123 \n2018-04-16 \n42..75 \n5828.18 \n38L90 \n-\n123 \n2018-04-21 \n172.50 \n5828.18 \n554.-10 \n12'3 \n2018-04-24 \n42.67 \n5828.18 \n597.07 \n123 \n2018-04-25 \n42.50 \n5828. 18 \n639.57 \n-\n~ -\nA SELECT statement that calculates moving averages \nSELECT MONTH(invoice_date} AS month, SUM(invoice_total} AS total_ invoices, \nROUND(AVG(SUM(invoice_total}} OVER(ORDER BY MONTH(invoice_date} \nRANGE BETWEEN 1 PRECED:ING AND 1 FOLLOW:ING}, 2} AS 3_month_avg \nFROM invoices \nGROUP BY MONTH(invoice_date) \nmonth \ntotal invoices \n-\n3_month_avg \n► \n4 \n5828.18 \n32212.64 \n5 \n58597. 10 \n39614.34 \n6 \n54417.73 \n69370. 19 \n7 \n95095.75 \n49955.08 \n8 \n351.75 \n4n23.75 \nDescription \n• \nIf an ORDER BY clause is included in the OVER clause and you use the RANGE keyword, \nvalues are accumulated up to and including the current row as well as its peer rows. A peer \nis a row that's in the same sort sequence as other rows in the partition as shown by the first \nexample above. \n• \nYou can use a frame to calculate a moving average. A moving average is calculated by adding \nthe value of the current row to the values of zero or 1nore preceding and following rows. \n• \nBecause there are no preceding rows for the frrst row in a partition, the moving average \nfor that row consists of the average of the value of the current row plus the values of the \nfollowing rows. Similarly, the moving average for the last row consists of the average of \nthe value of the current row plus the values of the previous rows. \nFigure 6-10 \nHow to use frames (part 2 of 2)\n\n194 \nSection 2 \nMore SQL skills cts you need them \nHow to use named windows \nIn some cases, you'll need to code a SELECT statement with two or more \naggregate functions that use the same window. Then, you may want to use a \nnamed window so you don't have to repeat the definition for the window for \neach function. Figure 6-11 shows how to define and use a named window. \nThe frrst example in this figure shows a SELECT statement that includes \nfour of the aggregate functions. Each function includes an OVER clause that \npartitions the rows in the result set by the vendor_id column. To do that, the \nPARTITION BY clause is repeated on each OVER clause. \nAn easier way to do this is to name the window by coding a WINDOW \nclause as shown in the second example. Here, the window is named \nvendor_ window, and it's defined with the PARTITION BY clause. Then, \nthe four aggregate functions include just the window name on the OVER \nclause. In other words, they don't have to repeat the PARTITION BY \nclause. Note that when you code j11st a window name, you don't enclose it \nin parentheses. \nIf you review the code in this example, you might wonder why you would \nuse a named window. After all, the code isn't any simpler since the window \ndefinition consists of only a PARI'l'l'ION BY clause. The answer is that, if you \nwanted to change the window definition, you would only need to do it in one \nplace. Of course, window names provide even mo1·e of an advantage as your \nwindow definitions get more complex. \nThe thil·d example in this figure shows how you can modify a window \ndefinition when you use it. To do that, you can add a PARTITION BY or \nORDER BY clause or a frame definition. In this example, the named window \npartitions the rows in the result set by the vendor_id column just like the second \nexample. Then, the SELECT clause includes two columns that sum the invoice \ntotals for each vendor. Both columns use the named window, but they sort the \ntotals in a different sequence. To do that, the window name is followed by an \nORDER BY clause, and both the name and clause are enclosed in parentheses. \nWhen you use named windows, you should know that you can't modify any \nof the clauses that are included in the window definition. For example, because \nthe window in the third example includes a PARTITION BY clause, you can't \ninclude that clause on an OVER clause that uses the named window. Instead, \nyou can only add to the window definition.\n\nChapter 6 \nHow to code sum1ncary queries \n195 \nThe syntax for naming a window \nWINDOW window_name AS ([partition_clause] [order_clause] [frame_clause]) \nA SELECT statement with four functions that use the same window \nSELECT vendor_id, invoice_date, invoice_ total, \nSUM(invoice_total) OVER(PARTITION BY vendor_ id) AS vendor_total, \nROUND(AVG(invoice_total) OVER(PARTITION BY vendor_ id) , 2) AS vendor_avg, \nMAX(invoice_ total) OVER(PARTITION BY vendor_ id) AS vendor_max, \nMIN(invoice_ total) OVER(PARTITION BY vendor_ id) AS vendor_min \nFROM invoices \nWHERE invoice_total > 5000 \nA SELECT statement with a named window \nSELECT vendor_ id, invoice_ date, invoice_ total, \nSUM(invoice_ total) OVER vendor_ windrn,t AS vendor_ total, \nROUND(AVG(invoice_total) OVER vendor_window, 2) AS vendor_avg, \nMAX(invoice_ total) OVER vendor_window AS vendor_ma~, \nMIN(invoice_ total) OVER vendor_window AS vendor_min \nFROM invoices \nWHERE invoice_total > 5000 \nWINDOW vendor_window AS (PARTITION BY vendor_ id) \nThe result set for both statements \nvendorjd \ninvoice_date \ninvoice_total \nvendor _total \nvendor_avg \nvendor_max \nvendor_min \n► n \n2018-06,-01 \n21842.00 \n21842.00 \n21842.00 \n21842.00 \n21842.00 \n99 \n2018-06-18 \n6940.25 \n6940.25 \n6940.25 \n6940.25 \n6940.25 \n104 \n2018-05-21 \n7125.34 \n7125.34 \n7l25.34 \n7125.34 \n7l25.34 \n110 \n2018-05-28 \n37966.19 \n119892,41 \n23978.48 \n37966.19 \n10976.06 \n110 \n2018-07-19 \n26881.40 \n119892.4 1 \n23978.48 \n37966.19 \n10976.06 \n110 \n2018-07-23 \n20551.18 \n119892.41 \n23978.48 \n37966.19 \n10976.06 \n110 \n2018-07-24 \n23517.58 \n119892.41 \n23978.48 \n37966.19 \n10976.06 \n110 \n2018-07-31 \n10976.06 \n119892.41 \n23978.48 \n37966.19 \n10976.06 \n\"\"=' \n1, \nA SELECT statement that adds to the specification for a named window \nSELECT vendor_ id, invoice_date, invoice_total, \nSUM(invoice_ total) OVER (vendor_window ORDER BY invoice_ date ASC) \nAS invoice_date_asc, \nSUM(invoice_ total) OVER (vendor_window ORDER BY invoice_date DESC) \nAS invoice_date_desc \nFROM invoices \nWHERE invoice_total > 5000 \nWINDOW vendor_window AS (PARTITION BY vendor_ id) \nDescription \n• \nTo define a named window, you code a WINDOW clause. This clause should be coded \nafter the HAVING clause and before the ORDER BY clause, if those clauses are included. \n• \nTo use a named window, you code it on the OVER clause. If you code just the window \nname, you don't include parentheses. \n• \nIf a WINDOW clause doesn't include a PARTITION BY or ORDER BY clause or a \nframe definition, you can add it to the window when you use it. To do that, you code \nthe window name and the additional clause in parentheses after the OVER keyword. \nFigure 6-11 \nHow to use named windows\n\n196 \nSection 2 \nMore SQL skills cts you need them \nPerspective \nIn this chapter, you learned how to code queries that group and summarize \ndata. In most cases, you '11 be able to use the techniques presented here to get \nthe summary information you need. \nTerms \nscalar function \naggregate function \ncolumn function \nsummary query \nfunctionally dependent column \naggregate window function \nExercises \npartition \nwindow \nframe \npeer \n• \nmovmg average \nnamed window \n1. \nWrite a SELECT statement that returns one row for each vendor in the \nInvoices table that contains these columns: \nThe vendor_id column from the Invoices table \nThe sum of the invoice total columns in the Invoices table for that vendor \n-\nThis should return 34 rows. \n2. \nWrite a SELECT statement that returns one row for each vendor that contains \nthese columns: \nThe vendor_name column from the Vendors table \nThe sum of the payment_total columns in the Invoices table for that vendor \nSort the result set in descending sequence by the payment total sum for each \nvendor. \n3. \nWrite a SELECT statement that returns one row for each vendor that contains \nthree columns: \nThe vendor name column from the Vendors table \nThe count of the invoices in the I11voices table for each vendor \nThe sum of the invoice_total columns in the Invoices table for each vendor \nSort the result set so the vendor with the most invoices appears first. \n4. \nWrite a SELECT statement that returns one row for each general ledger \naccount number that contains three columns: \nThe account_description column from the General_Ledger_Accounts table \nThe count of the items in the Invoice Line Items table that have the same \n-\n-\naccount_number\n\nChapter 6 \nHow to code sum1ncary queries \n197 \nThe sum of the line item amount columns in the Invoice Line Items table \n-\n-\nthat have the same account_nu1nber \nReturn only those rows where the count of line items is greater than 1. This \nsl1ould return 10 rows. \nGroup the result set by the account_description column. \nSort the resL1lt set in descending sequence by the sum of the line item \na1nounts. \n5. \nModify the solution to exercise 4 so it returns only invoices dated in the \nsecond quarter of 2018 (April 1, 2018 to June 30, 2018). This should still \nreturn 10 rows but with some different line item counts for each vendor. Hint: \nJoin to tlie Invoices table to code a secirch condition based on invoice_date. \n6. \nWrite a SELECT statement that answers this question: What is the total \namount invoiced for each general ledger account nt1mber? Return these \ncolumns: \nThe account number column fro1n the Invoice Line Items table \n-\n-\n-\nThe sum of the line_item_amount columns from the Invoice_Line_Items \ntable \nUse the WITH ROLLUP operator to include a row that gives the grand total. \nThis should return 22 rows. \n7. \nWrite a SELECT statement that answers this question: Which vendors are \nbeing paid from more than one account? Return these columns: \nThe vendor name colL1mn from the Vendors table \nThe count of distinct general ledger accounts that apply to that vendor's \n• \n• \n1nvo1ces \nThis should return 2 rows. \n8. \nWrite a SELECT statement that answers this question: What are the last \npayment date and total amount due for each vendor with each terms id? \nReturn these columns: \nThe terms id column from the Invoices table \nThe vendor id column from the Invoices table \nThe last payment date for each combination of terms id and vendor id in the \nInvoices table \nThe sum of the balance due (invoice_total - payment_total - credit_total) \nfor each combination of terms id and vendor id in the Invoices table \nUse the WITH ROLLUP operator to include rows that give a summa1-y for \neach terms id as well as a row that gives the grand total. This should return 40 \nrows. \nUse the IF and GROUPING functions to replace the null values in the terms_id \nand vendor_id columns with literal values if they're for st1mmary rows.\n\n198 \nSection 2 \nMore SQL skills cts you need them \n9. \nWrite a SELECT statement that uses aggregate window functions to calculate \nthe total due for all vendors and the total due for each vendor. Return these \ncolumns: \nThe vendor id from the Invoices table \nThe balance due (invoice_total - payment_total - credit_total) for each \ninvoice in the Invoices table with a balance due greater than 0 \nThe total balance due for all vendors in the Invoices table \nThe total balance due for each vendor in the Invoices table \nModify the column that contains the balance due £01· each vendor so it \ncontains a cumulative total by balance due. This should return 11 rows. \n10. Modify the solution to exercise 9 so it includes a column that calculates the \naverage balance due for each vendor in the Invoices table. This column should \ncontain a cumulative average by balance due. \nModify the SELECT statement so it uses a named window for the last two \naggregate window functions. \n11. Write a SELECT statement that uses an aggregate window function to calcu-\nlate a moving average of the sum of invoice totals. Return these columns: \nThe month of the invoice date from the Invoices table \nThe sum of the invoice totals from the Invoices table \nThe moving average of the invoice totals sorted by invoice month \nThe result set should be grouped by invoice month and the frame for the \nmoving average should include the current row plus tlu·ee rows before the \ncurrent row.\n\nHow to code subqueries \nSubqueries allow you to build queries that would be difficult or impossible \nto build otherwise. In chapter 5, you learned how to use them in INSERT, \nUPDATE, and DELETE statements. In this chapter, you'll learn how to use \nsubqueries in SELECT statements. \nAn introduction to subqueries .......................................... 200 \nWhere to code subqueries ........................................................................... 200 \nWhen to use subqueries .............................................................................. 202 \nHow to code subqueries in the WHERE clause .............. 204 \nHow to use the IN operator ......................................................................... 204 \nHow to use the comparison operators ........................................................ 206 \nHow to use the ALL keyword .................................................................... 208 \nHow to use the ANY and SOME keywords ................................................ 210 \nHow to code correlated subqueries .............................................................. 212 \nHow to use the EXISTS operator ................................................................ 214 \nHow to code subqueries in other clauses ....................... 216 \nHow to code subqueries in the HAVING clause ......................................... 216 \nHow to code subqueries in the SELECT clause .......................................... 216 \nHow to code subqueries in the FROM clattse ............................................. 218 \nHow to work with complex queries .................................. 220 \nA complex query that uses subqueries ........................................................ 220 \nA procedure for building complex queries ................................................. 222 \nHow to work with common table expressions ................ 224 \nHow to code a CTE .............................................. ....................................... 224 \nHow to code a recursive CTE ...................................................................... 226 \nPerspective ......................................................................... 228\n\n200 \nSection 2 \nMore SQL skills cts you need them \nAn introduction to subqueries \nAs you learned in chapter 5, a subquery is a SELECT statement that's coded \nwithin another SQL statement. Since you already know how to code SELECT \nstatements, you already know how to code subqueries. Now you just need to \nlearn where you can code them and when you should use them. \nWhere to code subqueries \nFigure 7-1 shows that a subquery can be coded, or introduced, in the \nWHERE, HAVING, FROM, or SELECT clause of a SELECT statement. In this \nfigure, for example, the SELECT statement shows how you can use a subquery \nin a WHERE clause. This statement retrieves all the invoices from the Invoices \ntable that have invoice totals greater than the average of all the invoices. To do \nthat, the subquery calculates the average of all the invoices. Then, the search \ncondition tests each invoice to see if its invoice total is greater than that average. \nWhen a subquery returns a single value as it does in this example, you can \nuse it anywhere you would normally use a single value. However, a subquery \ncan also return a list of values (a result set that has one column). In that case, \nyou can use the subque1·y in place of a list of values, such as the list for an IN \noperator. In addition, a subquery can return a table of values (a result set that has \nmultiple columns). In that case, you can use the subquery in the FROM clause in \nplace of a table. In this chapter, you '11 learn about all of these different types of \nsubqueries. \nFinally, you can code a subquery within another subquery. In that case, the \nsubqueries are said to be nested. Because nested subqueries can be difficult to \nread, you should use them only when necessary.\n\nChapter 7 \nHow to l·ode subqueries \n201 \nFour ways to introduce a subquery in a SELECT statement \n1. In a WHERE clause as a search condition \n2. In a HAVING clause as a search condition \n3. In the FROM clause as a table specification \n4. In the SELECT clause as a column specification \nUse a subquery in the WHERE clause \nSELECT invoice_ n.11mh,=ir, invoice_date, invoice total \nFROM invoices \nWHERE invoice total> \n(SELECT AVG(invoice_ total) \nFROM invoices) \nORDER BY invoice_total \nThe value returned by the subquery \n1879.741316 \nThe result set \n' invoice number \ninvoice_date \ninvoice_ total \n► \n939319-qa7 \n2018-06-20 \n1927. 54 \n97/Sn. \n2018-06-28 \n1962.13 \n989319-417 \n.20 18-07 · 23 \n2051.59 \n989319-427 \n2018-06-16 \n2 115.81 \n989319-4n \n2018-06-08 \n2 184.11 \n587056 \n2018-06-30 \n2184.50 \n( 2 1 rows ) \nDescription \n• \nA subquery is a SELECT statement that's coded within another SQL statement. For \nthis to work, yo11 m11st enclose the subquery in parentheses. \n• \nA subquery can return a single value, a list of values ( a result set that has a single \ncolumn), or a table of values (a result set that has multiple columns). \n• \nA subquery can be coded, or introduced, anywhere a single value, a list of values, \nor a table is allowed. \n• \nThe syntax for a subquery is the same as for a standard SELECT statement. \nHowever, a subquery can't include an ORDER BY clause. \n• \nSubqueries can be nested within other subqueries. \nFigure 7-1 \nWhere to code subqueries \nL \n'\n\n202 \nSection 2 \nMore SQL skills cts you need them \nWhen to use subqueries \nIn the last figure, you saw an example of a subquery that returns an aggre-\ngate value that's used in the search condition of a WHERE clause. This type of \nsubquery provides for processing that can't be done any other way. However, \nmost subqueries can be restated as joins, and most joins can be restated as \nsubqueries as shown by the SELECT statements in figure 7-2. \nBoth SELECT statements in this figure return a result set that consists of \nselected rows and columns from the Invoices table. In this case, only the invoices \nfor vendors in California are 1·eturned. The first statement uses a join to con1bine \nthe Vendors and Invoices tables so the vendor_state column can be tested for \neach invoice. In contrast, the second statement uses a subquery to return a \nresult set that consists of the vendor id column for each vendor in California. \nThen, that result set is used with the IN operator in the search condition so only \ninvoices with a vendor id in that result set are included in the final result set. \nSo if you have a choice, which technique should you use? In general, we \nrecommend that you use the technique that results in the most readable code. \nFor example, a join tends to be more intuitive than a subquery when it uses an \nexisting relationship between two tables. That's the case with the Vendors and \nInvoices tables used in this figure. On the other hand, a sttbquery tends to be \nmore intuitive when it uses an ad hoc relationship. \nYou should also realize that when you use a subquery in a WHERE clause, \nits results can't be included in the final result set. For instance, the second \nexample in this figure can't be changed to include the vendor_name column \nfrom the Vendors table. That's because the Vendors table isn't named in the \nFROM clause of the main query. So if you need to include information fro1n \nboth tables in the result set, you need to use a join.\n\nChapter 7 \nHow to l·ode subqueries \n203 \nA query that uses an inner join \nSELECT invoice_ n11mber, invoice_date, invo ice_total \nFROM invoices JOIN vendors \nON invoic e s.vendor_ id = vendors.vendor_ id \nWHERE vendor_ state = 'CA' \nORDER BY invoice_ date \nThe same query restated with a subquery \nSELECT invoice_ n1JmhP.r, invoice_date, invoice_total \nFROM invoic es \nWHERE vendor_ id IN --\n(SELECT vendor_ i ~ \nFROM vendors \nNBERE vendor_ state = 'CA') \nORDER BY invoic e _ date \nThe result set returned by both queries \nl invoice_number \ninvoice_date \ninv01ce_total \n-\n► \n125520-1 \n2018-04-24 \n95.00 \n97/488 \n2018-04-24 \n601.95 \n111-92R-10096 \n2018-04-30 \n16.33 \n25022117 \n2018-05-01 \n6.00 \n(40 rows ) \nAdvantages of joins \n• \nThe SELECT clause of a join can include columns from both tables. \n• \nA join tends to be more intuitive when it uses an existing relationship between the \ntwo tables, such as a primary key to foreign key relationship. \nAdvantages of subqueries \n• \nYou can use a subquery to pass an aggregate value to the main query. \n• \nA subquery tends to be more intuitive when it uses an ad hoc relationship between \nthe two tables. \n• \nLong, complex queries can sometimes be easier to code using subqueries. \nDescription \n• \nLike a join, a subquery can be used to code queries that work with two or more \ntables. \n• \nMost subqueries can be restated as joins and most joins can be restated as \nsubqueries. \nFigure 7-2 \nWhen to use subqueries\n\n204 \nSection 2 \nMore SQL skills cts you need them \nHow to code subqueries \nin the WHERE clause \nYou can use a variety of techniques to work with a subquery in a WHERE \nclause. You'll learn about these techniques in the topics that follow. \nHow to use the IN operator \nIn chapter 3, you learned how to use the IN operator to test whether an \nexpression is contained in a list of values. One way to provide that list of values \nis to use a subquery as shown by figure 7-3. \nThe example in this figure retrieves the vendors from the Vendors table that \ndon't have invoices in the Invoices table. To do that, it uses a subquery to return \na list of IDs for each vendor that's in the Invoices table. Then, the main query \nreturns some data about the vendors whose IDs aren't in that list. \nWhen you use the IN operator with a subquery, the subquery must return a \nsingle column that provides the list of values. In this figure, the subquery also \nincludes the DISTINCT keyword. That way, if more than one invoice exists for \na vendor, the subquery only includes a single ID for th.e vendor. However, this \nkeyword is optional and has no effect on the final result set. \nIn the previous figure, you saw that a query that uses a subq11ery with the \nIN operator can be restated using an inner join. Similarly, a query that uses a \nsubquery with the NOT IN operator can typically be restated using an outer join. \nIn this figure, for instance, the first query can be restated as shown in the second \nquery. In this case, though, the first query is more readable.\n\nChapter 7 \nHow to l·ode subqueries \n205 \nThe syntax of a WHERE clause that uses an IN phrase \nWHERE test_expression [NOT] IN (subquery) \nGet vendors without invoices \nSELECT vendor_ id, vendor_name, vendor_state \nFROM vendors \nWHERE vendor_ id NOT IN \n(SELECT DISTINCT vendor_ id \nFROM invoic es ) \nORDER BY vendor id \nThe result of the subquery \nvendor_id \n► \n34 \n37 \n'18 \n72 \n80 \n81 \n82 \n(34 rows) \nThe result set \nvendor jd \nvendor _name \n33 \nNielson \n35 \nCal State Termite \n36 \nGraylift \n38 \nVenture Communications Int'I \n39 \nCustom Printing Company \nI \ntlO \nNat Assoc of College Stores \n(88 rows) \nvendor _state \nOH \nCA \nCA \nNY \nMO \nOH \nThe query restated without a subquery \nSELECT v .vendor_ id, vendor_ name, vendor_ state \nFROM vendors v LEFT JOIN invoices i \nON v . vendor_ id = i .vendor_ id \nWHERE i.vendor_ id IS NULL \nORDER BY v .vendor_ id \nDescription \n• \nYou can introduce a subquery with the IN operator to provide the list of values that \nare tested against the test expression. \n• \nWhen you use the IN operator, the subquery must return a single column of values. \n• \nA query that uses the NOT IN operator with a subquery can typically be restated \nusing an outer join. \nFigure 7-3 \nHow to use the IN operator\n\n206 \nSection 2 \nMore SQL skills cts you need them \nHow to use the comparison operators \nFigure 7-4 shows how you can use the comparison operators to compare an \nexpression with the result of a subquery. In this example, the subquery returns \nthe average balance due of the invoices in the Invoices table that have a balance \ndue greater than zero. Then, it uses that value to retrieve all invoices with a \nbalance due that's less than the average. \nWhen you use a compaiison operator as shown in this figure, the subquery \nmust return a single value. In most cases, that means that it uses an aggregate \nfunction. However, you can also use the comparison operators with subque-\nries that return a list of values. To do that, you use the SOME, ANY, or ALL \nkeywords as shown in the next two figures.\n\nChapter 7 \nHow to l·ode subqueries \n207 \nThe syntax of a WHERE clause that uses a comparison operator \nWHERE expression comparison_ operator [SOMEIANYIALL] (subquery) \nGet invoices with a balance due less than the average \nSELECT invoice_ r.t,,rnh~r, invoice_date, \ninvoice_ total - payment_ total - credit_ total AS halance_due \nFROM invoices \nWHERE invoice_ total - payment_ total - credit_ total > 0 \nAND invoice total - payment_ total - credit total< \n( \nSELECT AVG(invoice_ total - payment_ total - credit_ total) \nFROM invoices \nWHERE invoice_ total - payment_ total - credit_ total > 0 \n) \nORDER BY invoice_ total DESC \nThe value returned by the subquery \n2910.947273 \nThe result set \ninvoice _number \ninvoice_date \nbalance_due \n► \n31361833 \n2018-07-21 \n579.42 \n99s2n1 \n.2018-07-24 \n503.20 \n547480102 \n2018-08-01 \n224.00 \n134116 \n2018-07-28 \n90.36 \n39104 \n2018-07-10 \n85.31 \n263253270 \n2018-07-22 \n67.92 \n( 9 rows ) \nDescription \n• \nYou can use a comparison operator in a WHERE clause to compare an expression \nwith the results of a subquery. \n• \nIf you code a search condition without the ANY, SOME, and ALL keywords, the \nsubquery must return a single value. \n• \nIf you include the ANY, SOME, or ALL keyword, the subquery can return a list of \nvalues. See figures 7-5 and 7-6 for more information on using these keywords. \nFigure 7-4 \nHow to use the comparison operators\n\n208 \nSection 2 \nMore SQL skills cts you need them \nHow to use the ALL keyword \nFigure 7-5 shows how to use the ALL keyword to modify the comparison \noperator so the condition must be true for all the values returned by a subquery. \nThe table at the top of this figure shows how this works. Here, the values in \nparentheses 1·epresent the values returned by the query. \nIf you use the greater than operator(>), the expression must be greater than \nthe maximum value returned by the subquery. Conversely, if you use the less \nthan operator ( < ), the expression must be less than the minimum value returned \nby the subquery. If you use the equal operator ( = ), all of the values returned by \nthe subquery must be the same and the expression must be equal to that value. \nAnd if you use the not equal operator ( <>), the expression must not equal any \nof the values returned by the subquery. However, a not equal condition can be \nrestated using the NOT IN operator, which is easier to read. As a result, it's a \nbetter practice to use the NOT IN operator for this type of condition. \nThe query in this figure shows how to use the greater than operator with the \nALL keyword. Here, the subquery selects the invoice_total column for all the \ninvoices with a vendor_id value of 34. This results in a list of two values. Then, \nthe main query retrieves the rows from the Invoices table that have invoice totals \ngreater than both of the values returned by the subquery. In other words, this \nquery returns all the invoices that have totals greater than 1083.58, which is the \nlargest invoice for vendor number 34. \nWhen you use the ALL operator, the comparison evaluates to true if the \nsubquery doesn't return any rows. In contrast, the comparison evaluates to false \nif the subquery returns only null values. \nIn many cases, you can rewrite a condition with the ALL keyword so it's \neasier to read. For example, you could rewrite the query in this figure to use the \nMAX function like this: \nWHERE invoice_total > \n(SELECT MAX(invoice_total) \nFROM invoices \nWHERE vendor_ id = 34) \nAs a result, we recommend replacing the ALL keyword with an equivalent \ncondition whenever it makes the query easier to read.\n\nChapter 7 \nHow to l·ode subqueries \n209 \nHow the ALL keyword works \nCondition \nEquivalent expression \nDescription \nX > ALL (1, 2} \nX > 2 \nEvaluates to true if x is greater than the \nmaximum value returned by the subquery. \nX < ALL (1, 2 } \nX < 1 \nEvaluates to true if x is less than the mini-\nmum value returned by the subquery. \nX = ALL (1, 2 } \n(x = 1 } AND (x = 2} \nEvaluates to true if the subquery returns a \nsingle value that's equal to x or if the sub-\nquery returns multiple values that are the \nsame and these values are all equal to x. \nX <> ALL (1, 2 } \nx NOT IN (1, 2} \nEvaluates to true if xis not one of the \nvalues returned by the subquery. \nGet invoices larger than the largest invoice for vendor 34 \nSELECT vendor_name, invoice_ n,,rnber, invoice_ total \nFROM invoices i JOIN vendors v ON i.vendor_ id = v.vendor_ id \nWHERE invoice total > ALL \n( SELECT invoice_ total \nFROM invoices \nWHERE vendor_ id = 34} \nORDER BY vendor name \nThe result of the subquery \ninvoice total \n-\n► \n116.54 \n1083.58 \nThe result set \nI vendor name \n► f Bertelsm~ \nIndustry Svcs. Inc \nCahners Publishing Company \nComputerworid \ninvoice_number \ninvoice_total -\n509786 \n69~.25 \n587056 \n2184.50 \n367447 \n2433,00 \nData Reproducbons Corp \n~318 \n21842.00 \n(2 5 rows ) \nDescription \n• \nYou can use the ALL keyword to test that a comparison condition is true for all of \nthe values returned by a subquery. \n• \nIf no rows are returned by the subquery, a comparison that uses the ALL keyword is \nalways true. \n• \nIf all of the rows returned by the subquery contain a null value, a comparison that \nuses the ALL keyword is always false. \nFigure 7-5 \nHow to use the ALL keyword \n.t\n\n210 \nSection 2 \nMore SQL skills cts you need them \nHow to use the ANY and SOME keywords \nFigure 7-6 shows how to use the ANY and SOME keywords to test whether \na comparison is true for any of the values returned by a subquery. Since both of \nthese keywords work the same, you can use whichever one you pref er. For the \nsake of brevity, this figure uses the ANY keyword in its examples. However, you \ncan substitute the SOME keyword for the ANY keyword to get the same results. \nThe example in this figure shows how you can use the ANY keyword \nwith the less than operator. This statement is similar to the one you saw in the \nprevious figure, except that it retrieves invoices with invoice totals that are less \nthan at least one of the invoice totals for a given vendor. Like the statement in \nthe previous figure, this condition can be rewritten using the MAX function, as \nfollows: \nWHERE invoi ce_total < \n(SELECT MAX (invoice _t otal) \nFROM i nvoices \nWHERE vendor id = 115) \nSince this statement is easier to read, we recommend using statements like this \none instead of statements that use the ANY keyword whenever possible.\n\nChapter 7 \nHow to l·ode subqueries \n211 \nHow the ANY keyword works \nCondition \nEquivalent expression \nDescription \nx > ANY (1, 2) \nX > 1 \nx < ANY (1 , 2) \nX < 2 \nx = ANY (1 , 2) \nx IN (1 , 2) \nX <> ANY (1 , 2 ) \n(x <> 1) OR (x <> 2 ) \nEvaluates to true if x is greater than the \n1.n.inimum value returned by the subquery. \nEvaluates to true if xis less than the maxi-\nmum value returned by the subquery. \nEvaluates to true if x is equal to any of the \nvalues returned by the subquery. \nEvaluates to true if x is not equal to at least \none of the values returned by the subquery. \nGet invoices smaller than the largest invoice for vendor 115 \nSELECT vendor_name, invo ice_number, invoic e_ total \nFROM vendors JOIN invoices ON vendors.vendor_ id = invoices.vendor id \nWHERE invoic e _ total < ANY \n(SELECT invoice_total \nFROM invoices \nWHERE vendor_ id = 115 ) \nThe result of the subquery \ninvoice_total \n► \n6.00 \n6.00 \n25.67 \n6.00 \n-\nThe result set \n_ l vendor_name \n► \nFederal Express Corporation \nPacific BeD \nRoadway Pad<age System, Inc \nCompuserve \nI \nFederal Express Corporation \n(17 rows ) \nDescription \ninvolce_number \n963253251 \n11 l-92R-10096 \n25022117 \n21-4748363 \n+321-2596 \n1nvoice_total \n15.50 \n16.33 \n6.00 \n9.95 \n10.00 \n• \nYou can use the ANY keyword to test that a condition is true for one or more of the \nvalues returned by a subquery. \n• \nIf the subquery doesn't return any values, or if it only returns null values, a compar-\nison that uses the ANY keyword evaluates to false. \n• \nThe SOME keyword works the same as the ANY keyword. \nFigure 7-6 \nHow to use the ANY and SOME keywords\n\n212 \nSection 2 \nMore SQL skills cts you need them \nHow to code correlated subqueries \nSo far, all of the subqueries in this chapter have been uncorrelated subque-\nries. An uncorrelated subquery is executed only once for the entire query. \nHowever, you can also code a correlated subquery that's executed once for each \nrow that's processed by the main query. This type of query is similar to using a \nloop to do repetitive processing in a procedural programming language like PHP \nor Java. \nFigure 7-7 shows how correlated subqueries work. The example 1·etrieves \nrows from the Invoices table for those invoices that have an invoice total that's \ngreater than the average of all the invoices for the same vendor. To do that, the \nWHERE clause of the subquery refers to the vendor_id value of the main query. \nThat way, only the invoices for the current vendor are included in the average. \nEach time MySQL processes a row in the main query, it substitutes the \nvalue in the vendor_id column for the column reference in the subquery. Then, \nMySQL executes the subquery based on that value. For example, if the vendor_ \nid value is 95, MySQL executes this subquery: \nSELECT AVG (invoice_ total) \nFROM i nvoic e s \nWHERE vendor_ id = 95 \nAfter MySQL executes this subquery, it uses the returned value to detern1ine \nwhether to include the current invoice in the result set. For example, for vendor \n95, the subquery returns a value of 28.501667. Then, MySQL compares that \nvalue with the invoice total of the current invoice. If the invoice total is greater \nthan that value, MySQL includes the invoice in the result set. Otherwise, it \ndoesn't. MySQL repeats this process until it has processed each of the invoices \nin the Invoices table. \nIn this figure, the WHERE clause of the subquery qualifies the vendor_id \ncolumn from the main query with the alias that's assigned to the Invoices table \nin that query. This is necessary because this statement uses the same table in the \nsub and main queries. So, the use of a table alias avoids ambiguity. However, if a \nsubquery uses a different table than the main query, a table alias isn't necessary. \nSince correlated subqueri.es can be difficult to code, you may want to test \na subquery separately before using it within another SELECT statement. To \ndo that, however, you'll need to substitute a constant value for the variable that \nrefers to a column in the outer query. That's what we did to get the average \ninvoice total for vendor 95. Once you 're sure that the subquery works on its own, \nyou can replace the constant value with a reference to the outer query so you can \nuse it within a SELECT statement.\n\nGet each invoice amount that's higher \nthan the vendor's average invoice amount \nSELECT vendor_ id, invoice_ number, invoice_ total \nFROM invoices i \nWHERE invoice_ total > \n(SELECT AVG(invoice_total) \nFROM invoices \nWHERE vendor_ id = i.vendor_id) \nORDER BY vendor_ id, invoice_total \nChapter 7 \nHow to l·ode subqueries \n213 \nThe value returned by the subquery for vendor 95 \n28.501667 \nThe result set \n_j_ vendor jd \nlnvoice_number \ninvoice_ total \n83 \n31359783 \n1575.00 \n95 \n111-92R-10095 \n32.70 \n95 \nlll-92R-10093 \n39.77 \n95 \n111-92R-10092 \n~ .21 \nI 110 \nP-0259 \n26881.40 \n( 36 rows ) \nDescription \n• \nA correlated subquery is a subquery that is executed once for each row in the \nmain query. In contrast, an uncorrelated subquery is executed only once. All of the \nsubqueries in the previous figures are uncorrelated subqueries. \n• \nA correlated subquery refers to a value that's provided by a column in the main \nquery. For each different value that's returned by the main query for that column, \nthe su bquery returns a different result. \n• \nTo refer to a column in the main query, you can qualify the column with a table \nname or alias. If a correlated subquery uses the same table as the main query, you \ncan use table aliases to re1nove ambiguity. \nFigure 7-7 \nHow to code correlated subqueries\n\n214 \nSection 2 \nMore SQL skills cts you need them \nHow to use the EXISTS operator \nFigure 7-8 shows how to use the EXISTS operator with a subquery. This \noperator tests whether the subquery returns a result set. In other words, it tests \nwhether the result set exists. When you use this operator, the subquery doesn't \nactually return a result set to the outer query. Instead, it returns an indication of \nwhether any rows satisfy the search condition of the subquery. Because of that, \nqueries that use this operator execute quickly. \nYou typically use the EXISTS operator with a correlated subquery as shown \nin this figure. This query retrieves all the vendors in the Vendors table that don't \nhave invoices in the Invoices table. Although this query returns the same vendors \nas the queries shown in figure 7-3, it executes more quickly than either of those \n• \nquenes. \nIn this example, the correlated subquery selects all invoices that have the \nsame vendor_id value as the current vendor in the outer query. Because the \nsubquery doesn't actually return a result set, it doesn't matter what columns \nare included in the SELECT clause. As a result, it's customary to j11st code an \nasterisk. \nAfter the subquery is executed, the search condition in the WHERE clause \nof the main query uses the NOT EXISTS operator to test whether any invoices \nwere found for the current vendor. If not, the vendor row is included in the result \nset.\n\nChapter 7 \nHow to l·ode subqueries \n215 \nThe syntax of a subquery that uses the EXISTS operator \nWHERE [NOT] EXISTS (subquery) \nGet all vendors that don't have invoices \nSELECT vendor id, vendor_ name, vendor_state \nFROM vendors \nWHERE NOT EXISTS \n(SELECT* \nFROM invoices \nWHERE vendor_ id = vendors.vendor_ id) \nThe result set \nvendor jd \nvendor _name \n-33 \n35 \n36 \n38 \n39 I \n'10 \n(88 rows ) \nDescription \nNielson \nCal State Termite \nGrayfift \nVenture Communications Int'I \nCustom Printing Company \nNat Assoc of CoUege Stores \nvendor _state \nOH \nCA \nCA \nNY \nMO \nOH \n-\n• \nYou can use the EXISTS operator to test that one or more rows are returned by the \nsubquery. \n• \nYou can use the NOT EXISTS operator to test that no rows are returned by the \nsubquery. \n• \nWhen you use these operators with a subquery, it doesn't matter what columns you \nspecify in the SELECT clause. As a result, you typically just code an asterisk ( * ). \nFigure 7-8 \nHow to use the EXISTS operator \n-\n\n216 \nSection 2 \nMore SQL skills cts you need them \nHow to code subqueries \nin other clauses \nNow that you know how to code subqueries in the WHERE clause of a \nSELECT statement, you're ready to learn how to code them in the HAVING, \nFROM, and SELECT clauses. \nHow to code subqueries in the HAVING clause \nWhen you code a HA YING clause, you specify a search condition just as \nyou do when you code a WHERE clause. That includes search conditions that \ncontain subqueries. To learn how to code subqueries in a HAVING clause, then, \nyou can refer back to figures 7-3 through 7-8. \nHow to code subqueries in the SELECT clause \nFigure 7-9 shows how to use subqueries in the SELECT clause. To do \nthat, you code the subquery in place of a column specification. As a result, the \nsubquery must return a single value for that column. \nIn most cases, you code correlated subqueries in the SELECT clause. In this \nfigure, for example, the subquery calculates the maximum invoice date for each \nvendor in the Vendors table. To do that, the subquery refers to the vendor_id \ncolumn from the Vendors table in the main query. \nSubqueries coded in the SELECT clause are typically difficult to read. As \na result, you shouldn't use them if you can fmd another solution. In most cases, \nyou can replace the subquery with a join. In this figure, for example, the frrst \nquery can be restated as shown in the second query. This query joins the Vendors \nand Invoices tables, groups the rows by vendor_name, and uses the MAX \nfunction to calculate the maximum invoice date for each vendor. As a result, this \nquery is easier to read.\n\nChapter 7 \nHow to l·ode subqueries \n217 \nGet the most recent invoice date for each vendor \nSELECT vendor_name, \n(SELECT MAX(invoice_date) FROM invoices \nWHERE vendor_ id = vendors.vendor_ id) AS latest_inv \nFROM vendors \nORDER BY latest inv DESC \nThe result set \nvendor _name \nlatest_lllV \n► \nFederal Express Corporation \n2018-08-02 \nBlue Cross \n2018-08.Ql \nMaftoy Lithographing Inc \n2018-07-31 \nCardinal Business Media, Inc. \n2018-07-28 \nI \nZylka Design \n2018--07-25 \nFord Motor Credit Company \n2018-07-24 \n(122 rows) \nThe same query restated using a join \nSELECT vendor_name, MAX(invoice_date) AS latest_ inv \nFROM vendors v \nLEFT JOIN invoices i ON v.vendor_ id = i.vendor_ id \nGROUP BY vendor_name \nORDER BY latest_inv DESC \nDescription \n• \nWhen you code a subquery in the SELECT clause, the subquery must return a \nsingle value. \n• \nWhen you code a subquery in the SELECT clause, you typically use a correlated \nsubquery. \n• \nA query that includes a subquery in its SELECT clause can typically be restated \nusing a join instead of the subquery. Because a join is usually faster and easier to \nread, subqueries are seldom coded in the SELECT clause. \nFigure 7-9 \nHow to code subqueries in the SELECT clause \n. \nI\n\n218 \nSection 2 \nMore SQL skills cts you need them \nHow to code subqueries in the FROM clause \nFigure 7-10 shows how to code a subquery in the FROM clause. To do that, \nyou code a subquery in place of a table specification. When you code a subquery \nin the FROM clause, it can return a result set that contains any number of rows \nand columns. This result set is sometimes referred to as an inline view. \nSubqueries are typically used in the FROM clause to create inline views that \nprovide summarized data to another summary query. In this figure, for example, \nthe subquery returns a result set that contains the vendor state, the vendor name, \nand the sum of invoice totals for each vendor. To do that, it groups the vendors \nby state and name. Once the subquery returns this result set, the main query \ngroups the result set by vendor state and gets the largest sum of invoice totals for \neach state. This rettrrns the invoice total for the top vendor in each state. \nWhen you code a subquery in the FROM clause, you must assign a table \nalias to the subquery. This is required even if you don't use the table alias in the \nmain query. In this figure, for example, the query assigns a table alias oft (for \nte.mporary table) to the subquery. \nIn addition, you should assign a column alias to all calculated columns in \na subquery. In this figure, for example, the subquery assigns a column alias \nof sum_of_invoices to the result of the SUM function. That makes it easier to \nrefer to these columns from other clauses in the st1bquery if you need to do \nthat. It also makes it possible to refer to the column from the main query. In \nthis example, for instance, the sum_of_invoices column is referred to by tl1e \nSELECT clause.\n\nChapter 7 \nHow to l·ode subqueries \n219 \nGet the largest invoice total for the top vendor in each state \nSELECT vendor_ state, MAX(sum_of_ invoices) AS max_ sum_of_ invoices \nFROM \n( \nSELECT vendor_ state, vendor_name, \nSUM(invoice_total) AS sum_of_ invoices \nFROM vendors v JOIN invoices i \nON v.vendor_ id = i.vendor_ id \nGROUP BY vendor_state, vendor name \n) t \nGROUP BY vendor_state \nORDER BY vendor_state \nThe result of the subquery (an inline view) \nvendor state \nvendor _name \nsum_of jnvoices \n► \nNV \nUnited Parcel Servke \n23ln.96 \nTN \nFederal Express Corporation \n4373.02 \nCA \nEvans Executone Inc \n95.00 \nCA \nZylka Design \n6940.25 \nAZ \nWefts Fargo Bank \n662.00 \nCA \nPadflc Bell \n17L01 \nCA \nRoadway Padcage System, Inc \n43.67 \nCA \nFresno Co.unty Tax Collector \n856.92 \n(34 rows) \nThe result set \nvendor _state \nmax_sum_of _invoices \n-\n-\n► \nAZ \n662.00 \nCA \n7125.34 \nDC \n600.00 \n(10 rows ) \nDescription \n• \nA subquery that's coded in the FROM clause returns a result set that can be referred \nto as an inline view. \n• \nWhen you code a subquery in the FROM clause, you must assign an alias to it. \nThen, you can use that alias just as you would any other table name or alias. \n• \nWhen you code a subquery in the FROM clause, you should use an alias for any \ncolumns in the subquery that perform calculations. Then, the inline view can use \nthese aliases as the column names of the table, and the main query can refer to the \ncolumns by these names. \nFigure 7-10 \nHow to code subqueries in the FROM clause \nI\\ \\ \n-\nI \n•-\n-\n' \nV\n\n220 \nSection 2 \nMore SQL skills cts you need them \nHow to work with complex queries \nSo far, the examples you've seen of queries that use subqueries have been \nrelatively simple. However, these types of queries can get complicated in a hurry, \nparticularly if the subqueries are nested. Because of that, you'll want to be st1re \nthat you plan and test these queries carefully. In a moment, you'll learn how to \ndo that. But first, this chapter presents an example of a complex query. \nA complex query that uses subqueries \nFigure 7-11 presents a complex query that uses multiple subqueries. The first \nsubquery is used in the FROM clause of the outer query to create a result set that \ncontains the state, name, and total invoice amount for each vendor in the Vendors \ntable. This is the same subquery that was described in figure 7-10. As a result, \nyou should already understand how it works. \nThe seco11d subquery is also used in the FROM clause of the outer query to \ncreate a result set that's joined with the first result set. This result set contains \nthe state and total invoice amount for the vendor in each state that has the largest \ninvoice total. To create this result set, a third subquery is nested within the \nFROM clause of the subquery. This subquery is identical to the frrst subquery. \nAfter this statement creates the two result sets, it joins them based on the \ncolumns in each table that contain the state and the total invoice amount. The \nfinal result set includes the state, name, and total invoice amount for the vendor \nin each state with the largest invoice total. This result set is sorted by state. \nAt this point, you might be wondering if there is an easier solution to this \nproblem. For example, you might think that you could solve the problem by \njoining the Vendors and Invoices tables, grouping by vendor state, and calcu-\nlating the sum of invoices for each vendor. However, if you group by vendor \nstate, you can't include the name of the vendor in the result set. And if yo11 group \nby vendor state and vendor name, the result set includes all vendors, not just \nthe top vendor from each state. As a result, the query presented here is a fairly \nstraightforward way of solving the problem. \nWhen you code a complex subqt1ery, it's often helpful to include comments. \nYou can use comments to describe the different parts of the query without \nchanging how the query operates. To code a single-line comment, you start the \nline with two dashes ( - -) . \nIn this figure, the query includes three co1nments. The first cormnent identi-\nfies the first subquery, the second comment identifies the second subquery, and \nthe third comment identifies the third subquery. These comments make it easier \nto read the main query by making it easier to identify the three subqueries and \ndetermine what they do. For example, these comments clearly show that the \nsubqueries that have aliases of tl and t2 return the same result set.\n\nChapter 7 \nHow to l·ode subqueries \n221 \nA complex query that uses three subqueries \nSELECT tl.vendor_ state, vendor_name, tl.sum of invoices \nFROM \n( \n) tl \n-- invoice totals by vendor \nSELECT vendor_ state, vendor_name, \nSUM(invoice_total) AS sum_of_ invoices \nFROM vendors v JOIN invoices i \nON v.vendor_ id = i.vendor_ id \nGROUP BY vendor_ state, vendor_ name \nJOIN \n( \n-- top invoice totals by state \nSELECT vendor_ state, \nMAX(sum_of_ invoices) AS sum_of_ invoices \nFROM \n( \n) t2 \n-- invoice totals by vendor \nSELECT vendor_ state, vendor_name, \nSUM(invoice_total) AS sum_of_ invoices \nFROM vendors v JOIN invoices i \nON v.vendor id= i.vendor id \nGROUP BY vendor_ state, vendor_name \nGROUP BY vendor_state \n) t3 \nON tl.vendor_ state = t3.vendor_ state AND \ntl.sum of invoices= t3.sum of invoices \n-\n-\nORDER BY vendor_ state \nThe result set \nI vendor _state \n► \nAZ \nCA \nI~ \n(10 rows) \nDescription \nvendor _name \n\\ft/eDs Fargo Bank \nDigital Dreamworks \nReiter's Scientific &.Pro Books \nDean \\!'Jitter Reynolds \nsum_of _invoices \n662.00 \n7125.34 \n600.00 \n1367.50 \n• \nThis query retrieves the vendor from each state that has the largest invoice total. To \ndo that, it uses three subqueries. \n• \nThis query uses comments to clearly identify its three queries. \n• \nThe subqueries named tl and t2 return the same result set. This result set includes \nthe vendor state, name, and sum of invoices. \n• \nThe subquery named t3 returns a result set that includes the vendor state and the \nlargest sum of invoices for any vendor in that state. To do that, this subquery uses a \nnested subquery named t2. \n• \nThe subqueries named tl and t3 are joined on both the vendor_state and st1m_of_invoices \ncolumns. \nFigure 7-11 \nA complex query that uses subqueries\n\n222 \nSection 2 \nMore SQL skills cts you need them \nA procedure for building complex queries \nTo build a complex query like the one in the previous figure, you can use a \nprocedure like the one in figure 7-12. To sta1t, you should state the question in \nEnglish so you're clear about what you want the query to answer. In this case, \nthe question is, ''Which vendor in each state has the largest invoice total?'' \nOnce you're clear about the problem, you can outline the query using \npseudocode. Pseudocode is code that represents the intent of the query, but \ndoesn't necessarily use SQL code. The pseudocode shown in this figure, for \nexample, uses part SQL code and part English. This pseudocode identifies the \nthree columns returned by the main query, two subqueries, and even the join \ncondition for the two subqueries. \nThe next step in the procedure is to code and test the subqueries to be sure \nthey work the way you want them to. For example, this figure shows the code \nfor the frrst subquery along with its result set. This returns all of the data that \nyou want, but it also includes extra rows that you don't want. To remove the \nextra rows from the frrst query, you can code the second subquery shown in this \nfigure. This subquery uses the first subquery as a nested subquery. Although this \nremoves the extra rows, it also removes the vendor_name column. \nOnce you 're sure that both subqueries work the way you want them to, you \ncan use them in the main query. For example, the pseudocode in this figure \nshows that you should join the result sets returned by the subqueries on the \nvendor_state and sum_of_invoices columns. In addition, the code in the previous \nfigure shows how these two subq11eries are used in the main query. This allows \nyou to get all of the columns you want in the final result set without any of the \nextra rows that you don't want. \nWriting complex queries is difficult, but following a procedure like the one \nshown in this figure can make it a little easier. At first, you might not be able to \nuse pseudocode to identify subqueries. In that case, it's OK to skip ahead to step \n3 and begin experimenting with possible subqueries. This may give you some \nideas for how to solve the problem. Once you get these subqueries working \ncorrectly, you can begin coding a main query, and you can cut and paste the \nsubqueries into the main query.\n\nChapter 7 \nHow to l·ode subqueries \n223 \nA procedure for building complex queries \n1. State the problem to be solved by the query in English. \n2. Use pseudocode to outline the query. \n3. Code the subqueries and test them to be sure that they return the correct data. \n4. Code and test the final query. \nThe problem to be solved by the query in figure 7-11 \nWhich vendor in each state has the largest invoice total? \nPseudocode for the query \nSELECT vendor_state, vendor_name, sum_of_ invoices \nFROM {subquery returning vendor_ state, vendor_name, sum_of_ invoices) \nJOIN (subquery returning vendor_ state, largest_ sum_of_ invoices) \nON vendor_state AND swn_of_ invoices \nORDER BY vendor_state \nThe code for the first subquery \nSELECT vendor_state, vendor_name, SUM(invoice_total) AS swn_of_ invoices \nFROM vendors v JOIN invoices i \nON v.vendor_ id = i.vendor_id \nGROUP BY vendor_ state, vendor_name \nThe result set for the first subquery \nvendor _state \nvendor _name \nsum_of_invoices \n► \nNV \nUnited Parcel Service \n23177.96 \n1N \nFederal Express Corporation \n4378.02 \nCA \nEvans Exerutone Inc \n95.00 \n(34 rows) \nThe code for the second subquery \nSELECT vendor_ state, MAX(sum_of_ invoices) AS sum_of_ invoices \nFROM \n( \n) t \nSELECT vendor_state, vendor_name, \nSUM(invoice_total) AS sum_of_ invoices \nFROM vendors v JOIN invoices i \nON v.vendor_ id = i.vendor_ id \nGROUP BY vendor_ state, vendor name \nGROUP BY vendor state \nThe result set for the second subquery \nvendor _state \nsum_of _Invoices \n► \nNV \n23177.96 \n1N \n4378.02 \nCA \n7125.34 \n(10 rows) \nFigure 7-12 \nA procedure for building complex queries \n\" \nV \n\" \n,___ \nV\n\n224 \nSection 2 \nMore SQL skills cts you need them \nHow to work with \ncommon table expressions \nA common table expression ( CTE) is a new feature of MySQL 8.0 that \nallows you to code an expression that defines a named temporary result set. You \ncan use CTEs to simplify complex queries that use subque1ies. This can make \nyour code easier to read and maintain. In addition, you can use a CTE to loop \nthrough nested structures. \nHow to code a CTE \nFigure 7-13 shows how to use a CTE to simplify the complex query \npresented in figure 7-11. To start, the statement for the query begins with the \nWITH keyword to indicate that you are about to define a CTE. Then, it speci-\nfies summary as the name for the first result set, followed by the AS keyword, \nfollowed by a SELECT statement enclosed in parentheses that defines the 1·esult \nset. In this figure, for example, this statement returns the same result set as the \nsubqueries named tl and t2 that were presented in figure 7-11. \nAfter the frrst CTE is defmed, this example continues by defining a second \nCTE named top_in_state. To start, a comma is coded to separate the two CTEs. \nThen, this query specifies top_in_state as the name for the second result set, \nfollowed by the AS keyword, followed by a SELECT statement enclosed in \nparentheses that defines the result set. This SELECT statement refers to the \nsummary result set that was defined by the first CTE. When coding multiple \nCTEs like this, a CTE can refer to any CTEs in the same WITH clause that are \ncoded before it, but it can't refer to CTEs coded after it. As a result, this state-\nment wouldn't work if the two CTEs were coded in the reverse order. \nFinally, the SELECT statement that's coded immediately after the two CTEs \nuses both of these CTEs just as if they were tables. To do that, this SELECT \nstatement joins the two rest1lt sets, specifies the columns to retrieve, and speci-\nfies the sort order. To avoid ambiguous references, each column is qualified \nby the name for the CTE. If yot1 compare figure 7-13 with figure 7-11, I think \nyou' 11 agree that the code in figure 7-13 is easier to read. That's partly because \nthe 1·esult sets defmed by the subqueries aren't nested within the SELECT state-\nment. In addition, I think you'll agree that the code in figure 7-13 is easier to \nmaintain. That's because this query reduces code duplication by only coding the \nsummary subquery in one place, not in two places. \nWhen using the syntax shown here to define CTEs, you must supply distinct \nnames for all columns defined by the SELECT statement, including calculated \nvalues. That way, it's possible for other statements to refer to the columns in the \nresult set. Most of the time, that's all you need to know to be able to work with \nCTEs. For more information about working with CTEs, you can look up ''WITH \nSyntax (Common Table Expressions)'' in the documentation for MySQL.\n\nChapter 7 \nHow to l·ode subqueries \n225 \nThe syntax of a CTE \nWITH [RECURSIVE] cte_namel AS {subqueryl) \n[, cte_ name2 AS {subquery2)] \nC ••• l \nsql_statement \nTwo CTEs and a query that uses them \nWITH summary AS \n{ \nSELECT vendor_ state, vendor_ name, SUM{invoice total) AS sum_of_ invoices \nFROM vendors v JOIN invoices i \nON v.vendor_ id = i.vendor_ id \nGROUP BY vendor_state, vendor_name \n) , \ntop_ in_state AS \n( \nSELECT vendor_state, MAX(sum_of_invoices) AS sum_of_ invoices \nFROM summary \nGROUP BY vendor_state \n) \nSELECT summary.vendor_state, summary.vendor_ name, \ntop_ in_ state.sum_of_ invoices \nFROM summary JOIN top_ in_state \nON summary.vendor_state = top_ in_ state.vendor_state AND \nsummary.sum_of_ invoices = top_ in_ state.sum_of_ invoices \nORDER BY summary.vendor_state \nThe result set \nvendor _state \nvendor _name \nsum_ of _invoices \n► \nAZ \n\\A/ells Fargo Bank \n662.00 \nCA \nDigital Dreamworks \n7125.34 \nDC \nReiter's Scientific & Pro Books \n600.00 \nMA \nDean Witter Reynolds \n1367.50 \nMI \nMalloy Lithographing Inc \n119892.41 \nINV \nUnited Parcel Service \n231n.96 \nOH \nEdward Data Services \n207. 78 \nPA \ncardinal Business Media, Inc. \n265.36 \n(10 rows ) \nDescription \n• \nA common table expression (CTE) is a SELECT statement that creates one or \nmore named temporary result sets that can be used by the query that follows. \n• \nTo use a CTE, you code the WITH keyword followed by the definition of the \nCTE. Then, iminediately after the CTE, you code the statement that uses it. \nV \n• \nTo code multiple CTEs, separate them with commas. Then, each CTE can refer to \nitself and any previously defined CTEs in the same WITH clause. \n• \nTo code a recursive CTE, include the RECURSIVE keyword after the WITH \nkeyword. See figure 7-14 for more on recursive CTEs. \n• \nAlthough you can use CTEs with SELECT, INSERT, UPDATE, and DELETE \nstatements, you'r·e most likely to use them with SELECT statements. \nFigure 7-13 \nHow to code a CTE\n\n226 \nSection 2 \nMore SQL skills cts you need them \nHow to code a recursive CTE \nA recursive qLtery is a query that is able to loop through a result set and \nperform processing to return a final result set. Recursive queries are commonly \nused to return hierarchical data such as an organizational chart in which a parent \nelement may have one or more child elements, and each child element may have \none or more child elements. Prior to MySQL 8.0, a recursive query required \nusing inline views, cursors, and logic to control the flow of the rect1rsive steps. \nWith MySQL 8.0 and later, you can use a recursive CTE to code recursive \nqueries more easily. Figure 7-14 shows how. \nThe top of this figure shows an Employees table where the manager_id \ncolumn is used to identify the manager for each employee. Here, Cindy Smith is \nthe top level manager since she doesn't have a manager, Elmer Jones and Paulo \nLocario report to Cindy, and so on. \nThe recursive CTE shown in this figure returns each employee according \nto their level in the organization chart for the company. To do that, this state-\nment begins by defining a CTE named employees_cte. Note here that the \nWITH clause includes the RECURSIVE keyword. This is required for recursive \ncommon table expressions. If you forget this keyword, you'll get error code \n1146: ''Table 'table name' doesn't exist''. \nWithin the CTE, two SELECT statements are joined by the UNION ALL \noperator. Here, the frrst SELECT statement uses the IS NULL operator to return \nthe frrst row of the result set. Because this statement doesn't refer to the name of \nthe CTE, it is non-recursive. \nThe second SELECT statement creates a loop by referring to the name of the \nCTE. Specifically, this state1nent joins the Employees table to the employees_cte \nresult set that's defined by the CTE. Because of that, it is a recursive SELECT \nstatement that loops through eacl1 row in the Employees table. With each loop, it \nadds 1 to the ranking column and appends the current result set to the fmal result \nset. For example, on the first loop, it appends Elmer Jones and Paulo Locario \nto the final result set. On the second loop, it appends Ralph Simonian, Thomas \nHardy, Olivia Hernandez, and Rhea O'Leary to the final result set. And so on. \nWl1en coding a recursive CTE, you must follow some rules. FiI·st, you must \nsupply a name for each column defmed by the CTE. To do that, you just need to \nmake sure to specify a name for each column in the non-recursive query. Second, \nthe rules for coding a union that you learned in chapter 4 still apply. In particular, \nthe two SELECT statements must have the same number of columns and the \ncolumns must have compatible data types. \nMost of the time, that's all you need to know to be able to work with recur-\nsive CTEs. However, the goal of this topic is to show a simple recursive CTE to \ngive you a general idea of how they work. For more inf or1nation about working \nwith recursive CTEs, you can start by looking up ''WITH Syntax (Common \nTable Expressions)'' in the documentation for MySQL and then clicking on the \n''Recursive Common Table Expressions'' link.\n\nChapter 7 \nHow to l·ode subqueries \n227 \nThe Employees table \nemployee_id \nlast_name \nfirst_name \ndepartment_number \nmanagerj d \n► \n1 \nSmith \nCindy \n2 \njl(IJ!I \n2 \nJones \nElmer \n4 \n1 \n3 \nSimonian \nRalph \n2 \n2 \n4 \nHernandez \nOlivia \n1 \n9 \n5 \nAaronsen \nRobert \n2 \n4 \n6 \nWatson \nDenise \n6 \n8 \n7 \nHardy \nThomas \n5 \n2 \n8 \nO'Leary \nRhea \n4 \n9 \n9 \nLocario \nPaulo \n6 \n1 \nA recursive CTE that returns hierarchical data \nWITH U CURSIVE employees_cte AS \n( \n-- Nonrecursive query \nSELECT employee_ id, \nCONCAT(first_pam~, ' ', last_ name) AS employee_name, \n1 AS ranking \nFROM employees \nWHERE manager_id IS NULL \nUNION ALL \n-- Recursive query \nSELECT employees.employee_id, \nCONCAT(first_ name, ' ', last_name), \nranking+ 1 \nFROM employees \nJOIN employees_cte \nON employees.manager_ id = employees_cte.employee_ id \n) \nSELECT* \nFROM employees_cte \nORDER BY ranking, employee_id \nThe final result set \nemployee_id \nemployee_name \nranking \n► \n1 \nCindy Smith \n1 \n2 \nBmer Jones \n2 \n9 \nPaulo Locario \n2 \n3 \nRalph Simonian \n3 \n4 \nOlivia Hernandez \n3 \n7 \nThomas Hardy \n3 \n8 \nRhea O'Leary \n3 \n5 \nRobert Aaronsen \n4 \n6 \nDenise Watson \n4 \nDescription \n• \nA recursive query is a query that can loop through a result set and perform processing \nto return a final result set. A recursive CTE can be used to create a recursive query. \n• \nA recursive CTE contains a non-recursive SELECT statement followed by a \nrecursive SELECT statement, and these two statements must be connected by the \nUNION or UNION ALL operator. \nFigure 7-14 \nHow to code a recursive CTE\n\n228 \nSection 2 \nMore SQL skills cts you need them \nPerspective \nSubqueries are a powerful tool that you can use to solve difficult problems. \nBefore you use a subquery, however, remember that a subqt1ery can often be \nrestated more clearly by using a join. If so, you '11 typically want to use a join \ninstead of a subquery. \nIf you find yourself coding the same subqueries in multiple places, you \nshould consider cr·eating a view for that subquery as desc1ibed in chapter 12. \nThis will help you develop queries more quickly since you can use the view \ninstead of coding the subquery again. In addition, since views typically execute \nmore quickly than subqueries, this may improve the performance of your \n• \nquenes. \nTerms \nsubquery \nintroduce a subquery \nnested subquery \ncorrelated subquery \nuncOI*related subquery \ninline view \nExercises \ncomment \npseudocode \ncommon table expression (CTE) \n• \nrecursive query \nrecursive CTE \n1. \nWrite a SELECT statement that returns the same result set as this SELECT \nstatement, but don't use a join. Instead, use a subquery in a WHERE clause \nthat uses the IN keyword. \nSELECT DISTINCT vendor name \nFROM vendors JOIN invoices \nON vendors.vendor id= invoices.vendor id \nORDER BY vendor_name \n2. \nWrite a SELECT statement that answers this question: Which invoices have \na payment total that's greater than the average payment total for all invoices \nwith a payment total greater tl1an O? \nReturn the invoice number and invoice total colu1nns for each invoice. This \n-\n-\nshould return 20 rows. \nSort the results by the invoice_total column in descending order. \n3. \nWrite a SELECT statement that returns two columns from the \nGeneral_Ledger_Accounts table: account_number and account_description. \nReturn one row for each account number that has never been assigned to any \nline item in the Invoice_Line_Items table. To do that, use a subquery intro-\nduced with the NOT EXISTS operator. This should return 54 rows. \nSort the results by the account_number column.\n\nChapter 7 \nHow to l·ode subqueries \n229 \n4. \nWrite a SELECT statement that returns four columns: vendor_name, invoice_id, \ninvoice_sequence, and line_item_amount. \nReturn a row for each line item of each invoice that has more than one line \nitem in the Invoice_Line_Items table. Hint: Use a s·ubquery that tests for \ninvoice_sequence > 1. This should return 6 rows. \nSort the results by the vendor_name, invoice_id, and invoice_sequence \ncolumns. \n5. \nWrite a SELECT statement that returns two columns: vendor id and the \nlargest unpaid invoice for each vendor. To do this, you can group the result set \nby the vendor_id column. This should return 7 rows. \nWrite a second SELECT statement that uses the first SELECT statement in its \nFROM clause. The main query should return a single value that represents the \nsum of the largest unpaid invoices for each vendor. \n6. \nWrite a SELECT statement that returns the name, city, and state of each \nvendor that's located in a unique city and state. In other words, don't include \nve.ndors that have a city and state in common with another vendor. This \nshould return 38 rows. \nSort the results by the vendor_state and vendor_city columns. \n7. \nUse a correlated subquery to return one row per vendor, representing the \nvendor's oldest invoice (the one with the earliest date). Each row should \ninclude these four columns: vendor_name, invoice_number, invoice_date, and \ninvoice total. This should return 34 rows. \n-\nSort the results by the vendor_name column. \n8. \nRewrite exercise 7 so it gets the same result but uses an inline view instead of \na correlated subquery. \n9. \nRewrite exercise 5 so it uses a common table expression (CTE) instead of an \ninline view.\n\nHow to work \nwith data types \nSo far, you have been using SQL statements to work with the three most \ncommon types of data: strings, numbers, and dates. Now, this chapter takes a \nmore in-depth look at the data types that are available with MySQL and shows \nsome basic skills for working with them. When you complete this chapter, \nyou'll have a thorough understanding of the data types, and you'll know how to \nuse some functions to convert one data type to another. \nThe data types .................................................................... 232 \nOve1·view ...................................................................................................... 232 \nThe character types ...................................................................................... 234 \nThe integer types ......................................................................................... 236 \nThe fixed-point and floating-point types ..................................................... 238 \nThe d.ate and time types .............................................................................. 240 \nThe ENUM and SET types ........................................................................ 244 \nThe large object types ................................................................................. 246 \nHow to convert data ........................................................... 248 \nHow implicit data conversion works .......................................................... 248 \nHow to convert data using the CAST and CONVERT functions ............... 250 \nHow to convert data using the FORMAT and CHAR functions ................ 252 \nPerspective ......................................................................... 254\n\n232 \nSection 2 \nMore SQL skills cts you need them \nThe data types \nA column's data type specifies the kind of information the column is \nintended to store. In addition, a column's data type determines the operations \nthat can be performed on the column. \nOverview \nThe MySQL data types can be divided into the five categories shown in \nfigure 8-1. To start, the character data types are intended for storing a string of \none or more characters, which can include letters, numbers, sy1nbols, or special \ncharacters. The terms character, string, and text are used interchangeably to \ndescribe this type of data. \nThe numeric data types are intended for storing numbers that can be used \nfor mathematical calculations. As you'll see in this chapter, MySQL can store \nnumbers in a variety of formats. At a basic level, you can divide numbers into \ntwo categories: integers and real numbers. Integers are numbers that don't have a \ndecimal point, and real numbers are numbers that have a decimal point. \nThe date and time data types are intended for storing dates, times, or \nboth dates and times. These data types are typically referred to as date/time or \ntemporal data types. \nSince the first three categories are the most widely used, this book focuses \non these data types. However, MySQL also provides large object (LOB) data \ntypes that are useful for storing images, sound, video, and large amounts of \ncharacter data. In addition, MySQL provides spatial data types that are useful \nfor storing geographical values such as global positioning system (GPS) data. \nThese data types are referred to as geometry types because they define a point or \ngroup of points that represent any location or area in the world. \nFinally, MySQL provides the ISON data type, which is used to store \nJavaScript Object Notation (ISON) documents. Although you can store JSON \ndocuments in a character column, the JSON data type provides two advantages. \nFirst, when you store a JSON document in a JSON column, the document is \nautomatically validated. Then, if it's invalid, an error occurs. Second, the internal \nstorage format provides for quick access to the document.\n\nClzapter 8 \nHow to work with data types \n233 \nData types \nCategory \nDescription \nCharacter \nNumeric \nDate and time \nLarge Object (LOB) \nSpatial \nJSON \nDescription \nStrings of character data \nNumbers that don't include a decimal point (integers) and \nnumbers that include a decimal point (real numbers) \nDates, times, or both \nLarge strings of character or binary data \nGeographical values \nJSON documents \n• \nMySQL provides data types for storing many types of data. \n• \nNumbers that don't include a decimal point are known as integers. \n• \nNumbers that include a decimal point are known as real numbers. \n• \nThe date and time data. types are often referred to as the date/time or temporal data \ntype.';. \n• \nThe large object (LOB) data types are ·useful for storing images, sound, video, and \nlarge amounts of text. \n• \nThe spatial data types are useful for storing geometric or geographical values \nsuch as global positioning system (GPS) data. These data types are referred to as \ngeometry types. \n• \nThe ISON data type is used for storing JavaScript Object Notation (ISON) \ndocuments. \nFigure 8-1 \nData type overview\n\n234 \nSection 2 \nMore SQL skills cts you need them \nThe character types \nFigure 8-2 presents the two most common character data types supported by \nMySQL: CHAR and VARCHAR. These data types store strings of characters. \nYou use the CHAR type to store fixed-length st1·ings. Data stored using this \ndata type always occupies the same number of bytes regardless of the actual \nle·ngth of the string. This data type is typically used to define columns that have \na fixed number of characters. For example, the vendor_state column in the \nVendors table is defined as CHAR(2) because it always contai11s two characters. \nHowever, if two chru·acters are stored in a CHAR(lO) column, MySQL appends \neight spaces to the string so it contains 10 char·acters. \nYou use the VARCHAR data type to store variable-length strings. Data \nstored using this data type occupies only the number of bytes needed to store \nthe string plus an extra byte to store the length of the string. This data type \nis typically used to define colt1mns whose lengths vary from one row to the \nnext. For example, the vendor_name column in the Vendors table is defined as \nVARCHAR(50) because the length of each vendor's name varies. \nWith MySQL 8.0 and later, the CHAR and VARCHAR types use the \nuif81nb4 character set by default. This character set uses up to four bytes to \nstore each character. As a 1·esult, it's referred to as a multiple-byte c·haracter set. \nThis allows the utf8mb4 character set to support the characters specified by the \nUnicode standard, which includes most characters from most of the world's \nlanguages. To do that, this character set uses 1 byte for characters that are used \nin English and by most western European languages. It uses 2 bytes for most \nEuropean and Middle Eastern script letters. And it uses 3 bytes for Korean, \nChinese, and Japanese ideographs. To store emojis and other icons, it uses 4 \nbytes. \nWhen you use the utf8mb4 character set with a CHAR type, MySQL must \nreserve four bytes for each character. As a result, MySQL must t1se 8 bytes for \nthe CHAR(2) type, and it must use 40 bytes for the CHAR(l 0) type. \nHowever, when you use the VARCHAR type, MySQL doesn't need to \nreserve space for each character. As a result, if you are using English letters and \nsymbols, MySQL only uses one byte per character, plus one byte to store the \nlength of the string. For example, when you store a string of 'CA', MySQL only \nuses 3 bytes. This shows that you can typically save storage space by using the \nVARCHAR type. \nWith MySQL 5.6 and 5.7, the CHAR and VARCHAR types used the \nuif8,nb3 character set. This character set is similar to the utf8mb4 character set, \nbut it can only use up to 3 bytes to store each chru·acter. Because of that, it's not \nable to store the emojis that are becoming so prevalent. Note that this character \nset is deprecated in MySQL 8.0 and will be removed in a future release. \nWith MySQL 5.5 and earlier, the CHAR and VARCHAR types used \nthe latinl character set by default. This character set uses one byte to store \neach character. As a result, it's referred to as a single-byte character set. This \ncharacter set supports all of the characters that are used in English and by most \nwestern European languages. However, it doesn't support other characters such \nas Middle Eastern script letters and Korean, Chinese, and Japanese ideographs.\n\nClzapter 8 \nHow to work with data types \n235 \nThe character types \nType \nBytes \nDescription \nCHAR(M) \nMx4 \nFixed-length strings of character data where M is the number of \ncharacters, between O and 255. With the utf8mb4 character set, \nMySQL must reserve four bytes for each character in a CHAR \ncolumn because that's the maximum possible length. \nVARCHAR (M) \nL+l \nVariable-lengtl1 strings of character data where M is the 1naxi-\nmum number of characters, between O and 255. For English and \nLatin characters, the number of bytes used to store the string is \nequaJ to length of the string (L) plus 1 byte to record its length. \nHow the character types work with utf8mb4 \nData type \nOriginal value \nValue stored \nBytes used \nCHAR (2) \n'CA' \n'CA ' \n8 \nCHAR ( lO ) \n'CA' \n'CA \nI \n4 0 \nVAR CHAR ( 1 0 ) \n'CA ' \n' CA ' \n3 \nVARCHAR ( 2 0) \n' California' \n'Californi a' \n11 \nVARCHAR ( 2 0 ) \n'New Yor k' \n'New York' \n9 \nVARCHAR ( 2 0 ) \n\"Murach's MySQL\" \n\"Murach's MySQL\" \n15 \nHow the utf8mb4 character set works \n• \nBasic Latin letters, digits, and punctuation signs use one byte. \n• \nMost European and Middle East script letters use 2 bytes. \n• \nKorean, Chinese, and Japanese ideographs use 3 bytes. \n• \nE1nojis and other icons use 4 bytes. \nDescription \n• \nThe CHAR type js t1sed for fixed-length strings. A column with trus type t1ses the \nsame amount of storage for each value regardless of the actual length of the st1ing. \n• \nThe VARCHAR type is used for variable-length strings. A column with this type uses \na varying amount of storage for each value depending on the length of the string. \n• \nBy default, MySQL 8.0 and later use the utj8mb4 character set for the CHAR and \nVAR CHAR types. This character set is a multiple-byte character set. It typically \nuses 1 byte per character, but can use up to 4 bytes per character. However, the \nutf8mb4 format provides for all characters in most languages by providing support \nfor all of the characters in the Unicode stan.dard. \n• \nBy default, MySQL 5.6 and 5.7 use the utj8mb3 character set for the CHAR and \nVAR CHAR types, which can use up to 3 bytes per character. \n• \nBy default, MySQL 5.5 and earlier use the latinl character set for the CHAR and \nVARCHAR types. This character set is a single-byte character set that supports all \nof the characters that are used in English and by most western European languages. \n• \nTo learn how to change the character set, please see chapter 11. \nFigure 8-2 \nThe character types\n\n236 \nSection 2 \nMore SQL skills cts you need them \nIn most cases, it makes sense to use the utf8mb4 character set. That way, \nyour database supports most characters in most languages as well as emojis. \nHoweve1·, if you want to use the CHAR type and you only need to support \nEnglish and western European languages, you may want to use the latinl \ncharacter set to keep storage requirements to a minimum. In chapter 11, you'll \nlearn how to change the character set for a database. \nAlthough you typically store numeric values using numeric types, the \ncharacter types may be a better choice for some numeric values. For example, \nyou typically store zip codes, telephone numbers, and social security numbers \nin character columns even if they contain only numbers. That's because their \nvalues aren't used in numeric operations. In addition, if you store these numbers \nin numeric colun111s, MySQL may strip leading zeros in some situations, which \nisn't what you want. \nIn figure 8-2, the first five examples use single quotes to specify a string \nliteral. However, the sixth example t1ses double quotes to specify a string literal. \nThis allows the string literal to include a single quote, and it shows that you \ncan use single or double quotes for string literals. Although it's common to use \nsingle quotes, double quotes are useful if you need to include a single quote in \nthe string. \nThe integer types \nFigure 8-3 shows the integer types, which are numbers that don't include a \ndecim.al point. The integer data types differ in the amount of storage they use and \nthe range of values they can store. Since the INT type can store a wide range of \nnumbers and only requires 4 bytes of storage, it's the most commonly used of \nthe integer types. \nBy default, the integer types can store positive and negative numbers. \nHowever, you can include the UNSIGNED attrib·ute for an integer type to \nprevent negative values from being stored in the column. In that case, the range \nof acceptable positive values for the column is doubled. \nIf the ZEROFILL attribute for the integer is set, the UNSIGNED attribute is \nautomatically set, and the integer is displayed with zeros padded from the left, \nup to the maximt1m display size. For the INT type, for instance, the maximum \ndisplay size is 10 digits. If the default display size is too wide, you can specify a \nsmaller display size by coding it in parentheses after the data type. In this figure, \nfor instance, the last example specifies a display size of 4 digits. This only \naffects how MySQL displays the value, not how it stores the value. \nThe INTEGER type is a synonym for the INT type. As a result, you can use \nthese types interchangeably. However, it's a common programming practice to \nuse INT as an abbreviation for INTEGER. \nThe BOOL and BOOLEAN types are synonyms for TINYINT(l). When you \nwork with these types, you can use a value of O to store false values and a value \nof 1 to store true values. To make that more intuitive, you can use the FALSE \nkeyword, which is an alias for 0, and the TRUE keyword, which is an alias for 1.\n\nClzapter 8 \nHow to work with data types \n237 \nThe integer types \nType \nBytes \nValue ranges \nBIGINT \n8 \n4 \n3 \nSigned: -9,223,372,036,854,775,808 to 9,223,372,036,854,775,807 \nUnsigned: 0 to L8,446,744,073,709,551,615 \nINT \nSigned: -2,147,483,648 to 2,147,483,647 \nUnsigned: 0 to 4,294,967,295 \nMEDIUMINT \nSigned: -8,388,608 5to 8,388,607 \nUnsigned: 0 and 16,777,215 \nSMALLINT \n2 \nSigned: -32,768 and 32,767 \nUnsigned: 0 and 65,535 \nTINYINT \nl \nSigned: -128 and 127 \nUnsigned: 0 and 255 \nHow the UNSIGNED and ZEROFILL attributes work \nData type \nOriginal value \nValue stored \nValue displayed \nINT \nINT \nINT UNSIGNED \nINT UNSIGNED \nINT ZEROFILL \nINT(4) ZEROFILL \nDescription \n99 \n-99 \n99 \n-99 \n99 \n99 \n99 \n-99 \n99 \nNone \n99 \n99 \n99 \n-99 \n99 \nNone \n0000000099 \n0099 \n• \nThe integer types store numbers without any digits to the right of the decimal point. \n• If the UNSIGNED attribute for the integer is set, it changes the range of acceptable \nvalues. If you try to store a negative integer in a column with the UNSIGNED attri-\nbute, an error occurs. \n• If the ZEROFILL attribute for the integer is set, MySQL displays the integer with \nzeros padded from the left, up to the maximum display size. \n• If the ZEROFILL attribute is set, MySQL automatically sets the UNSIGNED \nattribute. \n• \nTo specify a display size, you can code it in _parentheses after the data type. This \nonly affects how MySQL displays the value, not how it stores the value. \n• \nThe INTEGER type is a synonym for the INT type. \n• \nThe BOOL and BOOLEAN types are synonyms for TINYINT(l). You can use \nthese types to store TRUE and FALSE values, where 1 represents a true value and 0 \nrepresents a false value. \nFigure 8-3 \nThe integer types\n\n238 \nSection 2 \nMore SQL skills cts you need them \nThe fixed-point and floating-point types \nFigure 8-4 presents the data types for storing real numbers, which are \nnumbers that have digits to the right of the decimal point. To start, you can use \nthe DECIMAL type to store.fixed-point numbers, which are numbers that have a \nfixed number of digits to the right of the decimal point. \nThe number of digits a value has to the tight of the decimal point is called \nits scale, and the total number of digits is called its precision. You can customize \nthe precision and scale of the DECIMAL type so they're right for the data to be \nstored. For instance, if you need to store monetary values, it's common to use \ntwo digits to the right of the decimal place as shown in the first three examples. \nWhen you use the DECIMAL type, MySQL uses a varying number of bytes \nto store the value. In general, it packs 9 digits into 4 bytes. However, it stores \nthe digits to the left and right of the decimal point separately, and it can use \nfewer than 4 bytes if there are fewer than 9 digits. As a result, DECIMAL(9, \n2) requires 5 bytes, while DECIMAL(18, 9) requires 8 bytes. For more details \nabout how this works, you can check the MySQL Reference Manual. \nIn contrast to the DECIMAL type, the DOUBLE and FLOAT types store \nfloating-point numbers. These data types provide for very large and very small \nnumbers, but with a limited number of significant digits. The FLOAT type can \nbe used to store a single-precision number, which provides for numbers with up \nto 7 significant digits. And the DOUBLE type can be used to store a \ndouble-precision number, which provides for numbers with up to 15 significant \ndigits. \nTo express the value of a floating-point number, you can use scientific \n,iotation. To use this notation, you type the letter E followed by a power of 10. \nFor instance, 3.65E+9 is equal to 3.65 x 109, or 3,650,000,000. Conversely, \n3.65E-9 is equal to 3.65 x 10·9, or 0.00000000365. If you have a mathematical \nbackground, of course, you 're already familiar with this notation. \nBecause the precision of the integer types and the DECIMAL type is exact, \nthese data types are considered exact numeric types. In contrast, the DOUBLE \nand FLOAT types are considered approximate numeric types because they may \nnot represent a value exactly. That can happen, for example, when a number \nis rounded to the appropriate number of significant digits. In this figure, for \ninstance, the last example shows that the FLOAT type rounds the original value \nand only stores 7 significant digits. For business applications, you typically \nuse the exact numeric types, as there's seldom the need to work with the very \nlarge and very small numbers that the floating-point data types are designed \nfor. However, for scientific applications, you n1ay sometimes 11eed to use the \nDOUBLE and FLOAT types. \nThe DECIMAL, DOUBLE, and FLOAT types have numerous synonyms. \nSometimes these synonyms are helpful because they make it easier to work with \ndata from other databases. However, when working with a MySQL database, \nmost programmers use the DECIMAL, DOUBLE, and FLOAT types. \nWhen you work with real numbers, you can use the UNSIGNED and \nZEROFILL attributes. These attributes work similarly to the way they do with \ninteger types.\n\nClzapter 8 \nHow to work with data types \n239 \nThe fixed-point type \nType \nBytes \nDescription \nDECIMAL(M, D) \nVary \nFixed-precision numbers where M specifies the maximum number \nof total digits (the precision) and D specifies the nu1nber of digits \nto the rigbl of the decimal (the scale). M can range from l to 65. D \ncan range from Oto 30 but can't be larger than M. The default is 0. \nThe floating-point types \nType \nBytes \nDescription \nDOUBLE \nFLOAT \n8 \n4 \nDouble-precisio11 floating-point numbers from - l.7976xl0308 to l .7976xl03°8. \nSingle-precision floating-point numbers from -3.4028xl038 to 3.4028xl038. \nHow the fixed-point ( exact) and floating-point (approximate) types work \nData type \nOriginal value \nValue stored \nBytes used \nDECIMAL(9,2 ) \n1.2 \n1 . 20 \n5 \nDECIMAL(9,2) \n1234567.89 \n1234567.89 \n5 \nDECIMAL(9,2) \n-1234567.89 \n-1234567.89 \ns \nDECIMAL(18,9) \n1234567.89 \n1234567.890000000 \n8 \nDOUBLE \n1234567.89 \n1234567 . 89 \n8 \nFLOAT \n1234567.89 \n1234570 \n4 \nDescription \n• \nReal numbers can include digits to the right of the decimal point. The precision of \na real n11mber indicates the total number of digits that can be stored, and the scale \nindicates the number of digits that can be stored to the right of the decimal point. \n• \nThe DECIMAL type is considered an exact numeric type because its precision is \nexact. \n• \nThe DOUBLE and FLOAT types store floating-point numbers, which have a \nlimited number of significant digits. These data types are considered approximate \nnumeric data types because they may not represent a val11e exactly. \n• If the UNSIGNED attribute for a real number is set, it prevents storing negative \nvalues in the column but does not affect the range of acceptable values. \n• If the ZEROFILL attribute for a real number is set, the number is displayed with \nzeros padded from the left, and the UNSIGNED attribute is automatically set. \n• \nThe DEC, NUMERIC, and FIXED types are synonyms for the DECIMAL type. \n• \nThe REAL and DOUBLE PRECISION types are synonyms for the DOUBLE type. \nFigure 8-4 \nThe fixed-point and floating-point types\n\n240 \nSection 2 \nMore SQL skills cts you need them \nThe date and time types \nPart 1 of figure 8-5 presents the five date and time types supported by \nMySQL. You can use the DATE type to store a date without a time. You can \nuse the TIME type to store a time without a date. And you can use either the \nDATETIME or TIMESTAMP types to store both a date and a time. \nYou typically use the TIMESTAMP type to keep track of when a row was \ninserted or last updated. For example, you might use this type to keep track \nof the entries on a blog. MySQL makes that easy by automatically setting the \nTIMESTAMP column to the current date and time whenever a row is inserted or \nupdated. If that's not what you want, you can use the DATETIME type instead. \nThe problem with the TIMESTAMP type is that it can only store dates up \nto the year 2038. This is known as the yea,-2038 problem, the Y2K38 probleni, \nand the Unix Millennium bug. As a result, if you want your database to be able \nto store dates that go beyond 2038, you should use the DATETIME type instead \nof the TIMESTAMP type. Otherwise, you can use the TIMESTAMP type since \nit only reqtrires 4 bytes to store a TIMESTAMP value, compared to 8 bytes for a \nDATETIME value. \nIf you need to store a year without any other temporal data, you can use the \nYEAR type. With MySQL 5.7.5 and later, the YEAR type stores 4-digit years \nfrom 1901 to 2155. Entries with one and two digits are still acceptable, though, \nand are converted to 4-digit years as indicated in this figure. Note that, by \ndefault, a numeric literal of O or 00 is converted to 0000. To store the value 2000 \nin a YEAR column, you must code it as a string. \nPrior to MySQL 5.7.5, the YEAR column could also store a 2-digit year. \nTo define a column like this, you coded the YEAR(2) type. Then, 2-digit entries \nwere stored as entered and 1-digit entries were converted to two digits.\n\nClzapter 8 \nHow to work with data types \n241 \nThe date and time types \nType \nBytes \nDescription \nDATE \nTIME \nDATETIME \nTI MESTAMP \nYEAR[ ( 4 )] \nDescription \n3 \n3 \n8 \n4 \n1 \nDates from January 1, 1000 through December 31, 9999. The \ndefault format for display and e.ntry is \"yyyy-m1n-dd\". \nTimes in the range -838:59:59 through 838:59:59. The default \nformat for display and entry is \"hh:1nm:ss\". \nCombination date and time from midnight January l , 1970 to \nDecember 31, 9999. The default format for display and entry \nis \"yyyy-mm-dd hh:mm:ss\". \nCombination date and time from midnight January 1, 1970 to \nthe year 2037. The default format is \"yyyy-mm-dd hh:mm:ss\". \nYears in 4-digit format. Allowable values are from 1901 to \n2155. \n• \nA column of TIMESTAMP type is auton1atically updated to the current date and \ntime when a row is inserted or updated. If a table bas multiple TIMESTAMP \ncolumns, only the first one is updated automatically. \n• \nThe TIMESTAMP type can only store dates up to the year 2038. This is known \nas the year 2038 problem, the Y2K38 problem, and the Unix Millenn.ium bug. To \nfix this problem, use the DATETIME type instead of the TIMESTAMP type and \nupdate the value manually as needed. \n• \nMySQL 5.7 .5 and later support only 4-digit years, which can be defmed as YEAR \nand YEAR( 4). I-digit and 2-digit years can still be entered but are converted to \n4-digit years. Values from Oto 69 are converted to 2000 to 2069, and values from \n70 to 99 are converted to 1970 to 1999. \n• \nFor a value of O or 00 to be stored as 2000 in a YEAR column, you 1nust enter it as \na string. Otherwise, it's stored as 0000. \nFigure 8-5 \nThe date and time types (part 1 of 2)\n\n242 \nSection 2 \nMore SQL skills cts you need them \nWhen you work with the date and time types, you need to know how to code \ndate and time literals. Part 2 of figure 8-5 shows how to do that. The default date \nfo1mat for MySQL is ''yyyy-mm-dd'', which is why we've used this forn1at in \nmost of the examples in this book. By default, MySQL doesn't support other \ncommon date formats such as ''m.m/dd/yy''. If you attempt to use an unsupported \nformat, MySQL returns an error. \nYou also need to be aware of the two-digit year cutoff that's defined on your \nsystem. When you code a two-digit year, the two-digit year cutoff determines \nbow MySQL interprets the year. By default, MySQL interprets the years 00 \nthrough 69 as 2000 through 2069, and it interprets the years 70 through 99 as \n1970 through 1999. Usually, that's what you want. However, the two-digit year \ncutoff can be modified if necessary. In general, it's considered a good coding \npractice to use four-digit years. That way, you can be sure that MySQL is \ninterpreting the year correctly. \nMySQL interprets any punctuation character in a literal as a delimiter \nbetween date parts or time parts. If you don't use any delimiters, you can code \nthe value as a numeric literal. In that case, you don't need to use single quotes. \nWhen storing a date in a DATE column, the values are loosely checked for \nvalid data. For instance, months must be in the range 0-12 and days must be \nin the range 0-31. For illegal dates, such as February 31, MySQL returns an \nerror. However, MySQL allows you to store unconventional date values, such as \n''2018-12-00'', which represents a month and year without a specific day. \nThe default time format for MySQL is ''hh:mm:ss'', using a 24-hour clock. \nMany of the same rules for coding date literals also apply to time literals. For \ninstance, you can use any punctuation character as a delimiter. Similarly, for \nvalid values, you can omit the delimiters. In that case, you can use a numeric \nliteral (no quotes) instead of a string literal (quotes). Finally, MySQL checks \ntimes for validity. For illegal times, such as ''19:61:11'', MySQL returns an error. \nThe default date/time format for MySQL is a combination of the date and \ntime formats. Most of the rules for coding date/time literals ru·e a combination \nof the rules for coding date and time literals. In addition, if you don't specify \na time when storing a TIMESTAMP or DATETIME value, the tim.e defaults to \n00:00:00, which is midnight.\n\nClzapter 8 \nHow to work with data types \n243 \nHow MySQL interprets literal date/time values \nLiteral value \nValue stored in DATE column \n'2018-08-15' \n2018-08-15 \n'2018-8-15' \n2018-08-15 \n'18-8-15' \n2018-08-15 \n'20180815' \n2018-08-15 \n20180815 \n2018-08-15 \n'2018 . 08.15' \n2018-08-15 \n'18/8/15' \n2018-08-15 \n1 8/15/18 1 \nNone \n'2018-02-31' \nNone \nLiteral value \nValue stored in TIME column \n'7:32' \n'19:32:11' \n'193211' \n193211 \n1 19:61:11 1 \n07:32:00 \n19:32:11 \n19:32:11 \n19:32:11 \nNone \nLiteral value \nValue stored in DATETIME or TIMESTAMP column \n'2018-08-15 19:32:11' \n'2018-08-15' \nDescription \n2018-08-15 19:32:11 \n2018-08-15 00:00:00 \n• \nYou can specify date and time values by coding a literal value. In most cases, you \nenclose the literal value in single quotes. \n• \nFor dates, MySQL uses the ''yyyy-mm-dd'' format. For times, MySQL uses the \n''hh:mm:ss'' format, using a 24-hot1r clock. \n• \nBy default, MySQL does not support common date formats used by other systems \nsuch as ''mm/dd/yy'' and ''mon/dd/yyyy''. \n• \nBy default, MySQL interprets 2-digit years from 00 to 69 as 2000 to 2069 and the \nyears from 70 to 99 as 1970 to 1999. \n• \nMySQL interprets any punctuation character as a delimiter between date parts. If you \ndon't use any delimiters, you can code the value as a numeric literal without quotes. \n• \nIf you don't specify a time when storiI1g a DATETIME or TIMESTAMP value, \nMySQL stores a time value of 00:00:00 (12:00 midnight). \n• \nIf you don't specify seconds when storing a TIME value, MySQL stores 00 for the \nseconds. \n• \nWhen storing date and time values, MySQL loosely checks the values to make sure they \nare valid. For example, months must be in the range 0-12, days must be in the range \n0-31, and so on. If MySQL determines that a date or time isn't valid, it returns an error. \n• \nMySQL 5.5 and later are stricter than previous versions of MySQL for storing date \nand time values. If MySQL can't interpret a value, it returns an error or a warning. \nFigure 8-5 \nThe date and time types (part 2 of 2)\n\n244 \nSection 2 \nMore SQL skills cts you need them \nThe ENUM and SET types \nThe ENUM and SET types can be considered character data types since they \nallow you to restrict the values for a column to a limited set of strings as shown \nin figure 8-6. However, MySQL internally stores these values as integers, which \nreduces the nun1ber of bytes needed to store each string. \nThe main difference between the ENUM and SET types is that an ENUM \ncolumn can store exactly one value, but a SET column can store zero, one, or \nup to 64 different values. In other words, an ENUM column can consist of only \none member in a set of values, while the SET column may consist of any, or all, \nmembers in a set. \nYou can use the ENUM type to store values that are mutually exclusive, such \nas Yes, No, or Maybe. In other words, you can use the ENUM type to represent \na choice of one value, but not two. For example, delivery or pickup; cash, credit, \nor debit; small, medium, or large; paper or plastic; soup or salad, although I \nsuppose you might want both soup and salad. For that, you could use a SET \ncolumn. \nYou can use a SET column when you want to choose more than one value. \nFor example, the toppings on a pizza, the software on a computer, or the features \nof a car could be SET values. \nThe acceptable values for an ENUM or SET column are defined when the \ntable is created. An ENUM column can specify up to 65,535 acceptable values. \nHowever, a SET column is limited to 64 values. \nTo store a value in an ENUM column, you code a single text string. If the \nstring is one of the acceptable values for the column, MySQL stores that value. \nOtherwise, MySQL assigns an empty string to the col11mn. \nWhen you add a row to a table that contains an ENUM column, MySQL \nassigns a default value to that column if you don't explicitly specify a value. If \nthe column allows null values, MySQL assigns a null value to the col11mn. If \nthe column doesn't allow null values, MySQL assigns the first value in the set \nof acceptable values. If you want MySQL to use a specific value as the default \nvalue, then, you'll want to code that value as the first value in the set. \nTo store values in a SET coJumn, you code a single string with one or more \nvalues separated by commas. Then, MySQL stores each acceptable value and \nignores any other values. Since commas are used to separate values, you can't \nuse commas within a value when you define the SET column. \nWhen storing multiple values in a SET column, the order of the values \ndoesn't matter. That's because MySQL stores the values in the same order as \nin the column defmition. It also doesn't matter if you repeat a value because \nMySQL doesn't store duplicate values.\n\nClzapter 8 \nHow to work with data types \n245 \nThe ENUM and SET types \nType \nBytes \nDescription \nENUM \nSET \n1-2 \n1-8 \nStores one value selected from a list of acceptable values. \nStores zero or more values selected from a list of acceptable values. \nHow values are stored in ENUM columns \nStored in column \nValue \nENUM ('Yes', 'No', 'Maybe') \n'Yes' \n'No' \n'Maybe' \n'Possibly' \n'Yes' \n'No' \n'Maybe' \nI \nI \nHow values are stored in SET columns \nValue \n'Pepperoni• \n'Mushrooms' \n'Pepperoni, Bacon• \n'Olives, Pepperoni' \nDescription \nStored in column \nSET ('Pepperoni', 'Mushrooms', 'Olives') \n'Pepperoni' \n'Mushrooms' \n'Pepperoni' \n'Pepperoni, Olives' \n• \nThe ENUM and SET types can be used to restrict the values that you store to a \nli1nited set of values. Tl1e ENUM column can take on exactly one value, but a SET \ncolt1mn can take on zero, one, or up to 64 different values. \n• \nYou can defme the set of acceptable values for an ENUM or SET column when you \ncreate a table. An ENUM column can have up to 65,535 acceptable values, but a \nSET column is limited to 64 acceptable values. \n• \nTo specify a value for· an ENUM column, you code a single text string. If the string \ncontains an acceptable value, that value is stored in the column. Otherwise, the \ncolumn is assigned an empty string. \n• If you don't specify a value for an ENUM column when you insert a row, MySQL \nassigns a default value that depends on whether the column allows null values. If \nthe column allows null values, MySQL assigns a null value to the column. If it \ndoesn't allow null values, MySQL assigns the first value in the set of acceptable \nvalues to the column. \n• \nTo specify values for a SET column, you code a single string with the values \nseparated by commas. Each acceptable value is stored in the column, and any other \nvalues are ignored. \n• \nWhen you store values in a SET column, MySQL stores the values using the order \nspecified in the column definition, and it does not store duplicate values. \nFigure 8-6 \nThe ENUM and SET types\n\n246 \nSection 2 \nMore SQL skills cts you need them \nThe large object types \nFigure 8-7 presents the large object (LOB) types. These data types are \ndesigned to store large amounts of binary or character data. \nThe BLOB (binary large object) types store strings of binary data. This data \ntype is often used to store images, sounds, and video. However, the BLOB types \ncan be used to store any type of binary data, including the binary data that's \nnormally stored in application ftles such as PDF ftles or Word files. \nThe TEXT types work similarly to the BLOB types, but they store strings of \ncharacters. As a result, in other database systems, they are sometimes referred \nto as character large object (CLOE) types. These data types can be used to store \nlarge amounts of character data including data that's normally stored in text, \nXML, or JSON files. \nTo read and write data from a column defined with a BLOB or TEXT type, \nyou typically use another programming language such as Java or PHP. As a \nresult, we don't cover these types in this book. However, if you want to use these \ntypes, you can learn more about how to do that by reading about them in the \nMySQL Reference Manual.\n\nClzapter 8 \nHow to work with data types \n247 \nThe large object types \nType \nBytes \nDescription \nLONGBLOB \nMEDIUMBLOB \nBLOB \nTINYBLOB \nLONGTEXT \nMEDIUMTEXT \nTEXT \nTINYTEXT \nDescription \nL+4 \nL+3 \nL+2 \nL+l \nL+4 \nL+3 \nL+2 \nL+l \nVariable-length strings of binary data up to 4GB in length (L). \nVariable-length strings of binary data up to 16MB in length (L). \nVariable-length strings of binary data up to 65KB in length (L). \nVariable-length strings of binary data up to 255 bytes jn length (L). \nVariable-length strings of characters up to 4GB in length (L). \nVariable-length strings of characters up to 16MB in length (L). \nVariable-length strings of characters up to 65KB in length (L). \nVariable-length strings of characters up to 255 bytes in length (L). \n• \nThe BLOB types store strings of binary data and are referred to as binary large \nobject (BLOB) types. \n• \nThe TEXT types store strings of character data and are sometimes referred to as \ncharacter large object ( CLOE) types. \nFigure 8-7 \nThe large object types\n\n248 \nSection 2 \nMore SQL skills cts you need them \nHow to convert data \nAs you work with the various data types, you'll find that you frequently \nneed to convert data from one type to another. Although MySQL performs many \nconversions automatically, it doesn't always perform the conversion the way you \nwant. Because of that, you need to be aware of how data conversion works, and \nyou need to know when and how to specify the type of conversion you want. \nHow implicit data conversion works \nBefore MySQL can operate on two values, it must convert those values to \nthe same data type. To understand how this works, consider the three expressions \nshown in figu.re 8-8. \nIn the first example, the second column joins a string literal of''$'' to the \ninvoice_total column, which is defined with the DECIMAL type. As a result, \nMySQL converts the DECIMAL value to its corresponding characters, appends \nthose characters to the $ character, and stores them as a CHAR type. \nIn the second example, the second column divides the INT literal of 989319 \nby the VARCHAR type that's stored in the invoice_number column. As a result, \nMySQL attempts to convert the invoice_number column to an INT type before \nit perfor1ns the division operation. If the invoice_number column contains only \nnumbers, this works as you would expect. However, if the invoice_number \ncolumn contains letters or special characters, MySQL converts only the numeric \ncharacters that precede the letters or special characters. For example, in the first \nrow in the result set, MySQL only converts the numbers before the dash in the \ninvoice number column. \n-\nIn the third example, the second column adds an INT literal of 1 to the \ninvoice_date column, which is defined with the DATE type. As a result, MySQL \nconverts the DATE value in the invoice date column to an INT valt1e before it \nperforms the addition. In the result set, the first column uses the DATE type, \nwhich includes dashes between the parts of the date. The second column, on the \nother hand, uses the INT type, which doesn't include dashes between parts of the \ndate. \nNotice in the third row of this result set that after 1 is added to the date, \nthe date is invalid. Because MySQL doesn't check if the resulting date is valid \nwhen you perform an arithmetic operation like this, you're not likely to use the \narithmetic operators with dates. Instead, you'll use the functions for performing \ncalculations on dates that are presented in the next chapter. \nWhen MySQL performs a conversion automatically, it's called an implicit \nconversion. However, if you want to control how a conversion is performed, \nyou can code an explicit conversion. To do that, you can use the CAST and \nCONVERT functions shown in the next figure.\n\nClzapter 8 \nHow to work with data types \n249 \nSELECT statements that implicitly convert data from one type to another \nNumber to string \nSELECT invoice_total, CONCAT{'$', invoice_total) \nFROM invoices \ninvoice_total \nCONCATCs', invoice_total) \n-\n-\n► \n3813.33 \n53813.33 \n'10.20 \ns-10.20 \nI 138.75 \nS138.75 \nString to number \nSELECT invoice_r.n1mh,=ir, 989319 / invoice_n11mher \nFROM invoices \ninvoice_number \n► \n989319-457 \n263253241 \n1963253234 \n989 319/tnvoice _number \n1 \n0.0037580505988908225 \n0.001027060138580 3393 \nDate to number \n-\nSELECT invoice_date, invoice date+ 1 \nFROM invoices \n. \ninvoice_date \ninvoice_date + 1 \n-\n► \n2018-08-02 \n20180803 \n2018-08-01 \n20180802 \n2018-07-31 \n20180732 \nDescription \n• \nWhen MySQL automatically converts one data type to another, it's known as an \nimplicit conversion. \n• \nIf you code an expression that involves values with different data types, MySQL \nimplicitly converts them when it evaluates the expression. \n• \nIf you use a string in a numeric expression, MySQL attempts to convert the string \nto a nt1mber before evaluating the expression. If the string starts with a letter \nor special character, MySQL returns a value of zero. If it starts with a number, \nMySQL returns that number and each successive number until it encot1nters a letter \nor special character. \n• \nIf you add or subtract an integer to or from a DATE value, MySQL implicitly \nconverts the DATE value to an integer value. \nFigure 8-8 \nHow implicit data conversion works \n,.. \nL\n\n250 \nSection 2 \nMore SQL skills cts you need them \nHow to convert data using the CAST \nand CONVERT functions \nBecause MySQL's rules for implicit conversion are more flexible than those \nfor other SQL databases, you generally don't need to explicitly convert data \nfrom one type to another. However, whenever necessary, you can use the CAST \nand CONVERT functions to convert, or cast, an expression to the data type you \nspecify as shown in figure 8-9. Since CAST is an ANSI-standard function, it is \nused more freqt1ently than CONVERT, but both functions work equally well for \nmost tasks. \nThe first SELECT statement shows how to use the CAST function. Here, \nthe fourth column in the result set casts the DATE values of the invoice date \ncolu1nn to CHAR values. Although the fourth column looks the same as the \nsecond column, it stores a CHAR value, not a DATE value. In this case, MySQL \nconverted all of the characters in the DATE value to a CHAR value. If that's \nnot what you want, you can truncate the number of characters in the result by \nspecifying a value less than 10 after the CHAR keyword. \nThe fifth column in the 1·esult set casts the DECIMAL values in the \ninvoice_total column to signed INT values. Before the digits to the right of \nthe decimal point are dropped, the numbers are rounded to the nearest whole \nnumber. For brevity, this statement only t1ses the SIGNED keyword. For clarity, \nit could also include the optional INTEGER keyword immediately after the \nSIGNED keyword. \nThe second SELECT statement in this figure shows how to use the \nCONVERT function. If you compare this statement to the first SELECT state-\nment, you '11 see that it uses a slightly different syntax. However, both SELECT \nstatements accomplish the same task.\n\nClzapter 8 \nHow to work with data types \n251 \nThe syntax of the CAST function \nCAST(expression AS cast_type) \nThe syntax of the CONVERT function \nCONVERT(expression, cast_type) \nThe cast types you can use in the CAST and CONVERT functions \nCast type \nDescription \nCHAR [ (N)] \nA string of characters where N is the maximu1n number of characters. \nDATE \nA DATE value. \nDATETIME \nA DATETIME value. \nTIME \nA TIME value. \nSIGNED [ INTEGER] \nA signed INT value. The INTEGER keyword is optional. \nUNSIGNED [INTEGER] \nAn unsigned INT value. The INTEGER keyword is optional. \nDECIMAL [ (M [, D] ) l \nA DECIMAL value where M specifies the precision and D specifies \nthe scale. \nA statement that uses the CAST function \nSELECT invoice_ id, invoice_date, invoice_total, \nCAST(invoice_date AS CHAR(lO)) AS char_date, \nCAST(invoice_total AS SIGNED) AS integer_total \nFROM invoices \ninvoice_id \ninvoice_date \ninvoice_total \nchar_date \ninteger _total \n► \n1 \n2018-04-08 \n3813.33 \n2018-04-08 \n3813 \nI~ \n2018-04-10 \n410.20 \n2018-04-10 \n410 \n2018-04-13 \n138. 75 \n2018-04-13 \n139 \nA statement that uses the CONVERT function \nSELECT invoice_ id, invoice_date, invoice_total, \nCONVERT(invoice date, CHAR(lO)) AS char date, \n-\n-\nCONVERT(invoice_total, SIGNED) AS integer_total \nFROM invoices \ninvoke id \ninvoice_date \nnvoice_total \nchar_date \ninteger_ total \n-\n► \n1 \n2018-04-08 \n3813.33 \n2018-04-08 \n3813 \n2 \n2018-04-10 \n410.20 \n2018--04-10 \n410 \n13 \n2018-04-13 \n138.75 \n2018--04-13 \n139 \nDescription \n• \nYou can use the CAST or CONVERT function to perform an explicit conversion. \nThis allows you to convert, or cast, an expression from one data type to another. \n• \nCAST is an ANSI-standard function and is used more frequently than CONVERT. \nFigure 8-9 \nHow to convert data using the CAST and CONVERT functions \n-\nI\n\n252 \nSection 2 \nMore SQL skills cts you need them \nHow to convert data using the FORMAT \nand CHAR functions \nIn addition to the CAST and CONVERT functions, MySQL provides some \nfunctions that perform other types of data conversion. In particular, it provides \nthe FORMAT and CHAR functions shown in figure 8-10. \nYou can use the FORMAT function to convert a number to a string of \ncharacters. This function uses commas to group the thousands to the left of \nthe decimal point. This makes large numbers easier to read. In addition, the \nFORMAT function rounds the number to the specified number of decimal \nplaces. If you specify O decimal places, the function returns a string that doesn't \ninclude a decimal point. \nThe CHAR function returns a binary string for each specified integer. \nThis function is typically used to output ASCII (American Standard Code \nfor Information Interchange) conu·ol characters that can't be typed on your \nkeyboard. The three most common control characters are presented in this figure. \nThese characters can be used to format output so it's easy to read. In this figure, \nfor example, the SELECT statement uses the CHAR(l3) and CHAR(l O) control \ncharacters to start new lines after the vendor name and vendor address in the \noutput.\n\nClzapter 8 \nHow to work with data types \n253 \nThe FORMAT and CHAR functions \nFunction \nDescription \nFORMAT(number,decimal) \nCHAR{valuel[,value2] ... ) \nThe FORMAT function \nConverts the specified number to a character suing \nw.ith grouped digits separated by co1nmas, rounded to \nthe specified number of decimal digits. If deciinal is \nzero, then the decimal point is omitted. \nConverts one or 1nore numbers to a binary string. Each \nnumber is interpreted as an integer between O and 255. \nFunction \nResult \nFORMAT(1234567.8901,2) \nFORMAT{l234.56,4) \nFORMAT(1234.56,0) \n1,234,567.89 \n1,234.5600 \n1,235 \nThe CHAR function for common control characters \nFunction \nControl character \nCHAR(9) \nCHAR(lO) \nCHAR(13) \nTab \nLine feed \nCaniage return \nA statement that uses the CHAR function to format output \nSELECT CONCAT(vendor_ name, CHAR(13,10), vendor_addressl, CHAR(13,10), \nvendor_city, ', ', vendor_ state, ' ', vendor_ zip_code) \nFROM vendors \nWHERE vendor id= 1 \nus Postal Service \nAttn: \nSupt. Window Services \nMadison, WI 53707 \nDescription \n• \nThe CHAR function is typically used to insert control characters into a character \nstring. \nFigure 8-10 \nHow to convert data using the FORMAT and CHAR functions\n\n254 \nSection 2 \nMore SQL skills cts you need them \nPerspective \nIn this chapter, you learned about the different MySQL data types. In \naddition, you learned how to use some functions to convert data from one type \nto another. In the next chapter, you'll learn some of the additional functions for \nworking with data. \nTerms \ndata type \ncharacter data types \nstring \ntext \nnumeric data types \ninteger \nreal number \ndate and time data types \ndate/time data types \ntemporal data types \nlarge object (LOB) data types \nspatial data types \nglobal positioning system (GPS) \ngeometry types \nJSON data type \nJavaScript Object Notation (JSON) \nfixed-length string \nvariable-length string \nutf8mb4 character set \nmultiple-byte character set \nUnicode standard \nutf8mb3 character set \nsingle-byte character set \nlatin I character set \ninteger types \nfixed-point number \nscale \n• \n• \nprec1s1on \nfloating-point number \nsignificant digits \nsingle-precision number \ndouble-precision number \nscientific notation \nexact numeric types \napproximate numeric types \nyear 203 8 problem \nY2K38 problem \nUnix Millennium bug \nBLOB (Binary Large Object) \ncharacter large object (CLOB) \nimplicit conversion \nexplicit conversion \ncast \nASCII (American Standard \nCode for Infor1nation \nInterchange)\n\nClzapter 8 \nHow to work with data types \n255 \nExercises \n1. \nWrite a SELECT statement that returns these columns from the Invoices \ntable: \nThe invoice total column \n-\nA column that t1ses the FORMAT function to return the invoice total \ncolumn with 1 digit to the right of the decimal point \nA column that uses the CONVERT function to return the invoice total \ncolumn as an integer \nA column that uses the CAST function to return the invoice total column \nas an integer \n2. \nWrite a SELECT statement that returns these columns from the Invoices \ntable: \nThe invoice date column \n-\nA column that uses the CAST function to return the invoice_date column \nwith its full date and time \nA column that uses the CAST function to return the invoice date column \n-\nwith just the year and the month\n\nHow to use functions \nIn chapter 3, you we1·e introduced to some of the scalar functions that you \ncan use in a SELECT statement. Now, this chapter expands on that coverage \nby presenting many more of the scalru: functions, as well as some specialized \nwindow functions. When you complete this chapter, you'll have a thorough \nunderstanding of the functions that you can use with MySQL. \nHow to work with string data ............................................. 258 \nA sut11mary of the string functions .............................................................. 258 \nExamples that use string functions ............................................................. 260 \nHow to sort by a string column that contains numbers ............................... 262 \nHow to parse a string .................................................................................. 264 \nHow to work with numeric data ......................................... 266 \nHow to use the numeric fu nctions .............................................................. 266 \nHow to searcl1 for floating-point nu111bers ................................................... 268 \nHow to work with date/time data ...................................... 270 \nHow to get the current date and time .......................................................... 270 \nHow to parse dates and times witl1 date/ti1ne functions ............................. 272 \nHow to parse dates and ti111es witl1 tbe EXTRACT function ...................... 274 \nHow to format dates and times .................................................................... 276 \nHow to perform calculations on dates and times ........................................ 278 \nHow to search for a date ............................................................................. 280 \nHow to search for a time .............................................................................. 282 \nOther functions you should know about ......................... 284 \nHow to use the CASE fu nction ................................................................... 284 \nHow to use the IF, IFNULL, and COALESCE functio11s .......................... 286 \nHow to use the regular expression functions ............................................... 288 \nHow to use the ranking functions ................................................................ 292 \nHow to use the ana]ytic functions ...................................................................... 296 \nPerspective ......................................................................... 300\n\n258 \nSection 2 \nMore SQL skills cts you need them \nHow to work with string data \nThis topic shows how to use the most useful functions that MySQL provides \nfor working with string data. In addition, it shows how to solve two common \nproblems that can occur when you work with string data. \nA summary of the string functions \nFigure 9-1 summarizes the most useful string functions that are available \nwith MySQL. To start, it summarizes the CONCAT function that you lea1ned \nabout in chapter 3. Then, it summarizes a related function, the CONCAT_ WS \nfunction, that you can use to specify a separator string that goes between the \nother strings that you are concatenating. (WS stands for with separator.) \nThe next three functions allow you to remove, or trim, characters from the \nbeginning or end of the string. To remove spaces from the left or right side of a \nstring, you can use the LTRIM or RTRIM function. To remove spaces from both \nsides of a string, you can use the TRIM function. You can also use the TRIM \nfunction to remove characters other than the space character from the left or \nright side of a string. \nTo find the nu1nber of characters in a string, you can use the LENGTH \nfunction. However, thjs function counts spaces at the beginning of the string \n(leading spaces), but not spaces at the end of the string (trailing spaces). As a \nresult, you need to take this into account if the string ends with spaces. \nTo locate the first occurrence of a substring within another string, you can \nuse the LOCATE function. Thls function returns an integer value that indicates \nthe position of the substring. Note that you can start the search at a position other \nthan the beginning of the string by including the optional start argument. This \nfunction is often used within other functions such as the SUBSTRING function. \nThe next four functions return a substring of the specified stting. To start, you \ncan use the LEFT and RIGHT functions to get the specified number of characters \nfrom the left or right side of a string. You can also use the SUBSTRING_INDEX \nfunction to get characters from the left or right side of a string. This function \nreturns the characters before or after a delimiter string occurs the specified number \nof times. Or, you can use the SUBSTRING function to get the specified number of \ncharacters from anywhere in a string. \nYou can use the next two functions to modify the specified string. First, you \ncan use the REPLACE function to replace a substring within the string with \nanother substring. Second, you can use the INSERT function to insert another \nstring into the string. \nFinally, you can use the last seven functions to transfor1n the string in \nother ways. To start, you can use the REVERSE function to reverse the order \nof the characters in a string. You can use the LOWER and UPPER functions to \nconvert the characters in a string to lower or uppercase. You can use the LPAD \nand RPAD functions to pad a string on the left or right until it's a specified \nlength. You can use the SPACE function to return a string that repeats the space \ncharacter the specified number of times. And you can use the REPEAT function \nto repeat any string the specified number of times.\n\nChapter 9 \nHow to use functions \nSome of the string functions \nFunction \nDescription \nCONCAT(strl[,str2] ... ) \nCONCAT_WS(sep,strl[,str2] ... ) \nLTRIM(str) \nRTRIM(str) \nTRIM([[BOTH ILEADING ITRAILING] \n[remove] FROM] str) \nLENGTH(str) \nLOCATE(find,search[,start] ) \nLEFT(str,length) \nRIGHT(str,length) \nSUBSTRING_ INDEX (str,delimiter, \ncount) \nSUBSTRING (str,start[,length] ) \nREPLACE(search,find,replac e ) \nINSERT (str,start,length,insert ) \nREVERSE(str ) \nLOWER(str) \nUPPER(str) \nLPAD (str,length,pad) \nRPAD (str,length,pad) \nSPACE (count ) \nREPEAT (str,count ) \nConcatenates the specified strings. If one of the strings \nis null, then the result is null. \nCo11catenates the strings with the specified separator \nstring added in between. If one of the strings is null \nor empty, it's ignored. If the separator is null, then the \nresult is null. \nReturns the string with any leading spaces removed. \nReturns the string with any trailing spaces removed. \nReturns the string without leading or trailing occur-\nrences of the specified 1·e1nove string. If remove strit1g \nis orni tted, spaces are removed. \nReturns the number of characters in the suing. \nReturns the position of the first occurTence of the find \nstring in the search string, starting at the specified strut \nposition. If the stai·t position is omitted, the search \nstarts at the beginning of the string. If the string isn't \nfound, the function returns zero. \nReturns the specified number of characters from the \nbeginning of the string. \nReturns the specified number of characters from the \nend of the string. \nReta.ms the substring before the specified number of \noccun·ences of the specified delimiter string. If count \nis positive, it returns from the beginning of the string. \nIf count is negative, it returns from the end of the string. \nReturns the specified number of charactei-s from the \nstring starting at the specified stai·t positio11. lf length \nis omitted, it i-etums from the start position to the end \nof the string. \nReturns the search string with all occurre11ces of the \nfind string replaced with the replace string. \nReturns the string with the specified insert string \ninserted into it starting at the specified start position \nand replacing the specified Jengtb. \nReturns the string with the characters in reverse order. \nReturns the string converted to lowercase letters. \nReturns the string converted to uppercase letters. \nRetu.rns the string padded on the left with the specified \npad string until it's the specified length. If the string is \nlonger than the length, it's truncated. \nReturns the string padded on the right with the speci-\nfied pad string until it's the specified length. If the \nstring is longer than the length, it's truncated. \nRetui-ns the space character repeated count times. \nReturns the specified string repeated count times. \nFigure 9-1 \nA summary of the string functions \n259\n\n260 \nSection 2 \nMore SQL skills cts you need them \nExamples that use string functions \nFigure 9-2 presents examples of most of the string functions. If yo11 study \nthese examples, you shouldn't have any trouble figuring out how they work. \nIf you 're confused by any of them, though, you can refer back to the previous \nfigure to check the syntax and results. \nThe SELECT statement shown at the bottom of this figure shows how you \ncan use the CONCAT WS and RIGHT functions to format columns in a result \n-\nset. In this case, the second column uses the CONCAT_ WS function to retrieve \ntwo columns from the Vendors table and separate them with a comn1a and a \nspace. \nThe third column in the result set lists the vendor's phone number without an \narea code. To accomplish that, this column uses the RIGHT function to extract \nthe eight rightmost characters of the vendor_phone column. This assumes that \nthe area code is enclosed in parentheses and that all of the phone numbers are \nstored in the same format. Since the vendor_phone column is defined with the \nVARCHAR(50) data type, this isn't necessarily the case. \nThis SELECT statement also shows how you can use a function in a \nWHERE clause. This WHERE clause uses the LEFT function to select only \nthose rows that begin with an area code of ''(559''. Again, this assumes that the \narea code is enclosed in parentheses and that the phone numbers are all in the \nsame format.\n\nChapter 9 \nHow to use functions \nString function examples \nFunction \nResult \nCONCAT('Last', 'First') \nCONCAT_WS(', ', 'Last•, 'First') \nLTRIM ( ' \nMySQL \nI ) \nRTRIM ( I \nMySQL \nI \n) \nTRIM ( ' \nMySQL \nI ) \nTRIM(BOTH '*' FROM '****MySQL****') \nLOWER ( I MySQL ' ) \nUPPER(' ca') \nLEFT ( 'MySQL 1 , \n3 ) \nRIGHT('MySQL', 3) \nSUBSTRING('(559) 555-1212', 7, 8) \nSUBSTRING_ INDEX('http://www.murach.com', \nLENGTH ( I MySQL ' ) \nLENGTH ( I \nMySQL \n' ) \nLOCATE('SQL', \nI \nMySQL') \nLOCATE ( ' - ' , \n1 ( 5 5 9 ) 5 5 5 -1212 1 ) \nI \nI \n• \nI \nREPLACE(RIGHT('(559) 555-1212', 13),') ', '-') \nINSERT(\"MySQL\", 1, 0, \"Murach's \") \nINSERT('MySQL', 1, 0, 'Murach' 's ') \nA SELECT statement that uses three functions \nSELECT vendor_ name, \n-2) \n'LastFirst• \n'Last, First' \n'MySQL \n' \n' \nMySQL' \n'MySQL' \n'MySQL' \n•mysql' \n'CA' \n'MyS' \n'SQL' \n'555-1212' \n'murach.com• \n5 \n9 \n5 \n10 \n'559-555-1212' \n\"Murach's MySQL\" \n\"Murach's MySQL\" \nCONCAT_WS(', ', vendor_ contact_ last_ name, \nvendor_ contact_first_ name) AS contact_name, \nRIGHT(vendor_phone, 8) AS phone \nFROM vendors \nWHERE LEFT(vendor_phone, 4) = '(559' \nORDER BY contact nam~ \nvendor _name \ncontact_name \nphone \n► \nDrist.as Groom & McCormick \nAaronsen, Thom \n555-8484 \nYale Indusbial Trucks-Fresno \nAlexis1 Alexandro \n555-2993 \nLou Gentile's Flower Basket \nAnum, Trisha \n555-6643 \nPolst.ar \nAranovitdi, Robert \n555-2631 \nFigure 9-2 \nExamples that use string functions \n,.. \nL \n261\n\n262 \nSection 2 \nMore SQL skills cts you need them \nHow to sort by a string column \nthat contains numbers \nFigure 9-3 presents solutions to a common problem that can occur when you \nattempt to sort string data that's stored in a numeric column. To illustrate the \nproblem, look at the first example in this figure. Here, the emp_id column in the \nString_Sample table, which contains numeric IDs, is defined with a character \ntype. Because of that, when you sort by this column, the rows aren't in numeric \nsequence. That's beca11se MySQL interprets the values as characters, not as \nnumbers. \nOne way to solve this problem is to convert the values in the emp_id column \nto integers for sorting purposes. This is illustrated in the second SELECT state-\nment in this figure, which uses the CAST function. As you can see, the rows are \nnow sorted in numeric sequence. The third example is similar, but it implicitly \ncasts the character values to integers by adding Oto the values. \nAnother way to solve this problem is to pad the numbers with leading zeros \nor spaces, as shown by the last example. Here, the LPAD function is used to pad \nthe emp_id column with zeros so the result always contains two columns. Then, \nthe columns that start with a zero are sorted before the other columns, so the \nrows are returned in numeric sequence. \nOf course, if you know that a column will always contain numbers, you'll \ntypically define it with a numeric type. If that isn't possible, though, you can \nsolve the sorting problem by using one of the techniques shown in this figure.\n\nChapter 9 \nHow to use functions \n263 \nHow to sort by a string column that contains numbers \nSorted by the emp_id column \nSELECT* \nFROM string_ sample \nORDER BY emp_id \nemp_id \nemp_name \n► \n1 \nLizbeth Darien \n17 \nLance Pinos-Potter \n2 \nDarnell O'Sullivan \n20 \nJean Paut Renard \n3 \nAlisha von Strump \nSorted by the emp_id column explicitly cast as an integer \nSELECT* \nFROM string_ sample \nORDER BY CAST(emp_ id AS SIGNED) \nempjd \n► \n1 \n2 \n3 \n17 \n20 \nemp_name \nUibeth Darien \nDarnell O'Sullivan \nAlisha von Strump \nLance Pinos-Potter \nJean Paul Renard \nSorted by the emp_id column implicitly cast as an integer \nSELECT* \nFROM string_ sample \nORDER BY emp_ id + 0 \nemp_id \nemp_name \n-\n► \n1 \nLizbeth Darien \n2 \nDarnell O'Sullivan \n3 \nAlisha von Strump \n17 \nLance Pinos-Potter \n20 \nJean Paul Renard \n~ \n·'l!a \nl1 \nSorted by the emp_id column after it has been padded with leading zeros \nSELECT LPAD(emp_ id, 2, '0') AS emp_ id, emp_name \nFROM string_ sample \nORDER BY emp_ id \nemp_id \nemp_name \n-\n-\n► \n01 \nUibeth Darien \n02 \nDarnen O'SUUivan \n03 \nAtisha von Strump \n17 \nlance Pinos-Pott.er \n20 \nJean Paul Renard \nDescription \n• \nThe emp_id column in the String_Sarnple table used i11 the examples above is \ndefined with the type VARCHAR(3). However, this column contains numeric \nvalues. \nFigure 9-3 \nHow to sort by a string column that contains numbers\n\n264 \nSection 2 \nMore SQL skills cts you need them \nHow to parse a string \nAnother problem you may encounter when working with string data occurs \nwhen two or more values are stored in the same string. For example, the \nemp_name column in the String_Sample table contains both a frrst and a last \nname. If you want to work with the fu·st and last names independently, you have \nto parse the string using the string functions. Figure 9-4 shows how this works. \nThe first example uses the SUBSTRING_INDEX function to parse the frrst \nand last names. To start, the second column uses the SUBSTRING_INDEX \nfunction to return all characters from the start of the string in the emp_name \ncolumn up to the frrst space in that column. Then, the third column uses the \nSUBSTRING INDEX function to return all characters from the end of the \nstring in the emp_name column up to the last space in that column. To do that, a \nnegative value is coded for the count parameter. \nUnfortunately, this example doesn't work correctly for all rows. In pai·ticular, \nthe last name for the fifth row should probably be ''von Strump'' not ''Strump''. \nTo solve this problem, you can sometimes use the SUBSTRING function as \nshown by the third example. \nBut first, it's helpful to understand how the LOCATE function works as \nillustrated by the second example. Here, the second column returns an integer \nvalue for the location of the first space. Then, the third column returns the \nlocation of the second space. To get the location of the second space, this \nLOCATE function uses a nested LOCATE function as its third parameter. This \nstarts the search at the chai·acter after the first space. \nThe third example uses the SUBSTRING function to parse a stiing. To start, \nthe second column uses the SUBSTRING and LOCATE functions to return all \ncharacters from the beginning of the su·ing to the frrst space. Then, the third \ncolumn uses the SUBSTRING and LOCATE functions to return all characters \nafter the first space to the end of the string. \nUnfortunately, this example also doesn't work correctly for all rows. In \nparticular, the last name for the fourth row should probably be ''Renard'' not \n''Paul Renard''. However, this example does return ''von Strump'' not ''Strump'' \nfor the last row, which is probably correct. \nAs you review these examples, you can focus on how the string functions are \nused. As I've indicated, though, this code doesn't work correctly for all names. \nThis illustrates the importance of designing a database so this type of problem \ndoesn't occur. You'll learn more about that in the next chapter. For now, just \nrealize that if a database is designed correctly, you won't have to worry about \nthis type of problem. Instead, this problem should occur only if you 're importing \ndata from another file or database system.\n\nChapter 9 \nHow to use functions \n265 \nHow to use the SUBSTRING_INDEX function to parse a string \nSELECT emp_name, \nSUBSTRING_ INDEX(emp_name, \nSUBSTRING_ INDEX(emp_name, \nFROM string_ sample \nemp_name \nfirst_name \nlast_name \n-\n► \nLizbeth Darien \nLizbeth \nDarien \nDarnel O'SuUivan \nDarnel \nO'SUiiivan \nlance Pines.Potter \nLance \nPines.Potter \nJean Paul Renard \nJean \nRenard \nAlisha van Strump \nAlisha \nStrump \n• •, 1) AS first_name, \n• •, -1) AS last_name \n-\nHow to use the LOCATE function to find a character in a string \nSELECT emp_ name, \nLOCATE(' •, emp_name) AS first_ space, \nLOCATE{' •, emp_name, LOCATE{' •, emp_name) + 1) AS second_ space \nFROM string_ sample \nemp_name \nfirst_space \nsecond_spac.e \n-\n► \nLizbeth Darien \n8 \n0 \nDarnel O'Sullivan \n8 \n0 \nLance Pinos.Potter \n6 \n0 \nJean Paul Renard \n5 \n10 \nAlisha van Strump \n7 \n11 \nHow to use the SUBSTRING function to parse a string \nSELECT emp_name, \nSUBSTRING(emp_name, 1, LOCATE(' \n1 , \nemp_name) - 1) AS first_name, \nSUBSTRING(emp_name, LOCATE(' \n1 , \nemp_name) + 1) AS last_name \nFROM string_ sample \nemp_name \nfirst_name \nlast_name \n► \nLizbeth Darien \nLizbeth \nDarien \nDarnel O'Sullivan \nDarnel \no'Surivan \nlance Pines.Potter \nlance \nPinos.Potter \nJean Paul Renard \nJean \nPaul Renard \nAlisha van Strump \nAlisha \nvan Strump \n= \nDescription \n• \nIf a string consists of two or more components, you can parse it into its individual \ncomponents. To do that, you can use the SUBSTRING_INDEX, SUBSTRING, and \nLOCATE functions. \nFigure 9-4 \nHow to parse a string\n\n266 \nSection 2 \nMore SQL skills cts you need them \nHow to work with numeric data \nIn addition to the string functions, MySQL provides several functions for \nworking with numeric data. Although you '11 probably use only a couple of these \nfunctions regularly, you should be aware of them in case you ever need them. \nHow to use the numeric functions \nFigure 9-5 summarizes some of the numeric functions that MySQL \nprovides. The function you'll probably use most often is the ROUND function \nthat you saw back in chapter 3. This function rounds a number to the precision \nspecified by the length argument. Note that you can round the digits to the left \nof the decimal point by coding a negative value for this argument. However, \nyou 're more likely to code a positive number to round the digits to the right of \nthe decimal point. \nAnother function that you might use regularly is the TRUNCATE function. \nThis function works like the ROUND function, but it truncates the number \ninstead of roL1nding to the nearest number. In other words, this function chops off \nthe end of the number without doing any rounding. For example, if you round \n19.99 to the nearest integer, you get a value of 20. However, if you truncate \n19.99, you get a value of 19. \nYou can use the next two functions, CEILING and FLOOR, to get the \nsmallest integer greater than or equal to a number and the largest integer less \nthan or equal to a number. You can use the ABS function to get the absolute \nvalue of a number. And you can use the SIGN function to return a value that \nindicates if a number is positive, negative, or zero. If you study the examples, \nyou shouldn't have any trouble figuring out how these functions work. \nYou can use the next two functions, SQRT and POWER, to calculate the \nsquare root of a number or raise a number to a specified power. And you can \nuse the last function, RAND, to generate a floating-point number with a random \nvalue between O and 1. \nIn addition to the functions shown in this figure, MySQL provides many \nother functions for performing mathematical calculations, including trigono-\nmetric calculations. Since you 're not likely to use these functions, they aren't \npresented in this book. However, if you need a function that isn't shown here, \nyou can search for the function in the MySQL Reference Manual.\n\nChapter 9 \nHow to use functions \n267 \nSome of the numeric functions \nFunction \nDescription \nROUND(number [ , length] ) \nReturns the nt1mber rounded to the precision specified by length. \nIf length is 0, the deci1nal digits are on:litted. This is the default. \nIf length is negative, the digits to the left of the decimal point are \nrounded. \nTRUNCATE(numher,length ) \nReturns the number truncated to the precision specified by length. \nIf length is 0, the decimal digits are omitted. \nCEILING ( l'llJrnb'!r) \nFLOOR ( l'llJrnber ) \nABS(number) \nSIGN ( l'llJJDb'!r) \nSQRT ( fllJJDber) \nPOWER (numher,power) \nRAND ( [integer] ) \nReturns the smallest integer that is greater than or equal to tl1e \nnumber. \nRetw-ns the largest integer that is less than or equal to the number. \nReturns the absolute value of the number. \nReturns the sign of the number as -1 for a negative number, 1 for \na positive number, and O if the number is zero. \nReturns the square root of the number. \nReturns the nt1mber raised to the specified power. \nReturns a random floating-point number between O and 1. If inte-\nger is omitted, tl1e function returns a series of different numbers \nevery time. Otherwise, integer supplies a seed value, and the \nfunction returns the same series of numbers. \nExamples that use the numeric functions \nFunction \nResult \nROUND ( 12 . 49,0) \nROUND(12 . 50,0) \nROUND(12 . 49,1) \nTRUNCATE ( 1 2 .51,0) \nTRUNCATE ( 1 2 .49,1 ) \nCEILING (12.5 ) \nCEILING ( -12.5 ) \nFLOOR(-12.5 ) \nFLOOR ( 12.5 ) \nABS ( -1. 2 5) \nABS (l.25 ) \nSIGN ( -1.25 ) \nSIGN (l.25 ) \nSQRT ( 125 . 43 ) \nPOWER ( 9, 2) \nRAND () \nNote \n12 \n13 \n12.5 \n12 \n12.4 \n13 \n-12 \n- 1 3 \n1 2 \n1. 2 5 \n1. 2 5 \n-1 \n1 \n11.199553562530964 \n81 \n0 . 2444132019248 \n• \nIf an error occurs, each of the numeric functions returns a null value. \nFigure 9-5 \nHow to use the numeric functions\n\n268 \nSection 2 \nMore SQL skills as you need them \nHow to search for floating-point numbers \nIn chapter 8, you learned that floating-point types such as the DOUBLE and \nFLOAT types store approximate values, not exact values. The details of why \nthat is are beyond the scope of this book. From a practical point of view, though, \nthat means that you don't want to search for exact values when you're working \nwith floating-point numbers. If you do, you'll miss values that are approximately \nequal to the value you 're looking for. \nTo illustrate, consider the table shown in figure 9-6. This table includes a \ncolumn named float_ value that's defined with the DOUBLE type. Now, consider \nwhat would happen if you selected all the rows where the value of float_ value \nis equal to 1 as shown by the first SELECT statement. In that case, the result set \nincludes only the second row, even though the table contains two other rows that \nhave values approximately equal to I. \nThis figure shows two ways to search for approximate values. First, you can \nsearch for a range of values. In this figure, for example, the second SELECT \nstatement searches for values between .99 and 1.01. Second, you can search \nfor values that round to an exact value. This is illustrated by the third SELECT \nstatement. Both of these statements return the three rows from the Float_Sample \ntable that are approximately equal to 1. In addition, both of these statements only \ncheck whether the numbers are equal down to two decimal places. However, if \nyou want, you can modify these statements to check for 1nore decimal places.\n\nChapter 9 \nHow to use functions \n269 \nThe Float_ Sample table \nfloat_id \nRoat_value \n► \n1 \no. 999999999999999 \n2 \n1 \n3 \n1.000000000000001 \n4 \n1234.56789012345 \n5 \n999.0'l'l,qQ209348 \nI \n6 \n24.04849 \n-\n.I \n... \nA search for an exact value that doesn't include two approximate values \nSELECT* \nFROM float_sample \nWHERE float_value = 1 \nI float_id \nfloat_value \n► r 2 \n1 \nHow to search for approximate values \nSearch for a range of values \nSELECT* \nFROM float_ sample \nWHERE float_value BETWEEN 0.99 AND 1.01 \nfloat id -\nfloat_value \n-\n-\n► \n1 \n0.999999999999999 \n2 \n1 \n3 \nLOOOOOOOOOOOOOO 1 \nSearch for rounded values \nSELECT* \nFROM float_ sample \nWHERE ROUND(float_value, 2) = 1.00 \nfloat_id \nfloat_value \n► \n1 \n0. 999999999999999 \n2 \n1 \n3 \n1. 00000000000000 l \nDescription \n• \nBecat1se floating-point values are approximate, you'll want to search for approximate \nvalues when working with floating-point data types such as the DOUBLE and FLOAT \ntypes. \nFigure 9-6 \nHow to search for floating-point numbers\n\n270 \nSection 2 \nMore SQL skills cts you need them \nHow to work with date/time data \nIn the topics that follow, you'll learn how to use some of the functions that \nMySQL provides for working with dates and times. As you'll see, these include \nfunctions for extracting different parts of a date/time value and for performing \noperations on dates and times. In addition, you '11 learn how to perfor1n different \ntypes of searches on date/time values. \nHow to get the current date and time \nFigure 9-7 presents some of th.e date/time functions and shows how they \nwork. The NOW, CURDATE, and CURTIME functions return the local dates \nand/or times based on your system's clock. However, if a session time zone \nhas been set, the value returned by the CURDATE and CURTIME functions is \nadjusted to accommodate that time zone. \nThe UTC_DATE and UTC_TIME functions work siinilarly, but they return \nthe Universal Time Coordinate (UTC) date, also known as Greenwich Mean \nTime (GMT). Although you probably won't use the UTC functions often, they're \nuseful if your system operates in different time zones. That way, the date/time \nvalues always reflect Greenwich Mean Time, regardless of the time zone in \nwhich they're entered. For example, a date/time value entered at 11 :00 a.m. Los \nAngeles time is given the same value as a date/time value entered at 2:00 p.m. \nNew York time. That makes it easy to compare and operate on these values. \nWhen you use functions to get the current date and time, you should be \naware that the CURRENT_TIMESTAMP, CURRENT_DATE, and \nCURRENT_TIME functions are synonymous with the NOW, CURDATE, \nand CURTIME functions. In practice, the NOW, CURDATE, and CURTIME \nfunctions are typically used by MySQL programmers because they've been \naround the longest and because they're shorter, which makes them easier to type. \nHowever, the CURRENT_TIMESTAMP, CURRENT_DATE, and \nCURRENT_TIME functions are the ANSI standard, so they're more likely to \nwork with other databases. As a result, if portability is a priority for you, you \nmight want to use these functions. \nWhen you use the NOW, SYSDATE, CURDATE, and CURTIME functions, \nyou must enter an empty set of parentheses after the name of the function as \nshown by this figure. However, when you use the other functions shown in this \nfigure, the parentheses are optional. For example, you can code the \nCURRENT DATE function like this: \nCURRENT_DATE \nThe advantage of coding the empty set of parentheses is that it clearly indicates \nthat the code is calling a function. The disadvantage is that it requires a little \nmore typing.\n\nChapter 9 \nHow to use functions \n271 \nFunctions that get the current date and time \nFunction \nDescription \nNOW(} \nSYSDATE() \nReturns the current local date and time based on the system's clock. \nCURRENT TIMESTAMP() \nCURDATE ( ) \nReturns the ctu·rent local date. \nCURRENT_ DATE() \nCURTIME ( ) \nReturns the current local time. \nCURRENT_ TIME ( ) \nUTC_ DATE() \nUTC_ TIME() \nExamples \nReturns the current date in Greenwich Mean Time (GMT). \nReturns the current time in Greenwich Mean Time (GMT). \nFunction \nResult \nNOW() \nSYSDATE() \nCURDATE() \nCURTIME() \nUTC_ DATE() \nUTC TIME() \nCURRENT_ TIMESTAMP() \nCURRENT DATE ( ) \nCURRENT_ TIME () \nDescription \n2018-12-06 14:12:04 \n2018-12-06 14:12:04 \n2018-12-06 \n14:12:04 \n2018-12-06 \n21:12:04 \n2018-12-06 14:12:04 \n2018-12-06 \n14:12:04 \n• \nParentheses are required after the NOW, SYSDATE, CURDATE, and CURTIME \nfunctions. \n• \nParentheses are optional after the UTC_DATE, UTC_TIME, \nCURRENT_TIMESTAMP, CURRENT_DATE, and CURRENT_TIME functions. \nFigure 9-7 \nHow to get the current date and time\n\n272 \nSection 2 \nMore SQL skills cts you need them \nHow to parse dates and times \nwith date/time functions \nFigure 9-8 shows you how to use some of MySQL's functions to parse dates \nand times. When you use these functions, you can retrieve any of the date parts \nlisted in this figure. \nIf you need to get an integer value for part of a date/time value, you can use \nthe first group of functions as shown by the first group of examples in this figure. \nFor example, you can use the DAYOFWEEK function to retm·n a number that \nrepresents the day of the week. You can use the MONTH function to return a \nnumber that represents the month. And you can use the HOUR function to return \na number that represents the hour. However, if you need to get the name of a day \nor month as a string, you can use the DAYNAME or MONTHNAME functions \nas shown by the second group of examples in this figure.\n\nChapter 9 \nHow to use functions \n273 \nSome of the date/time parsing functions \nFunction \nDescription \nDAYOFMONTH(date} \nMONTH(date) \nYEAR(date} \nHOUR(time} \nMINUTE(time) \nSECOND(time} \nDAYOFWEEK(date) \nQUARTER(date) \nDAYOFYEAR(date) \nWEEK (date[,first]) \nLAST DAY(date} \nDAYNAME(date ) \nMONTHNAME(date) \nExamples \nReturns the day of the month as an integer. \nReturns the month as an integer. \nReturns the 4-digit year as an integer. \nReturns the hours as an integer. \nReturns the minutes as an integer. \nReturns the seconds as an integer. \nReturns the day of the week as an integer where 1 =St1nday, \n2=Monday, etc. \nReturns the quarter of tl1e year as ai1 integer between 1 and 4. \nReturns the day of the year as an integer. \nR.eturns the week of the year as an integer. lf the first argument is 0, \nthe week starts on Sunday. If the first argument is I , the week starts \non Monday. \nRetur11S the last day of the month as an integer. \nReturns the name of the day of the week as a string. \nReturns the name of the month as a string. \nFunction \nResult \nDAYOFMONTH('2018- 12- 03') \nMONTH('2018-12-03') \nYEAR ( '2018- 12- 03') \nHOUR ( 'll:35:00') \nMINUTE('ll:35:00') \nSECOND ( 'll:35:00') \nDAYOFWEEK ( '2018-12-03' ) \nQUARTER ( '2018-12-03') \nDAYOFYEAR('2018-12-03') \nWEEK ( '2018-12-03') \nLAST_ DAY('2018-12-03' ) \nDAYNAME('2018-12-03') \nMONTHNAME('2018-12-03 ' ) \nDescription \n3 \n12 \n2018 \n11 \n35 \n0 \n2 \n4 \n337 \n48 \n31 \nMonday \nDecember \n• \nThe argument for the date functions can be either a DATE value or a DATETIME \nvalue. \n• \nThe argument for the time functions can be either a TIME value or a DATETIME \nvalue. \nFigure 9-8 \nHow to parse dates and times with date/time functions\n\n274 \nSection 2 \nMore SQL skills cts you need them \nHow to parse dates and times \nwith the EXTRACT function \nIn the previous figure, you learned about some common date/time functions \nfor parsing dates and times. In addition to these functions, you can use the \nEXTRACT function to parse dates and times as shown by figure 9-9. Because \nthis function is part of the ANSI standard, you may want to use it to make your \ncode more portable. Or, you may just prefer how this function works. \nWhen you t1se the EXTRACT function, you can code any of the date/time \nunits shown in this figure, followed by the FROM keyword and a date/time \nvalue. Then, MySQL extracts the specified unit from the date/time value and \nreturns an integer value that corresponds to that unit. For example, you can use \nthe MONTH unit to get an integer for the month. You can also use some units to \nget multiple parts of the date. For example, you can use the \nHOUR_SECOND unit to get an integer that represents the hours, minutes, and \nseconds parts of a date/time value. In that case, the returned integer contains one \nor two digits for the hour (a leading zero is dropped), two digits for the minute, \nand two digits for the second. \nOf course, the EXTRACT function won't work correctly if you don't \nspecify a date/time value that makes sense for the specified unit. For example, \nif you specify the SECOND unit for a DATE value, the EXTRACT function \nwon't work correctly. Conversely, if you specify the MONTH unit for a TIME \nvalue, the EXTRACT function won't work correctly. However, if you specify \na DATETIME value as shown by this figure, the EXTRACT function should \nalways work correctly.\n\nChapter 9 \nHow to use functions \n275 \nThe EXTRACT function \nFunction \nDescription \nEXTRACT{unit FROM date) \nReturns an integer that corresponds with the \nspecified unit for the specified date/time. \nDate/time units \nUnit \nDescription \nSECOND \nMINUTE \nHOUR \nDAY \nMONTH \nYEAR \nMINUTE_ SECOND \nHOUR_ Ml:NUTE \nDAY_ HOUR \nYEAR_ MONTH \nHOUR_ SECOND \nDAY_ MINUTE \nDAY_ SECOND \nSeconds \nMinutes \nHours \nDay \nMonth \nYear \nMinutes and seconds \nHour and minutes \nDay and hours \nYear and mo11th \nHours, min·utes, and seconds \nDay, hours, and minutes \nDay, hours, minutes, and seconds \nExamples that use the EXTRACT function \nFunction \nResult \nEXTRACT{SECOND FROM '2018-12-03 11:35:00') \nEXTRACT(MINUTE FROM '2018-12-03 11:35:00') \nEXTRACT(HOUR FROM '2018-12-03 11:35:00') \nEXTRACT(DAY FROM '2018-12-03 11:35:00') \nEXTRACT(MONTH FROM ' 2018-12-03 11:35:00') \nEXTRACT(YEAR FROM '2018-12-03 11:35:00') \nEXTRACT(MINUTE_ SECOND FROM '2018-12-03 11:35:00') \nEXTRACT(HOUR_ Ml:NUTE FROM '2018-12-03 11:35:00' ) \nEXTRACT(DAY_ HOUR FROM '2018-12-03 11:35:00') \nEXTRACT(YEAR_ MONTH FROM '2018-12-03 11:35:00' ) \nEXTRACT(HOUR_ SECOND FROM '2018-12-03 11:35:00') \nEXTRACT(DAY_ MINUTE FROM '2018-12-03 11:35:00') \nEXTRACT(DAY_ SECOND FROM '2018-12-03 11:35:00') \n0 \n35 \n11 \n3 \n12 \n2018 \n3500 \n1135 \n311 \n201812 \n113500 \n31135 \n3113500 \nFigure 9-9 \nHow to parse dates and times with the EXTRACT function\n\n276 \nSection 2 \nMore SQL skills cts you need them \nHow to format dates and times \nFigure 9-10 shows how to use the DATE_FORMAT function to format dates \nand times. This function accepts two parameters. The first parameter speci-\nfies the DATE or DATETIME value that you want to format. Then, the second \nparameter specifies a format string that includes special codes for formatting \nthe various parts of the date or time. To use one of these codes within the format \nstring, you code the percent sign (%) followed by a single case-sensitive letter. \nIn this figure, for instance, the frrst example uses the %m code to get the \nnumeric month, the %d code to get the nume1ic day, and the %y code to get the \ntwo-digit year. This example also uses front slashes (/) to separate the month, \nday, and year. \nThe next three examples use other formatting codes, but they work similarly \nto the frrst example. Namely, the for1nat string contains some date/time format-\nting codes to display the different parts of the date. In addition, it contains other \ncharacters such as spaces, commas, or dashes to separate the different parts of \nthe date. \nThis figure also shows how to use the TIME_FORMAT function to format \nTIME values. This function is illustrated by the last two examples. Although \nyou can also use the TIME_FORMAT function to format the time part of a \nDATETIME value, it's more common to use the DATE_FORMAT function to do \nthat as shown by the fourth example.\n\nChapter 9 \nHow to use functions \n277 \nTwo functions for formatting dates and times \nFunction \nDescription \nDATE_ FORMAT(date,format) \nRettLrns a string for the specified DATE or DATETIME \nvalu,e with the formatting speci.fied by the forniat string. \nT:IME_ FORMAT(time,format) \nWorks like the DATE_FORMAT function but accepts \nTIME or DATETIME values, and the.format string can \nonly specify tin1es, L1ot dates. \nCommon codes for date/time format strings \nCode \nDescription \n~om \nMonth, numeric (01 ... 12) \n%c \nMonth, numeric (1 ... 12) \n~oM \nMonth name (January ... December) \n~ob \nAbbreviated month name (Jan ... Dec) \n~od \nDay ofthe 1nontb, numeric (00 ... 31) \n%e \nDay of the month, numeric (0 ... 31) \n%D \nDay of the month with suffix (1st, 2n~ 3rd, etc.) \n%y \nYear, nutneric, 2 digjts \n%Y \nYear, nwneric, 4 digits \n%W \nWeekday name (Sunday ... Saturday) \n~oa \nAbbreviated weekday name (Sun ... Sat) \n9--oH \nHour (00 ... 23) \n%k \nHour (0 ... 23) \n~oh \nHour (01 ... 12) \n%1 \nHour(l ... 12) \n%i \nMinutes (00 ... 59) \n%r \nTime, 12-hotrr (hh:mm:ss AM or PM) \n%T \nTime, 24-hour (hh:mm:ss) \n%S \nSeconds (00 ... 59) \n%p \nAM or PM \nExamples \nFunction \nResult \nDATE_FORMAT('2018-12-03', •~om/9--od/%y') \nDATE_ FORMAT('2018-12-03', \nDATE_ FORMAT('2018-12-03', \nI %e-9--ob-%y t ) \nDATE_ FORMAT('2018-12-03 16:45', '%r') \nTIME_ FORMAT('16:45', \n1 %r\n1\n) \nTIME_FORMAT('l6:45', '%1:%i %p') \nFigure 9-1 0 \nHow to format dates and times \n%Y') \n08/03 / 18 \nMonday, December 3rd, 2018 \n3-Dec-18 \n04:45:00 PM \n04:45:00 PM \n4:45 PM\n\n278 \nSection 2 \nMore SQL skills cts you need them \nHow to perform calculations \non dates and times \nFigure 9-11 shows you how to use the DATE_ADD, DATE_SUB and \nDATEDIFF functions to perform calculations on dates and times. You can use \nthe DATE_ADD function to add a specified number of date parts to a date. In \nthis figure, for instance, the first three examples show how you can add days, \nmonths, or seconds to a date/time value. \nYou can also use the DATE_ADD function to subtract date parts from a \ndate/time value. To do tl1a~ you code the expression argument as a negative \nvalue as shown by the fourth example. This performs the same calculation as the \nDATE_SUB function shown in the fifth example. \nWhen you use these date functions, MySQL checks for dates that include \nleap years and returns a null value if a date doesn't exist. For example, 2016 was \na leap year, so it has a day for February 29. However, 2018 wasn't a leap year, so \nit doesn't have a day for February 29. As a result, when the sixth example adds \none year to February 29, 2016, MySQL returns February 28, 2017. On the other \nhand, the seventh example tries to add one year to an invalid date (February 29, \n2018). As a result, MySQL retlllns a null value. \nThe eighth example shows how to use the DATE_ADD function with the \nDAY _HOUR unit to add the specified number of days and hours to a date/time \nvalue. Here, the example adds 2 days and 12 hours to the specified date. \nIf you need to find the number of days between two date/time values, you \ncan use the DATEDIFF function as shown by the second group of examples. \nNote that this function only returns days, not hours, minutes, or seconds. This \nis true even if the arguments are DATETIME values that include time values, \nas shown by the second DATEDIFF example. When you use the DATEDIFF \nfunction, you typically specify the later date as the first argument and the earlier \ndate as the second argument. That way, the result of the function is a positive \nvalue. If you code the earlier date as the first argument, the result is a negative \nvalue as shown by the third DATEDIFF example. \nThe last group of examples shows how to use the TO_DAYS and \nTIME_TO _SEC functions to perforrn calculations on dates and times. To sta~ \nthe TO_DAYS example shows how you can use this function to calct1late the \nnumber of days between two dates. This perfor1ns the same calculation as the \nfirst two DATEDIFF examples. Since the DATEDIFF function is easier to write \nand read, you'll typically use it instead of the TO_DAYS function for this type of \ncalculation. \nThe last example shows how to use the TIME_TO_SEC function to calculate \nthe number of seconds between two times. This type of calculation can be useful \nwhen you're working with time values.\n\nChapter 9 \nHow to use functions \n279 \nSome of the functions for calculating dates and times \nFunction \nDescription \nDATE_ADD(date,INTERVAL expression unit} \nDATE_ SUB(date,INTERVAL expression unit} \nDATEDIFF(datel, date2} \nTO_ DAYS(date} \nTIME_TO_ SEC(time} \nExamples \nReturns a DATE or DATETIME value \nequal to the specified date plus the speci-\nfied LO terva] . \nReturns a DATE or DATETIME value \nequal to the date minus the specified \ninterval. \nReturns the number of days from one \ndate to the other. For DATETIME values, \nthis function ignores the time parts of the \nvalue. \nReturns the number of days since the year \n0. This function does not return reliable \nresults for dates before 1582. \nReturns the number of seconds e]apsed \nsince midnight, which is useful for calcu-\nlating elapsed time. \nFunction \nResult \nDATE_ADD('2018-12-31', INTERVAL 1 DAY} \nDATE_ADD('2018-12-31', INTERVAL 3 MONTH} \nDATE_ADD('2018-12-31 23:59:59', INTERVAL 1 SECOND) \nDATE_ ADD('2019-01-01', INTERVAL -1 DAY) \nDATE_ SUB('2019-01-01', INTERVAL 1 DAY) \nDATE_ADD('2016-02-29', INTERVAL 1 YEAR) \nDATE_ ADD('2018-02-29', INTERVAL 1 YEAR) \nDATE_ADD('2018-12-31 12:00', INTERVAL '2 12' DAY_HOUR) \nDATEDIFF('2018-12-30', '2018-12-03') \nDATEDIFF('2018-12-30 23:59:59', \n1 2018-12-03') \nDATEDIFF('2018-12-03', '2018-12-30') \nTO_DAYS('2018-12-30') -\nTO_ DAYS('2018-12-03') \nTIME_ TO_ SEC('l0:00'} -\nTIME_ TO_ SEC('09:59') \nDescription \n2019-01-01 \n2019-03-31 \n2019-01-01 00:00:00 \n2018-12-31 \n2018-12-31 \n2017-02-28 \nNULL \n2019-01-03 00:00:00 \n27 \n27 \n-27 \n27 \n60 \n• If the expression you specify in the DATE_ADD function is a negative integer, the \ninterval is subtracted from the date. \n• If the expression you specify in the DATE_SUB function is a negative integer, the \ninterval is added to the date. \nFigure 9-11 \nHow to perform calculations on dates and times\n\n280 \nSection 2 \nMore SQL skills cts you need them \nHow to search for a date \nFigure 9-12 illustrates a problem you can encounter when searching for \ndates in a column that's defined with the DATETIME data type. The examples in \nthis figure use a table named Date_Sample. This table includes a date_id column \nthat's defined with the INT type and a start_date column that's defmed with \nthe DATETIME type. The time components in the first three rows in this table \nhave a zero value. In contrast, the time components in the next three rows have \nnon-zero time components. \nThe problem occurs when you try to search for a date value. In this figure, \nfor instance, the first SELECT statement searches for rows in the Date_Sample \ntable with a date of '2018-02-28'. Because this code doesn't specify a time \ncomponent, MySQL adds a zero time component ('00:00:00') when it converts \nthe date string to a DATETIME value. However, because the row with this date \nhas a non-zero time value, MySQL doesn't return any rows for this statement. \nTo solve this problem, you can use one of the three techniques shown in \nthis figure. First, you can search for a range of dates that includes only the date \nyou're looking for as shown by the second SELECT statement in this figure. The \nWHERE clause in this statement searches for dates that are greater than or equal \nto the date you're looking for and less than the date that follows the date you're \nlooking for. Because a time component of zero is implicitly added to both of the \ndates in the search condition, this statement returns the one row with the date \nyou want. \nBecause this SELECT statement doesn't use any functions in the WHERE \nclause, it provides the most efficient technique for searching for dates. That's \nparticularly true if the start_date column is indexed. By contrast, the second \ntechnique uses the MONTH, DAYOFMONTH, and YEAR functions in the \nWHERE clause to search for just for those components. And the third technique \nuses the DATE FORMAT function in the WHERE clause to return a formatted \n-\nstring that only contains the month, day, and year. \nIf you want, you can use other date functions to search for a date. For \nexample, you can use the EXTRACT function shown earlier in this chapter. \nWhenever possible, though, you should avoid using functions so the search is as \nefficient as possible.\n\nChapter 9 \nHow to use functions \n281 \nThe contents of the Date_Sample table \ndate_id \nstart date \n► \n1 \n1986-03-0100:00:00 \n2 \n2006-02-28 00:00:00 \n3 \n2010-10-3100:00:00 \n4 \n2018-02-28 10:00:00 \n5 \n2019-02-28 13:58:32 \n6 \n2019-03-0109:02:25 \n-... \nA SELECT statement that fails to return a row \nSELECT* \nFROM date_ sample \nWHERE start_date = '2018-02-28' \nL \ndate_id \nstart_date \nThree techniques for ignoring time values \nSearch for a range of dates \nSELECT* \nFROM date_ sample \nWHERE start date >= '2018-02 -28' AND start date < '2018-03- 01' \ndate_id \nstart_date \n► \n4 \n2018-02-28 10:00:00 \nSearch for month, day, and year integers \nSELECT* \nFROM date_ sample \nWHERE MONTH(start_date } = 2 AND \nDAYOFMONTH(start_ date) = 2 8 AND \nYEAR {start_date} = 2018 \ndate id -\nstart_date \n► \n4 \n2018-02-28 10:00:00 \nSearch for a formatted date \nSELECT* \nFROM date_ sample \nWHERE DATE_ FORMAT (start_date, •~a111-%d -%Y' ) = '02 - 28- 2018' \nf \ndate ,d \nstart date \n► \n4 \n-\n2018~2-28 10:00:00 \nDescription \n• \nYou can search for a date in a DATETIME column by searching for a range of \ndates, by using functions to specify the month, day, and year of the date, or by \nsearching for a formatted date. Of these techniques, searching for a range of dates \nis the most efficient. \nFigure 9-12 \nHow to search for a date \nI \n.I\n\n282 \nSection 2 \nMore SQL skills cts you need them \nHow to search for a time \nWhen you search for a time value in a DATETIME column without speci-\nfying a date component, MySQL automatically uses the default date of January \n1, 1900. That's why the first SELECT statement in figure 9-13 doesn't return a \nrow even though one row matches the specified time. \nThe second SELECT statement shows one way to solve this problem. Here, \nthe WHERE clause uses the DATE_FORMAT function to return a string for the \nstart_date column in the hh:mm:ss format. Then, the WHERE clause compares \nthis string to a literal string of 10:00:00. \nThe third SELECT statement in this figure shows another way to solve this \nproblem. This statement works similarly to the second statement, but it uses \nthe EXTRACT function to extract an integer that represents the ho1rrs, minutes, \nand seconds in the start_date column. Then, the WHERE clause compares this \ninteger to an integer value of 100000. Although this approach might run slightly \nfaster, it's also more difficult to read. As a result, I recommend using the first \napproach unless performance is critical. \nThe fourth and fifth SELECT statements show that you can use a similar \ntechnique to search for a range of times. Here, the fourth statement t1ses the \nHOUR function to search for a particular hour of the day, and the fifth statement \nuses the EXTRACT function to search for times between two times. Of course, \nyou could also use the DATE_FORMAT function to get the same results. \nBefore I go on, you should realize that many of the problems that can occur \nwhen searching for dates and times can be avoided by designing the database \nproperly. For example, if you know that only the date portion of a date/time \nvalue is significant, yot1 can store the date in a column with the DATE type. \nConversely, if you know that only the time portion of a date/time value is \nsignificant, you can store the time in a column with the TIME type. That way, \nyou won't need to use functions in your searches, and you can create an index \nfor the search column to significantly speed searches. \nHowever, if both the date and time are significant, you can store them in \na column with the DATETIME type. Then, you can use the techniques shown \nin this figure and the previous figure to search for dates and times. Remember, \nthough, that if you need to use functions in your searches, MySQL can't use the \ncolumn's index and the search will run significantly slower.\n\nThe contents of the Date_Sample table \ndate_id \nstart_date \n► \n1 \n1986-03-0100:00:00 \n2 \n2006-02-28 00:00:00 \n3 \n2010-10-3100:00:00 \n4 \n2018-02-28 10:00:00 \n5 \n2019-02-28 13:58:32 \n6 \n2019-03-0 109:02:25 \n~ \nA SELECT statement that fails to return a row \nSELECT* FROM date_ sample \nWHERE start_ date = '10:00:00' \nI date_id \nstart_date \nExamples that ignore date values \nSearch for a time that has been formatted \nSELECT* FROM date_ sample \nWHERE DATE_ FORMAT(start_date, \n1 %T 1 ) \n= \n1 10:00:00 1 \ndate 1d \nstart date \n-\n► \n4 \n2018-02-28 10:00:00 \nSearch for a time that hasn't been formatted \nSELECT* FROM date_sample \nChapter 9 \nHow to use functions \n283 \nWHERE EXTRACT(HOUR SECOND FROM start_date) = 100000 \ndate_id \nstart_date \n► \n4 \n2018-02-28 10:00:00 \nSearch for an hour of the day \nSELECT* FROM date_ sample \nWHERE HOUR(start_ date) = 9 \ndate_id \nstart_date \n► \n6 \n2019-03-0109:02:25 \nSearch for a range of times \nSELECT* FROM date_sample \nWHERE EXTRACT (HOUR_MINUTE FROM start_date) BETWEEN 900 AND 1200 \ndate_id \nstart_date \n-\n► \n4 \n2018-02-28 10:00:00 \n6 \n2019-03-01 09:02:25 \n-\nDescription \n• \nYou can search for a ti1ne in a DATETIME column without specifying a date by \nusing date/time functions to get the time part of the DATETIME value. Then, you \ncan use the time parts in your WHERE clause. \nFigure 9-1 3 \nHow to search for a time\n\n284 \nSection 2 \nMore SQL skills cts you need them \nOther functions you should know about \nThis topic describes other functions that you should know about. That \nincludes the CASE, IF, IFNULL, and COALESCE functions. It also includes the \nregular expression and specialized window functions that are new with MySQL \n8.0. \nHow to use the CASE function \nFigure 9-14 presents the two versions of the CASE function. This function \nreturns a value that's determined by the conditions you specify. The easiest way \nto describe how this function works is to look at the two examples shown in this \nfigure. \nThe first example uses a simple CASE function. When you use this function, \nMySQL compares the input expression you code in the CASE clause with \nthe expressions you code in the WHEN clauses. In this exrunple, the input \nexpression is a value in the terms_id column of the Invoices table, and the \nwhen expressions are the valid values for this column. When MySQL finds an \nexpression in a WHEN clause that's equal to the input expression, it returns the \nexpression specified in the matching THEN clause. For example, if the value \nof the terms_id column is 3, this function returns a value of ''Net due 30 days.\" \nAlthough it's not shown in this example, you can also code an ELSE clause at \nthe end of the CASE function. Then, if none of the expressions in the WHEN \nclause are equal to the input expression, the function returns the value specified \nin the ELSE clause. \nThe second example uses a searched CASE function to determine the status \nof the invoices in the Invoices table. To do that, the CASE function uses the \nDATEDIFF and NOW functions to get the number of days between the current \ndate and the invoice due date. If the difference is greater than 30, the CASE \nfunction returns the value ''Over 30 days past due.\" Otherwise, if the difference \nis greater than 0, the function returns the value ''I to 30 days past due.\" Note \nthat if the condition in the frrst WHEN clause is true, the condition in the second \nWHEN clause is also true. In that case, the function returns the expression \nassociated with the first condition since this condition is evaluated first. In other \nwords, the sequence of the conditions is critical to getting the correct results. If \nneither of the conditions is true, the function returns the value ''Current.\" \nThe silnple CASE function is typically used with columns that can contain a \nlimited number of values, such as the terms_id column used in the first example. \nBy contrast, the searched CASE function can be used for a wide variety of \npurposes. For example, this function can be used to test for conditions other than \nequal, such as greater than or less than. This is shown in the second exa1nple, \nwhich couldn't be coded using the simple syntax. In addition, each condition in \na searched CASE function can be based on a different column or expression. Of \ncourse, CASE functions can be more co1nplicated than the ones that are shown \nhere, but this should give you an idea of what you can do with this function.\n\nChapter 9 \nHow to use functions \n285 \nThe syntax of the simple CASE function \nCASE input_expression \nEND \nWHEN when_expression_ l THEN result_expression_ l \n[WHEN when_expression_2 THEN result_expression_ 2] ••• \n[ELSE else_result_expression] \nA SELECT statement that uses a simple CASE function \nSELECT invoice_number, terms_id, \nCASE terms id \n-\nWHEN 1 THEN 'Net due 10 days• \nWHEN 2 THEN 'Net due 20 days• \nWHEN 3 THEN 'Net due 30 days• \nWHEN 4 THE.N 'Net due 60 days• \nWHEN 5 THEN 'Net due 90 days• \nEND AS terms \nFROM \n• \n• \n1nvo1ces \ninvo1ce_number \nterms_id \nterms \n-\n111-92R-10096 \n2 \nNet due 20 days \n25022117 \n4 \nNet due 60 days \nP02-88077S7 \n3 \nNet due 30 days \nThe syntax of the searched CASE function \nCASE \nEND \nWHEN conditional_expression_ l THEN result_expression_ l \n[WHEN conditional_expression_2 THEN result_expression_ 2] ••• \n[ELSE else_result_expression] \nA SELECT statement that uses a searched CASE function \n\"' \n. I \n'V \nSELECT invoice_n11rnbf?lr, invoice_total, invoice_date, invoice_due_date, \nCASE \nWHEN DATEDIFF(NOW(), invoice_due_date) > 30 \nTHEN 'Over 30 days past due' \nWHEN DATEDIFF(NOW(), invoice_due_date) > 0 \nTHEN '1 to 30 days past due' \nELSE 'Current' \nEND AS invoice_ status \nFROM invoices \nWHERE invoice_total - payment_total - credit_total > 0 \ninvoice_number \nlnvoice_total \ninvoice date \ninvoice_due_date \ninvoice_status \n-\n-\n► \n391CM \n85.31 \n2018-07-10 \n2018-08-09 \nOver 30 days past due \n963253264 \n52.25 \n2018-07-18 \n2018-08-17 \nOver 30 days past due \n31361833 \n579.42 \n2.018-07-21 \n2018-08-10 \nOver 30 days past due \n-\n= \nDescription \nL \n• \nTl1e simple CASE function tests the expression in the CASE clause against the \nexpressions in the WHEN clauses. Then, the function returns the result expression \nfor the frrst test that's true. \n• \nThe searched CASE function tests the expression in each WHEN clause and retwns \nthe result expression for the first test that's true. \nFigure 9-14 \nHow to use the CASE function\n\n286 \nSection 2 \nMore SQL skills cts you need them \nHow to use the IF, IFNULL, \nand COALESCE functions \nFigure 9-15 presents three functions: IF, IFNULL, and COALESCE. To \nstart, you can use the IF function to test a condition and return one value if the \ncondition is true or another value if the condition is false. For instance, the first \nexample uses the IF function to return a string value of ''Yes'' if the vendor_city \ncolumn is equal to a value of ''Fresno''. Otherwise, the IF function returns a \nvalue of ''No''. \nBoth the IFNULL and COALESCE functions let you substitute non-null \nvalues for null valt1es. Although these functions are similar, the COALESCE \nfunction is more flexible because it lets you specify a list of values. Then, it \nreturns the first non-null value in the list. In contrast, the IFNULL function only \nlets you specify two expressions. If the first expression is not null, it returns that \nexpression. Otherwise, it returns the second expression. \nThe second example uses the IFNULL function to return the value of the \npayment_date column if that column doesn't contain a null value. Otherwise, it \nreturns a string that says ''No Payment''. The third example performs the same \noperation using the COALESCE function.\n\nChapter 9 \nHow to use functions \n287 \nThe syntax of the IF function \nIF(test_expression, if_true_expression, else_expression) \nA SELECT statement that uses the IF function \nSELECT vendor_name, \nIF(vendor_city = 'Fresno', 'Yes', 'No') AS is_city_ fresno \nFROM vendors \nvendor _name \nis_dty _fresno \nTowne Advertiser's Mailing Svcs \nNo \nBFl Industries \nYes \nPacific Gas & Electric \nNo \nRobbins Mobile Lock And Key \nYes \nBiO Marvin Electric Inc \nYes \nThe syntax of the IFNULL function \nIFNULL(test_expression, replacement_value ) \nA SELECT statement that uses the IFNULL function \nSELECT payment _date, \nIFNULL (payment_date, 'No Payment') AS new date \nFROM invoices \npayment_date \n2018-08·11 \ntmr!I \n2018-08·11 \nnew date \n-\n2018-08·11 \nNo Payment \n2018-08·11 \nThe syntax of the COALESCE function \nCOALESCE(expression_l[, expression_ 2] ••• ) \nA SELECT statement that uses the COALESCE function \nSELECT payment _date, \nCOALESCE(payment_date, 'No Payment• ) AS new_date \nFROM invoices \npayment_date \nnew_date \n2018-08·11 \n2018-08·11 \nNo Payment \n2018-08·11 \n2018-08·11 \nDescription \n,.. \n-\n~ \nV \nI \n,.. \n• \nI \nV \n• \nThe IF function lets you test an expression and return one value if the expression is \ntrue and another value if the expression is false. \n• \nThe IFNULL and COALESCE functions let you substitute non-null values for null \nvalues. \n• \nThe IFNULL function returns the first expression if it isn't null. Otherwise, it \nreturns the replacement value you specify. \n• \nThe COALESCE function returns the first expression in the list that isn't null. If all \nof the expressions are nL1ll, this function returns a null value. \nFigure 9-1 5 \nHow to use the IF, IFNULL, and COALESCE functions\n\n288 \nSection 2 \nMore SQL skills cts you need them \nHow to use the regular expression functions \nIn chapter 3, you learned how to use the REG EXP operator to work with \nstring patterris known as regular expressions to determine which values in a \ncolumn satisfy a condition. With MySQL 8.0, you can also use the regular \nexpression functions shown in the frrst table in figure 9-16 to work with string \npatterns. Although these functions have arguments in addition to the ones shown \nhere, these are the ones you'll use most often. \nAll of the regular expression ft1nctions use a pattern to search a string \nexpression. The REGEXP _LIKE function works like the REGEXP operator. It \nreturns l if the pattern is found or O if it isn't. Because of that, you can use this \nfunction in a Boolean expression. \nIf you use the REGEXP _INSTR function and the pattern is found, the index \nof the first character in the matching substring is returned. If the pattern isn't \nfound, 0 is returned. \nThe REGEXP _SUBSTR function returns the first substring that matches \nthe pattern. If the substring isn't found, it returns a null value. And the \nREGEXP _REPLACE function replaces any occurrences of the pattern it finds \nwith another string. \nTo create a string pattern, you can use the special characters and constructs \nshown in the second table in this figure. The frrst six are the same as the ones \npresented in chapter 3, so you shouldn't have any trouble understanding how \nthey work. However, the last two constructs weren't presented in chapter 3. The \nfirst one lets you match zero or more occurrences of a single character, and the \nsecond one lets you match zero or more occurrences of a sequence of characters. \nThe third table in this figure shows how the regular expression functions \nwork. Here, all five of the functions operate on the string expression ''abcl23''. \nThen, the first example uses the REGEXP _LIKE function to determine if this \nexpression co11tains the numbers 123. Since it does, the result is I. The second \nexample is similar, but it checks if the nt1mbers 123 are at the beginning of the \nexpression. Since they 're not, this function returns 0. \nThe third example uses the REGEXP _INSTR function to get the index of \nthe first character of the substring 123 that occurs in the string expression. In this \ncase, the substring starts at the fourth character in the expression, so the function \nreturns 4. \nThe fourth example uses the REGEXP _SUBSTR function to get a substring \nof the characters in the string expression. Here, the patter11 indicates that the \nsubstring consists of any letter, followed by any number of digits at the end of \nthe string expression. That returns the value ''c123''. \nThe last example uses the REGEXP _REPLACE function to replace the \nnumber 1 or 2 with the number 3. That returns the value ''abc333''.\n\nChapter 9 \nHow to use functions \n289 \nThe syntax of the regular expression functions \nFunction \nDescription \nREGEXP_LI KE (expr , pattern) \nReturns 1 (true) if the string expression matches the pat-\ntern. Otherwise, returns O (false). \nREGEXP_ I NSTR(expr, pattern \n[, start]) \nReturns the index of the first character of the \nsubstring in the string expression that matches the pat-\ntern, starting at the specified start position. If the start \nposition is omitted, the search starts at the beginning of \nthe string. If the pattern isn't found, the function returns \n0. \nREGEXP_ SUBSTR( expr, pattern \n[, start]) \nReturns the first substring of the string expression \nthat matches the pattern starting at the specified posi-\ntion. If the start position is omitted, the first substring is \nreturned. If the pattern isn't found, the function returns \na null value. \nREGEXP_ REPLACE (expr, pattern, \nreplace[, start]) \nReturns the string expression with all occurrences of \nthe pattern replaced with the replace string. \nRegular expression special characters and constructs \nCharacter/Construct \nDescription \nA \n$ \n• \n[charlist] \n[char1-char2] \nI \nchar* \n(charl ist ) * \nMatches the pattern to the beginning of the value being tested. \nMatches the pattern to the end of the value being tested. \nMatches any single character . \nMatches any single character listed within the brackets. \nMatches any single character within the given range. \nSeparates two string patterns and matches either one. \nMatches zero or more occurrences of the character. \nMatches zero or more occurrences of the sequence of characters in \nparentheses. \nExamples of the regular expression functions \nExample \nResult \nREGEXP_ LIKE('abc123', \n1 123'} \nREGEXP_LIKE ( 'abcl23 ' , \n' \"123' ) \nREGEXP_ INSTR('abc123 ', '123'} \nREGEXP_ SUBSTR('abcl2 3', '[A-Z] (1-9] *$') \nREGEXP_REPLACE ( 'abc123', '1 12', '3 ') \nDescription \n1 \n0 \n4 \nc 123 \nabc3 33 \n• \nThe regular expression functions use a string pattern to search a string expression. These \npatterns can use special characters and constructs, which are case-insensitive by default. \nFigure 9-16 \nHow to use the regular expression functions (part 1 of 2)\n\n290 \nSection 2 \nMore SQL skills cts you need them \nTo help you understand how you can use the regular expression functions \nin SQL statements, part 2 of figure 9-16 presents three SELECT statements that \nuse them. The first example uses the REGEXP _INSTR function in the SELECT \nclause to return the index of the first space in the vendor_city column. The same \nREGEXP _INSTR function is also used in the WHERE clause so only the cities \nthat have a space in their names are included in the result set. \nThe second example uses the REGEXP _SUBSTR function in the SELECT \nclause to get the substring ''San'' or ''Los'' that appears at the beginning of the \nvendor_city column. Then, it uses the same function in the WHERE clause so \nif the function returns a null value, the row isn't included in the result. In other \nwords, only the cities that start with ''San'' or ''Los'' are included. \nThe third example uses the REGEXP_REPLACE function in the SELECT \nclause to replace the value ''Street'' that occt1rs anywhere in the vendor_address I \ncolumn with the value ''St''. Note that because patterns are case-insensitive by \ndefault, the pattern STREET will match both uppercase and lowercase letters \nas shown here. This example also uses the REGEXP_LIKE function in the \nWHERE clause so only vendors with a vendor_addressl column that contains \nthe pattern are included in the result set. As you saw in chapter 3, this WHERE \nclause can also be coded using the REGEXP operator like this: \nWHERE vendor addressl REGEXP 'STREET' \nAlthough these examples are relatively simple, they should give you an idea \nof what you can do with the regular expression functions. For more information \non these functions and the special characters and constructs you can use with \nthem, see the documentation for MySQL.\n\nChapter 9 \nHow to use functions \n291 \nA statement that uses the REGEXP INSTR function \nSELECT DISTINCT vendor_city, REGEXP_ INSTR(vendor_ city, ' ') AS space_ index \nFROM vendors \nWHERE REGEXP_ INSTR(vendor_ city, • ') > 0 \nORDER BY vendor_city \nvendor_aty \n-~-\nspace_index \n► \nAnn Arbor \n4 \nAubun Hills \n7 \nCarol Stream \n6 \nEast Brunswidc \n5 \nFort \\~/ashington \n5 \nLos Angeles \n4 \n(17 rows) \nA statement that uses the REGEXP SUBSTR function \nI \nSELECT vendor_ city, REGEXP_ SUBSTR(vendor_city, •ASANILOS') AS city_match \nFROM vendors \nWHERE REGEXP_ SUBSTR(vendor_city, • ASAN ILOS') IS NOT NULL \nvendor _city \ncity _match \n-\n-\n► \nLos Angeles \nLos \nSanta Ana \nSan \nSan Francisco \nSan \nSan Diego \nSan \n(12 rows) \nA statement that uses the REGEXP REPLACE \nand REGEXP LIKE functions \nSELECT vendor_ name, vendor_addressl, \nREGEXP_REPLACE(vendor_addressl, 'STREET', 'St') AS new addressl \nFROM Vendors \nWHE.RE REGEXP_ LIKE(vendor_addressl, 'STREET') \nvendor _name \nvendor _address 1 \nnew _address 1 \n► \nExpedata Inc \n4420 N. Frst Street, SUite 108 \n4420 N. First St, SUite 108 \nFresno Photoengraving Company \n1952 \"H• Street \n1952 \"H·st \nNat Assoc of College Stores \n500 East Lorain Street \n500 East Lorain St \nlhe Fresno Bee \n1626 E Street \n1626ESt \nThe Presort Center \n1627 'c Street \n1627 \"E• St \nReiter's Scientific &. Pro Books \n2021 K Street Nw \n2021 K StNw \n(4 rows) \nDescription \n• \nThe REGEXP _LIKE function works just like the REGEXP operator that you \nlearned about in chapter 3. \n• \nThe REGEXP _REPLACE function replaces the occurrences of the regular expres-\nsion pattern only in the result set. The database table re1nains unchanged. \nFigure 9-16 \nHow to use the regular expression functions (part 2 of 2)\n\n292 \nSection 2 \nMore SQL skills cts you need them \nHow to use the ranking functions \nIf you've read chapter 6, you already know how to code aggregate window \nfunctions. In addition to those window functions, you can code non-aggregate \nwindow functions, sometimes called specialized window functions. These \nfunctions can be divided into two groups: the ranking functions you '11 learn \nabout in this figure and the analytical functions you'll learn about in the next \nfigure. \nFigure 9-17 shows how to use the four ranking functions that were intro-\nduced with MySQL 8.0. These functions provide a variety of ways for ranking \nthe 1·ows that are returned by a result set. All four of these functions have a \nsimilai· syntax and work similarly. \nThe first example shows how to use the ROW _NUMBER function. Here, \nthe SELECT statement retrieves two columns from the Vendors table. The \nfirst column uses the ROW _NUMBER function to sort the result set by the \nvendor name column and to number each row in the result set. To show that \n-\nthe first column has been sorted and numbered correctly, the second column \ndisplays the vendor name. \nTo accomplish the sorting and numbering, you code the name of the \nROW _NUMBER function, followed by a set of parentheses and an OVER \nclause. If you read chapter 6, you know that the OVER clause can include \na PARTITION BY clause and an ORDER BY clause. When you code a \nROW _NUMBER function or any of the other ranking functions, the ORDER \nBY clause is required. It specifies the sequence of the rows within each \npartition. In this example, for instance, the ORDER BY clause sorts by the \nvendor_name column in ascending sequence. \nOf course, you can code more complex ORDER BY clauses whenever that's \nnecessai-y. In addition, you can code an ORDER BY clause that applies to the \nentire result set. In that case, the ORDER BY clause within the ranking function \nis used to nu1nber the rows and the ORDER BY clause outside the ranking \nfunction is used to sort the rows after the numbering has been applied. \nThe second example shows how to use the optional PARTITION BY clause \nof a ranking function. This clause specifies a column that's used to divide \nthe result set into groups called partitions. In this example, for instance, the \nPARTITION BY clause uses the vendor_state column to group vendors by state. \nThen, the ORDER BY clause sorts these vendors by name within each state. \nYou can also use the PARTITION BY clause when a SELECT statement \njoins one or more tables like this: \nSELECT vendor_ name, invoice_ number, \nROW_ NUMBER() OVER(PARTITION BY vendor_ name \nORDER BY invoice_ number) AS 'row_ number' \nFROM vendors JOIN invoices \nON vendors.vendor_ id = invoices.vendor_ id; \nHere, the invoices will be grouped by vendor and sorted within each vendor by \ninvoice number. As a result, if a vendor has three invoices, these invoices will be \nsorted by invoice number and numbered from 1 to 3.\n\nChapter 9 \nHow to use functions \n293 \nThe syntax of the four ranking functions \nROW NUMBER ( ) \nRANK() \nDENSE_RANK ( ) \nNTILE{integer_expression) \nOVER{[partition_clause] \nOVER{[partition_clause] \nOVER{[partition_clause] \nOVER{[partition_clause] \nA query that uses the ROW_NUMBER function \norder clause) \norder_clause) \norder clause) \norder_clause) \nSELECT ROW_NUMBER{) OVER{ORDER BY vendor name) AS 'row_nwnber', \nvendor_name \nFROM vendors \nrow_number \nvendor _name \n► \n1 \nAbbey Office Furnishings \n2 \nAmerican Booksellers Assoc. \n3 \nAmerican Express \n4 \nASC Signs \ns \nAscom Hasler Mailing Systems \nA query that uses the PARTITION BY clause \nSELECT ROW_NUMBER{) OVER{PARTITION BY vendor_ state \n;I, \nL \nORDER BY vendor_ name) AS \n1 row_number 1 , vendor_name, vendor_state \nFROM vendors \nrow_number \nvendor _name \nvendor _state \n-\n► \n1 \nAT&T \nAZ. \n2 \nComputer Library \nAZ \n3 \nWells Fargo Bank \nAZ \n1 \nAbbey Office Furnishings \nCA \n2 \nAmerican ~ess \nCA \n3 \nASC Signs \nCA \nDescription \n• \nThe ROW _NUMBER, RANK, DENSE_RANK, and NTILE functions were \nintroduced with MySQL 8.0. They are sometimes referred to as ranking \nfunctions. \n• \nThe ORDER BY clause determines the sequence of the rows within the \npartitions. \n• \nThe optional PARTITION BY clause specifies the column that's used to divide \nthe result set into groups called partitions. \n• \nThe ROW _NUMBER function returns the number of the current row within its \npartition, starting at 1 for the first row in each partition. \nFigure 9-17 \nHow to use the ranking functions (part 1 of 2)\n\n294 \nSection 2 \nMore SQL skills cts you need them \nThe first example in part 2 of figure 9-17 shows how the RANK and \nDENSE_RANK functions work. You can use these functions to rank the rows in \na result set. In this example, both the RANK and the DENSE_RANK functions \nsort all invoices in the Invoices table by the invoice_total column. Since the \nfirst three rows have the same invoice total, both of these functions give these \nthree rows the same rank, 1. However, the fourth row has a different value. To \ncalculate the value for this row, the RANK function adds 1 to the total number \nof previous rows. In other words, since the frrst three rows are tied for first place, \nthe fourth row gets fourth place and is assigned a rank of 4. \nThe DENSE_RANK function, on the other hand, calculates the value for the \nfotuth row by adding 1 to the rank for the previous row. As a result, this function \nassigns a rank of 2 to the fourth row. In other words, since the first three rows are \ntied for first place, the fourth row gets second place. \nThe second example shows how the NTILE function works. You can use \nthis function to divide the rows in a pattition into the specified number of \ngroups. When the rows can be evenly divided into groups, this function is easy \nto understand. For example, if a result set returns 100 rows, you can use the \nNTILE function to divide this result set into 10 groups of 10. However, when the \nrows can't be evenly divided into groups, this function is a little more difficult to \nunderstand. \nIn this figure, for example, the NTILE function is used to divide a result set \nthat contains 5 rows. Here, the first NTILE function divides this result set into \n2 groups with the first having 3 rows and the second having 2 rows. The second \nNTILE function divides this result set into 3 groups with the first having 2 rows, \nthe second having 2 rows, and the third having 1 row. And so on. Although this \ndoesn't result in groups with even numbers of rows, the N'l'ILE function creates \nthe number of groups specified by its argument. \nIn this figure, the examples for the RANK, DENSE_RANK, and NTILE \nfunctions don't include PARTITION BY clauses. As a result, these functions \nare applied to the entire result set. However, whenever necessary, you can use \nthe PARTITION BY clause to divide the result set into groups as shown by the \nsecond example for the ROW _NUMBER function. \nAlthough it's not shown here, you should know that you can also code a \nframe clause on the OVER clause for any of the ranking ft1nctions. However, \nyou're not likely to do that. If you haven't already read chapter 6 and you want to \nlearn more about how frames work with window functions, though, you can refer \nback to that chapter.\n\nChapter 9 \nHow to use functions \n295 \nA query that uses the RANK and DENSE_RANK functions \nSELECT RANK() OVER (ORDER BY invoice_total) AS 'rank', \nDENSE_ RANK() OVER (ORDER BY invoice_total) AS 'dense_ rank', \ninvoice_total, invoice_number \n• \n• \nFROM invoices \nrank \ndense_rank \ninvoice_total \ninvolce_number \n► \n1 \n1 \n6.00 \n25022117 \n1 \n1 \n6.00 \n24863706 \n1 \n1 \n6.00 \n24780512 \n4 \n2 \n9.95 \n21-4748363 \n4 \n2 \n9.95 \n21-4923721 \nDescription \n\"\"' \n'V \n• \nThe RANK and DENSE_RANK functions both return the rank of each row within \nthe partition of a result set. \n• \nIf there is a tie, both of these functions give the same rank to all rows that are tied. \n• \nTo determjne the rank for the next distinct row, the RANK function adds 1 to the \ntotal number of rows, while the DENSE_RANK function adds 1 to the rank for the \n. \nprevious row. \nA query that uses the NTI LE function \nSELECT terms_description, \nNTILE(2) OVER (ORDER BY terms_ id) AS tile2, \nNTILE(3) OVER (ORDER BY tenns_ id) AS tile3, \nNTILE(4) OVER (ORDER BY terms id) AS tile4 \nFROM terms \nterms _description \ntile2 \nb1e3 \nble4 \n► \nNet due 10 days \n1 \n1 \n1 \nNet due 20 days \n1 \n1 \n1 \nNet due 30 days \n1 \n2 \n2 \nNet due 60 days \n2 \n2 \n3 \nNet due 90 days \n2 \n3 \n4 \n. \"\"\"= \nDescription \n• \nThe NTILE function divides the rows in a partition into the specified number of \ngroups and returns the group number of each row. \n• \nIf the rows can't be evenly divided into groups, the later groups may have one less \nrow than the earlier groups. \nFigure 9-17 \nHow to use the ranking functions (part 2 of 2)\n\n296 \nSection 2 \nMore SQL skills cts you need them \nHow to use the analytic functions \nFigure 9-18 shows how to use the analytic fun.ctions that were introduced \nwith MySQL 8.0. These functions let you perform calculations on ordered sets \nof data. Note that all of the examples in this figure use the Sales_Reps and \nSales_Totals tables in the EX database. These tables are related by the rep_id \ncolumn in each table. \nThe FIRST_ VALUE, LAST_ VALUE, and NTH_ VALUE functions let you \nreturn the frrst, last, and nth values in an ordered set of values. The fu·st example \nuses these functions to return the name of the sales rep with the highest, second \nhighest, and lowest sales for each year. To do that, the OVER clause is used to \ngroup the result set by year and sort the rows within each year by sales total in \ndescending sequence. Then, the expression that's specified for the functions \ncauses the name for the first, second, and last rep within each year to be \nreturned. \nWhen you code the NTH_V ALUE function, you include a numeric literal \nas the second argument of the function to indicate which row you want to \nretrieve the value from. In this example, the value is returned from the second \nrow in the partition. To return this value for all rows in the partition, you have to \ninclude the RANGE clause as shown here. If you don't include this cla11se, the \nNTH_ VALUE function returns NULL for all rows before the nth row. In this \nfigure, for exrunple, the NTH_ VALUE function would return NULL for the first \nrow for each year, but it would return the second highest sales for the second \nrow and all following rows. \nYou also have to include the RANGE clause for the LAST_ VALUE function \nto return the value you want. If you don't include this clause, the LAST_ VALUE \nfunction will return the last value fo1· each group specified by the ORDER BY \nclause. In this case, that means that the function would return the last rep name \nfor each sales total. Since all of the sales totals are different, though, the function \nwould simply return the name of the rep in each row, which isn't what you want. \nSo, if you sorted the result set by a column that contains duplicate values, you \nwould typically include the RANGE clause but not the PARTITION BY clause. \nInstead of the RANGE clause, yo11 can code a ROWS clause on a \nFIRST_ VALUE, LAST_ VALUE, or NTH_ VALUE function. This clause lets \nyou specify the rows to include relative to the current row. If you haven't already \nread chapter 6, you can refer to that chapter to learn how to code the ROWS and \nRANGE clauses.\n\nChapter 9 \nHow to use functions \n297 \nThe syntax of the analytic functions \n{FIRST_VALUEILAST_ VALUEINTH_VALUE}(scalar_expression[, numeric_ literal]) \nOVER ([partition_clause) order_clause [frame_ clause)) \n{LEADILAG}{scalar_expression [, offset [, default]]) \nOVER ([partition_clause) order_clause) \n{PERCENT_RANK() ICUME_DIST()} OVER ([partition_clause] order_ clause) \nThe columns in the Sales_Reps and Sales_Totals tables \nColumn name \nData type \nColumn name \nData type \nrep_id \nrep_first_name \nrep_last_name \nINT \nVARCHAR(50) \nVARCHAR(50) \nrep_1d \nsales_year \nsales_total \nINT \nYEAR \nDECIMAL(9,2) \nA query that uses the FIRST_VALUE, NTH_VALUE, and \nLAST VALUE functions \nSELECT sales__year, CONCAT(rep_ first_name, ' ', rep_ last_ name) AS rep_name, \nsales_total, \nFIRST_VALUE(CONCAT(rep_ first_ name, \nI \n', rep_ last_ name)) \nOVER (PARTITION BY sales__year ORDER BY sales_total DESC) \nAS highest_ sales, \nNTH_VALUE(CONCAT(rep_ first_namA, ' ', rep_ last_~arne), 2) \nOVER (PARTITION BY sales__year ORDER BY sales_total DESC \nRANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) \nAS second_highest_ sales, \nLAST_VALUE(CONCAT(rep_ first_ name, ' ', rep_ last_name)) \nOVER (PARTITION BY sales__year ORDER BY sales_total DESC \nRANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) \nAS lowest sales \nFROM sales totals JOIN sales_ reps ON sales_totals.rep_ id = sales_ reps.rep_ id \nsales_year \nrep_name \nsales_total \nhighest_sales \nsecond _highes t_sales \nlowest_sales \n► \n2016 \nJonathon lhomas \n1274856.38 \nJonathon Thomas \nAndrew Markasian \nSonja Martinez \n2016 \nAndrew Markasian \n1032875.48 \nJonathon lhomas \nAndrew Markasian \nSonja Martinez \n2016 \nSonja Martinez \n978'165.99 \nJonathon lhomas \nAndrew Markasian \nSonja Martinez \n2017 \nAndrewMarkasian \n1132744.56 \nAndrew Markasian \nSonja Martinez \nLydia Kramer \n2017 \nSonja Martinez \n974853.81 \nAndrew Markaslan \nSonja Martinez \nLydia Kramer \n2017 \nJonathon Thomas \n9237'16.85 \nAndrew Markasian \nSonja Martinez \nL ydla Kramer \n2017 \nPhillip Winters \n655786.92 \nAndrew Markasian \nSonja Martinez \nLydia Kramer \n2017 \nLydia Kramer \n422847,86 \nAndrew Markasian \nSonja Martinez \nLydia Kramer \n2018 \nJonathon Thomas \n998337.46 \nJonathon Thomas \nSonja Martinez \nLydia Kramer \n2018 \nSonja Martinez \n887695.75 \nJonathon Thomas \nSonja Martinez \nLydia Kr-amer \n2018 \nPhiffip Winters \nn443.37 \nJonathon lhomas \nSonja Martinez \nLydia Kramer \n2018 \nLydia Kramer \n45182.44 \nJonathon lhomas \nSonja Martinez \nLydia Kramer \nDescription \n• \nThe FIRST_ VALUE, LAST_ VALUE, NTH VALUE, LEAD, LAG, PERCENT_RANK, \nand CUME_DIST functions are sometimes referred to as analytic functions. They were \nintroduced with MySQL 8.0. \n• \nThe FIRST_ VALUE, LAST_VALUE, and NTH_ VALUE functions return the first, \nlast, and nth value in a sorted set of values. When you use the PARTITION BY \nclause with LAST_ VALUE or NTH_VALUE, you typically include the ROWS or \nRANGE clause as well to defme a subset of the current partition. \nFigure 9-18 \nHow to use the analytic functions (part 1 of 2)\n\n298 \nSection 2 \nMore SQL skills cts you need them \nThe LEAD and LAG functions let you refer to values in other rows of the \nresult set. The LAG function is illustrated by the first exa1nple in part 2 of figure \n9-18. Here, the OVER clause is used to group the result set by the rep_id column \nand sort it by the sales_year column. Then, the LAG function in the fourth \ncolumn gets the sales total from one row prior to the current row (the offset). \nSince the rows are sorted by year for each sales rep, that means that the function \nretrieves the sales rep's sales for the previous year. The ftfth column uses the \nsame function, but it subtracts the result of this function from the current sales to \nshow the change in sales from the previous year. The LEAD function is similar, \nbut it lets you refer to values in fo]Jowing rows rather than previous rows. \nNotice that the value of the LAG function for the first row for each sales rep \nis 0.00. That's because there isn't a row for the prior year. By default, this value \nis null. Because I wanted to calculate the change for each row in the result set, \nthough, I used the third argument of the LAG function to set the default to 0. \nThe second example shows how to use the PERCENT _RANK and \nCUME_DIST functions. Both of these functions groups the rows by year and \nsorts them by sales total in ascending sequence. \nThe PERCENT _RANK function calculates a percent that indicates the \nrank of each row within a partition. The result of this function is always a value \nbetween O and 1. If you study the results in this example, you shouldn' t have any \ntrouble understanding bow this function works. \nThe CUME_DIST function is similar, but it calculates the percent of values \nthat are less than or equal to the current value. This function represents the \ncumulative distribution of the values. The cumulative distribution is calculated \nby dividing the number of rows with the current value or a lower value by the \ntotal number of rows in the partition.\n\nChapter 9 \nHow to use functions \n299 \nA query that uses the LAG function \nSELECT rep_id, sales_year, sales_total AS current_ sales, \nLAG(sales_total, 1, 0) OVER (PARTITION BY rep_ id ORDER BY sales_year) \nAS last_ sales, \nsales_total - LAG(sales_total, 1, 0) \nOVER (PARTITION BY rep_id ORDER BY sales_year) AS 'change' \nFROM sales totals \nrepjd \nsales_year \ncurrent_sales \nlast_sales \nchange \n► \n1 \n2016 \n127-18 56. 38 \n0.00 \n127-1856. 38 \n1 \n2017 \n9237'16.85 \n1274856.38 \n-351109.53 \n1 \n2018 \n998337.'16 \n923746.85 \n74590.61 \n2 \n2016 \n978465.99 \n0.00 \n978'165.99 \n2. \n2017 \n97-1853.81 \n978465.99 \n-3612. 18 \n2 \n2018 \n887695.75 \n97'1853.81 \n-87158.06 \n'\"'= \n,,., \n- . \n.., \nA query that uses the PERCENT_RANK and CUME_DIST functions \nSELECT sales_year, rep_ id, sales_total, \nPERCENT_RANK() OVER (PARTITION BY sales_year ORDER BY sales_total) \nAS pct_ rank, \nCUME_DIST ( ) OVE.R ( PARTITION BY sales_year ORDER BY sales total) \nAS 'cume_dist' \nFROM sales_totals \nsales_year \nrep_ld \nsales_total \npct_rank \na.une_dist \n► \n2016 \n2 \n978465.99 \n0 \n0.3333333333333333 \n2016 \n3 \n1032875.'iS \n0.5 \no. --- -- -- ·---\n2016 \n1 \n127'18 56. 38 \n1 \n1 \n2017 \n5 \n422847.86 \n0 \n0.2 \n2017 \n4 \n655786.92 \n0.25 \n0.4 \n2017 \nl \n923746.85 \n0.5 \n0.6 \n2017 \n2 \n974853.81 \n0.75 \n0.8 \n2017 \n3 \n1132.744.56 \n1 \n1 \n2018 \ns \n45182.44 \n0 \n0.25 \n2018 \n4 \n72443.37 \n0.3333333333333333 \n0.5 \n2018 \n2 \n887695.75 \n0.6666666666666666 \n0.75 \n2018 \n1 \n998337.46 \n1 \n1 \nDescription \n• \nThe LEAD function retrieves data from a following row in a result set, and the \nLAG function retrieves data from a previous row in a result set. \n• \nThe PERCENT _RANK function calculates the rank of the values in a sorted set of \nvalues as a percent. The CUME_DIST ft1nction calculates the percent of the values \nin a sorted set of values that are less than or equal to the current value. \nFigure 9-18 \nHow to use the analytic functions (part 2 of 2) \n: \n' \nl \nl \nl \n'\n\n300 \nSection 2 \nMore SQL skills cts you need them \nPerspective \nIn this chapter, you learned about the different functions that you can use \nto operate on M ySQL data. At this point, you have all of the skills you need to \ndevelop SQL code at a professional level. \nHowever, there's a lot more to learn about MySQL. In the next section of \nthis book, then, you'll learn the basic skills for designing a database. Even if you \nnever need to design your own database, understanding this material will help \nyou work more efficiently with databases that have been designed by others. \nTerms \nstring pattern \nregular expression \nregular expression functions \nspecialized window functions \nranking functions \npartition \nanalytic functions \ncumulative distribution \nExercises \n1. \nWrite a SELECT staten1ent that returns these columns from the Invoices table: \nThe invoice total column \nA column that uses the ROUND function to return the invoice total \ncolumn with 1 decimal digit \nA column that uses the ROUND function to return the invoice_total \ncolumn with no decimal digits \nA column that uses the TRUNCATE function to return the invoice_total \ncolumn with no decimal digits \n2. \nWrite a SELECT statement that returns these columns from the Date_Sample \ntable in the EX database: \nThe start_date column \nA column that uses the DATE_FORMAT function to return the start_date \ncolumn with its month name abbreviated and its month, day, and two-digit \nyear separated by slashes \nA column that uses the DATE FORMAT function to return the start date \n-\n-\ncolumn with its month and day returned as integers with no leading zeros, a \ntwo-digit year, and all date parts separated by slashes \nA column that uses the DATE_FORMAT function to return the start_date \ncolumn with only the hours and minutes on a 12-hour clock with an am/pm \nindicator\n\nChapter 9 \nHow to use functions \n301 \n3. \nWrite a SELECT statement that returns these columns from the Vendors table: \nThe vendor name column \nThe vendor_name column in all capital letters \nThe vendor_phone column \nA column that displays the last four digits of each phone number \nWhen you get that working right, add the columns that follow to the result set. \nThis is more difficult because these columns require the use of functions within \nfunctions. \nThe vendor_phone column with the parts of the number separated by dots, \nas in 555.555.5555 \nA column that displays the second word in each vendor name if there is one \nand blanks if there isn't \n4. \nWrite a SELECT statement that retUI·ns these columns from the Invoices table: \nThe invoice number column \n-\nThe invoice date column \nThe invoice_date column plus 30 days \nThe payment_date column \nA colt1mn named days_to_pay that shows the number of days between the \ninvoice date and the payment date \nThe number of the invoice date's month \nThe four-digit year of the invoice date \nWhen you have this working, add a WHERE clause that retrieves just the \ninvoices for the month of May based on the invoice date, not the number of \nthe invoice month. \n5. \nWrite a SELECT statement that returns these columns from the String_Sample \ntable of the EX database: \nThe emp_name column \nA column that displays each employee's first name \nA column that displays each employee's last name \nUse regular expression functions to get the first and last name. If a name \ncontains three parts, everything after the first part should be considered part of \nthe last name. Be sure to provide for last names with hypens and apostrophes. \nHint: To include an apostrophe in a pattern, you can code a\\ in front of it or \nyou can enclose the pattern in double quotes. \n6. \nWrite a SELECT statement that returns these columns from the Invoice table \nof the AP database: \nThe invoice number column \n-\nThe balance due for each invoice with a balance due greater than zero \nA column that uses the RANK() function to rank the balance due in \ndescending sequence\n\nDatabase design \nand implementation \nFor large applications, a developer who specializes in database design \nmay be responsible for designing and creating the databases that are \nused by production applications. This developer may also be responsible \nfor designing and creating the databases that are used for testing those \napplications. Then, a database administrator (DBA) may be responsible for \nmaintaining these databases. For smaller applications, programmers are \noften asked to fill one or both of these roles. In other words, programmers \noften need to design, create, and maintain the databases that are used for \ntesting and production. \nSo, whether you 're a database designer, a database administrator, or \na SQL programmer, you need the skills and knowledge presented in this \nsection. That's true even if you aren't ever called upon to design, create, or \nmaintain a database. By understanding what's going on behind the scenes, \nyou'll be able to use SQL more effectively. \nIn chapter 10, you'll learn how to design a database. In chapter 11, \nyou'll learn how to use the Data Definition Language (DDL) statements to \ncreate and maintain databases, tables, and indexes. Finally, in chapter 12, \nyou '11 leam how to create and maintain views, which are database objects \nthat provide another way to look at tables.\n\nHow to design a database \nIn this chapter, you'll learn how to design a new database. This is useful \ninformation whether or not you ever design a database on your own. To illus-\ntrate this process, I'll use the accounts payable (AP) database that you've seen \nthroughout this book. \nHow to design a data structure ......................................... 306 \nThe basic steps for designing a data structure ............................................ 306 \nHow to identify the data elements .............................................................. 308 \nHow to subdivide the data elements ............................................................ 310 \nHow to identify the tables and assign columns ........................................... 312 \nHow to identify the primary and foreign keys ............................................ 314 \nHow to enforce the relationships between tables ........................................ 316 \nHow nor1nal·ization works ........................................................................... 318 \nHow to identify the columns to be indexed ................................................. 320 \nHow to normalize a data structure .................................... 322 \nThe seven normal forms .............................................................................. 322 \nHow to apply the first normal form ............................................................. 324 \nHow to apply the second normal form ........................................................ 326 \nHow to apply the third normal form ............................................................ 328 \nWhen and how to denormalize a data structure .......................................... 330 \nHow to use MySQL Workbench for database design ..... 332 \nHow to open an existing EER model. .......................................................... 332 \nHow to create a new EER model ................................................................. 332 \nHow to work with an EER model ................................................................ 334 \nHow to work with an EER diagram ............................................................ 336 \nPerspective ......................................................................... 338\n\n306 \nSection 3 \nDatabase design and impleme11,tation, \nHow to design a data structure \nDatabases are often designed by database administrators (DBAs) or design \nspecialists. This is especially true for large, multiuser databases. How well this \nis done can directly affect your job as a MySQL programmer. In general, a \nwell-designed database is easy to understand and query, while a poorly designed \ndatabase is difficult to work with. In fact, when you work with a poorly designed \ndatabase, you will often need to figure out how it is designed before you can \ncode your queries appropriately. \nThe topics that follow present a basic approach for designing a data struc·-\nture. We use that term to refer to a model of the database rather than the database \nitself. Once you design the data structure, you can use the techniques presented \nin the next two chapters to create a database with that design. By unde1·standing \nthe right way to design a database, you'll work more effectively as a MySQL \nprogrammer. \nThe basic steps for designing a data structure \nIn many cases, you can design a data structure based on an existing \nreal-world system. The illustration at the top of figure 10-1 presents a conceptual \nview of how this works. Here, you can see that all of the information about the \npeople, documents, and facilities within a real-world system is mapped to the \ntables, columns, and rows of a database system. \nAs you design a data structure, each table represents one object, or entity, in \nthe real-world system. Then, within each table, each column stores one item of \ninformation, or attribute, for the entity, and each row stores one occurrence, or \ninstance, of the entity. \nThis figure also presents the six steps you can follow to design a data \nstructure. You'll learn more about each of these steps in the topics that follow. In \ngeneral, though, step 1 is to identify all the data elements that need to be stored \nin the database. Step 2 is to break complex elements down into smaller compo-\nnents whenever that makes sense. Step 3 is to identify the tables that will make \nup the system and to determine which data elements are assigned as columns in \neach table. Step 4 is to define the relationships between the tables by identifying \nthe primary and foreign keys. Step 5 is to normalize the database to reduce data \nredt1ndancy. And step 6 is to identify the indexes that are needed for each table. \nTo model a database system after a real-world system, you can use a \ntechnique called entity-relationship (ER) modeling. Because this is a complex \nsubject of its own, I won't present it in this book. However, I have applied some \nof the basic elements of this technique to the design diagrams presented in this \nchapter. In effect, then, you' 11 be learning so1ne of the basics of this modeling \ntechnique.\n\nChapter 10 \nHovv to design a database \n307 \nA database system is modeled after a real-world system \nReal-world system \nDatabase system \nPeople \nFacilities \nDocuments \nOther \nsystems \nColumns \n--=.,......■ \n; ■••· \n~--·· \n·••r-\n·-· \n--\nThe six basic steps for designing a data structure \nStep 1: \nStep 2: \nStep 3: \nStep 4: \nStep 5: \nStep 6: \nDescription \nIdentify the data elements \nSubdivide each element into its smallest useful components \nIdentify the tables and assign column.s \nIdentify the primary and foreign keys \nReview whether the data structure is normalized \nIdentify the indexes \n• \nA relational database system should model the real-world environment where it's \nused. The job of the designer is to analyze the real-world system and then map it \nonto a relational database system. \n• \nA table in a relational database typically represents an object, or entity, in the real \nworld. Each column of a table is used to store an attribute associated with the \nentity, and each row represents one instance of the entity. \n• \nTo model a database and the relationships between its tables after a real-world \nsystem, you can use a technique called entity-relationship (ER) modeling. Some of \nthe diagrams you'll see in this chapter apply the basic elements of ER modeling. \nFigure 10-1 \nThe basic steps for designing a data structure\n\n308 \nSection 3 \nDatabase design and impleme11,tation, \nHow to identify the data elements \nThe first step for designing a data structure is to identify the data elements \nrequired by the system. You can use several techniques to do that, including \nanalyzing the existing system if there is one, evaluating comparable systems, and \ninterviewing anyone who will be using the system. One particularly good source \nof information is the documents used by an existing system. \nIn figure 10-2, for example, you can see an invoice that's used by an \naccounts payable system. We'll use this document as the main source of infor-\nmation for the database design presented in this chapte1·. Keep in mind, though, \nthat you'll want to use all available resources when you design your own \ndatabase. \nIf you study this document, you' 11 notice that it contains information about \nthree different entities: vendors, invoices, and line items. First, the form itself \nhas preprinted info1mation about the vendor who issued the invoice, such as the \nvendor's name and address. If this vendor were to issue another invoice, this \ninformation wouldn't change. \nThis document also contains specific information about the invoice. Some \nof this information, such as the invoice number, invoice date, and invoice total, \nis general in nature. Although the actL1al information will vary from one invoice \nto the next, each invoice will include this information. In addition to this general \ninformation, each invoice includes information about the items that were \npurchased. Although each line item contains similar information, each invoice \ncan contain a different number of line items. \nOne of the things you need to consider as you review a document like this \nis how much information your system needs to track. For an accounts payable \nsystem, for example, you may not need to store detailed data such as the infor-\nmation about each line item. Instead, you may just need to store summary data \nlike the invoice total. As you think about what data elements to include in the \ndatabase, then, you should have an idea of what information you'll need to get \nback out of the system.\n\nChapter 10 \nHovv to design a database \n309 \nAn invoice that can be used to identify data elements \nAcme Fabrication, Inc. \nCustotn Contraptions, Contrivances and Confa!Ju/ations \nInvoice Number: \nIOl- 1088 \n1234 West Industrial Way East Los Angeles California 90022 \nInvoice Date: \n10/05/18 \n800.555.1212 \nfax 562.555.1213 \nwww. acmef abrication. com Terms: \nNet 30 \nPart No. \nQty. \nCUST345 \n12 \n457332 \n7 \n50173 \n4375 \n328771 \n2 \nCUST281 \n7 \nCUST917 \n2 \nYour salesperson: \nAccounts receivable: \nDescription \nDesign service , hr \nBaling wire , 25x3ft roll \nDuct tape , black, yd \nRubber tubing , 100ft roll \nAssembl y , hr \nTesting, hr \nSales Tax \nRuben Goldberg, e xt 4512 \nInigo Jones , e xt 4901 \nUnit Price \n100 . 00 \n79 . 90 \n1 . 09 \n4 . 79 \n75 . 00 \n125 . 00 \nExtension \n1200 . 00 \n559 . 30 \n4768 . 75 \n9 . 58 \n525 . 00 \n250 . 00 \n245 . 20 \n$7 , 557 . 83 \nPLEASE PAY THIS AMOUNT \nThanlcs for your b1,1si11ess ! \nThe data elements identified on the invoice document \nVendor name \nVendor address \nVendor phone number \nVendor fax number \nVendor web address \nInvoice number \nDescription \nInvoice date \nInvoice terms \nItem part number \nItem quantity \nItem description \nItem unit price \nItem extension \nVendor sales contact name \nVendor sales contact extension \nVendor AR contact name \nVendor AR contact extension \nInvoice total \n• \nDepending on the nature of the system, you can identify data elements in a variety \nof ways, including interviewing users, analyzing existing systems, and evaluating \ncomparable systems. \n• \nThe documents used by a real-world system, such as the invoice shown above, can \noften help you identify the data elements of the system. \n• \nAs you identify the data elements of a system, you should begin thinking about \nthe entities that those elements are associated with. That will help you identify the \ntables of the database later on. \nFigure 10-2 \nHow to identify the data elements\n\n310 \nSection 3 \nDatabase design and impleme11,tation, \nHow to subdivide the data elements \nSome of the data elements you identify in step 1 of the design procedt1re will \nconsist of multiple components. The next step, then, is to divide these elements \ninto their smallest useful values. Figure 10-3 shows how you can do that. \nThe first example in this figure shows how you can divide the name of the \nsales contact for a vendor. Here, the name is divided into two elements: a first \nname and a last name. When you divide a name like this, you can easily perform \noperations like sorting by last name and using the first name in a salutation, such \nas ''Dear Ruben.\" In contrast, if the full name is stored in a single column, you \nhave to use the string functions to extract the component you need. But as you \nlearned in the last chapter, that can lead to inefficient and complicated code. In \ngeneral, then, you should separate a name like this whenever you'll need to use \nthe name components sepai·ately. Later, when you need to use the full name, you \ncan concatenate the first and last names. \nThe second example shows how you typically divide an address. Notice \nin this example that the street number and street name are stored in a single \ncolumn. Although you could store these components in separate columns, that \nusually doesn't make sense since these values are typically used together. That's \nwhat I mean when I say that the data elements should be divided into their \nsmallest useful values. \nWith that guideline in mind, you 1night even need to divide a single string \ninto two or more components. A bulk mail system, for example, might require a \nseparate column for the first three digits of the zip code. And a telephone number \ncould require as many as four columns: one for the area code, one for the \nthree-digit prefix, one for the four-digit number, and one for the extension. \nAs in the previous step, knowledge of the real-world system and of the \ninformation that will be extracted from the database is critical. In some circum-\nstances, it may be okay to store data elements with multiple components in a \nsingle column. That can simplify your design and reduce the overall number of \ncolumns. In general, though, most designers divide data elements as much as \npossible. That way, it's easy to accommodate almost any query, and you don't \nhave to change the database design later on when you realize that you need to \nuse just part of a column value.\n\nChapter 10 \nHovv to design a database \n311 \nA name that's divided into first and last names \nVendor sales contact name \nRuben Goldberg \nVendor sales contact first name \nVendor sales contact last name \nRuben \nGoldberg \nAn address that's divided into street address, city, state, and zip code \nVendor address \n1234 West Industrial Way, East Los Angeles, California 90022 \nStreet and number \nCity \nState \nZip \n1234 West Industrial Way \nEast Los Angeles \nCalifornia \n90022 \nDescription \n• \nIf a data element contains two or more components, you should consider subdi-\nviding the element into those components. That way, you won't need to parse the \nelement each time you use it. \n• \nThe extent to which you subdivide a data element depends on how it will be used. \nBecause it's difficult to predict all future uses for the data, most designers subdivide \ndata elements as much as possible. \n• \nWhen you subdivide a data ele1nent, you can easily rebuild it when necessary by \nconcatenating the individt1al components. \nFigure 10-3 \nHow to subdivide the data elements\n\n312 \nSection 3 \nDatabase design and impleme11,tation, \nHow to identify the tables and assign columns \nFigure 10-4 presents the three main entities for the accounts payable system \nand lists the possible data elements that can be associated with each one. In \nmost cases, you'll recognize the main entities that need to be included in a data \nstructure as you identify the data elements. As I reviewed the data elements \nrepresented on the invoice document in figure 10-2, for example, I identified \nthe three entities shown in this figure: vendors, invoices, and invoice line items. \nAlthough you may identify additional entities later on in the design process, it's \nsufficient to identity the main entities at this point. These entities will become \nthe tables of the database. \nAfter you identify the main entities, you need to determine which data \nelements are associated with each entity. These elements will become the \ncolumns of the tables. In many cases, the associations are obvious. For example, \nit's easy to determine that the vendor name and address are associated with the \nvendors entity and the invoice date and invoice total are associated with the \ninvoices entity. Some associations, however, aren't so obvious. In that case, you \nmay need to list a data element under two or more entities. In this figure, for \nexample, you can see that the invoice number is included in both the invoices \nand invoice line items entities and the account number is included in all three \nentities. Later, when you normalize the data structure, you may be able to \nremove these repeated elements. For now, though, it's okay to include them. \nBefore I go on, I want to point out the notation I used in this figure. To start, \nany data elements I included that weren't identified in previous steps are shown \nin italics. Although you should be able to identify most of the data elements in \nthe first two steps of the design process, you'll occasionally think of additional \nelements during the third step. In this case, since the initial list of data elements \nwas based on a single document, I added several data elements to this list. \nSimilar·ly, you may decide during this step that you don't need some of the \ndata elements you've identified. For example, I decided that I didn't need the fax \nnumber or web address of each vendor. So I used the strikethrough feature of my \nword processor to indicate that these data elements should not be included. \nFinally, I identifie.d the data elements that are included in two or more tables \nby coding an asterisk after them. Although you can use any notation you like for \nthis step of the design process, you'll want to be sure that you document your \ndesign decisions. For a complicated. design, you will probably want to use a \nCASE ( computer-aided software engineering) tool. \nBy the way, a couple of the new data elements I added may not be clear to \nyou if you haven't worked with a corporate accounts payable system before. \n''Terms'' refers to the payment terms that the ve11dor offers. For example, the \nterms might be net 30 (the invoice must be paid in 30 days) or might include \na discount for early payment. ''Account number'' refers to tl1e general ledger \naccounts that a company uses to track its expenses. For example, one account \nnumber might be assigned for advertising expenses, while another might be for \noffice supplies. Each invoice that's paid is assigned to an account, and in some \ncases, different line items on an invoice are assigned to different accounts.\n\nChapter 10 \nHovv to design a database \n313 \nPossible tables and columns for an accounts payable system \nVendors \nInvoices \nInvoice line items \nVendor name \nVendor address \nVendor city \nVendor state \nVendor zip code \nVendor phone number \nVendor fax nutuber \nVendor web address \nVendor contact first name \nVendor contact last name \n'Vendor contact phone \nVendor AR first name \nVendor AR last name \nVendor AR phone \nTerms* \nAccount number* \nDescription \nInvoice number* \nInvoice number* \nInvoice date \nItem part number \nTerms* \nItem quantity \nInvoice total \nItem description \nPayment date \nItem unit price \nPaymerit total \nItem extension \nInvoice due date \nAccoun.t nu,nber* \nCredit total \nSequence number \nAccoi,nt number* \n• \nAfter you identify and subdivide all of the data elements for a database, you should \ngroup them by the entities with which they're associated. These entities will later \nbecome the tables of the database, and the elements will become the columns. \n• \nIf a data element relates to more than one entity, you can include it under all of the \nentities it relates to. Then, when you normalize the database, you may be able to \nremove the duplicate elements. \n• \nAs you assign the elements to entities, you should omit elements that aren't needed, \nand you should add any additional elements that are needed. \nThe notation used in this figure \n• \nData elements that were previously identified but aren't needed are crossed out. \n• \nData elements that were added are displayed in italics. \n• \nData elements that are related to two or more entities are followed by an asterisk. \n• \nYou can use a similar notation or develop one of your own. You can also use a \nCASE ( computer-aided software engineering) tool if one is available to you. \nFigure 10-4 \nHow to identify the tables and assign columns\n\n314 \nSection 3 \nDatabase design and impleme11,tation, \nHow to identify the primary and foreign keys \nOnce you identify the entities and data elements of a system, the next step is \nto identify the relationships between the tables. To do that, you need to identify \nthe primary and foreign keys as shown in figure 10-5. \nAs you know, a primary key is used to uniquely identify each row in a table. \nIn some cases, you can use an existing column as the primary key. For example, \nyou might consider using the vendor_name column as the primary key of the \nVendors table. Because the values for this column can be long, however, and \nbecause it would be easy to enter a value like that incorrectly, that's not a good \ncandidate for a primary key. Instead, you should use an ID column like \nvendor_id that's incremented by one for each new row. \nSimilarly, you 1night consider using the invoice_number column as the \nprimary key of the Invoices table. However, it's possible for different vendors to \nuse the same invoice number, so this value isn't necessarily unique. Becat1se of \nthat, another ID column like invoice_id can be used as the primary key. \nTo uniquely identify the rows in the Invoice_Line_Items table, this design \nuses a composite key. This composite key uses two columns to identify each \nrow. The first column is the invoice_id column from the Invoices table, and \nthe second column is the invoice_sequence column. This is necessary because \nthis table may contain more than one row (line item) for each invoice. And that \nmeans that the invoice_id value by itself may not be unique. \nAfter you identify the primary key of each table, you need to identify the \nrelationships between the tables and add foreign key columns as necessary. In \nmost cases, two tables will have a one-to-many relationship with each other. For \nexample, each vendor can have many invoices, and each invoice can have many \nline items. To identify the vendor that each invoice is associated with, a \nvendor_id column is included in the Invoices table. Because the \nInvoice_Line_Items table already contains an invoice_id column, it's not neces-\nsary to add another column to this table. \nThe diagram at the top of this figure illustrates the relationships I identified \nbetween the tables in the accounts payable system. As you can see, the primary \nkeys are displayed in bold. Then, the lines between the tables indicate how the \nprimary key in one table is related to the foreign key in another table. Here, \na small, round connector indicates the ''one'' side of the relationship, and the \ntriangular connector indicates the ''many'' side of the relationship. \nIn addition to the one-to-many relationships shown in this diagram, you \ncan also use many-to-many relationships and one-to-one relationships. The \nsecond diagram in this figure, for example, shows a many-to-many relation-\nship between an Employees table and a Committees table. As you can see, this \ntype of relationship can be implemented by creating a linking table, also called \na connecting table or an associate table. This table contains the primary key \ncolumns from the two tables. Then, each table has a one-to-many relationship \nwith the linking table. Notice that the linking table doesn't have its own primary \nkey. Because this table doesn't correspond to an entity and because it's used only \nin conjunction with the Employees and Committees tables, a primary key isn't \nneeded.\n\nChapter 10 \nHovv to design a database \n315 \nThe relationships between the tables in the accounts payable system \nvendors \n• \n• \n1nvo1ces \ninvoice line items \n-\n-\nvendor id \ninvoice id \n••----\n◄ invoice id \n-\n-\n-\nvendor name \n-\nvendor address \n-\nvendor_ city \nvendor state \n-\nvendor_zip_code \nvendor_phone \nvendor contact first name \n-\n-\n-\nvendor contact last name \n-\n-\n-\nterms \naccount no \n-\ni.-..a vendor id \n-\ninvoice number \n-\ninvoice date \n-\ninvoice total \n-\npayment_total \ncredit total \n-\nterms \ninvoice due date \n-\n-\npayment_date \naccount no \n-\nTwo tables with a many-to-many relationship \nemployees \nmemberships \ncommittees \n. \n. \n1nvo1ce_sequence \naccount no \n-\nline _item_ description \nitem_quantity \nitem_ unit_price \nline item amount \n-\n-\nemployee_id ••----\n◄ employee_id \nfirst name \ncommittee id \ncommittee id \ncommittee name \n-\n-\n-\nlast name \n-\nLinking table \nTwo tables with a one-to-one relationship \nemployees \nemployee _photos \nemployee_id ••--• employee_id \nfirst_name \nemployee_photo \nlast name \n-\nDescription \n• \nEach table should have a primary key that uniquely identifies each row. If possible, \nyou should use an existing column for the primary key. \n• \nThe values of the primary keys should seldom, if ever, change. The values should \nalso be short and easy to enter correctly. \n• If a suitable column doesn't exist for a p1imary key, you can create an ID column \nthat is incremented by one for each new row as the primary key. \n• If two tables have a one-to-many relationship, you may need to add a foreign key \ncolumn to the table on the ''many'' side. The foreign key column must have the \nsame data type as the primary key colum11 it's related to. \n• If two tables have a many-to-many relationship, you'll need to define a linking \ntable to relate them. Then, each of the tables in the many-to-many relationship will \nhave a one-to-many relationship with the linking table. The linking table doesn't \nusually have a primary key. \n• \nIf two tables have a one-to-one relationship, they should be related by their primary \nkeys. This type of relationship is typically used to improve performance. Then, \ncolumns with large amounts of data can be stored in a separate table. \nFigure 10-5 \nHow to identify the primary and foreign keys\n\n316 \nSection 3 \nDatabase design and impleme11,tation, \nThe third example in figure 10-5 illustrates two tables that have a one-to-one \nrelationship. With this type of relationship, both tables have the same primary \nkey, which 1neans that the information could be stored in a single table. This \ntype of relationship is often used when a table contains one or more columns \nwith large amounts of data. In this case, the Employee_Photos table contains a \nlarge binary column with a photo of each employee. Because this column is used \ninfrequently, storing it in a separate table will make operations on the Employees \ntable more efficient. Then, when this column is needed, it can be combined with \nthe columns in the Employees table using a join. \nHow to enforce the relationships between tables \nAlthough the primary keys and foreign keys indicate how the tables in a \ndatabase are related, the database management system doesn't always enforce \nthose relationships automatically. In that case, any of the operations shown in the \ntable at the top of figure 10-6 would violate the referential integrity of the tables. \nIf you deleted a row from a primary key table, for example, and the foreign key \ntable included rows related to that primary key, the referential integrity of the \ntwo tables would be destroyed. In that case, the rows in the foreign key table \nthat no longer have a related row in the primary key table would be orphaned. \nSimilar problems can occur when you insert a row into the foreign key table or \nupdate a pri1nary key or foreign key value. \nTo enforce those relationships and maintain the referential integrity of the \ntables, MySQL provides for declarative referential integrity. To use it, you \ndefine foreign key constraints that indicate how the referential integrity between \nthe tables is enforced. You'll learn more about defining foreign key constraints i11 \nthe next chapter. For now, just realize that these constraints can prevent all of the \noperations listed in this figure that violate referential integrity.\n\nChapter 10 \nHovv to design a database \n317 \nOperations that can violate referential integrity \nThis operation... \nViolates referential integrity if ... \nDelete a row from the primary key table \nThe foreign key table contains one or more rows \nrelated to the deleted row \nInsert a row in the foreign key table \nThe foreign key value doesn't have a matching \nprimary key value in the related table \nUpdate the value of a foreign key \nThe new foreign key value doesn't have a matching \nprimary key value in the related table \nUpdate the value of a primary key \nThe foreign key table contains one or more rows \nrelated to the row that's changed \nDescription \n• \nReferential integrity means that the relationships between tables are maintained \ncorrectly. That means that a table with a foreign key doesn't have rows with foreign \nkey values that don't have matching primary key values in the related table. \n• \nIn MySQL, you can enforce referential integrity by using declarative referential \nintegrity. \n• \nTo use declarative t·eferential integrity (DRI), you define foreign key constraints. \nYou'll learn how to do that in the next chapter. \n• \nWhen you define foreign key constraints, you can specify how referential integrity \nis enforced when a row is deleted from the primary key table. The options are \nto return an error, to delete the related rows in the foreign key table, or to set the \nforeign key values in the related rows to null. \n• \nIf referential integrity isn't enforced and a row is deleted from the primary key \ntable that has related rows in the foreign key table, the rows in the foreign key table \nare said to be orphaned. \nFigure 10-6 \nHow to enforce the relationships between tables\n\n318 \nSection 3 \nDatabase design and impleme11,tation, \nHow normalization works \nThe next step in the design process is to review whether the data structure is \nnormalized. To do that, you look at how the data is separated into related tables. \nIf you follow the first four steps for designing a database that are presented in \nthis chapter, your database will already be partially normalized when you get to \nthis step. However, almost every design can be normalized further. \nFigure 10-7 illustrates how normalization works. The first two tables in this \nfigure show some of the problems caused by an unnormalized data structure. \nIn the first table, you can see that each row represents an invoice. Because an \ninvoice can have one or more line items, however, the item_description column \nmust be repeated to provide for the maximum number of line items. But since \nmost invoices have fewer line items than the maximum, this can waste storage \nspace. \nIn the second table, each line item is stored in a separate row. That elimi-\nnates the problem caused by repeating the item_description column, but it \nintroduces a new problem: the vendor name and invoice number must be \nrepeated in each row. This, too, can cause storage problems, particularly if a \nrepeated column is large. In addition, it can cause maintenance problems if a \ncolumn contains a value that's likely to change. Then, when the value changes, \neach row that contains the value must be updated. And if a repeated value n1ust \nbe reentered for each new row, it would be easy for the value to vary from one \nrow to another. \nTo eliminate the problems cat1sed by data redundancy, you can normalize \nthe data structure. To do that, you apply the normal forms you '11 learn about \nlater in this chapter. As you'll see, there are a total of seven normal forms. \nHoweve1·, it's common to apply only the frrst three. The diagram in this figure, \nfor example, shows the accounts payable system in third normal form. Although \nit may not be obvious at this point how this reduces data redundancy, that will \nbecome clearer as you learn about the different normal forms.\n\nChapter 10 \nHovv to design a database \n319 \nA table that contains repeating columns \nvendor _name \nlnvoice_number \nit:em_desaipbon_ 1 \nitem_desoiptlon_2 \nitem_desaiption_3 \n-\n► \nCahners Publishing \n112897 \nAndroid ad \nMySQLad \nLibrary directory \nZylka Design \n97/552 \nCatalogs \nMySQL flyer \nUWII \nZylka Design \n97/ SSE \nCard revision \nHL'!l!I \nHtm!I \nA table that contains redundant data \nvendor name \nlnv01ce number \nitem_descrtption \n► \nCahners Publishing \n112897 \nAndroid ad \nCahners Publishing \n112897 \nMySQLad \nCahners Publishing \n112897 \nLibrary directory \nZylka Design \n97/522 \nCatalogs \nZylka Design \n97/522 \nMySQL flyer \nZylka Design \n97/53E \nCard revision \n--\n.,,,. \n~ \n~ \nThe accounts payable system in third normal form \nvendors \nvendor id \n-\nvendor name \n-\nvendor address \nvendor_ city \nvendor state \n-\nvendor_zip _code \nvendor_phone \nvendor contact first name \n-\n-\n-\nvendor contact last name \n-\n-\n-\ndefault terms id \n-\n-\ndefault account no \n-\n-\nDescription \n' \n• \n• \n1nvo1ces \ninvoice id \n-\nvendor id \n-\ninvoice number \n-\ninvoice date \n-\ninvoice total \n-\npayment_ tota I \ncredit total \n-\nterms id \n-\ninvoice due date \n-\n-\npayment_date \nterms \nterms id \n-\nterms_ description \nterms_due_days \ninvoices line items \n-\n-\n••----◄ invoice _id \n. \n. \n1nvo1ce_sequence \naccount no \nline item amount \n-\n-\nline_item_ description \ngeneral_ledger_accounts \naccount no \n-\naccount_ description \n• \nNormalization is a formal process you can use to separate the data in a data struc-\nture into related tables. Normalization reduces data redundancy, which can cause \nstorage and maintenance problems. \n• \nIn an unnormalized data structure, a table can contain information about two or \nmore entities. It can also contain repeating columns, columns that contain repeating \nvalues, and data that's repeated in two or more rows. \n• \nIn a normalized data structure, each table contains information about a single \nentity, and each piece of inforrnation is stored in exactly one place. \n• \nTo normalize a data structure, you apply the normal forms in sequence. Although \nthere are a total of seven normal forms, a data structure is typically considered \nnormalized if the first three nor1nal forms are applied. \nFigure 10-7 \nHow normalization works \n.\n\n320 \nSection 3 \nDatabase design and impleme11,tation, \nHow to identify the columns to be indexed \nThe last step in the design process is to identify the columns that shot1ld \nbe indexed. An index is a structure that provides for locating one or more rows \ndirectly. Without an index, a database management system has to perform a table \nscan, which involves searching through the entire table. \nJust as the index of a book has page numbers that direct you to a specific \nsubject, a database index has pointers that direct the system to a specific row. \nThis can speed performance not only when you're searching t·or rows based on a \nsearch condition, but also when you're joining data from tables. If a join is done \nbased on a primary key to foreign key relationship, for example, and an index \nis defined for the foreign key column, the database management system can use \nthat index to locate the rows for each primary key value. \nWhen you use MySQL, an index is automatically created for the primary \nand foreign keys in each table that you create. But you should consider creating \nindexes for other columns in some of the tables based on the guidelines at the \ntop of figure 10-8. \nTo start, you should index a column if it will be used frequently in search \nconditions or joins. The column should also contain mostly distinct values, and \nthe val11es in the column should be updated infrequently. If these conditions \naren't met, the overhead of maintaining the index will probably outweigh the \nadvantages of using it. \nWhen you create indexes, you should be aware that MySQL must update \nthe indexes whenever you add, update, or delete rows. Because that can affect \nperformance, you don't wa11t to define more indexes than you need. \nAs you identify the indexes for a table, keep in mind that, like a key, \nan index can consist of two or 1nore columns. This type of index is called a \ncomposite index.\n\nChapter 10 \nHovv to design a database \n321 \nWhen to create an index \n• \nWhen the column is used freqt1ently in search conditions or joins \n• \nWhen the column contains a large number of distinct values \n• \nWhen the column is updated infrequently \nDescription \n• \nMySQL automatically creates an index for primary and foreign keys. \n• \nAn index provides a way for a database management system to locate information \nmore quickly. When it uses an index, the database management syste1n can go \ndirectly to a specific row rather than having to search through all the rows until it \nfinds it. \n• \nIndexes speed performance when searching and joining tables. \n• \nYou can create composite indexes that include two or more columns. You should \nuse this type of index when the columns in the index are updated infrequently or \nwhen the index covers almost every search condition on the table. \n• \nBecause indexes must be updated each time you add, update, or delete a row, you \nshouldn't create more indexes than you need. \nFigure 10-8 \nHow to identify the columns to be indexed\n\n322 \nSection 3 \nDatabase design and impleme11,tation, \nHow to nor111alize a data structure \nThe topics that follow describe the seven normal forms and teach you how to \napply the first three. As I said earlier, you apply these three forms to some extent \nin the first four database design steps, but these topics will give you more insight \ninto the process. Then, the last topic explains when and how to denormalize \na data structure. When you finish these topics, you' 11 have the basic skills for \ndesigning databases that are efficient and easy to use. \nThe seven normal forms \nFigure 10-9 summarizes the seven normal forms. Each normal form assumes \nthat the previous forms have already been applied. Before you can apply the \nthird normal form, for example, the design must already be in the second normal \nform. \nStrictly speaking, a data structure isn't normalized until it's in the fifth or \nsixth normal form. However, the normal forms past the third normal form are \napplied infrequently. Because of that, I won't present those forms in detail here. \nInstead, I'll just describe them briefly so you'll have an idea of how to apply \nthem if you need to. \nThe Boyce-Codd normal form can be used to eliminate transitive \ndependencies. With this type of dependency, one column depends on another \ncolumn, which depends on a third coltunn. To illustrate, consider the city, state, \nand zip code columns in the Vendors table. Here, a zip code identifies a city and \nstate, which means that the city and state are dependent on the zip code. The zip \ncode, in turn, is dependent on the vendor_id column. To eliminate this depen-\ndency, you cottld store the city and state values in a separate table that uses zip \ncode as its primary key. \nThe fourth normal form can be t1sed to eliminate multiple multivalued \ndependencies from a table. A multivalued dependency is one where a primary \nkey column has a one-to-many relationship with a non-key column. To illustrate, \nconsider the vendor contact phone number in the Vendors table. If you wanted \nto accommodate alternate phone nt1mbers, such as a cellular or home phone, \nyou could add extra columns for each type of number. However, this creates a \nmultivalued dependency between the phone numbers and the vendor_id. To be in \nfourth normal fonn, therefore, you'd need to store phone numbers in a separate \ntable that uses vendor_id as a foreign key. \nTo apply the fifth normal form, you continue to divide the tables of the \ndata structure into smaller tables until all redundancy has been removed. When \nfurther splitting would result in tables that couldn't be used to reconstruct the \noriginal table, the data structure is in fifth normal form. In this form, most tables \nconsist of little more than key columns with one or two data elements. \nThe domain-key normal form, sometimes called the sixth normal form, is \nonly of academic interest since no database system has implemented a way to \napply it. For this reason, even normalization purists might consider a database to \nbe normalized in fifth normal form.\n\nChapter 10 \nHovv to design a database \n323 \nThe seven normal forms \nNormal form \nDescription \nFirst (lNF) \nSecond (2NF) \nThird (3NF) \nBoyce-Codd (BCNF) \nFourth ( 4NF) \nFiftl1 (5NF) \nDomain-key (DK.NF) \nor \nSixth (6NF) \nThe value stored at the intersection of each row and column must be a scaJar \nvalue, and a table must not contain any repeating columns. \nEvery non-key column must depend on the entire primary key. \nEvery non-key column must depend only on the primary key. \nA non-key column can' t be dependent on another non-key colu1nn. This \nprevents transitive dependencies, where column A depends on column C and \ncolumn B depends on column C. Since both A and B depend on C, A and B \nshouJd be moved into another table with C as the key. \nA table must not have more than one ,nultivalued dependency, where the \nprimary key has a one-to-many relationslrip to non-key columns. This form \ngets rid of misleading many-to-many relationships. \nThe data structure is split into smaller and smaller tables until all redundancy \nhas been elinrinated. If further splitting would result in tables that couldn't be \njoined to recreate the original table, the structure is in fifth normal form. \nEvery constraint on the relationship is dependent only on key constraints \nand domain constraints, where a doma.in is the set of allowable values for a \ncolumn. This form prevents the insertion of any unacceptable data by \nenforcing constraints at the level of a relationship, rather than at the table or \ncolumn level. DKNF is less a design model than an abstract ''ultimate\" \nnormal form. \nThe benefits of normalization \n• \nSince a normalized database has more tables than an unnormalized database, and \nsince each table has an index on its primary key, the database has more indexes. \nThat makes data retrieval more efficient. \n• \nSince each table contains information about a single entity, each index has fewer \ncolumns (usually one) and fewer rows. That makes data retrieval and insert, update, \nand delete operations more efficient. \n• \nEach table has fewer indexes, which makes insert, update, and delete operations \nmore efficient. \n• \nData redundancy is minimized, which simplifies maintenance and reduces storage. \nDescription \n• \nEach normal form assumes that the design is already in the previous normal form. \n• \nA database is typically considered to be normalized if it is in third nor1nal form. \nThe other four forms are not commonly used and are not covered in detail in this \nbook. \nFigure 10-9 \nThe seven normal forms\n\n324 \nSection 3 \nDatabase design and impleme11,tation, \nFigure 10-9 also lists the benefits of normalizing a data structure. To summa-\nrize, no1malization produces smaller, more efficient tables. In addition, it reduces \ndata redundancy, which makes the data easier to maintain and reduces the \namount of storage needed for the database. Because of these benefits, you should \nalways consider normalizing your data structures. \nYou should also be aware that the subject of normalization is a contentious \none in the database community. In the academic study of computer science, \nnormalization is considered a form of design perfection that should always be \nstrived for. In practice, though, database designers and DBAs tend to use normal-\nization as a flexible design guideline. \nHow to apply the first normal form \nFigure 10-10 illustrates how you apply the first normal form to an unnor-\nmalized invoice data structure consisting of the data elements that are shown \nin figure 10-2. The first two tables in this figure illustrate structures that aren't \nin first normal form. Both of these tables contain a single row for each invoice. \nBecause each invoice can contain one or more line items, though, the frrst table \nallows for repeating values in the item_description column. The second table \nis similar, except it includes a separate column for each line item description. \nNeither of these structures is acceptable in first nor1nal form. \nThe third table in this figure has elin1-inated the repeating values and \ncolumns. To do that, it includes one row for each line item. Notice, however, that \nthis has increased the data redun.dancy. Specifically, the vendor name and invoice \nnumber are now repeated for each line item. This problem can be solved by \napplying the second normal form. \nBefore I describe the second norrnal form, I want you to realize that I \nintentional! y omitted many of the columns in the invoice data structure from the \nexamples in this figure and the next figure. In addition to the columns shown \nhere, for example, each of these tables would also contain the vendor address, \ninvoice date, invoice total, etc. By eliminating these columns, it will be easier for \nyou to focus on the columns that are affected by applying the normal forms.\n\nChapter 10 \nHovv to design a database \n325 \nThe invoice data with a column that contains repeating values \nvendor _name \nlnvoice_number \nit:em_desaipbon \n-\n► \nCahners Publishing \n112897 \nAndroid ad, MySQL ad, Library directory \nZylka Design \n97/522 \nCatalogs, MySQL Flyer \nZylka Design \n97/ 5-n:3 \nCard revision \nThe invoice data with repeating columns \nvendor_name \ninvotce number \nitem_c:lesaiption_l \nitem_desaiption_2 \nltem_c:lescription_ 3 \n► Cahners Pubfishing \n112897 \nAndroid ad \nMySQLad \nLibrary directory \nZylka Design \n97/552 \nCatalogs \nMySQL flyer \ncm,, \nZyfka Design \n97/ SSE \nCard revision \nIH~!I \nw•l!I \n= \n= \nThe invoice data in first normal form \nvendor _name \ninvoice_number \n,tern_ descnption \n► \nCahners Publishing \n112897 \nAndroid ad \nCahners Publishlng \n112897 \nMySQLad \nCahners Publishing \n112897 \nLibrary directory \nZylka Design \n97/5-22 \nCatalogs \nZylka Design \n97/522 \nMySQL flyer \nZyikaDeslgn \n97/5338 \nCard revision \n= \nDescription \n• \nFor a table to be in first normal for1n, its columns must not contain repeating \nvalues. Instead, each column must contain a single, scalar value. In addition, the \ntable must not contain repeating columns that represent a set of values. \n• \nA table in first normal form often bas repeating valt1es in its rows. This can be \nresolved by applying the second normal form. \nFigure 10-1 O How to apply the first normal form\n\n326 \nSection 3 \nDatabase design and impleme11,tation, \nHow to apply the second normal form \nFigure 10-11 shows how to apply the second normal form. To be in second \nnormal form, every column in a table that isn't a key column must be dependent \non the entire primary key. This form only applies to tables that have composite \nprimary keys, which is often the case when you start with data that is completely \nunnormalized. The table at the top of this figure, for example, shows the invoice \ndata in first normal form after key columns have been added. In this case, the \nprimary key consists of the invoice_id and invoice_sequence columns. The \ninvoice_sequence column is needed to uniquely identify each line item for an \n• \n• \n1nvo1ce. \nNow, consider the three non-key columns shown in this table. Of these \nthree, only one, item_description, depends on the entire primary key. The other \ntwo, vendor_name and invoice_number, depend only on the invoice_id column. \nBecause of that, these columns should be moved to another table. The result is a \ndata st1-ucture like the second one shown in this figure. Here, all of the info1ma-\ntion related to an invoice is stored in the Invoices table, and all of the inf orma-\ntion related to an individual line item is stored in the Invoice Line Items table. \n-\n-\nNotice that the relationship between these tables is based on the invoice_id \ncolumn. This colt1mn is the primary key of the Invoices table, and it's the foreign \nkey in the Invoice_Line_Items table that relates the rows in that table to the \nrows in the Invoices table. This column is also part of the primary key of the \nInvoice Line Items table. \nWhen you apply second nor1r1al form to a data structure, it eliminates some \nof the redundant row data in the tables. In this figure, for example, you can see \nthat the invoice number and vendor name are now included only once for each \ninvoice. In fu·st normal form, this information was included for each line item.\n\nChapter 10 \nHovv to design a database \n327 \nThe invoice data in first normal form with keys added \ninvoicejd \nvendor _name \ninvoice _number \ninvoice_sequence \nitem_desaiption \n► \n1 \nCahners Publishing \n112897 \n1 \nAndroid ad \n1 \nCahners Pubishing \n112897 \n2 \nMySQLad \n1 \nCahners Publishing \n112897 \n3 \nl.Jbrary directory \n2 \nZylka Design \n97/522 \n1 \ncatalogs \n2 \nZylka Design \n97/522 \n2 \nMySQL flyer \n3 \nZylka Design \n97/5338 \n1 \nCard revision \n: \nThe invoice data in second normal form \nI \ninvoice_id \ninvoice _number \nvendor _name \n-\n► \n1 \n112897 \nCahners Publishing \n2 \n97/522 \nZylka Design \n3 \n97/5338 \nZylka Design \n' \ninvoice_id \n• \ninv01ce _sequence \nitem_description \n► \n1 \n1 \nAndroid ad \n1 \n2 \nMySQLad \n1 \n3 \nLibrary directcry \n2 \n1 \ncatalogs \n2 \n2 \nMySQL flyer \n3 \n1 \nCard revision \nDescription \n• \nFor a table to be in second nonnal form, every non-key column must depend on the \nentire primary key. If a column doesn't depend on the entire key, it indicates that \nthe table contains information for more than one entity. This can happen if the table \ncontains a composite primary key. \n• \nTo apply second normal form, you move columns that don't depend on the entire \nprimaiy key to another table and then establish a relationship between the two \ntables. \n• \nSecond normal form helps remove redundant row data, which can save storage \nspace, make maintenance easier, and reduce the chance of storing inconsistent data. \nFigure 10-1 1 \nHow to apply the second normal form \n.,\n\n328 \nSection 3 \nDatabase design and impleme11,tation, \nHow to apply the third normal form \nTo apply the third normal for111, you make sure that every non-key column \ndepends orily on the primary key. Figure 10-12 illustrates how you can apply \nthis form to the data structure for the accounts payable system. At the top of this \nfigure, you can see all of the columns in the Invoices and Invoice_Line_Items \ntables in second normal form. Then, you can see a list of questions that you \nmight ask about some of the columns in these tables when you apply third \nnormal form. \nFirst, does the vendor infom1ation depend only on the invoice_id column? \nAnother way to phrase this question is, ''Will the information for the same \nvendor change from one invoice to another?'' If the answer is no, the vendor \ninformation should be stored in a separate table. That way, can you be sure \nthat the vendor information for each invoice for a vendor will be the same. In \nadctition, you will reduce the redundancy of the data in the Invoices table. This is \nillustrated by the diagram in this figure that shows the accounts payable system \nin third normal form. Here, a Vendors table l1as been added to store the informa-\ntion for each vendor. This table is related to the Invoices table by the vendor_id \ncolumn, which has been added as a foreign key to the Invoices table. \nSecond, does the terms column depend only on the invoice_id column? The \nanswer to that question depends on how this column is used. In this case, I'll \nassume that this column is used not only to specify the terms for each invoice, \nbut also to specify the default terms for a vendor. Because of that, the terms \ninforn1ation could be stored in both the Vendors and the Invoices tables. To avoid \nredundancy, however, the information related to different terms can be stored in \na separate table, as illustrated by the Terms table in this figure. As you can see, \nthe primary key of this table is an auto increment column named terms_id. Then, \na foreign key column named default_terms_id has been added to the Vendors \ntable, and a foreign key column named terrns_id has been added to the Invoices \ntable. \nThird, does the account_no column depend only on the invoice_id column? \nAgain, that depends on how this column is used. In this case, it's used to \nspecify the general ledger account number for each line item, so it depends on \nthe invoice_id and the invoice_sequence columns. In other words, this column \nshould be stored in the lnvoice_Line_Items table. In addition, each vendor has a \ndefault account number, which should be stored in the Vendors table. Because of \nthat, another table named General_Ledger_Accounts has been added to store the \naccount numbers and account descriptions. Then, foreign key columns have been \nadded to the Vendors and Invoice Line Items tables to relate them to this table. \n-\n-\nFourth, can the invoice_due_date column in the Invoices table and the \nline_item_amot1nt column in the Invoice_Line_Items table be derived from other \ndata in the database? If so, they depend on the columns that contain that data \nrather than on the primary key columns. In this case, the value of the \nline_item_amount column can always be calculated from the item_quantity \nand item_unit_price columns. Because of that, this column could be omitted. \nAlte1natively, you could omit the ite1n_quantity and item_unit_price columns\n\nChapter 10 \nHovv to design a database \n329 \nThe accounts payable system in second normal form \n• \n• \n1nvo1ces \ninvoice line items \n-\n-\ninvoice id \n••--4\n◄ invoice id \n-\nvendor name \n-\nvendor address \n-\nvendor_ city \nvendor state \nvendor_zip _ code \nvendor_phone \nvendor contact first name \n-\n-\n-\nvendor contact last name \n-\n-\n-\ninvoice number \n-\ninvoice date \n-\ninvoice total \n-\npayment_total \ncredit total \n-\nterms \ninvoice due date \n-\n-\npayment_date \naccount no \n-\nQuestions about the structure \n-\n. \n. \n1nvo1ce_sequence \naccount no \n-\nline _item_ description \nline _item_ quantity \nline _item_ unit_price \nline item amount \n-\n-\n1. Does the vendor information (vendor_name, vendor_address, etc.) depend only \non the invoice id column? \n2. Does the terms column depend only on the invoice_id column? \n3. Does the account_no column depend only on the invoice_id column? \n4. Can the invoice due date and line item amount columns be derived from \nother data? \nThe accounts payable system in third normal form \nvendors \nvendor id \n-\nvendor name \n-\nvendor address \n-\nvendor_city \nvendor state \n-\nvendor_zip _code \nvendor_phone \nvendor contact first name \n-\n-\n-\nvendor contact last name \n-\n-\n-\ndefault terms id \n-\n-\ndefault account no \n-\n-\nDescription \n• \n• \n1nvo1ces \ninvoices line items \n-\n-\ninvoice id \n••-----\n◄ invoice id \n-\n-\nL...-4 vendor id \n-\ninvoice number \n-\ninvoice date \n-\ninvoice total \n-\npayment_ total \ncredit total \n-\nterms id \n-\ninvoice due date \n-\n-\npayment_ date \nterms \nterms id \nterms_ description \nterms_ due_ days \n. \n. \n1nvo1ce_ sequence \n,--◄ account no \n-\nline item amount \n-\n-\nline _item_ description \ngeneral_ledger_accounts \naccount no \n-\naccount_ description \n• \nFor a table to be in third normal form, every non-key column must depend only on \nthe primary key. \n• \nIf a column doesn't depend only on the primary key, it implies that the colu1nn is \nassigned to the wrong table or that it can be computed from other columns in the \ntable. A column that can be computed from other columns contains derived data. \nFigure 10-1 2 \nHow to apply the third normal form\n\n330 \nSection 3 \nDatabase design and impleme11,tation, \nand keep just the line_item_amount column. That's what I did in the data struc-\nture shown in this figure. The solution you choose, however, depends on how the \ndata will be used. \nIn contrast, although the invoice_due_date column could be calculated from \nthe invoice_date column in the Invoices table and the terms_due_days column \nin the related row of the Terms table, the system also allows this date to be \noverridden. Because of that, the invoice_due_date column should not be omitted. \nIf the system didn't allow this value to be overridden, however, this column \ncould be safely omitted. \nWhen and how to denormalize a data structure \nDenormalization is the deliberate deviation from the normal forms. Most \ndenormalization occurs beyond the third normal form. In contrast, the first three \nnormal forms are almost universally applied. \nTo illustrate when and how to denormalize a data structure, figure 10-13 \npresents the design of the accounts payable system in fifth normal form. Here, \nthe vendor zip codes are stored in a separate table that contains the city and \nstate for each zip code. In addition, the area codes are stored in a separate table. \nBecause of that, a query that retrieves vendor addresses and phone numbers \nwould require two joins. In contrast, if you left the city, state, and area code \ninformation in the Vendors table, no joins would be required, but the Vendors \ntable would be larger. \nIn general, you should denormalize based on the way the data will be used. \nIn this case, we'll seldom need to query phone numbers without the area code. \nLikewise, we'll seldo1n 11eed to query city and state without the zip code. For \nthese reasons, I've denormalized my design by eliminating the Zip_Codes and \nArea Codes tables. \nYou might also consider denormalizing a table if the data it contains \nis updated infrequently. In that case, redundant data isn't as likely to cause \nproblerns. \nFinally, you should consider including derived data in a table if that data is \nused ft·equently in search conditions. For example, if you frequently query the \nInvoices table based on invoice balances, you might consider including a column \nthat contains the balance due. That way, you won't have to calculate this value \neach time it's queried. Keep in mind, though, that if you store derived data, it's \npossible for it to deviate from the derived value. For this reason, you may need \nto protect the derived column so it can't be updated directly. Alternatively, you \ncould update the table periodically to reset the value of the derived column. \nBecause normalization eliminates the possibility of data redundancy errors \nand optimizes the use of storage, you should carefully consider when and how to \ndenormalize a data structure. In general, you should denormalize only when the \nincreased efficiency outweighs the potential for redundancy errors and storage \nproblems. Of course, your decision to denor1nalize should also be based on your \nknowledge of the real-world environment in which the system will be used. If \nyou've carefully analyzed the real-world environment as outlined in this chapter, \nyou'll have a good basis for making that decision.\n\nChapter 10 \nHovv to design a database \n331 \nThe accounts payable system in fifth normal form \nvendors \nvendor id \n-\nvendor name \n-\nvendor address \n-\nvendor_zip_code \n,..... vendor area code id \n' \n-\n-\nvendor_phone \nvendor contact first name \n-\n-\n-\nvendor contact last name \n-\n-\n-\ndefault terms id \n-\n-\ndefault account no \n-\n-\nzip_codes \nzip_codes \ncity \nstate \narea codes \n-\narea code id \n-\n-\narea code \n-\nWhen to denormalize \n• \n• \n1nvo1ces \ninvoice line items \n-\n-\ninvoice_id \n••----\n◄ invoice_id \nvendor id \n-\ninvoice number \n-\ninvoice date \n-\ninvoice total \n-\npayment_ tota I \ncredit total \n-\n......--4 terms id \n-\ninvoice due date \n-\n-\npayment_ date \nterms \nterms id \n-\nterms_description \nterms_due_days \n. \n. \n1nvo1ce_sequence \n~~ \naccount no \n-\nline_item_qty \nline _item_ unit_price \n..... line_item_description_id \nline_item_descriptions \nline_item_description_id \nline_ item_ description \ngeneral_ledger_accounts \naccount no \n-\naccount_ description \n• \nWhen a column from a joined table is used repeatedly in search criteria, you should \nconsider moving that column to the primary key table if it will eliminate the need \nfor a join. \n• \nIf a table is updated infrequently, you should consider denormalizing it to improve \nefficiency. Because the data remains relatively constant, you don't have to worry \nabout data redundancy errors once the initial data is entered and verified. \n• \nIncl11de columns with derived values when those values are used frequently in \nsearch conditions. If yo11 do that, you need to be sure that the column value is \nalways synchronized with the value of the columns it's derived from. \nDescription \n• \nData structures that are normalized to the fourth normal form and beyond typically \nrequire more joins than tables normalized to the third normal fo1m and can there-\nfore be less efficient. \n• \nMySQL statements that work with tables that are normalized to the fourth normal \nfor111 and beyond are typically more difficult to code and debug. \n• \nMost designers denormalize data structures to some extent, usually to the third \nnormal form. \n• \nDenormalization can result in larger tables, redundant data, and reduced \nperformance. \n• \nOnly denormalize when necessary. It is better to adhere to the normal fonns unless \nit is clear that perfor111ance will be improved by deno1m alizing. \nFigure 10-13 \nWhen and how to denormalize a data structure\n\n332 \nSection 3 \nDatabase design and impleme11,tation, \nHow to use MySQL Workbench \nfor database design \nWhen you're ready to create a database diagram, it usually makes sense to \nuse a tool that's specifically designed for that purpose. Fortunately, dozens of \ntools for designing databases are available. This topic introduces you to one of \nthem: MySQL Workbench. \nMySQL Workbench makes it easy to create one or more database diagrams \nfrom an enhanced entity-relationship model (EER model). This model extends \nthe original entity-relationship model (ER mode[). In addition, you can create a \nvisual representation of an EER model by creating one or more EER diagrams \nfrom that model. \nWhen working with MySQL Workbench, you can generate an EER model \nfrom an existing MySQL database or SQL creation script. Conversely, you can \ngenerate a SQL creation script from an EER model. This makes it easy to imple-\nment your design when you're done with it. \nHow to open an existing EER model \nWhen you start MySQL Workbench, it displays the Welcome tab of the \nHome page. To work with EER models, you can display the Models tab that's \nshown in figure 10-14. Then, you can open an existing EER model that was \ncreated with MySQL Workbench. If you opened the model recently, it should \nbe displayed in the list of recently opened models. In this figure, for example, \ntwo models are shown in this list. One is named OM, and the other is named AP. \nThen, you can open the model by clicking on it. If the model you want to open \nisn't displayed in this list, you can click the @ icon to the right of the Models \nheading and use the resulting dialog box to select the ftle for the model. \nHow to create a new EER model \nIf you're designing a new database from scratch, you can create a model that \ndoesn't contain any tables. To do that, you can click the® icon to the right of \nthe Models heading. Then, you can add tables to the model as shown in the next \nfigure. \nIf you 're redesigning an existing database, you can start by creating a \nmodel from that database. To do that, you can click the 0 icon to the right of \nthe Models heading and select the ''Create EER Model from Database'' item. \nThen, you can use the resulting dialog boxes to connect to the server and select a \ndatabase. When you do, MySQL Workbench creates a model and a diagran1 that \nincludes all of the tables and columns of the selected database. \nIf you don't have access to the database but you have access to the script \nthat creates it, you can create a model from that script. To do that, you can click \nthe 0 icon to the right of the Models heading and select the ''Create EER Model \nfrom Script'' iten1. Then, you can use the resulting dialog box to select the script \nfile.\n\nChapter 10 \nHovv to design a database \n333 \nThe Models tab of the MySQL Workbench Home page \n■ \nMySQl. Workbench \nD \nX \nFile \nEdit \nView \nDatabase \nT DOis \nScripting \nHelp \nModels 0@ 0 \nom \nap \nc::I \nC;\\mur~ch\\mysql \nc::l \nC:\\mu~ch\\mysql \n_ \nom \n-\nap \n-\n12 Dec 18, 12:28 \n-\n12 Dec 18, 10:48 \nDescription \n• \nMySQL Workbench allows you to create an enhanced entity-relationship 1nodel \n(EER niodel). This type of model extends the original entity-relationship model (ER \nmodel). \n• \nOnce you have created or opened an EER model, you can work with one or 1nore \nEER diagrams· that are associated with that model. \n• \nTo open a recently used existing EER model, click on the model in the list of \nmodels. \n• \nTo open any EER model, click the@) icon to the right of the Models heading, or \nselect the File➔Open Model item. Then, use the resulting dialog box to select the \nfile for the model. \n• \nTo create a new EER model that's blank, click the ® icon to the right of the Models \nheading, or select the File➔ New Model item. \n• \nTo create an EER model from an existing database, click the 0 icon to the right of \nthe Models heading, select the ''Create EER Model fi·om Database'' item, and use \nthe resulting dialog boxes to connect to the server and select the database. \n• \nTo create an EER model from a SQL creation script, click the 0 icon to the right of \nthe Models heading, select the ''Create EER Model from Script'' item, and use the \nresulting dialog box to select the script file. \n• \nTo remove an existing model from the list of recently used models, right-click on \nthe model and select the ''Remove Model File from List'' item. \nFigure 10-14 \nHow to create and open an EER model\n\n334 \nSection 3 \nDatabase design and impleme11,tation, \nHow to work with an EER model \nFigure 10-15 shows how to work with an BER model. In particular, it shows \nthe MySQL Model tab for the AP database. From this tab, you can work with the \ntables of the database. \nTo edit one of these tables, you can double-click on it. When you do, \nMySQL Workbench displays a tab for the table at the bottom of the window. \nWithin this tab are additional tabs that you can use to modify the columns, \nindexes, and foreign keys for the table. For example, this figure shows the \nColumns tab for the Vendors table. From this tab, you can modify the names, \ndata types, and other attributes of the columns. You can also add a new column \nby entering the information for the column at the bottom of the table. And, you \ncan modify the name of the table. \nIf you want to add a table to the model, you can double-click on the Add \nTable icon. Then, you can edit the table to set its name, columns, indexes, and \nforeign keys. You'll learn more about how to do that in the next chapter. Or, if \nyou want to remove a table from the model, you can right-click on the table and \nselect the Delete i tern. \nSince you typically begin designing a database by creating the tables of the \ndatabase, this figt1re focL1ses on how to work with tables. However, you can use \nsimilar skills to work with other database objects that are stored in the model, \nsuch as views and stored programs. \nSince it's usually easier to work with a visual representation of the model, \nyou can open a diagram that corresponds with the model. As yot1'll see in the \nnext figure, this can make it easier to see the relationships between tables. When \nyou work with a diagram, some changes that you make affect the corresponding \nmodel. As a result, you can think of working with a diagram as a more visual \nway of working with the model. \nWhen you create or open a model, the diagram for the model is displayed \nby default. If you close the tab for the diagram, however, you can open it again \nby double-clicking on the name of the diagram. In this figure, for example, the \nmodel for the AP database contains a diagram named EER Diagram. For small \ndatabases, you may only need a single diagram like this. However, for larger \ndatabases, you may need to create multiple diagrams that provide ways to view \ndifferent parts of the database. To create a new diagram for the model, you can \ndouble-click the Add Diagram icon. Then, the diagram is given a name such as \nEER Diagram 1, EER Diagram 2, and so on. \nWhen you 're done creating your model, you can create a MySQL \ndatabase creation script from the diagram. To do that, you can select the \nFile➔ \nExport➔ Forward Engineer SQL CREATE Script item. Then, you can \nimplement your design by using MySQL Workbench to run the script. This \ncreates the database that corresponds to the model.\n\nChapter 10 \nHovv to design a database \n335 \nThe EER model for the AP database \n■ \nMySQl Workbench \nD \nX \n6 \nMySOL Model\" (ap.ln'Nb) \"' \nEER Dai,am \n>< \nRle \nEdit \nVtf!Nf \nArrange \nModel \nDatabase \nT cols \nScripting \nHelp \nIJ□ \nDescnllbot' Ea,toi \nvendcn: MySQL Table \nV \nMooel C>,et111eA \n¢ \n--' \nAdd Diagram \nEER CXagam \nY Physical Schemas \nTables ,.. .-,, \no Add Table \n~ \ntenns \nViews , \" tems \ngeneral_ledget _acco .•. J lnVOICe _archive \n-\nvendor_cantac:ts \n::J vendm \n00 \n••• = \n00 \n::: = + -\nG \nlnVOiee_lne_ilef!\\$ \n:J Invoices \nV \n-\n-----------------\nDescnpbon \n!;-\nTablcName: ~s \nSchema: \nap \nColurmNamc \nDatatype \nPK \ni'N \nUQ \nB \nl.l'l \n\"ZF \nAl \nG \nOefaJ~ \nType \nOefmion \nFla, \n< \n> \nUser T ypn \nHisll:lry \nReady \nDescription \nvcndor_td \nINT(ll) \nvendor_name \nVARCHAR(SO) \nvendor_addrcssl \nVARCHAR(SO) \nvendor _addri!5S2 \nVARCHAR(SO) \nC-OlumName: \nCllarsct/Colation: \nr \nO\"aa!U!t \n!.'L~t t'\"ol:3!!0<\\ \nComments: \n0 0 D D D D 0 \nD \n□ 0 \n0 \n□ D D □ □ \n□ D □ □ D □ D D \nNUU \n□ □ D □ □ □ □ D \nNULL \n-\n-\n-\n-\n-\n-\n-\n-\nData Type: \nOefaJt: \nStxnvc: \nVirtual \nStored \nNo-ttu \nl..hslQncd \nPmwy~y \n£lirwy \nAuto lncrenent \n~ated \nColumns \nIndeces \nForelgn Keys \nTriggers \nPart,tlomng \nOptions \nInserts \nPnvilegcs \n• \nAn EER model is a representation of the entities, or objects, of the database \nincluding the tables, views, and stored programs. \nUnique \nZero AI \n• \nTo edit a table, double-click on it. Then, use the tabs that appear across the bottom \nof the window to modify the table's columns, indexes, and foreign keys. \n• \nTo add a new table, double-click on the Add Table icon. Then, use the tab that \nappears to define the table. \n• \nTo delete a table, right-click on it and select the Delete item. \n• \nThe skills for working with tables also apply to other database objects such as \nviews and stored programs. \n• \nThe EER model typically includes at least one diagram named EER Diagram. \n• \nTo open a diagram, double-click on the name of the diagram. \n• \nTo create a new diagram, double-click on the Add Diagram icon or select the \nModel ➔ Add Diagram item. \nI\\ \nV \n• \nTo expott a database creation script from the model, select the File➔ \nExport➔ \nForward \nEngineer SQL CREATE Script item. \nFigure 10-1 5 \nHow to work with an EER model\n\n336 \nSection 3 \nDatabase design and impleme11,tation, \nHow to work with an EER diagram \nWhen you open an EER diagram, it's displayed in a tab as shown in figure \n10-16. Here, you can see the diagram that's associated with the model for the \nAP database. This diagram shows the definitions of the columns in the tables as \nwell as the relationships between the tables. For example, it shows that there's a \none-to-many relationship between the Vendors and Invoices tables. \nTo edit a table, you can double-click on it. This displays a tab for the table \nthat works the same as the one you saw in the last figure. As you learned in that \nfigure, you can use this tab to make changes to the columns, indexes, and foreign \nkeys. \nTo add a table that exists in the model to the diagram, you can drag the table \nfrom the Catalog Tree pane onto the diagram. Or, if you want to create a new \ntable, you can click the Place a New Table button in the vertical toolbar to the \nleft of the diagram and then click on the diagram. This adds a new table to the \ndiagram and to the model. \nSince a diagram provides a visual representation of the relationships \nbetween tables, you often use it to define those relationships. To do that, you \ncan use the six relationship buttons at the bottom of the toolbar. The first five \nbuttons generate foreign keys for the table, so you can use these buttons when \nthe column for a foreign key doesn't exist yet. You can use the last relationship \nbutton if the foreign key column already exists in your diagram. For example, \nto create a relationship between the Vendors and Invoices tables, I clicked on \nthe last button (the Place a Relationship Using Existing Columns b11tton). Then, \nI clicked on the vendor_id column in the Invoices table to identify the foreign \nkey, and I clicked on the vendor_id column in the Vendors table to identify the \nprimary key. \nIn the next chapter, you'll learn more about the SQL statements that are \ngenerated by a tool like this. This will help you understand how to use MySQL \nWorkbench, and it will allow you to edit the SQL statements that are generated \nby your database design tools.\n\nChapter 10 \nHovv to design a database \nThe EER diagram for the AP database \n■ \nMySQl. Workbench \nD \nX \n6 \nMySOL Moder (ap.mwb) \nx \nEER l);agram ,.. \nFile \nEdit \nVi-\nArrange \nModel \nDatabase \nTools \nScripting \nHelp \n... ..,. \nflJ \n0 \n._ _ \n__,Is. lJ□ \nBiros Ee \nll aqram \nZoom: 1~ • ~ 0_ \n[I] o:J vendors \n0 \nI \nvendor Jd INT( 11) \n0 \n► vendor _nan e VAR01AR(SO) \n0 \n\" \n., \n) \n:J lnvoice_llne_ltems \nrnwocejd INT( 11) \n,a \nvendor _addro= 1 V ARCHAR(SO) \n> vendor _address2 V ARCHAR(SO) \n□ \nvendor _dty VAROiAR(SO) \nE) \n'# -.endor _stale 01AR(2) \n:J invoices \ninwocejd INT( 11 \n...endor Jd I NT( 11 \nlnvolce_number V \n) \nMCHAA(SO) \n,H -\nI \nlnvoice_date DAT \nI \nE \nMAl(9,2) \nI \nt invoice_lx>tal DEG \n. . \nlnvorce_:;equence INT( 11) \n• ao:ount_number INT(lll \nline_item_amount OEC!MAl(9,2) \nline_ltem _description V MCHAR(lOO \nCatalog T tee \n., \nap \n... I El \n•3' Tables \ntc:, \n-.endor _zip _code V MCHAR(20) \n) Yendor_phone VMCHAR(SO) \n-.endor _contactj ast_name V ARCHAR(SO) \nvendor _conlact_first_narn e VAR01M(SO) \ndefault_termsjd INT(U) \n~ \noenerel_ledoer_acc \nca, \n,. defaulLaccount_r,umber INT(l1) \n:] involce_archlve \n'l:l)I \nJ lnvolce line 1te115 \" \nO \n< \n> \n111:i ---\n.. \n0 \n-t'l:11 \nQMAL(9,2) \npa-.,m ent_lx>tz/ DE \ncredit_tolal DEQMA L(9,2) \nDATE \n♦ b!rm s _Id INT( 11) \nlnvoice_due_d.e \npa}'ffl ent_date DA JE \n____ f \nl -• \n► \n.. \n--\nl \n--1 \nI \nI \nI \nI \nI \nI \n:l: \nl \nI \nI \nI \nI \nI \nI \nI \n:I: \nC-alalog \nlayers \nUser Types \nl'I ~ \nOesa,pt,oo Eo,!t>r \n, \nl:n \n-\nV \nI: I \nI \nI \nI '\"------ff \n:J ta,os \ntermsJd INT(l l) \nterm s_descrlptlon VAR01M(SO) \nterm s_due_days INT(l 1) \n:J gerwal_ledger_~nlS \" \naccount_number INT( ll) \naccount_descrlption V MCHAR( SO) \n<double-dick lo oveiwde multc>lec---.11 ~ \nDescnptior \nPropenies \n♦ ♦ ~ \n\" < \n.. \nSQt.. Edrtor closed \nDescription \n• \nAn EER diagram is a visual representation of an EER model. As a result, when you \nmodify the tables in the diagram, yot1 also modify the model. \n• \nTo add a table that already exists in the model to the diagram, drag the table from \nthe Catalog Tree window onto the diagram. \n• \nTo add a new table to the diagram, click the Place a New Table button in the \nvertical toolbar at the left edge of the diagram. Then, click on the diagram where \nyou want to add the table. \n• \nTo display the model for a table, double-click on the table. Then, a tab is displayed \nfor the table, and you can use the techniques you learned in the previous figure to \nedit the table. \n• \nTo define the relationship between two tables, click one of the relationship buttons \nin the vertical toolbar. Then, click on the column in each table that defines the \nrelationship. \n• \nTo edit or delete a relationship, right-click on the relationship icon and select the \nappropriate item. \n• \nTo remove a table from the diagram but keep it in the model, right-click on the \ntable and select the Remove Figure item. \n• \nTo remove a table from the diagram and delete it from the model, right-click on the \ntable and select the Delete item. \nFigure 10-16 \nHow to work with an EER diagram \n00 \n... \n> \n337\n\n338 \nSection 3 \nDatabase design and impleme11,tation, \nPerspective \nDatabase design is a complicated subject. Because of that, it's impossible \nto teach you everything yot1 need to know in a single chapter. With the skills \nyou've learned in this chapter, though, you should now be able to design simple \ndatabases of your own. More impo11antly, you should be able to evaluate the \ndesign of any database that you work with. That way, you can be sure that the \nqueries you code will be as efficient and as effective as possible. \nIn the next chapter, you' 11 learn how to implement the database designs you \ndevelop using DDL statements. As you read that chapter, though, keep in mind \nthat you can also implement a database design by generating a SQL creation \nscript from an BER model and then executing that script. Even so, you'll want \nto be sure you unde1·stand the DDL statements the generated script contains. \nTerms \ndata structure \nentity \nattribute \ninstance \nentity-relationship (ER) modeling \nCASE ( computer-aided software \nengineering) \nlinking table \nconnecting table \nassociate table \nreferential integrity \ndeclarative referential integrity (DRI) \nforeign key constraint \norphaned row \nnormalization \ndata redundancy \nunnormalized data structure \nnormalized data structure \nnormal forms \nindex \ntable scan \ncomposite index \nderived data \nBoyce-Codd nonnal form \ntransitive dependency \nmultivalued dependency \ndomain-key normal form \ndenormalization \nentity-relationship (ER) model \nenhanced entity-relationship (BER) \nmodel \nBER diagram\n\nChapter 10 \nHovv to design a database \n339 \nExercises \n1. \nUse MySQL Workbench to create an EER diagram for a database that stores \ninformation about prodt1cts. \nEach product must have a product name, description, and price. \nEach product must belong to one category. \nEach category must have a category name and description. \nEach category can include multiple products. \n2. \nUse MySQL Workbench to create an EER diagram for a database that stores \ninfor1nation about customers. \nEach customer must have an email address, first name, and last name. \nEach customer can have two or more addresses. \nEach customer can have a default billing address and a default shipping \naddress. \nEach address must have a street address, city, state, postal code, and \ncountry. \nEach country name should be stored in one place only. In other words, you \nshouldn't store the name of the country, which may be many characters, in \nthe address. \n3. \nUse MySQL Workbench to create an EER diagram for a database that tracks \nthe memberships for an association and for the groups within the association. \nEach member must have an email address, fit·st name, and last name. \nEach member can belong to any number of groups. \nEach group must have a name. \nEach group can have any number of members.\n\nHow to create databases, \ntables, and indexes \nNow that you've learned bow to design a database, you're ready to learn how to \nimplement your design. To do that, you use the set of SQL statements that are \nknown as the data definition language (DDL). In this chapter, you'll learn how \nto use DDL statements or MySQL Workbench to work with databases, tables, \nand indexes. In addition, you '11 learn how to change the character set, collation, \nand storage engine if you need to do that. \nHow to work with databases ............................................. 342 \nHow to create and drop a database .............................................................. 342 \nHow to select a database .............................................................................. 34 2 \nHow to work with tables ..................................................... 344 \nHow to create a table ................................................................................... 344 \nHow to code a primary key constraint ....................................................... 346 \nHow to code a foreign key constraint .......................................................... 348 \nHow to alter the colu1nns of a table ............................................................. 350 \nHow to alter the constraints of a table ......................................................... 352 \nHow to rename, truncate, and drop a table .................................................. 354 \nHow to work with indexes .................................................. 356 \nHow to create an index ................................................................................ 356 \nHow to drop an index ................................................................................... 356 \nA script that creates a database ....................................... 358 \nHow to use MySQL Workbench ........................................ 362 \nHow to work with the columns of a tab]e .................................................... 362 \nHow to work with the indexes of a table .................................................... 364 \nHow to work with tl1e foreign keys of a table .............................................. 366 \nHow to work with character sets and collations ............. 368 \nAn introduction to character sets and co11ations ......................................... 368 \nHow to view character sets and collation .................................................. 370 \nHow to specify a character set and a collatio11 ............................................ 372 \nHow to work with storage engines ................................... 374 \nAn introduction to storage engines .............................................................. 374 \nHow to view storage en.gin es ....................................................................... 374 \nHow to specify a storage engine .................................................................. 376 \nPerspective ......................................................................... 378\n\n342 \nSection 3 \nDatabase design and impleme11,tation, \nHow to work with databases \nBefore you can begin creating the tables of a database, you must create the \ndatabase. Then, since multiple databases may be running on a single MySQL \nserver, you usually select the database before you begin working with it. Of \ncourse, if you decide that you no longer need a database, you can drop it, which \ncauses the database and all of its tables and data to be deleted. \nIf you're working on a large database project, you probably won't need \nto code DDL statements like these because that will be handled by a database \ndesign specialist or a database ad1ninistrator (DBA). For small projects, though, \nthe SQL programmer may often have to serve as the DBA too. And even when \nworking with large projects, the SQL programmer often needs to use DDL to \ncreate smalle1· tables that are needed for testing. \nHow to create and drop a database \nFigure 11-1 starts by presenting the CREATE DATABASE statement. The \nfrrst example in this figure uses the CREATE DATABASE statement to create \na database named AP. If a database already exists with that name, this state-\n1nent generates an error and doesn't execute. To prevent this, you can add the \nIF NOT EXISTS keywords to the CREATE DATABASE statement as shown in \nthe second example. Then, the statement only executes if the database doesn't \nalready exist. \nThe syntax of the DROP DATABASE statement is also shown in this figure. \nThe third example uses this statement to delete the database named AP that was \ncreated in the first two examples. This permanently deletes everything in the \nentire database, so use it with caution! If the specified database doesn't exist, \nthis statement generates an error. To prevent this, you can add the IF EXISTS \nkeywords to the statement as shown in the fourth example. Then, the statement \nonly drops the database if it exists. \nHow to select a database \nFigure 11-1 also shows how to select a database using the USE statement. \nThe example shown here uses this statement to select the database that was \ncreated by the CREATE DATABASE statement in the frrst example. Although \nthe USE statement isn't a standard SQL statement, it's a MySQL extension that's \ncommonly used when working with MySQL databases.\n\nC/1apter 11 \nHo,r to create database~'i, tables. mid inde_~es \n343 \nHow to use the CREATE DATABASE statement \nSyntax \nCREA.TB DATABASE [:IF NOT EX:ISTS ) db_n.am• \nAttempt to create a database named AP \nCREATE DATABASE ap \nCreate a database named AP only if it doesn't exist \nCREATE DATABASE IF NOT EXI STS ap \nHow to use the DROP DATABASE statement \nSyntax \nDROP DATABASE [:IF EXXSTS ) db_name \nAttempt to drop a database named AP \nDROP DATABASE ap \nDrop a database named AP only if it exists \nDROP DATABASE IF EX:ISTS ap \nHow to use the USE statement \nSyntax \nUSE db name \n-\nSelect a database named AP \nUSE ap \nDescription \n• \nThe CREATE DATABASE statement creates a database with the specified nan1e on \nthe sen·er. \n• \nThe DROP DATABASE staten1ent delete the database \\Vith the specified name \nfron11 the server. Thi deletes all of the table and data that are stored in the \ndatabase. \n• \nThe USE staten1ent selects the L pecified database and n1ak.e it the current database. \nFigure 11 -1 \nHow to create, drop, and select a database\n\n344 \nSection 3 \nDatabase design and impleme11,tation, \nHow to work with tables \nThis topic shows how to code the DDL statements that work with the \ntables of a database. Because the syntax for these statements is complex, this \nchapter doesn't present complete syntax diagrams for these statements. Instead, \nthe diagrams present only the commonly used clauses. If you're interested in \nthe complete syntax of any statement, though, you can refer to the MySQL \nReference Manual. \nHow to create a table \nFigure 11-2 presents a simplified syntax for the CREATE TABLE statement. \nBy default, this statement creates a new table in the current database. If that's \nnot what you want, you can qualify the table name with the database name. For \nexample, you can qualify the Vendors table with the EX database like this: \nCREATE TABLE e x.vendors \nBefore I continue, you should realize that if you run the statements shown in \nthis figure against the AP database, the statements will fail. That's because the \nAP database already contains tables named Vendors and Invoices. As a result, \nif you want to test these statements, you can run them against the EX database. \nThen, the Vendors and Invoices tables will be created in that database. \nIn its simplest form, the CREATE TABLE statement consists of the name \nof the new table followed by the names and data types of its columns. This is \nillustrated by the first example in this figure. However, in most cases, you'll code \none or more attributes for each column as illustrated by the second example. For \ninstance, to indicate that a column doesn't accept null values, you can code the \nNOT NULL attribute. If you omit this attribute, the column allows null values. \nTo indicate that each row in a column must contain a unique value, you can \ncode the UNIQUE attribute. Since two null values aren't considered to be the \nsame, a unique colurm1 can contain null values. However, it's common to use the \nNOT NULL and UNIQUE attributes to define a column that can't contain null \nvalues and where each value in the column must be unique. \nTo generate unique numbers in sequence, you use the AUTO_INCREMENT \nattribute. This attribute can only be specified for one column in a table, and that \ncolumn must be defined as either the primary key or a unique key. When you \ndefine a column with theAUTO_INCREMENT attribute, MySQL automati-\ncally generates the next number in sequence for the column if you don't specify \na value. By default, MySQL starts numbering with 1, but you ca11 start with a \nvalue other than 1 by coding an option like this at the table level: \nAUTO_ INCREMENT = 3 \nFinally, to specify a default value for a column, you can use the DEFAULT \nattribute. This value is used if another value isn't specified when a row is added \nto the database. The default value you specify must correspond to the data type \nfor the column. For example, the default value for the payment_total column \nis set to a value of zero. With MySQL 8.0.13 and later, you can also specify a \ndefault value as an expression. For example, you could specify a default value \nfor the invoice date column as the CURRENT DATE function. \n-\n-\n\nChapter 11 \nHow to create databases, tables, and indexes \n345 \nThe syntax of the CREATE TABLE statement \nCREATE TABLE [db_name.]table_name \n( \n) \ncol,:imn_ name_ l data_ type [column_ attributes] \n[, column_name_ 2 data_ t ype [column_ attributes]] ... \n[, table_ level_ constraints] \nCommon column attributes \nAttribute \nDescription \nNOT NULL \nUNIQUE \nIndicates that the column doesn't accept null values. If ornitted, \nthe column can accept null values. \nDEFAULT default_ value \nSpecifies that each value stored in the column must be uajque. \nSpecifies a default value for the column as a literal or as an \n• \nexpression. \nAUTO INCREMENT \nIdentifies a column whose value is automatically incremented by \nMySQL when a new row is added. An auto increment column \nmust be defined as an integer or a floating-point number. \nA statement that creates a table without column attributes \nCREATE TABLE vendors \n( \n) \nvendor_ id \nvendor name \nINT, \nVARCHAR ( 5 0) \nA statement that creates a table with column attributes \nCREATE TABLE vendors \n( \n) \nvendor id \nvendor_name \nINT \nVARCHAR ( 5 0) \nNOT NULL \nNOT NULL \nUNIQUE AUTO_ INCREMENT, \nUNIQUE \nAnother statement that creates a table with column attributes \nCREATE TABLE invoic es \n( \ninvoice_ id \nvendor id \ninvoice_ number \ninvoice date \ninvoice_ total \npayment_ total \n) \nDescription \nINT \nINT \nVARCHAR ( 5 0 ) \nDATE, \nDECIMAL (9,2 ) \nDECIMAL (9,2) \nNOT NULL \nNOT NULL, \nNOT NULL, \nNOT NULL, \nUNIQUE, \nDEFAULT 0 \n• \nTo test the code in this figure and in the figures that follow, you can select the EX \ndatabase. \n• \nThe CREATE TABLE statement creates a table based on the column names, data \ntypes, and attributes that you specify. In addition, it allows you to specify some \nattributes and constraints at the table level as described later in this chapter. \nFigure 11-2 \nHow to create a table\n\n346 \nSection 3 \nDatabase design and impleme11,tation, \nHow to code a primary key constraint \nWhether you realize it or not, the NOT NULL and UNIQUE keywords are \nexamples of constraints. A constraint rest1icts the type of data that can be stored \nin a column. For example, the NOT NULL keyword prevents null values from \nbeing stored in a column, and the UNIQUE keyword only allows unique values. \nFigure 11-3 shows how to code another type of constraint that's known as \na primary key constraint. The easiest way to define a primary key is to code \nthe PRIMARY KEY keywords after the data type for the column as shown in \nthe first example. When you identify a column as the primary key, two of the \ncolumn's attributes are changed automatically. First, the column is forced to be \nNOT NULL. Second, the column is forced to contain a unique value for each \nrow. In addition, an index is automatically created based on the column. \nWhen you define a constraint in a column definition as shown in the first \nexample, it's called a column-level constraint. You can also define a constraint at \nthe table level using the CONSTRAINT keyword. When you code a table-level \nconstraint, you can provide a name for the constraint. In the second example in \nthis figure, for instance, the frrst constraint provides a name of vendors_pk for \nthe primary key of the Vendors table. Note how the constraint names used in \nthis example begin with a table name or a column name. In addition, they use a \ntwo-letter suffix to identify the type of constraint. \nAlthough you can't name them at the column level, the vendors_pk and \nvendor_name_uq constraints work the same regardless of whether they are \ncoded at the column level or the table level. As a result, where you code these \nconstraints is largely a matter of personal preference. I prefer to code the primary \nkey and unique key constraints at the colt1mn level as shown in the first example. \nHoweve1·, when MySQL Workbench generates code from an EER model, it \nusually codes these constraints at the table level as shown in the second example. \nIn addition to allowing you to name a primary key, a table-level constraint \nprovides another capability that isn't available from column-level constraints: \nit can refe1· to multiple columns in the table. As a result, if you need to refer to \nmultiple columns, you must use a table-level constraint. Fo1· example, to create \nthe primary key for the lnvoice_Line_ltems table, I coded the constraint at the \ntable level as shown in the third example. Unlike the constraint name for the \nprimary key in the second example, I used an abbreviated form of the table name \nfor the constraint name in this example. That keeps the constraint name shorter, \nbut the name still clearly identifies the table that it applies to. \nWhen you code a constraint at the table level, you must code a comma at the \nend of the preceding column definition. If you don't, you will get an error when \nyou try to run the statement.\n\nChapter 11 \nHow to create databases, tables, and indexes \n347 \nThe syntax of a column-level primary key constraint \ncol 11mn_name data_ type PRIMARY KEY column_attributes \nThe syntax of a table-level primary key constraint \n[CONSTRAINT [constraint_name]] \nPRIMARY KEY (column_name_ l[, column_name_ 2] ... ) \nA table with column-level constraints \nCREATE TABLE vendors \n( \n) \nvendor_id \nvendor_name \nINT \nVARCHAR(SO) \nPRIMARY KEY \nNOT NULL \nA table with table-level constraints \nCREATE TABLE vendors \n( \nvendor_ id \nINT \nAUTO_ INCREMENT, \nvendor_name \nVARCHAR(SO) \nNOT NULL, \nAUTO_ INCREMENT, \nUNIQUE \nCONSTRAINT vendors_pk PRIMARY KEY (vendor_ id), \nCONSTRAINT vendor_name_uq UNIQUE (vendor_ narne) \n) \nA table with a two-column primary key constraint \nCREATE TABLE invoice_ line_ items \n( \ninvoice_ id \nINT \nNOT NULL, \ninvoice_ sequence \nINT \nNOT NULL, \nline_ item_description \nVARCHAR(lOO) \nNOT NULL, \nCONSTRAINT line_ items_pk PRIMARY KEY (invoice_ id, invoice_ sequence) \n) \nDescription \n• \nConstraints are used to enforce the integrity of the data in a table by defining rules \nabout the values that can be stored in the columns of the table. \n• \nYou code a column-level constraint as part of the definition of the column it \nconstrains. You code a table-level constraint as if it is a separate column definition, \nand you name the columns it constrains within that definition. \n• \nA not null constraint prevents null values from being stored in the column. A \nunique constraint requires that each row has a unique value in the column but \nallows null values to be stored in the column. \n• \nA primary key constraint requires that each row has a unique value for the column \nor columns for the primary key, and it does not allow null values. \nFigure 11-3 \nHow to code a primary key constraint\n\n348 \nSection 3 \nDatabase design and impleme11,tation, \nHow to code a foreign key constraint \nFigure 11-4 shows how to code aforeign key constraint, which is also known \nas a reference constraint. This type of constraint is used to define the relation-\nships between tables and to enforce referential integrity. \nBefore I describe foreign key constraints, you should know that MySQL \nonly enforces these constraints if you are using the InnoDB storage engine for \nyour tables. If you are using another storage engine such as My ISAM, you can \nstill code foreign key constraints to show the relationships between the tables, \nbut MySQL doesn't enforce these relationships. You'll learn more about working \nwith the storage engines that are available from MySQL later in this chapter. \nTo create a foreign key constraint at the column level, you code the \nREFERENCES keyword followed by the name of the related table and the \nname of the related column in parentheses. In this figure, for instance, the frrst \nexample creates a table with a vendor_id column that includes a REFERENCES \nclause that identifies the vendor id column in the Vendors table as the related \ncolumn. \nThe second example shows how to code the same foreign key constraint \nshown in the first example at the table level. When you use this syntax, you \ncan include the CONSTRAINT keyword followed by a name, followed by \nthe FOREIGN KEY keywords. Although this requires a little 1nore code, it \nallows you to provide a name for the foreign key, which is a good program-\nming practice. It also lets you reference a foreign key that consists of multiple \ncolumns. \nThe third example in this figure shows what happens when you try to insert \na row into the Invoices table with a vendor_id value that isn't matched by the \nvendor_id column in the Vendors table. Because of the foreign key constraint, \nthe system enforces referential integrity by refusing to do the operation. It also \ndisplays an error message that indicates the constraint that was violated. \nSimilai·ly, if you try to delete a row from the Vendors table that has related \nrows in the Invoices table, the delete operation will fail and the system will \ndisplay an error message. Since this prevents rows in the Invoices table from \nbeing orphaned, this is usually what you want. \nIn some cases, though, you may want to automatically delete the related \nrows in the Invoices table when a row in the Vendors table is deleted. To do that, \nyou can code the ON DELETE clause on the foreign key constraint as illustrated \nby the fourth example. Here, this clause is coded with the CASCADE option. \nThen, when you delete a row from the primary key table, the delete is cascaded \nto the related rows in the foreign key table. If, for example, you delete a row \nfrom the Vendors table, all related rows in the Invoices table will also be deleted. \nBecause a cascading delete makes it easier to delete data that you didn't intend \nto delete, you should use it with caution. \nYou can also code the SET NULL option on the ON DELETE clause. Then, \nwhen you delete a row from the primary key table, the values in the foreign key \ncolumn of the foreign key table are set to null. Since this creates rows in the \nforeign key table that aren't related to the primary key table, you'll rarely want \nto use this option.\n\nChapter 11 \nHow to create databases, tables, and indexes \n349 \nThe syntax of a column-level foreign key constraint \n[CONSTRAINT] REFERENCES table_name (column_name) \n[ON DELETE {CASCADE ISET NULL}] \nThe syntax of a table-level foreign key constraint \n[CONSTRAINT constraint_name] \nFOREIGN KEY ( col 11mn_ name_ l [, column_ name_ 2] ••• ) \nREFERENCES table_name (column_ name_ l [, col11mn_name_ 2] ••• ) \n[ON DELETE {CASCADE ISET NULL}] \nA table with a column-level foreign key constraint \nCREATE TABLE invoices \n( \nPRIMARY KEY, \ninvoice_ id \nvendor_id \ninvoice_ number \nINT \nINT \nREFERENCES vendors (vendor_ id), \nVARCHAR ( 5 0) \nNOT NULL \nUNIQUE \n) \nA table with a table-level foreign key constraint \nCREATE TABLE invoices \n( \ninvoice_ id \nINT \nvendor_id \nINT \ninvoice_ number \nVARCHAR (SO) \nCONSTRAINT invoices_ fk_vendors \nPRIMARY KEY, \nNOT NULL, \nNOT NULL \nUNIQUE, \nFOREIGN KEY (vendor_ id) REFERENCES vendors (vendor_id) \n) \nAn INSERT statement that fails because a related row doesn't exist \nINSERT INTO invoices \nVALUES ( 1, 1, • 1 • ) \nThe response from the system \nError Code: 1452. Cannot add or update a child row: a foreign key con-\nstraint fails ('ex'.'invoices', CONSTRAINT 'invoices_ fk_vendors' FOREIGN \nKEY ('vendor_ id') REFERENCES 'vendors' ('vendor_id' ) ) \nA constraint that uses the ON DELETE clause \nCONSTRAINT invoices_ fk_vendors \nFOREIGN KEY (vendor_ id) REFERENCES vendors (vendor_ id) \nON DELETE CASCADE \nDescription \n• \nAforeign key constraint requires values in one table to match values in another \ntable. This defines the relationship between two tables and enforces referential \nintegrity. \n• \nTo define a relationship that consists of two or more columns, you must define the \nconstraint at the table level. \nFigure 11-4 \nHow to code a foreign key constraint\n\n350 \nSection 3 \nDatabase design and impleme11,tation, \nHow to alter the columns of a table \nAfter you create tables, you may need to change the columns of a table. For \nexample, you may need to add, modify, or drop a column. To do that, you can \nuse the ALTER TABLE statement shown in figure 11-5. \nThe first example in this figure shows how to add a new column to a table. \nTo do that, you code the column definition the same way you do when you \ncreate a new table. To start, you specify the column name. Then, you code the \ndata type and column attributes. \nThe second example shows how to drop an existing column. Note that \nMySQL prevents you from dropping some columns. For example, you can't \ndrop a column if it's the primary key column. \nThe third example shows how to modify th,e length of the data type for an \nexisting column. In this case, a column that was defined as VARCHAR(50) is \nchanged to VARCHAR(lOO). Since the new data type is bigger than the old data \ntype, you can be sure that the existing data will still fit. \nNotice in this example that the definition for the vendor_name column \nincludes the NOT NULL attribute that was included on the original colu1nn \ndefinition. If you don't include an existing attribute for a column when you \nmodify the colt1mn, that attribute is dropped from the column definition. The \nexceptions are attributes that define indexes, including the PRIMARY KEY and \nUNIQUE attributes. Because of that, you shouldn't code these attributes when \nmodifying an existing column. \nThe fourth example shows how to change the data type to a different data \ntype. In this case, a column that was defined as VARCHAR(lOO) is changed to \nCHAR(lOO). Since these data types both store the same type of characters, you \nknow that no data will be lost. \nThe fifth example shows how to change the default value for a column. \nIn this case, a default value of ''New Vendor'' is assigned to the vendor_name \ncolumn. \nThe sixth example shows how to change the name of a column. Here, the \nname of the vendor_name column is changed to v _name. Note that if you need \nto change both the name and definition of a column, you can do that more easily \nusing the CHANGE clause of the ALTER TABLE statement. For more informa-\ntion on this clause, see the MySQL Reference Manual. \nIn the first six statements, MySQL can alter the table without losing any \ndata. As a result, these statements execute successfully and alter the table. \nHowever, if the change will rest1lt in a loss of data, it's not allowed. For example, \nthe seventh statement attempts to change the length of the column whose name \nwas changed to v_name by the sixth example to a length that's too small for \nexisting data that's stored in this column. As a result, MySQL doesn't modify \nthe column, and the system returns an error message like the one shown in this \nfigure.\n\nChapter 11 \nHow to create databases, tables, and indexes \n351 \nThe syntax for modifying the columns of a table \nALTER TABLE [db_name.]table_name \n{ \nADD \ncolumn_ name data_ type [column_attributes] I \nDROP COLUMN \ncolumn_ name I \nMODIFY \nRENAME \n} \ncol 11mn_name data_ type [col11mn_attributes] I \nCOLUMN old_ column_ name TO new_ column_name \nA statement that adds a new column \nALTER TABLE vendors \nADD last_transaction_date DATE \nA statement that drops a column \nALTER TABLE vendors \nDROP COLUMN last_transaction_date \nA statement that changes the length of a column \nALTER TABLE vendors \nMODIFY vendor_ name VARCHAR ( lOO ) NOT NULL \nA statement that changes the data type of a column \nALTER TABLE vendors \nMODIFY vendor_name CHAR (lOO) NOT NULL \nA statement that changes the default value of a column \nALTER TABLE vendors \nMODIFY vendor_ name VARCHAR ( lOO ) NOT NULL DEFAULT 'New Vendor' \nA statement that changes the name of a column \nALTER TABLE vendors \nRENAME COLUMN vendor_ name TO v_ name \nA statement that fails because it would cause data to be lost \nALTER TABLE vendors \nMODIFY v_ name VARCHAR ( lO) NOT NULL \nThe response from the system \nError Code : 1265. Data truncated for column •v_name' at row 1 \nDescription \n• \nYou can use the ALTER TABLE statement to add, drop, or modify the columns of \nan existing table. \n• \nMySQL won't allow you to change a column if that change would cause data to be lost. \nWarning \n• \nYou should never alter a table or other database object in a production database \nwithout first consulting the DBA. \nFigure 11-5 \nHow to alter the columns of a table\n\n352 \nSection 3 \nDatabase design and impleme11,tation, \nHow to alter the constraints of a table \nYou may also need to change the constraints of a table after you create it. \nFor example, you may need to add or drop a constraint. To do that, you can use \nthe ALTER TABLE statement as shown in figure 11-6. \nThe first example shows how to add a primary key to a table. To do that, \nyou code the ADD PRIMARY KEY keywords followed by the names of the key \ncolumns in parentheses. \nThe second example shows how to add a foreign key to a table. This \nexample uses the FOREIGN KEY keywords to identify the vendor_id column as \nthe foreign key, and it uses the REFERENCES clause to identify the vendor_id \ncolumn in the Vendors table as the related column. In addition, this example \nincludes the optional CONSTRAINT keyword to provide a name for the foreign \nkey, which is a good programm_ing practice. \nThe third example uses the DROP PRIMARY KEY keywords to delete \nthe primary key for the Vendors table. Depending on how this table and the \nother tables in the database are defined, MySQL may not allow you to drop \nthe primary key for a table. That's true if the primary key is an auto increment \ncolumn or if it's referred to by foreign keys. Since most primary keys are \nreferred to by at least one foreign key, you can't typically delete a primary key. \nThe last example uses the DROP FOREIGN KEY keywords to drop the \ninvoices_fk_ vendors foreign key from the Invoices table. Because a table can \ncontain more than one foreign key, you must know the name of the key you want \nto drop. If you don't know its name, you can use MySQL Workbench to look it \nup as shown later in this chapter.\n\nChapter 11 \nHow to create databases, tables, and indexes \n353 \nThe syntax for modifying the constraints of a table \nALTER TABLE [dbname.]table_ name \n{ \nADD \nPRIMARY KEY constraint_definition \nADD \n[CONSTRAINT constraint name] FOREIGN KEY constraint_definition I \nDROP PRIMARY KEY I \nDROP FOREIGN KEY constraint_name \n} \nA statement that adds a primary key constraint \nALTER TABLE vendors \nADD PRIMARY KEY (vendor id) \nA statement that adds a foreign key constraint \nALTER TABLE invoices \nADD CONSTRAINT invoices_ fk_vendors \nFOREIGN KEY (vendor_ id) REFERENCES vendors (vendor_ id) \nA statement that drops a primary key constraint \nALTER TABLE vendors \nDROP PRIMARY KEY \nA statement that drops a foreign key constraint \nALTER TABLE invoices \nDROP FOREIGN KEY invoices_ fk_vendors \nDescription \n• \nYou can use the ALTER TABLE statement to add or drop the constraints of an \nexisting table. \n• \nTo drop a foreign key constraint, you must know its name. If you don't know its \nname, you can use MySQL Workbench to look up the name as shown later in this \nchapter. \nFigure 11-6 \nHow to alter the constraints of a table\n\n354 \nSection 3 \nDatabase design and impleme11,tation, \nHow to rename, truncate, and drop a table \nFigure 11-7 shows how to use the RENAME TABLE, TRUNCATE TABLE, \nand DROP TABLE statements. When you use these statements, use them \ncautiously, especially when you're working on a production database. \nTo start, you can use the RENAME TABLE statement to rename an existing \ntable. This is useful if you want to change the name of a table without modifying \nits column defmitions or the data that's stored in the table. In this figure, for \ninstance, the frrst example changes the name of the Vendors table to Vendor. If \nyou rename a table, you should probably update the names of any constraints \nthat use the name of the table. To do that, you have to drop the constraint and \nthen add it back. \nYou can use the TRUNCATE TABLE statement to delete all of the data from \na table without deleting the column definitions for the table. In this figure, for \ninstance, the second example deletes all rows from the newly renamed Vendor \ntable. \nYou can use the DROP TABLE statement to delete all of the data from a \ntable and also delete the definition of the table, including the constraints for the \ntable. In this figure, for instance, the third and fourth examples drop the Vendor \ntable. However, the fourth example explicitly specifies that it is dropping the \nVendor table that's stored in the EX database, not the Vendor table in another \ndatabase such as the AP database. \nWhen you issue a DROP TABLE statement, MySQL checks to see if other \ntables depend on the table you're trying to delete. If they do, MySQL won't \nallow the deletion. For instance, you can't delete the Vendors table from the \nAP database because a foreign key constraint in the Invoices table refers to the \nVendors table. If you try to delete the Vendors table, the system will return an \nerror message like the one shown in the frfth example. In that case, you must \ndrop the Invoices table before you can drop the Vendors table. \nWhen you drop a table, any indexes or triggers that have been defined for \nthe table are also dropped. You'll learn how to create indexes for a table in just a \nmoment. You'll learn how to create triggers for a table in chapter 16.\n\nChapter 11 \nHow to create databases, tables, and indexes \n355 \nA statement that renames a table \nRENAME TABLE vendors TO vendor \nA statement that deletes all data from a table \nTRUNCATE TABLE vendor \nA statement that deletes a table from the current database \nDROP TABLE vendor \nA statement that qualifies the table to be deleted \nDROP TABLE ex . vendor \nA statement that returns an error due to a foreign key reference \nDROP TABLE vendors \nThe response from the system \nError Code : 37 30. Cannot dr op t abl e 'vendor s ' refe renced by a f ore ign key \nconstraint ' invoice s _ fk_vendors ' on table 'invoices ' \nDescription \n• \nYou can use the RENAME TABLE statement to change the name of an existing \ntable. \n• \nYou can use the TRUNCATE TABLE statement to delete all data from a table \nwithout deleting the definition for the table. \n• \nYou can use the DROP TABLE statement to delete a table from the current \ndatabase. \n• \nTo rename, truncate, or drop a table from another database, you must qualify the \ntable naine with the database 11ame. \n• \nYou can't truncate or drop a table if a foreign key constraint in another table refers \nto that table. \n• \nWhen you drop a table, all of its data, constraints, and indexes are deleted. \nWarning \n• \nYou shouldn't use these statements on a production database without first \nconsulting the DBA. \nFigure 11-7 \nHow to rename, truncate, and drop a table\n\n356 \nSection 3 \nDatabase design and impleme11,tation, \nHow to work with indexes \nAn index speeds up joins and searches by providmg a way for a database \nmanagement system to go directly to a row rather than having to search through \nall the rows until it finds the one you want. By default, MySQL creates indexes \nfor the primary keys, foreign keys, and unique keys of a table. Usually, that's \nwhat you want. In addition, you may want to create indexes for other columns \nthat are used frequently in search conditions or joins. However, you'll want to \navoid creating indexes on columns that are updated frequently since this slows \ndown insert, update, and delete operations. \nHow to create an index \nFigure 11-8 presents the basic syntax of the CREATE INDEX statement, \nwhich creates an index based on one or more columns of a table. To create an \nindex, you na1ne the table and columns that the index will be based on in the ON \nclause. For each column, you can specify the ASC or DESC keyword to indicate \nwhether you want the index sorted in ascending or descending sequence. If \nyou don't specify a sort order, ASC is the default. In addition, you can use the \nUNIQUE keyword to specify that an index contains only unique values. \nYou may be interested to know that with releases of MySQL before 8.0, \nindexes weren't actually stored in descending sequence if you included the \nDESC keyword. Instead, when the index was used to access the table, the \nindex was scanned in reverse sequence, which resulted in poor performance. \nWith MySQL 8.0 and later, though, a descending index is actually stored in \ndescending sequence. That way, when the index is used to access the table, \nthe index can be scanned in forward sequence, which results in improved \nperformance. \nIn the examples in this figure, the names follow a standard naming conven-\ntion. To start, the index name specifies the name of the table, followed by \nthe name of the column or columns, followed by a s11ffix of IX. This naming \nconvention makes it easy to see which columns of which tables have been \nindexed. However, if the table or column names are lengthy, you can abbreviate \ntheir names in the name of the index. \nHow to drop an index \nThe last example in figure 11-8 shows how to use the DROP INDEX state-\nment to drop an index. You may want to drop an index if you suspect that it isn't \nspeeding up your joins and searches and that it may be slowing down your insert, \nupdate, and delete operations.\n\nChapter 11 \nHow to create databases, tables, and indexes \n357 \nThe syntax of the CREATE INDEX statement \nCREATE [UNIQUE] INDEX index_name \nON [dbname.Jtable_ name (column_name_ l \n[ASCIDESCJ [, \ncolumn_name_ 2 [ASCIDESC]J ... ) \nA statement that creates an index based on a single column \nCREATE INDEX invoices_ invoice_date_ ix \nON invoices (invoice_date) \nA statement that creates an index based on two columns \nCREATE INDEX invoices_vendor_ id_ invoice_number_ ix \nON invoices (vendor_ id, invoice_number) \nA statement that creates a unique index \nCREATE UNIQUE INDEX vendors_vendor_phone_ ix \nON vendors (vendor_phone) \nA statement that creates an index that's sorted in descending order \nCREATE INDEX invoices_ invoice_total_ ix \nON invoices (invoice_total DESC) \nA statement that drops an index \nDROP INDEX vendors_vendor_phone_ix ON vendors \nDescription \n• \nMySQL automatically creates an index for primary key, foreign key, and unique \nconstraints. \n• \nYou can use the CREATE INDEX statement to create other indexes for a table. An \nindex can improve performance when MySQL searches for rows in the table. \n• \nYou can use the DROP INDEX statement to drop an index from a table. \nFigure 11-8 \nHow to create and drop an index\n\n358 \nSection 3 \nDatabase design and impleme11,tation, \nA script that creates a database \nFigure 11-9 presents the DDL statements that are used to create the AP \ndatabase that's used throughout this book. In this figure, these statements are \ncoded as part of a script. \nAs you learned in earlier chapters, a script is a file that contains one or 1nore \nSQL statements. Scripts are often used to create the objects for a database as \nshown in this figure. When you code a script, you code a semicolon at the end of \neach SQL statement. \nThe DROP DATABASE IF EXISTS statement that begins this script drops \nthe entire database if it already exists, including all of its tables. This suppresses \nany error messages that would be displayed if you attempted to drop a database \nthat didn't exist. Then, the CREATE DATABASE statement creates the AP \ndatabase. \nThe USE statement selects the AP database. As a result, the rest of the state-\nments in the script are executed against the AP database. \nThe CREATE TABLE statements create the five main tables of the AP \ndatabase. For each statement, I coded the primary key column ( or columns) first. \nAlthough this isn't required, it's a good programming practice. After the primary \nkey, I coded the remaining columns in a logical order. That way, if you use a \nSELECT * statement to retrieve all of the columns, they're returned in a logical \norder. \nWhen you create tables, you must create the tables that don't have foreign \nkeys first. That way, the other tables can defme foreign keys that refer to them. \nIn this figure, for example, I created the General_Ledger_Accounts and Terms \ntables first since they don't have foreign keys. Then, I coded the Vendors table, \nwhich has foreign keys that refer to these tables. And so on. Conversely, when \nyou drop tables, you must drop the last table that was created first. Then, you can \nwork back to the first table that was created. Otherwise, the foreign keys might \nnot allow you to delete the tables.\n\nChapter 11 \nHow to create databases, tables, and indexes \nThe SQL script that creates the AP database \n-- create the database \nDROP DATABASE IF EXISTS ap; \nCREATE DATABASE ap; \n-- select the database \nUSE ap; \n-- create the tables \nCREATE TABLE general_ ledger_accounts \n{ \naccount_ number \naccount_description \n) ; \nCREATE TABLE terms \n( \nINT \nVARCHAR ( 5 0) \nPRIMARY KEY, \nUNIQUE \nPage 1 \nterms id \nterms_description \nterms_due_days \nINT \nVARCHAR ( 5 0) \nINT \nPRIMARY KEY \nNOT NULL, \nNOT NULL \nAUTO_ INCREMENT, \n) ; \nCREATE TABLE vendors \n( \nvendor_id \nvendor_ name \nvendor_addressl \nvendor_address2 \nvendor_city \nvendor_state \nvendor_zip_ code \nvendor_phone \nvendor contact last name \nvendor_contact_first_name \ndefault terms id \ndefault_account_number \nCONSTRAINT vendors fk terms \n-\n-\nINT \nVARCHAR ( 5 0) \nVARCHAR(SO), \nVARCHAR(SO), \nVARCHAR ( 5 0) \nCHAR{2) \nVARCHAR ( 2 0) \nVARCHAR(SO), \nVARCHAR(SO), \nVARCHAR( 50), \nINT \nINT \nFOREIGN KEY {default_terms_ id) \nREFERENCES terms ( terms_ id) , \nCONSTRAINT vendors_fk_accounts \nFOREIGN KEY {default_account_ number) \nPRIMARY KEY \nNOT NULL \nNOT NULL, \nNOT NULL, \nNOT NULL, \nNOT NULL, \nNOT NULL, \nREFERENCES general_ ledger_accounts (account_number) \n) ; \nFigure 11-9 \nThe script used to create the AP database (part 1 of 2) \nAUTO_ INCREMENT, \nUNIQUE, \n359\n\n360 \nSection 3 \nDatabase design and impleme11,tation, \nFor most of the columns in these tables, I coded a NOT NULL constraint \nor a DEFAULT attribute. In general, I only allow a column to accept null values \nwhen I want to allow for unknown values. If, for example, a vendor doesn't \nsupply an address, the address is unknown. In that case, you can store a null \nvalue in the vendor address 1 and vendor address2 columns. \n-\n-\nAnother option is to store an empty string for these columns. To do that, I \ncould have defmed the vendor address columns like this: \nvendor_addressl \nVARCHAR(SO} \nDEFAULT \n1 ', \nvendor_address2 \nVARCHAR(SO) \nDEFAULT'', \nIn this case, empty strings will be stored for these columns un]ess other values \nare assigned to them. \nIn practice, a null value is a 1nore intuitive representation of an unknown \nvalue than a default value is. Conversely, it makes sense to use a default value \nlike an empty string to indicate that a value is known but the column is empty. \nFor example, an empty string might indicate that a vendor hasn't provided its \nstreet address. Although how you use nulls and empty strings is largely a matter \nof personal preference, it does affect the way you query a table. \nWhen a primary key consisted of a single column, I coded the PRIMARY \nKEY constraint at the column level. Similarly, I coded the UNIQUE constraint \nat the column level. As a result, I didn't provide names for these constraints. \nHowever, whenever I coded a primary key or foreign key constraint at the \ntable level, I followed a convention that begins with the name of the table or an \nabbreviated name for the table. \nAs you know, when MySQL creates a table, it automatically creates indexes \nfor the primary key, foreign keys, and unique keys. MySQL uses the name \n''PRIMARY'' for the name of the index for a table's p1imary key. It uses the \nname of the column for the name of the index for a unique key. And it uses the \nname of the foreign key for the name of the index for a foreign key column. \nFor the Invoices table, for example, MySQL automatically creates an index \nnamed ''PRIMARY'' for the invoice_id column, it creates an index named \ninvoices_fk_ vendors for the vendor_id column, and it creates an index named \ninvoices_fk_terrns for the terrns_id column. \nIn addition to the indexes that are created automatically, I used a CREATE \nINDEX statement to create an index for the invoice date column in the Invoices \ntable. Since this column is frequently used to search for rows in this table, \nthis index should improve performance of the database. To name this index, I \nfollowed the naming conventions presented earlier in this chapter. As a result, \nwhen you view the name of an index, you can easily identify the table and \ncolumn that's being indexed.\n\nChapter 11 \nHow to create databases, tables, and indexes \nThe SQL script that creates the AP database \nCREATE TABLE \n( \n• \n• \ninvoices \ninvoice_ id \nvendor_ id \ninvoice_number \ninvoice_date \ninvoice_ total \npayment_ total \ncredit_ total \nINT \nPRIMARY KEY \n) ; \nterms_ id \nINT \nVARCHAR(SO) \nDATE \nDECIMAL(9,2) \nDECIMAL(9,2) \nDECIMAL(9,2) \nINT \ninvoice_due_date \nDATE \npayment_date \nDATE, \nCONSTRAINT invoices_ fk vendors \nFOREIGN KEY (vendor id) \nREFERENCES vendors (vendor_ id), \nCONSTRAINT invoices_ fk_terms \nFOREIGN KEY (terms_ id) \nREFERENCES terms (terms id) \nCREATE TABLE invoice line items \n( \ninvoice_ id \nINT \n• \n• \n1nvo1ce_sequence \nINT \nINT \nNOT \nNOT \nNOT \nNOT \nNOT \nNOT \nNOT \nNOT \naccount number \nline_ item_amount \nline_ item_description \nCONSTRAINT line_ items_pk \nDECIMAL(9,2) \nVARCHAR(lOO) \nNULL, \nNULL, \nNULL, \nNULL, \nNULL \nNULL \nNULL, \nNULL, \nNOT \nNOT \nNOT \nNOT \nNOT \nPRIMARY KEY (invoice_ id, invoice_sequence), \nCONSTRAINT line_ items_ fk_ invoices \nFOREIGN KEY (invoice id) \nREFERENCES invoices (invoice_ id), \nCONSTRAINT line_ items_ fk_acounts \nFOREIGN KEY (account number) \nNULL, \nNULL, \nNULL, \nNULL, \nNULL, \nAUTO_ INCREMENT, \nDEFAULT O, \nDEFAULT 0, \nREFERENCES general_ ledger_accounts (account number) \n) ; \n-- create an index \nCREATE INDEX invoices_ invoice date ix \nON invoices (invoice_date DESC); \nFigure 11-9 \nThe script used to create the AP database (part 2 of 2) \nPage2 \n361\n\n362 \nSection 3 \nDatabase design and impleme11,tation, \nHow to use MySQL Workbench \nSince you often use a script to create tables and other database objects, it's \nimportant to understand the DDL skills presented in this chapter. Once you \nunderstand these skills, it's easy to learn how to use a graphical user interface \nsuch as MySQL Workbench to work with database objects such as tables and \nindexes. For example, it's often useful to view these database objects before \nwriting the SELECT, INSERT, UPDATE, or DELETE statements that use them. \nHow to work with the columns of a table \nFigure 11-10 shows how to work with the column defmitions of a table. To \nstart, you can view the column defmitions for a table by right-clicking on the \ntable in the Navigator window and selecting Alter Table to display the table in \nthe main window. Then, click on the Columns tab at the bottom of the window. \nFor example, this figure shows the columns for the Invoices table. Here, you \ncan see the name, data type, and other attributes of each column. For instance, \nyou can see that the invoice_id column is the primary key column and an auto \nincrement column. The payment_total and credit_total columns specify a default \nvalue of 0.00. And the pay1nent_date column allows null values and its default \nvalue is NULL. \nIf you need to add a new column, you can double-click below the last name \nin the Column Name column. Then, you can type in a name for the new column, \nand you can specify its attributes to the right of the column name. \nYou can also work with a new or existing column using the controls below \nthe list of columns. In this figure, for example, I've selected the invoice_id \ncolumn, so the information for that column is displayed below the column list. \nThis is useful if you aren't familiar with the abbreviations that are used for the \ncheck boxes in the column list, since these attributes are clearly identified by the \ncheck boxes below the list. You can also use the Charset and Collation drop-\ndown lists to change the character set and collation for some columns. You'll \nlearn more about that later in this chapter.\n\nChapter 11 \nHow to create databases, tables, and indexes \nThe column definitions for the Invoices table \n■ \nMySQl. Workbench \nD \nX \n6 \nLocal instance MySQL80 x \nFile \nEdit \nVtew \nQuery \nDatabase \nServeT \nTools \nScripting \nHelp \nN IV gato, \nQuay, \nil:4❖?ftlffll'1il-L ____________________ _ \nSOlEMAS \n~ IFllter abJeds \n., J ap \nT'al Tables \n► Iii general_ledg,r_accounts \n► i1 invoice_1rchlve \n► iii lnvolce_hne_items \n► ii Invoices \n► ii terms \n► Iii vendor_contacts \n► El vendors \nloJ Viev.-s \n'ell stored Procedures \nlc)l Functions \n► \nex \n► \nom \n.. \n=• \nAdminlstntlon \nSchemas \nlnformabon \nTab~ 1nll0lces \nColumns: \nin \n• . 1d \nnt{U) Al PK \nv~ id \nnt{ll) \nlnvoice_runber \nvarctw(SO) \ninvoice date \ndate \nnvoice_ liita! \ndeornel{9, 2l \npayment_tutal \n~9,2 \naedit_tutal \ndeo \n9,2 \nternts_id \nr,t{U) \nj \n,., \nV \nV \nTable Name: E._ \n_______ ___.I Schema: \nap \nOlarset/Collation: \nutft!mb4 \nv \nutfanb4_0900_ v \nEngine: [!maOB \nCooments: \nColumnName \n,nvoic,_ld \nvendor_icf \nlnvofce_number \ninvolce_d1te \nlnvoice_total \n< \nDatatype \nINT{ll) \nINT{l 1) \nVARCHAR(SO) \nDATE \nOECIMAL(9,2) \nCdl.lm Name: ,__l\n1nv_oice_1c1 _____ _. \nOlarsetft:;olaban: \nL \nDefault Cobb \n--~ \nC0!!1!lents: \nPK \n~ UQ \n8 \nLN \n1r \nE2l \nE2l □ □ □ □ \n□ E2l □ □ □ □ \n□ E2l □ □ □ □ \n□ E2l □ □ □ □ \n□ E2l □ □ □ □ \nData Type: IINT(ll) \nOefcNJt: \nSU>rage: \nVirtual \nE2l Pnmary Key \n□ \nBinary \nE2) Aull> Increment \nColumns \nIndexes \nForeign IC~~ \nTng11ers \nPartitioning \nOptiom \nAl \nG \nOefautft=xpresslon \nE2l □ \n□ □ \n□ □ \n□ □ \n□ □ \nStured \nE2l NotNul \n□ \nlhque \n□Unsigned D ZeroAII \n0 Gerle'ated \nV \n> \n--- .-1.,- Aat. \n\"4:ata \nObJ,c: Info \nSession \nRevert \nDescription \n• \nTo view the columns for a table, right-click on the table in the Navigator window, \nselect the Alter Table item, and click on the Columns tab. \n• \nTo rename a column, double-click on the column name and enter the new name. \n• \nTo change the data type for a column, click on the data type in the Datatype \ncolt1mn. Then, select a data type from the drop-down list that's displayed. \n• \nTo change the default value for a column, enter a new default valt1e in the Default \ncolumn. \n• \nTo change other attributes of the column, check or uncheck the attribute check \nboxes to the right of the column. \n• \nTo drop a column, right-click on the column name and select the Delete Selected \nitem. \n• \nTo move a column up or down, right-click on the column name and select the Move \nUp or Move Down item. You can also use the Up and Down keys on the keyboard. \n• \nTo add a new column, double-click in the Column Name column below the last \ncolumn and type in a new name. Then, specify the attributes for the new column. \n• \nTo apply the changes to the table, click the Apply button. To reverse the changes, \nclick the Revert button. \nFigure 11-10 \nHow to work with the columns of a table \ny \n363\n\n364 \nSection 3 \nDatabase design and impleme11,tation, \nHow to work with the indexes of a table \nAlthough MySQL Workbench provides several ways to work with indexes, \none of the easiest is to right-click on the table in the Navigator window and \nselect the Alter Table command to display the table defmition. Then, you can \nclick on the Indexes tab to display the indexes of the table. For example, figure \n11-11 shows the indexes for the Invoices table. \nIn most cases, you'll use this tab to add indexes to a table. To do that, you \nstart by double-clicking below the last index name and entering the name of the \nnew index. Then, you can select the type of index you want to create, the column \nor columns you want to index, and the order for each column. To change or drop \nan index, you can use the skills presented in this figure.\n\nChapter 11 \nHow to create databases, tables, and indexes \nThe indexes for the Invoices table \n■ \nMySQl. Workbench \nD \nX \n6 \nLocal instance MySQLSO x \nFile \nEdit \nVtew \nQuery \nDatabase \nSefver \nTools \nScripting \nHelp \nfjl \n&il lil &l Bi!l rai ~ \nSCHEMAS \n~ IRter ol)Jccn \n• U ap \n• \nTables \n► II oenual_ledoer_accounts \n► i1 invoice_archive \n► iii ln,olce_hne_items \n► C Invoices \n► El turns \n► &l vendor_conta<ts \n► Cl vendors \nViews \n'cl'.l stored Procedures \n'cl Functions \n► \nex \n► \nom \n.. \n=• \nAdministration \nSchemas \nInformation \nColumns: = ~ \n~~i~j Al PK \nnvoke_runber \nvardw(SO) \ninvoic~ date. \ndare \nnvoice.Jiital \ndrotN,1{9,2) \npayment_total \ndeomal(9,2) \naedit_total \ndeomo1(9,2J \nte.rms_id \nnt(U) \n--- ~.., Aa ♦a .-.st. \nOb)ea Info \nS5SIOO \nDescription \nj \n,., \nV \nV \nQuery 1 \nil:1-:\\i& \nTable Name: F \nI Schema: \nap \nL-----------' \nOlarset/Collation: \nutfl!tnb4 \nv lutf8mb4_0900_ v \nEngine: \n[ lmoOB \nCooments: \nIndex Name \nTyi:,e \ntndexCoums--------\nPRIMARY \nPRIMARY \nmvo,ces_l'k_vendors \nINDEX \nlnvoices_fk_terms \nINDEX \nmvo1cesjnvoice_~. 1NOEX \nColumn \n;; \n0 ,nvoice_d \n0 veodor_ld \n0 lnvolce_number \n0 invoice_date \nl \n0 lnvoice_total \n0 payment_total \n0 credit_tota \n0 terms_ld \n0 involce_due_date \nD payment_date \n< \nColumns \nInd~ \nForeio11 Keys \nTnogers \nPartrtionlng \nOptioM \n~ l~ \nASC \nASC \nASC \nDESC \nASC \nASC \nASC \nASC \nASC \nASC \n> \nIndex Opbons \nStorage Type: \nKey Block Sae: lo \nParser: I \nV~: 1:21 \nIndex Comment \n• \nTo view the indexes for a table, right-click on the table in the Navigator window, \nselect the Alter Table item, and click on the Indexes tab. \n• \nTo rename an index, double-click on the name and enter the new name. \n• \nTo change the type of an index, click on the Type column. Then, select a type from \nthe drop-down list that appears. \nRevert \n• \nTo change the colu1nn that's indexed, select the index and then select its column in \nthe list of columns that appears. You can also change the sort order of the index by \nclicking in the Order column and then selecting ASC or DESC from the drop-down \nlist that appears. \n• \nTo drop an index, right-click on the index name and select the Delete Selected item. \n• \nTo add a new index, double-click below the last index name and type in a new \nname. Then, specify the type, column, and order for the index. \n• \nTo apply the changes to the table, click the Apply button. To reverse the changes, \nclick the Revert button. \nFigure 11 -11 \nHow to work with the indexes of a table \nV \n365\n\n366 \nSection 3 \nDatabase design and impleme11,tation, \nHow to work with the foreign keys of a table \nTo work with the foreign keys of a table, you use the Foreign Keys tab. For \nexample, figure 11-12 shows the foreign keys for the Invoices table, and the \nforeign key named invoices_fk_terms is selected. Here, MySQL Workbench \nshows the table that's refe1·enced by the foreign key, the foreign key column, and \nthe column that's referenced by the foreign key. If you need to, you can change \nany of the information that defmes the foreign key as described in this figure. \nYou can also add new foreign keys, and you can drop existing keys.\n\nChapter 11 \nHow to create databases, tables, and indexes \nThe foreign keys for the Invoices table \n■ \nMySQl. Workbench \nD \nX \n6 \n1.oca1 IMlance MySOLSO x \nFile \nEdit \nVtew \nQuery \nDatabase \nServer \nTools \nScripting \nHelp \nouerv 1 \nil:1·\\Hftlffll,;i■iiL _____________________ _ \nSCHEMAS \n~ 1Ft11er abjects \nT J ap \nT \nTables \n► □ oeneral_ledoer_accounts \n► il invoice_archlve \n► Ii lnvolce_hne_1tems \n► 0 Invoice. \nj \n,.. \nTable Name: fi±es,___ _______ _,I Schema: \nap \nOiarsetjCollation: \nutft!tnb4 \nv lutf8mb4_0900_ v \n~: llmoOB \nV \nC«nments: \nQiunn \nRefereoced Cobl Foreign Key Options \n► Eil terms \n► Iii vendor_contaas \n► D vendors \nVlev.s \nForeq1 Key Name \nlnvolce~_fk_terrm \ninvoices _flc_ ve:ndcn \nReferenced Table \n·ap· : terms· \n· ap · : vendors· \nD invoice_id \nD vendor_id \nOn ~ate: \nRESTRICT \n-------=::::: \n'ell stored Procedures \n► \nex \n► \nom \n.. \n=• \nFunctions \nAdministration \nSchemas \nInform<lbon \nColumns: \n~~ \n~ \n~~~~ Al PK \nlnvoice_runber \nvardl.Y(SO) \ninvoice date \ndate \nrwoice_lotal \ndeomlll(9,fil \npayment_total \ndeomal(9,2 \naedit_total \ndeomal(9, \nterms_id \nnt(U) \n--- _,._ Aa ♦• \nris.,_ \nObjea Info \nSess-lon \nDescription \n.., \n.., \nD lnvolce_number \nD invoice_date \nD invo1ce_total \nD payme:nt_total \nD aed1t_total \n0 terms_id \nterms_id \nD invo1ce_due_date \nD payment_date \n< \n> < \nColumns \nlndexes \nFore19n Keys \nTnggl!TS \nPartitioning \nOptioro \nOn Delete: \nR.ESTRrCT \nD Slap In SQl gener-ation \nFor~ Kev Comme-tt ----\n> \n• \nTo view the foreign keys for a table, right-click on the table in the Navigator \nwindow, select the Alter Table item, and click on the Foreign Keys tab. \n• \nTo rename a foreign key, double-click on the name and enter the new name. \n• \nTo change the referenced table, click on the table name in the Referenced Table \ncolt1m.n and select a table from the drop-down }jst that appears. \n• \nTo change the colu1nn or referenced column for a foreign key, select the foreign key \nand then select the column or referenced column in the list that appears. \n• \nTo drop a foreign key, right-click on its name and select the Delete Selected item. \n• \nTo add a new foreign key, double-click below the last foreign key name and type in \na new name. Then, specify the referenced table, foreign key column, and referenced \ncolumn. \n• \nTo apply the changes to the table, click the Apply button. To reverse the changes, \nclick the Revert button. \nFigure 11 -12 \nHow to work with the foreign keys of a table \n367\n\n368 \nSection 3 \nDatabase design and impleme11,tation, \nHow to work with character sets \nand collations \nSo far, this book has assumed that you're working with the default chai·acter \nset and collation for yoL1r MySQL server. In this topic, you'll learn more about \ncharacters sets and collations and why yoLI might want to use a character set or \ncollation that's different from the default. Then, you'll learn how to specify the \ncharacter set and collation for a database, a table, or even a column. \nAn introduction to character sets \nand collations \nWhen a column is defmed with a string type such as CHAR or VARCHAR, \nMySQL stores a numeric value for each character. Then, it uses a character set \nto map the numeric values to the characters of the string. \nFigure 11-13 begins by presenting three character sets that are commonly \nused by MySQL. To start, it presents the default character set for MySQL 5.5 \nand earlier: the latinl character set. This character set uses one byte per character \nto provide for most characters in Western European languages. However, if you \nneed to store other characters, you can use the utf8mb3 or utf8mb4 character set. \nThe utf8mb3 character set is the default for MySQL 5.6 and 5.7, and the \nutf8mb4 character set is the default for MySQL 8.0 and later. Currently, MySQL \nrefers to the utf8mb3 character set with the alias utf8. However, the t1tf8mb3 \ncharacter set is deprecated and will be removed in a future release of MySQL. \nWhen that happens, t1tf8 will become an alias for the utf8mb4 character set. \nBecause of that, you should explicitly specify utf8mb4 if th,at's the character set \nyou want to use. \nThe advantage of the utf8mb4 character set is that it provides for all charac-\nters specified by the Unicode character set. This includes most characters from \nmost languages worldwide. As a result, it's appropriate when you 're going to be \nworking with a global application that needs to be able to store characters from \nmultiple languages. You can also use it to store chai·acters like emojis, which are \nbecoming more and more common. \nThe disadvantage of the utf8mb4 character set is that it can use up to four \nbytes per character. This forces MySQL to reserve four bytes per character for \neach character in the CHAR type. As a result, this can increase data storage \nrequirements for a database that makes extensive use of the CHAR type. \nFortunately, this typically isn't an issue. If it is, you can fix the issue by using the \nVARCHAR type instead of the CHAR type. \nEvery character set has a corresponding collation that determines how the \ncharacters within the set are sorted. For example, the latinl character set uses \nthe collation named latinl_swedish_ci by default, since MySQL was developed \nin Sweden. Here, the beginning of the name shows that it corresponds with the \nlatin 1 character set. In addition, the ci at the end shows that it is case-insensitive. \nThis means that MySQL sorts uppercase letters such as A and lowercase letters \nsuch as a at the same level, which is usually what you want.\n\nChapter 11 \nHow to create databases, tables, and indexes \n369 \nThree commonly used character sets \nName \nDescription \nlatinl \nThe latinl character set uses one byte per character to provide for most characters in \nWestern European languages. \nutf8mb3 \nThe utf8mb3 character set uses one to three bytes per character to provide for aJJ \ncharacters specified by the Unicode character set. This character set provides for most \ncharacters in most of the world's languages. \nutf8mb4 \nThe utf8mb4 character set uses one to four bytes per character to provide for all char-\nacters specified by the Unicode character set, plus additional characters like emojis. \nFour collations for the latin1 character set \nName \nDescription \nlatinl swedish ci \n-\n-\nlatinl general ci \n-\n-\nlatinl general cs \n-\n-\nlatinl bin \n-\nThe default collation for the latinl character set. \nA general purpose, case-insensitive collation. \nA general purpose, case-sensitive collation. \nThe binary collation for this character set. \nFour collations for the utf8mb3 character set \nName \nDescription \nutf8_general_ ci \nutf8 unicode ci \n-\nutf8 spanish c i \n-\n-\nutf8 bin \nThe default co]lation for the utf8mb3 (utf8) character set. \nA case-insensitive collation that provides for more correct so1ting. \nA case-insensitive collation for the Spanish language. \nThe binary col]atio11 for this character set. \nThree collations for the utf8mb4 character set \nName \nDescription \nut f8mb4 0 900 \n. \n. \nal. Cl. \n-\n-\n-\nutf8mb4 0900 as cs \nutf8mb4 bin \nDescription \nThe default collation for the utf8rnb4 character set. \nAn accent-sensitive, case-sensitive collatio.n. \nThe binary collation for this charactei- set. \n• \nThe character set that's used by a database, table, or column determines which \ncharacters can be stored and how many bytes are used to store the characters. \n• \nEvery character set has a corresponding collation that determines how the characters \nwithin the set are sorted. \n• If the name of a collation ends with ci, the collation is case-insensitive. If the name \nof a collation ends with cs, the collation is case-sensitive. \n• \nIf the name of a collation includes ai, the collation is accent-insensitive. If the name \nof a collation includes as, the collation is accent-sensitive. \n• If the name of a collation ends with bin, the collation is binary, which means that the \ncharacters are sorted according to the binary numbers that correspond to each character. \nFigure 11-13 \nAn introduction to character sets and collations\n\n370 \nSection 3 \nDatabase design and impleme11,tation, \nIf MySQL isn't sorting characters the way you want, you can use another \ncharacter set and collation. If you're using utf8mb3, for example, you can use the \nutf8_unicode_ci collation instead of the default of utf8_general_ci. This colla-\ntion provides more correct sorting, although it isn't as fast as utf8_general_ci. \nRemember, though, that the utf8mb3 character set is deprecated, so you \nshould use utf8mb4 instead for new development. In that case, the default colla-\ntion of utf8mb4_0900_ai_ci usually works the way you want. However, if you \nwant to use a case-sensitive sort, you can use a collation with a name that ends \nwith cs. Or, you can use a collation with a name that ends with bin, which stands \nfor binary. This sorts characters by their nu1neric values instead of by their \ncharacter values. Finally, if you want to use an accent-sensitive sort, you can use \na collation that includes as. \nHow to view character sets and collations \nFigure 11-14 starts by showing how to view all character sets that are \navailable on your MySQL server. To do that, you use the SHOW CHARSET \nstatement as shown in the first example. As the results of this statement show, the \nSHOW CHARSET statement displays information about each character set in \naddition to its name. \nYou can also use the SHOW CHARSET statement to view information \nabout a single character set. To do that, you can use a LIKE clause to identify the \ncharacter set as shown in the second example. \nThis figure also shows how to use the SHOW COLLATION statement to \nview information about collations. For instance, the third example in this figure \nshows how to view information about all the collations that are available on the \ncurrent server. In the rest1lt set that's returned by this statement, you can see \nsome of the collations for the utf8mb4 character set. \nIf you only want to view the collations for a specific character set, you can \nuse a LIKE clause with the % wildcard character. In this figure, for example, the \nsecond SHOW COLLATION statement shows the collations for the utf8mb4 \ncharacter set. \nThe next four examples in this figure show how to use the SHOW \nVARIABLES statement to view the default character set and collation for your \ncurrent server or database. In these examples, the LIKE clause is used to specify \nthe name of a variable. For example, to view the default character set for a \nserver, you use the character_set_server variable. \nYou can also view the character set and collation for all the tables in a \ndatabase. To do that, you can query the table named Tables in the database \nnamed Inf orrnation_Schema as shown in the last example. Here, the SELECT \nstatement returns the table name and table collation for each table in the AP \ndatabase. Since the name of the collation also identifies the character set, this \nindicates the character set for each table.\n\nChapter 11 \nHow to create databases, tables, and indexes \n371 \nHow to view all available character sets for a server \nSHOW CHARSET \nCharset \nDescription \nDefault collabon \nutf16 \nUTF-16 Unicode \nutf 16 _general_d \nutf16le \nUlF-16LE Unicode \nutf161e_general_d \nutf.32 \nUTF-32 Unicode \nutf32_general_d \nutf8 \nUTF-8 Unicode \nutf8_general_d \nutf8mb4 \nUTF-8 Unicode \nutf8mb4_0900_ai_ci \nHow to view a specific character set \nSHOW CHARSET LIKE 'utf8mb4' \nMaxlen \n4 \n4 \n4 \n3 \n4 \nHow to view all available collations for a server \nSHOW COLLATION \nCoftabon \nCharset \n1d \nDefault \nCompiled \nSortien \nPad_attribute \nutf8mb4_0900_ai_d \nutf8mb4 \n255 \nYes \nYes \n0 \nNO PAD \nutf8mb4_0900_as_d \nutf8mb4 \n305 \nYes \n0 \nNOPAD \nutf8mb4_0900_as_cs \nutf8mb4 \n278 \nYes \n0 \nNO PAD \nutf8mb4 bin \nutf8mb4 \n416 \nYes \n1 \nPAD SPACE \nutf8mb4 _croatian _d \nutf8mb4 \n245 \nYes \n8 \nPAD SPACE \nutf8mb4 cs 0900 al a \n- -\n- -\nutf8mb4 \n266 \nYes \n0 \nNO PAD \nutf8mb4_cs_0900_as_cs utf8mb4 \n289 \nYes \n0 \nNO PAD \nutf8mb4_czech_d \nutf8mb4 \n234 \nYes \n8 \nPAD SPACE \nutf8mb4_danish_d \nutf8mb4 \n235 \nYes \n8 \nPAD SPACE \nHow to view all available collations for a specific character set \nSHOW COLLATION LIKE 'utf8mb4%' \nHow to view the default character set for a server \nSHOW VARIABLES LIKE 'character_set_ server' \nHow to view the default collation for a server \nSHOW VARIABLES LIKE 'collation server• \nHow to view the default character set for a database \nSHOW VARIABLES LIKE 'character_ set_database' \nHow to view the default collation for a database \nSHOW VARIABLES LIKE 'collation_database' \n,. \ni .., \n,. \n--\n.., \nHow to view the character set and collation for all the tables in a database \nSELECT table_name, table_collation \nFROM information_ schema.tables \nWHERE table_ schema = •ap' \nTABLE_NAME \nTABLE_COLLATION \n-\ninvoice _line j terns \nutf8mb4_0900 _ai_d \n. \n. \nutf8mb4 _0900 _ai_ci \n1nv01ces \nterms \nutf8mb4_0900_ai_o \nFigure 11-14 \nHow to view character sets and collations \n\"' \n-\n\\I\n\n372 \nSection 3 \nDatabase design and impleme11,tation, \nHow to specify a character set and a collation \nFigure 11-15 shows how to specify a character set and a collation at three \nlevels: database, table, and column. In most cases, you want to specify the \ncharacter set and collation at the database level as shown in the first group of \nexamples. Then, all the columns in all of the tables that store string data are \ndefined with that character set and collation. If necessary, though, you can also \nset the character set and collation at the table or column level as shown by the \nsecond and third groups of examples. \nTo specify a character set or collation, you can use the CHARSET or \nCOLLATE clauses. For a new database or table, you can add these clauses to the \nCREATE statement for the database or table. For an existing database or table, \nyou can add these clauses to the ALTER statement for the database or table. \nMost of the examples in this figure use both the CHARSET and COLLATE \nclauses. This clearly shows the character set and collation that are being speci-\nfied. In most cases, though, you only need to use one clause or the other. That's \nbecause every character set has a default collation, and every collation has a \ncorresponding character set. As a result, if you omit the COLLATE clause, \nMySQL uses the default collation for the specified character set. And, if you \nomit the CHARSET claL1se, MySQL uses the character set that corresponds with \nthe specified collation. If you want to use a collation other than the default for a \ncharacter set, then, you can do that by coding the COLLATE clause without the \nCHARSET clause. \nYou can also use MySQL Workbench to change the character set and colla-\ntion for a table or column. To do that, you use the Columns tab that you saw \nin figure 11-10. To change the character set and collation for a table, you use \nthe Charset and Collation drop-down lists at the top of this tab. To change the \ncharacter set and collation for a column, you select the column and then use the \nCharset and Collation drop-down lists below the list of columns.\n\n37 4 \nSection 3 \nDatabase design and impleme11,tation, \nHow to work with storage engines \nA storage engine determines how MySQL stores data and which database \nfeatures are available to you. Unlike many other databases, MySQL provides \nseveral different storage engines that you can use, and each of these engines \nprovides slightly different feattu·es. \nAn introduction to storage engines \nFigure 11-16 begins by presenting the two most common! y used storage \nengines: InnoDB and MyISAM. The InnoDB engine is the default engine for \nMySQL 5.5 and later. As a result, if you installed the software as described in \nappendix A or B of this book, you have been using the InnoDB engine so far. \nThis engine supports foreign keys as described earlier in this chapter. In addition, \nit supports transactions, which are desc1ibed in chapter 14. \nPrior to MySQL 5.5, the MyISAM engine was the default storage engine. As \na result, if you ever work on an older MySQL database, there's a good chance its \ntables use the MyISAM engine. This engine supports some features that weren't \nsupported by InnoDB tables until later releases of MySQL, including full-text \nsearches and spatial data types. However, the My ISAM engine doesn't support \nforeign keys, an important feature for maintaining referential integrity. \nAlthough this chapter doesn't cover the full-text search feature, you should \nknow that this feature makes it easier and faster to search string data using \nnatural language search strings. To use this feature, you create a special type of \nindex called a FULLTEXT index. Then, you can use full-text search features in \nyour SELECT statements. For more information about how this works, you can \nsearch the Internet. \nHow to view storage engines \nFigure 11-16 also shows how to view information about storage engines. To \nstart, it shows how to use the SHOW ENGINES statement to view all available \nstorage engines for the current server. In this fig1rre, for example, the result set \nshows that the InnoDB storage engine is the default storage engine for the server. \nIn addition, it shows that several other storage engines are available to the server. \nOf these, the My ISAM storage engine is the most significant since it was the \ndefault storage engine in earlier versions of MySQL. \nIf you want to qt1ickly view the default storage engine for the server, you \ncan use the SHOW VARIABLES statement shown in this figure. This statement \nreturns a single row that includes the name of the default storage engine. \nIf you want to view the storage engine that's used for all the tables \nin a database, you can use a SELECT statement to query the tables in the \nInformation_Schema database as shown in the last example. Here, the SELECT \nstatement displays the table name and storage engine for the tables in the AP \ndatabase. You can also display this information for all tables on the server by \nremoving the WHERE clause from this SELECT statement.\n\nChapter 11 \nHow to create databases, tables, and indexes \nTwo commonly used storage engines \nName \nDescription \nInnoDB \nMyISAM \nThe default storage engine for MySQL 5.5 and later. This \nengine supports foreign keys and transactions. It also sup-\nports full-text searching as of MySQL 5.6 and the spatial \ndata types as of MySQL 5.7. \nThe default storage engine prior to MySQL 5.5. This engine \nsupports full-text searching and the spatial data types. \nHow to view all storage engines for a server \nSHOW ENGINES \nEngine \nSupport \nComment \nTransactions \nXA \nSavepoints \n► \nMEfl.10RY \nYES \nHash based, stored in memory, useful for temp ... NO \nNO \nNO \nMRG_MYISAM \nYES \nCollection of identical MyISAM tables \nNO \nNO \nNO \ncsv \nYES \nCSV storage engine \nNO \nNO \nNO \nFEDERATED \nNO \nFederated MySQL storage engine \n1ngs1 \n1®11 \n1:Jl41 \nPERFORMANCE_SCHEMA \nYES \nPerformance Schema \nNO \nNO \nNO \nMyISAM \nYES \nMyISAM storage engine \nNO \nNO \nNO \nImoDB \nDEFAULT \nSupports transactions, row4evel locking, and fu ... YES \nYES \nYES \n61.ACKHOLE \nYES \n/dev/n>,.lt storage engine (anything you write to .•. NO \nNO \nNO \nARCHIVE \nYES \nArchve storage engine \nNO \nNO \nNO \n< \nHow to view the default storage engine for a server \nSHOW VARIABLES LIKE 'default_ storage_engine' \nHow to view the storage engine for all the tables in a database \nSELECT table_ name, engine \nFROM information schema.tables \nWHERE table_ schema = 'ap' \nTABlE NAME \n-\nENGINE \n-\n-\ninvoice_line Jtems \nInno06 \n• \n• \n1nVOtCeS \nInnoDB \nterms \nlnnoDB \nDescription \n• \nThe storage engine determines how MySQL stores data and which database \nfeatures are available to you. \n• \nYou can use multiple storage engines on the same server and within the same \ndatabase. \nFigure 11-16 \nHow to view storage engines \n> \n. \nI \n375\n\n376 \nSection 3 \nDatabase design and impleme11,tation, \nHow to specify a storage engine \nIf you don't specify a storage engine when you create your tables, MySQL \nuses the default storage engine for the server. However, if the default storage \nengine doesn't provide the features that you want, you can use the ENGINE \nclause to change the storage engine for the tables that you create. To create a \ntable that uses the MyISAM engine, for example, you can code a CREATE \nTABLE statement that uses the ENGINE clause as shown in the first example of \nfigure 11-17. \nYou can also use the ENGINE clause on the ALTER TABLE statement to \nchange the storage engine that an existing table uses, as shown in the second \nexample. You might want to do that for older tables that use the My ISAM \nstorage engine so you can take advantage of the foreign key features provided by \nthe InnoDB storage engine. When you change the storage engine for an existing \ntable, you should know that it can take MySQL a significant amount of time to \nrebuild the table. In addition, the table can't be accessed while this is happening. \nAs a result, you shouldn't attempt to change the storage engine on a produc-\ntion database unless you are ready to stop all applications from accessing the \ndatabase while MySQL rebuilds the table. \nYou can also change the storage engine for a table from MySQL Workbench. \nTo do that, you use the Columns tab shown in figure 11-10. Then, you use the \nEngine d1·op-down list to choose a storage engine. \nIf you find that you are often using a storage engine that's different than the \ndefault engine for your server, you can change the defat1lt storage engine for the \ncurrent session. To do that, you can code a SET SESSION statement to set the \ndefault_storage_engine variable for the current session. Since that only changes \nthe storage engine for the cun·ent session, you may want to change the storage \nengine permanently. To do that, though, you need to modify the configuration \nfile for the server as shown in chapter 17.\n\nChapter 11 \nHow to create databases, tables, and indexes \n377 \nThe clause used to specify a storage engine \nENGINE= engine_name \nHow to specify a storage engine for a table \nFor a new table \nCREATE TABLE produc t _descriptions \n( \nproduct_ id \nproduct _desc ription \n) \nENGINE= MyISAM \nFor an existing table \nINT \nVARCHAR (200 ) \nPRIMARY KEY, \nALTER TABLE product_descriptions ENGINE = InnoDB \nHow to set the default storage engine for the current session \nSET SESSION default_ storage_engine = InnoDB \nDescription \n• \nTo specify a storage engine for a table, you can use the ENGINE clause. \n• \nTo change the default storage engine for the cun·ent session, you can use the SET \nSESSION statement to set the storage_engine variable for the current session. \n• \nTo permanently change the default storage engine for a server, you can modify the \nconfiguration file for the server. For more infor1nation about how to do this, see \nchapter 17. \nFigure 11-1 7 \nHow to specify a storage engine\n\n378 \nSection 3 \nDatabase design and impleme11,tation, \nPerspective \nNow that you've completed this chapter, you should be able to create and \nmodify the tables of a database by coding DDL statements. In addition, you \nshould be able to use a graphical tool like MySQL Workbench to work with the \ntables of a database. \nBefore you move on, though, take a moment to consider the advantages \nand disadvantages of using MySQL Workbench to work with database objects. \nThe advantage, of course, is that MySQL Workbench provides a graphical user \ninterface that 1nakes it easy to view and work with database objects. The disad-\nvantage is that no record is kept of any changes that you make to the database. \nFor example, if you add a column to a table, that change isn't stored anywhere \nfor future use. \nIn contrast, if you use a script to add a column to a table, that change is \nstored for future use. This makes it easy to recreate the database if you ever \nneed to do that. And that's why it's common to use scripts to make any changes \nto the structure of a database. On the other hand, MySQL Workbench is an \nexcellent tool for quickly viewing the objects of a database or for quickly \ncreating temporary tables or other objects that won't need to be recreated later. \nTerms \nattribute \nconstraint \ncolumn-level constraint \ntable-level constraint \nnot null constraint \nunique constraint \nprin1ary key constraint \nforeign key constraint \nreference constraint \ncascading delete \nindex \nscript \ncharacter set \ncollation \nsto1·age engine\n\nChapter 11 \nHow to create databases, tables, and indexes \n379 \nExercises \n1. \nWrite a script that adds an index to the AP database for the zip code field in \nthe Vendors table. \n2. \nWrite a script that contains the CREATE TABLE statements needed to imple-\nment the following design in the EX database: \nmembers \nmembers committees \n-\nmember id ••----\n◄ member id \n-\n-\nfirst name \ncommittee id \n-\n-\nlast name \n-\naddress \ncity \nstate \nphone \ncommittees \ncommittee id \n-\ncommittee name \n-\nThese tables provide for members of an association, and each member can be \nregistered in one or more committees within the association. \nThe member_id and committee_id columns are the primary keys of the \nMembers and Committees tables, and these columns are foreign keys in the \nMembers_ Committees table. \nInclude any constraints or default values that you think are necessary. \nInclude statements to drop the tables if they already exist. \n3. \nWrite INSERT staten1ents that add rows to the tables that are created in \nexercise 2. \nAdd two rows to the Members table for the first two member IDs. \nAdd two rows to the Committees table for the first two committee IDs. \nAdd three rows to the Members Committees table: one row for member 1 and \n-\ncommittee 2; one for member 2 and committee 1; and one for member 2 and \ncommittee 2. \nWrite a SELECT statement that joins the three tables and retrieves the \ncommittee name, member last name, and member first name. Sort the results \nby the com1nittee name, member last name, and member first name. \n4. \nWrite an ALTER TABLE statement that adds two new columns to the Members \ntable created in exercise 2. \nAdd one column for annual dues that provides for three digits to the left of the \ndecimal point and two to the right. This column should have a default value of \n52.50. \nAdd one column for the payment date. \n5. \nWrite an ALTER TABLE statement that modifies the Committees table created \nin exercise 2 so the committee name in each row has to be unique. Then, use an \nINSERT statement to attempt to insert a duplicate name. This statement should \nfail due to the unique constraint.\n\nHow to create views \nAs you've seen throughout this book, SELECT queries can be complicated, \nparticularly if they use multiple joins, subqueries, or complex functions. \nBecause of that, you may want to save the queries you use regularly. One way \nto do that is to store the statement in a script. Another way is to create a view. \nUnlike scripts, which are stored in files, views are stored as part of the \ndatabase. As a result, they can be used by SQL programmers and by custom \napplications that have access to the database. This provides some advantages \nover using tables directly. \nAn introduction to views .................................................... 382 \nHow views work ........................................................................................... 382 \nBenefits of using views ................................................................................. 384 \nHow to work with views ..................................................... 386 \nHow to c·reate a view .................................................................................... 386 \nHow to create an updatable view ................................................................. 390 \nHow to use the WITH CHECK OPTION clause ........................................ 392 \nHow to insert or delete rows through a view ............................................... 394 \nHow to alter or drop a view ......................................................................... 396 \nPerspective ......................................................................... 398\n\n382 \nSectio11 3 \nDatabaJ·e design tt12d i111ple111e11tation \nAn introduction to views \nBefore you learn the details for \\a.'orking \\\\rith vie\\\\'S. it's helpful to get a \ngeneral idea of how views \\vork. ln addition~ it' helpful to consider ome of the \nbenefits of ,,ie,vs o you can deternune wl1ether you want to use them. \nHow views work \nA i •iel1' i~ a SELECT statement that ·s stored in the database a!- a database \nobject To create a vie,a.r. )'OU use a CREATE VIEW staten1ent like the one hown \nin figure 12-l. This statement creates a view named Vendors_Min that retrie,·es \nthe vendor_nan1e9 endor_state. and \"'endor_phone columns from the Vendors \ntable. \nYou can think of a ,,iew as a virtual table that consists on))r of the row. and \ncolumns . pecified in its CREATE V]EW statement. The table or tables that \nare listed in the FROM clau. e are called the /Jase rab/e.s for the ,•ie\\V. ince the \n,,ie,1-, refer. back to the bru e tables, it doesn ,t store any data itself, and it alway. \nreflects the n10~ t current data in the bm e tables. \nTo use a view, you refer to it from another SQL . tatement. ln thi .. figure. \nfor example. the SELECT statement uses the Vendor. _Min ~riew in the FROrvl \nclau. e instead of a table. As a re. ult, this SELECT statement extracts its result \nset from the \\'irtual table that the vie\\\\r' repre. ents. ln thi case, all the rows for \nvendors in California are relrie\\•ed from the view. \nWhen you create a vie\\&.' like the one in this figure, the viev.r i updatable. As \na resull it' po. sible to u e the ,,ie\\\\' in an INSERT, \nPDATE, or DELETE tate-\nment. In this figure. for example, the UPDATE tatement u es the Vendors_Min \nvie\\\\' to update the vendor_phone colunm in the Vendors table for the specified \n, 1endor. \nTo drop a view. you can u .. e the DROP VIEW . tatement as ho\\\\.rn in this \nfigure. This \\.\\t'orks imilarly to tl1e DROP tatements for tables and indexes that \nyou learned about in the pre\\'ioru chapter. \nBecause a view i. stored a an object in a database. it can be u ed by atl}'One \nwho has appropriate pri\\•ilege . That may include user who ba\\·e acces to tl1e \ndatabase through applications thal provide for ad hoc querie. and report genera-\ntion. In addition. that ma)' include cu tom applications that are ,vritten specifi-\ncally to \\Vork ,vith the data in the database. In t·ac~ vie, \nare otten de igned to \nbe u ed \\ViU1 the e l}rpe. ot· application .\n\nChapter 12 \nHow to create views \n383 \nA CREATE VIEW statement for a view named Vendors Min \nCREATE VIEW vendors_min AS \nSELECT vendor_name, vendor_ state , vendor_phone \nFROM vendors \nThe virtual table that's represented by the view \nvendor _name \nvendor _state \nvendor _phone \n\"' \n► \nUS Postal Service \nWI \n(800) 555--1205 \nL \nNational Information Data Ctr \nDC \n{301) 555-8950 \nRegister of Copyrights \nDC \nG®!I \nJobtrak \nCA \n(800) 555-8ns \nNewbrige Book Clubs \nNJ \n(800) 555.-9980 \n(122 rows) \nA SELECT statement that uses the Vendors Min view \nSELECT * FROM vendors_min \nWHERE vendor state= 'CA' \nORDER BY vendor_name \nThe result set that's returned by the SELECT statement \nvendor _name \nvendor _state \nvendor_phone \n► \nAbbey Office Furnishings \nCA \n(559) 555-8300 \nAmerican Express \nCA \n(800) 555-3344 \nASC Signs \nCA \nHMII \nAzteklabel \nCA \n(714) 555-9000 \nBertelsmann Industry Svcs. Inc \nCA \n(805) 555-0584 \nBA Industries \nCA \n(559) 555-1551 \n( 75 rows ) \nAn UPDATE statement that uses a view to update the base table \nUPDATE vendors_min \nSET vendor_phone = '( 800) 555-3941' \nWHERE vendor_ name = 'Register of Copyrights' \nA statement that drops a view \nDROP VIEW vendors_min \nDescription \n• \nA view consists of a SELECT statement that's stored as an object in the database. \nThe tables referenced in the SELECT statement are called the base tables for the \n• \nview. \n• \nWhen you create a view, you can refer to the view anywhere you wo11ld normally \nuse a table in a SELECT, INSERT, UPDATE, or DELETE statement. \n• \nAlthough a view behaves like a virtual table, it doesn't store any data. Instead, a \nview always refers back to its base tables. \n• \nA view can also be referred to as a viewed table because it provides a view to the \nunderlying base tables. \nFigure 12-1 \nHow views work \nV \n'\n\n384 \nSection 3 \nDatabase design and impleme11,tation, \nBenefits of using views \nFigure 12-2 describes some of the advantages of using views. To start, you \ncan use views to limit the exposure of the tables in your database to external \nusers and applications. To illustrate, suppose a view refers to a table that you've \ndecided to divide into two tables. To accommodate this change, you simply \nmodify the view. In other words, you don't have to modify any statements that \nrefer to the view. That means that users who query the database using the view \ndon't have to be aware of the change in the database structure, and application \nprograms that use the view don't have to be modified. \nYou can also use views to restrict access to a database. To do that, you \ninclude just the columns and rows you want a user or an application to have \naccess to in the views. Then, you let the user or application access the data only \nthrough the views. For example, let's assume you have an Employees table that \nhas a salary column that contains information about each employee's salary. In \nthis case, you can create a view that doesn't include the salary column for the \nusers who need to view and maintain this table, but who shouldn't be able to \nview salai-ies. Then, you can create another view that includes the salary column \nfor the users who need to view and maintain salai-y information. \nIn addition, you can use views to hide the complexity of a SELECT state-\nment. For example, if you have a long and unwieldy SELECT statement that \njoins multiple tables, you can create a view for that statement. This makes it \neasier for you and other database users to work with this data. \nFinally, when yo11 create a view, you can allow data in the base table to be \nupdated through the view. To do that, you use INSERT, UPDATE, or DELETE \nstatements to work with the view.\n\nChapter 12 \nHow to create views \n385 \nSome of the benefits provided by views \nBenefit \nDescription \nDesign independence \nData security \nSimplified queries \nUpdatability \nDescription \nViews can limit the exposure of tables to external users and applications. \nAs a result, if the design of the tables changes, yo1.1 can modify the view \nas necessary so t1sers who query the view don't need to be aware of the \nchange, and applications that use the view don't need to be modified. \nViews can restrict access to the data in a table by using the SELECT \nclat1se to include only selected columns of a table or by using the \nWHERE clause to include 011ly selected rows in a table. \nViews can be used to hide the complexity of retrieval operations. Then, \nthe data can be retrieved using simple SELECT statements that specify a \nview in the FROM clause. \nWith certain restrictions, views can be used to update, insert, and delete \ndata fron1 a base table. \n• \nYou can create a view based on almost any SELECT statement. That means that \nyou can code views that join tables, summarize data, and use subqueries and \nfunctions. \nFigure 12-2 \nBenefits of using views\n\n386 \nSection 3 \nDatabase design and impleme11,tation, \nHow to work with views \nNow that you have a general understanding of how views work and of the \nbenefits that they provide, you 're ready to learn the details for working with \nthem. \nHow to create a view \nFigure 12-3 presents the CREATE VIEW statement that you use to create \na view. In its simplest form, you code the CREATE VIEW keywords, followed \nby the name of the view, followed by the AS keyword and the SELECT state-\nment that defines the view. In this figure, for instance, the first statement creates \na view named Vendors Phone List. This view includes four columns from the \n-\n-\nVendors table for all vendors with invoices. \nIf you execute the first CREATE VIEW statement and a view with that name \ndoesn't already exist in the current database, MySQL adds the view and displays \na message to indicate that the statement was successful. However, if a view with \nthis name already exists, MySQL doesn't add the view and displays a message \nthat indicates that the name is already in use. In that case, you need to specify \na new name for the view, or you need to drop the view that's already using that \nname. \nWhen you code a CREATE VIEW statement, you can specify that you want \nto automatically drop a view that has the same name as the view that you're \ncreating. To do that, you can specify the OR REPLACE keywords after the \nCREATE keyword as shown in all of the examples in this figure except for the \nfirst. \nThe SELECT statement for a view can use most of the features of a normal \nSELECT statement. In this figure, for instance, the second example creates a \nview that joins data from two tables. Similarly, the third statement creates a view \nthat uses a LIMIT clause. \nBy default, the columns in a view are given the same names as the columns \nin the base tables. If a view contains a calculated column, however, you'll want \nto name that column just as you do in other SELECT statements. In addition, \nyou'll need to rename columns from different tables that have the same name. To \ndo that, you can code the column names in the CREATE VIEW clause as shown \nin the fourth example. Or, you can use the AS clause in the SELECT statement \nas shown in the fifth exainple. \nNote that if you use the technique shown in the fourth example, you have to \nassign names to all of the columns. By contrast, if you use the technique shown \nin the fifth example, you only have to assign names to the columns you need to \nrenrune. As a result, you'll typically want to use the technique presented in the \nfifth example.\n\nThe syntax of the CREATE VIEW statement \nCREATE [OR REPLACE] VIEW view_name \n[(column_alias_ l[, column_alias_ 2] ••• )] \nAS \nselect_statement \n[WITH CHECK OPTION] \nA view of vendors that have invoices \nCREATE VIEW vendors_phone_ list AS \nSELECT vendor_name, vendor_contact_ last_ name, \nvendor_contact_ first_name, vendor_phone \nFROM vendors \nChapter 12 \nHow to create views \nWHERE vendor_ id IN (SELECT DISTINCT vendor_ id FROM invoices) \nA view that uses a join \nCREATE OR REPLACE VIEW vendor_ invoices AS \nSELECT vendor_name, invoice_number, invoice_date, invoice_ total \nFROM vendors \nJOIN invoices ON vendors.vendor_id = invoices.vendor_ id \nA view that uses a LIMIT clause \nCREATE OR REPLACE VIEW topS_ invoice_totals AS \nSELECT vendor_ id, invoice_total \nFROM invoices \nORDER BY invoice_total DESC \nLIMIT 5 \nA view that names all of its columns in the CREATE VIEW clause \nCREATE OR REPLACE VIEW invoices_outstanding \n(invoice_nwnber, invoice_date, invoice_total, balance_due) \nAS \nSELECT invoice n11mher, invoice_date, invoice_total, \ninvoice_total - payment_total - credit_total \nFROM invoices \nWHERE invoice_total - payment_ total - credit_total > 0 \nA view that names just the calculated column in its SELECT clause \nCREATE OR REPLACE VIEW invoices_outstanding AS \nSELECT invoice_n11mher, invoice_date, invoice_total, \ninvoice_total - payment_total - credit_total AS balance_due \nFROM invoices \nWHERE invoice total - payment_ total - credit_total > 0 \nFigure 12-3 \nHow to create a view (part 1 of 2) \n387\n\n388 \nSection 3 \nDatabase design and impleme11,tation, \nThe example in part 2 of figu1·e 12-3 creates a view that summarizes the \nrows in the Invoices table by vendor. This shows that a view can use agg1·egate \nfunctions and the GROUP BY clause to summarize data. In this case, the rows \nare grouped by vendor name, and a count of the invoices and the invoice total are \ncalculated for each vendor. \nWhen you create a view, the SELECT statement you code within the defini-\ntion of the view can refer to another view instead of a base table. In other words, \nviews can be nested. In theory, nested views can make it easier to present data to \nyour users. In practice, using nested views can make the dependencies between \ntables and views confusing, which can make your code difficult to maintain. As a \nresult, if you use nested views, you should use them careful! y.\n\nA view that summarizes invoices by vendor \nCREATE OR REPLACE VIEW invoice_ summary AS \nSELECT vendor_name, \nCOUNT(*) AS invoice_count, \nSUM(invoice_total) AS invoice_total_ sum \nFROM vendors \nChapter 12 \nHow to create views \n389 \nJOIN invoices ON vendors.vendor_ id = invoices.vendor_ id \nGROUP BY vendor_name \nDescription \n• \nYou use the CREATE VIEW statement to create a view. \n• If you include the OR REPLACE keywords, the CREATE VIEW statement will \nreplace any existing view that has the same name. Otherwise, you must specify a \nname that doesn't already exist for the view. \n• If you name the columns of a view in the CREATE VIEW clause, you have to name \nall of the columns. By contrast, if you name the columns in the SELECT clause, \nyou can name just the columns you need to rename. \n• \nYou can create a view that's based on another view rather than on a table. This is \nknown as a nested view. \nFigure 12-3 \nHow to create a view (part 2 of 2)\n\n390 \nSection 3 \nDatabase design and impleme11,tation, \nHow to create an updatable view \nOnce you create a view, you can refer to it in a SELECT statement. In \naddition, you may be able to refer to it in INSERT, UPDATE, and DELETE \nstatements to modify the data that's stored in an underlying table. To do that, the \nview must be updatable. Figure 12-4 lists the requirements for creating updat-\nable views. \nThe first two requirements have to do with what you can code in the select \nlist of the SELECT statement that defines the view. In particular, the select list \ncan't include the DISTINCT keyword or aggregate functions. In addition, the \nSELECT statement can't include a GROUP BY or HAVING clause, and two \nSELECT statements can't be joined by a union operation. \nThe CREATE VIEW statement in this figure creates a view that's updatable. \nAs a result, you can refer to it in an INSERT, UPDATE, or DELETE statement. \nFor example, you can use the frrst UPDATE statement shown in this figure to \nupdate the credit_total column in the Invoices base table. Note that to execute \nthis statement in MySQL Workbench, you will need to turn safe update mode off \nas described in chapter 5, since the WHERE clause doesn't refer to a primary or \nforeign key. \nHowever, you can't update any calculated columns that are used by the view. \nFor example, you can't use the second UPDATE statement shown in this figure \nto update the balance_due column that's calculated from the other columns in \nthe view. \nIn addition, when you update data through a view, you can only update the \ndata in a single base table at a time, even if the view refers to two or 1nore tables. \nIn this figure, for instance, the view includes data from two base tables: Vendors \nand Invoices. Because of that, you can code an UPDATE statement that updates \nthe data in the Vendors table or the data in the Invoices table, but not in both \ntables. For example, the first UPDATE statement only refers to columns in the \nInvoices table, so it's able to update data in that table.\n\nChapter 12 \nHow to create views \n391 \nRequirements for creating updatable views \n• \nThe select list can't include a DISTINCT clause. \n• \nThe select list can't include aggregate functions. \n• \nThe SELECT statement can't include a GROUP BY or HAVING clause. \n• \nThe view can' t include the UNION operator. \nA CREATE VIEW statement that creates an updatable view \nCREATE OR REPLACE VIEW balance_due_view AS \nSELECT vendor_name, invoice_n,,rnber, \ninvoice_ total, payment_ total, credit_ total, \ninvoice_ total - payment_ total - credit_ total AS balance_ due \nFROM vendors JOIN invoices ON vendors.vendor_ id = invoices.vendor_ id \nWHERE invoice_ total - payment_ total - credit_ total > 0 \nAn UPDATE statement that uses the view to update data \nUPDATE balance_ due_view \nSET credit total= 300 \nWHERE invoice_ number = '9982771' \nThe response from the system \n(1 row affected) \nAn UPDATE statement that attempts to use the view \nto update a calculated column \nUPDATE balance due view \n-\n-\nSET balance_due = 0 \nWHERE invoice D1irnb11=tr = '9982771' \nThe response from the system \nError Code: 1348. Column 'balance due' is not updatable \nDescription \n• \nAn updatable view is a view that can be used in an INSERT, UPDATE, or DELETE \nstatement to update the data in the base table. If a view isn't updatable, it's called a \nread-only view. \n• \nTl1e requirements for coding updatable views are more restrictive than for coding \nread-only views. That's because MySQL must be able to unambiguously determine \nwhich base tables and columns are affected. \nFigure 12-4 \nHow to create an updatable view\n\n392 \nSection 3 \nDatabase design and impleme11,tation, \nHow to use the WITH CHECK OPTION clause \nFigure 12-5 shows an example of an updatable view that 11ses the WITH \nCHECK OPTION clause to prevent an update if it causes the row to be excluded \nfrom the view. To start, the CREATE VIEW statement creates an updatable view \nnamed Vendor_Payment that joins data from the Vendors and Invoices tables and \nretrieves all invoices that have a balance due that's greater than or equal to zero. \nThen, the first UPDATE statement uses this view to modify the \npayment_date and payment_total columns for a specific invoice. This works \nbecause this UPDATE staten1ent doesn't exclude the row from the view. \nHowever, the second UPDATE statement causes the balance due to become \nless than zero. As a result, this statement fails due to the WITH CHECK \nOPTION clause, and an error is displayed. Since this can prevent users from \nstoring invalid data in a database, this clause can be useful in some situations.\n\nChapter 12 \nHow to create views \n393 \nAn updatable view that has a WITH CHECK OPTION clause \nCREATE OR REPLACE VIEW vendor_payment AS \nSELECT vendor_name, invoice_ number, invoice_date, payment_date, \ninvoice_ total, credit_total, payment_total \nFROM vendors JOIN invoices ON vendors.vendor_ id = invoices.vendor_ id \nWHERE invoice_total - payment_total - credit_total >= 0 \nWITH CHECK OPTION \nA SELECT statement that displays a row from the view \nSELECT* FROM vendor_payment \nWHERE invoice_ DtJmh~r = 'P-0608' \nThe result set \nvendor _name \n► \nMaDoy Lithographing Inc \ninvoice _number \nP-0608 \ninvoice date \n-\npayment_date \n2018-0 7 _23;--ltml®1!1!i1 \ninvoice_total \n20551.18 \nAn UPDATE statement that updates the view \nUPDATE vendor_payment \nSET payment_total = 400.00, \npayment_date = '2018-08-01' \nWHERE invoice_ numher = 'P-0608' \nThe response from the system \n(1 row affected) \nThe same row data after the update \ncredit_total \n1200.00 \npayment_total \n0.00 \nvendor _name \ninvoice_number \ninvoice_date \npayment_date \ninvoice_total \ncredit_total \npayment_total \n-\n► \nMaDoy Lithographing Inc \nP-0608 \n2018-07-23 \n2018-08-01 \n20551.18 \n1200. 00 \n.WO. 00 \nAn UPDATE statement that attempts to update the view \nUPDATE vendor_payment \nSET payment_ total = 30000.00, \npayment_date = '2018-08-01' \nWHERE invoice_number = 'P-0608'; \nThe response from the system \nError Code: 1369. CHECK OPTION failed 'ap.vendor_payment' \nDescription \n-\n• If you don't include a WITH CHECK OPTION clause when you create a view, a \nchange you make through the view can cause the modified rows to no longer be \nincluded in the view. \n• If you specify a WITH CHECK OPTION clause when you create a view, an en·or \nwill occur if you try to modify a row in such a way that it would no longer be \nincluded in the view. \nFigure 12-5 \nHow to use the WITH CHECK OPTION clause\n\n394 \nSection 3 \nDatabase design and impleme11,tation, \nHow to insert or delete rows through a view \nIn the previous figures, you learned how to use a view to update data in the \nunderlying tables. Now, figure 12-6 shows how to use a view to insert or delete \ndata in an underlying table. In general, this works the same as it does when you \nwork directly with a table. However, due to table constraints, using a view to \ninsert or delete rows often results in errors like the ones shown in this figure. \nAs a result, it's generally more common to work directly with base tables when \ninserting or deleting rows. \nAt the top of this figure, you can see a CREATE VIEW statement for a view \nnamed ibm invoices. This view retrieves columns and rows from the Invoices \n-\ntable for the vendor named IBM, which has a vendor_id of 34. Then, the \nINSERT statement that follows attempts to insert a row into the Invoices table \nthrough this view. \nThis insert operation fails, though, because the view and the INSERT state-\nment don't include all of the required columns for the Invoices table. In this case, \na value is required for other columns in the Invoices table, including the \nvendor_id and invoice_due_date columns. As a result, to use a view to insert \nrows, you must design a view that includes all required columns for the under-\n1 ying table. \nIn addition, an INSERT statement that uses a view can insert rows into only \none table. That's true even if the view is based on two or more tables and all of \nthe required columns for tl1ose tables are included in the view. In that case, you \ncould use a separate INSERT statement to insert rows into each table through the \n• \nview. \nThis figure also shows how to delete rows through a view. To do that, you \nuse a DELETE statement like the ones shown here. To start, the first DELETE \nstatement attempts to delete an invoice from the Invoices table through the \nibm_invoices view. However, this DELETE statement fails because the \nInvoice_Line_Items table contains rows related to the invoice. This causes an \nerror message like the one in this figure to be displayed. To get this DELETE \nstatement to work, you must frrst delete the related line items for the invoice. \nThis is illustrated by the last two DELETE statements in this figure.\n\nChapter 12 \nHow to create views \n395 \nA statement that creates an updatable view \nCREATE OR REPLACE VIEW ibm_invoices AS \nSELECT invoice_n11mh11=1r, invoice_date, invoice total \nFROM invoices \nWHERE vendor id= 34 \nThe contents of the view \ninvoice _number \n-\n► \nQP58872 \nQ545443 \ninvoice date \n-\ninvoice_ total \n2018-05-07 \n116.54 \n2018-06-09 \n1083. 58 \nAn INSERT statement that fails due to columns that don't have values \nINSERT INTO ihm_invoices \n(invoice_numher, invoice_date, invoice_total) \nVALUES \n( 'RA23988', '2018-07-31', 417 .34) \nThe response from the system \nError Code: 1423. Field of view •ap.ibm_invoices' underlying table doesn't \nhave a default value \nA DELETE statement that fails due to a foreign key constraint \nDELETE FROM ihm_invoices \nWHERE invoice_n11mhP.r = 'Q545443' \nThe response from the system \nError Code: 1451. Cannot delete or update a parent row: a foreign key \nconstraint fails ('ap'.'invoice_line_items', CONSTRAINT \n'line_ items_fk_invoices' FOREIGN KEY ( 'invoice_id' ) REFERENCES 'invoices' \n{ ' invoice id• ) ) \nTwo DELETE statements that succeed \nDELETE FROM invoice_ line_ items \nWHERE invoice_ id = (SELECT invoice_ id FROM \nWHERE invoice number= \nDELETE FROM ihm invoices \nWHERE invoice_n11mher = • QS45443'; \nThe response from the system \n(1 row affected) \nDescription \n• \n• \n1nvo1ces \n'Q545443'); \n• \nYou can use the INSERT statement to insert rows into a base table through a \nview. To do that, you name the view in the INSERT clause. Both the view and the \nINSERT statement must include all of the columns from the base table that require \na value. \n• \nIf the view names more than one base table, an INSERT statement can insert data \ninto only one of those tables. \n• \nYou can use the DELETE statement to delete rows from a base table through a \nview. To do that, you name the view in the DELETE clause. For this to work, the \nview must be based on a single table. \nFigure 12-6 \nHow to insert or delete rows through a view\n\n396 \nSection 3 \nDatabase design and impleme11,tation, \nHow to alter or drop a view \nAlthough MySQL supports an ALTER VIEW statement, it's usually easier \nto alter a view by using the CREATE OR REPLACE VIEW statement to \nreplace the existing view with a new one. In figure 12-7, for instance, the first \nexample uses a CREATE VIEW statement to create a view named vendors_sw \nthat retrieves rows from the Vendors table for vendors located in four states. \nThen, the second example uses the CREATE OR REPLACE VIEW statement to \nmodify this view so it includes vendors in two additional states. \nTo drop a view, you use the DROP VIEW statement to name the view you \nwant to drop. In this figure, for instance, the third example drops the view named \nvendors_sw. Like the other statements for dropping database objects, this state-\nment permanently deletes the view. As a result, you should be careful when you \nuse it.\n\nA statement that creates a view \nCREATE VIEW vendors_ sw AS \nSELECT* \nFROM vendors \nWHERE vendor state IN ( 'CA' 'AZ' 'NV' 'NM') \n-\n, \n, \n, \nChapter 12 \nHow to create views \n397 \nA statement that replaces the view with a new view \nCREATE OR REPLACE VIEW vendors_ sw AS \nSELECT* \nFROM vendors \nWHERE vendor_state IN ('CA','AZ','NV','NM','UT', 'CO') \nA statement that drops the view \nDROP VIEW vendors_ sw \nDescription \n• \nTo alter a view, use the CREATE OR REPLACE VIEW statement to replace the \nexisting view with a new one. \n• \nTo delete a view from the database, use the DROP VIEW statement. \nFigure 12-7 \nHow to alter or drop a view\n\n398 \nSection 3 \nDatabase design and impleme11,tation, \nPerspective \nIn this chapter, you learned how to create and use views. As you've seen, \nviews provide a powerful and flexible way to predefine the data that can be \nretrieved from a database. By using them, you can restJ.ict the access to a \ndatabase while providing a consistent and simplified way for end t1sers and \napplication programs to access that data. \nTerms \n• \nview \nnested view \nupdatable view \nread-only view \nbase table \nviewed table \nExercises \n1. \nCreate a view named open_items that shows the invoices that haven't been \npaid. \nThis view should return four columns from the Vendors and Invoices tables: \nvendor_name, invoice_number, invoice_total, and balance_due \n(invoice_total - payment_total - credit_total). \nA row should only be returned when the balance due is greater than zero, and \nthe rows should be in sequence by vendor_name. \n2. \nWrite a SELECT statement that returns all of the columns in the open_items \nview that you created in exercise 1, with one row for each invoice that has a \nbalance due of $1000 or more. \n3. \nCreate a view named open_items_summary that returns one summary row for \neach vendor that has invoices that haven't been paid. \nEach row should include vendor_name, open_item_count (the number of \ninvoices with a balance due), and open_item_total (the total of the balance \ndue amounts) \nThe rows should be sorted by the open item totals in descending sequence. \n4. \nWrite a SELECT statement that returns just the first 5 rows from the \nopen_items_summary view that you created in exercise 3. \n5. \nCreate an updatable view named vendor_address that returns the vendor_id \ncolumn and all of the address columns for each vendor. \n6. \nWrite an UPDATE statement that changes the address for the 1·ow with a \nvendor ID of 4 so the suite number (Ste 260) is stored in the vendor_address2 \ncolumn instead of the vendor address 1 column. \n-\n\nStored program development \nThis section presents the essential skills for using MySQL to create stored \nprograms. These are the skills that will take your SQL capabilities to \nthe next level. In chapter 13, you'll learn the language basics for writing \nprocedural code within sto1·ed programs. In chapter 14, you '11 learn how \nto manage transactions and locking from within stored programs. In \nchapter 15, you'll learn how to create two types of stored programs: stored \nprocedures and functions. And in chapter 16, you'll learn how to create two \nmore types of stored programs: triggers and events.\n\nLanguage skills \nfor writing stored programs \nThis chapter presents the basic language skills that you need to write stored \nprograms. With the skills presented in this chapter, you'll be able to code \nstored programs that provide functionality similar to procedural programming \nlanguages like Python, PHP, Java, C++, C#, and Visual Basic. \nIf you have experience with another procedural language, you shouldn't \nhave any trouble with the skills presented in this chapter. However, you should \nknow that the programming power of MySQL is limited when compared to \nother languages. That's because MySQL is designed specifically to work with \nMySQL databases rather than as a general-purpose programming language. \nFor its intended use, however, MySQL is both powerful and flexible. \nAn introduction to stored programs ................................ 402 \nFour types of stored programs .................................................................... 402 \nA script that creates and calls a stored procedure ...................................... 402 \nA summary of statements for coding stored programs .............................. 404 \nHow to write procedural code ........................................... 406 \nHow to display data .................................................................................... 406 \nHow to declare and set variables ................................................................ 408 \nHow to code IF statements .......................................................................... 410 \nHow to code CASE statements .................................................................... 412 \nHow to code loops ....................................................................................... 414 \nHow to use a cursor ..................................................................................... 416 \nHow to declare a condition handJer ............................................................. 418 \nHow to use a condition handJer ................................................................... 420 \nHow to use multiple condition handlers ...................................................... 424 \nPerspective ......................................................................... 426\n\n402 \nSection 4 \nStored prvgram development \nAn introduction to stored progran,s \nMySQL provides for using standard SQL to write stored programs. Stored \nprograms can include procedural code that controls the flow of execution. \nFour types of stored programs \nFigure 13-1 presents tl1e four types of stored programs that you can create \nin MySQL. A stored procedure can be called from an application that has access \nto the database. For example, a PHP application can call a stored procedure and \npass parameters to it. A stored function can be called from a SQL statement, \njust like the functions provided by MySQL that you learned about in chapter \n9. However, you can customize stored functions so they perform tasks that are \nspecific to your database. Stored procedures and stored functions are similar in \nmany ways and are also known as stored routines. \nTriggers and events don't need to be called. Instead, they execute automati-\ncally when something happens. A trigger executes when an INSERT, UPDATE, \nor DELETE statement is run against a specific table. And an event executes at a \nscheduled time. \nA script that creates and calls \na stored procedure \nThe script shown in figure 13-1 creates a stored procedure named test that \ndoesn't accept any parameters. Then, it calls this procedure to execute the state-\nments that are stored within it. This provides a way for you to experiment with \nthe procedural language features that are available from MySQL. That's why this \nscript is used throughout this chapter. \nThis script begins with the USE statement, which selects the AP database. \nThen, the DROP PROCEDURE IF EXISTS command drops the procedure \nnamed test if it already exists. This suppresses any error messages that would be \ndisplayed if you attempted to drop a procedure that didn't exist. \nThe DELIMITER statement changes the delimiter from the default delimiter \nof the semicolon(;) to two slashes(//). This is necessary because the semicolon \nis used within the CREATE PROCEDURE statement, and it allows you to use \ntwo front slashes(//) to identify the end of the CREATE PROCEDURE state-\nment. Although we use two front slashes as the delimiter in this book, it's also \ncommon to see two dollar signs ($$) or two semicolons (; ;) t1sed as the delimiter. \nThe CREATE PROCEDURE statement creates the procedure. To indicate \nthat this procedure doesn't accept any parameters, this code includes an empty \nset of parentheses after the procedure's name. \nThe code within the CREATE PROCEDURE statement is defined by a block \nof code that begins with the BEGIN keyword and ends with the END keyword. \nWithin this block of code, the DECLARE statement defines a variable named \nsum_balance_due_ var of the DECIMAL type. This data type corresponds to the\n\nChapter 13 \nLanguage skills for writing stored progra,ns \n403 \nFour types of stored programs \nType \nDescription \nStored procedure \nStored function \nCan be called from an appljcation that has access to the dalabase. \nTrigger \nEvent \nCan be called from a SQL statement. A stored function works much \nlike the functions provided by MySQL that are described in chapter 9. \nIs executed in response to an INSERT, UPDATE, or DELETE state-\nment on a specified table. \nls executed at a scbeduJed time. \nA script that creates and calls a stored procedure named test \nUSE ap; \nDROP PROCEDURE IF EXISTS test; \n-- Change statement delimiter from semicolon to double front slash \nDELIMITER // \nCREATE PROCEDURE test() \nBEGIN \nDECLARE sum_balance_ due_var DECIMAL (9, 2); \nSELECT SUM(invoice_total -\npayment_total - credit_total ) \nINTO sum_balance_ due_var \nFROM invoices \nWHERE vendor_id = 95; \nIF sum_balance_ due_var > 0 THEN \nSELECT CONCAT('Balance due: $', sum_balance_due_var) AS message; \nELSE \nSELECT 'Balance paid in full' AS message; \nEND IF; \nEND// \n-- Change statement delimiter from double front slash to semicolon \nDELIMITER; \nCALL test( ) ; \nThe response from the system \nmessage \n--;-f \nBalance paid in full \nDescription \n• \nA stored program consists of one or 1nore SQL statements stored in the database \nfor later use. \n• \nWithin a stored program, you can write procedural code that controls the flow of \nexecution. That inclt1des if/else constructs, loops, and error-handling code. \nFigure 13-1 \nAn introduction to stored programs\n\n404 \nSection 4 \nStored prvgram development \ndata types that are used for the invoice_total, payment_total, and credit_total \ncolumns of the Invoices table. Then, a SELECT statement sets the value that's \nstored in this variable. To do that, the SELECT statement returns a single value \nand includes an INTO clause that specifies the name of the variable. As a result, \nthe SELECT statement selects the value into the variable. \nAfter the first SELECT statement, the script uses an IF statement to test the \nvalue of the variable. If the variable is greater than zero, the statement in the \nTHEN clause uses a SELECT statement to return a result set that indicates the \nbalance that is due. Otherwise, the statement in the ELSE clause uses a SELECT \nstatement to return a result set that indicates that the balance is paid in full. \nAfter the stored procedure has been created, this script uses the DELIMTER \nstate1nent to change the delimiter back to the default deli1niter of a se1nicolon \n(;). Then, it uses a CALL statement to call the stored procedure. This executes \nthe code stored within the procedure. You'll learn 1nore about how the CALL \nstatement works in chapte1· 15. \nFor now, don't won)' if you don't understand the coding details for this \nscript. Instead, focus on the general ideas. Later in this chapter, you '11 leru·n the \ndetails that you need to use the procedural language that's provided by MySQL. \nThen, in chapter 15, you'll learn more about the details of creating stored \nprocedures. \nA summary of statements \nfor coding stored programs \nFigure 13-2 begins by summarizing the SQL statements for controlling the \nflow of execution within stored programs. These statements can be used to add \nfunctionality that's similar to the functionality provided by procedural languages. \nAfter the SQL statements for writing procedural code, this figure presents \none SQL statement that you're already familiar with that's commonly used \nwithin stored programs: the SELECT statement. When working with stored \nprograms, you can use the SELECT statement to return a result set to the calling \nprogram. This is often used to display messages that can help the programmer \ndevelop and debug a stored program. \nIn addition, you can use the SELECT staten1ent with an INTO clause to \nretrieve data from the database and store it in one or more variables. You saw \nan example of this in the previous figure, and you'll learn more about how this \nworks as you progress through this chapter.\n\nChapter 13 \nLanguage skills for writing stored progra,ns \n405 \nSQL statements for controlling the flow of execution \nKeywords \nDescription \nIF ... ELSEIF .. . ELSE \nCASE .. . WHEN .. . ELSE \nWHILE . .. DO ... LOOP \nREPEAT . . . UNTI L ... END REPEAT \nDECLARE CURSOR FOR \nDECLARE . .. HANDLER \nControls the flow of execution based on a condition. \nControls the flow of exect1tion based on a condition. \nRepeats statements while a condition is true. \nRepeats statements whj)e a condition is true. \nDefines a result set that can be processed by a loop. \nDefines a handler that's executed when a stored \nprogram encounters an error. \nA SQL statement used within stored programs \nStatement \nDescription \nSELECT \nDescription \nReturns a result set to the calling program. Or, \nretrieves data from the database and stores it \nso it can be processed by the stored program. \n• \nMySQL provides statements that can be used within scripts to add functionality \nsimilar to that provided by procedural programming languages. \nFigure 13-2 \nA summary of statements for working with stored programs\n\n406 \nSection 4 \nStored prvgram development \nHow to write procedural code \nNow that you have a general idea of how stored programs work, you 're \nready to learn the details for writing procedural code that's used within stored \nprograms. \nHow to display data \nAs you develop stored programs, you often need to display messages as \nshown in figure 13-3. This can help you make sure that the stored program \nis executing correctly, and it can help you debug your programs. To display \na message, you can use a SELECT statement. In this figure, for example, the \nstored procedure uses a SELECT statement to return a result set that contains a \nsingle row with a column named message that contains a string that says, ''This \nis a test.\" \nTo display more complex messages, you can code 1nore complex SELECT \nstatements. In the next figure, for example, you'll see a stored procedure that \nuses a SELECT statement that returns a result set with multiple values. Then, \nthe SELECT statement stores those values in variables so the variables can be \nfo1·matted and displayed. \nThis figure only shows the DELIMTER statement and the CREATE \nPROCEDURE statement that are necessary to create the stored procedure. \nBefore you execute these statements, you may need to select the appropriate \ndatabase and drop any procedures with the same name as shown in figure 13-1. \nSitnilarly, after you execute these statements, the stored procedure isn't executed \nuntil you call it as shown in figure 13-1.\n\nChapter 13 \nLanguage skills for writing stored progra,ns \n407 \nA stored procedure that displays a message \nDELIMITER// \nCREATE PROCEDURE test() \nBEGIN \nSELECT 'This is a test.' AS message; \nEND// \nThe response from the system when the procedure is called \nmessage \n► \nThis is a test. \nDescription \n; \n• \nTo display a message from a stored program, you can use the SELECT statement to \nretu1n a result set. \nFigure 13-3 \nHow to display data\n\n408 \nSection 4 \nStored prvgram development \nHow to declare and set variables \nA variable stores a value that can change as the procedure executes. Figure \n13-4 shows how to declare and set variables. \nTo declare a variable, you code the DECLARE keyword followed by the \nvariable name and data type. In this figure, for example, the stored procedure \nbegins by declaring five variables. The data type for each variable corresponds to \nthe data type that's used for a column that's related to the variable. For example, \nthe first two variables are declared with the DECIMAL type. This is the same \ndata type that's used by the invoice_total column of the Invoices table. The third \nvariable also uses this data type, but with 4 decimal places instead of 2. The last \ntwo variables use the INT type, which matches the data type for the invoice_id \nand vendor_id columns. When specifying the data type for a variable, you can \nuse any of the data types that you can use when you specify the data type for a \ncolumn. \nOnce you declare a variable, you can assign a value to it using the SET \nstatement. To assign a literal value or the result of an expression, you can code \nthe assignment operator ( =) followed by the literal value or the expression. In \nthe script in this figure, for example, the frrst SET statement uses the assignment \noperator to assign a valt1e of 95 to the variable named vendor_id_ var. The second \nSET statement uses the assignment operator to assign the result of a calculation \nto the variable named percent_difference. \nYou can also use the DEFAULT keyword to assign a default value to a \nvariable when you declare it. Then, the default value is used if another value \nisn't assigned to the variable. For this to work, the default value must be a literal \nvalue, not an expression. To declare and assign a value to the vendor_id_ var \nvariable, for example, you could code a statement like this: \nDECLARE vendor_ i d_var INT DEFAULT 95; \nIf you want to assign a value that's returned by a SELECT statement to a \nvariable, you can add an INTO clause to a SELECT statement. In the script in \nthis figure, for example, the first SELECT statement uses the INTO clause to \nassign the tlu·ee values that are returned by the SELECT statement to the three \ncorresponding variables that are specified by the INTO clause. For this to work, \nthe SELECT statement must return one value for each of the variables that are \nspecified in the INTO clause. In addition, the data types for the colu1nns must be \ncompatible with the data types for the variables. \nTo review, the script in this figure uses five variables to calculate the percent \ndifference between the minimum and maximum invoices for a particular vendor. \nTo do that, this script uses the assignment operator to assign a value to two of the \nvariables. In addition, it uses the INTO clause of a SELECT statement to assign \nvalues to the other three variables. Finally, a SELECT statement displays the \nvalues of four of the variables. \nIn this figure, the script uses the equals sign ( =) as the assignment operator. \nHoweve1·, MySQL also allows you to use a colon plus the equals sign(:=) as the \nassignment operator. So, if you are reviewing another programmer's code, you \nmight see this operator.\n\nChapter 13 \nLanguage skills for writing stored progra,ns \n409 \nThe syntax for declaring a variable \nDECLARE variable_name data_type [DEFAULT literal_value]; \nThe syntax for setting a variable to a literal value or an expression \nSET variable_name = {literal_value lexpression}; \nThe syntax for setting a variable to a selected value \nSELECT column_ l[, column_ 2] ••• \nINTO variable_ name_ l[, variable_name_ 2] ••• \nA stored procedure that uses variables \nDELIMITER/ / \nCREATE PROCEDURE test() \nBEGIN \nDECLARE max_ invoice_total \nDECLARE min invoice total \n-\n-\nDECLARE percent_difference \nDECLARE count_ invoice id \nDECLARE vendor id var \nSET vendor_ id_var = 95; \nDECIMAL (9,2); \nDECIMAL(9,2); \nDECIMAL (9,4); \nINT; \nINT; \nSELECT MAX(invoice_total), MIN(invoice_total), COUNT(invoice_ id) \nINTO max_ invoice_total, min_ invoice_total, count_ invoice_ id \nFROM invoices WHERE vendor_ id = vendor_ id_var; \nSET percent_difference = (max_ invoice_total - min_ invoice_total) / \nmin_ invoice_ total * 100; \nSELECT CONCAT('$', max_ invoice_total) AS 'Maximum invoice', \nCONCAT('$', min_ invoice_total) AS 'Minimum invoice•, \nCONCAT(' %', ROUND (percent_difference, 2 ) ) AS 'Percent difference', \ncount invoice id AS 'Number of invoices'; \nEND// \nThe response from the system when the procedure is called \nMaxmum \ninvoice \n► \n$46.21 \nDescription \nMinimum \ninvoice \nS16.33 \nPercent \ndifference \n%182.98 \nNumber of \ninvoices \n6 \n• \nA variable stores a value that can change as a stored program executes. \n.I \n• \nA variable must have a name that's different from the names of any columns used \nin any SELECT statement within the stored program. To distinguish a variable from \na column, you can add a suffix like ''_ var'' to the variable name. \nFigure 13-4 \nHow to declare and set variables\n\n410 \nSection 4 \nStored prvgram development \nHow to code IF statements \nFigure 13-5 shows how to use an IF statement to execute one or more \nstatements based on a value that's returned by a Boolean expression. A Boolean \nexpression is an expression that returns a true value or a false value. \nThe script in this figure uses an IF statement to test the value of a variable. \nThis variable contains the oldest invoice due date in the Invoices table. If this \ndue date is less than the current date, the Boolean expression evaluates to true, \nand the statement in the IF clause shows that outstanding invoices are overdue. \nIf the value is equal to the current date, the statement in the ELSEIF clause \nindicates that outstanding invoices are due today. If neither of these conditions \nis true, the oldest due date must be greater than the current date. As a result, the \nscript indicates that no invoices are overdue. \nIn this figure, the IF statement only contains one ELSEIF clause. However, \nyou can add as many ELSEIF clauses as you need. As a result, you can code \ndozens of these clauses if you need them. But if you don't need an ELSEIF \nclause, you don't have to code one. For example, it's common to code an IF \nstatement without an ELSEIF clause like this: \nIF first_ invoice_due_date < NOW() THEN \nSELECT 'Outstanding invoices are overdue!'; \nELSE \nSELECT 'No invoices are overdue.'; \nEND IF; \nSimilai·ly, the ELSE clause is optional. As a result, it's common to code an \nIF statement like this: \nIF first_ invoice_due_date < NOW() THEN \nSELECT 'Outstanding invoices are overdue!'; \nEND IF; \nYou can also nest one IF statement within another like this: \nIF first_ invoice_due_date <= NOW() THEN \nSELECT 'Outstanding invoices are overdue!'; \nIF first_ invoice_due_date = NOW() THEN \nSELECT \nI TODAY! I ; \nEND IF; \nEND IF; \nIn this case, the outer IF statement is executed when the oldest invoice due date \nis less than or equal to the current date. However, the nested IF statement is only \nexecuted when the oldest invoice due date is equal to the current date. In other \nwords, if the current date equals the oldest invoice due date, this code returns \ntwo result sets instead of one. As you'll see later in this chapter, you can also \nnest an IF statement within other types of statements such as loops.\n\nChapter 13 \nLanguage skills for writing stored progra,ns \n411 \nThe syntax of the IF statement \nIF boolean_expression THEN \nstatement_ l; \n[statement_ 2;] ... \n[ELSEIF boolean_expression THEN \nstatement_ !; \n[statement_2;] ... ] ... \n[ELSE \nstatement_ !; \n[statement_ 2;] ... ] \nEND IF; \nA stored procedure that uses an IF statement \nDELIMITER// \nCREATE PROCEDURE test() \nBEGIN \nDECLARE first invoice due date DATE; \nSELECT MIN(invoice_ due_date) \nINTO first_ invoice_ due_date \nFROM invoices \nWHERE invoice_ total -\npayment_total - credit_total > O; \nIF first_ invoice_due_ date < NOW() THEN \nSELECT •outstanding invoices are overdue!'; \nELSEIF first_ invoice_ due_ date = NOW() THEN \nSELECT •outstanding invoices are due today!'; \nELSE \nSELECT 'No invoices are overdue.'; \nEND IF; \nEND// \nThe response from the system when the procedure is called \nOutstanding invoices are overdue! \n-\n-\n► \nOutstanding invoices are overdue! \nDescription \n• \nYou can use an IF statement to execute one or more statements depending on one \nor more Boolean expressions. A Boolean express·ion is an expression that evaluates \nto true or false. \n• \nYou can nest an IF statement within another IF statement or within other SQL state-\nments such as the statements for coding loops. \n• \nYou can also code parentheses around the Boolean expressions in an IF statement \nlike this: \nIF (first_ invoice_ due_ date < NOW()) THEN \nYou may see other programmers use this technique. \nFigure 13-5 \nHow to code IF statements \n•••\n\n412 \nSection 4 \nStored prvgram development \nHow to code CASE statements \nIn chapter 9, you learned how to code a CASE expression within a SELECT \nstatement. A CASE expression like that usually runs faster than a CASE state-\nment that's coded within a stored program. As a result, if you can use a CASE \nexpression to solve the task at hand, you should. However, you may sometimes \nneed to use a CASE statement as shown in figure 13-6. \nThe script in this figure shows how to use a simple CASE statement to \nexecute one or more statements depending on a value that's returned by an \nexpression. To do that, you begin by coding the CASE keyword followed by an \nexpression that returns a value. In this script, the variable that's coded after the \nCASE statement returns an integer value that indicates the payment terms for an \n• \n• \n1nvo1ce. \nAfter the CASE clause, you can code one or more WHEN clauses that \ncontain the statement or statements that are executed for each of the values that \nmay be returned. In this example, the CASE statement includes three WHEN \nclauses for the values of 1, 2, and 3. Each of these clauses displays an appro-\npriate message. \nAfter the WHEN clauses, you can code an optional ELSE clause that's \nexecuted if the value that's returned doesn't match the values coded in any of the \nWHEN clauses. This works much like the ELSE clause that's available from the \nIF statement. \nAlthough this figure doesn't show an example of it, you can also use a \nsearched CASE statement to execute one or more statements depending on \none or more Boolean expressions. This works similarly to an IF statement. For \nexample, you can use a searched CASE statement to replace the IF statement in \nthe previous figure like this: \nCASE \nWHEN first_ invoice_due_date < NOW() THEN \nSELECT (•outstanding invoices are overdue!'); \nWHEN first_ invoice_due_date = NOW() THEN \nSELECT ('Outstanding invoices are due today!'); \nELSE \nSELECT ('No invoices are overdue.'); \nEND CASE; \nConversely, you can easily rewrite the simple CASE statement shown in this \nfigure as an IF statement. \nSo, when should you use an IF statement and when should you use a CASE \nstatement? Although this is largely a matter of personal preference, you usually \nshould try to use the statement that yields the code that's easiest to read and \nunderstand.\n\nChapter 13 \nLanguage skills for writing stored progra,ns \n413 \nThe syntax of the simple CASE statement \nCASE expression \nWHEN expression_value_ l THEN \nstatement_ l; \n[statement_ 2;] ... \n[WHEN expression_value_ 2 THEN \nstatement_ l; \n[statement_2;] ... ] ... \n[ELSE \nstatement_ l; \n[statement_ 2;] ••• ] \nEND CASE; \nA stored procedure that uses a simple CASE statement \nDELIMITER// \nCREATE PROCEDURE test(} \nBEGIN \nDECLARE terms_ id_var INT; \nSELECT terms_id INTO terms_ id_ var \nFROM invoices WHERE invoice_ id = 4; \nCASE terms_ id_var \nWHEN 1 THEN \nSELECT 'Net due 10 days• AS Terms; \nWHEN 2 THEN \nSELECT 'Net due 20 days• AS Terms; \nWHEN 3 THEN \nSELECT 'Net due 30 days' AS Terms; \nELSE \nSELECT 'Net due more tha.n 3 0 days ' AS Terms; \nEND CASE; \nEND// \nThe response from the system when the procedure is called \nTerms \n► \nNet due 30 days \nThe syntax of a searched CASE statement \nCASE \nWHEN boolean_expression THEN \nstatement_ l; \n[statement_2;] ... \n[WHEN boolean_expression THEN \nstatement_ l; \n[statement_2;] ... ] ... \n[ELSE \nstatement_ l; \n[statement_2;] ... ] \nEND CASE; \nDescription \n• \nYou can use a simple CASE statement or a sea,·ched CASE statement to execute one \nor more statements depending on a value that's returned by an expression. \nFigure 13-6 \nHow to code CASE statements\n\n414 \nSection 4 \nStored prvgram development \nHow to code loops \nFigure 13-7 shows how to use a loop to repeat a statement or several state-\nments while a condition is true. This figure stai·ts by showing how to use a \nWHILE loop to continue executing while a counter is within the specified range. \nIn the example, the stored procedure begins by declaring a counter variable \nnamed i that has a default value of 1. Then, it declares a string variable named s \nthat can store up to 400 characters and has a default value of an empty string. \nThe WHILE statement begins by declaring that the loop should continue \nwhile the counter variable is less than four. Since the second SET statement \nincreases the value of the counter vaiiable by 1 each time through the loop, \nthe loop is executed three times (when the counter is equal to 1, 2, and 3). As a \nresult, the first SET statement is executed three times. This statement appends \nsome string literals and the value of the counter variable to the string variable. \nAfter the loop fmishes executing, the SELECT statement displays the string \nvariable. This variable provides a string representation of the three values of the \ncounter variable. Altho11gh this doesn't accomplish anything useful, it clearly \nshows how a WHILE loop works and can be useful for debugging. \nThe next two examples show how to use different types of loops to get \nthe same result as the first example. Although the syntax for these loops isn't \npresented in this figure, you shouldn't have any trouble understanding how they \nwork if you understand how the WHILE loop works. \nBoth of these examples focus on the code for the loop. In other words, they \ndon't show the DELIMITER and CREATE PROCEDURE statements that were \nshown in the first example. In addition, they don't show the code that declares \nthe counter and string variables or the code that displays the string variable. \nHoweve1·, for these examples to run, they would need to include this code. \nThe second example shows how to use a REPEAT loop. In this example, the \nREPEAT loop continues to execute until a counter variable named i equals 4. \nThis works similarly to the WHILE loop, except that the Boolean expression is \ncoded at the end of the loop. As a result, a REPEAT loop always executes at least \nonce. Because of that, you should use a REPEAT loop if you want to execute the \ncode at least once, and you should use a WHILE loop if you don't want the code \nto execute at all in some cases. \nThe third example shows how to use a simple LOOP. Ironically, a simple \nLOOP is the most complex to code. To start, you must code a name that identi-\nfies the start and end of the loop. In this example, the loop is named testLoop. \nThen, you can use an IF statement to dete1mine when the loop should end. \nWithin this IF statement, you can use the LEAVE statement to jump to the end \nof the loop. On this statement, you name tl1e loop you want to leave. Although \nthis can be t1seful if you nest one loop within another loop, it's a lot of unneces-\nsary code for a loop that isn't nested. As a result, you'll typically want to use a \nWHILE loop or a REPEAT loop. \nIn the rare case that you need to jump to the beginning of a loop, you can use \nan ITERATE statement. This statement works like the LEAVE statement, except \nthat it jumps to the beginning of a loop instead of to the end of a loop.\n\nChapter 13 \nLanguage skills for writing stored progra,ns \n415 \nThe syntax of the WHILE loop \nWHILE boolean_expression DO \nstatement_ l; \n[statement_2;] ••• \nEND WHILE; \nA stored procedure that uses a WHILE loop \nDELIMITER / / \nCREATE PROCEDURE test( ) \nBEGIN \nDECLARE i INT DEFAULT 1; \nDECLARE s VARCHAR(400) DEFAULT \nWHILE i < 4 DO \nSET s = CONCAT(s, \nSET i = i + 1; \nEND WHILE; \nSELECT s AS message; \nEND/ / \nThe output for this code \nI message \n► fi=l I 1=2 11=3 I \nA REPEAT loop \nREPEAT \nI 1,' -\nI - , \n• \nI \n1., \nI \nI \n• , \nI \nI ) ; \nSET s = CONCAT ( s, Ii= I, i, I I I ) ; \nSET i = i + 1; \nUNTIL i = 4 \nEND REPEAT; \nA simple loop \ntestLoop: LOOP \nSET s = CONCAT(s, 'i=', i, ' I '); \nSET i = i + 1; \nIF i = 4 THEN \nLEAVE testLoop; \nEND IF; \nEND LOOP testLoop; \nDescription \n• \nTo execute a SQL statement repeatedly, you can use a loop. MySQL provides for \nthree types of loops: a WHILE loop, a REPEAT loop, and. a simple loop. \n• \nYou can use the LEAVE statement to go to the end of a loop. \n• \nYou can use the ITERATE statement to go to the beginning of a loop. \nFigure 13-7 \nHow to code loops\n\n416 \nSection 4 \nStored prvgram development \nHow to use a cursor \nBy default, SQL statements work with an entire result set rather than \nindividual rows. However, you may sometimes need to work with the data in \na result set one row at a time. To do that, you can use a cursor as described in \nfigure 13-8. \nIn this figure, the stored procedure begins by declaring four variables. \nNote that the third variable is assigned a default value of FALSE even though \nit's declared with the TINYINT type. As you learned in chapter 8, this works \nbecause the FALSE keyword is an alias for 0. Although many programmers use \n0 to represent a false value and 1 to represent a true value, this chapter uses the \nFALSE and TRUE keywords instead because they make the code easier to read. \nNext, this code declares a variable of the CURSOR type named \ninvoices_cursor. Within this declaration, this code uses a SELECT statement to \ndefine the result set for this cursor. This result set contains two columns from the \ninvoices table and all of the rows that have a balance due. \nAfte1· declaring the cursor, this code declares an error handler that's executed \nwhen no more rows are found in the result set for the cursor. This error handler \nsets the variable named row not found to a value of TRUE. Because the WHILE \nloop that follows executes only while the row_not_found variable is equal to \nFALSE, this causes the WHILE loop to stop executing. \nAfter declaring the error handler, this code uses the OPEN statement to open \nthe cursor. Then, it uses a WHILE loop to loop through each row in the cursor. \nThis WHILE loop continL1es until the row _not_f ound variable is set to TRUE by \nthe error handler. \nWithin the WHILE loop, the FETCH statement gets the column values from \nthe next 1·ow and stores them in the vaiiables that were declared earlier. Then, \nan IF statement checks whether the value of the invoice_total column for the \ncurrent row is greater than 1000. If it is, an UPDATE statement adds 10% of the \ninvoice_total column to the credit_total column for the row, and a SET statement \nincrements the count of the number of rows that have been updated. \nAfter the WHILE loop, this code closes the cursor. Finally, it uses a \nSELECT statement to display a count of the number of rows that have been \nupdated. \nBefore you use a cursor to work with individual rows in a result set, you \nshould consider other solutions. That's because standard database access is faster \nand uses fewer server resources than cursor-based access. For example, you \ncan accomplish the same update as the stored procedure in this figure with this \nUPDATE statement: \nUPDATE invoices \nSET credit_total = credit_total + (invoice_total * .1) \nWHERE invoice_total -\npayment_total - credit_total > 0 \nAND invoice_total > 1000 \nHowever, if you encounter a situation where it makes sense to use a cursor, the \nskills presented in this figure should help you do that.\n\nChapter 13 \nLanguage skills for writing stored progra,ns \nThe syntax \nDeclare a cursor \nDECLARE cursor_ name CURSOR FOR select_statement; \nDeclare an error handler for when no rows are found in the cursor \nDECLARE CONTINUE HANDLER FOR NOT FOUND handler_ statement; \nOpen the cursor \nOPEN cursor_name; \nGet column values from the row and store them in a series of variables \nFETCH cursor_name INTO variablel[, variable2] [, variable3] .•. ; \nClose the cursor \nCLOSE cursor_name; \nA stored procedure that uses a cursor \nDELIMITER// \nCREATE PROCEDURE test() \nBEGIN \nDECLARE invoice_ id_var \nDECLARE invoice total var \n-\n-\nDECLARE row_not_ found \nDECLARE update_count \nINT; \nDECIMAL(9,2); \nTINYINT DEFAULT \nINT DEFAULT O; \nDECLARE invoices_cursor CURSOR FOR \nFALSE; \nSELECT invoice_ id, invoice_total \nFROM invoices \nWHERE invoice_total - payment_total - credit total> O; \nDECLARE CONTINUE HANDLER FOR NOT FOUND \nSET row_not_ found = TRUE; \nOPEN invoices_cursor; \nWHILE row_not_ found = FALSE DO \nFETCH invoices_cursor INTO invoice_ id_var, invoice_total_var; \nIF invoice_ total_var > 1000 THEN \nUPDATE invoices \nSET credit_total = credit_total + (invoice total* .1) \nWHERE invoice id= invoice_ id_var; \nSET update_count = update_ count + 1; \nEND IF; \nEND WHILE; \nCLOSE invoices_cursor; \nSELECT CONCAT{update_count, ' row(s) updated.'); \nEND// \nThe response from the system when the procedure is called \nCONCAT(update_count, 'ro•N(s) updated.) -\n► \n2 row(s) updated. \nFigure 13-8 \nHow to use a cursor \nI \n417\n\n418 \nSection 4 \nStored prvgram development \nHow to declare a condition handler \nBefore you declare a condition handler, you need to be familiar with the \nMySQL error codes and named conditions that are defined by MySQL. Figure \n13-9 begins by listing five of the thousands of MySQL error codes. These error \ncodes should give you an idea of the types of errors MySQL provides for. \nEach of these error codes corresponds with a SQLSTATE code that's part of \nthe ANSI standard. However, the MySQL codes are typically more useful since \nthey're more specific. For example, the last four MySQL error codes all cor1·e-\nspond with a SQLSTATE code of 23000. \nIn general, you only need to handle these errors when you encounter them \nduring testing. However, if you're interested in viewing a list of all the error \ncodes, you'll find them in the MySQL Reference Manual. \nThe second table in this figure lists the three built-in named conditions \nMySQL provides. To start, it provides the NOT FOUND condition that was used \nin the stored procedure in figure 13-8. This condition corresponds with MySQL \nerror code 1329 and SQLSTATE code 02000. \nIn addition, MySQL provides the SQLEXCEPTION and SQLWARNING \nconditions. The SQLEXCEPTION condition provides a way for you to \nhandle all errors, even ones that yoLt did not encounter during testing. The \nSQLWARNING condition works like the SQLEXCEPTION condition, but it \nallows you to catch warnings and errors instead of just errors. \nThis figure also shows how to use the DECLARE ... HANDLER statement \nto handle the errors that may occur in your stored programs. In MySQL, this is \nrefe1red to as a condition handler. In othe1· languages, this is referred to as an \nerror handler or exception handler. \nThe three examples in this figure show how to declare condition handlers for \na MySQL error code, a SQLSTATE code, and a named condition. All three of \nthese condition handlers use the CONTINUE keyword, which causes the stored \nprogram to continue executing at the statement after the statement that caused \nthe error to occur. If that's not what you want, you can use the EXIT keyword to \ncontinue execution after the cun·ent block of code. You'll see an example of that \nin the next figure. \nIn most cases, you can use the MySQL error codes and the built-in named \nconditions to handle the exceptions that you encounter. In some cases, though, \nyou may want to create your own named conditions. Although this doesn't \nprovide any new capabilities, it can sometimes improve the readability of your \ncode. For more info1mation about creating your own named conditions, you can \nsearch the MySQL Reference Manual for info1mation about the DECLARE ... \nCONDITION statement.\n\nChapter 13 \nLanguage skills for writing stored progra,ns \n419 \nCommonly used MySQL error codes \nError \nSQLSTATE \ncode \ncode \nDescription \n1329 \n02000 \n1062 \n2 3000 \n1048 \n2 3000 \n1216 \n23000 \n1217 \n23000 \nOccurs when a program attempts to fetch data from a \nrow that doesn't exist. \nOccurs when a program attempts to store duplicate \nvalues in a column that has a unique constraint. \nOccurs when a program attempts to insert a NULL \nvalue into a column that doesn't accept NULL values. \nOccurs when a pro grain attempts to add or update a \nchild row but can't because of a foreign key constraint. \nOccurs when a program atten1pts to delete or update a \nparent row but can't because of a foreign key constraint. \nBuilt-in named conditions \nNamed condition \nDescription \nNOT FOUND \nSQLEXCEPTION \nSQLWARNING \nOccurs when a progran1 attempts to use a FETCH statement \nor a SELECT statement to retrieve data and no data is found. \nOccurs when any error condition other than the NOT FOUND \ncondition occtrrs. \nOccurs when any error condition other than the NOT FOUND \ncondition occurs or when any warning messages occur. \nThe syntax for declaring a condition handler \nDECLARE {CONTINUE jEXIT} HANDLER \nFOR {mysql_error_ codelSQLSTATE sqlstate_ code lnamed_condition} \nhandl er_ ac tions; \nHow to declare a condition handler for a MySQL error code \nDECLARE CONTINUE HANDLER FOR 1329 \nSET r ow_ not_ found = TRUE \nHow to declare a condition handler for a SQLSTATE code \nDECLARE CONTINUE HANDLER FOR SQLSTATE '02000' \nSET row not found= TRUE \nHow to declare a condition handler for a named condition \nDECLARE CONTINUE HANDLER FOR NOT FOUND \nSET row_not_ found = TRUE \nDescription \n• \nYou can use the DECLARE ... HANDLER statement to declare a handler for errors \nthat may occur. In MySQL, this is refe1Ted to as a condition handler. \n• \nTo continue execution when an error occurs, use the CONTINUE keyword. To exit \nthe current block of code when an error occurs, use the EXIT keyword. \n• \nFor a complete list of the MySQL erro1· codes and their corresponding SQLSTATE \ncodes, you can search the MySQL Reference Manual for ''Server error codes''. \nFigure 13-9 \nHow to declare a condition handler\n\n420 \nSection 4 \nStored prvgram development \nHow to use a condition handler \nNow that you know how to declare a condition handler, figure 13-10 shows \nhow to use a condition handler. To help you understand the difference between \na stored program that handles errors and one that doesn't, the first stored \nprocedure shows what happens when an error occurs and the procedure doesn't \nhandle errors. Here, the INSERT statement attempts to insert a duplicate value \n(''Cash'') into a column (account_description) that has been defined with a \nunique constraint. Because the error condition this causes isn't handled, MySQL \ndisplays an error message like the one that's shown. This message identifies \nthe error code (1062), and it displays a description of the error that helps you \nidentify the cause of the error. \nAlthough an error message like this can be helpful as you develop a stored \nprocedure, it isn't helpful to the end user of an application. As a result, you often \nwant to handle exceptions before you put your stored programs into production. \nSince the most specific way to handle an error is to use a MySQL e1Tor code, \nyou usually want to declare a condition handler for the error code that's occur-\nring. Then, you can handle this error by executing the appropriate code. Often, \nthat just means displaying a more user-friendly message. However, you can also \nperform other error-handling tasks such as writing information about the error to \na log table or rolling back a transaction. \nThe second stored procedure handles the error that occurs. To do that, it \nbegins by declaring a variable named duplicate_entry _for_key of the TINYINT \ntype and setting its default value to FALSE. Then, it declares a handler for error \ncode 1062. This handler uses the CONTINUE keyword to allow the procedure \nto continue executing when the error is encountered. However, it also uses a SET \nstatement to set the value of the duplicate_entry _for_key variable to TRUE. As \na result, the IF statement can test the value of this variable and handle the error \nwhen it occurs. In this figure, this code just handles the error by displaying a \nmessage that indicates that the row was not inserted because of a duplicate key. \nTo test this procedure, you can change the values in the INSERT statement. \nIf you run the statement as shown in this figure, for example, the error with \ncode 1062 occurs and the stored procedure returns the result set shown in this \nfigure. However, if you enter valid values, this procedure returns a result set that \nindicates that one row was inserted.\n\nChapter 13 \nLanguage skills for writing stored progra,ns \n421 \nA stored procedure that doesn't handle errors \nDELIMITER// \nCREATE PROCEDURE test() \nBEGIN \nINSERT INTO general_ ledger_ accounts VALUES (130, 'Cash'); \nSELECT '1 row was inserted.'; \nEND// \nThe response from the system \nError Code: 1062. Duplicate entry 'Cash' for key 'account_description' \nA stored procedure that uses a CONTINUE handler to handle an error \nDELIMITER// \nCREATE PROCEDURE test() \nBEGIN \nDECLARE duplicate_entry_ for_key TINYINT DEFAULT FALSE; \nDECLARE CONTINUE HANDLER FOR 1062 \nSET duplicate_entry_ for_key = TRUE; \nINSERT INTO general_ ledger_accounts VALUES (130, 'Cash'); \nIF duplicate_entry_ for_key = TRUE THEN \nSELECT 'Row was not inserted - duplicate key encountered.' AS message; \nELSE \nSELECT '1 row was inserted.' AS message; \nEND IF; \nEND// \nThe response from the system \nmessage \n► \nRow was not inserted - duplicate key encountered. \nFigure 13-10 \nHow to use a condition handler (part 1 of 2)\n\n422 \nSection 4 \nStored prvgram development \nThe first stored procedure in part 2 shows how to exit the current block \nof code as soon as an error occurs. To start, this stored procedure begins by \ndeclaring a variable named duplicate_entry _for_key just like the stored proce-\ndure in part 1. Then, it uses the BEGIN and END keywords to nest a block of \ncode within the block of code for the procedu1·e. Within the nested block of code, \nthe frrst statement declares a condition handler for the MySQL error with a code \nof 1062. This handler uses the EXIT keyword to indicate that it should exit the \nblock of code when this error occurs. Then, the second statement executes the \nINSERT statement that may cause the error. If no error occurs, the third state-\nment in the block displays a message that indicates that the row was inserted. \nIf an error occurs, however, the duplicate_entry _for_key variable is set to \nTRUE. In addition, code execution exits the block of code and jumps to the IF \nstatement that's coded after the block. This statement displays a message that \nindicates that the row was not inserted because of a duplicate key. \nSo, when should you use a CONTINUE handler and when should you use an \nEXIT handler? 111 general, it's a matter of personal preference. However, if you \nwant to allow MySQL to attempt to execute statements in a block of code even \nafter it encounters an error, you should use a CONTINUE handler. On the other \nhand, if allowing MySQL to continue to execute statements in the block causes \nproblems, you should use an EXIT handler. \nThe last stored procedure in this figure shows how to use a named condition \nto handle the error that occurs when a row can't be inserted. In this case, the \nstored procedure uses the SQLEXCEPTION condition. When this condition \noccurs, the stored procedure displays a message that indicates that the row was \nnot inserted because of a SQL exception. \nWhen handling the SQLEXCEPTION condition, many programmers \nmake the mistake of displaying a generic message like this: ''An unexpected \nerror occurred.\" Although this message is user-friendly, it doesn't provide any \ninformation that can help a programmer find and fix the error. As a result, it's \noften better not to handle this exception at all. In that case, the stored procedure \ndisplays an error as shown in the first example in part 1 of this figure.\n\nChapter 13 \nLanguage skills for writing stored progra,ns \n423 \nA stored procedure that uses an EXIT handler to handle an error \nDELIMITER// \nCREATE PROCEDURE test() \nBEGIN \nDECLARE duplicate_entry_ for_key TINYINT DEFAULT FALSE; \nBEGIN \nDECLARE EXIT HANDLER FOR 1062 \nSET duplicate_entry_ for_key = TRUE; \nINSERT INTO general_ ledger_accounts VALUES (130, 'Cash'); \nSELECT '1 row was inserted.' AS message; \nEND; \nIF duplicate_entry_ for_key = TRUE THEN \nSELECT 'Row was not inserted - duplicate key encountered.' AS message; \nEND IF; \nEND// \nThe response from the system \nmessage \n-\n' \n► \nRow was not inserted -duplicate key encountered. \nA stored procedure that uses a named condition to handle all errors \nDELIMITER// \nCREATE PROCEDURE test() \nBEGIN \nDECLARE sql_ error TINYINT DEFAULT FALSE; \nBEGIN \nDECLARE EXIT HANDLER FOR SQLEXCEPTION \nSET sql_ error = TRUE; \nINSERT INTO general_ ledger_ accounts VALUES (130, 'Cash'); \nSELECT \n1 1 row was inserted.' AS message; \nEND; \nIF sql_error = TRUE THEN \nSELECT 'Row was not inserted -\nSQL exception encountered.' AS message; \nEND IF; \nEND// \nThe response from the system \nmessage \n► I Row was not inserted SQl exception encountered. \nDescription \n• \nIf you want MySQL to exit the current block of code as soon as it encounters an \nerror, use an EXIT handler. \nFigure 13-10 \nHow to use a condition handler (part 2 of 2)\n\n424 \nSection 4 \nStored prvgram development \nHow to use multiple condition handlers \nWhen coding a stored program, it's common to declare multiple condi-\ntion handlers as shown in figure 13-11. If you do that, the most specific error \nhandlers are executed first, and the least specific error handlers are executed last. \nThe stored procedure in this figure begins by declaiing three variables that \nare used to indicate whether an error condition has occun·ed. Here, all three \nvariables are set to a default value of FALSE. \nAfter declaring these three variables, this stored procedure defines a block \nof code. Within this block, the first three statements declare three condition \nhandlers that correspond with the three variables. These handlers all exit the \nblock of code if the specified en·or occurs. Of these handlers, the first two are \nspecific to MySQL error codes 1062 and 1048, but the third is a general handler \nthat catches any other errors that may occur. \nAfter the block of code, an IF statement examines the variables that are set \nby the condition handlers. Then, it executes the appropriate code. For the first \ntwo variables, this code displays a t1ser-friendly message that's appropriate for \nthe corresponding MySQL error code. For the third variable, this code displays \ninformation about the unanticipated error that occurred. In other words, if \nMySQL error code 1062 or 1048 occurs, this code displays a t1ser-friendly \nerror that includes information about the error that's useful to the progi·ammer. \nOtherwise, it displays a user-friendly en·or message that includes information \nthat's less useful to the programmer. \nIf you run the stored procedure shown in this figure, it returns a result set \nlike the one that's shown. In this case, the row wasn't inserted because the \nfirst column contained an illegal NULL value. To test for other errors, you can \nchange the valt1es in the INSERT statement. For example, if you enter a third \ncolumn with a value of 'xx', the stored procedure executes the condition handler \nfor the SQLEXCEPTION condition.\n\nChapter 13 \nLanguage skills for writing stored progra,ns \n425 \nA stored procedure that uses multiple condition handlers \nDELIMITER// \nCREATE PROCEDURE test() \nBEGIN \nDECLARE duplicate_entry_ for_key TINYINT DEFAULT FALSE; \nDECLARE colwnn_cannot_be_null \nTINYINT DEFAULT FALSE; \nDECLARE sql_exception \nTINYINT DEFAULT FALSE; \nBEGIN \nDECLARE E.XIT HANDLER FOR 1062 \nSET duplicate_ entry_ for_key = TRUE; \nDECLARE EXIT HANDLER FOR 1048 \nSET colwnn_cannot_be_null = TRUE; \nDECLARE EXIT HANDLER FOR SQLEXCEPTION \nSET sql_ exception = TRUE; \nINSERT INTO general_ ledger_ accounts VALUES (NULL, 'Test'); \nSELECT '1 row was inserted.' AS message; \nEND; \nIF duplicate_entry_ for_key = TRUE THEN \nSELECT 'Row was not inserted - duplicate key encountered.' AS message; \nELSEIF column_cannot_be_null = TRUE THEN \nSELECT 'Row was not inserted - colwnn cannot be null.' AS message; \nELSEIF sql_exception = TRUE THEN \nSELECT 'Row was not inserted -\nSQL exception encountered.' AS message; \nEND IF; \nEND// \nThe response from the system \nmessage \n·---\n► \nRow was not inserted -column cannot be null. \nDescription \n• \nYou can declare multiple condition handlers for a single stored program. If you do \nthat, the most specific error handlers are executed first and the least specific error \nhandlers are executed last. \n• \nThe MySQL en·or codes and the NOT FOUND condition identify specific errors. \nThe SQLSTATE codes identify less specific ANSI-standard errors. And the \nSQLEXCEPTION and SQLWARNING conditions identify general errors. \nFigure 13-11 \nHow to use multiple condition handlers\n\n426 \nSection 4 \nStored prvgram development \nPerspective \nIn this chapter, you were introduced to stored programs, and you learned \nhow to use MySQL to write procedural code. In the next three chapters, you'll \nlearn more about writing stored programs. In chapter 14, you '11 leam how to \nmanage transactions and locking. In chapter 15, you'll learn how to code stored \nprocedures and functions. And in chapter 16, you'll learn bow to code triggers \nand events. \nTerms \nstored program \nstored procedure \nstored function \nstored routine \ntrigger \nevent \nblock of code \nvariable \nBoolean expression \nnested statement \nsimple CASE statem.ent \nExercises \nsearched CASE statement \nloop \nWHILE loop \nREPEAT loop \nsimple LOOP \ncounter \ncursor \ncondition handler \nerror handler \nexception handler \nnained condition \nEach of the scripts that you create in the following exercises should use the \nsame general structure as the script presented in figure 13-1. \n1. \nWrite a script that creates and calls a stored procedure named test. This \nstored procedure should declare a vaiiable and set it to the count of all rows \nin the Invoices table that have a balance due that's greater than or equal to \n$5,000. Then, the stored procedure should display a result set that displays the \nvai·iable in a message like this: \n3 invoices exceed $5,000. \n2. \nWrite a script that creates and calls a stored procedure named test. This stored \nprocedure should use two variables to store ( 1) the count of all of the invoices \nin the Invoices table that have a balance due and (2) the sum of the balances \ndue for all of those invoices. If that total balance due is greater than or equal \nto $30,000, the stored procedure should display a result set that displays the \nvalues of both variables. Otherwise, the procedure should display a result set \nthat displays a message like this: \nTotal balance due is less than $30,000. \n3. \nWrite a script that creates and calls a stored procedure named test. This proce-\ndure should calculate the factorial for the number 10. (To calculate a factorial, \nyou multiply an integer by every positive integer less than itself.) Then, it \nshould display a string that includes the factorial like this: \nThe factorial of 10 is: 3,628,800.\n\nChapter 13 \nLanguage skills for writing stored progra,ns \n427 \n4. \nWrite a script that creates and calls a stored procedure named test. This proce-\ndure should create a cursor for a result set that consists of the vendor_name, \ninvoice_number, and balance_due columns for each invoice with a balance \ndue that's greater than or equal to $5,000. The rows in this result set should \nbe sorted in descending sequence by balance due. Then, the procedure should \ndisplay a string variable that includes the balance due, invoice number, and \nvendor name for each invoice so it looks something like this: \n16896.06IP-0608IMalloy Lithographing Inc//9878.4SI0-2436IMalloy \nLithographing Inc// \nHere, each column is separated by a pipe character (I) and each row is \nseparated by two front slashes (/ /). \n5. \nWrite a script that creates and calls a stored procedure named test. This \nprocedure should attempt to update the invoice_due_date column so it's equal \nto NULL for the invoice with an invoice ID of 1. If the update is successful, \nthe procedure should display this message: \n1 row was updated. \nIf the update is unsuccessful, the procedure should display this message: \nRow was not updated -\ncolumn cannot be null. \n6. \nWrite a script that creates and calls a stored procedure named test. This proce-\ndure should identify all of the prime numbers less than 100. (A prime number \nis an integer that can't be divided by another integer other than I and itself.) \nThen, it should display a string variable that includes the prime numbers like \nthis: \n2 \nI 3 \nI s I 1 \nI 11 I 13 \nI 11 \nI 19 \nI 23 \nI 29 \nI 31 1--· \nHint: To get this to work, you will need to nest one loop within ariother loop. \nIn addition, you will need to code an IF statement within the inner loop. \n7. \nEnhance your script for exercise 4 so it shows the invoice data in three groups \nbased on the balance due amount with these headings: \n$20,000 or More \n$10,000 to $20,000 \n$5,000 to $10,000 \nWhen you're done, the string variable that's returned should be in this format: \n$20,000 or More: $10,000 to $20,000: 16896.06IP-0608IMalloy \nLithographing Inc//$5,000 to $10,000: 9878.4Sj0-2436IMalloy \nLithographing Inc// \nTo accomplish this, you can loop through the cursor three times by opening \nand closing the cursor for each loop. Hint: For each group of invoices, you \ncan code a separate block of code that contains an EXIT handler for the NOT \nFOUND condition.\n\nHow to use transactions \nand locking \nIf you've been working with MySQL on your own computer, you've been the \nonly user of your database. In the real world, though, a database may be used \nby thousands of users at the same time. Then, what happens when two users \ntry to update the same data at the same time? In this cha.pter, you'll learn how \nMySQL handles this situation. But first, you'll learn how to combine multiple \nSQL statements into a single logical unit of work known as a transaction. \nHow to work with transactions ......................................... 430 \nHow to commit and rollback transactions ................................................... 430 \nHow to work with save points ...................................................................... 432 \nHow to work with concurrency and locking .................... 434 \nHow concurrency and locking are related ................................................... 434 \nThe four concurrency problems that locks can prevent .............................. 436 \nHow to set the transaction isolation level .................................................... 438 \nHow to Jock selected rows .......................................................................... 440 \nHow to prevent deadlocks ............................................................................ 442 \nPerspective ......................................................................... 444\n\n430 \nSection 4 \nStored prvgram development \nHow to work with transactions \nA transaction is a group of SQL statements that you combine into a single \nlogical unit of work. By combining SQL statements like this, you can prevent \ncertain kinds of database errors. \nBefore you begin using MySQL to work with transactions, you should \nrealize that some storage engines don't st1pport transactions. In particular, the \nMyISAM storage engine doesn't support transactions. As a result, the skills \npresented in this topic only apply to storage engines such as InnoDB that support \ntransactions. \nHow to commit and rollback transactions \nBy default, a MySQL session uses autocommit mode, which automatically \ncommits INSERT, UPDATE, and DELETE statements immediately after you \nexecute them. So far in this book, we have assumed that you have been using \nautocommit mode. If that's not what you want, though, you can use transactions \nto control when changes are committed. \nSince transactions are often coded within stored procedures, figure 14-1 \npresents a stored procedure na1ned test that contains three INSERT statements \nthat are coded as a transaction. To start, this stored procedure declares a variable \nnamed sql_error and sets it to FALSE to indicate that no SQL error has occurred. \nThen, the second DECLARE statement creates a condition handler that sets the \nsql_error variable to TRUE if a SQL error occurs. \nThe START TRANSACTION statement identifies the start of the transac-\ntion, which temporarily turns off autocommit mode. Then, the first INSERT \nstatement adds a new invoice to the Invoices table. Next, two mo1·e INSERT \nstatements add the line items for the invoice to the Invoice_Line_Items table. \nAfter the INSERT staten1ents, an IF statement uses the sql_error vaiiable to \ncheck whether an error occurred when executing any of the INSERT statements. \nIf a SQL error did not occur, this code uses the COMMIT statement to commit \nthe changes to the database, which makes the c.hanges permanent. Otherwise, the \nROLLBACK statement rolls back the changes, which cancels them. \nTo understand why this is necessary, suppose that each of these INSERT \nstatements is committed to the database immediately after it's executed. Then, \nwhat will happen if the third INSERT stateme.nt fails? In that case, the Invoices \nand Invoice_Line_Items tables won't match. Specifically, the sum of the \nline_item_amount columns in the lnvoice_Line_Items table won't be equal to \nthe invoice_total column in the Invoices table. In other words, the integrity of the \ndata won't be maintained. \nSimilarly, consider the example of a transfer between a checking and a \nsavings account in a banking system. In that case, one update reduces the \nbalance in the checking account and another update increases the balance in the \nsavings account. Then, if one of these updates fails, the customer either gains or \nloses the amount of the transaction. But here again, treating the two updates as a \nsingle transaction solves this problem. Usually, that's what you want.\n\nChapter 14 \nHow to use transactions and locking \n431 \nA stored procedure that runs three INSERT statements as a transaction \nDELIMITER// \nCREATE PROCEDURE test(} \nBEGIN \nDECLARE sql_ error TINYINT DEFAULT FALSE; \nDECLARE CONTINUE HANDLER FOR SQLEXCEPTION \nSET sql_ error = TRUE; \nSTART TRANSACTION; \nINSERT INTO invoices \nVALUES ( 115, 34, • ZXA-080 •, • 2018-01-18', \n14092. 59, 0, 0, 3, '2018-04-18', NULL}; \nINSERT INTO invoice_ line_ items \nVALUES (115, 1, 160, 4447.23, 'HW upgrade'); \nINSERT INTO invoice_ line_ items \nVALUES (115, 2, 167, 9645.36, 'OS upgrade'); \nIF sql_error = FALSE THEN \nCOMMIT; \nSELECT 'The transaction was committed.'; \nELSE \nROLLBACK; \nSELECT 'The transaction was rolled back.'; \nEND IF; \nEND// \nWhen to use transactions \n• \nWhen you code two or more INSERT, UPDATE, or DELETE statements that affect \nrelated data. \n• \nWhen you move rows from one table to another table by using INSERT and \nDELETE statements. \n• \nWhenever the failure of an INSERT, UPDATE, or DELETE statement would \nviolate data integrity. \nDescription \n• \nBy default, MySQL runs in autocommit mode, which automatically commits \nchanges to the database immediately after each INSERT, UPDATE, or DELETE \nstatement is executed. If that's not what you want, you can group statements into a \nlogical unit of work called a transaction. \n• \nTo start a transaction, code the START TRANSACTION statement. This turns off \nautocommit mode until the staten1ents in the transaction are committed or rolled \nback. To com,nit the changes, code a COMMIT statement. To roll back the changes, \nuse a ROLLBACK statement. \n• \nMySQL automatically commits changes after a DDL statement such as a CREATE \nTABLE statement. As a result, you shouldn't code a DDL statement within a \ntransaction unless you want to comm.it the changes and end the transaction. \nFigure 14-1 \nHow to commit and roll back transactions\n\n432 \nSection 4 \nStored prvgram development \nHow to work with save points \nThe script in figure 14-2 shows how to use the SAVEPOINT statement to \nidentify one or more save points within a transaction. Here, a SA VEPOINT \nstatement is used to identify a save point before each of the three INSERT state-\nments that are included in the script. As a result, the script includes three save \npoints. \nThis script also shows how to use the ROLLBACK TO SAVEPOINT \nstatement to roll back all or part of a transaction. Here, the three ROLLBACK \nTO SA VEPOINT statements rollback the transaction to each of the three save \npoints. The frrst statement rolls back to the point before the second line item was \ninserted. The second statement rolls back to the point before the frrst line item \nwas inserted. And the third statement rolls back to the point before the invoice \nwas inserted. \nAt this point, the script calls the COMMIT statement to commit any changes \nthat have been made. However, the three ROLLBACK TO SAVEPOINT state-\nments have rolled back all three INSERT statements, so this doesn't commit any \nchanges to the database. To verify this, you can use a SELECT statement to view \nthe rows in the Invoices and Invoice Line Items tables that have an invoice id \n-\n-\n-\nof 115. \nIn general, save points are used when a transaction contains so many state-\n1nents that rolling back the entire transaction would be inefficient. In that case, \nan application can roll back to the last save point before an error occun·ed. \nThen, the appropriate processing can be done from there. For most applications, \nthough, you won't need to use save points. \nIn most cases, a transaction and its save points are coded within a stored \nprocedure as shown in figure 14-1. In this figure, though, the transaction and its \nstatements are coded in a script. Although this isn't a realistic example, it does \nshow how save points work, so you should be able to use them if you ever need \nto. In addition, this example shows that you can use the statements for working \nwith transactions within a script, which is sometimes helpful when working with \ndatabase creation scripts like the ones described in chapter 11.\n\nA script that uses save points \nUSE ap; \nSTART TRANSACTION; \nSAVEPOINT before_ invoice; \nINSERT INTO invoices \nChapter 14 \nHow to use transactions and locking \n433 \nVALUES (115, 34, • ZXA-080 •, • 2018-01-18', \n14092.59, 0, 0, 3, '2018-04-18', NULL); \nSAVEPOINT before_ line_ iteml; \nINSERT INTO invoice_line_ items \nVALUES (115, 1, 160, 4447.23, 'HW upgrade'); \nSAVEPOINT before_ line_ item2; \nINSERT INTO invoice_ line_ items \nVALUES (115, 2, 167, 9645.36,'0S upgrade•); \nROLLBACK TO SAVEPOINT before_ line_ item2; \nROLLBACK TO SAVEPOINT before_ line_ iteml; \nROLLBACK TO SAVEPOINT before_ invoice; \nCOMMIT; \nDescription \n• \nWhen you use save points, you can roll back a transaction to the beginning of the \ntransaction or to a particular save point. \n• \nYou can use the SAVEPOINT statement to create a save point with the specified \nname. \n• \nYou can use the ROLLBACK TO SAVEPOINT statement to roll back a transaction \nto the specified save point. \n• \nSave points are useful when a single transaction contains so many SQL statements \nthat rolling back the entire transaction would be inefficient. \nFigure 14-2 \nHow to work with save points\n\n434 \nSection 4 \nStored prvgram development \nHow to work with concurrency \nand locking \nWhen two or more users have access to the same database, it's possible for \nthem to be working with the same data at the same time. This is called concur-\nrency. Although concurrency isn't a problem when two users retrieve the same \ndata at the same time, it can become a problem when one user updates data that \nother t1sers are also viewing or updating. In the topics that follow, you'll learn \nhow to prevent concu1Tency problems. \nHow concurrency and locking are related \nFigure 14-3 presents two transactions that show how MySQL handles \nconcurrency by default. To start, transaction A submits an UPDATE statement \nthat adds a value of 100 to the value that's stored in the credit_total column \nof the invoice that has an invoice_id value of 6. Because transaction A hasn't \nyet co1nmitted this change to the database, it retains a lock on this row. This is \nknown as locking. \nAt this point, if you run the SELECT statement in transaction B, the result \nset doesn't include the updated value in the credit_total column. In other words, \nthe SELECT statement only reads changes that have been committed. \nIn addition, the UPDATE statement in transaction B won't be able to update \nthe row due to the lock that t1·ansaction A has on the row. As a result, it will have \nto wait for transaction A to finish before it updates the row. \nOnce transaction A commits the change made by the UPDATE statement, \nthe SELECT statement in transaction B will show the updated value in the \ncredit_total column if you run it again. In addition, when transaction A commits \nthe update, it releases its lock on the row. Then, the UPDATE statement in \ntransaction B finishes executing if it has been waiting. Or, if you execute the \nUPDATE statement in transaction B again, it will execute immediately. \nTo experiment with concurrency, you need to simulate multip]e users by \nopening multiple connections and using them to execute SQL statements. For \nexa1nple, when you're using MySQL Workbench, you can use the Home tab \nto open two connections. (You can even open both connections for the same \nuser.) Then, you can use the frrst connection to execute transaction A and the \nsecond connection to execute transaction B. To do that, you can run one state-\n1nent at a time by placing the cursor in each statement and using the Execute \nCun·ent Statement button (Ctrl+Enter). This allows you to slow down the \nexecution of each script. Otherwise, if you use the Execute SQL Script button \n(Ctrl+Shift+Enter), the script runs so quickly that you won't be able to get both \nscripts to access the same 1·ow at the same time. \nThis example shows that MySQL's default locking behavior prevents most \nconcurrency problems. However, if you find that the default locking behavior \nis insufficient, you may need to override it. You'll learn how to do that in a \nmoment. But first, you need to understand the four concurrency problems that \nlocks can prevent.\n\nChapter 14 \nHow to use transactions and locking \n435 \nTwo transactions that retrieve and then modify the data in the same row \nTransaction A \n-- Execute each statement one at a time. \n-- Alternate with Transaction Bas described. \nSTART TRANSACTION; \nUPDATE invoices SET credit_total = credit_ total + 100 WHERE invoice_ id = 6; \n-- the SELECT statement in Transaction B won't show the updated data \n-- the UPDATE statement in Transaction B will wait for transaction A to finish \nCOMMIT; \n-- the SELECT statement in Transaction B will display the updated data \n-- the UPDATE statement in Transaction B will execute immediately \nTransaction B \n-- Use a second connection to execute these statements! \n-- Otherwise, they won't work as described. \nSTART TRANSACTION; \nSELECT invoice_ id, credit_ total FROM invoices WHERE invoice_id = 6; \nUPDATE invoices SET credit_total = credit_ total + 200 WHERE invoice_ id = 6; \nCOMMIT; \nDescription \n• \nConcurrency is the ability of a system to support two or more transactions working \nwith the same data at the same time. \n• \nMySQL can automatically prevent some concurrency problems by using locks. A lock \nstops the execution of another transaction if it conflicts with a transaction that is already \n• \nrunning. \n• \nConcun·ency is a problem only when the data is being modified. When two or more \nSELECT statements read the same data, the SELECT statements don't affect each \nother. \nFigure 14-3 \nHow concurrency and locking are related\n\n436 \nSection 4 \nStored prvgram development \nThe four concurrency problems \nthat locks can prevent \nFigure 14-4 describes the four most common concurrency problems. To \nstart, a lost update is the problem that you've already learned about. It occurs \nwhen two transactions select the same row and then update the row based on the \nvalues originally selected. Since each transaction is unaware of the other, the \nlater update overwrites the earlier update. For many applications, though, this \ntype of problem rarely occurs, and it isn't serious when it does occur. \nLike lost updates, the other three problems may not adversely affect a \ndatabase. In fact, for many applications, these problems occur infrequently. \nThen, when they do occur, they can be corrected by resubmitting the SQL state-\nment that experienced the problem. On some database systems, however, these \nproblems can compromise data integrity so they need to be dealt with. \nAlthough locks can prevent the problems listed in this figure, MySQL's \ndefault locking behavior doesn' t prevent pliantom reads. If this level of locking \nisn't acceptable, you can change the default locking behavior by setting the \ntransaction isolation level as shown in the next figu1·e.\n\nChapter 14 \nHow to use transactions and locking \n437 \nThe four types of concurrency problems \nProblem \nDescription \nLosl updates \nDirty reads \nNonrepeatable reads \nPhantom reads \nDescription \nOccur when two transactions select the same row a11d then update the row \nbased on the values originally selected. Since each transaction is unaware \nof the other, the later update overwrites the earlier update. \nOccur when a transaction selects data that l1asn 't been committed by \nanother transaction. For example, transaction A cha11ges a row. Tra11saction \nB then selects the changed row before transaction A commits the change. \nIf transaction A then rolls back the change, transaction B has selected data \nthat doesn't exist in the database. \nOccur when two SELECT statements tl1at try to get the same data get \ndifferent values because another transaction has updated the data in the \ntime between the two statements. For example, transaction A selects a row. \nTransaction B then updates the row. When transaction A selects the same \nrow again, the data is different. \nOccur when you perlor1n an update or delete on a set of rows at the same \ntime that another transaction is pe1fo1ming an insert or delete that affects \none or more rows in that same set of rows. For exa1nple, transaction A \nupdates the payment total for each invoice that has a balance due, but trans-\naction B inserts a new, unpaid, invoice while transaction A is still running. \nAfter transaction A finisl1es, there is still an invoice with a balance due. \n• \nIn a large system with many users, you should expect for these ki11ds of problems \nto occur. In general, you don't need to take any action except to anticipate the \nproblem. In many cases, if the SQL statement is resubmitted, the problem goes \naway. \n• \nOn some systems, if two transactions overwrite each other, the validity of the \ndatabase is compromised and resubmitting one of the transactions won't eliminate \nthe problem. If you 're working on such a system, you must anticipate these concur-\nrency problems and account for them in your code. \n• \nIf one of these problems could affect the data integrity of your system, you can \nchange the default locking behavior by setting the transaction isolation level as \nshown in the next figure. \nFigure 14-4 \nThe four concurrency problems that locks can prevent\n\n438 \nSection 4 \nStored prvgram development \nHow to set the transaction isolation level \nThe simplest way to prevent concurrency problems is to change the default \nlocking behavior. To do that, you use the SET TRANSACTION ISOLATION \nLEVEL statement shown in figure 14-5 to set the transaction isolation level. By \ndefault, this statement sets the isolation level for the next new transaction in the \ncurrent session. If you want to set the isolation level for all the transactions in a \nsession, though, you can include the SESSION keyword. And if you want to set \nthe isolation level for all sessions, you can include the GLOBAL keyword. The \nexamples in this figure illustrate how this works. \nThis figure also lists the four transaction isolation levels that MySQL \nprovides and shows which concurrency problems they prevent or allow. For \nexample, if you use the SERIALIZABLE option, all four concurrency problems \nwill be prevented. \nWhen you set the isolation level to SERIALIZABLE, each transaction is \ncompletely isolated from every other transaction and concurrency is severely \nrestricted. The server does this by locking each resource, preventing other \ntransactions from accessing it. Since each transaction must wait for the previous \ntransaction to commit, the transactions are executed serially, one after another. \nSince the SERIALIZABLE level eliminates all concurrency problems, you \nmay think that this is always the best option. However, this option requires more \noverhead to manage all of the locks, so the access time for each transaction is \nincreased. For some systems, this may cause significant performance problems. \nAs a result, you typically want to use the SERIALIZABLE isolation level only \nfor situations in which phantom reads aren't acceptable. \nThe lowest isolation level is READ UNCOMMITTED, which allows all \nfour of the concurrency problems to occur. It does this by performing SELECT \nqueries without setting any locks and without honoring any existing locks. Since \nthis means that yom· SELECT statements will always execute immediately, this \nsetting p1·ovides the best performance. Since other t1·ansactions can retrieve and \nmodify the same data, however, this setting can't prevent concurrency problems. \nThe READ COMMITTED isolation level prevents transactions from \nseeing data that has been changed by other transactions but not committed. This \nprevents dirty reads, but allows for other types of concurrency problems. \nThe default isolation level for MySQL is REPEATABLE READ. With \nthis level, rows read by a transaction will be read consistently within the same \ntransaction. To accomplish that, the server places locks on all the data used by \nthe transaction that prevent other users from updating the data. \nThe REPEATABLE READ level allows more concurrency than the \nSERIALIZABLE level but less tha11 the READ COMMITTED level. As you \nmight expect, then, it results in faster performance than SERIALIZABLE and \npermits fewer concurrency problems than READ COMMITTED. In 1nost situa-\ntions, then, the default isolation level of REPEATABLE READ is acceptable.\n\nChapter 14 \nHow to use transactions and locking \n439 \nThe concurrency problems prevented by each transaction isolation level \nDirty \nreads \nLost \nNonrepeatable \nPhantom \nIsolation level \nupdates \nreads \nreads \nREAD UNCOMMITTED \nREAD COMMITTED \nREPEATABLE READ \nSERIALIZABLE \nAllows \nAllows \nPrevents \nAllows \nPrevents \nPrevents \nPrevents \nPrevents \nAllows \nAllows \nPrevents \nPrevents \nAllows \nAllows \nAllows \nPrevents \nThe syntax of the SET TRANSACTION ISOLATION LEVEL statement \nSET {GLOBAL ISESSION} TRANSACTION ISOLATION LEVEL \n{READ UNCOMMITTED IREAD COMMITTED IREPEATABLE READISERIALI ZABLE} \nSet the transaction isolation level to SERIALIZABLE \nfor the next transaction \nSET TRANSACTION ISOLATION LEVEL SERIALIZABLE \nSet the transaction isolation level to READ UNCOMMITTED \nfor the current session \nSET SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED \nSet the transaction isolation level to READ COMMITTED for all sessions \nSET GLOBAL TRANSACTION ISOLATION LEVEL READ COMMITTED \nDescription \n• \nThe transaction isolation level controls the degree to which transactions are isolated \nfrom one another. At the more restrictive isolation levels, concurrency problems are \nreduced or eliminated. However, at the least restrictive levels, performance is enhanced. \n• \nTo change the transaction isolation level, you use the SET TRANSACTION \nISOLATION LEVEL statement. \n• If you include the GLOBAL keyword, the isolation level is set globally for all new \ntransactions in all sessions. If you include the SESSION keyword, the isolation level \nis set for all new transactions in the current session. If you omit both GLOBAL and \nSESSION, the isolation level is set for the next new transaction in the current session. \n• \nThe default transaction isolation level is REPEATABLE READ. This level places \nlocks on all data that's used in a transaction, preventing other users fro1n updating that \ndata. However, thls isolation level still allows inserts, so phantom reads can occur. \n• \nThe READ UNCOMMITTED isolation level doesn't set any locks and ignores \nlocks that are already held. This level results in the highest possible performance \nfor your query, but at the risk of every kind of concurrency problem. For this \nreason, you should only use this level for data that is rarely updated. \n• \nThe READ COMMITTED isolation level locks data that has been changed but not \ncommitted. This prevents dirty reads but allows all other types of concurrency problems. \n• \nThe SERIALIZABLE isolation level places a lock on all data that's used in a \ntransaction. Since each transaction must wait for the previous transaction to commit, \nthe transactions are handled in sequence. This is the most restrictive isolation level. \nFigure 14-5 \nHow to set the transaction isolation level\n\n440 \nSection 4 \nStored prvgram development \nHow to lock selected rows \nIn some cases, the default isolation level of REPEATABLE READ doesn't \nwork the way you want. For example, suppose you want to code a transaction \nthat selects data and then inserts or updates data in related tables. In that case, \nbecause a SELECT statement doesn't lock the data it retrieves by default, \nanother transaction could update or delete the rows read by the first transaction \nbefore that transaction is done modifying the related tables. \nTo solve this type of problem, MySQL provides two ways to lock the rows \nreturned by a SELECT statement. First, you can add a FOR SHARE clause \n(LOCK IN SHARE MODE with MySQL 5.7 and earlier) to the end of a \nSELECT statement. This locks the selected rows so other transactions can read \nthem but can't modify them until your transaction commjts. Second, you can \nadd a FOR UPDATE clause to the end of a SELECT statement. This locks the \nselected rows and any associated indexes just like an UPDATE statement does. \nThen, other transactions can't read or modify these rows until your transaction \ncommits. \nWhen you use the FOR SHARE clause, the SELECT statement waits if it \nencounters rows that have been locked for update by another statement such as \nan UPDATE, DELETE, or SELECT ... FOR UPDATE statement. That way, it \ncan read the most current data. However, the FOR SHARE clause doesn't wait \nfor rows that have been locked for share. On the other hand, the FOR UPDATE \nclause wruts for rows that have been locked for share or for update. Because \nof this, the FOR SHARE clause provides better perforrnance than the FOR \nUPDATE clause. As a result, you should use the FOR SHARE clause if you \ndon't need to prevent other transactions from reading the same rows. \nWith MySQL 8.0 and later, you can also keep your transactions from \nwaiting for locks to be released. To do that, you can add the NO WAIT or SKIP \nLOCKED option to the end of a FOR SHARE or FOR UPDATE clause. The \nNO WAIT option causes the statement to immediately retur·n an error that the \ndeveloper can handle. The SKIP LOCKED option skips any rows that have been \nlocked and returns the rest. \nFigure 14-6 p1·esents a se1ies of transactions that show how the FOR \nSHARE and FOR UPDATE clauses of a SELECT statement work. To start, \ntransaction A executes a SELECT statement that uses the FOR SHARE clause \nto lock the row in the Sales_Reps table that has a rep_id value of 2. At this point, \nno other transactions can modify this row until transaction A completes. This \nmakes sure that transaction A can modify the data in a child table before any \nother transaction can update or delete the corresponding row in the parent table. \nIn transaction B, the SELECT statement includes the FOR UPDATE clause. \nAs a result, it attempts to lock 4 rows for update. If transaction A still has a lock \non one of these rows, though, transaction B waits for that lock to be released. \nOnce transaction A completes, the SELECT statement in transaction B is \nexecuted. This returns four rows with rep_id values of 1, 2, 3, and 4.\n\nChapter 14 \nHow to use transactions and locking \n441 \nFour transactions that show how to work with locking reads \nTransaction A \n-- Execute each statement one at a time. \n- - Al tern.ate with Transactions B, C, and D as described. \nSTART TRANSACTION; \n-- lock row with rep_ id of 2 in parent table ----\nSELECT* FROM sales_ reps WHERE rep_ id = 2 FOR SHARE; \nTransaction B waits for transaction A to finish \nTransaction C returns an error immediately \n-- Transaction D skips the locked row and returns the other rows imm.ediately \n-- insert row with rep_ id of 2 into child table \nINSERT INTO sales_ totals (rep_ id, sales_year, sales_ total) \nVALUES (2, 2019, 138193.69); \nCOMMIT; \n-- Transaction B executes now \nTransaction B - use a second connection for these statements! \nSTART TRANSACTION; \nSELECT * FROM sales_reps WHERE rep_id < 5 FOR UPDATE'; \nCOMMIT; \nTransaction C - use a second connection for these statements! \nSTART TRANSACTION; \nSELECT* FROM sales_ reps WHERE rep_ id < 5 FOR UPDATE NOWAI ; \nCOMMIT; \nTransaction D - use a second connection for these statements! \nSTART TRANSACTION; \nSELECT* FROM sales_reps WHERE rep_ id < 5 ~ OR UPDATE SKIP LOCKED; \nCOMMIT; \nDescription \n• \nIf you add the FOR SHARE clause to the end of a SELECT statement, the selected rows \nare locked so other transactions can read those rows but can't modify them until the \ntransaction commits. \n• \nIf you add the FOR UPDATE clause to the end of a SELECT statement, the selected \nrows and any associated indexes are locked so other transactions can't read or modify \nthem until the transaction commits. This works the same as the locks for an UPDATE \nstatement. \n• \nIf a SELECT ... FOR SHARE statement attempts to read any rows that have been locked \nfor update by another transaction, it waits until that transaction commits so it can use the \nmost current values. \n• \nIf a SELECT ... FOR UPDATE statement attempts to read any rows that have been \nlocked for share or for update by another transaction, it waits until that transaction \ncommits so it can use the most current values. \n• \nWhen the NOWAIT option is included on a FOR SHARE or FOR UPDATE clause, the \nstatement doesn't wait for a lock to be released. Instead, it returns an error immediately. \nThis allows a developer to handle the error instead of waiting for the lock to release. \n• \nWhen the SKIP LOCKED option is included on a FOR SHARE or FOR UPDATE \nclause, the statement doesn't wait for a lock to be released. Instead, it skips the locked \nrows and returns any rows that are not locked. \nFigure 14-6 \nHow to lock selected rows\n\n442 \nSection 4 \nStored prvgram development \nTransaction C works like transaction B, except that it includes the NO WAIT \noption. As a result, if transaction A still has a lock on any rows selected by trans-\naction C, running its SELECT statement causes an error to occur immediately. \nThis allows a developer to handle the error instead of having to wait for the lock \nto be released. \nTransaction D also works like transaction B, except that it includes the \nSKIP LOCKED option. As a result, if transaction A still has a lock on any rows \nselected by transaction D, its SELECT statement executes but skips any locked \nrows. In this example, it skips the row with a rep_id value of 2 and returns three \nrows that have rep_id values of 1, 3, and 4. \nHow to prevent deadlocks \nA deadlock occurs when neither of two transactions can be com1nitted \nbecause each has a lock on a resource needed by the other transaction. This \nis illustrated by the banking transactions in figure 14-7. Here, transaction A \nupdates the savings account first and then the checking account, while transac-\ntion B updates the checkiI1g account first and then the savings account. \nNow, suppose that the first statement in transaction A locks the savings \naccount, and the first statement in transaction Blocks the checking account. At \nthat point, a deadlock occurs because transaction A needs the savings account \nand transaction B needs the checking account, but both are locked. Eventually, \none of the transactions has to be rolled back so the other can proceed, and the \nloser is known as a deadlock victim. \nTo prevent deadlocks, you can use the four techniques that are presented in \nthis figure. First, you shouldn't leave transactions open any longer than is neces-\nsary. That's because the longer a transaction remains open and uncommitted, \nthe more likely it is that another transaction will need to work with that same \nresource. \nSo, when you're coding transactions, make sure to include the appropriate \nCOMMIT and ROLLBACK statements. In addition, don't code statements that \ntake a long time to execute between the START TRANSACTION statement that \nstarts the transaction and the COMMIT or ROLLBACK statement that finishes \nthe transaction. \nSecond, you shouldn't use a higher isolation level than you need. That's \nbecat1se the higher you set the isolation level, the more likely it is that two \ntransactions will be unable to work with the same resource at the same time. \nThird, you should schedule transactions that modify a large number of rows \nto 1·un when no other transactions, or only a small number of other transactions, \nwill be running. That way, it's less likely that the transactions will try to change \nthe same rows at the same time. \nFinally, you should consider how the SQL statements you write could cause \na deadlock. To prevent the situation that's illustrated in this figure, for example, \nyou should always update related accounts in the same sequence.\n\nChapter 14 \nHow to use transactions and locking \n443 \nDon't allow transactions to remain open for very long \n• \nKeep transactions short. \n• \nKeep SELECT statements outside of the transaction except when absolutely \nnecessary. \n• \nNever code requests for user input during a transaction. \nDon't use a transaction isolation level higher than necessary \n• \nThe default level of REPEATABLE READ is usually acceptable, but you should \nconsider changing to READ COMMITTED if deadlocks becon1e a problem. \n• \nReserve the use of the SERIALIZABLE level for short transactions that make \nchanges to data where integrity is vital. \nMake large changes when you can be assured of nearly exclusive access \n• If you need to change millions of rows in an active table, don't do so during hours \nof peak usage. \n• If possible, give yourself exclusive access to the database before making large \nchanges. \nTake locking behavior into consideration when coding your transactions \n• If you need to code two or more transactions that update the same resources, code \nthe updates in the same order in each transaction. \nUPDATE statements that illustrate deadlocking \nTransaction A \nSTART TRANSACTION; \nUPDATE savings SET balance= balance - transfer_amount; \nUPDATE checking SET balance= balance + transfer_amount ; \nCOMMIT; \nTransaction B (possible deadlock) \nSTART TRANSACTION; \nUPDATE checking SET balance = balance -\nt r ansf er_ amount ; \nUPDATE savings SET balance= balance+ transfer_ amount; \nCOMMIT; \nTransaction B (prevents deadlocks) \nSTART TRANSACTION; \nUPDATE savings SET balance = balance+ transfer_ amount; \nUPDATE checking SET balance = balance -\nt ransfer_ amount ; \nCOMMI T; \nDescription \n• \nA deadlock occurs when neither of two transactions can be committed because \neach transaction has a lock on a resource needed by the other transaction. \nFigure 14-7 \nHow to prevent deadlocks\n\n444 \nSection 4 \nStored prvgram development \nPerspective \nIn this chapter, you learned the ways that MySQL protects your data from \nthe problems that can occur on a real-world system. Since the failure of one \nor more related SQL statements can violate data integrity, you learned how \nto prevent these problems by grouping the statements into transactions. SiI1ce \nmultiple transactions can simultaneously modify the same data, you learned \nhow to prevent concurrency problems by setting the transaction isolation level \nto change the default locking behavior. And since changing the isolation level \ncan increase the chances of deadlocks, you learned defensive programming \ntechniques to prevent deadlocks. \nTerms \ntransaction \ncommit a transaction \nroll back a transaction \nsave point \nconcurrency \nlocking \nlost update \nExercises \ndirty read \nnonrepeatable read \nphantom read \ntransaction isolation level \ndeadlock \ndeadlock victim \n1. \nWrite a script that creates and calls a stored procedure named test. This \nprocedure should include a set of three SQL statements coded as a transaction \nto reflect the following change: United Parcel Service has been purchased by \nFederal Express Co1-poration and the new company is named FedUP. Rename \none of the vendors and delete the other after updating the vendor_id column \nin the Invoices table. \nIf these statements execute successfully, commit the changes. Otherwise, roll \nback the changes. \n2. \nWrite a script that creates and calls a stored procedure named test. This \nprocedure sho11ld include a set of two SQL statements coded as a transaction \nto delete the row with an invoice ID of 114 from the Invoices table. To do this, \nyou must first delete all line items for that invoice from the \nInvoice Line Items table. \n-\n-\nIf these statements execute successfully, commit the changes. Otherwise, roll \nback the changes.\n\nHow to create \nstored procedures \nand functions \nIn chapter 13, you learned how to create a stored procedure that didn't accept \nany parameters. Now, you'll learn how to create stored procedures that accept \nparameters. In addition, you'll learn how to code stored functions. \nAs you'll see, stored procedures allow you to store procedural logic such \nas data validation in a central location. In addition, they provide a powerful \nway to control how users are allowed to access the database. \nHow to code stored procedures ....................................... 446 \nHow to create and call a stored procedure ................................................. 446 \nHow to code input and output parameters .................................................. 448 \nHow to set a default value for a para1neter .................................................. 450 \nHow to validate parameters and raise errors ............................................... 452 \nA stored procedure that inserts a row .......................................................... 454 \nHow to work with user variables ................................................................. 458 \nHow to work with dynamic SQL ................................................................ 460 \nHow to drop a stored procedure .................................................................. 462 \nHow to code stored functions ........................................... 464 \nHow to create and call a function ............................................................... 464 \nHow to use function characteristics ............................................................ 466 \nA function that calculates balance due ....................................................... 468 \nHow to drop a function ................................................................................ 470 \nHow to use Workbench with procedures \nand functions ...................................................................... 472 \nHow to view and edit stored routines .......................................................... 472 \nHow to create stored routines ...................................................................... 472 \nHow to drop stored routines ........................................................................ 472 \nPerspective ......................................................................... 474\n\n446 \nSection 4 \nStored prvgram development \nHow to code stored procedures \nA stored procedure, which can also be referred to as a sproc or just a proce-\ndure, is a database object that contains procedural SQL code. You can use stored \nprocedures to modify the data that's stored within a database. For example, \nyou can use a stored procedure to execute an INSERT, UPDATE, or DELETE \nstatement. \nHow to create and call a stored procedure \nFigure 15-1 shows how to use the CREATE PROCEDURE statement \nto create a stored procedure. To start, you code the CREATE PROCEDURE \nkeywords followed by the name of the procedure. In this figure, for example, \nthe statement creates a procedure named update_invoices_credit_total. This \nname clearly indicates that the procedure updates the credit_total column of the \ninvoices table. \nAfter the name of the procedure, you code a set of parentheses. Within \nthe parentheses, you can code one or more pa,·ameters for the procedure. A \nparameter is typically used to pass a value to the stored procedure from a calling \nprogram. \nIf a procedure accepts more than one parameter, you must use commas to \nseparate the parameters. When you declare a parameter, you code the name of \nthe parameter followed by its data type. In this figure, for example, the proce-\ndure accepts two parameters. The first parameter is named invoice_id_param \nwith a data type of INT, and the second parameter is named credit_total_param \nwith a data type of DECIMAL. \nAfter the parentheses, you code a block of statements. This block is identi-\nfied by the BEGIN and END keywords. Within the block, you can code most \nSQL statements including the ones for writing procedural code presented in \nchapter 13 and the ones for working with transactions presented in chapter 14. \nWhen you run the CREATE PROCEDURE statement, MySQL compiles the \ncode for the procedure and stores the compiled code in the database. As part of \nthis process, MySQL's compiler checks the syntax of the code within the proce-\ndure. If you've made a coding e1Tor, the system 1·esponds with an appropriate \nmessage and the procedure isn't created. \nYou can execute, or call, a stored procedure by using the CALL statement. \nIn this figure, for example, the CALL statement calls the procedure that was \ncreated in the first example. This statement passes one value for each of the \nparameters that are defined by the procedure. Here, the first parameter is a literal \nvalue that specifies the invoice ID, and the second parameter is a literal value \nthat identifies the new amount for the credit total. \nWhen you use the CALL statement, you must pass parameters by position. \nIn other words, you must code the parameters in the same order as they are \ncoded in the CREATE PROCEDURE statement. \nIn chapter 18, you will learn how to grant INSERT, UPDATE, and DELETE \nprivileges to specific users. However, if you want to have more fine-grained \ncontrol over the privileges that you grant to users, you can create stored proce-\n\nChapter 15 \nHow to create stored prvcedures and functions \n447 \nThe syntax of the CREATE PROCEDURE statement \nCREATE PROCEDURE procedure_ name \n( \n[parameter_name_ l data_type] \n[, parameter_name_ 2 data_type] ... \n) \nsql_block \nA script that creates a stored procedure that updates a table \nDELIMITER / / \nCREATE PROCEDURE update_ invoices_credit_total \n( \ninvoice_ id_param \ncredit_total_param \n) \nBEGIN \nINT, \nDECIMAL(9,2) \nDECLARE sql_ error TINYINT DEFAULT FALSE; \nDECLARE CONTINUE HANDLER FOR SQLEXCEPTION \nSET sql_error = TRUE; \nSTART TRANSACTION; \nUPDATE invoices \nSET credit_total = credit_total_param \nWHERE invoice id= invoice_ id_param; \nIF sql_error = FALSE THEN \nCOMMIT; \nELSE \nROLLBACK; \nEND IF; \nEND// \nA statement that calls the stored procedure \nCALL update_ invoic es_credit_total (56, 300 ) ; \nDescription \n• \nYou use the CREATE PROCEDURE statement to create a stored procedure. A \nstored procedure is an executable database object that contains procedural SQL \ncode. A stored procedure can also be called a sp,vc or a procedure. \n• \nYou can use parameters to pass one or more values from the calling program to the \nstored procedure or fron1 the procedure to the calling program. For more infor1na-\ntion on working with parameters, see figures 15-2 and 15-3. \n• \nTo declare a parameter within a stored procedure, you code the name of the param-\neter followed by its data type. If you declare two or more parameters, you separate \nthe parameters with commas. \n• \nYou can use the CALL statement to call a procedure. When a procedure accepts \nparameters, you pass them to the procedure by coding them within the parentheses \nthat follow the procedure name, and by separating the parameters with commas. \nFigure 15-1 \nHow to create and call a stored procedure\n\n448 \nSection 4 \nStored prvgram development \n<lures that perform all of the types of data manipulation that you want to allow \nwithin your database. Then, you can grant privileges to execute these stored \nprocedures. For systems where security is critical, this can be an excellent way \nto prevent both accidental errors and malicious damage to your data. \nHow to code input and output parameters \nFigure 15-2 shows how to code input and output parameters for a stored \nprocedure. An input parameter is passed to the stored procedure from the \ncalling program. You can explicitly identify an input parameter by coding the \nIN keyword before the name of the parameter. In this figure, for example, the \nfust two parameters are identified as input parameters. However, if you omit this \nkeyword, the parameter is assumed to be an input parameter. In figure 15-1, for \nexample, both parameters are input parameters. \nWithin a procedure, you can use input parameters like variables. However, \nyou can't change the value of the parameter. In this figure, for example, the \nprocedure uses the fust parameter within an UPDATE statement to specify the \ninvoice ID for the invoice row to be updated. \nAn output parameter is returned to the calling program from the stored \nprocedure. To code an output parameter, you must explicitly identify the param-\neter by coding the OUT keyword before the name of the parameter. In this \nfigure, for example, the third paran1eter is an output parameter. If the UPDATE \nstatement executes successfully, a SET statement stores a value of 1 in the \noutput parameter. Otherwise, a SET statement stores a value of O in the output \nparameter. Either way, the value of the output parameter is retw11ed to the calling \nprogram when the procedure finishes. \nTo show how a calling program works, this figure includes a script that calls \nthe procedure. Here, initial values are supplied for the two input parameters. \nThen, a variable named @row_count is supplied for the output parameter. This \nvariable is a special type of variable known as a user variable. A user va1iable \nis a global variable that's available to the user for the rest of the current session. \nYou'll learn more about t1ser variables later in this chapter. \nAfter the procedure executes, the value of the ot1tput parameter is stored in \nthe @row _count variable. Then, the calling program can access this variable. In \nthis figure, for example, the script uses a SELECT statement to display the value \nof the variable. However, it could also use an IF statement to check the value of \nthe variable and perform an appropriate action. \nIn addition to input and output parameters, MySQL provides for a parameter \nthat can be used for both input and output. An input/output parameter stores an \ninitial value that's passed in from the calling program like an input parameter. \nHowever, the procedure can change this value and retu111 it to a calling program \nlike an output parameter. To identify an input/output parameter, you must code \nthe INOUT .keyword before the name of the parameter. Although this can be \nuseft1l in some situations, it can also be confusing. As a result, it often makes \nsense to avoid the use of inpt1t/output parameters.\n\nChapter 15 \nHow to create stored prvcedures and functions \n449 \nThe syntax for declaring input and output parameters \n[INIOUTIINOUT] parameter_ name data_ type \nA stored procedure that uses input and output parameters \nDELIMITER// \nCREATE PROCEDURE update_ invoices_credit_ total \n( \nIN \ninvoice_ id_param \nIN \ncredit_ total_param \nOUT update_ count \n) \nBEGIN \nINT, \nDECIMAL(9,2}, \nINT \nDECLARE sql_ error TINYINT DEFAULT FALSE; \nDECLARE CONTINUE HANDLER FOR SQLEXCEPTION \nSET sql_ error = TRUE; \nSTART TRANSACTION; \nUPDATE invoices \nSET credit total= credit_ total_param \nWHERE invoice id= invoice_ id_param; \nIF sql_ error = FALSE THEN \nSET update_count = 1; \nCOMMIT; \nELSE \nSET update_ count = O; \nROLLBACK; \nEND IF; \nEND// \nA script that calls the stored procedure and uses the output parameter \nCALL update_ invoices_credit_ tota1(56, 200, @row_ count); \nSELECT CONCAT('row count: ', @row_ count} AS update_ count; \nDescription \n• \nInput parameters accept values that are passed from the calling program. These \nvalues cannot be changed by the body of the stored procedure. By default, param-\neters ai·e defined as input parameters. As a result, the IN keyword is optional for \nidentifying input parameters. \n• \nOutput para,neters store values that are passed back to the calling progra1n. These \nvalues must be set by the body of the stored procedure. To identify an output \nparameter, yot1 must code the OUT keyword. \n• \nInput/output parameters can store an initial value that's passed from the calling \nprogram. However, the body of the stored procedure can change this parameter. To \nidentify an input/output parameter, you must code the INOUT keyword. \n• \nWhen you work with output parameters or input/output parameters, the calling \nprogram typically passes a user variable to the parameter list. For more information \nabout t1ser variables, see figure 15-6. \nFigure 15-2 \nHow to code input and output parameters\n\n450 \nSection 4 \nStored prvgram development \nHow to set a default value for a parameter \nFigure 15-3 shows how to set a default value for a parameter. This is useful \nif a null value is passed for the parameter. Then, the default value can be used \ninstead of the null value. \nIn this figure, the stored procedure sets a default value for the second param-\neter, which contains the credit total to be assigned to the credit_total column for \nan invoice. To do that, it uses an IF statement to check if the parameter contains \na null value. If it does, the value of the parameter is set to 100. \nThe two CALL statements in this figure show two ways that you can provide \nvalues to the stored procedure. Here, the first CALL statement supplies a value \nfor each parameter. As a result, the credit total for the invoice is set to 200. In \ncontrast, the second CALL statement supplies a value of NULL for the second \nparameter. In that case, the credit total for the invoice is set to the default value \nof 100. \nWhen you set default values for one or more parameters, it usually makes \nsense to code these parameters at the end of the parameter list. That way, when \nyou call the stored procedure, you can code all the non-null values first.\n\nChapter 15 \nHow to create stored prvcedures and functions \n451 \nA CREATE PROCEDURE statement that provides a default value \nDELIMITER// \nCREATE PROCEDURE update_ invoices_credit_total \n( \ninvoice_ id_param \nINT, \ncredit_ total_param \nDECIMAL(9,2) \n) \nBEGIN \nDECLARE sql_error TINYINT DEFAULT FALSE; \nDECLARE CONTINUE HANDLER FOR SQLEXCEPTION \nSET sql_error = TRUE; \n-- Set default values for NULL values \nIF credit_ total_param IS NULL THEN \nSET credit_ total_param = 100; \nEND IF; \nSTART TRANSACTION; \nUPDATE invoices \nSET credit_total = credit_ total_param \nWHERE invoice id= invoice_ id_param; \nIF sql_ error = FALSE THEN \nCOMMIT; \nELSE \nROLLBACK; \nEND IF; \nEND// \nA statement that calls the stored procedure \nCALL update_ invoices_credit_total(56, 200); \nAnother statement that calls the stored procedure \nCALL update_ invoices_credit_total(56, NULL); \nDescription \n• \nYou can provide a default value for a parameter so that if the calling program \npasses a null value for the parameter, the default value is used instead. \n• \nTo set a default value for a parameter, you can use an IF statement to check if the \nparameter contains a null value. If it does, you can assign a default value to the \nparameter. \n• \nIt's a good programming practice to code your CREATE PROCEDURE statements \nso they list parameters that require values first, fallowed by parameters that allow \nnull values. \nFigure 15-3 \nHow to set a default value for a parameter\n\n452 \nSection 4 \nStored prvgram development \nHow to validate parameters and raise errors \nWithin a stored procedure, it's generally considered a good practice to \nprevent errors by checking the parameters before they 're used to make sure \nthey're valid. This is often refe1Ted to as data validation. Then, if the data isn't \nvalid, you can execute code that makes it valid, or you can raise an error, which \nreturns the error to the calling program. \nFigure 15-4 shows how to raise an error using one of the predefined en·ors \nthat are available from MySQL. To do that, you code the SIGNAL statement \nfollowed by the SQLSTATE keyword, followed by a SQLSTATE code. Then, \nyou can optionally include a SET statement that sets a message and MySQL \nerror code for the error. \nIn this figure, for example, the IF statement checks whether the value of the \nsecond parameter is less than zero. If it is, the SIGNAL statement raises an error \nwith a SQLSTATE code of 22003, a MySQL code of 1264, and a message that \nindicates that the credit total column must be greater than or equal to 0. These \nSQLSTATE and MySQL codes are commonly used to validate parameters since \nthey are used to indicate that the value is out of range for the column. \nIf the calling program doesn't catch this error, the system displays an error \nmessage. In this figure, for example, the CALL statement passes a negative \nvalue to the second parameter, which causes the error to be raised. As a result, \nthe system displays an error 1nessage that contains the MySQL error code and \nmessage specified by the SIGNAL statement. Since this error code and message \naccurately describe the error, the programmer or user of the calling program \nshould be able to identify and fix the problem. \nOn the other hand, if the calling program catches this error, it can include \ncode that handles the en·or. For example, the calling program can handle the \nerror by printing a user-friendly message and asking the user to input data again.\n\nChapter 15 \nHow to create stored prvcedures and functions \n453 \nThe syntax of the SIGNAL statement \nSIGNAL SQLSTATE [VALUE] sqlstate_value \n[SET MESSAGE_ TEXT = message [, MYSQL_ERRNO = mysql_ error_ number]] \nA stored procedure that raises a predefined exception \nDELIMITER// \nCREATE PROCEDURE update_ invoices_credit_total \n( \ninvoice_ id_param \nINT, \ncredit_ total_param \nDECIMAL(9,2) \n) \nBEGIN \n-- Validate paramater values \nIF credit_ total_param < 0 THEN \nSIGNAL SQLSTATE \n1 22003 1 \nSET MESSAGE_ TEXT = \n'The credit_total col11mn. must be greater than or equal to 0. ', \nMYSQL_ERRNO = 1146; \nELSEIF credit_ total_param >= 1000 THEN \nSIGNAL SQLSTATE \n1 22003 1 \nSET MESSAGE_ TEXT = \n'The credit total column must be less than 1000.', \nMYSQL_ERRNO = 1146; \nEND IF; \n-- Set default values for parameters \nIF credit_ total_param IS NULL THEN \nSET credit_ total_param = 100; \nEND IF; \nUPDATE invoices \nSET credit_total = credit_ total_param \nWHERE invoice_ id = invoice_ id__param; \nEND// \nA statement that calls the procedure \nCALL update_ invoices_credit_ total(S6, -100); \nThe response from the system \nError Code: 1146. \nThe credit_total column must be greater than or equal to 0. \nDescription \n• \nIt's generally considered a good practice to validate the data within a stored proce-\ndure before using the data. This is referred to as data validation. \n• \nThe SIGNAL statement raises an error. When you raise an error, you must specify \na SQLSTATE code as specified in chapter 13. In addition, you can optionally \nspecify an error message or MySQL error number. \n• \nWhen you raise an error, MySQL returns the error to the caller in the same way that \nit returns errors that are raised by the database engine. Then, the calling program \ncan handle the error. \nFigure 15-4 \nHow to validate parameters and raise errors\n\n454 \nSection 4 \nStored prvgram development \nA stored procedure that inserts a row \nFigure 15-5 presents a stored procedure that inserts new rows into the \ninvoices table. This should give you a better idea of how you can use stored \nprocedures. \nThis procedU1·e uses six parameters that correspond to six of the colunms in \nthe Invoices table. All of these parameters are input parameters, and each param-\neter is assigned the same data type as the matching column in the Invoices table. \nAs a result, if the calling program passes a value that can't be converted to the \nproper data type, an error will be raised when the procedure is called. \nNone of these parameters corresponds with the invoice_id column since \nthat column is an auto increment column. Similarly, the stored procedure sets \na default value for the last two parameters. As a result, if the calling program \nprovides a null value for these parameters, the procedure automatically sets a \ndefault value for them. \nThe body of the procedure begins by declaring three variables. Of these \nvariables, the first two have data types that correspond to coltunns in the invoices \ntable. However, the third one uses the INT data type to store the number of days \nbefore the invoice is due. \nAll three of these variables have a suffix of''_ var'' while all of the param-\neters defined earlier have a suffix of ''_paran1''. This 1nakes it easy to tell the \ndifference between the pru:ameters that are passed to the procedure from the \ncalling program and the variables that are used within the procedure. \nAfter the variables are declared, the procedure begins by using an IF state-\n1nent to check the value of the parameter for the invoice_total column to see if \nit is less than zero. If so, the procedure uses the SIGNAL statement to raise an \nerror with an appropriate error code and message. This statement exits the stored \nprocedure and returns the error to the calling program. Similarly, the ELSEIF \nclause checks whether this parameter is greater than one million. If so, it raises \nan appropriate error. Although this figure only uses this IF statement to check \nfor two conditions, it's common to code a series of IF statements like this one to \nprovide more extensive data validation. \nNext, another IF statement is used to check the terms_id parameter for a \nnull value. If the parameter is null, a SELECT statement gets the value of the \ndefault terms id column for the vendor and stores it in the terms id variable. If \n-\n-\n-\nthis parameter isn't null, the value of the terrr1s_id parameter is assigned to the \nterms id variable. \nThe next IF statement is similar. It checks the value of the parameter for the \ninvoice_due_date column for a null value. If the parameter is nt1ll, a SELECT \nstatement uses the value of the terms_id variable to get the number of days \nuntil the invoice is due from the terms table, and it stores this value in the \nterms_due_days variable. Then, it calculates a due date for the invoice by using \nthe DATE_ADD function to add the number of days to the invoice date. If the \ninvoice_due_date parameter isn't null, though, this code sets the \ninvoice_due_date variable to the value that's stored in the parameter.\n\nChapter 15 \nHow to create stored prvcedures and functions \nA stored procedure that validates the data in a new invoice \nDELIMITER// \nCREATE PROCEDURE insert_ invoice \n( \nvendor_id_param \ninvoice_ number_param \ninvoice_date_param \ninvoice_ total_param \nterms_id_param \ninvoice_due_date_param \nINT, \nVARCHAR(SO), \nDATE, \nDECIMAL(9,2), \nINT, \n) \nBEGIN \nDECLARE terms id var \nDATE \nDECLARE invoice_due_date_var \nDECLARE terms_due_days_var \n-- Validate paramater values \nINT; \nDATE; \nINT; \nIF invoice_total_param < 0 THEN \nSIGNAL SQLSTATE '22003' \nSET MESSAGE_TEXT = \n'The invoice total column must be a positive number.', \nMYSQL_ERRNO = 1264; \nELSEIF invoice_total_param >= 1000000 THEN \nSIGNAL SQLSTATE \n1 22003 1 \nSET MESSAGE_ TEXT = \n'The invoice_total column must be less than 1,000,000. 1 , \nMYSQL_ ERRNO = 1264; \nEND IF; \n-- Set default values for param~ters \nIF terms_ id_param IS NULL THEN \nSELECT default_ terms_ id INTO terms id var \nFROM vendors WHERE vendor_ id = vendor_ id_param; \nELSE \nSET terms_ id_var = terms_ id_param; \nEND IF; \nIF invoice_due_date_param IS NULL THEN \nSELECT terms_due_days INTO terms_due_days_var \nFROM terms WHERE terms_ id = terms_ id_var; \nSELECT DATE_ADD(invoice_ date_param, INTERVAL terms_due_days_var DAY) \nINTO invoice_due_date_var; \nELSE \nSET invoice_due_date_var = invoice_due_date_param; \nEND IF; \nINSERT INTO invoices \n(vendor_ id, invoice_nwnber, invoice_date, \ninvoice_ total, terms_id, invoice_due_date) \nVALUES (vendor_ id_param, invoice_number_param, invoice_date_param, \ninvoice_total_param, terms_ id_var, invoice_due_date_var); \nEND// \nFigure 15-5 \nA stored procedure that inserts a row (part 1 of 2) \n455\n\n456 \nSection 4 \nStored prvgram development \nAfter the values have been set for the variables for the terms id and \n-\ninvoice_due_date columns, this procedure executes an INSERT statement. If this \nstatement executes successfully, the row is inserted into the database. \nIn most cases, a stored procedure like this is called from an application \nprogram. However, to test a procedure before it's used by an application \nprogram, you can use CALL statements like the ones in part 2 of figure 15-5. \nThe first two CALL statements provide valid values that successfully insert \na new row. Of these statements, the frrst supplies non-null values for all of the \nparameters for the procedure. The second supplies non-null values for the first \nfour parameters, but not for the last two. This shows that the frrst four parameters \nare the only parameters that require non-null values. \nThe third CALL state1nent provides a negative nwnber for the invoice total \nparameter. As a result, this CALL statement causes the stored procedure to raise \nan error. Since the CALL statement doesn't handle this error, an error message \nlike the one shown in this figW\"e is displayed. However, if you call the stored \nprocedure from another stored procedure or from an application, you can include \ncode that handles the error.\n\nChapter 15 \nHow to create stored prvcedures and functions \n457 \nTwo statements that call the stored procedure \nCALL insert_ invoice ( 34, 'ZXA-080', '2018-01-18', 14092. 59, \n3, '2018-03-18'); \nCALL insert_ invoice ( 34, 'ZXA-082', '2018-01-18', 14092. 59, \nNULL, NULL); \nThe message from the system for a successful insert \n1 row(s) affected \nA statement that raises an error \nCALL insert_ invoice(34, 'ZXA-080', '2018-01-18', -14092.59, \nNULL, NULL) ; \nThe message from the system when a validation error occurs \nError Code: 1264. The invoice_ total col11mn must be a positive number. \nDescription \n• If the data for each of the columns of the row is valid, the procedru·e executes an \nINSERT statement to insert the row. Otherwise, the procedure or database engine \nraises an error and exits the procedure. \n• If an application program calls this procedure, it can handle any errors that are \nraised by the procedure or by the database engine. \nFigure 15-5 \nA stored procedure that inserts a row (part 2 of 2)\n\n458 \nSection 4 \nStored prvgram development \nHow to work with user variables \nIn figure 15-2, you learned how to store the value of an output parameter in a \nuser variable. Now, you'll learn more about working with user variables. \nA user variable is a special type of MySQL variable that's globally available \nto the current user. However, a user variable is only available as long as the user \nremains connected to the server and is released when the user disconnects. In \naddition, a user variable is only available to the current user and cannot be seen \nor accessed by other users. \nSince a user variable is globally available to the current user, multiple stored \nprograms can share the variable. In figure 15-6, for instance, the stored program \nnamed set_global_count sets the user variable named @count to a specified INT \nvalue. Then, the stored procedure named incrernent_global_count increments the \n@count variable by a value of 1. To set the value of this user variable, both of \nthese stored procedures use the SET statement. \nNote that these procedures don't need to include a DECLARE statement for \nthe user variable to declare its data type. That's because a user variable can store \nvarious data types including string, numeric, and date/time types. As a result, \nyou can declare or access a user variable anywhere just by coding an at sign(@) \nfollowed by the name of the variable. \nAlthough user variables are often used within stored programs, you can also \naccess user variables outside of stored programs. Then, you can use standard \nSQL statements such as the SELECT statement to work with them. In this \nfigure, for instance, the SELECT statement displays the value of the @count \nvariable a.fter it has been set and incremented by the two CALL statements. You \ncan also use the SET statement outside of a stored program to set the value of a \nuser variable.\n\nChapter 15 \nHow to create stored prvcedures and functions \n459 \nThe syntax for setting a user variable \nSET @variable_name = expression \nTwo stored procedures that work with the same user variable \nDELIMITER // \nCREATE PROCEDURE set_global_ count \n( \ncount var :INT \n) \nBEGIN \nSET @count= count_var; \nEND/ / \nCREATE PROCEDURE increment_ global_ count( ) \nBEGIN \nSET @count= @count+ 1; \nEND// \nTwo statements that call these stored procedures \nCALL set_ global_ count(lOO); \nCALL increment_global_ count(); \nA SELECT statement that directly accesses the user variable \nSELECT @count AS count_var \ncount_var \n► \n10 1 \nDescription \n• \nA user variable is a special type of MySQL variable that's globally available to the \ncurrent user. \n• \nA user variable is only available to the cun·ent user ai1d cannot be seen or accessed \nby other users. \n• \nA user variable is available as long as the user remains connected to the server, but \nit is released when the user disconnects. \n• \nA user variable can store various data types including string, numeric, and \ndate/time types. However, you don' t have to declare a data type for a user vaiiable. \nI \nI \n• \nA user variable is available from statements coded both inside and outside of stored \nprograms. \nFigure 15-6 \nHow to work with user variables\n\n460 \nSection 4 \nStored prvgram development \nHow to work with dynamic SQL \nFigure 15-7 shows how to work with dyna,nic SQL. Dynamic SQL allows \nyou to use procedu1·al code to build and execute a SQL statement that depends \non parameters that aren't known until runtime. To do that, you can build a string \nthat contains the SQL statement. Then, you can use the PREPARE, EXECUTE, \nand DEALLOCATE PREPARE statements to execute the statement contained in \nthe string. \nDynamic SQL is often used to build co1nplex WHERE clauses that depend \non multiple search conditions that may or may not be specified by the user. In \nthis figure, for instance, the code creates a stored procedure named \nselect_invoices that allows the user to specify two parameters: (1) the minimum \ninvoice date and (2) the minimum invoice total. However, if tl1e user specifies a \nnull value for a parameter, the stored procedure doesn't include that parameter in \nthe search condition. \nTo start, the stored procedure declares two string variables that can hold up \nto 200 characters. Then, it sets the variable named select_clause to a SELECT \nclause that selects four columns from the Invoices table, and it sets the variable \nnamed where_clause to a WHERE clause that doesn't include any search \nconditions. \nAfter setting the variables, a series of IF statements creates the WHERE \nclause depending on the values of the pru.·ameters. The first IF statement checks \nwhether the first parameter contains a non-null value. If it does, the IF statement \nadds a search condition to the WHERE clause like this: \nWHERE invoice_date > \n1min_ invoice_date_param 1 \nNote that the parameter is enclosed in single quotes since it contains a date \nvalue. \nThe second IF statement checks whether the second parameter contains a \nnon-null value. If it does, a nested IF statement checks whether the string for \nthe WHERE clause has already had a search condition appended to it. In that \ncase, it appends the AND keyword to the WHERE clause to create a compound \ncondition. Then, a SET statement adds a search condition to the WHERE clause. \nAt this point, the WHERE clause may contain a compound search condition, a \nsingle search condition, or no search condition at all. \nThe third IF statement checks if a search condition has been added to the \nWHERE clause. If it hasn't, the user variable named @dynamic_sql is assigned \nthe value of the SELECT clause. Otherwise, it is assigned a concatenation of \nthe SELECT clause and the WHERE clause. At this point, the @dynamic_sql \nvariable contains the dynamically generated SELECT statement. \nThe PREPARE statement prepares a statement from the string that's stored \nin the @dynamic_sql variable. For this to work, the string that contains the state-\nment must be stored in a user variable. That way, MySQL can access it outside \nof the stored program and prepare it to be executed. \nAfter MySQL prepares the statement, the EXECUTE statement executes \nthe prepared statement. This returns a rest1lt set for the dynamically generated \nSELECT statement to the user. Finally, the DEALLOCATE PREPARE state-\nment releases the prepared statement. Once a prepared statement is released, it \ncan no longer be executed.\n\nChapter 15 \nHow to create stored prvcedures and functions \n461 \nA stored procedure that uses dynamic SQL \nDELIMITER// \nCREATE PROCEDURE select_ invoices \n( \nmin_ invoice_date_param \nmin_ invoice_total_param \n) \nBEGIN \nDATE, \nDECIMAL(9,2) \nDECLARE select clause VARCHAR(200); \nDECLARE where_clause \nVARCHAR(200); \nSET select_clause = \"SELECT invoice_ id, invoice_ nwnber, \ninvoice_date, invoice total \nFROM invoices \n11 ; \nSET where clause= \n\"WHERE\"; \nIF min_invoice_date_param IS NOT NULL THEN \nSET where_clause = CONCAT(where_clause, \n\"invoice date> '\", min_invoice_date_param, \"'\"); \nEND IF; \nIF min_ invoice_ total_param IS NOT NULL THEN \nIF where clause!= \"WHERE \nIt THEN \nSET where_clause = CONCAT(where_clause, \"AND\"); \nEND IF; \nSET where_clause = CONCAT(where_clause, \n\"invoice_total > \", min_ invoice_total_param}; \nEND IF; \nIF where_clause =\"WHERE\" THEN \nSET @dynamic_ sql = select_clause; \nELSE \nSET @dynamic_ sql = CONCAT(select_ clause, where_clause); \nEND IF; \nPREPARE select invoices statement \nFROM @dynamic_ sql; \nEXECUTE select_ invoices_ statement; \nDEALLOCATE PREPARE select_ invoices_statement; \nEND// \nA @dynamic_sql variable at runtime with parameters inserted \nSELECT invoice_ id, invoice_ nwnber, invoice_date, invoice_total \nFROM invoices \nWHERE invoice date> '2018-07-25' AND invoice_total > 100 \nDescription \n• \nYou can use a stored routine to build a string variable that contains a SQL \nstatement. Then, you can use the PREPARE, EXECUTE, and DEALLOCATE \nPREPARE statements to execute the statement contained in the string. This is \nknown as dynamic SQL. \nFigure 15-7 \nHow to work with dynamic SOL\n\n462 \nSection 4 \nStored prvgram development \nHow to drop a stored procedure \nFigure 15-8 shows how to drop a stored procedure. To do that, you can code \nthe DROP PROCEDURE keywords followed by the name of the procedure. \nIn this figure, the first example uses the CREATE PROCEDURE statement to \ncreate a procedure named clear_invoices_credit_total. Then, the second example \nuses the DROP PROCEDURE statement to drop that procedure. \nIf you attempt to drop a stored procedure that doesn't exist, MySQL returns \nan error. To prevent this error, you can add the optional IF EXISTS keywords \nto the DROP PROCEDURE statement as shown by the third example. Then, \nMySQL only attempts to drop the stored procedure if it exists. \nIf you drop a table or view used by a procedure, you should be sure to drop \nthe procedure as well. If you don't, the procedure can still be called by any user \nor program that has been granted the appropriate privileges. Then, an error will \noccur because the table or view that the procedure depends on no longer exists.\n\nChapter 15 \nHow to create stored prvcedures and functions \n463 \nThe syntax of the DROP PROCEDURE statement \nDROP PROCEDURE [IF EXI STS] procedure_name \nA statement that creates a stored procedure \nDELIMITER // \nCREATE PROCEDURE clear_ invoices_credit_ total \n( \ninvoice_ id_pararn \nINT \n) \nBEGIN \n• \n• \nUPDATE invoices \nSET credit_total = O \nWHERE invoice_id = invoice_ id_param; \nEND// \nA statement that drops the stored procedure \nDROP PROCEDURE clear_invoices_credit_total \nA statement that drops the stored procedure only if it exists \nDROP PROCEDURE IF EXISTS clear_ invoices_credit_total \nDescription \n• \nTo drop a stored procedure from the database, t1se the DROP PROCEDURE \nstatement. \nFigure 15-8 \nHow to drop a stored procedure\n\n464 \nSection 4 \nStored prvgram development \nHow to code stored functions \nIn chapter 9, you learned about some of MySQL's built-in functions. Now, \nyou'll learn how to create your own functions. These functions are refe1red to as \nstored functions, or just functions. \nIf you've wo1·ked with databases other than MySQL, you may be familiar \nwith functions that return a result set. With MySQL, though, a function can only \nreturn a single value. This type of function is called a scalar function. \nIn m.any ways, the code for creating a function works similarly to the code \nfor creating a stored procedure. The primary difference between stored proce-\ndures and functions is that a MySQL function always returns a single value. \nHow to create and call a function \nTo create a function, you use the CREATE FUNCTION statement shown in \nfigure 15-9. To start, you code the CREATE FUNCTION keywords, followed by \nthe name of the function. In this figure, the frrst example shows how to create a \nfunction named get_ vendor_id. \nAfter the name of the function, you code a set of parentheses. Within \nthe parentheses, you code the parameters for the function. In this figure, for \nexample, the function contains a single parameter of the VARCHAR type that's \nnamed vendor_name_param. Since this is similar to the way you declare param-\neters for a stored procedure, you shouldn't have much trouble understanding how \nthis works. The main difference is that it rarely makes sense to use output param-\neters for a function. As a result, functions almost always use input parameters as \nshown by the examples in this chapter. \nAfter the parentheses, you code the RETURNS keyword, followed by the \ndata type that's returned by the function. In this figure, the example returns a \nvalue of the INT type. \nAfter the declaration of the return type, you can code one or more charac-\nteristics that describe the function. In this example, the function includes the \nDETERMINISTIC and READS SQL DATA characteristics. You'll learn more \nabout these and other characteristics in the next figure. \nAfte1· any characteristics, you code the BEGIN keyword to signal that you \nare about to begin the code for the function. In this figure, the code begins \nby declaring a variable of the INT type named vendor_id_ var. Then, it uses a \nSELECT statement to get the vendor ID value that corresponds to the vendor \nname parameter and to store this value in the variable. Finally, it uses the \nRETURN statement to return this value to the calling program. \nTo call a function, you can use it in an expression as if it's one of MySQL's \nbuilt-in functions. Then, the value that's returned by the function is substi-\ntuted for the function. In this figure, the last example shows how to use the \nget_ vendor_id function within a SELECT statement to retu111 the vendor ID \nvalue for the vendor with the name of ''IBM''. \nIf you find yourself repeatedly coding the same expression within a SQL \nstatement, you may want to create a scalar function for the expression. Then, you \ncan use that function in place of the expression, which can save you coding time \nand make your code easier to maintain. As a result, yot1 may want to create a set \nof useful stored functions for your database.\n\nChapter 15 \nHow to create stored prvcedures and functions \n465 \nThe syntax of the CREATE FUNCTION statement \nCREATE FUNCTION function_name \n( \n[parameter_name_ l data_type] \n[, parameter_name_ 2 data_type] ... \n) \nRETURNS data_type \n[NOT] DETERMINISTIC \n{CONTAINS SOL INO SQL IREADS SQL DATAIMODIFIES SQL DATA} \nsql_block \nA function that returns the vendor ID that matches a vendor's name \nDELIMITER // \nCREATE FUNCTION get_vendor_id \n( \nvendor_ name_param VARCHAR (SO ) \n) \nRETURNS INT \nDETERMINISTIC READS SQL DATA \nBEGIN \nDECLARE vendor_ id_var INT; \nSELECT vendor_ id \nINTO vendor id var \nFROM vendors \nWHERE vendor name= vendor_name_param; \nRETURN(vendor_ id_var ) ; \nEND// \nA SELECT statement that uses the function \nSELECT invoice_ number, invoice_ total \nFROM invoices \nWHERE vendor_ id = get_vendor_ id('IBM'); \nThe response from the system \ninvoice _number \nlnvoice_total \n► \nQP58872 \n116.54 \nQ545443 \n1083.58 \nDescription \n• \nA stored function, or justfunction, is an executable database object tl1at contains \nprocedural SQL code. \n• \nWith MySQL, you can only create scalar functions, which return a single value. \n• \nTo identify the data type that's returned by a function, you use the RETURNS \nkeyword in the declaration for the function. Then, in the body of the function, you \nuse the RETURN keyword to specify the value that's returned. \n• \nA function can accept input parameters that work like the input parameters for a \nstored procedure. \n• \nWhen you create a function, you can include one or more characteristics that \ndescribe the function. See figure 15-10 for more information on these characteristics. \n• \nTo call a stored function, you can use it in any expression just like a built-in function. \nFigure 15-9 \nHow to create and call a function\n\n466 \nSection 4 \nStored prvgram development \nHow to use function characteristics \nFigure 15-10 describes some of the characteristics you can code on the \nCREATE FUNCTION statement. If binary logging is enabled, you must code \nthe DETERMINISTIC, NO SQL, or READS SQL DATA characteristic on a \nfunction. If you don't code at least one of these characteristics, MySQL displays \nan error and doesn't create the function. That's because these characteristics \naffect how statements that change the contents of a database are recorded in the \nbinary log, which is a log that's used to record all changes that have been made \nto the contents of a database. This log is enabled by default with MySQL 8.0 but \nnot with earlier releases of MySQL. \nThe DETERMINISTIC characteristic indicates that a function produces the \nsame results given the same input values and the same data. In figure 15-9, for \nexample, the get_ vendor_id function is deterministic because it always returns \nthe same vendor ID value from the Vendors table for a given vendor name. \nThe get_ vendor_id function also includes the READS SQL DATA charac-\nteristic. This indicates that it reads data from a database but doesn't write data to \nthe database. This characteristic is optional, but it can improve the performance \nof the function. \nIn general, it's more common to 11se a stored proced·ure to modify the data in \na database than it is to use a function. That's why none of the functions presented \nin this book modify data in a database. However, if a function modifies the data \nin a database, it should be marked as deterministic if two identical databases \nwill remain identical after the function is executed with the same input values. \nIn addition, you can n1ark the function with the optional MODIFIES SQL DATA \ncharacteristic to indicate that the function modifies data. \nIf you compare the get_ vendor_id function in figure 15-9 to the \nrand_int function in this figure, you should get a better idea of how the \nDETERMINISTIC characteristic works. The rand int function uses the built-in \n-\nRAND function to get a random number between O and 1. Then, it multiplies \nthat number by 1000, rounds it to a whole number, and returns the result. \nBecause the RAND function can return a different number each time it's \nexecuted, the rand_int function can return any integer between O and 1000. That \nmeans it's non-determinis·tic. Because the NOT DETERMINISTIC characteristic \nis the default characte1istic, you don't need to code it. However, it's included \nin this example to make it clear to other programmers that this function is \nnon-deterministic. \nThe rand_int function also includes the NO SQL characteristic. This \ncharacteristic indicates that the function doesn't include any SQL statements. \nIn addition, it's one of the three characteristics that are required for a function if \nbinary logging is enabled. \nIf you don't code the NO SQL, READS SQL DATA, or MODIFIES SQL \nDATA characteristic on a function, it will default to CONTAINS SQL. This \ncharacteristic indicates that the function doesn't use SQL statements to read \nfrom or write to a database. However, it may contain other statements such as a \nSET statement that sets global variables. In most cases, that's not what you want. \nAs a result, it's a good practice to include one of the other characteristics. In \nmost cases, that means including the READS SQL DATA characteristic.\n\nChapter 15 \nHow to create stored prvcedures and functions \n467 \nSome of the characteristics for a MySQL function \nCharacteristic \nDescription \nDETERMINISTIC \nNOT DETERMI NISTIC \nREADS SQL DATA \nMODIFIES SQL DATA \nCONTAINS SQL \nNO SQL \nIndicates that the function produces the same results given the same \ninput values. \nIndicates that the function does not produce the same results given \nthe same inpt1t values. This is the default. \nIndicates that the function contains one or more SQL statem.ents \nst1ch as SELECT statements that read data from a database but no \nstatements that write data. \nIndicates that the function contains SQL statements such as INSERT, \nUPDATE, and DELETE statements tl1at write data to a database. \nIndicates that the function contains one or more SQL statements \nsuch as SET statements that don't read from or write to a database. \nThis is the default. \nIndicates that the function doesn't contain SQL statements. \nA function that gets a random number \nDELIMITER // \nCREATE FUNCTION rand_ i nt () \nRETURNS INT \nNOT DETERMINISTIC \nNO SQL \nBEGIN \nRETURN ROUND (RAND () * 1000); \nEND// \nA SELECT statement that uses the function \nSELECT rand_ int () AS random_number; \nI random_number \n► l3LS \nDescription \n• \nIf binary logging is enabled, which it is by default with MySQL 8.0, each function \nmust include the DETERMINISTIC, NO SQL, or READS SQL DATA characteristic. \nTo override this requirement, you can set the log_bin_trust_function_creators system \nvariable to 1 (ON). For more information on working with system variables, see \nchapter 17. \n• \nThe binary log contains a record of all the changes that have been made to the \ncontents of a database. It can be used for replication between two servers. \n• \nUnless you code the DETERMINISTIC keyword, a function is considered to be \nnon-dete1·ministic. This affects the type of information that's stored in the binary log. \n• \nIt's more common to use a stored procedure rather than a function to modify a database. \nFigure 15-1 O \nHow to use function characteristics\n\n468 \nSection 4 \nStored prvgram development \nA function that calculates balance due \nFigure 15-11 shows a function that calculates the balance due for an invoice. \nTo do that, this function accepts a parameter that contains an invoice ID value. \nThen, the body of the function calculates the balance due, stores the result of the \ncalculation in a variable named balance_due_ var, and uses the RETURN state-\nment to return that value. \nThe SELECT statement in this figure uses this function to return the balance \ndue for the specified invoice ID value. Note that calling the function like this: \nget_balance_ due(invoice_ id) AS balance_ due \nhas the same effect as performing a calculation like this: \ninvoice_total -\npayment_total - credit_total AS balance_ due \nHowever, using a function has two advantages. First, the code is shorter, which \nmakes it easier to type. Second, the code for calculating the balance due is stored \nin a single location. As a result, if the formula for calculating the balance due \nchanges, you only need to change it in one location.\n\nChapter 15 \nHow to create stored prvcedures and functions \n469 \nA function that calculates balance due \nDELIMITER // \nCREATE FUNCTION get_balance_ due \n( \ninvoice_id_pararn INT \n) \nRETURNS DECIMAL(9,2 ) \nDETERMINISTIC READS SQL DATA \nBEGIN \nDECLARE balance_ due_var DECIMAL(9,2); \nSELECT invoice_total - payment_total - credit_total \nINTO balance_ due_var \nFROM invoices \nWHERE invoice_ id = invoice_ id_param; \nRETURN balance_ due_var; \nEND// \nA statement that calls the function \nSELECT vendor_ id, invoice_ n11mbAr, \nget_balance_due (invoice_ id) AS balance_ due \nFROM invoices \nWHERE vendor_ id = 37 \nThe response from the system \nvendor id \ninvoice _number \nbalance due \n-\n-\n► \n37 \n547481328 \n0.00 \n37 \n547479217 \n0.00 \n37 \n547480102 \n224.00 \nDescription \n• \nThis function accepts a single parameter that specifies the ID for an invoice, and it \nreturns the balance due for that invoice. \nFigure 15-11 \nA function that calculates balance due\n\n470 \nSection 4 \nStored prvgram development \nHow to drop a function \nFigure 15-12 shows how to drop a function. To do that, you code the DROP \nFUNCTION keywords followed by the name of the function. This is illustrated \nby the third example in this figure. In addition, the fourth example illustrates \nhow you can add the IF EXISTS keywords to check if a function exists before \ndropping it. \nTo start, though, the first example presents another function named \nget_sum_balance_due. This function uses the aggregate SUM function described \nin chapter 5 to return the sum of the total balance due for the specified vendor. \nWhat's interesting here is that this function calls the get_balance_due function \npresented in the previous figure. In other words, this function ''depends'' on the \nget_balance_due function. \nThen, the second example shows a SELECT statement that uses the \nget_sum_balance_due function. This statement gets the invoice number and \nbalance due for each invoice for the vendor with an ID of 37. In addition, it gets \nthe total balance due for that vendor. \nLike stored procedures, functions depend on underlying database objects \nsuch as tables and views as well as other procedures and functions. Because \nof that, if you drop a database object that a function depends on, the function \nwon't work properly. For example, if you drop the get_balance_due function, \nthe get_sum_balance_due function won't work. As a result, yo11 should avoid \ndropping any database objects that other database objects depend on.\n\nChapter 15 \nHow to create stored prvcedures and functions \n471 \nThe syntax of the DROP FUNCTION statement \nDROP FUNCTION [IF EXISTS] function_name \nA statement that creates a function \nDELIMITER // \nCREATE FUNCTION get_ swn_balance_due \n( \nvendor_ id_pararn INT \n) \nRETURNS DECIMAL(9,2) \nDETERMINISTIC READS SQL DATA \nBEGIN \nDECLARE swn_ balance_ due_var DECIMAL(9,2); \nSELECT SUM(get_balance_due(invoice_ id}) \nINTO swn_balance_due_var \nFROM invoices \nWHERE vendor_ id = vendor_ id_param; \nRETURN swn_balance_ due_var; \nEND// \nA statement that calls the function \nSELECT vendor_ id, invoice_ nwnber, \nget_balance_due (invoice_ id) AS balance_ due, \nget_ swn_balance_ due (vendor_ id) AS swn_bala.nce_due \nFROM invoices \nWHERE vendor_ id = 37; \nThe response from the system \nvendor_ld \ninvoice number \n-\nbalance_due \nsum_balance_due \n-\n► \n37 \n547.q81328 \n0.00 \n224.00 \n37 \n547479217 \n0.00 \n224.00 \n37 \n547480102 \n224.00 \n224.00 \n-\nA statement that drops the function \nDROP FUNCTION get_ swn_ balance_ due; \nA statement that drops the function only if it exists \nDROP FUNCTION IF EXISTS get_ swn_balance_ due; \nDescription \n• \nTo delete a function from the database, use the DROP FUNCTION statement. If \nyou want to check whether the function exists before you drop it, add the optional \nIF EXISTS keywords. \n• \nThe function in this figure uses the get_balance_due function that's presented in the \nprevious figure. As a result, if you drop the get_balance_due function, the function \nin this figure won't work. \nFigure 15-12 \nHow to drop a function\n\n472 \nSection 4 \nStored prvgram development \nHow to use Workbench \nwith procedures and functions \nMySQL Workbench provides some basic features for worlang with stored \nprocedures and functions. Figure 15-13 describes these features. Collectively, \nstored procedures and functions are sometimes referred to as stored routines. \nHow to view and edit stored routines \nTo start, this figure shows how to use MySQL Workbench to view stored \nprocedures and functions. To do that, you can connect to the server and then \nexpand the Stored Procedures or Functions node for the appropriate database. In \nthis figure, for example, I have expanded the Stored ProcedUI·es and Functions \nnodes for the AP database so you can see all of the procedures and functions that \nwere presented in this chapter. \nAfter you display the stored procedures or functions for a database, you \ncan view the code for a procedure or function by right-clicking on its name and \nselecting the appropriate Alter item. Then, MySQL Workbench displays the \nprocedure or function in a tab as shown in this figure. This may come in handy if \nyou need to work with stored procedures or functions that were created by other \nprogrammers and you don't l1nderstand what they do. It may also come in handy \nif you need to modify one of these stored procedures or functions. \nHow to create stored routines \nYou can use MySQL Workbench to help you get started writing scripts that \ncreate stored procedures and functions. To do that, you can right-click on the \nStored Procedures or Functions node and then select the appropriate Create \nitem. When you do, Workbench generates some basic code for the procedure or \nfunction that includes a DELIMITER statement, a CREATE PROCEDURE or \nCREATE FUNCTION statement, and BEGIN and END keywords. Then, you \ncan modify this code as necessary and add the code that's specific to the stored \nprocedure or function. \nAfter yot1 create a stored procedure or function, it won't appear in the \nNavigator window right away. To display it, you can refresh the Navigator \nwil1dow. The easiest way to do that is to click the Refresh button near the upper \nright corner of the Navigator window. \nHow to drop stored routines \nOnce a stored procedure or ft1nction is displayed in the Navigator window, \nyou can drop it by 1ight-clicking on it and selecting the appropriate Drop item. \nThen, you can use the resulting dialog box to confirm the drop.\n\nChapter 15 \nHow to create stored prvcedures and functions \nA stored procedure displayed in MySQL Workbench \n■ \nMySQL Workbench \n6 \nLocal mstance MySQLBO \nFile \nEdit \nV.= \n01Je1'{ \nDatabase \nServl!f \nTools \nScnpling \nHelp \n03 \nNav19at0f \nSCl1£MAS \na. 1 Ftier ob)eCs \n., J ap \nName: \nDOI.: \n,. \nQ l ~ O.lj[l~ \n□ \n► \nTables \n1 • - CREATE DEFINER=·root·@·localhost· PROCEDURE ·insert_invoice' ( \n[ \n► \nViews \n., \nStored Procedures \n0 set_global_coirt \nD selec:t_lnvolcz:s \nCJ lnsert_invoice \n~ increment_global_count \nD test \nupdate_ln \n., \nFunctions \nfO get_balan \nf() get_sum_ \nf() get_ vend, \n► \nar \nAdm,nistrllbon \nSchem \nCopy to aipboard \n► \n► \n2 \nvendor_id_param \nINT, \n3 \ninvoice_number_param \nVARCHAR( \n), \n4 \ninvoice_date_parani \nDATE, \n5 \ninvoice_tot al_parani \nOEOMAL( , ), \n6 \nterms_id_paran, \nINT, \n7 \ninvoice_due_date_param DATE \n8 \n9 \n10 \n11 \n12 \n13 \n14 \n15 \n16 \n) \n- BEGIN \nDECLARE t enas id var \nDECLARE invoi ce_due_date_var \nDECLARE tenas_due_days_var \nINTJ \nDATE; \nINT; \nIF invoice_total_param < \nTHEN \nSIGNAL SQLSTATE '22083 \nSend to SQL EditOf \nCrea!e Stored Procedure \nAlter S!ored Procedure. \n[)fop Stored Procedure. \nRefresh All \n17 \nSET MESSAGE_TEXT = The invoice_total col~ 111Jst ~ a posi1 \nWormatton \nProcedure: test \n18 \n19 \n20 \nMYSQL_ERRNO = \n; \nELSEIF invoice_total_par11.111 >~ \n~iOO THEN \nSIGNAL SQLSTATE \n22003' \n21 \nSET MESSAGE TEXT = • The invoice total colu,nn eust be less ti \n-\n-\n22 \nMYSQL_ERRNO = \n, \n23 \nEND IF; \n,,. \n< \nRoutine \nObject Info \nSession \nApply \nDescription \n• \nTo view the stored procedures and functions for a database, you can expand the \nnode for the database. Then, you can expand the Stored Procedures 01· Functions \nnode. \n• \nTo view the code for an existing procedure or function, right-click on its name and \nselect the appropriate Alter item. \n• \nTo create a new stored procedure, right-click on the Stored Procedures node and \nselect the Create Stored Procedure item. \n• \nTo create a new function, right-click on the Functions node and select the Create \nFunction item. \n• \nAfter you create a new procedure or function, you can refresh the Navigator \nwindow to include it in the list of stored procedures or functions. To do that, click \nthe Refresh button near the upper right corner of the Navigator window. \n• \nTo drop a procedure or function, right-click on its name and select the Drop item. \nThen, use the resulting dialog box to confir1r1 the drop. \n• \nYou can use the SHOW PROCEDURE STATUS and SHOW FUNCTION STATUS \nstatements to display information about the stored procedures and functions on a \nserver. For more information, see the MySQL Reference Manual. \nFigure 15-1 3 \nHow to create, view, and drop stored procedures and functions \n> \nRevet \nX \nV \n473\n\n474 \nSection 4 \nStored prvgram development \nPerspective \nIn this chapter, you learned how to create two types of stored programs: \nprocedures and functions. The focus of this chapter has been on the skills that \nSQL developers typically need for working with procedures and functions. \nHowever, you should know that there's a lot more to coding procedures and \nfunctions than what this chapter has shown. With this chapter as background, \nthough, you should be able to learn whatever else you need on your own. \nTerms \nstored procedure \nsproc \nprocedure \nparameter \ncompiling a procedure \ncalling a procedure \npassing parameters by position \ninput parameter \noutput parameter \ninput/output parameter \nuser variable \ndata validation \n• \n• \nraising an error \ndynamic SQL \nstored function \nfunction \nscalar function\n\nChapter 15 \nHow to create stored prvcedures and functions \n475 \nExercises \n1. \nWrite a script that creates and calls a stored procedure named \ninsert_glaccount. First, code a statement that creates a procedure that adds a \nnew row to the General_Ledger_Accounts table in the AP schema. To do that, \nthis procedure should have two parameters, one for each of the two columns \nin this table. Then, code a CALL statement that tests this procedure. (Note \nthat this table doesn't allow dttplicate account descriptions.) \n2. \nWrite a script that creates and calls a stored function named \ntest_glaccounts_description. First, create a function that tests whether an \naccount description is already in the General_Ledger_Accounts table. To do \nthat, this function should accept one parameter for the account description, \nand it should return a value of 1 if the account description is in the table or \n0 if it isn't. (Note: If a SELECT statement doesn't return any data, it raises a \nNOT FOUND condition that your function ca.n handle.) \n3. \nModify the script that you created in exercise 1 so it creates and calls a stored \nprocedure named insert_glaccot1nt_ with_test. This procedt1re should t1se the \nfunction that you created in exercise 2 to test whether the account description \nis a duplicate before it issues the INSERT statement. If the account descrip-\ntion is a duplicate, this procedure should raise an error with a SQLSTATE \ncode of 23000, a MySQL code of 1062, and a message that says ''Duplicate \naccount description.\" \n4. \nWrite a script that creates and calls a stored procedure named insert_terms. \nFirst, code a statement that creates a procedure that adds a new row to the \nTerms table in the AP schema. To do that, this procedure should have two \nparameters: one for the ter1ns_due_days column and another for the \nterms_description column. \nIf the value for the description column is nt1ll, the stored procedure should be \nable to create a default value for the description column based on the value of \nthe due days column. For example, for a due days column of 120, the descrip-\ntion column should have a default value of ''Net due 120 days''. Then, code a \nCALL statement that tests this procedure.\n\nHow to create triggers \nand events \nNow that you've learned bow to work with stored procedures and functions, \nyou're ready to learn about two more types of stored programs: triggers and \nevents. Triggers can be executed before or after an INSERT, UPDATE, or \nDELETE statement is executed on a table. As a result, they provide a powerful \nway to enforce data consistency, log changes to the database, and implement \nbusiness rules. Events can be executed at a schedt1led time. As a result, they \nprovide a convenient way to automatically perform any task that needs to be \nrun regularly, such as scheduled maintenance of tables. \nHow to work with triggers .................................................. 478 \nHow to create a BEFORE trigger ................................................................ 478 \nHow to use a trigger to enforce data consistency ....................................... 480 \nHow to create an AFTER trigger ................................................................ 482 \nHow to view or drop triggers ...................................................................... 484 \nHow to work with events .................................................... 486 \nHow to turn the event scheduler on or off ................................................... 486 \nHow to create an event ................................................................................. 486 \nHow to view, alter, or drop events ............................................................... 488 \nPerspective ......................................................................... 490\n\n478 \nSection 4 \nStored prvgram development \nHow to work with triggers \nA trigger is a named database object that is executed, or fired, automatically \nwhen a particular type of SQL statement is executed. When using MySQL, a \ntrigger is fired when an INSERT, UPDATE, or DELETE statement is executed \non a table. \nHow to create a BEFORE trigger \nFigure 16-1 presents the syntax for the CREATE TRIGGER statement. To \nstart, you code the CREATE TRIGGER keywords followed by the name of the \ntrigger. In this figure, for instance, the first example creates a trigger named \nvendors_before_update. This name indicates that the trigger is associated with \nthe Vendors table and that it is fired before an update. This chapter uses a similar \nnaming convention for the other triggers. \nAfter the name of the trigger, you code the BEFORE or AFTER keyword to \nindicate when the trigger is fired. Then, you identify the statement that causes \nthe trigger to fire. Next, yoL1 code an ON clause that identifies the name of \nthe table. In this figure, for instance, the first example creates a trigger that's \nexecuted before any UPDATE statements on the Vendors table. \nAlthough each trigger is associated with a single table, with MySQL 5.7 and \nlater, you can code multiple BEFORE and AFTER triggers for the same event \non the same table. Since this can be confusing to manage and debug, however, \nI recommend you have no more than one BEFORE and one AFTER trigger for \neach event. \nAfter the ON clause, you code the FOR EACH ROW clause. This clause \nindicates that the trigger is a row-level trigger that fires for each row that's \nmodified. For example, an UPDATE statement that updates five rows would cause \nthe trigger to be executed five times, once for each row. Although some databases \nsupport other types of triggers, MySQL only supports row-level triggers. \nWithin the body of a trigger, you can use the NEW keyword to work with \nthe new values in a row that's being inserted or updated. In this figure, for \nexample, the NEW keyword gets and sets the value for the vendor_state column \nof the new row. If you try to use this keyword with a row that's being deleted, \nyou'll get an error since this row doesn't have any new values. \nYou can also use the OLD keyword to work with the old values in a row \nthat's being updated or deleted. You can't use this keyword with a row that's \nbeing inserted, though, since a new row doesn't have any old values. \nThe body of a trigger typically contains a block of code that's identified \nby the BEGIN and END keywords. In this figure, for example, the body of \nthe trigger contains a block of code with a single statement that updates the \nvendor_state column so state codes are always stored with uppercase letters. \nTo accomplish that, this statement uses the UPPER function to convert the new \nvalue for the vendor_state column to uppercase.\n\nChapter 16 \nHow to create triggers and events \n479 \nThe syntax of the CREATE TRIGGER statement \nCREATE TRIGGER trigger_name \n{BEFOREIAFTER} {INSERTjUPDATEIDELETE} ON table_ name \nFOR EACH ROW \ntrigger_body \nA CREATE TRIGGER statement that corrects mixed-case state names \nDELIMITER// \nCREATE TRIGGER vendors_before_ update \nBEFORE UPDATE ON vendors \nFOR EACH ROW \nBEGIN \nSET NEW.vendor_ state = UPPER(NEW.vendor_ state); \nEND// \nAn UPDATE statement that fires the trigger \nUPDATE vendors \nSET vendor_ state = 'wi' \nWHERE vendor id= 1 \nA SELECT statement that shows the new row \nSELECT vendor_name, vendor_state \nFROM vendors \nWHERE vendor_ id = 1 \nvendor _name \nvendor _state \n,_ \n► \nUS Postal Service \nWI \nDescription \n• \nA trigger is a named database object that executes, or fires, in response to an \nINSERT, UPDATE, or DELETE statement. \n• \nYou can fire a trigger before or after an INSERT, UPDATE, or DELETE statement \nis executed on a table. \n• \nYou must specify a FOR EACH ROW clause. This creates a row-level trigger that \nfires once for each row that's modified. \n• \nYou can use the OLD and NEW keywords to get and set the values for the columns \nthat are stored in the old row and the new row. \nFigure 16-1 \nHow to create a BEFORE trigger \nI \nI\n\n480 \nSection 4 \nStored prvgram development \nSince the body of this trigger executes a single statement, it could also be \ncoded without specifying a block of code like this: \nCREATE TRIGGER vendors_before_update \nBEFORE UPDATE ON vendors \nFOR EACH ROW \nSET NEW.vendor_ state = UPPER(NEW.vendor_ state); \nThe advantage of not specifying a block of code is that you don't have to change \nthe delimiter or identify the start and end of the block of code. The disadvantage \nis that it's more difficult to add statements to the trigger if you later decide that \nyou want the trigger to do more work. \nAlthough it's not mentioned in chapter 15, stored procedures and functions \nthat execute a single statement can also be coded without specifying a block of \ncode. If you look back at figure 15-8, for example, you'll see a stored procedure \nwhose body consists of a single UPDATE statement. Because of that, the body \nof this procedure could be rewritten without specifying a block of code. In 1nost \ncases, though, you'll want to code the body of a stored procedure or function \nwithin a block. \nHow to use a trigger to enforce data consistency \nTriggers are commonly used to enforce data consistency. For example, \nthe sum of line item amounts for an invoice in the Invoice Line Items table \n-\n-\nshould always be equal to the corresponding invoice total amount in the Invoices \ntable. Unfortunately, you can't enforce this rule using a constraint on either \nthe Invoices table or the Invoice_Line_Items table. However, you can use a \ntrigger like the one in figure 16-2 to enforce this rule when an invoice amount is \nupdated. \nThe trigger shown here fires before an UPDATE statement attempts to \nupdate the invoice_total column in the Invoices table. When this trigger fires, \nit checks if the sum of the line items is equal to the invoice total. If it isn't, the \ntrigger raises an e1Tor with an SQLSTATE code of ''HYOOO'', which indicates \na general error. Then, the application tl1at issued the UPDATE statement can \nhandle the error. \nAlthough this example isn't entirely realistic, you can use triggers like this \nto enforce business rules or to verify data consistency. Since you can program \na trigger to accommodate many situations, triggers are more flexible than \nconstraints.\n\nChapter 16 \nHow to create triggers and events \n481 \nA trigger that validates line item amounts when updating an invoice \nDELIMITER// \nCREATE TRIGGER invoices_before_update \nBEFORE UPDATE ON invoices \nFOR EACH ROW \nBEGIN \nDECLARE sum_ line_ item amount DECIMAL(9,2); \nSELECT SUM(line_ item_amount) \nINTO sum_ line_ item_amount \nFROM invoice_line_ items \nWHERE invoice_id = NEW.invoice_ id; \nIF sum_ line_ item_amount != NEW.invoice_total THEN \nSIGNAL SQLSTATE 'HYOOO' \nSET MESSAGE_TEXT = 'Line item total must match invoice total.'; \nEND IF; \nEND// \nAn UPDATE statement that fires the trigger \nUPDATE invoices \nSET invoice_total = 600 \nWHERE invoice id= 100 \nThe message from the system \nError Code: 1644. Line item total must match invoice total. \nDescription \n• \nTriggers can be used to enforce rules for data consistency that can't be enforced by \nconstraints. \nFigure 16-2 \nHow to use a trigger to enforce data consistency\n\n482 \nSection 4 \nStored prvgram development \nHow to create an AFTER trigger \nTriggers are commonly used to store information abo11t actions that occur in \na database so these actions can be reviewed later. In particular, AFTER triggers \nare used to store information about a statement after it executes. Figure 16-3 \nshows how this works. \nTo start, this figure shows a CREATE TABLE statement that creates a table \nnamed Invoices Audit. This table contains five columns that store information \n-\nabout the action that occurred on the Invoices table. Of these columns, the frrst \nthree store values from the Invoices table, and the last two store information \nabout the action that caused the statement to execute. \nAfter the CREATE TABLE statement, this figure shows two CREATE \nTRIGGER statements that add rows to the Invoices Audit table. The first \nCREATE TRIGGER statement creates a trigger that executes after an INSERT \nstatement is executed on the Invoices table. This trigger inserts the new values \nfor the vendor_id, invoice_number, and invoice_total columns into the \nInvoices_Audit table. In addition, it inse11s a string value of ''Inserted'' to \nindicate that the row has been inserted, and it uses the NOW function to inse1t \nthe date and time of the action. \nThe second CREATE TRIGGER statement works similarly, but it executes \nafter a DELETE statement. It inserts a string value of ''Deleted'' to indicate that \nthe row has been deleted. \nNote that the first trigger inserts the new values for the row that's being \ninserted since there aren't any old values for this row. However, the second \ntrigger inserts the old values for the row that's being deleted since there aren't \nany new values for this row. \nAlthough the example that's presented in this figure has been simplified, it \npresents all of the skills that you need for creating more complex audit tables. \nFor example, if you're having a problem updating rows in a database, you can \ncreate an audit table and a trigger to store whatever data you want about each \nupdate. Then, the next time the update problem occurs, you can review the data \nin the audit table to identify the cause of the problem.\n\nChapter 16 \nHow to create triggers and events \n483 \nA statement that creates an audit table for actions on the invoices table \nCREATE TABLE invoices_audit \n( \n) \nvendor_ id \ninvoice_ nwnber \ninvoice_total \naction_type \naction_date \nINT \nVARCHAR ( 5 0) \nDECIMAL(9,2) \nVAR CHAR ( 5 0) \nDATETIME \nNOT NULL, \nNOT NULL, \nNOT NULL, \nNOT NULL, \nNOT NULL \nTwo AFTER triggers that insert rows into the audit table \nDELIMITER// \nCREATE TRIGGER invoices_after insert \nAFTER INSERT ON invoices \nFOR EACH ROW \nBEGIN \nINSERT INTO invoices_ audit VALUES \n(NEW.vendor_ id, NEW.invoice_ number, NEW.invoice_total, \n'INSERTED', NOW(}); \nEND// \nCREATE TRIGGER invoices_after_delete \n• \n• \nAFTER DELETE ON invoices \nFOR EACH ROW \nBEGIN \nINSERT INTO invoices_ audit VALUES \n(OLD.vendor_id, OLD.invoice_number, OLD.invoice_total, \n'DELETED', NOW()); \nEND// \nAn INSERT statement that causes the first trigger to fire \nINSERT INTO invoices VALUES \n( 115, 34, 'ZXA-080', '2018-02-01', 14092. 59, 0, 0, 3, '2018-03-01', NULL) \nA DELETE statement that causes the second trigger to fire \nDELETE FROM invoices WHERE invoice_ id = 115 \nA SELECT statement that retrieves the rows in the audit table \nSELECT* FROM invoices audit \nvendorjd \ninvoice_number \ninvoice_ total \naction_ type \naction_date \n► \n34 \nZXA-080 \n14092.59 \nINSERTED \n2018-12-28 11:30:33 \nI \n34 \nZXA-080 \n14092.59 \nD8£TED \n2018- 12-28 11:30:33 \nDescription \n• \nYou can use an AFfER trigger to insert rows into an audit table. \nFigure 16-3 \nHow to create an AFTER trigger\n\n484 \nSection 4 \nStored prvgram development \nHow to view or drop triggers \nWhen you 're working with triggers, you often need to view all of the \ntriggers that have been created for a database. Then, you can review information \nabout those triggers, and you can drop them if they are no longer needed. \nFigure 16-4 starts by showing how to use the SHOW TRIGGERS statement \nto view all the triggers in the current database. Usually, that's what you want. In \nsome cases, though, you may want to use the IN clause to specify the database as \nshown in the second example. \nThe result set for the second example shows that the AP database contains \nfour triggers, and it provides detailed information about each trigger. First, \nthe Trigger column shows the name of each trigger. Second, the Event \ncolumn shows the type of statem.ent that causes the trigger to fire. Third, the \nTable column shows the table for the trigger. Here, three of these triggers are \nassociated with the Invoices table and one with the Vendors table. Fourth, the \nStatement column shows the code for the body of the trigger. Fifth, the Timing \ncolumn indicates whether the trigger is a BEFORE trigger or an AFTER trigger. \nAfter that, there are four other columns of information. \nIf a database contains a large number of triggers, you may want to use \nthe LIKE clause to display just the triggers with names that match a specified \npattern. In this figure, for instance, the third SHOW TRIGGERS statement only \nshows triggers that start with ''ven''. As a result, this statement shows just the \nUPDATE trigger that has been defined for the Vendors table. For more informa-\ntion about using the LIKE clause, please see chapter 3. \nBecause MySQL doesn't provide a way to alter a trigger, you have to drop it \nand then create a new trigger to change the way it works. To drop a trigger, you \ncode the DROP TRIGGER keywords followed by the name of the trigger. If you \nwant, you can add the optional IF EXISTS keywords. Since this drops the trigger \nonly if it exists, it prevents an error from occurring if the trigger doesn't exist. \nIn some cases, you may want to temporarily disable triggers. For example, \nyou may want to disable the triggers for one or more tables before inserting a \nlarge number of rows. This can help the INSERT statements run faster, and it lets \nyou insert data that isn't allowed by the triggers. Unfortunately, MySQL doesn't \nprovide a way to disable a trigger. Instead, you have to drop the trigger and then \ncreate it again later.\n\nChapter 16 \nHow to create triggers and events \n485 \nA statement that lists all triggers in the current database \nSHOW TRIGGERS \nA statement that lists all triggers in the specified database \nSHOW TRIGGERS IN ap \nJ Tr19ger \nEvent \nTable \nStatement \nTtming \nCreated \n► j involces_after _insert \nINSERT \ninvoices \nBEGIN \nINSERT INTO invoices_audit VALUES ... \nBEGIN DEa.ARE sum_line_jtem_amou,t DEO ... \nBEGIN \nINSERT INTO invoices_audlt VALUES •.• \nBEGIN SET NEW. vendor _state = UPPER{NEW •... \nAFTER \n2018-12-28 ll: \ninvoices _befure_upda te \nUPDATE \nInvoices \nBEFORE \n2018-12-28 11: \ninvolces_after _delete \nDaETE \nInvoices \nAFTER \n2018-12-28 11: \nvendors _before _update \nUPDATE \nvendors \nBEFORE \n2018-12-28 11: \n< \n> \nA statement that lists all triggers in a database that begin with ''ven'' \nSHOW TRIGGERS IN ap LIKE 'ven%' \nTrigger \nEvent \nTable \nStatement \nTuning \nCreated \n► \nvendors_before_update \nUPDATE \nvendors \nBEGIN SET NE¥J.vendor_state = UPPER{NEW .... BEFORE \n2018-12-28 11: \nA statement that drops a trigger \nDROP TRIGGER vendors_before_update \nA statement that drops a trigger only if it exists \nDROP TRIGGER IF EXISTS vendors_before_update \nDescription \n• \nTo view triggers, use the SHOW TRIGGERS statement. To filter the result set \nthat's returned, include an IN clause or a LIKE clat1se. \n• \nTo drop a trigger, use the DROP TRIGGER statement. To be sure a trigger exists \nbefore it's dropped, include the IF EXISTS keywords. \nFigure 16-4 \nHow to view or drop triggers \n>\n\n486 \nSection 4 \nStored prvgram development \nHow to work with events \nAn event, or scheduled event, is a named database object that executes, or \nfires, according to the event scheduler. With MySQL 8.0 and later, the event \nscheduler is on by default. As a result, if you don't need to use events, you \nshould turn the event scheduler off to save system resources. Conversely, the \nevent scheduler is off by default with MySQL 5.7 and earlier. If you want to use \nthe event scheduler with one of those releases, then, you need to turn it on. \nHow to turn the event scheduler on or off \nFigure 16-5 begins by showing how to check if the event scheduler is on. \nTo do that, you can use the SHOW VARIABLES statement to view the variable \nnamed event_scheduler. Then, if the event scheduler isn't on, you'll need to tum \nit on before you can work with events. To do that, you can use the SET statement \nto set the value of the event scheduler variable to ON. \n-\nHere, the ON keyword is a synonym for the INT value of 1. Conversely, \nthe OFF keyword is a synonym for the INT value of 0. Since the ON and OFF \nkeywords are easier to read than I and 0, this chapter uses these keywords. \nHowever, if you 're using an older version of MySQL, you may need to use the \nINT values. \nWhen you use a SET statement to change the event_scheduler variable \nas shown in this figure, the change only applies until the server is restarted. \nHowever, if you want to make this change permanent, you can change this \nvariable in MySQL's configuration ftle as described in the next chapter. \nHow to create an event \nFigure 16-5 also shows how to use the CREATE EVENT statement to create \nan event. You can use this statement to create a one-time event that occurs only \nonce or a recitrring event that repeats at a regular interval. \nThe first CREATE EVENT statement in this figure creates a one-time event \nnamed one_time_delete_audit_rows. To do that, this trigger uses the AT keyword \nto specify that the event should be executed one month from the current date \nand time. Then, it uses the DO keyword to identify the statements that the event \nshould execute. Here, the statements include the BEGIN and END keywords that \nidentify a block of code. Within that block, a single DELETE statement deletes \nall rows from the Invoices_Audit table that are more than one month old. \nLike the code for a trigger, the code for an event doesn't have to be coded \nwithin a block if it consists of a single statement. In this case, then, the event \ncould have been coded like this: \nCREATE EVENT one_time_delete_audit_rows \nON SCHEDULE AT NOW () + INTERVAL 1 MONTH \nDO DELETE FROM invoices_audit \nWHERE action_date < NOW{) -\nINTERVAL 1 MONTH; \nThis bas the same advantage and disadvantage as it does with a trigger.\n\nChapter 16 \nHow to create triggers and events \n487 \nA statement that checks if the event scheduler is on \nSHOW VARIABLES LIKE 'event_scheduler' \nI Variable name \nValue \n'► l event_~eduler \nON \nA statement that turns the event scheduler on \nSET GLOBAL event_ scheduler = ON \nThe syntax of the CREATE EVENT statement \nCREATE EVENT event_name \nON SCHEDULE \n{AT timestamp I EVERY interval [STARTS timestamp] [ENDS timestamp]} \nDO event_body \nA CREATE EVENT statement that executes only once \nDELIMITER// \nCREATE EVENT one time_delete_audit_rows \nON SC.HEDULE AT NOW ( ) + INTERVAL 1 MONTH \nDO BEGIN \nDELETE FROM invoices_audit WHERE action_date < NOW() -\nINTERVAL 1 MONTH; \nEND// \nA CREATE EVENT statement that executes every month \nCREATE EVENT monthly_delete_audit_ rows \nON SCHEDULE EVERY 1 MONTH \nSTARTS '2018-06-01' \nDO BEGIN \nDELETE FROM invoices_audit WHERE action_date < NOW() -\nINTERVAL 1 MONTH; \nEND// \nDescription \n• \nAn event, or scheduled event, is a named database object that executes, or fires, \naccording to the event scheduler. \n• \nBefore you begin working with events, you need to be sure that the event scheduler \nis on. With MySQL 8.0 and later, it's on by default. With MySQL 5.7 and earlier, \nit's off by default. \n• \nTo check the status of the event scheduler, you can use the SHOW VARIABLES \nstatement to view the variable named event scheduler. \n• \nTo turn the event scheduler on or off, you can use the SET statement to set the \nvalue of the event_scheduler variable to ON or OFF. Here, the ON and OFF \nkeywords are synonyms for the INT values of 1 and 0. \n• \nAn event can be a one-time event that occurs once or a recurring event that occurs \nregularly at a specified interval. \nFigure 16-5 \nHow to create an event\n\n488 \nSection 4 \nStored prvgram development \nThe second CREATE EVENT statement in figure 16-5 creates a recurring \nevent named monthly _delete_audit_rows. This statement works much like the \nfu·st statement, except that it uses the EVERY keyword to specify that the event \nshould be executed every month, and it uses the STARTS keyword to specify a \nstarting date of midnight on June 1, 2018. As a result, at the end of every month, \nthis event deletes all audit rows that are more than 1 month old. \nThe CREATE EVENT statement uses the date/time intervals that work with \ndate functions. As a result, you can use the INTERVAL keyword along with \nother keywords such as MINUTE, HOUR, DAY, WEEK, MONTH, and YEAR \nto specify a time. For more information, please see chapter 9. \nHow to view, alter, or drop events \nThe skills that you learned for viewing and dropping triggers are similar \nto the skills that you use to view and drop events. As a result, once you learn \nhow to view and drop triggers, you shouldn't have much trouble viewing and \ndropping events. For instance, the frrst three examples in figure 16-6 show how \nto use the SHOW EVENTS statement to view events, and the last two examples \nshow how to use the DROP EVENT statement to drop an event. \nWhen working with events, you can also use the ALTER EVENT statement \nto temporarily enable or disable an event or to rename an event. For instance, \nthe fou1th exa111ple in this fig01·e shows how to use the ALTER EVENT state-\nment to disable an event. To do that, you code the ALTER EVENT keywords, \nfollowed by the name of the event and the DISABLE keyword. Then, the fifth \nexample shows how to use the ENABLE keyword to enable an event that has \nbeen disabled. Finally, the sixth exainple shows how to use the RENAME TO \nkeywords to rename an event.\n\nChapter 16 \nHow to create triggers and events \n489 \nA statement that lists all events on the server \nSHOW EVENTS \nA statement that lists all events in a database \nSHOW EVENTS IN ap \nName \n► \nap \nmonthly _delete_audit_rows \nap \none_time_delete_audit_rows \n< \nDefiner \nroot#iocalhost \nroot@localhost \nTme \nzone \nSrSIEM \nSYSIEM \nType \nREOJRRING \nONETIME \nExeaJte at \n2019-01-2812:06:25 \nInterval \nvalue \n1 \nOW!t \nInterval \nfield \nMONTH \nlit9!1 \n> \nA statement that lists all events in a database that begin with ''mon'' \nSHOW EVENTS IN ap LIKE \n1mon%1 \nDb \nName \nDefiner \n► \nap \nmonthly _delete_audit_rows \nroot@u>calhost \n< \nTime \nzone \nSYS I EM \nA statement that disables an event \nType \nRECURRING \nExecute at \nIUU!i \nALTER EVENT monthly_delete_audit_ rows DISABLE \nA statement that enables an event \nALTER EVENT monthly_delete_audit_ rows ENABLE \nA statement that renames an event \nInterval \nvalue \n1 \nInterval \nfield \nMONTH \nStarts \n2018-06 \n> \nALTER EVENT one_time_delete audit_ rows RENAME TO one_time_delete_ audits \nA statement that drops an event \nDROP EVENT mont hly_delete_audit_ rows \nA statement that drops an event only if it exists \nDROP EVENT IF EXISTS monthly_delete_audit_rows \nDescription \n• \nTo view events, use the SHOW EVENTS statement. To filter the result set that's \nreturned, include an IN clause or a LIKE clause. \n• \nTo enable or disable an event, use the ALTER EVENT statement with the ENABLE \nor DISABLE keyword. \n• \nTo rename an event, use the ALTER EVENT statement with the RENAME TO \nkeywords, followed by the new name. \n• \nTo drop an event, use the DROP EVENT statement. To be sure an event exists \nbefore it's dropped, include the IF EXISTS keywords. \nFigure 16-6 \nHow to view, alter, or drop events\n\n490 \nSection 4 \nStored prvgram development \nPerspective \nIn this chapter, you learned how to use triggers to perform tasks that would \nbe difficult or impossible to perforn1 with other features like constraints. At this \npoint, you should be able to create and use triggers that enforce data consis-\ntency, implement business rules, and log changes to the database. In addition, \nyou should be able to use events to automatically perform tasks according to a \nschedule. \nAlthough this is more than the typical SQL developer needs to know, this \ngives you the perspective that you need when you encounter triggers that have \nbeen created by others. This also provides the background that you need for \nlearning more about triggers on your own. \nTerms \ntrigger \nfire a trigger \nrow-level nigger \nevent \nscheduled event \nfire an event \nevent scheduler \none-time event \nrecurring event \nExercises \n1. \nOpen the trigger named invoices_before_update that was shown in figure \n16-2. Then, modify it so it also raises an error whenever the payment total \nplus the credit total becomes larger than the invoice total in a row. Then, test \nthis trigger with an appropriate UPDATE statement. \n2. \nCreate a trigger named invoices_after_update. This trigger should insert \nthe old data about the invoice into the Invoices Audit table after the row is \nupdated. Then, test this trigger with an appropriate UPDATE statement. If the \nInvoices_Audit table doesn't exist, you can use the code shown in figure 16-3 \nto create it. \n3. \nCheck whether the event scheduler is turned on. If it isn't, code a statement \nthat turns it on. Then, create an event that inserts a test row that contains test \nvalues into the Invoices_Audit table every minute. To make sure that this \nevent has been created, code a SHOW EVENTS statement that views this \nevent and a SELECT statement that views the data that's inserted into the \nInvoices_Audit table. Once you're sure this event is working correctly, code a \nDROP EVENT statement that drops the event.\n\nDatabase administration \nIf you want to become a database administrator, this section should get you \nstarted. Although it doesn't show you everything there is to know about \ndatabase administration, it does get you started by presenting the skills you \nneed to be the database administrator for a MySQL database that runs on \na single server. This should be enough for many types of projects, such as \na database that's used by a medium-sized website or a database that's used \nfor a departmental system. \nIn chapter 17, you'll get an overview of database administration. In \naddition, you'll learn some practical skills that you can use to monitor \nand configure a server and work with its logs. In chapter 18, you'll learn \nhow to secure a database and work with user accounts. Finally, in chapter \n19, you'll learn how to back up and restore a database. At this point, you \nshould have a solid foundation in database administration.\n\nAn introduction \nto database administration \nThis chapter begins by presenting an overview of database administration, \nincluding the responsibilities of a database administrator and the various types \nof files that are used by a database. Then, this chapter presents some practical \nskills that you can use to get started with database administration. These skills \ninclude monitoring the server, configt1ring the server, and working with the \nserver's logs. \nDatabase administration concepts ................................... 494 \nDatabase administrator responsibilities ...................................................... 494 \nTypes of database _files ................................................................................. 496 \nTypes of log fiJes .......................................................................................... 496 \nHow to monitor the server ................................................. 498 \nHow to view the server status ...................................................................... 498 \nHow to view and kill processes .................................................................. 500 \nHow to view the status vaJ·iable ................................................................. 502 \nHow to view the system variables .............................................................. 504 \nHow to configure the server .............................................. 506 \nHow to set system variables using MySQL Workbench ............................ 506 \nHow to set system variables using a text ecLitor ........................................... 508 \nHow to set system variables using the SET statement ................................ 510 \nHow to work with logging .................................................. 512 \nHow to enable and disable logging .............................................................. 512 \nHow to configure logging ............................................................................ 514 \nHow to view text-based logs ........................................................................ 516 \nHow to manage logs ...................................................................................... 518 \nPerspective ......................................................................... 520\n\n494 \nSection 5 \nDatabase administration \nDatabase ad111inistration concepts \nBefore you leain practical skills for administering a database, it helps to \nunderstand some general concepts. To start, you should have a clear under-\nstanding of the responsibilities of a database administrator. In addition, you \nshould understand the types of files that are used by MySQL. \nDatabase administrator responsibilities \nA database administrator (DBA) has many responsibilities that vary \ndepending on the database. These responsibilities are summarized in figure 17-1. \nFor most databases, the DBA designs and creates the database as described in \nchapters 10 through 12. Then, the OBA should secure the database as described \nin chapter 18. And, of course, the DBA should make sure that the database is \nbacked up regularly so it can be restored LIP to the current point in time if neces-\nsary as described in chapter 19. \nWhen a database goes into production, the DBA is responsible for \nmonitoring the server to 1nake sure it can handle its workload. If necessary, \nthe DBA may need to configure the server to fix a problem or to get it to work \n1nore efficiently. To help with these tasks, the DBA may need to review logs to \nmonitor database performance or to identify problems such as queries that run \nslowly. These skills are described in this chapter. \nA database might also be administered by multiple people. For example, \nlarge mission-critical databases might be designed and created by a specialist \nbefore it's handed over to a11other DBA who is responsible for 1nonitoring it. \nOr, if the database is hosted remotely, one DBA at the remote site might be \nresponsible for certain administrative tasks while another DBA might be able to \nperform other administrative tasks remotely. \nThis chapter and the next two chapters focus on the skills that a DBA needs \nto administer a database that's running on a single server. However, it makes \nsense to run some databases on multiple servers. For example, you can often \nimprove the performance of a large database by running the MySQL server on \nmultiple machines and then running the database on each machine. Then, you \ncan use database replication to synchronize the databases so a.ny change made to \none database is automatically propagated to the other databases. To do this, you \ncan identify one server as the master and the other servers as the slaves.\n\nChapter 17 \nAn. introduction to database administration \n495 \nDatabase administrator responsibilities \nMaintenance \n-\nMonitor the server \n-\nConfigure the server \n-\nMaintain log files \nDesign \n-\nDesign the database \n-\nCreate the database \nSecurity \n-\nMaintain user accounts \n-\nSecure the server and its databases \nBackup \n-\nBackup the database regularly \n-\nRestore the database if necessary \n-\nMigrate data to another server if necessary \nMiscellaneous \n-\nStart or stop the server when necessary \n-\nOptimize the server \n-\nUpdate software when necessary \n-\nEnable and manage replication if necessary \nDescription \n• \nA database administrator (DBA) has many responsibilities that vary depending on \nthe database. \n• \nChapter 2 describes how to start and stop the server. \n• \nChapters 10 through 12 describe the skills that a OBA typically uses to design and \ncreate databases. \n• \nChapters 17 through 19 focus on the skills that a OBA needs to administer a \ndatabase that's running on a single server. \n• \nDatabase replication involves setting up two or more MySQL servers, usually \nrunning on different machines, where one server is the master and the other servers \nare the slaves. Then, any changes made to databases on one server are auto1nati-\ncall y propagated to the databases on the other servers. \nFigure 17-1 \nDatabase administrator responsibilities\n\n496 \nSection 5 \nDatabase administration \nTypes of database files \nFigure 17-2 summarizes the types of database files used by MySQL server, \nincluding configuration files, data files, and log files. To start, MySQL reads a \nconfiguration file when it starts. For Windows, this file is named my.ini and is \nusually stored in the parent directory of the data directory (MySQL 5.6 and later) \nor the base directory (MySQL 5.5 and earlier). For macOS and Unix/Linux, this \nfile is named my.cnf and is usually stored in the /private/etc or /etc directory. \nMySQL's data directory contains subdirectories and files that MySQL \nuses to store the data for its databases. Here, each subdirectory corresponds to \na database. For example, the AP database is stored within a directory named \nAP. Within a subdirectory, the files correspond to the tables and other objects \nof the database. The table files differ depending on the release of MySQL and \nwhether the tables are InnoDB or My ISAM. For example, InnoDB uses two \nfiles per table with MySQL 5.7 and earlier (.frm and .ibd) and one file per table \nwith MySQL 8.0 and later (.ibd). However, MyISAM uses three files per table \nwith MySQL 5.7 and earlier (.frm, .myd, and .myi) and two files per table with \nMySQL 8.0 and later (.myd and .myi). In addition to subdirectories, the data \ndirectory may contain log files that contain information that's written by the \nserver. \nBy default, MySQL's data directory is hidden. To view this diI·ectory with \nWindows, you need to change the settings for the Explorer so it shows hidden \nfiles, folders, and drives. To view this directory with macOS, you can start a \nTerminal window and execute these two commands: \nde f aults write com. apple . f inder AppleShowAllFile s YES \nkillall Finder \nTo hide these files, you can execute these two commands again but specify a \nvalue of NO in the first command instead of YES. \nTypes of log files \nFigure 17-2 also summarizes the different types of log files that MySQL \ncan create. To start, a general log contains a record of client connections, SQL \nstate1nents received from the clients, and other information. This file is useful \nfor monitoring the server. An error log contains messages about server startup \nand sht1tdown as well as error messages. This file is useful for troubleshooting \nproblems with starting or stopping the server. And a slow query log contains a \nlist of SQL statements that take a long time to execute. This file is useful for \nidentifying queries that need to be rewritten to optimize database performance. \nA binary log consists of an index file and a series of numbered binary files. \nThe index ftle contains a list of the binary ftles, and the binary ftles contain a \nrecord of the changes that have been made to the database. This log can be used \nwith backups to restore a database after a crash. It can also be used to enable \nreplication between a master server and a slave server. \nLike a binary log, a relay log consists of an index file and a series of \nnumbered binary files. These files are used on a slave server to relay any changes \nthat have been made on the master server to the slave server. This log is only \nnecessary when you 're using replication.\n\nChapter 17 \nAn. introduction to database administration \n497 \nTypes of database files \nFile type \nDescription \nConfiguration \nData \nLog \nFiles that contain configttration options that the MySQL server uses \nto set its defaults when it starts. For Windows, this file is named \nmy.ini. For macOS and Unix/Linux, this file is named my.cnf. For \nmore information, see figures 17-7 through 17-9. \nFiles that define the tables, indexes, and other database objects. \nThese files also store any data that's used by the database objects. \nInnoDB uses two files per table with MySQL 5.7 and earlier (.frm \nand ibd) and one file per table with MySQL 8.0 and later (.ibd). \nMy ISAM uses three files per table with MySQL 5.7 and earlier \n(.frm, .myd, and .myi) and two files per table with MySQL 8.0 and \nlater (.myd and .myi). Other files are used for other database objects \nsuch as views and triggers. \nFiles that contain information that's written (logged) by the data-\nbase server. You can configtire your server to turn these files on or \noff and to control how they work. For more information, see figures \n17-10 through 17-13. \nTypes of log files \nLog type \nDescription \nGe11eral \nError \nSlow query \nBinary \nRelay \nA text file that contain.s a record of client connections, SQL statements \nreceived from the clients, and other inf 01mation. \nA text file that contains messages about server startup and shutdown \nand error messages. \nA text file that contains SQL statements that take a long tin1e to execute. \nOne or more binary files that contain a record of changes that have been \nmade to the database. This log can be t1sed with backups to restore a \ndatabase after a crash. This log can also be used to enable replication \nbetween a m.aster server and a slave server. \nOne or more binary files that are used on a slave machine to relay any \nchanges that have been made on the master machine. This log is only \nnecessary when you're using replication. \nThe base and data directories for Windows \nC: \\ Progr am Files\\MySQL\\ MySQL Server 8. 0 \nC: \\ ProgramData \\MySQL\\ MySQL Server 8.0 \\ Data \nThe base and data directories for macOS and Unix/Linux \nu s r/l ocal/mysql / \nusr/loc al / my sql/da t a \nDescription \n• \nThe database server uses several types of files including configuration files, data \nfiles, and log files. \n• \nBy default, MySQL's data directory is hidden. As a result, you need to be able to \nview hidden files to see this directory. \nFigure 17-2 \nTypes of database and log files\n\n498 \nSection 5 \nDatabase administration \nHow to 111onitor the server \nWhen a database is running on a server, you should occasionally monitor \nthe server to make sure that it's running efficiently. That includes making sure \nthe server isn't using too much of the system's CPU and memory, and that the \nnumber of connections and traffic ar·en't too much for the server. To do that, you \ncan view the process list, status variables, and system variables. \nHow to view the server status \nTo view information about the server, you can open a connection to the \nserver. Then, you can select the Server➔Server Status item from the menu \nsystem to display an Administration tab like the one shown in figure 17-3. \nAlternately, you can display this Adminjstration tab by clicking the Server \nStatus item in the Administration tab of the Navigator window. In the next few \nfigUI·es, the Navigator window isn't shown. This allows these figures to focus \non the Administration tabs. However, Workbench typically shows the Navigator \nwindow. As a result, you can 11se it to display these Administration tabs if you \nwant. \nThe information in the Server Status window is divided into two sections. To \nthe left, you can see the name and version of the server and other information. To \nthe right, you can see if the se1·ver is running along with graphs of the amount of \nCPU and memory that are being used by the server. Also, graphs of the number \nof connections to the server, the traffic in KB per second, and so on. By viewing \nthese graphs, you can get an idea of whether the server has enough resources to \nhandle its connections and traffic.\n\nChapter 17 \nAn. introduction to database administration \nThe Server status window \n■ \nMySQL Workbench \n6 \nlocal 1113tance MySQL80 x \nFile \nEdit \nVte11 \nQuery \nOaiabase \nSeNer \nTools \nScriptmg \nHelp \nJ:anin&Stration • Sen,..- Slaws > \nConnec1lon Name \nLocal instance MySQL80 \nHost: \nSodcet: \nPort \nAnne-2015-PC \nMVSQL \n3306 \n8.0.13 \nMy O \nServer \nMySQl Commuruty Se~r • GPL \nCoo1)11edFor: \nWin64- (x86_64} \nConfi!;µ-ation Fie: \nRl.n'wlg Sr=; \nC:\\PtognimData\\ MySQL \\ MVSQL ~tt 8.0\\ myJnl \nSat Jan 1219:22:.55 2019 (1 day 19:11) \nRefresh \nAvailable Server Features \n~ \nSchena: \nOn \nWindows Aulhen1lcabon: \nThread Pool: \nn/a \nPasS'i\\onl Valdaboo: \n'4emcad1ed l'k,gJ'l: \nn/a \nAUcitlo!j: \nSemsync~bon~ \nn/a \nArewal: \nSSL Avlliahity: \nOn \nArewal Trace: \nServer Directories \n8a2 Directxry: \nData Oiredxry: \nC:\\Program files\\ MySQL \\ HySQL Sol!crver IIJI\\ \nC:\\ProgramData\\MVSQL \\ MVSQJ. Serva 8.0\\ Data\\ \nDisk So«e in Data Dir: \n539.07 68 of 674.66 68 ava;Jable \nDescription \nOff \nn/a \nn/a \nn/a \nn/a \n□ \nCPIJ/loao \nCclnnecuons \nRunning \n31% \n4 \nTraffic \nKey E ffc,er,cy \n4.65 KB/s \n0.0% \n.., \nSeleds per Second \nlnnoOfl Buff~ Usage \n0 \n51.6% \nlnno06 ~ads per Second \nlnno08 Wries per Second \n0 \n0 \n• \nTo view the server status, you can sta1t MySQL Workbench and open a connection \nto the server. Then, you can select the Server➔ \nServer Status item from the menu \nsystem. Or, you can select the Server Status item from the Administration tab of the \nNavigator window. \n• \nBy viewing the se1~er status window, you can get an idea of whether the server has \nenough resources to handle its connections and traffic. \nFigure 17-3 \nHow to view the server status \nX \n499\n\n500 \nSection 5 \nDatabase administration \nHow to view and kill processes \nA process is a connection to the database. To view a list of all the processes \nthat are running, you can open a connection to the server. Then, you can select \nthe Client Connections item to display a Client Connections window like the one \nshown in figure 17-4. If you display this window and the process list is empty, \nyou can click on the Refresh button to display the processes. Alternatively, you \ncan change the Refresh Rate option so the list is refreshed at the rate you specify. \nThis window shows information about the connections to the database. In \nthis figure, eight connections have been established. The first connection is for \nthe event scheduler that you lea111ed about in chapter 16. Since no events are \ncurrently being processed, the Command column for this connection indicates \nthat it is sleeping. \nThe second connection is for the MySQL Server process itself. Here, the \nCommand col11mn refers to the named of the process, called the mysqld program \nor the MySQL daemon. \nThe third and fourth connections are for the root user that MySQL \nWorkbench used when it connected to the server to display the SQL Editor tab. \nSince no processing is currently being performed in this tab, the Command \ncolumn for these connections indicates that they are sleeping. \nThe fifth and sixth connections are also for the root user, but they were used \nby MySQL Workbench to connect to the server to display the Administration tab \nfor the Client Connections window. The Command column for the first connec-\ntion indicates that it is being used to execute a query. Specifically, the SHOW \nPROCESSLIST statement is being executed on this connection. This is the \nstatement that displays the information in the Client Connections window. \nThe last two connections are for a user namedjim. You'll learn more about \nworking with users other than the root user in the next chapter. \nIf necessary, you can stop a process by selecting it and clicking on the Kill \nConnection button. For example, you might want to do that if a process isn't \nresponding. You can also stop a query by selecting it and clicking on the Kill \nQuery button. You might want to do that if a query is stuck or it's taking too long \nto run. This stops the query, but doesn't stop the process. \nSince MySQL Workbench provides a convenient way to view the process \nlist, you'll usually want to use it. However, if you don't have access to MySQL \nWorkbench, you can use the SHOW PROCESSLIST statement to view the list of \nprocesses. You can also use the KILL statement to stop a process whenever that's \nnecessary. For more information about these statements, you can look them up in \nthe MySQL Reference Manual.\n\nChapter 17 \nAn. introduction to database administration \nThe process list \n■ \nMySQl. Workbench \n6 \nloC'al IMlance MvSOLSO x \n~ x \nFile \nEdit \nVtew \nQuery \nDatabase \nSefver \nTools \nScripting \nHelp \noJ \nLocal Instance MySQl.80 \nd ient Connections \nThreitds Connected: 6 \nThreitds Running: 2 \nTotal Connections: 83 \nConnection Limit 151 \ntd \nUser \nHost \nDB \n'I event_sched... N4ne \nNone \n6 None \nNone \nNone \n7-'I root \nlocalhost \nap \n75 root \nlocalhost \nap \n79 root \nlocalhost \nNone \n80 root \nlocalhost \nNone \n82 jim \nlocalhost \nNone \n83 Jrm \nlocalhost \nNone \n< \nThreitds Created: 8 \nAborted Clieflts: 0 \nSleep \nDaemon \nSleep \nSleep \nQuery \nSleep \nSleep \nSleep \nD \nX \nThre.ads Cached: 2 \nRejected (over limit): O \nAborted Connections: 6 \nErrors: 0 0 \nr,me \nState \nThre-,... Type \nNilme \nPar-en ..• lnslnJmented \nInfo \n1119077 Waibn9 for.. \n'13 FOREGROUND thread/ sqVe ... \n1 YES \nNULL \n1192068 Suspending \n4'1 FOREGROUND thread/sql,lc. .. \n1 YES \nNULL \n3-49 None \n113 FOREGROUND thread/ sq/o \nO YES \nNUU \n3'19 Nome \n114 FOREGROUND thread/ sq/o ... \n0 YES \nNULL \nO Sending data \n11B FOREGROUND thread/ sq/o \na YES \nSELE \n3 None \n119 FOREGROUND thread/sq/a ..• \nO YES \nNULL \n6 None \n121 FOREGROUND thread/ sq/a \n0 YES \nNULL \n6 None \n122 FOREGROUND thre.ad/ scNo ... \n0 YES \nNULL \n> \n~-----;:====:;--------------------:===-=-=-=-=-=--.:::;--:::::=========-------: ... ::::..._.., \nRefresh Rate: I Donl Refresh \nv I \nI Refresh I \nD fide sleeping CDmeCtlons \n0 tide backgroi.nd IIYeads \n0 Don't load ful thre-,d rifo \nShow Detats J \nReady \nDescription \n• \nA process is a connection to the database. \n• \nTo view the processes that are running, you can start MySQL Workbench and open \na connection to the server. Then, you can select the Server➔Client Connections \nitem. Or, you can select the Client Connections item from the Administration tab of \nthe Navigator window. \n• \nIf the Refresh Rate option is set to Don't Refresh, you will need to click on the \nRefresh button to display the process list. \n• \nTo stop a query, you can select it and click the Kill Query button. \n• \nTo stop a process, you can select it and click the Kill Connection button. \n• \nTo manually view a list of processes, you can use the SHOW PROCESSLIST state-\nment. To manually stop a process, you can use the KILL statement. For more infor-\nmation about these statements, you can refer to the MySQL Reference Manual. \nFigure 17-4 \nHow to view and kill processes \n501\n\n502 \nSection 5 \nDatabase administration \nHow to view the status variables \nAlthough viewing the process list is often enough to determine whether a \nserver is pe1f orming adequately, you can view the status variables if you need \nadditional information about the status of the server. To view these variables, you \ncan select the Status and System Variables item. Then, if the Status Variables tab \nisn't displayed, you can click on it to display it. Finally, you can click on one \nof the categories to display the variables in that category. For example, you can \nclick on the Binlog category to view all status variables that are associated with \nbinary logs. You can click on the Replication category to view all status variables \nthat are associated with replication. And so on. To display all the variables at \nonce, you can click on the All category. \nAs figure 17-5 shows, the Status Variables tab includes the name of each \nstatus variable, alon.g with its current value. In addition, most variables have a \ndescription. To leain more about the status of your server, you can read through \nthese variables and their descriptions. Although you probably won't understand \nthe information that all of these variables provide, you should understand some \nof them. And, you '11 leai-n a lot about the status of your server by reviewing \nthem. \nYou can also use the Status Variables tab to search for specific variables. \nTo do that, you enter some text in the Search box. Then, only the variables that \ninclude the search text are displayed. In this figure, for example, the tab displays \nonly the status variables that include ''conn'' somewhere in the variable name. As \na result, this search displays most status variables that display information abottt \nconnections to the server.\n\nChapter 17 \nAn. introduction to database administration \nStatus variables \n■ \nMySQl. Workbench \nD \nX \n6 \nLocal instance MySQLSO x \nRle \nEdit \nVtf!!W \nQuery \nDatabase \nSefver \nTools \nScripting \nHelp \n61 \nam @l &J @ rai \nAdmil'istrabon • Status and Sys -~------------------------------\nLocal Instance MySQl.80 \nServer Variables \nStatus Vana~s System Variables \nCategory \nAll \nAltered \nBinlog \nI \n,., \nName \nValue \nAborted_conn~ \n6 \nConnection_errors_accept \n0 \nConnection_errors_internal \n0 \nConnection_errors_max_connections 0 \nConnection_ emirs _peer _address \n0 \nConnectlon_errors_seled \n0 \nConnection_errors_tcpwrap \n0 \nConnections \n83 \nlocked_conneds \n0 \nDesoiPbon \nNumber of failed attempts to connect to MySQL server \nNumber of errors calling accept on the llstenlng port \nNumber of connections refused due to internal errors \nNumber of connections rHUsed due to themax_connections limlt \nNumber of errors searchrng for connection d1ent IP addresses \nNumberof errors calling s~ectfpoll on the listening port \nNumber of connections refused by libwrap \nNumber of connecbon attempts \nNumber of attempts to connect to locked accounts \nCommands/Admin \nCommands/DDL \nCommands/DML \nCommands/G~eral \nCommands~ared statement \nCommands/Replication \nCommands/Show \nCommands{Tl'llnsacbon \nMax_used_connections \nMax_used_connedions_tlme \n8 \n201~01-10 10:55:11 \nThe maximum number of connt,ctions that have been In use slmultaneou~ \nThe tlme at which Max_used_connedions reached Its current value \nMysqlx_ronnedion_accept_errors \n0 \nThe number of connecttons which have caused accept errors \nMysqlx_connect,on_errors \n0 \nThe number of connections which have been dos,d \nArewall \nMYsqlx_connections_acceptM \n0 \nThe number of connections which have been accepted \nG~eral \nMysqlx_connections_dos!d \n0 \nThe number of connections which have b~ dosed \nHandler \nMysqlx_connecbons_reiected \n0 \nThe number of connt,cbons wluch have been reiected \nPerformance_schema_sesslon_Cllll \n125 \nThe slze of the longest valid connection attnbute buffer seen \nInnoOB/Buffer pool \nInnoOB/Dm \nPerformance_schema_session_coo... 0 \nThe number of connections for whidl 41:tnbute strings could not be ueal \nInnoDB/General \n.., \nSsl client connects \n0 \nNumber of SSL connection atte1111>ts to an SSl~nabled master \n\" \n< \n> \n< \nCopy Global Status and v~ to Clipboard \nSQL Edrtor d~ed \nDescription \n• \nA status variable is a va1iable that contains information about the status of the \nMySQL server. \n• \nTo view status variables, select the Server➔ Status and System Variables item. Or, \nselect the Status and System Variables item from the Administration tab of the \nNavigator window. If necessary, click the Status Variables tab. From that tab, you \ncan click one of the categories to display different status variables. \n• \nTo search for one or more status variables, type a search string in the Search box at \nthe top of the tab. This displays all status variables whose name contains the search \nstring. \n• \nTo manually view status variables, you can use the SHOW STATUS statement. \nFor more information about this statement, you can refer to the MySQL Reference \nManual. \nFigure 17-5 \nHow to view the status variables \n> \n503\n\n504 \nSection 5 \nDatabase administration \nHow to view the system variables \nIf you need to check how the MySQL server is currently configured, you cai1 \nview its system variables as shown in figure 17-6. In general, viewing system \nvariables works like viewing status variables. As a result, if you understand \nhow to view status variables, you shouldn't have any trouble viewing system \nvariables. \nIn the next few figures, you'll learn how to set system variables. As you do, \nyou'll learn more about how these variables work and what they can do.\n\nChapter 17 \nAn. introduction to database administration \nSystem variables \n■ \nMySQl. Workbench \nD \nX \n,A \nLocal instance MySQLSO x \nFile \nEdit \nView \nQuery \nDatabase \nServer \nTools \nScripting \nHelp \n6l \nsa•~---------------------------------\nLoe.al Instance MySQl.80 \nServer Variables \nStatus Variables Systen Variables \nCategory \nAll \nFiltered \nAdvanced/General \nAdvanced/Insert del1yed settings \nAdva11terlflhread specific settlnos \nAdvanced{Transadtotll \nAdvanced/Valioll$ \nGeneral/Backup \nGeneral/Directories \nPersist \n□ \n□ \n□ \n□ \n□ \n□ \n□ \n□ \n□ \n□ \n□ \nName \nactinte_all_rotes_on_logsi \nauto_generate_certs \nauto_incriement_increment \nauto_lllcrientent_offset \nautocommlt \nautomatlc_sp_privlleges \navoid_ternporal_upgrade \nback_log \nbasedr \nblg_tables \nbind_address \nValue \nOFF \nON \nl \n1 \nON \nON \nOFF \n80 \nC:\\Program Files\\Mv \nOFF \n• \nPersist Value \nDeSOiJllon \n[,w} Whetner to actlvate all user roles , \nWhether to aut09enerate SSL key and < \n[rw} AUTO_INCREMENT columns are ,n \n[rw) Offset added to AUTO_INCREMEII \n[,wJ Sets the autocomm,t mode \n[rw)Creating and dropping stored proc \n[rwJ Whl!ther AL Tl:R TABLE should upg \nNumber of outstand,ng connection req \nPath of installabon directory \n[rw)Allow big r~ultsets by saving all I \nfl' address or host name to bind to \n,., \nGeneral/Features \n□ \nGeneral/fir~! \n□ \nGeneral/General \n□ \nGeneral/International \n□ \nGeneral/Memory usage \n□ \nGeneral/SQL \n□ \nGeneral/Sl'stern \n□ \nGeneral!Trans actions \n.., \n□ \nbin!og_cache_si21! \n32768 \nbtnlog_checksum \nCR02 \nblnlog_direct_non_transactlonai_l4'(l._ OFF \nbinlog_error_action \nABORT_SERVER \nbinlog_expire_logs_sminds \n2592000 \nblnlog_rormat \nROW \nbtnlog_group_commit_sync_dday \n0 \nbinloCJ oroup commit sync no dela ... 0 \n[rwJ Size of the cache to hold the SQL s \n[rwJ Enable/disable binary log checksu \n[rw) Causes updates using statement f, \n[rwJ Controls v.'hat happens v.'hen the s \n[rw) Purge binary logs after this many! \n[rw} Specifles the format of the binary \n[rw) Sets the number of microseconds t \nrrwlSets the maximum numberof trans \" \n< \n> \n< \nCopy Global St4 ti.I$ and Variables ID Clipboard \nSQL Edrtor cli»ed \nDescription \n• \nA system variable is a variable that stores a setting for the current configuration of \nthe MySQL server. \n• \nTo view server variables, select the Server➔Status and System Variables item. \nRefresh \nOr, select the Status and System Variables item from the Administration tab of the \nNavigator window. If necessary, click the System Variables tab. From that tab, you \ncan click one of the categories to display the variables in that category. You can also \nenter a search string in the Search box above the category names. \n• \nIf you don't have access to MySQL Workbench, you can use the SHOW \nVARIABLES statement to view the system variables. For more information about \nthis statement, you can refer to the MySQL Reference Manual. \nFigure 17-6 \nHow to view the system variables \n505\n\n506 \nSection 5 \nDatabase administration \nHow to configure the server \nWhen you install MySQL, the MySQL Server Instance Configuration \nWizard generates a configuration file that's appropriate for your system. For \nexample, if you followed the instructions in the appendixes of this book to install \nMySQL on your computer, it has been configured appropriately for a developer \nwho is using MySQL for learning and testing. However, if you install MySQL \nfor a production system, you can use this wizard to configure the server so it's \nappropriate for that system. \nIf you need to change the server configuration after installing it, you can do \nthat by editing MySQL's configuration file with either MySQL Workbench or a \ntext editor. This sets the system variables for the server. Then, MySQL reads the \nsystem variables from the configuration file every time it starts. \nYou can also use SET statements to set system variables dynamically. When \nyou do that, the settings go into effect imn1ediately and aren't saved in the \nconfiguration file. This allows you to change a system variable without having \nto restart the server. This is sometimes useful if you want to experiment with \ndifferent settings to see if they work correctly before you change them in the \nconfiguration file. \nHow to set system variables \nusing MySQL Workbench \nFigure 17-7 shows how to use MySQL Workbench to set system variables in \nthe configuration file. To do that, you select the Options File item to display the \nOptions File window. Then, you click on an appropriate tab and use it to change \noptions. \nIn this figure, the General tab shows some of the options that you can \nchange. For example, you can use the basedir and datadir variables to change the \nbase directory and the data directory that are used by MySQL. \nWhen you 're done making changes, you can click the Apply button to write \nthe changes to the configuration file. However, MySQL won't read the configu-\nration file until it starts. As a result, you1· changes won't go into effect until you \nstop and restart the server. \nIf Workbench isn't able to write your changes to the configuration file, it \nmay be because it doesn't have appropriate privileges. In that case, you may be \nable to solve the problem by running Workbench as an administrator. \nHowever, this problem may also be occu1ring because the connection isn't \npointing to the correct configuration file. In this figure, for example, the bottom \nof the window shows the configuration file that Workbench is attempting to \nmodify. In this case, that file is correct for a Windows system. If this file isn't \ncorrect for your system, you can edit the connection as described in this figure. \nThen, when you reconnect to the database, the bottom of the Options File \nwindow should show the correct configuration file. \nOn macOS, the bottom of this window typically points to the my.cnf file in \nthe etc diI·ectory. However, a default install of MySQL doesn't create this file.\n\nChapter 17 \nAn. introduction to database administration \n507 \nServer configuration options \n■ \nMySQl. Workbench \nD \nX \n6 \nLocal instance MySOLBO x \nFile \nEdit \nVtew \nQuery \nDatabase \nServer \nTools \nScripting \nHelp \nLocal lnstancE MySQl.80 \nOptions File \nLocate option: ~I------~] \nGB'l!!ral Lcoot,o \nImoOB Networldng Advanced Other \nSeaxity Repkatioo MylSAM Performara \nllir«tDrics \n□ basedr \n0 clatadr \n□ ~-di' \n□~ \nSystem \nD awid_te,p,ral_uw-ade \nD ccre-file \nD cisabled_sta.age_engnes \n□ \nextemal-locldng \n□gdb \n1:2] lower _case_table_names \nparent of\"' \nPath of ristalabon mectory \nlc:,\"rOQramCI ... \nPath of data di'ec:lory \nC:'f'raoram I ~ Directory far~ \nPath fur temporary tiles \nWhethl!f' Al TER TABLE snould ~ \npre-5.6. -I b!mporal counns \nVt'nte an file on servl!f' crans \nSmrage el'IO\"\\eS that carnot be used to aeate tables \nUse systan (external) loddng \nSiet up signals usablie far debuggi{lg \nIf Sf!t to 1, tal:e names Me stored In lowercase on disk and tal:)je names wil be case nsensatiVe. \nShotJd be siet to 2 If I/OU are USi'lo a case~tive file svstem. \nConfigurabon File: C:V'r09f'Ml{)ata'f,tySQI. 'MySQL Servi!!' 8,0'vny.lnl \n~I \nm_ysq_ld __ \n...,~I._ Otsc;yd \nSQL Edrtor do,;ed \nDescription \n• \nWhen MySQL starts, it reads the server configuration file and uses it to set system \nvariables. \n• \nTo use MySQL Workbench to change the server configuration file, select the \nServer➔Options File item. Or, select the Options File item from the Adminisn·ation \ntab of the Na vi gator window. Then, click an appropriate tab and use it to change \noptions. Fi11ally, click the Apply button to write the changes to the configuration \nfile. \n• \nTo use MySQL Workbench to change the server configuration file, you may need to \nrun it as an administrator. To do that on a Windows system, you can right-click the \nMySQL Workbench icon and then select the ''Run as administrator'' or ''Open as \nad1ninistrator'' command. \n• \nTo use MySQL Workbench to change the server configuration file, you may need to \nedit your connection so it points to the correct configuration file. To do that, open \nthe connection, display the Navigator window, click the wrench icon to the right of \nthe Instance category, and use the Configuration File option to select the correct file. \n• \nOn macOS, the configuration file isn't created when you install MySQL. Instead, \nit is created when you use Workbench to apply changes to the default system \nvariables. It's often stored in the /private/etc directory with a name of my.en£. \n• \nThe MySQL server only reads the configuration file when it starts. As a resul~ your \nchanges won't go into effect until you restart the server. \nFigure 17-7 \nHow to set system variables using MySQL Workbench \n\" \nV\n\n508 \nSection 5 \nDatabase administration \nInstead, Workbench creates this file only after you use the Options File window \nto apply changes to the configuration file. \nHow to set system variables using a text editor \nAnother way to set system variables is to t1se a text editor to edit the \nconfiguration file directly. On Windows, the configuration file is named \nmy.ini and is typically stored in MySQL's data or base directory. On \nmacOS or Unix/Linux, this file is named my.cnf and is typically stored in \nthe /private/etc or /etc directory. \nFigure 17-8 shows an excerpt from a typical configuration file for a \nWindows system. Here, I have stripped out the settings for the MySQL clients, \nand I have stripped out most comments. This makes it easy to see the system \nvariables that are set in a typical MySQL configuration file. \nTo start, the first line of the configuration file specifies that the following \nsystem variables apply to the mysqld program. In the first group of variables, \nthe port variable sets the port to 3306. Then, the basedir and datadir variables set \nMySQL' s base and data directories. These directories are typical for a Windows \nsystem. Next, the character-set-server and default-storage-engine variables set \nthe default character set and storage engine for tb.e server. Notice that the names \nof these variables use dashes instead of underscores. This is acceptable only \nwhen you enter a variable nan1e in a configuration file. Because of that, I prefer \nto use underscores. \nThe second group of variables begins with a comment that indicates that \nthese variables only apply to MyISAM tables. This shows that you can code a \ncomment by using a pound sign (#) to start the line. In addition, the variable \nvalues show that you can use a suffix to specify a number of bytes (K for \nkilobytes, M for megabytes, or G for gigabytes). \nThe third group of variables also begins with a comment. This comment \nindicates that these variables only apply to InnoDB tables. \nAs you 1·eview the settings for these variables, you should know that MySQL \nprovides over 300 system variables. However, MySQL provides default values \nfor these system variables. As a result, the configuration file only needs to \noverride the system variables when you want to change the default value that's \nprovided by MySQL. To learn more about these system variables, you can look \nup ''Server System Variables'' in the MySQL Reference Manual. This provides \na complete list of all system variables, along with detailed descriptions of each \nvariable. \nAlthough we don't show you how to start the MySQL server from a \ncommand line in this book, you should know that you can do that. When you do, \nyou can code system variables on the command line by preceding the variable \nname with two dashes like this: \n--po r t =3307 \nSo if you see system variables listed like this in the MySQL Reference Manual, \nyou'll know that it's showing you how to code them on the command line.\n\nChapter 17 \nAn. introduction to database administration \n509 \nPart of a configuration file for Windows \n[mysqld] \nport=3306 \nbasedir=\"C:/Program Files/MySQL/MySQL Server 8.0/\" \ndatadir=C:/ProgramData/MySQL/MySQL Server 8.0/Data \ncharacter-set-server=utf8mb4 \ndefault- storage-engine=INNODB \ndefault_authentication_plugin=caching_ sha2_password \nsql-mode=\"STRICT_ TRANS_ TABLES,NO_ ENGINE_ SUBSTITUTION\" \nlog-output=FILE \ngeneral-log=O \ngeneral_log_ file=\"JOEL-PC.log\" \nslow-query-log=l \nslow_query_log_file=\"JOEL-PC-slow.log\" \nlong_query_ time=lO \nlog-bin=\"JOEL-PC-bin\" \nlog-error=\"JOEL-PC.err\" \nserver-id=l \nlower_case_table_names=l \nsecure-file-priv=\"C:/ProgramData/MySQL/MySQL Server 8.0/Uploads\" \nmax_connections=151 \ntable_open_cache=2000 \ntmp_table_ size=35M \nthread_cache size=10 \n#*** MyISAM Specific options \nmyisam_max_ sort_ file_size=lOOG \nmyisam_ sort_buffer_ size=62M \nkey_buffer_size=8M \nread_buffer_ size=64K \nread_ rnd_buffer_ size=256K \n#*** INNODB Specific options*** \ninnodb_ flush_ log_at_trx_commit=l \ninnodb_ log_buffer_ size=lM \ninnodb_buffer_pool_ size=8M \ninnodb_ log_ file_ size=48M \ninnodb_ thread_ concurrency=9 \nDescription \n• \nTo edit the configuration file directly, use a text editor. This file is named my.ini \n(Windows) or my.cnf (macOS or Unix/Linux). \n• \nWith Windows, you may need to start your text editor as an administrator. To do \nthat, yot1 can right-click the icon that starts your text editor and then select the ''Run \nas administrator'' or ''Open as administrator'' command. \n• \nWith macOS, you may need to use Finder to give yourself permission to read and \nwrite the my.cnf file with a text editor. To do that, go to the /private/etc directory, \nCtrl-click on the my.cnf file, select the Get Info item, click the lock icon, and \nmodify the per1nissions. When you're done editing the file, revoke your write \n• \n• \npefffilSSlOil. \n• \nWhen specifying a number of bytes, you can add a suffix to a number to specify \nkilobytes (K), megabytes (M), or gigabytes (G). \nFigure 17-8 \nHow to set system variables using a text editor\n\n51 0 \nSection 5 \nDatabase administration \nHow to set system variables \nusing the SET statement \nIn the previous two figures, you learned how to edit the configuration file \nso changes to the system variables are stored permanently and read by MySQL \nwhen the server starts. Now, figure 17-9 shows how to use the SET statement to \nset system variables dynamically. When you use this approach, you don't need \nto restart the server for the changes to take effect. As a result, you can use this \napproach to experiment with different values for system variables. Then, if you \nwant to make these changes permanent, you can add the1n to the configuration \nfile as described in the previous two figures. \nWhen you use the SET statement to set system variables, you can set most \nof them at either the global level or the session level. When you set variables at \nthe global level, any new connections start with these settings. Then, you can \nover1ide these settings for the session if you need to. However, some variables \ncan only be set at the global level. \nThe first example in this figure uses a SET statement with the GLOBAL \nkeyword to set the variable named autocommit at the global level. This statement \nsets this variable to a value of ON, which is a synonym for 1. Then, the second \nexample uses the SESSION keyword to set this variable at the session level to \na value of OFF, which is a synonym for 0. If you don't specify the GLOBAL or \nSESSION keyword, MySQL always attempts to set the session variable. As a \nresult, the SESSION keyword is optional for setting session variables. \nWhen specifying the valt1e of a system variable, you can use the DEFAULT \nkeyword to specify the default value that's compiled into MySQL. For instance, \nthe third example sets the autocommit variable to its default value. \nThe fourth and fifth examples show how to set the max_connections \nvariable. This variable specifies the maximum number of connections for the \nserver, not the session. As a result, it can only be set at the global level. \nWhen specifying a value that's a number of bytes, you can't use suffixes \nlike you can in a configuration file. However, you cai1 specify the nu1nber of \nbytes as shown in the sixth example or use an expression as shown in the seventh \nexa1nple. Both of these examples specify a value of 35 megabytes. \nAfter you set a system variable, it's often helpful to be able to view it to \nmake sure it's set correctly. To get the value of a system vaiiable, you code two \nat signs (@ @), the GLOBAL or SESSION keyword, a period, and the name of \nthe variable in a SELECT statement as shown in the next to last example. If you \ndon't specify the GLOBAL or SESSION keyword, MySQL returns the session \nvalue if it exists as shown in the last example. Otherwise, it returns the global \nvalue.\n\nChapter 17 \nAn. introduction to database administration \n511 \nThe syntax for setting system variables \nGlobal variables \nSET GLOBAL var_name = var_ value; \nSession variables \nSET [SESSION] var_name = var_value; \nExamples that set system variables \nSET GLOBAL \nautocommit = ON; \nSET SESSION autocommit = OFF; \nSET GLOBAL \nautocommit = DEFAULT; \nSET GLOBAL \nSET GLOBAL \nmax_ connections = 90; \n• \nmax connections= DEFAULT; \nSET GLOBAL \nSET GLOBAL \nt .mp_ table_ size = 36700160; \ntmp_ table_ size = 35 * 1024 * 1024; \nThe syntax for getting system variables \nGlobal variables \n@@GLOBAL.var_name \nSession variables \n@@[SESSION.]var_name \nExamples that get system variables \nGet the global and session values of a variable \nSELECT @@GLOBAL.autoconnnit, @@SESSION.autocommit \n@@global. autocommit \n@@session. autocommit \n,-\n► \n1 \n0 \n• \nGet the session value if it exists or the global value if it doesn't \nSELECT @@autocommit \n@@autocommit \n► \n0 \nDescription \n• \nYou can use the SET statement to set the values of system variables dynamically. \n• If you don't specify the GLOBAL or SESSION keywords when setting the value of \na system variable, MySQL always attempts to set the session variable. \n• If you don't specify the GLOBAL or SESSION keywords when getting the value \nof a system variable, MySQL returns the session value if it exists. Otherwise, it \nreturns the global value. \n• \nThe LOCAL keyword is a synonym for the SESSION keyword. \n• \nYou can use the DEFAULT keyword to set the value of a variable to the default \nvalue that's compiled into MySQL. \n• \nWhen specifying a number of bytes, you can't use suffixes (K, M , G), but you can \n• \nuse expressions. \nFigure 17-9 \nHow to set system variables using the SET statement\n\n512 \nSection 5 \nDatabase administration \nHow to work with logging \nEarlier in this chapter, you learned about the types of logs that the MySQL \nserver can create. If these logs aren't enabled on your system, you can enable \none or more of them. Then, you can configure them so they work the way you \nwant, and you can view them whenever necessary. Finally, if you use logs, you \nneed to manage them so they don't consume too much disk space. \nHow to enable and disable logging \nWhen you enable a log, the server does extra work to write data to the log. In \naddition, the log takes extra disk space. Finally, since logs can contain sensitive \ndata, they can compromise the security of your data if you don't secure the files \nproperly. As a result, you shouldn't enable a log unless you have a good reason \nto do so, and you should disable any logs you don't use. \nHowever, logs can also provide useful information. For example, the general \nquery log can help you monitor the server. The error log can help you fmd and \nfix errors. The binary log can help you restore data. And the slow query log can \nhelp you optimize a database. So, if you need help with any of these tasks, you \ncan enable the appropriate log if it isn't already enabled. \nFigure 17-10 shows how to enable logging. To start, it shows how to use \nMySQL Workbench to modify the configuration file. Here, the options in the \nLogging tab enable the general and error logs. Although you can't see all of the \noptions here, you can use this tab to set all of the Jogging options described in \nthis figure. \nIn addition to enabling the logs, these options allow you to specify a \ndirectory and name for the log file. If you don't specify a name, MySQL uses \nthe default names specified in this figure, which include the name of the host \nmachine. Similarly, if you don't specify a directory, MySQL stores the log files \nin its data directory. \nIf you want to edit the configuration file to set the logging options, you can \ndo that too. In this figure, for instance, the code example shows how to set all six \noptions. Here, the first line enables the general log, and the second line speci-\nfies a name and directory for its log file. The third line enables the error log and \nspecifies a name and directory for its log file. The fourth line enables the binary \nlog and specifies a name and directory for its files. And the last two lines enable \nthe slow query log and specify a name and directory for its log file. Note that \nthis code works on a Windows, macOS, or Unix/Linux system. Although you \ntypically use backslashes for Windows, front slashes work as well. So, whenever \nit makes sense, we've used front slashes in this book. \nSo, when would you want to store a log file in a directory other than the \ndefault directory (the data directory)? Typically, you'd want to do that if you're \nusing binary log ftles to incrementally back up your data. Then, you can store the \nlog files on a drive other than the drive that's running the MySQL server. That \nway, if the drive that the server is running on fails, you can still access the binary \nfiles and restore the server.\n\nChapter 17 \nAn. introduction to database administration \n513 \nServer configuration options for log files \nMySQl. Workbench \n6 \nLoc:al msliml:1! MySQL80 X \nFile \nEdit \nVrtN: \nQuay \nDalilbase \nSBver \nTools \nSc:np6ng \nHelp \nQuery l \noJ \nAdministration - Options File x \nlocal Instance MySQUlO \nOptions File \nGeom) LOQOnO lmcOB Net.worlang Advana-d Other \nSeax1ty Repbbon MylSAM Perlormana \nD generalbJ \nEnaiill!lcJisableoe,enilog \nE2l general_log_file \nE2] iog-error \nD 1og~rn \n~ .. . 11g \nName of the general query log file \n[ ·ml ... \nEtror log file \nLog al My!SAM changes to file \nlocate oplion: ._I _ _ _ _ _ _ \n__, \nE2] 1og~tput \nlhe destriabon for general ~ \nlog and ,dew query log output \n0 log-queries-oot-using-nlexes \nlog queries that are executrd wlihout beiefit of arr, ndex 1P the slow query log tf it is open \nSystem variables for enabling logging \nVariable \nDescription \nD \nX \nmi \ngeneral_ log \nEnables the general log with a default name of HOST-\nNAME.log. \ngeneral_ log_ file=logn.arne \nlog_ error[=logname] \nlog_bin[=logname] \nslow_query_ log \nslow_ query_ log_file=logname \nSpecifies the name of the general log file. \nEnables the error log. If no name is specified, MySQL \nuses a name of HOSTNAME.err. \nEnables the binary log. If no name is specified, MySQL \nuses a name ofHOSTNAME-bin. SinceMySQL provides \nits own extensions (.index, .000001 , .000002, etc.) for the \nbinary log files, you don't need to specify an extension \nfor the log 11ame. \nEnables tl1e slow query log with a default name of \nHOSTNAME-slow.log. \nSpecifies the name of the sJow Jog fiJe_ \nLogging options set in the server configuration file \ngeneral_ log \ngeneral_ log_ file = \"/ rnurach/ mysql / general.log\" \nlog_ error = \n11 / rnurach/ mysql / error . log\" \nlog_bin = \"/ murach/ mysql / bin-log\" \nslow_query_ l og \nslow_ query_ log_file = \"/ murach/ mysql / slow.log\" \nDescription \n• \nLogs can help you monitor the database, find and fix errors, restore data, and optimize \nyour database. \n• \nLog files can take a significant amount of disk space, and logging can compromise \nthe security of yow· data if you don't secure the log files properly. \n• \nIf you don't specify a directory for a log file, the file is stored in MySQL's data directory. \nFigure 17-1 0 \nHow to enable and disable logging\n\n514 \nSection 5 \nDatabase administration \nTo specify a drive on a Windows system, you just code the drive letter at the \nbeginning of the path like this: \nlog_bin=\"c:/murach/mysql/bin-log\" \nTo specify a drive on a Unix/Linux system, you code the Volumes directory and \nthe name of the drive at the beginning of the path like this: \nlog_bin=\"volumes/archive/murach/mysql/bin-log\" \nIn this example, Archive is the name of the drive. \nUnfortunately, you can't specify a directory for the binary log on a macOS \nsystem. If you attempt to do that, the server won't start. As a result, if you're \nusing macOS, you must store your binary log files in the default directory. \nHow to configure logging \nIf logging is enabled, you can configure it so it works the way yot1 want. \nTo do that, you can use any of the techniques shown in this chapter for setting \nsystem variables. Figure 17-11 summarizes some of the most commonly used \nsystem variables for co11figuring logging. \nThe configuration file in this figure shows some examples of how to set \nthese options. To start, the log_output example sends the output of the general \nand slow query logs to tables instead of to files. This causes these logs to be \nwritten to the General_Log and Slow _Log tables of the database named mysql. \nThat way, you can use SELECT statements to view the data that's written to \nthese logs. In addition, you can use events to automatically manage these tables \nas shown in figure 17-13. \nThe log_error_ verbosity example sets the level of warnings that are logged \nabout connections to the highest level (3). As a result, the server logs errors, \nwarnings, and infor111ational messages. This variable became available with \nMySQL 5.7. Previous releases of MySQL used the log_warnings variable to \ndetermine what was written to the error log. \nThe expire_logs_days example deletes binary log files that are more than \nseven days old. This setting is appropriate if you back up your database once a \nweek. That way, if you need to restore your database, you can use the database \nbackup to restore it to somewhere within seven days of the current date. Then, \nyou can use the binary log to apply any changes that have been made since that \nbackup. To do that, you can use the skills described in chapter 19. \nThe max_binlog_size example sets the maximum size of the binary log file \nto one megabyte. As a result, when the server reaches this limit, it starts a new \nbinary log file with a new number. However, if MySQL is logging a transac-\ntion when it reaches the limit, it finishes the transaction before starting a new \nfile. So, the bina1-y log files may be slightly larger than the size indicated by the \nmax_binlog_size setting. \nThe long_query_time example causes the server to write queries to the slow \nquery log if they take longer than five seconds. By default, this value is set to ten \nseconds, but you can set it to a lower value if you want to include queries that \ntake a shorter time to run. Conversely, you can set it to a higher value if you only \nwant to include queries that take a lo11ger time to run.\n\n516 \nSection 5 \nDatabase administration \nHow to view text-based logs \nBy default, the general, error, and slow query logs are stored in text files. \nAs a result, you can use any text editor to open and view them. Or, you can use \nMySQL Workbench to view them. To do that, select the Server Logs item, and \nclick on the tab for the log you want to view. In figure 17-12, for example, the \nerror log is opened in Workbench. Here, the error log shows some messages that \nthe server logs when it starts and stops. In addition, this Server Logs window \ncontains a tab for the slow query log file, since this log is enabled. However, it \ndoesn't include a tab for the general query log, since this log isn't enabled. \nIf you configure your system so it stores the general and slow query logs \nin tables as shown in the previous figure, you can use MySQL Workbench to \nview these tables, just as you would use it to view a log file. In addition, you \ncan use a SELECT statement to view them . In this figure, for example, the first \nSELECT statement selects all rows from the General_Log table that's stored in \nthe database named mysql. Of course, if you wanted to, you could easily modify \nthis SELECT statement so it uses the event_time column to display just the most \nrecent rows of this table. \nNotice that this SELECT statement also includes a column that displays the \ntext in the argument column. To do that, it converts this column to the CHAR \ndata type. That's necessary with MySQL 5.7 and later because the argument \ncolumn is a BLOB type. \nThe second SELECT statement selects all rows from the Slow _Log table of \nthe mysql database. In this figure, this SELECT statement doesn't retrieve any \nrows because no queries have run slowly enough. As a result, the server hasn't \ninserted any rows into the table. If the se1-ver had written rows to this table, you \ncould use the data in each row to help determine why the query is running so \nslowly.\n\nChapter 17 \nAn. introduction to database administration \nThe error log displayed in MySQL Workbench \n■ \nMySQI. Workbench \nD \nX \nA \nLocal 1Mtance MySOLBO >< \nFile \nEdit \nVi-\nQuery \nDatabase \nServer \nTools \nScripting \nHelp \nl¼\n1\n::\n1\ni1ifi'sl1·':¥1thii-i·}\"\"l~-------------------------------\nA \nLocal instance MySQl.80 \nServer Logs \nE'rr~log~ Slow Log File \nQ All \nO lnnoOB \nTlmestarrc> \nThread \n2018· l 1--06Tl8:S8:44 \n0 \n2018· 11-06TI8;58:44 \n0 \n2018· 11-06T18:58:58 \n0 \n2018· 11·06T18:58:S8 \n0 \n2018· 11~06TI8:58:58 \n0 \n2018-11-08T20:42;05 \n0 \n2018·11-08T20:42!32 \n0 \n2018· 11--08T20:44:09 \n0 \n2018· 11--08120:44: U \n0 \n2018· 11-08120:'17: 16 \n0 \nType \nWarning) [MY-0. \nSystem] [MY·OL \nWarning) {MY--0. \nSystem) {MY--OL_ \nSystem} {MY·Ol. \nSyS\"tem) (MY·Ol._ \nSystem) [MY-0 L_ \nWarning) [MY--0 ... \n9;stem} (MY-Ot \nWarning} (MY--0 ... \n~~ \n~ \n'NO_ZERO_OATF, NO_ZBlO_IN_OATE' and 'EAAOR_FOR_DMSION_BY_ZERO' sql modes shou. .. \nC:\\Program RlesV,,ySQL\\MySQL Server8.0\\bln\\mysqld.exe (mysqld 8.0.13) starting as process \nL \nCA cert1fiate ca.pem ls self signed. \nC:\\Program FilesV,,ySQL\\MySQl Server S.O\\b111\\mysqld.exe: recady for connections. Version: '8.0 .... \nX Plugfn ready for connections. Bind-address: '::'port: 33060 \nC:\\Program Rles\\MySQL\\MySQL Server 8.0\\brn\\mysqld.exe: Normal shutdovm. \nC:\\Program Files\\MySQL\\MySQL Serrer 8.0\\bin\\mysqld.exe: Shutdown complete (mysqld 8.0.13 .. \n'NO_ZERO_OATE', 'NO_ZERO_IN_OATc aod 'EAAOR_FOR_OIVISION_BY_ZERO' sq! modes shou. .. \nC:\\Prooram Files\\MySQL\\MYSQL Server8.0\\bm\\mysqld.exe (mysqld 8.0.13) rtartlng 1s process \nCA certiflcate ca.pem ts self signed. \nHow to view the log files when they are written to tables \nThe general log \nSELECT*, CHAR(argument) AS argument_text FROM mysql.general_ log \nevent_time \nuser_host \nthread_id \nserver _id \ncommand_ type \nargument \nargument_text \n2019-01-10 11:47:25.763313 \n[root] @localhost [:: 1] \n15 \n1 \nComect \n■ , • •\n• \nroot@Coailhost on using SSL/TlS \n2019-01-10 11:47:25. 764300 \nroot[root} @localhost [:: 1] \n15 \n1 \nQuery \nI !51 I \nset autocommit= 1 \n2019-01-10 U;47:25.76'1623 \nroot[root] @localhost [::1) \n15 \n1 \nQuery \n111 l I \nSET SESSION TRANSACTION ISO .. , \n2019-01-10 11;47:25.76~18 \nroot[root] @localhost [:: 1} \n15 \n1 \nQuery \nI !I JI \nSHOW SESSION VARIABLES LIKE. .• \nThe slow query log \nSELECT* FROM mysql.slow_ log \nv \nstart_time \nuser _host \nquery _time \nlock_lime \nrows_sent \nrows_examined \ndb \nlast_insert_id \ninsert_id \nserver _id \nsql_text \nthread_id \nDescription \n• \nBy default, the general, error, and slow query logs are stored in text files. As a \nresult, you can use any text editor to open them and view them. \n• \nYou can also use MySQL Workbench to view logs. To do that, select the \nServer➔ Server Logs item from the menu system. Or, select the Server Logs item \nfrom the Administration tab of the Navigator window. Then, click the tab for the \nlog file. \n• \nIf you configure your system so it stores the general and slow query logs in tables, \nyou can use MySQL Workbench to view these tables, just as you would use it to \nview a log file. In addition, you can use a SELECT statement to view them. \nFigure 17-12 \nHow to view the text-based logs \n517\n\n518 \nSection 5 \nDatabase administration \nHow to manage logs \nSince logs can use a large amount of disk space, you should disable any \nlogs that you don't need. For example, since the general log contains all queries \nthat are sent to the server, it can quickly grow to be very large. As a result, it's \ncommon to disable the general log. Then, if you want to monitor all queries sent \nto the server, you can temporarily enable this log. Similarly, when you 're done \noptimizing the queries on your server, you may want to disable the slow query \nlog. \nOn the other hand, it's usually a good idea to keep the error log enabled \nsince it contains useful information that can help you troubleshoot problems with \nthe server. In addition, if you're using the binary log to provide for incremental \npoint-in-time recovery, you can't disable it. \nIf you enable any logs, you need to manage them so they don't consume too \nmuch disk space. For the text-based logs (general, error, and slow query), you \ncan use the log rotation strategy described in figure 17-13. With this strategy, \nyou delete any old log files. Then, you rename the current log file. When you do, \nMySQL server starts a new en·or log file. \nFor example, let's say you have an old error log named error.old and the \ncurrent error log is named error.log. In that case, you can start by deleting the \nfile named error.old. Then, you can rename the current error log (error.log) to \nerror.old. When you do, MySQL starts a new error log named error.log. As a \nresult, you never have more than two error logs on your server at a time. \nTo get started, yot1 can manage logs by manually deleting and renaming \nfiles. Later, you can automate your log management. For example, you \ncan create a batch file for a Windows system or a bash file for a macOS \nor Unix/Linux system. You can also create a timer to execute these files \nat regular intervals. Since the details for doing this vary depending on the \noperating system, I won't describe the process here. \nIf you store the general log and the slow query logs in a table, you can use \nSQL statements to rotate the log tables. You can also create an event that rotates \nthe log tables at a specified interval. For exan1ple, this figure shows an event that \nrotates the general log table once every month. \nTo start, the DROP TABLE statement drops tl1e table named \ngeneral_log_old if it exists. Then, the CREATE TABLE statement creates a \ntable named general_log_old that has the same structure and data as the table \nnamed general_log. Finally, the TRUNCATE statement deletes all rows from \nthe general_log table. As a result, the general_log_old table now contains the \nlog 1·ows from the previous month, and the general_log table is en1pty and ready \nto store the log rows for the current month. Here, you must use a TRUNCATE \nstatement instead of a DELETE statement because the DELETE statement \ndoesn't work with the general_log table. \nSince the binary log uses an index file to keep track of its numbered binary \nfiles, you can't just delete the old binary files that you no longer want. However, \nyou can use the expire_logs_days system variable that was described in figure \n17-11 to delete old binary logs after the specified number of days. This deletes \nthe old binary files and updates the index file.\n\nChapter 17 \nAn. introduction to database administration \n519 \nStrategies for managing logs \nStrategy \nDescription \nLog rotation \nAge-based expiration \nApplies Lo text-based logs (general, error, and slow query). \nTo rotate logs, you can save the cun·ent log file under a new \nname and let the server create a new log file. Then, you can \ndelete any old log files when they're no longer needed. If \nnecessary, you can create a series of numbered logs. \nApplies to the binary log. For this log, you can use the \nexpire_logs_days system variable sl1own ia figure 17-1 l to \ndelete tbe old binary Jogs after the specified number of days. \nAn event that rotates the general log every month \nUSE mysql ; \nDELI MITER // \nCREATE EVENT general_log_ rotate \nON SCHEDULE EVERY 1 MONTH \nDO BEGIN \nDROP TABLE IF EXISTS general_ l og_ old; \nCREATE TABLE general_ l og_ old AS \nSELECT* \nFROM general_ l og ; \nTRUNCATE gene ral_ log; \nEND// \nDescription \n• \nIt's generally considered a good practice to disable any logs that you don't need. \n• \nYou can manually manage the text-based log files (general, error, and slow query) by \ndeleting and renaming log files. \n• \nYou can automatically manage text-based log files (general, error, and slow query) \nby creating batch files (Windows) or bash files (macOS or Unix/Linux) that run on a \nspecified schedule. \n• If you send the output of the general and slow query logs to a table, you can create \nan event that uses SQL statements to manage the log tables. \n• \nYou can't just delete files from the binary or relay log, since an index is used to keep \ntrack of the files in these logs. However, you can set the expire_logs_days system \nvariable to delete files from the binary log after a specified number of days. \nFigure 17-1 3 \nHow to manage logs\n\n520 \nSection 5 \nDatabase administration \nPerspective \nIn this chapter, you were introduced to the responsibilities of a database \nadministrator. In addition, you learned how to perform some of these respon-\nsibilities. For example, you learned how to monitor the server, configure the \nserver, and work with log files. \nIn the next two chapters, you'll learn how to perform two more critical \nresponsibilities of a DBA. First, in chapter 18, you'll learn how to secure \na database. Then, in chapter 19, you'll learn how to backup and restore a \ndatabase. \nAlthough this isn't everything a DBA needs to know, this is enough to \nget started with the administration of many types of databases. In addition, \nit provides the background that you need for learning more about database \nadministration on your own. \nTerms \ndatabase administrator (DBA) \ndatabase replication \nmaster \nslave \nconfiguration ftle \ndata file \nlog ftle \ngeneral log \nerror log \nExercises \nslow query log \nbinary log \nrelay log \nprocess \nmysqld program \nMySQL daemon \nstatus variable \nsystem variable \n1. \nStart MySQL Workbench and open the Client Connections window. If the \nprocess list isn't displayed, click on the Refresh button in the lower right \ncorner to display it. Review the list to see that it includes two processes for \nthe current database. Then, return to the Home tab, open another connection \nfor the root user, and select a different database as the current database. Next, \nreturn to the Client Connections window to see that it includes two additional \nprocesses for the new connection. \n2. \nUse Workbench's Server Variables window to view these status variables: \nconnections, threads_connected, bytes_received, and bytes_sent. Read the \ndescriptions for these variables to get an idea of what they do. \n3. \nUse Workbench's Se1-ver Variables window to view the system variables \nnamed basedir and datadir. Note the paths to these di1·ectories. Then, view \nthe system variables named log_error and log_bin. Note whether the log_bin \nvariable is set to a value of ON or OFF and whether the log_error variable is \nset to the name of an error log, indicating that it is on.\n\nChapter 17 \nAn. introduction to database administration \n521 \n4. \nUse the Explorer (Windows) or the Finder (macOS) to view MySQL's data \ndirectory. To do that, you may have to modify your operating system settings \nso you can see hidden directories and files. With macOS, you may also need \nto change the permissions for the directory to give yourself the read privilege. \nNote that the subdirectories of the data directory correspond to the databases \nthat are running on yo11r system. If the data dil·ectory contains any log files, \nnote the names of these files. \n5. \nView the files in the AP subdirectory and note how the names of the files \ncorrespond with the tables of this database. To do this on a Mac, you may \nneed to change the permissions for the directory to give yourself the read \nprivilege for the directory. \n6. \nUse Workbench's Options File window to enable the e1Tor log and the binary \nlog, if they aren't already enabled. Use whatever directories and names you \nwant for the logs. If you get an error indicating that access is denied, you may \nneed to stop Workbench and run it as an administrator. After you enable these \nlogs, restart the server. \n7. \nUse the Explorer (Windows) or the Finder (macOS) to find MySQL's configu-\nration file. Note the directory and name of this file on your computer. \n8. \nUse Workbench's Server Logs wiI1dow to view the en·or log. Note that it \nincludes messages about the startup and shutdown of the server. \n9. \nWrite and execute an INSERT statement that inserts a new row into the \nInvoices table. \n10. Use a SET statement to temporarily enable the general log. Then, to make \nsure that this variable was set, use a SELECT statement to view the variable. \nIf you get an error indicating that access is denied, you may need to stop \nWorkbench and run it as an administrator. \n11. Use a SELECT statement to select all rows from the Invoices table. \n12. Use Workbench's Server Logs window to view the general log, and click \non the Refresh button. Note that it includes the SELECT statement from the \nprevious step. \n13. Use a SET statement to disable the general log. Then, to make sure that this \nvariable was set, use a SELECT statement to view the variable.\n\nHow to secure a database \nIf you have installed MySQL on your own computer and you have only been \nworking with sample databases, security hasn't been much of a concern. \nHowever, when you use MySQL in a production environment, you must \nconfigure security to prevent misuse of your data. In this chapter, you' 11 \nlearn how to do that by writing SQL statements to create use1·s that have \nrestricted access to your database. In addition, you'll learn how to use MySQL \nWorkbench to perform many of the security-related tasks that you can perform \nwith SQL code. \nAn introduction to user accounts ..................................... 524 \nAn introduction to SQL state1nents for user accou nts ................................. 524 \nA su1nmary of privileges ............................... H••······ .. ·····························••H.526 \nThe four privilege levels .............................................................................. 530 \nThe grant tables in the mysql database ........................................................ 530 \nHow to work with users and privileges ............................ 532 \nHow to create, rename, and drop users ....................................................... 532 \nHow to specify user account names ............................................................ 534 \nHow to grant privileges .................................................................................. 536 \nHow to view privileges ................................................................................ 538 \nHow to revoke privileges ............................................................................ 540 \nHow to change passwords ............................................................................ 542 \nA script that creates users ........................................................................... 544 \nHow to work with roles ...................................................... 546 \nHow to create, manage, and drop roles ...................................................... 546 \nA script that creates users and roles ............................................................ 550 \nHow to use MySQL Workbench ........................................ 552 \nHow to work with users at1d privileges ....................................................... 552 \nHow to connect as a user for testing ............................................................ 556 \nPerspective ......................................................................... 560\n\n524 \nSection 5 \nDatabase administration \nAn introduction to user accounts \nBefore you leain the details of managing database security, you should have \na general idea of how user accounts work. That's what you'll learn in this topic. \nAn introduction to SQL statements \nfor user accounts \nFigure 18-1 presents a script that contains the SQL statements that are used \nto create two users and grant them privileges. You'll learn more about how the \nstatements in this script work later in this chapter. For now, we just want to \nintroduce you to the concepts of users and privileges. \nThis script starts with CREATE USER statements that create two users, \nnamed ap_admin and ap_user. Both users can only connect from the local server, \nand both have a password of ''pa55word''. Although this password isn't realistic, \nit illustrates how these statements work. \nAfter the users are created, the GRANT statements set up privileges for \neach user. Here, the user named ap_admin is granted all the privileges on the AP \ndatabase. As a result, this user can select, insert, update, and delete data from the \ntables of the AP database. In addition, this user has many other privileges such as \ncreating or dropping tables, indexes, and views in the AP database. By contrast, \nthe user named ap_user can only select, insert, update, and delete data in the AP \ndatabase. \nIf you want to view tl1e privileges for a user, you can use the SHOW \nGRANTS statement. In this figure, for example, you can see the privileges for \nthe user named ap_admin.\n\nChapter 18 \nHow to secure a database \n525 \nA script that creates two users and grants them privileges \nCREATE USER ap_ admin@loc alhost IDENTIFIED BY 'password'; \nCREATE USER ap_user@localhost IDENTIFIED BY 'password'; \nGRANT ALL \nON ap.* \nTO ap_ admin@localhost; \nGRANT SELECT, INSERT, UPDATE, DELETE \nON ap.* \nTO ap_user@localhost; \nA statement that displays the privileges for the ap_admin user \nSHOW GRANTS FOR ap_admin@localhost \nGrants for ap_admin@foc.alhost \n-\n► \nGRANT USAGE ON •.•TO • ap _admin' @· locaU,~t. \nGRANT ALL PRIVILEGES ON 'ap . . • TO 'ap _admn. @· localhost. \nDescription \n• \nYou use the CREATE USER statement to create a user that has no privileges. \n• \nYou use the GRANT statement to grant p1ivileges to a user. \n• \nYou use the SHOW GRANTS statement to view the privileges for a user. \n• \nFor a partial list of privileges that can be granted, see figure 18-2. \nFigure 18-1 \nAn introduction to SQL statements for user accounts\n\n526 \nSection 5 \nDatabase administration \nA summary of privileges \nFigure 18-2 summarizes some of the common privileges that a database user \ncan have. To strut, a user can have privileges to work with the data that's stored \nin a database. These privileges allow a user to execute DML statements, such \nas the SELECT, UPDATE, INSERT, and DELETE statements. They also allow \na user to execute stored procedures and functions. These are the most common \ntypes of privileges, since most users need to be able to work with the data that's \nstored in a database. \nA user can also have privileges to modify the definition of a database. These \nprivileges allow a user to execute DDL statements such as the CREATE TABLE, \nALTER TABLE, DROP TABLE, CREATE INDEX, and DROP INDEX state-\nments. These privileges are common for administrative users of a database such \nas database administrators and programmers, but they aren't commonly granted \nto the end users of a database. \nIn addition, a user can have privileges to work with the stored programs of a \ndatabase. These privileges allow a user to execute the statements that you learned \nabout in chapters 15 and 16. For example, the CREATE ROUTINE privilege \nallows a user to execute the CREATE PROCEDURE and CREATE FUNCTION \nstatements.\n\nPrivileges for working with data \nPrivilege \nDescription \nSELECT \nINSERT \nUPDATE \nDELETE \nEXECUTE \nSelect data from a table. \nInsert data into a table. \nUpdate data in a table. \nDelete data from a table. \nExecute a stored procedure or function. \nChapter 18 \nHow to secure a database \n527 \nPrivileges for modifying the database structure \nPrivilege \nDescription \nCREATE \nALTER \nDROP \nINDEX \nCREATE VI EWS \nCREATE ROUTINE \nALTER ROUTINE \nTRIGGER \nEVENT \nDescription \nCreate a database or a table. \nAlter a table. \nDrop a database or a table. \nCreate or drop an index. \nCreate views. \nCreate a stored procedure or function. \nAlter or drop a stored procedure or function. \nCreate or drop a trigger on a table. \nCreate, alter, drop, or view an event for a database. \n• \nThe privileges a user has to work with a database control the operations that the \nuser can perfonn on the database. \n• \nPrivileges for working with the data in a database are typically given to all users of \nthe database, include end users. \n• \nP1ivileges for modifying the structure of a database are typically given to database \nadministrators and programmers. \nFigure 18-2 \nA summary of privileges (part 1 of 2)\n\n528 \nSection 5 \nDatabase administration \nThe privileges you learned about in part 1 of figure 18-2 are called object \nprivileges because they allow the user to create and work with database objects, \nsuch as tables, views, and stored procedures. The exact privileges that are avail-\nable for an object depend on the type of object. In contrast to object privileges, \nadministrative privileges allow the user to create new user accounts and roles, \nshow the databases available from the server, shut down the server, and reload \nthe tables that store the privileges for users. These privileges are listed in the first \ntable in part 2 of this figure. \nThe second table lists some other privileges you '11 use frequently. The ALL \nprivilege grants all privileges available at the specified level except the GRANT \nOPTION privilege. In general, you only grant the ALL privilege to users like \ndatabase administrators or programmers. In some cases, you may also want \nto grant these users the GRANT OPTION privilege. If yot1 do, they can grant \nprivileges to other t1sers. \nThe USAGE privilege doesn't grant any privileges to a user. In most cases, \nyou'll use this privilege when you want to give a user the ability to grai1t privi-\nleges to other users. In that case, this privilege indicates that the existing privi-\nleges for the user shouldn't be changed. You' 11 see an example of how this works \nlater in this chapter. \nBefore you go on, you should know that MySQL provides many privileges \nother than the ones shown here. As a result, if the privileges presented in this \nchapter aren't adequate for your security needs, you can refer to the MySQL \nReference Manual for more information. To get started, you can search for \n''privileges provided'' or ''privileges''. You can also use the SHOW PRIVILEGES \nstatement to view a list of all the privileges that are available.\n\nChapter 18 \nHow to secure a database \n529 \nAdministrative privileges \nPrivilege \nDescription \nCREATE USER \nCREATE ROLE \nRELOAD \nSHOW DATABASES \nSHUTDOWN \nOther privileges \nCreate new user accounts. \nCreate a new role. \nReload the tables that store the privileges for the users of the \ndatabase. This refreshes these tables if they have been modified. \nShow the names of all databases on the server. \nShut down the server. \nPrivilege \nDescription \nALL [PRIVILEGES] \nGRANT OPTION \nUSAGE \nDescription \nAll privileges available at the specified level except the \nGRANT OPTION privilege. \nAllows a user to grant his or her privjleges to other users. \nNo privileges. It can be t1sed to modify existing accounts \nwithout changing the privileges for that account. \n• \nObject privileges allow the user to create and work with database objects such as \ntables, views, and stored procedures. The privileges that are available for an object \ndepend on the type of object. \n• \nAdministrative privileges allow the user to create users, grant privileges, and \nmanage operations on the server. They are not specific to a particular database. \n• \nTo see a list of available privileges and their definitions, use the SHOW \nPRIVILEGES statement. \nFigure 18-2 \nA summary of privileges (part 2 of 2)\n\n530 \nSection 5 \nDatabase administration \nThe four privilege levels \nTo understand how privileges work, you need to understand that MySQL \ngrants them at the four different levels shown in the first table in figure 18-3: \nglobal, database, table, and column. Global privileges provide a user access \nto all the tables in all the databases. Database privileges provide a user access \nto all tables in a specific database. Table privileges provide a user access to all \ncolumns on a specified table. And Column privileges provide a user access only \nto specific columns on specific tables. You'll see how to provide privileges at all \nthese levels when you see examples of the GRANT statement in figure 18-6. \nThe grant tables in the mysql database \nTo store user and privilege information, MySQL uses the grant tables in \nan internal database named 1nysql. The second table in figure 18-3 summarizes \nthese tables. To start, the table named User stores the usemames, passwords, and \nglobal privileges for all users on the server. Then, the table named DB stores \ninformation about the database privileges for each user. Finally, the last three \ntables store information about table privileges, column privileges, and privileges \nfor accessing stored procedures and functions. \nWhen you grant users access to the databases on a server, you typically \nwant to restrict all users other than administrative users from accessing the \nmysql database. That's because, if a user has access to the mysql database, he \nor she can change the user or privilege information directly. For example, the \nuser could insert a row into the User table to create a user with global privileges, \nor the user could change the privileges of other users. If you restrict access to \nadministrative users, though, this security risk is greatly reduced.\n\nThe four privilege levels \nLevel \nDescription \nGlobal \nDatabase \nTable \nColumn \nAll databases and alJ tables. \nAll tables in the specified database. \nAll columns in the specified table. \nOnly the specified column or coJumns. \nChapter 18 \nHow to secure a database \n531 \nA summary of the grant tables in the mysql database \nTable name \nDescription \nuser \ndb \ntables_priv \ncolwnns_priv \n• \nprocs_priv \nDescription \nStores the usemames and passwords for all users on the server. In addition, \nstores the global privileges that apply to all databases on the server. \nStores the database privileges. \nStores the table privileges. \nStores the column privileges. \nStores the privileges for accessing stored procedures and functions . \n• \nYou can use MySQL to grant privileges at four different levels, as shown in the first \ntable above. \n• \nMySQL stores all users for the server and their privileges in grant tables in an \ninternal database named mysql. \nFigure 18-3 \nMySOLs privilege levels and grant tables\n\n532 \nSection 5 \nDatabase administration \nHow to work with users and privileges \nNow that you have a basic understanding of users and privileges, you 're \nready to learn the details for working with users and privileges. This includes \ncreating and dropping users, granting and revoking privileges, a.nd changing the \npassword for an existing user. \nHow to create, rename, and drop users \nFigure 18-4 shows how to work with users. To start, when you use the \nCREATE USER statement, you typically specify the name of the user, followed \nby the @ sign, followed by the name of the host that the user can connect from. \nThis is usually followed by the IDENTIFIED BY clause, which specifies a \npassword for the user. If you omit this clause, no password is assigned, which \nisn't usually what you want. \nThe first example in this figure illustrates how this works. Here, the \nCREATE USER statement creates a user named joel that can connect from the \nhost named localhost with a password of ''sesame''. In other words, joel can only \nconnect from the same computer where MySQL server is running. \nIf you don't use the @ sign to specify a host, MySQL uses a percent sign \n(%) as the name of the host. This indicates that the user can connect from any \nhost. In the second example, for instance, the CREATE USER statement creates \na user named jane that can connect from any host with a password of ''sesame''. \nThis statement also includes the IF NOT EXISTS clause so the statement isn't \nexecuted if the user already exists. If the user does exist and this clause is \nincluded, a warning is generated instead of an error. That way, if the statement is \nincluded in a script, the script will continue executing instead of aborting. \nYou can also code the PASSWORD EXPIRE, PASSWORD HISTORY, and \nPASSWORD REUSE INTERVAL clauses on the CREATE USER statement. \nThe PASSWORD EXPIRE clause, which became available with MySQL 5.7, \nallows you to control how often a password needs to be changed. In the third \nexample in this figure, for instance, this clause causes the password to expire \nimmediately. As a result, the CREATE USER statement doesn't specify a \npasswo1·d because the user will have to change the password the next time she \nconnects. \nThe PASSWORD HISTORY and PASSWORD REUSE INTERVAL clauses \nbecame available with MySQL 8.0. The PASSWORD HISTORY clause allows \nyou to control how many of the most recent passwords can't be reused when \na user's password is changed. This is illustrated by the fourth example, wllich \nprevents the user from using the last five passwords. \nThe PASSWORD REUSE INTERVAL clause is similar to the PASSWORD \nHISTORY clause, except that it controls the number of days during which a user \ncan't reuse a previously used password. For instance, the fifth example specifies \nthat the user can't reuse a password for a year.\n\nChapter 18 \nHow to secure a database \n533 \nHow to create a user \nThe syntax of the CREATE USER statement \nCREATE USER [IF NOT EXISTS] username [IDENTIFIED BY password] \n[PASSWORD EXPIRE [DEFAULT INEVER IINTERVAL days DAY] I \nPASSWORD HISTORY {DEFAULT lnwnber_passwords} I \nPASSWORD REUSE INTERVAL {DEFAULT ldays DAY}] \nA statement that creates a user from a specific host \nCREATE USER joel@localhost IDENTIFIED BY 'sesame• \nA statement that creates a user from any host \nCREATE USER IF NOT EXISTS jane IDENTIFIED BY 'sesame• \n-- creates jane@% \nA statement that creates a user whose password expires immediately \nCREATE USER anne@localhost PASSWORD EXPIRE \nA statement that creates a user whose last five passwords can't be reused \nCREATE USER jim IDENTIFIED BY 'sesame' PASSWORD HISTORY 5 \nA statement that creates a user whose passwords can't be reused for 365 days \nCREATE USER john IDENTIFIED BY 'sesame' PASSWORD REUSE INTERVAL 365 DAY \nHow to rename a user \nThe syntax of the RENAME USER statement \nRENAME USER username TO new username \nA statement that renames a user from a specific host \nRENAME USER joel@localhost TO joelmurach@localhost \nHow to drop a user \nThe syntax of the DROP USER statement \nDROP USER [IF EXISTS] username \nA statement that drops a user from a specific host \nDROP USER joelmurach@localhost \nA statement that drops a user from any host \nDROP USER IF EXISTS jane \nDescription \n-- drops jane@% \n• \nYou use the CREATE USER statement to create a user that has no privileges. \n• \nWhen you code a username, you can specify the host that a user can connect from. \nFor more information, see figure 18-5. \n• \nThe PASSWORD EXPIRE clause determines how often the specified password \nneeds to be changed. If no option is coded, the password expires immediately. \n• \nThe PASSWORD HISTORY clause determines how many of the most recent \npasswords can't be reused. \n• \nThe PASSWORD REUSE INTERVAL clause deter1nines the number of days after \nwhich a previously used password can be used again. \n• \nYou can use the RENAME USER statement to change the name of a user. \n• \nYou can use the DROP USER statement to drop a user. \nFigure 18-4 \nHow to create, rename, and drop users\n\n534 \nSection 5 \nDatabase administration \nAfter you use the CREATE USER statement to create a user, the user has no \nprivileges. However, you can use the GRANT statement to assign privileges to \nthe user. You'll learn more about using this statement in figure 18-6. \nThe sixth example in figure 18-4 uses the RENAME USER statement to \nchange the name of the user namedjoel@localhost to joelmurach@localhost. If \nthis user has privileges, the privileges are transferred to the new name. \nThe last two examples use the DROP USER statement to drop the users \nnamedjoelmurach@localhost andjane@ %. These statements delete the user \naccounts and their privileges from the mysql database. Of these statements, \nthe second includes the IF EXISTS clause. That way, if the user doesn't exist, \nthe statement generates a warning instead of an error. This allows a script to \ncontinue executi11g instead of being stopped. Before dropping users, remember \nthat they are for al] databases on the server. As a result, you should check with \nanyone else who is using the server to make sure that the user isn't needed. \nHow to specify user account names \nIn the last figure, you saw some examples of user account names. Now, \nfigure 18-5 presents the details for coding these names. Here, the first example \nshows the account name for a user named john who can connect only from the \nlocal host. \nThe second example shows how to code an account na1ne for the same user \nusing quotation marks. In this example, neither the usemarne nor the hostname \ncontains special characters. As a result, these quotation marks are optional. \nIn this book, we typically code the quotation marks only when they're neces-\nsary. However, some programmers prefer to always code them for consistency. \nAlso, when we use quotes in this book, we typically use single quotation marks \n('). However, you can use double quotation marks (\") or backticks (') if you prefer. \nThe third example shows yet another way to code the same user as the fu·st \nexample. For the host, this example uses an IP address of 127.0.0.1, which is \nsynonymous with the localhost keyword. Although it isn't shown in this figure, \nyou can use an IP address to identify a remote server too if necessary. \nThe fourth example shows how to create a user that can connect from any \nhost, local or remote. In this example, the account name doesn't use the @ sign \nto specify a host. As a result, MySQL automatically uses the percent sign (%) \nwildcard character for the hostname. This indicates that the user can connect \nfrom any host. \nThe fifth example shows how to explicitly code the hostname for a user that \ncan connect from any computer. In this example, the percent sign(%) must be \nenclosed in quotes because it's a special character. \nThe sixth and seventh examples show an account name for a user that can \nconnect from a host for a specific domain. Since, the percent sign is coded before \nthe domain name, the user can connect from any computer within a domain na1ne \nthat ends with murach.com. In both examples, the hostname must be enclosed \nin quotes since it includes the percent sign (%). In addition, the username in the \nseventh example must be enclosed in quotes since it includes dashes (-).\n\nThe syntax of an account name \nusername[ @hostname] \nChapter 18 \nHow to secure a database \n535 \nA user that can only connect from the same server as MySQL \njohn@loca1host \nThe same user with optional quotation marks \n•john'@'localhost' \nThe same user with an IP address instead of the localhost keyword \njohn@127.0.0.1 \nA user that can connect from any computer \njohn \nThe same user but with the wildcard character explicitly coded \njohn@ '% ' \nA user that can only connect from the murach.com domain \njohn@' %.murach.com' \nA username that needs to be coded with quotes \n1quinn-t he-mighty 1 @1 %.murach.com 1 \nDescription \n• \nIf you want to specify the host that a user can connect from, you can code the \nusername, followed by the @ character, followed by the hostname. \n• \nIf you specify a user without specifying a hostname, MySQL uses a percent sign \n(%) as a wildcard character to indicate that the user can connect from any host. \n• \nThe use1name and hostname do not need to be quoted if they are legal as unquoted \nidentifiers. Quotes are necessary to specify a usemame string containing special \ncharacters such as a dash ( - ), or a hostname string containing special characters or \nwildcard characters such as a percent sign(%). \n• \nTo quote a usemame or hostname, you can enclose it in single quotation marks ( ' ), \ndouble quotation marks(\"), or backticks ( ' ). \nFigure 18-5 \nHow to specify user account names\n\n536 \nSection 5 \nDatabase administration \nHow to grant privileges \nMySQL 5.7 and earlier allowed you to create users and grant privileges to \nthem using the GRANT statement. Even so, the best practice was to use the \nCREATE USER statement to create users and the GRANT statement to grant \nprivileges. Now, with MySQL 8.0 and later, you can no longer create users with \nthe GRANT statement. That's why the examples in figure 18-6 don't show how \nto create users. Instead, they show how to grant privileges to existing users. \nThe first statement grants all privileges on all databases to a user named \njim@%. To do that, this statement uses the ALL p1ivilege. In addition, the ON \nclause is coded with an asterisk for both the database name and table name. \nThese asterisks are wildcards that indicate that the user has privileges on all \ndatabases and all tables, even though no privileges are given. In other words, this \nuser is given a global privilege level. Finally, this statement includes the WITH \nGRANT OPTION clause. This grants the GRANT OPTION privilege to the \nuser. As a result, the user can grant privileges to other users. \nNote that when you code the WITH GRANT OPTION clause, the user is \nonly given the GRANT OPTION privilege at the level that's specified on the ON \nclause. In this example, the user is granted global privileges, so he will be able \nto grant all of his privileges to other users. If you want to restrict the privileges \na user can grant to other users, you grant database, table, or colu1nn privileges \ninstead. Then, the user will only be able to grant privileges on those objects. \nAlthough using the ALL keyword makes it easy to grant all privileges to a \nuser, it also makes it easy to grant more privileges than the user needs. And that \ncan make your database less secure. In general, then, it's a good practice to grant \na user just the privileges that he or she needs. \nTo grant all p1ivileges to a user, you must connect as a user such as the root \nuser that has the appropriate privileges. If you connect as another user, that user \nmust have the GRANT OPTION privilege to grant privileges to other users. In \nthat case, though, even if you use the ALL keyword, only the privileges that the \ncurrent user has are granted to the other users. \nThe second statement grants just SELECT, INSERT, and UPDATE privi-\nleges to all tables in the AP database. These privileges are given to a user named \njoel on a host named localhost. The third statement is similar, except it grants \nprivileges on just the Vendors table in the AP database. \nThe fourth statement grants privileges to specific columns of a table. \nSpecifically, it grants the SELECT privilege on three columns of the Vendors \ntable, but it only grants the UPDATE privilege on another column. To do that, \nthe column names are listed in parentheses after each privilege. Most of the \ntime, you won't need to grant p1ivileges at tl1e column level, but you can do it if \nnecessary. \nThe fifth statement assumes that the AP database is the current database. As \na result, this statement doesn't specify the database name. Since this makes it \neasier to work with the privileges of a database, it often makes sense to select the \ndatabase before working with the privileges of its users. \nThe sixth statement gives the user the ability to grant their privileges to \nother users. To do that, it includes the WITH GRANT OPTION clause. Unlike\n\nThe syntax of the GRANT statement \nGRANT privilege_ list \nON [db_name.] table \nTO userl [, user2 ] ..• \n[WITH GRANT OPTION] \nChapter 18 \nHow to secure a database \n537 \nA statement that grants global privileges to a user \nGRANT ALL \nON*.* \nTO jim \nWITH GRANT OPTION \nA statement that grants database privileges to a user \nGRANT SELECT, INSERT, UPDATE \nON ap.* \nTO joel@localhost \nA statement that grants table privileges to a user \nGRANT SELECT, INSERT, UPDATE \nON ap.vendors \nTO joel@localhost \nA statement that grants column privileges to a user \nGRANT SELECT (vendor_ name, vendor_ state, vendor_ zip_ code), \nUPDATE (vendor_addressl) \nON ap.vendors \nTO joel@localhost \nA statement that uses the current database \nGRANT SELECT, INSERT, UPDATE, DELETE \nON vendors \nTO ap_user@localhost \nA statement that gives a user the ability to grant privileges to other users \nGRANT USAGE \nON*.* \nTO anne@localhost \nWITH GRANT OPTION \nDescription \n• \nYou use the GRANT statement to grant privileges to a user. \n• \nWith MySQL 5.7 and earlier, a user account was created if it didn't already exist \nand a passwo1·d was specified using the IDENTIFIED BY clause. With MySQL 8.0 \nand later, a user must already exist before privileges can be granted. \n• \nThe ON clause determines the level at which the privileges are granted. You can use \nthe asterisk(*) to specify all databases or tables. If you don't specify a database, \nMySQL uses the current database. \n• \nThe WITH GRANT OPTION clause allows the user to grant their privileges to other users. \nFigure 18-6 \nHow to grant privileges\n\n538 \nSection 5 \nDatabase administration \nthe first example that uses this clause, though, the USAGE privilege is speci-\nfied. As a result, no additional privileges are given to the user. If you want to \ngrant additional privileges to a user, you can code those privileges instead of the \nUSAGE privilege. \nHow to view privileges \nWhen you're done granting privileges, you may want to view the privileges \nthat have been granted to make sure that you have g1·anted the correct privileges \nto each user. To do that, you can use the techniques described in figure 18-7. \nTo start, if you want to get a list of users for the current server, you can use \na SELECT statement like the one shown in the first example. This statement \nqueries the table na1ned User in the mysql database. \nIn this figure, the server has twelve users. Here, the root user is the admin \nuser for MySQL. Note that the Host column for this user specifies localhost. \nSimilarly, the users named anne, ap_admin, ap_tester, and ap_user, as well as \nthe built-in users named mysql.infoschema, mysql.session, and mysql.sys have \na Host value of localhost. By contrast, the users named jane, jim and john have a \nHost value of%. \nOnce you know the names of the users and hosts, you can use the SHOW \nGRANTS statement to view the privileges for a user. For instance, the second \nexample shows how to view the privileges for a user from any host. In particular, \nit shows how to view the privileges for the user named jim @o/o. The result set for \nthis user shows that it has all privileges, including the GRANT OPTION privi-\nlege for all tables and databases on the server. \nThe third example shows l1ow to view the privileges for a user from a \nspecific host. In particular, it shows how to view the privileges for the user \nnamed ap_user@localhost. Here, the result set shows that this user has a global \nUSAGE privilege (*. *). By itself, this privilege only allows the user to view \nthe mysql database. It doesn't allow the user to view or work with any other \ndatabases. However, this user also has SELECT, INSERT, UPDATE, and \nDELETE privileges for all tables on the database named AP. As a result, it can \nwo1·k with the data in that database. \nThe f ou1th example shows how to view the privileges for the current user. \nTo do that, you can execute a SHOW GRANTS statement without a FOR clause. \nHere, the result set is for the root user. This user has all privileges, including the \nGRANT OPTION privilege. This user also has the PROXY privilege, which \nallows the user to impersonate another user.\n\nChapter 18 \nHow to secure a database \n539 \nA statement that displays a list of users \nSELECT User, Host FROM mysql.user \nUser \nHost \n► \njane \no/o \nfun \no/o \njohn \n% \nanne \nlocalhost \nap_admin \nlocalhost \nap_tester \nlocalhost \nap_user \nlocalhost \njoel \nlocalhost \nmysql.1nfuschema \nlocalhost \nmysql.session \nlocalhost \nmysql.sys \nlocalhost \nroot \nlocalhost \nThe syntax of the SHOW GRANTS statement \nSHOW GRANTS [FOR user] \nA statement that shows the privileges for a user from any host \nSHOW GRANTS FOR jim \nGrants fur jirn@o/o \n--\n► \nGRANT SELECT, INSERT, UPDATE, DEl.ETE, CREATE, DROP, R.a.OAD, SHUTDOWN, •.. \nGRANT BACKUP _AOMIN,BINLOG_ADMIN,CONNECTION_ADMIN,ENCRYPTION _m _ ... \n\" \nA statement that shows the privileges for a user from a specific host \nSHOW GRANTS FOR ap_user@localhost \nGrants for ap_user@localhost \n► \nGRANT USAGE ON •.•To ·ap_user· @'localhost· \nGRANT SELECT, INSERT, UPDATE, Da.ETE ON ·ap·. *TO ·ap_user@·locathost· \nA statement that shows the privileges for the current user \nSHOW GRANTS \nGrants fur root@localhost \n- -\n► \nGRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, Ra.CAD, SHUTDOWN, .. . \nGRANT BACKUP _ADMIN,Bil'ILOG_ADMIN,CONNECTION_ADMIN,ENCRYPTION_m _ .. . \nGRANT PROXY ON \"@\" TO 'root'@1ocalhost' WITH GRANT OPTION \nDescription \n• \nYou can query the User table in the mysql database to get a list of users for the \ncurrent MySQL server. \n• \nYou can use the SHOW GRANTS statement to display the privileges for a user. \nFigure 18-7 \nHow to view privileges\n\n540 \nSection 5 \nDatabase administration \nHow to revoke privileges \nAfter you've created users and granted privileges to them, you may need \nto revoke privileges. For example, you may need to revoke some or all of a \nuser's privileges if the t1ser abuses those privileges. To do that, you can use \nthe REVOKE statement as shown in figure 18-8. Since this statement works \nsimilarly to the GRANT statement, you shouldn't have much trouble using it. \nHere, the first statement shows how to revoke all privileges from a user \nnamed jim. To do that, you can code a REVOKE statement that uses the \nALL keyword to revoke all privileges. In addition, you must specify GRANT \nOPTION to revoke the GRANT OPTION privilege. This revokes all privileges \nfrom the user on all databases. To be able to use this syntax, you must be logged \nin as a user that has the CREATE USER privilege. Otherwise, you won't have \nthe privileges you need to execute the REVOKE statement. \nThe second statement works like the first statement. However, it revokes all \nprivileges from two users. To do that, this statement separates the usernames in \nthe FROM clause with a comma. \nThe third statement revokes specific privileges from a user. To do that, \nyou separate the privileges with a comma. For example, this statement revokes \nthe INSERT and UPDATE privileges on the Invoices table in the AP database \nfrom the user named joel@localhost. To be able to use this syntax, you must be \nlogged in as a user that has the GRANT OPTION privilege and the privilege that \nyou're revoking. \nAlthough the REVOKE statement removes privileges, it doesn't remove the \nuser from the database that MySQL uses to keep track of users. To remove a user \naccount entirely, use the DROP USER statement described in figure 18-4.\n\nChapter 18 \nHow to secure a database \n541 \nThe syntax of the REVOKE statement for all privileges \nREVOKE ALL[ PRIVILEGES], GRANT OPTION \nFROM userl[, user2] ••• \nA statement that revokes all privileges from a user \nREVOKE ALL, GRANT OPTION \nFROM jim \nA statement that revokes all privileges from multiple users \nREVOKE ALL, GRANT OPTION \nFROM ap_user, anne@localhost \nThe syntax of the REVOKE statement for specific privileges \nREVOKE privilege_list \nON [db_name.]table \nFROM userl[, user2] ••• \nA statement that revokes specific privileges from a user \nREVOKE INSERT, UPDATE \nON ap.vendors FROM joel@localhost \nDescription \n• \nYou can use the REVOKE statement to revoke privileges from a user. \n• \nTo revoke all privileges, you must have the global CREATE USER privilege. \n• \nTo revoke specific privileges, you must have the GRANT OPTION p1·ivilege and \nyou must have the privileges that you are revoking. \nNote \n• \nTo completely delete a user account, use the DROP USER statement described in \nfigure 18-4. \nFigure 18-8 \nHow to revoke privileges\n\n542 \nSection 5 \nDatabase administration \nHow to change passwords \nTo change a password, you can use either the ALTER USER statement or the \nSET PASSWORD statement. The ALTER USER statement is preferred over the \nSET PASSWORD statement because it's more widely used across other database \nplatforms. In addition, you can use it to control how often a password needs to \nbe changed and when passwords can be reused. However, the ALTER USER \nstatement didn't become available until MySQL 5.6. So if you're using a release \nof MySQL before 5.6, you'll need to use the SET PASSWORD statement. \nThe syntax and examples at the top of figure 18-9 show how to use the \nALTER USER statement to change passwords. To change the password for a \nuser other than the user who's currently logged on, you code the name of the \nuser, followed by the IDENTIFIED BY clause with the new password. This is \nillustrated by the first example. For this to wor~ the current user must have the \nCREATE USER privilege or the UPDATE privilege for the MySQL database. \nYou use a similar technique to change the password for the current user. \nInstead of coding the name of the user, though, you code the USER function. \nThis is illustrated by the second example. \nThe third example includes the IF EXISTS clause to check that the user \nexists before changing the password. Then, it uses the PASSWORD EXPIRE \nclause to set the password to expire in 90 days. This clause, as well as the \nPASSWORD HISTORY and PASSWORD REUSE INTERVAL clauses, work \njust like they do for the CREATE USER statement. \nTo use the SET PASSWORD statement to change the password for a user \nother than the user who's currently logged on, you include the FOR clause to \nidentify the t1ser. For this to work, the current user must have the UPDATE privi-\nlege for the MySQL database. This is illustrated by the first SET PASSWORD \nexample. To change the password for the current user, you can omit the FOR \nclause as illustrated by the second example. \nWith MySQL 5.6 and earlier, developers often used the PASSWORD \nfunction with the SET PASSWORD statement to hash the password. For \ninstance, it was common to code the statement in the frrst example like this: \nSET PASSWORD FOR john = PASSWORD{ 'paSSword') \nHowever, the PASSWORD function was deprecated with MySQL 5.7.6 and \nremoved with MySQL 8.0. Without this function, MySQL uses an authentication \nplugin to hash the password, which is usually what you want. \nFor security reasons, you should always assign a password to each user. To \nmake sure that every user has a password, you can execute a SELECT statement \nlike the one in this figure. This statement retrieves inforination from the User \ntable of the mysql database for all users who don't have an authentication string, \nwhich is typically the password in encrypted format. (With MySQL 5.6 and \nearlier, you need to check the Password column for an empty string instead of \nthe authentication_string column.) In this case, the SELECT statement returned \nan empty result set, which indicates that all users have been assigned passwords. \nHowever, if this statement rettrrns a result set, you can set a password for each \nuser in the result set. Or, if those users aren't needed, you can drop them.\n\nChapter 18 \nHow to secure a database \n543 \nHow to use the ALTER USER statement \nThe syntax \nALTER USER [IF EXISTS] {username lUSER()} [IDENTIFIED BY 'password'] \n[PASSWORD EXPIRE [DEFAULT INEVER IINTERVAL days DAY] I \nPA.SSWORD HISTORY {DEFAULT I nwnber_passwords} I \nPASSWORD REUSE INTERVAL {DEFAULT ldays DAY}] \nA statement that changes a user's password \nALTER USER john IDENTIFIED BY •password' \nA statement that changes the current user's password \nALTER USER USER () IDENTIFIED BY 'secret • \nA statement that forces a user to change their password every 90 days \nALTER USER IF EXISTS john PASSWORD EXPIRE INTERVAL 90 DAY \nHow to use the SET PASSWORD statement \nThe syntax \nSET PASSWORD [FOR username] = 'password' \nA statement that changes a user's password \nSET PASSWORD FOR john= 'paSSword' \nA statement that changes the current user's password \nSET PASSWORD= 'secret' \nA SELECT statement that selects all users that don't have passwords \nSELECT Host, User \nFROM mysql.user \nWHERE authentication_ string = •• \nHost \nUser \n-;; --\nii(!t!i \nDescription \n• \nYou can use the ALTER USER statement or the SET PASSWORD statement \nto change a password. ALTER USER became available with MySQL 5.6 and \nI \nis prefe1Ted over SET PASSWORD because it's more widely used across other \ndatabase platforms and can be used to control the expiration and reuse of passwords. \n• \nTo change the password for another user's account using the ALTER USER state-\nment, you must have the CREATE USER privilege or the UPDATE privilege for \nthe mysql database. With the SET PASSWORD statement, you must have the \nUPDATE privilege for the mysql database. \n• \nYou can change the current user's password by using the ALTER USER statement \nwith a USER function or the SET PASSWORD statement without a FOR clause. \n• \nThe PASSWORD EXPIRE, PASSWORD HISTORY, and PASSWORD REUSE \nINTERVAL clauses of the ALTER USER statement work just like they do for \nthe CREATE USER statement. \n• \nTo be sure you've assigned passwords to all users, you can select data from the \nUser table of the mysql database for all users without authentication strings \n(MySQL 5.7 and later) or passwords (MySQL 5.6 and earlier). \nFigure 18-9 \nHow to change passwords\n\n544 \nSection 5 \nDatabase administration \nA script that creates users \nFigure 18-10 presents a script that creates users and grants privileges for \nthe AP database. This script starts with DROP USER statements that delete the \nusers named john, jane, jirn, and joel if they exist. Because you can't use the \nIF EXISTS clause with MYSQL 5.6 and earlier, you should omit this clause if \nyou're using one of these versions. If you do that, though, and a user doesn't \nexist, the statement that deletes that user will cause an error and execution of the \nscript will stop. As a result, you should omit the DROP statements if you know \nthat the users don't already exist. \nThe CREATE USER statements create the users named john, jane, jirn, \nand joel. To make it easy to remember the passwords for these users, this script \nassigns a password of ''sesame'' to all four users. Of course, if you really wanted \nto secure the database, you would need to assign a different, more cryptic \npassword to each user. \nAfter the CREATE USER statements execute, the users exist but they don't \nhave any privileges. Then, the GRANT statements grant specific privileges to \neach user. Here, because the user named joel is a developer, he is given access \nto all databases and tables on the server. In addition, be is given the GRANT \nOPTION privilege. As a result, he can work with the data or structl1re of any \ntable of any database on the server, and he can grant his privileges to other users. \nHowever, he can on1 y connect from the local host. This helps prevent hackers \nfrom connecting as this user. In general, it's considered a best practice to limit \nconnectivity in this way whenever possible, especially for administrative users. \nUn1ike the user named joel, the user named jim can only work with data \nin the AP database. In other words, jim can't modify the structure of the AP \ndatabase by adding, altering, or dropping objects. That makes sense becat1se jim \nis a manager, not an administrator. However, jim can grant all of his p1ivileges \nto other users. For example, he might need to grant privileges to users that he \nmanages. In addition, jim can connect from any host computer. Although this is \na security risk, at least a hacker who is able to connect as jim on1y has access to \nthe AP database. \nThe users named john and jane have the fewest privileges, since they are \nend users. These users can work with data in the AP database, but only with the \nspecified tables and privileges. Specifically, they can select, insert, update, and \ndelete data in the Vendors, Invoices, and Invoice_Line_Items tables. However, \nthey can only select data from the General_Ledger_Accounts and Terms tables. \nLike jim, these users can connect from a computer on any host. Again, this is \na security ris.k, but a hacker who can connect as john or jane has even fewer \nprivileges and can do less damage.\n\nChapter 18 \nHow to secure a database \nA script that sets up the users and privileges for a database \n-- drop the users (remove IF EXISTS for MySQL 5.6 and earlier) \nDROP USER IF EXISTS john; \nDROP USER IF EXISTS jane; \nDROP USER IF EXISTS jim; \nDROP USER IF EXISTS joel@localhost; \n-- create the users \nCREATE USER john IDENTIFIED BY 'sesame'; \nCREATE USER jane IDENTIFIED BY 'sesame'; \nCREATE USER jim IDENTIFIED BY 'sesame'; \nCREATE USER joel@localhost IDENTIFIED BY •sesame•; \n-- grant privileges to a developer (joel) \nGRANT ALL ON*.* TO joel@localhost WITH GRANT OPTION; \n-- grant privileges to the ap manager (jim) \nGRANT SELECT, INSERT, UPDATE, DELETE ON ap.* TO jim WITH GRANT OPTION; \n-- grant privileges to ap users (john, jane) \nGRANT SELECT, INSERT, UPDATE, DELETE ON ap.vendors TO john, jane; \nGRANT SELECT, INSERT, UPDATE, DELETE ON ap.invoices TO john, jane; \nGRANT SELECT, INSERT, UPDATE, DELETE ON ap.invoice_ line_ items TO john, \nGRANT SELECT ON ap.general_ ledger_accounts TO john, jane; \nGRANT SELECT ON ap.terms TO john, jane; \nFigure 18-10 \nA script that creates users \n• Jane; \n545\n\n546 \nSection 5 \nDatabase administration \nHow to work with roles \nNow that you've learned how to work with users and privileges, you can set \nup security on your database. If a system has many users, however, granting and \nrevoking privileges one by one would requu·e a lot of coding. To help reduce the \nainount of coding and to l1elp you keep your database security organized, you \ncan use a new feature of MySQL 8.0 called roles. \nHow to create, manage, and drop roles \nA role is a collection of privileges. When you assign a user to a particular \nrole, you grant them all of the privileges associated with that role. Figure 18-11 \npresents the statements for working with roles. \nTo start, you use the CREATE ROLE statement to create one or more roles. \nThe example in this figure creates a single role named invoice_entry. Note that \nyou can code the IF NOT EXISTS clause on this statement. When you do, a \nwarning will be generated instead of an error if the 1·ole already exists. That way, \nif the statement is part of a script, the script will continue executing instead of \nstopping at the error. \nAfter you create a role, you grant privileges to it. To do that, you use the \nGRANT statement. This statement works just like it does for granting privileges \nto users, except that you name one or more roles. In this figure, the frrst GRANT \nstatement grants INSERT and UPDATE privileges on the Invoices table to the \ninvoice_entry role, and the second statement grants INSERT and UPDATE \nprivileges on the Invoice_Line_Items table to the invoice_entry role. \nTo assign a user to a role, you use another forrr1at of the GRANT statement. \nWith this for1nat, you list the roles you 're assigning the users to instead of listing \nthe privileges you're granting. The example in this figure assigns the users \nnamed john and jane to the invoice_entry role. \nNotice that you can also code the WITH ADMIN OPTION when you assign \nusers to role. If you do, the users you assign to the role will be able to assign the \nrole to other users. \nThe last example in part 1 of this figure shows how to display the privileges \nthat have been granted to a role. To do that, you use the SHOW GRANTS state-\nment just like you do to display the privileges for a user, except that you name a \nrole. In this figure, the privileges for the invoice_entry role are displayed.\n\nHow to create a role \nThe syntax of the CREATE ROLE statement \nCREATE ROLE [IF NOT EXISTS] rolel[, role2] ... \nA statement that creates a new role \nCREATE ROLE invoice_ entry \nHow to grant privileges to roles \nGRANT INSERT, UPDATE \nON invoices \nTO invoice_entry \nGRANT INSERT, UPDATE \nON invoice line items \n-\n-\nTO invoice_entry \nHow to assign users to roles \nChapter 18 \nHow to secure a database \n54 7 \nThe syntax of the GRANT statement for assigning users to roles \nGRANT rolel[, role2] • • • \nTO usernamel[, username2] ... \n[WITH ADMIN OPTION] \nA statement that assigns two users to the new role \nGRANT invoic e_ entry TO john, jane \nHow to display the privileges for a role \nSHOW GRANTS FOR invoice_entry \nGrants for invoice_entry@% \n1----1-\n► \nGRAM\"USAGEON *.*TO 'invoice_entry' @\"o/a' \nGRAHf INSERT, UPDATE ON · ap · . ' invoice_hne_ttems· TO ' invoice_entry' @' 0/a · \nGRAM\" INSERT, UPDATE ON ' ap .. 'invoices· TO 'invoice_entry' @· Dfo. \nDescription \n• \nA role is a collection of privileges that you can assign to one or more users. Roles \nwere introduced with MySQL 8.0. \n• \nYou t1se the CREATE ROLE statement to create one or more roles. For this to work, \nthe user 1nust have the CREATE USER or CREATE ROLE privilege. \n• \nIf you code the [F NOT EXISTS clause on the CREATE ROLE statement, a warning is \ngenerated instead of an error if the role already exists. \n• \nYou use the GRANT statement to grant privileges to a role. The syntax of this \nstatement is the same as for granting privileges to users except that yotL name one or \nmore roles. \n• \nYou also use the GRANT statement to assign users to roles. When you assign a user to \na role, the user is granted all the privileges of that role. If you code the WITH AD MIN \nOPTION clause, the user can also grant the roles to other users. \n• \nYou use the SHOW GRANTS statement to display the privileges associated with a \nrole. The syntax of this statement is the same as for displaying the privileges for a \nuser, except that you name a role. \nFigure 18-11 \nHow to create, manage, and drop roles (part 1 of 2)\n\n548 \nSection 5 \nDatabase administration \nPart 2 of figure 18-11 presents some additional statements for working with \nroles. To start, it shows how to use the SET DEFAULT ROLE statement to set \nthe roles that are activated by default when a user connects to the se1·ver. If you \nspecify NONE on this statement, none of the roles that the user is assigned to \nare activated. In that case, the user only has the privileges that he or she has \nbeen assigned directly. If you specify ALL, the user is given all of the privileges \nof all of the roles that he or she has been assigned. And if you specify one or \nmore roles, the user is given the privileges of all those roles. In the example \nin this figure, the users named john and jane are assigned a default role of \ninvoice_ entry. \nNote that you can also assign one or more default roles to a user when you \ncreate the user. To do that, you use the DEFAULT ROLE clause of the CREATE \nUSER statement. \nThe SET ROLE statement allows a user to change the roles that are currently \nactive during a session. This is particularly useful if yot1 need to try different \nroles during testing to be sure they provide the privileges a user needs. You \ncan code the NONE or ALL option or a list of user roles on this statement just \nlike you can on the SET DEFAULT ROLE statement. You can also code the \nDEFAULT option to change the active roles to the defaults specified by the \nSET DEFAULT ROLE statement. And you can code the ALL EXCEPT option \nfollowed by the names of one or more roles to activate all of the roles that a user \nis assigned to except for the ones you name. In this figure, the SET ROLE state-\nment si1nply sets the active role to the invoice_entI-y role. \nIf you change the active roles during a session, you may at some point \nwant to display the roles that are currently active. To do that, you can use the \nCURRENT _ROLE function as shown in this figure. \nTo revoke privileges from one or more roles, you use the REVOKE \nstatement just like you do to revoke privileges from users. In this figure, the \nREVOKE statement revokes the UPDATE privilege on the Invoice_Line_Items \ntable from the invoice_entry role. \nYou also use the REVOKE statement to remove users from roles. On this \nstatement, you name the roles that you 're removing the users from, and you \nname the users you're removing on the FROM clause. In the REVOKE state-\nment in this figure, the user named john is removed from the invoice_entry role. \nTo drop one or more roles, you list the1n on the DROP ROLE statement. In \nthis figure, the invoice_entry role is dropped. You can also code the IF EXISTS \nclause on this state1nent. Then, if the role doesn't exist, a warning is generated \ninstead of an error.\n\nChapter 18 \nHow to secure a database \n549 \nHow to set the default roles \nThe syntax of the SET DEFAULT ROLE statement \nSET DEFAULT ROLE {NONE IALL lrolel[, role2] ... } \nTO usernamel[, username2] ... \nA statement that sets the default role for two users \nSET DEFAULT ROLE invoice_entry TO john, jane \nHow to change the active roles \nThe syntax of the SET ROLE statement \nSET ROLE {DEFAULTINONE IALL IALL EXCEPT rolel[, role2] ... lrolel[, role2] ... } \nA statement that changes the active role \nSET ROLE invoice_entry \nHow to display the roles that are currently active \nSELECT CURRENT_ROLE( ) \nCURRENT _ROLEO \nt---+-\n► \n·invoice_entry· @· %· \nHow to revoke privileges from roles \nREVOKE UPDATE \nON invoice line items \n-\n-\nFROM invoice_entry \nHow to remove users from roles \nThe syntax of the REVOKE statement for removing users from roles \nREVOKE rolel[, role2] ... \nFROM usernamel[, username2] ... \nA statement that removes a user from the new role \nREVOKE invoic e_entry FROM john \nHow to drop roles \nThe syntax of the DROP ROLE statement \nDROP ROLE [IF EXISTS] rolel [, role2] ... \nA statement that deletes the new role \nDROP ROLE invoice_entry \nDescription \n• \nYou use the SET DEFAULT ROLE statement to name the default roles for a user. \nThese roles are activated by default when the user connects to the server. To set the \ndefault role for another user, you must have the CREATE USER privilege. \n• \nA user can use the SET ROLE statement to change the active role for a session. \nI \n• \nYou use the REVOKE statement to revoke privileges from a role or to remove users \nfrom a role. \n• \nYou use the DROP ROLE statement to delete one or more roles. To use this state-\nment, you must have the DROP ROLE or CREATE USER privilege. \n• \nIf you code the IF EXISTS clause on the DROP ROLE statement, a warning is \ngenerated instead of an error if the role doesn't exist. \nFigure 18-11 \nHow to create, manage, and drop roles (part 2 of 2)\n\n550 \nSection 5 \nDatabase administration \nA script that creates users and roles \nFigure 18-12 presents a script that creates users and roles and grants privi-\nleges to the roles for the AP database. Unlike the script you saw in figure 18-10, \nthis figure doesn't start with statements that drop the users. Instead, it includes \nthe IF NOT EXISTS clause on each CREATE USER statement so that if the user \nalready exists, the script will continue. Since this script works with roles, which \nwere introduced with MySQL 8.0, it's written to work with that release or later. \nThe CREATE USER statements create users named john, jane, jim, and joel. \nThen, the script uses a CREATE ROLE statement to create roles named devel-\noper, manager, and user. Like the CREATE USER statements, this statement \nincludes an IF NOT EXISTS clause so the script will continue if any of the roles \nalready exist. \nThe statements that follow grant privileges to the new roles. The first state-\nment grants all privileges to all databases and tables to the developer role. In \naddition, the role is given the GRANT OPTION privilege. As a 1·esult, any user \nassigned to this role will be able to grant their privileges to other users. \nThe next statement grants SELECT, INSERT, UPDATE, and DELETE \nprivileges to all tables in the AP database to the manager role. Like the developer \nrole, this role is also given the GRANT OPTION privilege. \nThe next five statements grant privileges to the user role. The first three \nstatements grant SELECT, INSERT, UPDATE, and DELETE privileges on the \nVendors, Invoices, and Invoice_Line_ltems tables. Then, the fourth and fifth \nstatements grant the SELECT privilege on the General_Ledger_Accounts and \nTerms tables. \nThe next three statements assign the users that were created at the begin-\nning of the script to the new roles. Here, the user named joel is assigned to the \ndeveloper role, the user named jim is assigned to the manager role, and the users \nnamed john and jane are assigned to the user role. \nFinally, this script sets the default role for each user. As you can see, the \ndefault role for each user is set to the role that the user is assigned to by the \nGRANT statement for that user. That way, the users won't have to set the role \nafter connecting to the server. \nNow that you've seen this script, you might want to compare it to the one \nin figure 18-10. If you do, you'll see that it grants the same privileges to the \nsame users. Because it uses roles, though, it's easier to modify. If you wanted \nto change the privileges that are assigned to a group of users, for example, you \nwould just need to change the privileges for the role that those users are assigned \nto. Or, if you wanted to add users with the same p1ivileges as existing users, you \nwould just need to assign that use1· to the same role.\n\nChapter 18 \nHow to secure a database \nA script that sets up the users and roles for a database \n-- create the users \nCREATE USER IF NOT EXISTS john IDENTIFIED BY 'sesame'; \nCREATE USER IF NOT EXISTS jane IDENTIFIED BY 'sesame'; \nCREATE USER IF \nCREATE USER IF \nNOT \nNOT \nEXISTS \nEXISTS \njim IDENTIFIED BY 'sesame'; \njoel@localhost IDENTIFIED BY 'sesame'; \n-- create the roles \nCREATE ROLE IF NOT EXISTS developer, manager, user; \n-- grant privileges to the developer role \nGRANT ALL ON*.* TO developer WITH GRANT OPTION; \n-- grant privileges to the manager role \nGRANT SELECT, INSERT, UPDATE, DELETE ON ap.* TO manager WITH GRANT OPTION; \n-- grant privileges to user role \nGRANT SELECT, INSERT, UPDATE, DELETE ON ap.vendors TO user; \nGRANT SELECT, INSERT, UPDATE, DELETE ON ap.invoices TO user; \nGRANT SELECT, INSERT, UPDATE, DELETE ON ap.invoice_ line_ items TO user; \nGRANT SELECT ON ap.general_ledger_accounts TO user; \nGRANT SELECT ON ap.terms TO user; \n-- assign users to roles \nGRANT developer TO joel@localhost; \nGRANT manager TO jim; \nGRANT user TO john, jane; \n-- set default roles for users \nSET DEFAULT ROLE developer TO joel@localhost; \nSET DEFAULT ROLE manager TO jim; \nSET DEFAULT ROLE user TO john, jane; \nNote \n• \nSome versions of Workbench 8.0 may identify the first SET DEFAULT ROLE \nstatement in this script as a syntax error. However, the syntax for this statement is \ncorrect, and it should run correctly. \nFigure 18-12 \nA script that creates users and roles \n551\n\n552 \nSection 5 \nDatabase administration \nHow to use MySQL Workbench \nSince you often use SQL statements to set up the users for a database or to \nview the privileges that have been granted to a user, it's important to understand \nthe SQL statements presented in this chapter. Once you understand them, you \ncan use MySQL Workbench to work with security. For example, you can use \nMySQL Workbench to drop or alter an existing user or to grant or revoke the \nprivileges for a user. \nHow to work with users and privileges \nFigure 18-13 shows how you can work with users using MySQL \nWorkbench. Here, you can see the Users and Privileges window that's displayed \nwhen you select the Users and Privileges item from the Navigator window. To do \nthat, you may need to click the Administration tab to display this item as shown \nin this figure. \nTo work with the login information fo1· a user, display the Login tab within \nthe Users and Privileges window as shown in the first screen. Then, you can \nselect a user to display or change the login information for that user. You can \nclick the Expire Password button to cause the user's password to expire i1nmedi-\nately. And you can click the Delete button to remove the user. \nYou can also add an account from the Login tab. To do that, just click the \nAdd Account button, enter the login information, and click the Apply button. \nTo view the database privileges for a user, display the Schema Privileges tab, \nselect the user, and select a schema as shown in the second screen. Then, you can \nuse the check boxes at the bottom of the tab to change the privileges. You can \nrevoke all privileges from the user by clicking the Revoke All Privileges button. \nYou can revoke all privileges from the selected schema by clicking the Delete \nEntry button. And you can add a new schema by clicking the Add Entry button. \nNote that only the privileges that are granted directly to the user are displayed on \nthis tab, not privileges that are granted through roles. \nAs you learned eai·lier in this chapter, you can also assign privileges to \nspecific tables and columns. However, MySQL Workbench doesn't currently \nprovide a way to view or change privileges at these levels.\n\nChapter 18 \nHow to secure a database \nThe Login tab \n■ \nMySQL Workbench \n□ \nX \n6 \nlocal •~lance MySQL80 >< \nFile \n&it \nVie-., \nOue,y \nDatabase \nSeiv!H\" \nTools \nScrip!lng \nHelp \nNa 191tor \nMANAGfMfNT \n0 Server Status \n.l Client Connections \n..l. Users and Privrle11e.s \nIQI Status and System Variables \no Data Export \n.!, Data Import/Restore \nINSTANCE '-\" \n0 Startup / Shutdown \nA Server Logs \nI' Options Ale \nPERFORMANCE \n0 Dashboard \nAdmlnislratioo \nSchemas \nt~fo rmaoon \nObject lnf o \nSess1011 \n.. \nQuery 1 \n1&;su@,;-:11·n1@:1:••;,;,1 __________________________ _ \nlocal flStance MySQUIO \nUsers and Privileges \nUse,- AcCOlllts \nUse-\nFrom Host \nanoe \nlocalhost \nap_admin \nlocalhost \nap_tester \nloalhost \nap_user \nlocalhost \nlnvolcc_cntry \n'JI, \nJane \n% \nJim \n•.4 \njo~ \nlocalhost \njohn \n•t. \nmysql,infoschffllil \nlocalhost \nmys qi.session \nlocalhost \nmysql.sys \nlocalhost \nroot \nlocalhost \nmve \n'lo \nAdd Account 1 \nRefresh \nDetails for acoountjodOlocalhost \nLO(,lin \nAcalunt Lmts \nAdn■listrative Roles Schema Ptivi~ \nLogin Name: IL..joel _______ \n_. \nAuthe'ltication Type: \ncadling_sha2_password \nYou may aeale nubple aa:ounts \nto amect 6-om diffeent hosts. \nFor the stMdard P=WOrd «id/c \nselect 'Standard'. \nI.mt to Hosts Matdwll!: ''--localhost \n________ \n....,! \"I. and_ wildcards may be used \nPassword~ t--•••••---••--\n] Type II l)IISSM)fd ID reset rt. \nConsider IJSil9 a passwo.-d with 8 or more characters w,th \nmixed case lette-s, nt.m>ers and p,.r,ctuaoon marlcs. \nConfirm P\"assword: \nJ •_...,....,...__..th,. \nEnte\" password agair'I to confnn. \nEl(Jwe Password \nSASOOSSJ9ll--u.ClQOClq0(\"200 .Au!hentieation plJgin speoocpar, \nStt the pUg1r1 cloa.lnentalion for valid values and details. \nThe Schema Privileges tab \n■ \nMySQl Workbench \n6 \nloc.,l 1J1Stance MySQLSO >< \nFile \nEdit \nView \nQuery \nOa!abase \nServer \nTools \nScnptmg \nHelp \n(j] \nlocal inslal'lee MVSQ.80 \nUsers and Privileges \nUser .Amults \nUser \nFrom Host \nanne \nloca !lost \nap_admin \nloca host \nep_tester \nlou host \nap_user \nlocalbost \ninvo,ce_entry \n% \nJane \n.,_ \n)lm \n% \nJoel \ntoe.a bost \nJohn \n% \nmvsol.,nfoschema \nloca!bost \nmysql.sesSIOft \nloca !lost \nmysql.sys \nloulhost \nroot \nloca host \nsteve \n% \nOele!e \nDetails for accountjoelCPlocalbost \nLogn \nAcaluntLrmts AdnnstratrveRoies SmenaPrM~ \nSchema \nap \nPnvileges \nDELETE. GRANT OPTION, INSERT, SB.£CT, UP04.TE \n< \nSdiema and Host fields may use % and _ wldcards, \n1'he serve--..1 mauh ~ \nentries before widcarded ones. \n1he user ')oefGt'locatlost' wl have lhe f-olOWl1ll access rights to lhe schema 'ap': \nObject RJghts \nOOL Riglts \n0 SELECT \nD CREATE \n0 INSERT \nD ALTER \n0 ll'OATE \nD REFERENCES \n0 OB.ETE \nD lllllEX \nD EXroJtE \nD CREATE VIEW \nD Sl«)W VIEW \nD CREATE ROlJT1NE \nD Al TER ROUTINE \nD EVENT \n□DROP \nn wrr.r.:RJ \n□ \nX \n> \nRevoke Al PrlVilelJes \nOele~Entrv \nAdd Entry ... \nOther Rights \n0 GRANT OPTIOO \n0 CREATE TEl'PORARY TABLES \n0 LOCKTABI.ES \nl Revert l Apply \nFigure 18-1 3 \nHow to work with users and privileges (part 1 of 2) \n553\n\n554 \nSection 5 \nDatabase administration \nWorkbench provides some predefined administrative roles that you can use \nto quickly set up privileges for database administrators, managers, and designers. \nBefore you begin working with these roles, you should know that they are not \nthe same as the roles that you learned how to create with SQL statements earlier \nin this chapter. In other words, they aren't roles that are stored in the mysql \ndatabase, and they can't be manipulated using SQL statements. Instead, they are \na Workbench feature that allows you to quickly assign privileges to users. \nTo view the Workbench roles for a user, you select the user from the \nAdministrative Roles tab of the Users and Privileges window as shown in the \nscreen in part 2 of figure 18-13. Then, you can select the roles that you want to \nassign the user to, and the privileges assigned by those roles will be selected at \nthe right side of the tab. Note that these are global privileges, so they apply to \nall databases on the server. Because of that, you'll want to be careful who yot1 \nassign to these roles.\n\nChapter 18 \nHow to secure a database \nThe Administrative Roles tab \nII MySQL Workbench \n6 \nlocal lllStance MySQLSO .,, \nFile \nEdit \nVtt!W \nQuery \nOalabMe \nSetver \nTools \nScripting \nHelp \nJ. \nljJ \nLocal instance MySQl.80 \nUsers and Privileges \nUse-Accou\"lts -------, \n~tails for1t000Untjoel@localbost \nUser \nFrom Host \nLogn \nAccount Llnits AdmirutratiVe Roles Schema Pnvteges \nanne \nlocalko,;t \nap_ddmln \nJoca host \na1>_tester \ntoca host \n0 \n&p_USl!f \nloca bo£t \n0 \nlnvo1te_ei,irv \n% \n0 \nJane \n•4 \n0 \nJim \n% \n0 \nJoel \nloca host \n0 \nJohn \n% \n0 \nmysolJnfoschVM \ntocalhost \n0 \nmvsot.sess,on \nJocalhost \n0 \nrnysql.sys \nlocalhost \n0 \nroot \ntoca'host \nSt~ve. \n% \nRole \nOBA \nMaintenanceAdmln \nProc.essAdmin \nUserAdm1n \nSecurltyAdmin \nMomtorAdmin \nDBManager \nDBDesigner \nRephcabonAdmln \nBackupAdm.n \nDescription \ngrants the rights to oerform all task.s \ngrants rights needed to mail\\tain server \nrights needed to assess, monitor, and loll arry 11s er proc \ngrants rights to create users logins and rts~r passwords \nrights to manage logins and Qtfnt and re,,oke server an \nmln,mum set of rlghts needed to morutor server \ngrants full nohts on all databases \nrights to create and reverse engineer arry database sd,e \nrights needed to setup and manage repllutlon \nrrummal rights needed to backup arry database \nGloball'nvleges \nr;;?j \nJILTER \nE2J \nALTER ROUTINE \n0 \nCREATE \nf;2J \nCREATEROUTINE \n0 \nCREATETABLESPACE \nD \n0 \nCREATETEMPORARYTABLES \nE2J \nCREATE USER \nr;;?J \nCREJITE VIE\\V \n0 \nDELETE \n0 \nDROP \n0 \nEVENT \n0 \nEXECUTE \n0 \nFllf \nE2J \nGRANT OJ7TION \nE2J \nINDEX \nE2J \nINSERT \nX \nE2J \nLOCK TABLES \n_ \nv \n< \n> \n< \n> \nAddAccc,.nl \nDelete \nRevert \nApply \nDescription \n• \nTo display the Users and Privileges window, select the Users and Privileges ite1n \nfrom the Navigator window. If necessary, click the Administration tab to display \nthis item. \n• \nTo change a user's name, password, or host access options, use the Login tab. You \ncan also use this tab to add or remove a user account, to expire a user's password, \nor to revoke al I privileges for a user. \n• \nTo view the database privileges for a user, use the Schema Privileges tab. You can \nalso use this tab to change privileges and to add and remove host/schema access \noptions. \n• \nTo view the administrative roles that a user is assigned to and the global p1ivileges \ngranted to those roles, use the Administrative Roles tab. You can also use the check \nboxes on this tab to assign or revoke the privileges of the administrative roles. \nThese roles are defmed by Workbench and are not stored as roles in the mysql \ndatabase. \nFigure 18-13 \nHow to work with users and privileges (part 2 of 2) \n555\n\n556 \nSection 5 \nDatabase administration \nHow to connect as a user for testing \nTo test the username, password, and privileges for a user, you can connect \nas that user. To do that, you create a new connection for the user as described in \nfigure 18-14. \nTo start, you display the Home tab and click on the® icon next to MySQL \nConnections. Then, you enter the connection information in the resulting dialog \nbox, including a connection name and a usemame. In this figure, for example, \nI'm creating a connection named jane for the user with the same name. Here, \nno hostname is specified because the user can connect from any host. Also, \na default schema of AP is specified, so the AP database is used if no other \ndatabase is selected. \nAfter you create a connection for a user, the connection is added to the list \nof connections on the Home tab. Then, you can connect as that user by clicking \non the connection and entering the user's password if necessary.\n\nChapter 18 \nHow to secure a database \n557 \nThe Setup New Connection dialog box \nD \nX \nFile \nEdrt \nView \nOa:labase \nT oolB \nScnp11119 \nHelp \nI ■ \nSetup New Connection \nWE ~~: \n:=IJMI!:....__-.=.;::........:=============: Typeanarnef'Or thecomedlon \n□ \nX \nd \nMySQLCo \nLocal insta \nDescription \nroot \nlocalhost33< \nCa• o«ton Method: I \nSt:andard (TCP/IP) \nv ! Method to use lo ~ \n1o the RDBMS \np~ SSL \nAdvatnd \nHostname: \nPot 13306 \nI Name or IP address Qf1he server host - and \n..._ ______ \n__. \n.__ _ __ \n__._ TCP/lPport. \nUse-name: \nPassword: \niane \nName of the user lo comcctwilh. \nThe user's password. Wi be r~ \nlater if it's \nnotset. \nDefait Schema: IIIPI \nI 1he schena to use as defait S<hema. Leave \nL-. _ _ _ _ _ _ _ _ _ _ _ _ _ \n_,_ blan(_loselectitlater. \nConfioure 5erv,:r Management .. \nTest ConnectiOn \nI oK I \n• \nTo create a connection for a user, display the Home tab, click the (±) icon to the \nright of MySQL Connections, and enter the connection information in the resulting \ndialog box. This includes a name for the connection and a name for the user. \n• \nTo connect as a user, click on the connection for the user in the list of connections, \nand enter the password for the user if necessary. \nFigure 18-14 \nHow to connect as a user for testing (part 1 of 2)\n\n558 \nSection 5 \nDatabase administration \nWhen you connect as a user, the name for the connection is displayed in \nthe tab for the connection. Then, you can only use that connection to view the \ndatabases and tables that the user has privileges to view. In part 2 of figure \n18-14, for example, you can see that the user namedjane only has access to five \ntables in the AP database. In addition, you can only 1nodify the databases and \ntables that the user has privileges to modify. \nTo make sure that the user's privileges are working correctly, you can run \nSQL statements. In this figure, for example, I tried to insert a row into the Terms \ntable. Because the user only has the SELECT privilege on this table, though, \nMySQL Workbench displayed an error indicating that the statement was denied.\n\nChapter 18 \nHow to secure a database \nMySQL Workbench after connecting as jane \niii MySQl Workbench \n□ \nX \n6 \nl \nQuery \nOalabase \nServer \nTools \nScnpllllg \nHelp \n6] \n·,; @} &1 @ I@ ' -\nNav19ator \nSCHEMAS \n,.,, .. ____________________________ _ \nq_ IF,J!!,r obJKl5 \n• i;} ap \n't' \nTables \n► \n9ffleral_ted9er_accounts \n► \nlnvola_archlve \n► Ii 1nvo1ce_J1ne_1tems \n► ■ invokes \n► ii terms \n► \nvendor_contacts \n► El vffldois \nVlew5 \nStored Procedures \nf11nctlons \nAdmlnlstnrtion \nSd>i!mas \nJnformation \nObJect lt1fo \nSession \nDescription \n8 \n- 'i P. \n~ I 1.Jmi to lOOOrows \nfrusERT TIITO te1\"111S \nVALUES ( , 'net due 120 days' , \n); \nConnection name \n< \n(Mp,., \n(j Action Ol.tpu \n~ \nT-\nAalDn \nMtiwg• \nOuriitlOn / ktcl> \n0 \n1 15 31 20 INSERT JNTOll!nns VALUES (6. 'net cile 120days'. \nEirorU>de· 1142- INSERT canmand denied to U9et '. \n0 000 see \n• \nWhen you connect as a user, the name for the connection is displayed in the SQL \nEditor tab. \n• \nWhen you connect as a user, you can only view the databases and tables that the \nuser has privileges to view, and you can only modify the databases and tables that \nthe user has privileges to modify. \nFigure 18-14 \nHow to connect as a user for testing (part 2 of 2) \n559\n\n560 \nSection 5 \nDatabase administration \nPerspective \nAlthough managing security can be complex, MySQL provides tools to \nsimplify the job. In this chapter, you learned how to manage security by writing \nSQL statements, and you learned how to use MySQL Workbench to work \nwith users and manage privileges. Once you 're familiar with both of these \ntechniques, you can use the one that's easiest for the security task at hand. \nIn addition to the skills presented in this chapter, you may also need to \nsecure MySQL's file system if the server is running on a computer that has \nmultiple users. That way, other users who log in on that computer can't access \nany of the MySQL files that may contain sensitive data. That includes the data, \nlog, and configuration files you learned about in chapter 17. Because the proce-\ndure for securing the file system varies depending on the operating system, this \ninformation isn't presented in this book. \nYou may also need to use SSL to secure the usemames and passwords \nof users who are allowed to connect remotely. In most cases, users connect \nlocally. For example, a web server often runs on the same machine as the \nMySQL server. As a result, users of the website use a local connection to \nconnect to MySQL. If the MySQL server is on a different machine, though, \nyou can learn about providing secure connections by looking up ''Using \nEncrypted Connections'' in the MySQL Reference Manual. \nTerms \nprivilege \nobject privileges \nadministrative privileges \nglobal privileges \ndatabase privileges \ntable privileges \ncolumn privileges \ngrant tables \nrole\n\nChapter 18 \nHow to secure a database \n561 \nExercise \nIn this exercise, you will create two users and a role. You will grant privileges \ndirectly to the first user, but you will grant privileges to the second user by granting \nprivileges to the role and then assigning the user to that role. In addition, you will \nuse MySQL Workbench to connect as the two users and test their privileges. \n1. \nUse MySQL Workbench to connect as the root user. \n2. \nWrite a script that creates a user named ray@localhost with a password \nof ''temp'' that the user must change every 90 days. This user should have \nSELECT, INSERT, and UPDATE privileges for the Vendors table of the AP \ndatabase; SELECT, INSERT, and UPDATE privileges for the Invoices table; \nand SELECT and INSERT privileges for the Invoice_Line_Items table. This \nuser should also have the right to grant privileges to other users. Run the \nscript in MySQL Workbench. \n3. \nCheck the privileges for ray@localhost by using the Users and Privileges \nwindow of MySQL Workbench. \n4. \nUse MySQL Workbench to create a connection for the user named \nray@localhost and then connect as that user. Use the Navigator window \nto see which databases and tables this user can view. \n5. \nRun a SELECT statement that selects the vendor id column for all rows in the \nVendors table. This statement should succeed. \n6. \nWrite a DELETE statement that attempts to delete one of the rows in the \nVendors table. This statement should fail due to insufficient privileges. \n7. \nSwitch back to the tab for the connection for the root user. \n8. \nGrant the UPDATE privilege for the Invoice_Line_Items table to ray@local-\nhost, and give the user the right to grant the same privilege to other users. \n9. \nWrite a script that creates a user named dorothy with a password of ''sesame''. \nThen, create a role named ap_user, and grant this role privileges to select, insert, \nand update data from any table in the AP database. However, don't grant this role \nprivileges to delete any data from the database. Assign the user named dorothy to \nthis role. \n10. Check the privileges for dorothy by using the SHOW GRANTS statement \n11. Use MySQL Workbench to create another connection for the user named \ndorothy and then connect as that user. \n12. Run a SELECT statement that displays the active roles for the current user. This \nshould display NONE. \n13. Close the tab for the connection for the user named dorothy, and switch back to \nthe tab for the connection for the root user. \n14. Set the default role for the user named dorothy to ap_user. \n15. Connect as do1·othy again and then display the active roles using the same \nstatement as in exercise 12. This time, the ap_user role should be displayed.\n\nHow to back up \nand restore a database \nWhen you work with a database that stores important data, you should have \na plan for backing up that database regularly. Then, you need to execute that \nplan. That way, if the hard drive that stores the database fails, you can restore \nthe database and minimize the amount of data that's lost. In this chapter, you '11 \nlearn how to back up and restore a database. \nYou'll also learn some skills that are related to backing up and restoring \na database. For example, you'll learn how to import data from a text file and \nexport data to a text file. In addition, you'll learn how to check and repair \ntables, which can save you from having to restore a table or database. \nStrategies for backing up and restoring a database ...... 564 \nA backup strategy ....................................................................................... 564 \nA restore strategy ........................................................................................ 564 \nHow to back up a database ............................................... 566 \nHow to use mysqldu1np to back up a database ............................................ 566 \nA SQL script file for a database backup ...................................................... 568 \nHow to set advanced options for a database backup ................................... 572 \nHow to restore a database ................................................. 574 \nHow to use a SQL script file to restore a full backup .................................. 574 \nHow to execute statements in the binary log ............................................... 576 \nHow to import and export data ......................................... 578 \nHow to export data to a file .......................................................................... 578 \nHow to import data from a file .................................................................... 580 \nHow to check and repair tables ........................................ 582 \nHow to use the CHECK TABLE statement ................................................ 582 \nHow to repair a My ISAM table ................................................................... 584 \nHow to repair an InnoDB table ................................................................... 584 \nHow to use the mysqlcheck program ........................................................... 586 \nHow to use the myisan1chk program ........................................................... 588 \nPerspective ......................................................................... 590\n\n564 \nSection 5 \nDatabase administration \nStrategies for backing up \nand restoring a database \nOne important task of a database administrator is to regularly back up the \ndatabase. Then, if the database ever becomes corrupted, the database adminis-\ntrator can use the backup files to restore the database. \nIn this chapter, you '11 leam the backup skills that you can use regardless of \nwhether you have the Community Edition or the Enterprise Edition of MySQL. \nHowever, you should know that the Enterprise Edition of MySQL includes a \nbackup tool known as MySQL Enterprise Backup that's designed to back up \nInnoDB tables. As a result, if you're using this edition with lnnoDB tables, \nyou may want to use the Enterprise Backup tool instead of the backup strategy \npresented in this chapter. \nA backup strategy \nFigure 19-1 starts by presenting a strategy for backing up databases. MySQL \nprovides for two types of backups. A full backup includes the structure and data \nof a database. To create a full backup, you can use the mysqldump program as \ndescribed later in this chapter. This creates a SQL script file that can be used to \nrecreate the database. You should create a full backup at regular intervals. For a \nmedium-size database fo1· a website, for example, you might want to create a full \nbackup once a week. \nWhen you use the mysqldump program, it locks all tables so other users \ncan't update the database while it's being backed up. As a result, it's a good \npractice to schedule this backup at a time of low traffic for the database. \nAn inc,·ementctl backup contains changes that have been made since the last \nfull backup. With the backup strategy shown in this figure, the binary log must \nbe enabled as described in chapter 17 to create the incremental backups. \nWhen you use this strategy, you shouldn't store you1· backup files (SQL \nscripts or log files) on the same hard drive where the MySQL server is running. \nIf you do, those backup files will be lost if that hard drive fails. As a result, it's a \ngood practice to configure the binary log so it writes to a directory on a different \nhard drive. This has the added benefit of balancing the load between two hard \ndrives. \nWhen you create a backup strategy, don't forget that the database named \n1nysql stores information about the users and privileges for all databases on the \nserver. As a result, you typically want to include this database in your backups. \nA restore strategy \nThe goal of backing up your databases is to allow you to restore them to \ntheu: exact state at any specified point in time. This is known as a point-in-time \nrecovery (PITR). To restore a database to a point in time, you can use the last full \nbackup as described in figure 19-1. Then, you can use the binary log to restore \nthe database from the time of the last full backup to the specified point in time.\n\nCJ1,111ter 19 \nHol,. lo back 11p w1d re.r;tore a dc1tabase \n565 \nA strategy for backing up databases \n1. Use tl1e ID)' qldump progran1 to regularly create full bnc1..,ips of each databru e. \nThese backups hould be tored in one or more SQL script ftle . \n2. Ii. it' not already enabledj enable the binary log as described in chapter 17 to create \nincremental backup . \nA strategy for restoring databases \nI. U. e the ID)'Sql program to run the SQL cript file for the la..~t full back.,ip. If nece. -\na!}', you can edit the SQL script file before you execute it. \n2. Use the my qlbinlog program to execute all tatements in the binary log that \noccurred afler the last full backup. \nDescription \n• \nIt ·s in1portant for the databa..4ie administrator to regularly ba,ck 11p the databa e. \nThen. u· the database becon1es corrupted tl1e databru e admini. trator can u e the \nbackup to restore U1e database. \n• \nAfi,ll backltp includes the tructure and content ot· a database. You hould perform \nfull backups acc,ording to a regular schedule. \n• \nAn i1Jl·re111e111al bal·kup onl)1 contains changes that have been made to r.he tructt1re \nand content of a databru e ince the last full backup. \n• \nYou otten want to include the database nan1ed n1ysql iI1 )'Our backups. since thi \ndatabase stores inforn1atioo about the users and privileges f'or all d3tabase on the \nsenfer. \n• \nYou houldn 't tore your backup files (SQL cripts or log files) on tl1e ame l1ard \ndrive v.rhere the ~{ySQL en'er is running. If you do tho e back'Up file will be lost \nalong with the database if that hard dri,,e 1·ai1s. \n• \nA JJOi11t-in-ri1t1e reco,·ery· (PlTR allo\\V you to re tore the data up to n.D}' pecified \npoint in time. \nFigure 19-1 \nStrategies for backing up and restoring databases\n\n566 \nSection 5 \nDatabase administration \nHow to back up a database \nNow that you understand the basic strategies for backing up and restoring a \ndatabase, you're ready to learn the details of backing up a database. \nHow to use mysqldump to back up a database \nFigure 19-2 shows how to use the mysqldtunp program to back up, or dump, \none or more databases into a SQL script file. To start, you display a command \nprompt and then use the cd command to change to MySQL's bin directory. \nThis is the directory that stores the various MySQL command-line programs, \nincluding all of the programs described in this chapter. Just as in chapter 17, \nI use front slashes in this chapter to separate the directory and ftle names. \nHowever, you typically use backslashes on a Windows system. \nAfter you change the directory, you can run the mysqldump program from \nthe command prompt to perform a backup. To back up a single database using \nthis program, you specify the name of the database on the mysqldump command. \nTo backup multiple databases, you use the --databases or --all-databases option. \nAfter you specify the databases to back up, you code a > character, followed \nby the path to the SQL script file where you want to store the backup. When \nyou do that, it's generally considered a best practice to add a date to the end of \nyour script ftle name. In this figure, for instance, all of the examples store the \nscript ftle in the murach/mysql directory, and all of the SQL file names end with \n''2019-01-1 O''. \nNext, you code the -u option, followed by the name of a user with privileges \nto back up databases. In this figure, the program connects as the root user. \nFinally, you code the -p option so the program prompts for a password. \nIn addition to the --databases and --all-databases options, you often want \nto use the --single-transaction, --routines, and --events options when you back \nup a database. That way, your backup works correctly even if you're using \ntransactions, and it includes stored routines and events. In addition, you may \nwant to use the --flush-logs option so the server starts a new binary log file. This \nmakes it easier to find the binary log file or files that you need if you restore the \ndatabase later. \nWhen you attempt to execute the mysqldump program, you may get an error \nthat indicates that access is denied. To gain access, you can usually start the \nco1mnand prompt as an administrator. In Windows, for example, you can \nright-click on the icon that you use to start the Command Prompt window and \nselect the ''Run as ad1ninistrator'' command. \nSimilarly, if a fuewall is running on your computer, it may attempt to block \nthe mysqldump program. However, if you allow the mysqldump program to \naccess the database, it should work properly. \nBefore I continue, you should know that you can also use MySQL \nWorkbench to back up one or mo1·e databases to a SQL file. To do that, you select \nthe Data Export option from the Administration tab of the Navigator window,\n\nChapter 19 \nHow to back up an.d restore a database \n567 \nHow to change to MySQL's bin directory \nUsing Windows \ncd /program files/mysql/mysql server 8.0/bin \nUsing macOS or Unix/Linux \ncd /usr/local/mysql/bin \nHow to run the mysqldump program \nFor a single database \nmysqldump ap > /murach/mysql/ap-2019-01-10.sql -u root -p \nFor specified databases \nmysqldump --databases apex om mysql > /murach/mysql/backup-2019-01-10.sql \n-u root -p \nFor all databases \nmysqldump --all-databases> /murach/mysql/all-db-2019-01-10.sql -u root -p \nWith additional options \nmysqldump --databases apex om mysql --single-transaction --routines \n--events --flush-logs> /murach/mysql/backup-2019-01-10.sql -u root -p \nCommon options for the mysqldump program \nOption \nDescription \n--databases \n--all-databases \n--single-transaction \n--routines \n--events \n--flush-logs \nDescription \nIdentifies the databases to be backed up. \nIndicates that all databases should be backed up. \nGuarantees that the data seen by mysqldump \ndoes not change. This option should be used for \ndatabases that use lnnoDB tables and transactions. \nInclude stored procedures and functions. \nInclude events. \nCauses MySQL to create a new binary log file \nusing the next number in the sequence. \n• \nYou can use the mysqldump program to back up, or dump, one or more databases \ninto a SQL script file. \n• If you get an error that indicates that access is denied, you may need to start the \ncommand prompt as an administrator. In Windows, you can do that by \nright-clicking on the icon that you use to start the Command Prompt window and \nselecting the ''Run as administrator'' command. \n• If a fu·ewall is running on your computer, it may attempt to block the mysqldump \nprogram. However, if you allow the mysqldump program to access the database, it \nshould work proper! y. \n• \nOn a macOS system, you typically need to code a dot and slash (./) before the name \nof the mysqldump program to specify that it's in the ct1rrent directory (the bin \ndirectory). \nFigure 19-2 \nHow to use mysqldump to back up a database\n\n568 \nSection 5 \nDatabase administration \nselect the databases you want to back up on the Object Selection tab, select the \n''Export to Self-Contained File'' option, enter the path and name for the backup \nfile, and click the Start Export button. Note, however, that earlier releases of \nWorkbench had some bugs that sometimes prevented this feature from working \ncorrectly. As a result, I recommend using the mysqldump program. \nAnother advantage of using the mysqldump program is that it's easier to \nautomate. Although the details for doing this vary depending on the operating \nsystem, the same general principles apply to all operating systems. To start, \nyou create a script file that executes the mysqldump command. Then, you use \nthe operating system's task scheduler to execute that script file at a specified \ninterval. For more inforrr1ation on using the task scheduler with your operating \nsystem, you can search the Internet. \nA SQL script file for a database backup \nFigure 19-3 shows an excerpt from a SQL script file for the last database \nbackup you saw in the previous figure. This script starts with some comments \nthat give some general information about this backup. For example, the frrst \nline includes information about the mysqldump program. Then, the third line \nidentifies the host (localhost) and the database (AP). Unfortunately, only the first \ndatabase in the backup is listed, which is probably a bug. Finally, the fifth line \nidentifies the version of the MySQL server. \nAfter the comments, this script includes several lines of code that are \nsurrounded by th.e /* ! and */characters. These characters identify code that's \nspecific to MySQL. As a result, a MySQL server uses this code, but another type \nof database server can ignore it. If, for example, you were porting a database \nfrom a MySQL server to an Oracle server, this would prevent Oracle from trying \nto execute these statements. \nMySQL uses these statements to set some user variables, which are identi-\nfied by a single at sign (@). These variables are set to the values of some system \nvariables, which are identified by a double at sign (@@). \nImmediately after the/*! characters, this script uses a number to indicate \nthe minimum version of MySQL that's necessary to run the SET statement that \nfollows. For example, 40101 indicates that MySQL 4.01.01 or later can run the \nstatement. Similarly, 40014 indicates thatMySQL 4.00.14 or later can run the \nstatement. \nNote that the line of code that contains the SET NAMES statement isn't \nsurrounded by the/*! and */characters. This statement identifies the character \nset that will be used by a connection between a client and a server, in this case, \nutf8mb4. For this script, it identifies the character set that will be used if the script \nis run to restore the databases. \nAfter setting the user variables, this script includes a CREATE DATABASE \nstateinent that creates the AP database, followed by a USE statement that selects \nthis database. The CREATE DATABASE statement includes an IF NOT EXISTS \nclause that's used if you're using MySQL 3.23.12 or later. Similarly, this state-\nment includes a DEFAULT CHARACTER SET clat1se that's used if you're\n\nChapter 19 \nHow to back up an.d restore a database \n569 \nPart of the SQL script file for a database backup \n-- MySQL dump 10.13 Distrib 8.0.13, for Win64 (x86_ 64) \n--\n-- Host: localhost \nDatabase: ap \n-- ------------------------------------------------------\n-- Server version \n8.0.13 \n/*!40101 SET @OLD_ CHARACTER_ SET_CLIENT=@@CHARACTER_ SET_ CLIENT */; \n/*!40101 SET @OLD_ CHARACTER_ SET_ RESULTS=@@CHARACTER_ SET_ RESULTS */; \n/*!40101 SET @OLD_ COLLATION_ CONNECTION=@@COLLATION_ CONNECTION */; \nSET NAMES utf8mb4; \n/*!40103 SET @OLD_ TIME_ ZONE=@@TIME_ ZONE */; \nPage 1 \n/*!40103 \n/*!50606 \nSET \nSET \nTIME_ ZONE='+00:00' */; \n@OLD_ INNODB_ STATS_AUTO_RECALC=@@INNODB_ STATS AUTO RECALC */; \n/*!50606 SET \n/*!40014 SET \n/*!40014 SET \nGLOBAL INNODB_ STATS_AUTO_ RECALC=OFF */; \n@OLD_UNIQUE_ CHECKS=@@UNIQUE_CHECKS, UNIQUE_ CHECKS=O \n@OLD_ FOREIGN_ KEY_ CHECKS=@@FOREIGN_KEY_ CHECKS, \nFOREIGN_KEY_CHECKS=O */; \n/*!40101 SET @OLD_ SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ ON_ ZERO' */; \n/*!40111 SET @OLD_ SQL_NOTES=@@SQL_NOTES, SQL_NOTES=O */; \n--\n-- Current Database: ' ap ' \n--\nCREATE DATABASE /*!32312 IF NOT EXISTS*/ ' ap ' /*!40100 DEFAULT CHARACTER SET \nutf8mb4 COLLATE utf8mb4 0900_ai_ci */; \nUSE ' ap' ; \nDescription \n• \nThese scripts use two dashes (--) to identify comments. \n• \nThese scripts surround code in the /* ! and * / characters to indicate that the code is \nspecific to MySQL. As a result, a MySQL server can use that code, but another type of \ndatabase server can ignore it. \n• \nThese scripts surround names with backticks ('). This allows for names that include \nspaces. \nFigure 19-3 \nA SOL script file for a database backup (part 1 of 2)\n\n570 \nSection 5 \nDatabase administration \nusing MySQL 4.01.00 or later. Finally, this script surrounds the name of the \ndatabase with backticks ('). Although this isn't necessary for the AP database, \nit's required for names that include spaces or other special characters. \nIf you only generate a backup for a single database, the SQL file for that \nbackup won't include the CREATE DATABASE and USE statements. As a \nresult, if you want to recreate the entire database, you need to add these state-\nments to the script. \nThe script continues with the statements necessary to create the structure \nand content for the database. That includes the tables of the database, as well as \nthe views, stored procedures, functions, triggers, and events. In part 2 of figure \n19-3, you can see the statements for creating the Terms table. To start, a DROP \nTABLE statement drops the table if it exists. Then, a CREATE TABLE state-\nment recreates the table. \nNext, the script uses an INSERT statement to reload all the data into the \ntable. But frrst, it uses a LOCK TABLES statement to prevent other users from \nwriting data to this table while the script is executing. In addition, it uses an \nALTER TABLE statement to disable the indexes for the table. Then, after the \ndata has been inserted into the table, the script enables the indexes for the table. \nThis improves the performance of the insert operations. Finally, the script uses \nan UNLOCK TABLES statement to allow other users to update this table. \nAfter the SQL statements that create the database and its objects, this script \nsets some system variables. To do that, it uses some of the user-defined variables \nthat were defined at the beginning of the script. Again, this usually works the \nway you want, so you don't usually have to examine this code closely. \nThe last line of this script is a comment that indicates the point in time that \nthe mysqldump program finished creating this SQL ftle. If you need to restore \na database later, you can use this date/time value as the start time for the state-\nments that are stored in your binary log files.\n\nChapter 19 \nHow to back up an.d restore a database \n571 \nPart of the SQL script file for a database backup \n--\n-- Table structure for table ' terms ' \n--\nDROP TABLE IF EXISTS ' terms ' ; \n/*!40101 SET @saved_ cs_ client \n= @@character_set_ client */; \nSET character_set_ client = utf8mb4; \nCREATE TABLE ' terms ' \n( \n' terms_ id' int(ll) NOT NULL AUTO_ INCREMENT, \n' terms_ description ' varchar(SO) NOT NULL, \n' terms_ due_days ' int(ll) NOT NULL, \nPRIMARY KEY ( ' terms id' ) \n) ENGINE=InnoDB AUTO_ INCREMENT=6 DEFAULT CHARSET=utf8mb4 \nCOLLATE=utf8mb4_ 0900_ai_ci; \n/*!40101 SET character_ set_ client = @saved_ cs_ client */; \n--\n-- Dumping data for table ' terms ' \n--\nLOCK TABLES ' terms ' WRITE; \n/*!40000 ALTER TABLE ' terms ' DISABLE KEYS*/; \nPage2 \nINSERT INTO ' terms ' VALUES (1, 'Net due 10 days',10),(2, 'Net due 20 \ndays',20), (3,'Net due 30 days',30),(4, 'Net due 60 days',60),(5,'Net due 90 \ndays',90); \n/*!40000 ALTER TABLE ' terms ' ENABLE KEYS*/; \nUNLOCK TABLES; \n--\n-- SQL statement for the table structure and data for all other tables \n-- and any triggers associated with those tables \n--\n--\n-- SQL statements for all views, stored procedures, functions, and events \n--\n/*!40103 SET TIME_ ZONE=@OLD_ TIME_ ZONE */; \n/*!40101 SET character_ set_ client = @saved_ cs_ client */; \n/*!40103 SET TIME_ ZONE=@OLD_ TIME_ ZONE */; \n/*!50606 SET GLOBAL INNODB_ STATS_AUTO_ RECALC=@OLD_ INNODB_ STATS AUTO RECALC */; \n/*!40101 \n/*!40014 \n/*!40014 \n/*!40101 \n/*!40101 \n/*!40101 \n/*!40111 \nSET \nSET \nSET \nSET \nSET \nSET \nSET \nSQL_MODE=@oLD_ SQL_MODE */; \nFOREIGN_KEY_CHECKS=@OLD_ FOREIGN_KEY_CHECKS */; \nUNIQUE_ CHECKS=@OLD_UNIQUE_ CHECKS */; \nCHARACTER_ SET_ CLIENT=@OLD_ CHARACTER_ SET_CLIENT */; \nCHARACTER_ SET_ RESULTS=@OLD_ CHARACTER_ SET_ RESULTS */; \nCOLLATION_ CONNECTION=@OLD_ COLLATION_CONNECTION */; \nSQL_NOTES=@OLD_ SQL_NOTES */; \n-- Dump completed on 2019-01-10 15:36:10 \nFigure 19-3 \nA SQL script file for a database backup (part 2 of 2)\n\n572 \nSection 5 \nDatabase administration \nHow to set advanced options \nfor a database backup \nIn most cases, the options for the mysqldump program are set the way you \nwant. As a result, you typically only use the options shown in figure 19-2 to \ncreate database backups. However, the mysqldump program provides many \nadvanced options, such as the ones shown in figure 19-4 that let you change \nthe way the 1nysqldump program works. These options let you customize the \ngenerated SQL script file so it contains comments and SQL statements that work \nexactly the way you want. \nFor example, if you want to delete all old binary log files after the backup \nis complete, you can specify the --delete-master-logs option. In 1nost cases, you \ndon't want to do this in case there's a problem with the backup file. And you \ndefinitely don't want to do this if you're using replication, since it might prevent \nstatements from being relayed to other servers. However, if you're confident \nin the backup file and you're not using replication, you might want to use this \noption since it removes old files that are no longer needed. \nBy default, most of the options in this figure are enabled. For example, the \nfrrst six options are all enabled by default. As a result, you don't need to use the \nmysqldump program to specify these options. However, if you want to disable \nany of these options, you can preface them with ''skip-''. For example, to disable \nthe --add-locks option, you can use the --skip-add-locks option. \nIf you want to disable the frrst four options in this figure, you can specify \nthe --compact option. Then, the SQL script includes only the statements needed \nto back up the database. This takes less disk space, and it's particularly useful if \nyou're creating a new database and you know that other users won't attempt to \naccess this database as you're creating it.\n\nChapter 19 \nHow to back up an.d restore a database \n573 \nSome advanced options for the mysqldump program \nOption \nDescription \n--add-drop-table \n--add-locks \n--disable-keys \n--comments \n--quote-names \n--create-options \n--compact \n--compress \n- - delete-master- logs \n--force \nFor each table, add a statement that drops the table before the state-\n1nent that creates the table. \nFor each table, surround the INSERT statements with statements that \nlock and unlock the table. \nFor each table, surround the INSERT statements with statements that \ndisable and enable keys. \nInclude comments in the script \nEnclose names with backtick (') characters. \nInclude all MySQL-specific options in CREATE TABLE statements. \nCreate a more compact SQL script that include only the statements \nneeded to back up the database. Using this option is the same as \nspecifying the --skip-add-drop-table, --skip-add-locks, \n--skip-disable-keys, and --skip-comments options. \nUse compression in server/client protocol. \nDeletes all binary log files after performing the dump. \nCo11tinue even if the program encounters a SQL error. \nHow to use the ''skip'' prefix to disable an option \n--skip-add-drop-table \nDescription \n• \nThe mysqldump program contains many advanced options that you can use to \ncontrol how it works. \n• \nMany options that enable features also include a corresponding option for disabling \nthe option. These options usually begin with ''skip-''. \n• \nFor a complete list of options for the 1nysqldump program, look up this program in \nthe MySQL Reference Manual. \nFigure 19-4 \nHow to set advanced options for a database backup\n\n57 4 \nSection 5 \nDatabase administration \nHow to restore a database \nA backup of a database is only helpful if you can use it to restore the \ndatabase in the event of a hardware failure or other problem. So that's what \nyou'll learn to do in this topic. \nHow to use a SQL script file \nto restore a full backup \nFigure 19-5 shows how to use the mysql program to restore a full backup \nof one or more databases. To do that, you just use the mysql program to run the \nSQL script file that contains the full backup. \nIn this figure, the frrst example restores the AP database by running the \nbackup file for the AP database that was created by the first example in figure \n19-2. Here, the mysql program specifies that you should run this backup file \nagainst the AP database. As a result, for this example to work properly, the AP \ndatabase must exist on the MySQL server. If it doesn't, you must create this \ndatabase before you run the backup file, or you must edit the backup file so it \nincludes statements to create and select the database. You might edit the backup \nfile, for example, if you're copying the database to another server. \nOn the other hand, the second example assumes that the backup file includes \nthe statements that create the database or databases that you 're resto1ing. As \na result, you don't need to specify the name of the database on the mysql \ncom1nand. This example runs the file that was created by the second example in \nfigure 19-2, which backs up four databases. \nBefore you restore a database from a script file, it's generally considered \na good idea to back 11p the existing database. That way, if the restore operation \ndoesn't work correctly, you can restore the database back to its previous state. In \naddition, it's usually a good idea to open the SQL file for the backup and view it \nto make sure it does what you want. Then, if it doesn't, you can edit this file so \nit works the way you want it to work. For example, if you only want to restore a \nsingle table, you can delete all other statements in the backup file. \nYou can also use MySQL Workbench to restore databases by running a SQL \nfile that contains a full backup of those databases. To do that, select the Data \nImport/Restore option in the Ad1ninistration tab of the Navigator window, select \nthe ''Import from Self-Contained File'' option on the Import from Disk tab, enter \nthe path and name for the backup file, and click the Start Import button. In n1ost \ncases, this feature works correctly. If it doesn't, though, you can use the mysql \nprogram as described in this figure.\n\nChapter 19 \nHow to back up an.d restore a database \n575 \nHow to use the mysql program to restore databases \nA single database \nmysql ap < /murach/mysql/ap-2019-01-10.sql -u root -p \nMultiple databases \nmysql < /murach/mysql/backup-2019-01-10.sql -u root -p \nDescription \n• \nYou can use the mysql progra1n to restore one or 1nore databases by running the \nSQL sc1ipt file that contains the database backup. \n• \nBefore you restore a database from a script file, it's generally considered a good \nidea to back up the existing database in case the restore operation doesn't work \ncorrectly. \n• \nBefore you restore a database from a script file, you can open the SQL file and \nview it to make sure it does what you want. If it doesn't, you can edit this file. \n• If you get an error that indicates that access is denied, you may need to start the \ncommand prompt as an administrator. \n• \nIf a firewall is running on your computer, it may attempt to block the mysql \nprogram. However, if you allow the 1nysql program to access the database, it should \nwork properly. \n• \nOn a macOS system, you typically need to code a dot and slash(./) before the name \nof the mysql program to specify that it's in the cu1rent directory (the bin directory). \nFigure 19-5 \nHow to use a SOL script file to restore a full backup\n\n576 \nSection 5 \nDatabase administration \nHow to execute statements in the binary log \nFigure 19-6 begins by showing the files for a binary log named bin-log. \nHere, the bin-log.index file is a text file. This file contains a list of all of the \nnumbered files that store the changes that have been made to the database. These \nnumbered log ftles (bin-log.000001, bin-log.000002, etc.) are binary files. \nNext, this figure shows how to use the mysqlbinlog program to execute all \nor some of the statements in the binary log. To start, the frrst example shows how \nto execute all statements stored in a single binary log. Here, the mysqlbinlog \nprogram begins by specifying the path and name of the file. Then, it specifies \na pipe character (I) followed by ''mysql''. This indicates that the mysqlbinlog \nprogram uses the mysql program to execute the statements in the binary log. \nFinally, the -u option identifies a user with privileges to restore databases, and \nthe -p option specifies that the prog1·am should prompt for a password. \nWhen you restore data using a binary log as shown in the first example, \nevery statement for every database is executed by default. But what if you only \nneed to restore one database from the binary log? In that case, you can use the \n--database option to specify the name of that database as shown in the second \nexample. Or, what if you only want to execute statements that fall within a \nspecified date/time range? In that case, you can use one or both of the date/time \noptions to specify a sta1ting date/time, an ending date/time, or both a starting and \nan ending date/time. \nFinally, what if your binary log has been split across multiple files due to \nserver restarts or file size limits? In that case, you can specify a list of binary log \nfiles as shown in the fourth and fifth examples. In the fourth example, the names \nof the log files are separated by a space. This works for Windows, macOS, and \nUnix/Linux. For macOS and Unix/Linux, you can also use a regular expression \nto select all binary log files as shown in the fifth example. Although you might \nexpect that you could use a wildcard chai·acte1· to select binary log files with \nWindows (bin-log.*), this doesn't currently work with the mysqlbinlog program. \nHowever, it might work with future versions of this program.\n\nChapter 19 \nHow to back up an.d restore a database \n577 \nThe files for a binary log named bin-log \nbin-log.index \nbin-log.000001 \nbin-log.000002 \nbin-log.000003 \n••• \nHow to use the mysqlbinlog program to execute statements \nFor all databases \nmysqlbinlog /murach/mysql/bin-log.000001 I mysql -u root -p \nFor a specific database \nmysqlbinlog --database=ap /murach/mysql/bin-log.000001 I mysql -u root -p \nFor a specific time range \nmysqlbinlog --start-datetime=\"2019-0l-10 00:00:00 11 \n/murach/mysql/bin-log.000001 I mysql -u root -p \nFor all databases using multiple binary log files \nmysqlbinlog /murach/mysql/bin-log.000001 /murach/mysql/bin-log.000002 I \nmysql -u root -p \nFor all databases using multiple binary log files (macOS and Unix/Linux only) \nmysqlbinlog /murach/mysql/bin-log.[0-9]* I mysql -u root -p \nCommon options for the mysqlbinlog program \nOption \nDescription \n--database=db_name \n--start-datetime=datetime \n--stop-datetime=datetime \nDescription \nIdentifies the database. \nIdentifies the starting date/time. \nIdentifies the ending date/time. \n• \nYou can use the mysqlbinlog program to execute statements in the log file for all \ndatabases or for a specified database. You can also execute statements that fall \nwithin a specified date/time range. \n• \nIf the statements you want to execute are stored in multiple binary logs, you should \nspecify all of them on the command prompt in sequence from the lowest numbered \nlog file to the highest numbered log file. \n• \nOn a macOS system, you typically need to (1) begin by coding the sudo command, \n(2) code a dot and slash before the name of the mysqlbinlog program and the mysql \nprogram, and (3) specify a path to the data directory. For example, you can execute \nthe frrst example shown above like this: \nsudo . / mysqlbinlog .. /data/binlog.000001 I ./mysql -u root -p \n• \nIn addition, on macOS, you may find it helpful to specify a password like this: \nsudo ./mysqlbinlog .. /data/binlog.000001 I ./mysql -u root \n--password=sesame80 \nFigure 19-6 \nHow to execute statements in the binary log\n\n578 \nSection 5 \nDatabase administration \nHow to in,port and export data \nWhen you back up a database as shown earlier in this chapter, you can use \nthe backup script file to copy the database to another server. In that case, backing \nup the database can be referred to as exporting a database. Similarly, when you \nrestore a database from a backup that was performed on another server, it can be \nreferred to as importing a database. \nIn addition to exporting and importing an entire database, you may \nsometimes need to expo1t data from a database to a file or import data from a file \nto a database. For example, you may need to load shipping rates that are stored \nin a text file into a table. Or, you may need to export data so it can be used by \na spreadsheet program or imported by another database. Fortunately, MySQL \nmakes it easy to import and export data. \nHow to export data to a file \nFigure 19-7 shows how to export data to a file. To do that, you can add \nan INTO OUTFILE clause to a SELECT statement to save the result set in an \noutput file. By default, this clause uses a tab character (\\t) to separate, or deliniit, \ncolumns. And it uses a n.ew line character (\\n) to separate, or delimit, rows. \nWhen you store this type of data in a file, the file is known as a tab-delimited \nfile. This type of file is commonly used to store and transfer data. \nThe first example in this figure exports all data from the Vendor_ Contacts \ntable and stores it in a tab-delimited file named vendor_contacts.txt. Since this \nis a small table with ju.st three columns and eight rows, the SELECT statement \nexports the entire table. If necessary, though, you can limit the amount of data by \nincluding a column list and a WHERE clause. \nSince it's easy to export data to a tab-defunited ftle, and since this format \ncan be read by most other programs, this is the type of file that you usually want \nto use. However, if you need to export your data to another format, you can \ninclude the optional FIELDS clause to specify the delimiters for the columns and \nrows. For example, it's also common to store data in a comma-delimited file. To \nexport data to a comma-delimited file, you can include a FIELDS clause with a \nTERMINATED BY clause that indicates that every column should be terminated \nby a comma (,) and an ENCLOSED BY clause that indicates that each column \nshould be enclosed by double quotes (\"). In this figure, for instance, the second \nexample expo1ts the data in the Vendor_ Contacts table to a comma-delimited ftle. \nIn addition, if your data might contain a double quote character (\"), you \nalso need to include an ESCAPED BY clause to specify an escape character. \nThen, MySQL uses the escape character to identify any double quote characters \nthat are part of the data. In this figure, for instance, the second example uses a \nbackslash character as the escape character. Since the backslash character is used \nto escape special characters such as tabs (\\t), new lines (\\n), and single quotes \n(\\'), though, you must code two backslashes(\\\\) to use a backslash character as \nthe escape character.\n\nChapter 19 \nHow to back up an.d restore a database \n579 \nThe syntax of the SELECT statement for exporting data to a file \nSELECT colwnn list \nINTO OUTFILE file_path \n[FIELDS [TERMINATED BY string] \n[ENCLOSED BY char] \n[ESCAPED BY char]] \nFROM table name \n[WHERE search condition] \n[ORDER BY order_by_list] \nA tab-delimited file \nThe statement \nSELECT* \nINTO OUTFILE '/ProgramData/MySQL/MySQL Server 8.0/Uploads/vendor_contacts.txt' \nFROM vendor_contacts \nThe file contents when viewed in a text editor \n5 \nDavison Michelle \n12 \nMayteh \nKendall \n17 \nOnandonga \nBruce \n44 \nAntaviusAnthony \n76 \nBradlee Danny \n94 \nSuscipe Reynaldo \n101 \nO'Sullivan \nGeraldine \n123 \nBucket \nCharles \nA comma-delimited file \nThe statement \nSELECT* \nINTO OUTFILE '/ProgramData/MySQL/MySQL Server 8.0/Uploads/vendor_contacts.txt' \nFIELDS TERMINATED BY',' ENCLOSED BY ,n, ESCAPED BY\n' \\\\' \nFROM vendor contacts \nThe file contents \n\"5\",\"Davison\",\"Michelle\" \n\" 12 11 , \"Mayt eh\" , 11 Kendal 1 11 \n\"17 11 ,\n110nandonga 11 ,\n11Bruce 11 \n\"44 11 ,\n11Antavius 11 ,\n11Anthony\" \n\"76\",\"Bradlee\",\"Danny\" \n11 94\",\"Suscipe\",\"Reynaldo\" \n\"101\",\"0'Sullivan\",\"Geraldine\" \n11 123 11 ,\n11Bucket 11 ,\n11Charles 11 \nDescription \n• \nYou can add an INTO OUTFILE clause to a SELECT statement to save the result set in \nan output file. \n• \nYou can use the FIELDS clause to identify the character that's used to delimit columns, \nthe character that's used to delimit rows, and an escape character. \n• \nOn a Windows system, with MySQL 5.5 and later, you can usually store tl1e output file \nin the Uploads directory shown above. On a macOS system, you can sometimes store \nthe outpt1t file in the /tmp directory, but it's usually easier to use MySQL Workbench's \nexport data feature. \nFigure 19-7 \nHow to export data to a file\n\n580 \nSection 5 \nDatabase administration \nNote that both of the examples in figure 19-7 store the output ftle in the \nMySQL Uploads directory. With MySQL 5.5 and later, this is the only directory \nthat you can export a file to or import a file from by default. If you want to export \nto or import from a different directory, you can change the secure_file_priv \nsystem variable to that directory. Or, you can change this variable to an empty \nvalue so you can export to and import from any directory. This was the default \nwith releases of MySQL before 5.5. \nNote also that the directories in these examples are for a Windows system. \nFor macOS, you can sometimes store the output file in the /tmp directo1·y. \nHowever, later versions of MySQL often don't allow storing output files in any \ndirectory by default with macOS. In addition, it's difficult to enable this feature \nby setting the secure_file_priv system variable. As a result, you may want to \nlook for other ways to export data, such as using MySQL Workbench's export \ndata feature. \nHow to import data from a file \nFigure 19-8 begins by showing how to use the LOAD DATA statement to \nload data from an input ftle into a table. Specifically, it shows how to use this \nstatement to import the data that was exported by the examples in the previous \nfigure. \nTo start, you code a LOAD DATA clause that identifies the path and name of \nthe file. Then, you code an INTO TABLE clause that identifies the table that you \nwant to import the data into as shown in the first example in this figure. If you're \nworking with a tab-delimited file, that's all you need to do. If you 're working \nwith a co1nma-delimited file, though, you need to include a FIELDS clause that \nidentifies the delimiters and the escape character. In this figure, for instance, \nthe second example includes the correct delimiters and escape character for the \ncomma-delimited file that was created in the previous figure. \nFor an import to work successfully, the columns in the input file 1nust match \nthe columns in the table. In this figure, for example, the Vendor_Contacts table \nhas three required columns: an INT column followed by two VARCHAR(50) \ncolumns. As a result, MySQL must be able to convert the data that's stored in the \nvendor_contacts.txt file to the data types specified by the Vendor_Contacts table. \nIn addition, the data in the input file must not conflict with the values of \nany unique keys that are already stored in the rows of the table. If that happens, \nyou '11 get an error that indicates that you were attempting to make a duplicate \nentry. Usually, that's what you want. If it isn't, you can delete any duplicate \nentries from the table.\n\nChapter 19 \nHow to back up an.d restore a database \n581 \nHow to use the LOAD DATA statement to import data from a file \nThe syntax \nLOAD DATA INFILE file_path \nINTO TABLE table_name \n[FIELDS [TERMINATED BY string] \n[ENCLOSED BY char] \n[ESCAPE.D BY char]] \nA tab-delimited file \nLOAD DATA INFILE \n'/ProgramData/MySQL/MySQL Server 8.0/Uploads/vendor_ contacts.txt 1 \nINTO TABLE vendor contacts \nA comma-delimited file \nLOAD DATA INFILE \n'/ProgramData/MySQL/MySQL Server 8.0/Uploads/vendor_ contacts.txt 1 \nINTO TABLE vendor_ contacts \nFIELDS TERMINATED BY \n1 ,\n1 \nENCLOSED BY \n1111 \nESCAPED BY \nI \\ \n\\ \nI \nDescription \n• \nYou can use the LOAD DATA statement to load data from an input file into a table. \n• \nThe columns in the input file must match the columns in the table. \n• \nThe data in the input file must not conflict with the values of any unique keys that \nare already stored in the rows of the table. \n• \nYou can also use the mysqlimport program to load data from an input file into a \ntable. For more inforrr1ation, see the MySQL Reference Manual. \nFigure 19-8 \nHow to import data from a file\n\n582 \nSection 5 \nDatabase administration \nHow to check and repair tables \nWhen the server or operating system shuts down unexpectedly, the tables in \na database can become corrupted. When that happens, the users of the database \nwon't be able to access the table data. Then, you can use the tools MySQL \nprovides to determine which tables need to be repaired. In addition, you can \nuse MySQL tools to repair MyISAM tables. However, since the TnnoDB engine \nis typically able to recover from unexpected shutdowns on its own, MySQL \ndoesn't provide tools for repairing InnoDB tables. If it can't recover, though, you \ncan use the technique you'll leain in just a minute to restore the corrupted tables. \nHow to use the CHECK TABLE statement \nFigure 19-9 shows how to use the CHECK TABLE statement to check \ntables. This statement works for both InnoDB and MyISAM tables. In addition, \nthis statement works for views. \nIf the CHECK TABLE statement finds no problems with a table, it will mark \nthe table as OK as shown in the Msg_text column in all three examples in this \nfigure. This allows MySQL to begin using the table again. The CHECK TABLE \nstate1nent might also give you a message of ''Table is already up to date'' if it \nwasn't necessary to check the table. If it doesn't return either of these messages, \nyou should repair the table as described in the next figure. \nIn most cases, you'll use the CHECK TABLE statement to check a single \ntable or view using the default options as shown in the first example. However, \nif you need to check multiple tables or views, you can separate the names of the \ntables or views with commas as shown in the second example. \nIf you don't specify any options, the CHECK TABLE statement uses the \nMEDIUM option to do its check. However, if you need to change the default \noptions, you can specify them after the list of tables or views. For example, you \ncan specify the EXTENDED option to perform a more thorough check that takes \nlonger. Or, you can specify the QUICK option to perfor1n a less thorough check \nthat 1uns faster. To speed this check even further, you can specify the FAST or \nCHANGED options. These options automatically include the QUICK option, \nwhich is usually what you want. In this figure, for instance, the third example \nspecifies the FAST option. \nBefore you specify any of these options, you should know that they are \nignored by the InnoDB engine. As a result, if you 're checking an InnoDB table, \nyou don't need to code these options. The exception is the FOR UPGRADE \noption, which is used by both the InnoDB and MyISAM storage engines.\n\nChapter 19 \nHow to back up an.d restore a database \n583 \nThe syntax of the CHECK TABLE statement \nCHECK TABLE table_ list option_list \nOptions for the CHECK TABLE statement \nOption \nDescription \nEXTENDED \nMEDIUM \nQUICK \nFAST \nCHANGED \nFOR UPGRADE \nDoes a full scan of each row. This ensures that the table is \nI 00% consistent, but takes a long time. \nDoes an average scan of each row. This is the default for a \nMyISAM table. \nDoes a quick scan of the rows. \nChecks only tables that have not been closed properly. \nUses the QUICK option. \nChecks only tables that have been changed since the last check \nor that have not been closed properly. Uses the QUICK option. \nChecks whether the tables are compatible with the current \nrelease of M ySQL. \nA statement that checks a single table \nCHECK TABLE vendors \nTable \nOp \nMsg_type \n► \nap.vendors \ncheck \nstatus \nMsg_text \nOK \nA statement that checks multiple tables and views \nCHECK TABLE vendors, invoices, terms, invoices_outstanding \nTable \nOp \nMsg_type \nMsg_text \n► \nap.vendors \ncheck \nstatus \nOK \nap. i'lvoices \ncheck \nstatus \nOK \nap.terms \ncheck \nstatus \nOK \nap. l'lVOICeS _ou tstancling \ncheck \nstatus \nOK \nA statement that uses an option \nCHECK TABLE vendors, invoic es FA.ST \nTable \nOp \nMsg_type \nMsg_text \n-\n► \nap. vendors \ncheck \nstatus \nOK \nap.tnVoices \ncheck \nstatus \nOK \nDescription \n• \nThe CHECK TABLE statement works for InnoDB and. My ISAM tables and views. \n• \nAll of the options except for FOR UPGRADE are ignored by the InnoDB engine. \nThis engine automatically performs a thorough check that detects most problems. \nIf it finds a problem, the server shuts down to prevent the problem from getting \nworse. \nI \nI \n.I \nI \n• \nThe FOR UPGRADE option is useful if you upgrade to a newer release of MySQL. \nIn that case, a change in the new release might make data from the old release \nincompatible with the new release. \n• \nThe CHECK TABLE statement works only when the server is running. \nFigure 19-9 \nHow to use the CHECK TABLE statement\n\n584 \nSection 5 \nDatabase administration \nHow to repair a MylSAM table \nFigure 19-10 shows how to use the REPAIR TABLE statement to repair \ncorrupted MyISAM tables. This statement works much like the CHECK TABLE \nstatement. However, it has fewer options, so it's easier to use. In addition, the \nREPAIR TABLE statement doesn't work for InnoDB tables. \nWhen you use the REPAIR TABLE statement, the repair operation can \nsometimes cause the table to lose data. As a result, it's generally considered \na best practice to make a backup of a table before performing a repair. That's \nespecially true if it's critical to retain all data. \nAs it repairs a table, the REPAIR TABLE statement checks whether an \nupgrade is required. If so, it automatically performs the same upgrade opera-\ntion that's performed by the FOR UPGRADE option of the CHECK TABLE \nstatement. \nHow to repair an lnnoDB table \nIf the CHECK TABLE statement finds a problem with an InnoDB table, the \nserver shuts down to prevent the problem from getting worse. Because of that, \nyou have to use the procedure shown in figure 19-10 to repair an InnoDB table. \nTo start, you add the innodb_force_recovery system variable to the MySQL \nconfiguration file. Although you can code different values for this variable, a \nvalue of 4 is typically sufficient. To learn more about this value and the other \nvalues you can code, see the MySQL Reference Manual. \nOnce you've added the innodb_force_recovery system variable, you can \nrestart the server. Then, you should be able to back up the database that contains \nthe corrupted tables as described earlier in this chapter. Next, you remove the \ninnodb_force_recovery variable from the configuration file and restart the se1ver. \nFinally, you can restore the database from the backup you just created. \nIn most cases, this procedure will fix the corrupted tables and restore most \nof the data. If it doesn't, you can use your last full backup and your incremental \nbackups to restore the database.\n\nChapter 19 \nHow to back up an.d restore a database \n585 \nHow to repair a MylSAM table \nThe syntax of the REPAIR TABLE statement \nREPAI R TABLE tabl e _ l i st option_list \nCommon options for the REPAIR TABLE statement \nOption \nDescription \nQUI CK \nPerforms a standard repair that fixes most common problems. \nEXTENDED \nPerforms a more extended repair. \nA statement that repairs a single table \nREPAIR TABLE vendor s \nA statement that repairs two tables and uses an option \nREPAIR TABLE vendors, i nvoices QUICK \nHow to repair an lnnoDB table \n1. Use a text editor as described in chapter 17 to add this system variable to the \nconfiguration file: \ni nnodb_ force _ r e c ov e ry=4 \n2. Restart the server, and then use the mysqldump program to back up the database. \n3. Remove the innodb_force_recovery variable from the configuration file, restart the \nserver, and restore the database to fix the corrupted tables and restore as much data \nas possible. \nDescription \n• \nTo repair a MyISAM table, you can use the REPAIR TABLE statement. This state-\nment works only when the server is running. \n• \nThe REPAIR TABLE statement checks the table to see whether an upgrade \nis required. If so, it automatically pe1forms the same upgrade operation that's \nprovided by the FOR UPGRADE option of the CHECK TABLE statement. \n• \nIt's generally considered a best practice to make a backup of a table before \nperforming a table repair operation, since a table repair operation can so1netimes \ncause you to lose data. \n• \nTo repair an InnoDB table, you use the procedtrre shown above. The \ninnodb_force_recovery system variable allows the server to restart so you can back \nup and then restore the database that contains the corrupt tables. \n• \nIf restoring the database doesn't fix the corrupted tables, you can use your last full \nbackup and your incremental backups to restore the database. \nFigure 19-10 \nHow to repair tables\n\n586 \nSection 5 \nDatabase administration \nHow to use the mysqlcheck program \nFigure 19-11 shows how to use the mysqlcheck program to perform the \nsame kinds of checks and repairs that you can perform with the CHECK TABLE \nand REPAIR TABLE statements. If you understand how these statements work, \nyou shouldn't have much trouble understanding how to use the mysqlcheck \nprogram. The advantage of using the mysqlcheck program is that it allows you to \ncheck all tables in a database without having to specify the name of each table. \nAs usual, if you're using a macOS system, you typically need to code a dot \nand slash (./) before the name of the mysqlcheck program. This indicates that \nthis program is in the current directory (the bin directory).\n\nChapter 19 \nHow to back up an.d restore a database \n587 \nHow to use the mysqlcheck program to check tables \nFor a single database \nmysqlcheck ap -u root -p \nFor multiple databases \nmysqlcheck --databases apex om -u root -p \nFor all databases \nmysqlcheck --all-databases -u root -p \nFor specified tables within a database \nmysqlcheck ap vendors invoices -u root -p \nFor a quick check \nmysqlcheck ap --quick -u root -p \nFor an extended check \nmysqlcheck ap --extended -u root -p \nCommon options for checking tables \nOption \nCorresponding CHECK TABLE option \n--extended \n--medium-check \n--quick \n--fast \n--check-only-changed \n--check-upgrade \nEXTENDED \nMEDIUM \nQUICK \nFAST \nCHANGED \nFOR UPGRADE \nHow to use the mysqlcheck program to repair tables \nFor a standard repair \nmysqlcheck ap --repair -u root -p \nFor an extended repair \nmysqlcheck ap --repair --extended -u root -p \nCommon options for repairing tables \nOption \nDescription \n• \n--repair \n--extended \n- -quick \nDescription \nPerforms a repair that fixes most common problems . \nA more extended repair than the standard repair. \nA faster repair than the standard repair. \n• \nThe mysqlcheck program uses the CHECK TABLE and REPAIR TABLE state-\nments to check and repair one or more tables. \n• \nMost of the check and repair options are ignored by the InnoDB engine. \n• \nYou can only use the mysqlcheck program when the server is running. \nFigure 19-11 \nHow to use the mysqlcheck program\n\n588 \nSection 5 \nDatabase administration \nHow to use the myisamchk program \nFigure 19-12 shows how to use the myisamchk program to check and \nrepair My ISAM tables. If you understand how to use the mysqlcheck program \ndescribed in the previous figure, you shouldn't have much trouble understanding \nhow this program works. \nThe advantage of the myisamchk program is that you can use it while the \nserver is stopped. If, for example, the server won't start due to corrupted tables, \nyou can use the myisamchk program to attempt to repair those tables. However, \nyou should not attempt to use the myisamchk program if the server is running. \nThat's because this program won't work if another program is using the same \ntable. In that case, you should use one of the other techniques presented in this \nchapter. \nWhen you use the myisamchk program, you need to point to the table in the \nftle system. To do that, you begin by coding the path to the MySQL data direc-\ntory. Then, you code the name of the database followed by the name of the table. \nIn this figure, for instance, all examples specify a path to the Engine_Sample \ntable in the EX database. The MySQL data directory shown in these examples is \nthe default path on a Windows system. However, this path will be different on a \nmacOS or Unix/Linux system. \nUnlike the CHECK TABLE statement and the mysqlcheck program, you can \nboth check a table and repair it using a single myisamchk command. To do that, \nyou use the --force option as shown in the last example in this figure. Then, if \nthe program finds a problem with the table, it automatically repairs it. \nIf you're using a macOS system, you typically need to begin with the sudo \ncommand, code a dot and slash (./) before the name of the myisamchk program, \nand specify the data directory. For example, you can execute the frrst example in \nthis figure like this: \nsudo ./myisamchk \n11 •• /data/ex/engine_ sample\"\n\nChapter 19 \nHow to back up an.d restore a database \n589 \nHow to use the myisamchk program to check a table \nFor a standard check \nmyisamchk \" / ProgramData/ MySQL/ MySQL Server 8.0 / Data/ex/ engine_ sample\" \nFor a medium check \nmyisamchk --medium-check \n\" / ProgramData/ MySQL/ MySQL Server 8.0 / Data/ ex/ engine_ sample\" \nFor an extended check \nmyisamchk --extend-check \n\" / PrograrnD~ta/ MySQL/MySQL Server 8.0 / Data/ ex/ engine_ sample\" \nCommon options for checking a table \nOption \nCorresponding CHECK TABLE option \n--extend-check \n--medium-check \n--check \n--fast \n--check- only-changed \n--force \nEXTENDED \nMEDIUM \nQUICK \nFAST \nCHANGED \nNone. Automatically repairs the table if errors \nare found. Uses the --recover option. \nHow to use the myisamchk program to repair a table \nFor a standard repair \nmyisamchk --recover \n\" / ProgramData/ MySQL/ MySQL Server 8.0 / Data/ ex/ engine_ sample\" \nFor a quick repair \nmyisamchk --recover --quic k \n\"/ProgramData/ MySQL/ MySQL Server 8.0 / Data/ ex/ engine_ sample\" \nFor an extended repair \nmyi9amchk --safe-recover \n\" / PrograrnData/MySQL/ MySQL Server 8.0 / Data/ ex/ engine_ sample\" \nCommon options for repairing a table \nOption \nDescription \n--recover \n--quick \n--safe-recover \nPerforms a standard repair that fixes most common problems. \nA faster repair than the standard repair. \nA more extended repair than the standard repair. \nA command that checks a table and repairs it if necessary \nmyisamchk --force \n\" / ProgramData/ MySQL/ MySQL Server 8.0/Data/ ex/ engine_ sample\" \nDescription \n• \nThe myisamchk program can check and repair MyISAM tables. \n• \nYou should only use the myisamchk program when the server is stopped. \nFigure 19-1 2 \nHow to use the myisamchk program\n\n590 \nSection 5 \nDatabase administration \nPerspective \nIn this chapter, you learned how to back up your databases and how to \nrestore them if necessary. If you combine these skills with the skills you \nlearned in the previous chapter for securing a database and working with user \naccounts, you are on your way to becoming a successful database adminis-\ntrator. Of course, there's much more to learn than what's presented here. If \nyou're interested in learning more, I recommend you get a book specifically on \ndatabase administration. \nTerms \nback up a database \nrestore a database \nfull backup \nincremental backup \npoint-in-time recovery (PITR) \ndump a database \nexport a database \nimport a database \ndelimit columns or rows \ntab-delimited file \ncomma-delimited file \nescape character\n\nChapter 19 \nHow to back up an.d restore a database \n591 \nExcercise \nIn this exercise, you back up a database to create a backup script file. Then, you \nmake some changes to the database and delete it. Finally, you restore the database \nfrom the backup script and the binary log file. \nBack up a database \nI. \nIf it isn't already enabled, enable binary logging as described in chapter 17. \n2. \nStart a command prompt and use the mysqldump program to create a full backup \nof the AP database. This backt1p should include the structure and data for the \ndatabase, as well as any stored routines, functions, and events for the database. \nAfter the dump, leave the command prompt open. \n3. \nStart MySQL Workbench and open the backup script that was created by the \nmysqldump program. Make sure that this script contains all the SQL statements \nneeded to restore the structure and data of the database. If necessary, add the \nCREATE DATABASE statement that creates the AP database and the USE state-\nment that selects it. \n4. \nUse MySQL Workbench to execute an INSERT statement that inserts one row \ninto the Vendors table of the AP database, and note the time on your computer \nthat this statement is executed. \n5. \nWait until the time on your computer changes to at least the next minute. Then, \nuse MySQL Workbench to delete the row you just added. \nRestore a database \n6. \nSwitch back to the command prompt and use the mysql program to run the \nbackup script. This should restore the entire AP database. \n7. \nIdentify the highest numbered file for the binary log. Then, switch back to \nthe command prompt and use the mysqlbinlog program to add the row to the \nVendors table that you inserted in step 4. To do that, you'll need to include start \nand end times that include the INSERT statement but omit the DELETE state-\nment you executed in step 5.\n\n• IX \nHow to install the software \nfor this book on Windows \nBefore you begin reading this book, we recommend that you install two \nproducts: (1) the MySQL Community Server and (2) MySQL Workbench. Both \nof these products are available for free from the MySQL website, and you can \ndownload and install them on your computer as described in this appendix. \nAfter you install these products, we recommend that yot1 download \nthe source files for this book that are available from the Murach website \n(www.murach.com). Then, we recommend that you run the SQL script that \ncreates the databases that are used throughout this book. \nWhen you've installed all of the products described in this appendix, \nyou're ready to gain valuable hands-on experience by doing the exercises that \nare presented at the end of each chapter. To start, chapter 2 shows how to use \nMySQL Workbench to run the SQL state1nents against a MySQL database. \nThen, as you progress through the rest of the book, you can use MySQL \nWorkbench to open the SQL statements that are installed on your computer \nand run them against the databases that are installed on your computer. \nThis appendix assumes that you 're using Microsoft Windows as your \noperating system. If you want to install the software for this book on a macOS \nsystem, please see appendix B. Or, if you want to install the software for \nthis book on another operating system such as Linux, the MySQL website \nprovides instructions for installing the MySQL Community Server and \nMySQL Workbench on most modern operating systems. \nHow to install the software from mysql.com ................... 594 \nHow to i nstaJl the MySQL Com1nunity Server ........................................... 594 \nHow to install MySQL Workbench ............................................................. 594 \nHow to install the software from murach.com ................ 596 \nHow to install the source files for this book ................................................ 596 \nHow to create the databases for this book ................................................... 598 \nHow to restore the databases ....................................................................... 598\n\n594 \nAppendix A \nHow to install the software for this book on Windows \nHow to install the software \nfron, n,ysql.con, \nThis topic shows how to install the MySQL Community Server and MySQL \nWorkbench. Both of these software products are available for free from the \nMySQL website. The procedures for installing these products were tested \nagainst MySQL Community Se1-ver 8.0 and MySQL Workbench 8.0. However, \nyou should be able to use similar procedures to install earlier and later releases \nof these products. \nHow to install the MySQL Community Server \nMySQL Community Server is a database server that's free and easy to use. \nSince it's designed to run on most modem computers, it's ideal for developers \nwho want to install it on their own computer so they can learn how to work with \na MySQL database. That's why this book assumes that you have installed the \nCommunity Server on your computer as shown in figure A-1. \nWhen you install MySQL on your computer, you need to specify a password \nfor the root user. When you do, make sure to remem,ber the password that you \nenter. If security isn't a concern for you as you're learning, we recommend using \n''sesame80'' as the password. That way, the password will be easy to remember. \nAll of the SQL statements presented in this book have been tested against \nMySQL Community Server 8.0. As a result, you can use the statements \npresented in this book with this release of the database. Since MySQL is \nbackwards compatible, these statements should also work with future releases of \nMySQL. In addition, most statements presented in this book work with earlier \nreleases of MySQL, and we have done our best to identify any statements that \ndon't. \nHow to install MySQL Workbench \nMySQL Workbench is a free graphical tool that makes it easier to work with \nMySQL databases. Since MySQL Workbench is an ideal tool for learning how to \nwork with MySQL, it is bundled with the Community Server in one convenient \ninstallation package. As a result, if you use the MySQL Installer to install the \nCommunity Server as described in figure A-1, you also get MySQL Workbench. \nAll of the skills for working with MySQL Workbench that are presented in \nthis book were tested against release 8.0. As a result, if you're using this release \nof MySQL Workbench, these skills should work exactly as described. However, \nMySQL Workbench is being actively developed and is changing quickly. As a \nresult, if you're using a later release of MySQL Workbench, these skills may not \nwork exactly as described, but they should work similarly.\n\nAppendix A \nHow to install the software for this book on Windows \n595 \nThe URL for the MySQL Installer \nhttp s : //dev .mysql . com/downloads/installer/ \nHow to install MySQL Community Server and MySQL Workbench \n1. Find the download page for the MySQL Installer for Windows. This page is \ncurrently available at the URL shown above. If necessary, you can search the \nInternet for ''MySQL Installer for Windows''. \n2. Follow the instructions provided on that web page to download the installer file of \nyour choice to your hard drive. There are two types of installer packages: (1) a full \nbundle, which is around 300MB and (2) a web installer, which is around 16MB. \nThe full bundle includes all of the MySQL products (including the MySQL server). \nThe web package contains the Installer and configuration files, and only downloads \nthe MySQL products you choose to install. \n3. Find the installer file on your hard drive, run it, and select the Custom option f1·om \nthe Choosing a Setup Type page. \n4. From the Select Products and Features page, expand the MySQL Servers node \nand the subordinate nodes in the Available Products list, select the release to be \ninstalled, and click the right arrow to add it to the Products/Features To Be Installed \n]jst. Do the same for MySQL Workbench, which you'll find under the Applications \nnode. \n5. Complete the re1naining pages to install MySQL Server and MySQL Workbench \nand configure MySQL Server. You can accept most of the default configuration \noptions, but be sure to specify a password for the root user on the Accounts and \nRoles page. Make sure to remember the passwo,-d tliat you enter. If security isn't \na concern for you as you 're learning, 1'Ve recommend using \"sesame80 '' as the \npassword. \n6. To make sure that the database has been installed correctly, start MySQL \nWorkbench when the installation is finished. Then, use the password you entered in \nthe previous step to log in to the database server as the root user. For more informa-\ntion, see figure 2-2 in chapter 2. \nNotes \n• \nIf you install products in addition to MySQL Server and MySQL Workbench, your \ncon1puter 1nay be missing a requirement for one or more products. Then, a Check \nRequirements page is displayed listing those requirements. If the requirement \nindicates that it must be resolved mantially, you can click on it for information on \nhow to do that. \n• \nYou can also install MySQL Server and MySQL Workbench separately. For more \ninfor1nation about that, you can visit the Downloads page of the MySQL website. \n• \nTo make it easy to start MySQL Workbench, you may want to pin the program to \nyour taskbar or add a shortcut to your desktop. \nFigure A-1 \nHow to install MySQL Community Server and MySQL Workbench\n\n596 \nAppendix A \nHow to install the software for this book on Windows \nHow to install the software \nfron, n,urach.con, \nOnce you have installed the MySQL software products, we recommend that \nyou install the source files for this book. In addition, we recommend that you \ncreate the databases that are used throughout this book. \nHow to install the source files for this book \nFigure A-2 shows how to install the source files for this book. This includes \na SQL script that you can use to create the databases that are used throughout \nthis book as described in the next figure. It includes SQL scripts that contain the \nSQL code for all of the examples in this book. And it includes the SQL scripts \nthat contain the solutions to the exercises that are at the end of each chapter. \nThe source files for this book are contained in a self-extracting zip file \n(an exe file) that you can download from www.murach.com. When you \ndownload and execute this file, it will unzip the SQL script files for the book \ninto the C:\\murach\\mysql directory. Within this directory, you can find the \nsubdirectories that contain the source files as shown in this figure.\n\nAppendix A \nHow to install the software for this book on Windows \n597 \nThe default installation directory for the source files \nC: \\ murach \\ mysql \nHow to download and install these files \n1. Go to www.murach.co1n and navigate to the page for Murach's MySQL (3rd Edition). \n2. Scroll down the page until you see the ''FREE downloads'' tab and then click on it. \nThen, click on the DOWNLOAD NOW button for the exe file for Windows. This \nwill download a setup file named msq3_allfiles.exe onto your hard drive. \n3. Use Windows Explorer or File Explorer to fmd the exe file. Then, double-click \nthis file and respond to the dialog boxes that follow. If you accept the defaults, this \ninstalls the sot1rce files into the directory shown above. \nThe directories that contain the source files \nI Directory \nContains \ndb_ setup \nThe SQL script that's used to create the three databases for this book. \nbook_ scripts \nThe SQL scripts for all of the examples presented in this book. \nex_ solutions \nThe SQL scripts for the solutions to the exercises that are at the end \nof each chapter. \ndiagrams \nThe MySQL Workbench file for the diagram that's presented in chapter I 0. \njava \nThe source code for the Java application that's presented in chapter 1. \nphp \nThe source code for the PHP application that's presented in chapter I . \nThe databases \nDatabase \nDescription \nap \nom \nex \nDescription \nThe AP (Accounts Payable) database. This is the \nprimary database that's used in this book. \nThe OM (Order Management) database. This database \nis used in some of the examples in this book. \nThe EX (Exam\"ples) database. This database contains \nseveral tables that are used for short examples. \n• \nAll of the source files described in this book are in a self-extracting zip ftle (an exe \nfile) that can be downloaded from www.murach.com. \nFigure A-2 \nHow to install the source files for this book\n\n598 \nAppendix A \nHow to install the software for this book on Windows \nHow to create the databases for this book \nBefore you can run the SQL statements presented in this book, you need to \ncreate the three databases desc1ibed in the previous figure. The easiest way to \ndo that is to use MySQL Workbench to run the SQL script that's stored in the \ncreate_databases.sql file. The procedure for doing this is described in figure A-3. \nTo determine if the SQL script ran successfully, you can review the results \nin the Output window. In this figure, for example, the Output window shows a \nseries of statements that have executed successful! y. In addition, the Schemas tab \nof the Navigator window shows that the thl·ee databases have been created. The \nother database, named sys, is a database that comes with MySQL. \nIf the script encounters problems, MySQL Workbench displays one or more \nerrors in the Output window. Then, you can read these errors to figure out why \nthe script isn't executing correctly. \nBefore you can run the create_databases.sql script, the database server must \nbe running. By default, the database server is automatically started when you \nstart your computer, so this usually isn't a problem. However, if it isn't running \non your system, you can start it as described in chapter 2. \nHow to restore the databases \nAs you work with the code that's presented in this book, you may make \nchanges to the databases or tables that you don't intend to make. In that \ncase, you may want to restore the databases to their original state so your \nresults match the results shown in this book. To do that, you can run the \ncreate_databases.sql file again. This drops the three databases described in this \nappendix and recreates them.\n\nAppendix A \nHow to install the software for this book on Windows \nThe directory that contains the create_databases.sql file \nC: \\ murach\\ mysql \\ db_ setup \nMySQL Workbench after executing the create_databases.sql file \n■ \nMySQl Worltbench \n□ \nX \n6 \nLocal 11\\Slance MySQL.80 ,c \nFile \nEd1 v.-\nOUl!fY \nDatabase \nSefver \nT()Ojs \nScriptmo \nHelp \nNavigator \nSOiEMAS \n0. !Filter objem \n► \nom \n► \nex \n► \nap \n► \n!}YS \n!:\\'° \nLini1 1o 1000 nrM \n• \n--o I 1J o. rn: ~ \n,.. \nT \n~ -\n9 \n10 \nC \nll • \nDROP DATABASE IF E~ \n12 • \nOlEATE DATABASE ap; \n13 \n14 \ne \nthe \n15 • \nUSE ap; \n16 \n17 \n<~ene \nl • \nE • \nEr~R:::u:~~~::eral_led:_accounts \n21 \nI account:description \nVARCHAR( \n) \nExecute SQL Script \nbutton \nOpen a SQL \nScript File button \nPRIMARY KEY, \nIJHIQUE \n< \n> \nV \nt:- . --- ·-\n·-\n·- ·----------------===------=--------------------------•·-1 \nOulPul \ndi Actiorl ~ \n• \nAdm,mstrabon \nSchemas \n• \nTime \n-\nlllformabo11 \n0 \n51 111346 CREATE D.A.TABASEom \nNo objttl ~k-cted \n0 \n52 111347 USEom \n0 \n53 11:13.47 CREATETABL.Ecuatomen1 ( cualomer_ld \n0 \n54 11·1349 CREATE TABLElems ( lem_d \nINT \n0 \n55 11·13:52 CREATETABLE~( order...Jd \nINT \n0 \n56 11:13:55 CREATE TABLE order_datais I order_d \nINT \nM&,g♦ \n1 row(s) affected \n0 row(s) affected \nINT . 0 row(s) affected \nNOT \nO row(s) affected \nNO... 0 row(s) affected \n_ 0 row(sl affected \nDum,on/ Flld'I \n\" \n0.516 sec \n0 000 ,ec \n2.484eec \n2 469sec \n3.078sec \n1.578sec \nObJea Info \nSesSJon \n0 \n57 11.13.56 INSERT INTO ruslome,s VALUES (1.'l<orah'.'Blanca'.... 25 mw(s) affected Reccrds. 25 Dlc,licates. 0 Wa,mg .. 0.266 sec \n0 \n58 1113.57 INSERTINTOlemsttem.)d.tile,llrtl!ll,uni.J)rice}VAl ... \nlOrow(s)alfectedRecxnls. 10 ~ates. 0 Wa,mg ... 0531,ec \n0 \n59 11.13.57 INSERT INTO Oldels VALUES (19. 1. \"2012-10-23'. '2... \n47 row(s)affected Recads. 47 [AJpk:ates. 0 Warmg .. 1.047 sec \nHow to create the databases \n1. Start MySQL Workbench. \n2. Connect as the root user to an instance of MySQL that's running on the localhost \ncomputer. To do that, click on the stored connection named ''Local instance \nMySQL'' and enter the password for the root user if prompted. \n3. Open the create_databases.sql file by clicking the Open a SQL Script File button \nin the SQL Editor toolbar. Then, use the resulting dialog box to locate and open the \nfile. When you do, MySQL Workbench displays this script in a code editor tab. \n4. Execute the scri_pt by clicking the Execute SQL Script button in the code editor \ntoolbar. When you do, the Output window displays messages that indicate whether \nthe script executed successfully. \nHow to restore the databases \n• \nRun the create_databases.sql script again to drop the databases and recreate them. \nDescription \n• \nFor the create_databases.sql file to run, the database server must be running. By \ndefault, the database server is automatically started when you start your computer. \nIf it isn't running on your system, you can start it as described in chapter 2. \nFigure A-3 \nHow to create and restore the databases for this book \n599\n\n• IX \nI I \nHow to install the software \nfor this book on macOS \nBefore you begin reading this book, we recommend that you install two \nproducts: (1) the MySQL Community Server and (2) MySQL Workbench. Both \nof these products are available for free from the MySQL website, and you can \ndownload and install them on your computer as described in this appendix. \nAfter you install these products, we recommend that yot1 download \nthe source files for this book that are available from the Murach website \n(www.murach.com). Then, we recommend that you run the SQL script that \ncreates the databases that are used throughout this book. \nWhen you've installed all of the products described in this appendix, \nyou're ready to gain valuable hands-on experience by doing the exercises that \nare presented at the end of each chapter. To start, chapter 2 shows how to use \nMySQL Workbench to run SQL statements against a MySQL database. Then, \nas you progress through the rest of the book, you can use MySQL Workbench \nto open the SQL statements that are installed on your computer and run them \nagainst the databases that are installed on your computer. \nThis appendix assumes that you 're using mac OS as your operating \nsystem. If you want to install the software for this book on a Microsoft \nWindows system, please see appendix A. Or, if you want to install the \nsoftware for this book on another operating system such as Linux, the \nMySQL website provides instructions for installing the MySQL Community \nServer and MySQL Workbench on most modem operating systems. \nHow to install the software from mysql.com ................... 602 \nHow to i nstaJl the MySQL Com1nunity Server .......................................... 602 \nHow to install MySQL Workbench ............................................................ 604 \nHow to install the software from murach.com ................ 606 \nHow to install the source files for this book ............................................... 606 \nHow to create the databases for this book .................................................. 608 \nHow to restore the databases ...................................................................... 608\n\n602 \nAppendix B \nHow to install the software for this book on macOS \nHow to install the software \nfron, n,ysql.con, \nThis topic shows how to install the MySQL Community Server and MySQL \nWorkbench. Both of these software products are available for free from the \nMySQL website. The procedures for installing these products were tested \nagainst MySQL Community Se1-ver 8.0 and MySQL Workbench 8.0. However, \nyou should be able to use similar procedures to install earlier and later releases \nof these products. \nHow to install the MySQL Community Server \nMySQL Community Server is a database server that's free and easy to use. \nSince it's designed to run on most modem computers, it's ideal for developers \nwho want to install it on their own computer so they can learn how to work with \na MySQL database. That's why this book assumes that you have installed the \nCommunity Server on your computer as shown in figure B-1. \nWhen you install the Community Server on your computer, the root user is \ncreated automatically so you can log in to the server. In addition, the installation \nprocess requires you to assign a password of at least 8 characters to the root user. \nIf security isn't a concern as you're learning, we recommend that use a password \nof ''sesame80''. Of course, a password of ''sesame80'' is a weak password. So, \nfor a production system, you'd want to assign a stronger password to the root \nuser that can't be easily cracked. Whatever you do, make sure to remember the \npassword that you 11se ! \nIn addition to the server itself, the download for MySQL Community Server \nincludes the MySQL preference pane. You can use the MySQL p1·eference \npane shown in this figure to start and stop the server and to control whether the \nMySQL server starts automatically when you start yom· computer. \nAll of the SQL statements presented in this book have been tested against \nthe MySQL Community Server 8.0. As a result, you can use the statements \npresented in this book to work with this release of the database. Since MySQL \nis backwards compatible, these statements should also work with future releases \nof MySQL. In addition, most statements presented in this book work with earlier \nreleases of MySQL, and we have done our best to identify any statements that \ndon't.\n\nAppendix B \nHow to i11stall the software for this book on macOS \n603 \nThe URL for downloading the MySQL Community Server \nhttp://dev.mysql.com/downloads/mysql/ \nHow to download and install the MySQL Community Server \n1. Find the download page for the MySQL Community Server. This page is currently \navailable at the URL shown above. If necessary, you can search the Internet for \n''MySQL Community Server download''. \n2. Follow the instructions provided on that web page to download the appropriate disk \nimage (DMG) file for your operating system to your hard disk. \n3. Find the DMG file on your hard disk and double-click it. This opens a window with a \npackage (PKG) file in it with a filename like rnysql-8.0.13-macos10.14-x86_64.pkg. \n4. Double-click the PKG file for MySQL, and respond to the resulting dialog boxes \nto install it. You can accept most of the default options and specify a password for \nthe root user. Make sure to remember the password that you enter. If security isn't a \nconcern for you as you're learning, we ,·ecommend using \"sesame80\" as the password. \n5. Make sure MySQL has been installed correctly by going to System Preferences under the \nApple menu and clicking on the MySQL icon. If the MySQL preference pane indicates \nthat the server is running or if you cru1 start the server, MySQL is installed correctly. \nThe MySQL preference pane \n• \n< \nINS \n-\n..... \n•••• \n• ••• \ne \nMySQL 8.0.13 \nDAT \nTO \nDescription \nInstances \nMySQL \n0. Se rch \nConfiguration \n8.0.13 \nStop MySQL Server \n-\nD Start MySQL when your computer starts up \nInitialize Database \nUninstall \n• \nYou can use the MySQL preference pane to start and stop MySQL and to control \nwhether MySQL starts automatically when you start your computer. \n• \nTo display the MySQL preference pane, use the Apple ment1 to display the System \nPreferences dialog box. Then, click the MySQL icon. \nFigure B-1 \nHow to install the MySQL Community Server\n\n604 \nAppendix B \nHow to install the software for this book on macOS \nHow to install MySQL Workbench \nMySQL Workbench is a free graphical tool that makes it easy to work with \nMySQL databases. To install MySQL Workbench, you can use the fu·st proce-\ndure in figure B-2. \nAfter you install MySQL Workbench, you should make sure that it's config-\nured for use with this book. To do that, you may need to add a connection as \ndescribed in the second procedure in this figure. \nAll of the skills for working with MySQL Workbench that are presented in \nthis book were tested against release 8.0. As a result, if you're using this release \nof MySQL Workbench, these skills should work exactly as described. However, \nMySQL Workbench is being actively developed and is changing quickly. As a \nresult, if you're using a later release of MySQL Workbench, these skills may not \nwork exactly as described, but they should work similarly.\n\nAppendix B \nHow to i11stall the software for this book on macOS \n605 \nThe URL for downloading MySQL Workbench \nhttp://dev.mysql.com/downloads/workbench/ \nHow to download and install MySQL Workbench \n1. Find the download page for MySQL Workbench. This page is currently available \nat the URL shown above. If necessary, yot1 can search the Internet for ''MySQL \nWorkbench download''. \n2. Follow the instructions provided on that web page to download the disk image \n(DMG) file for MySQL Workbench. \n3. Find the DMG file on your hard disk and double-click on it. Then, respond to the \nresulting dialog boxes. \nHow to configure MySQL Workbench for this book \n1. Start MySQL Workbench. \n2. If the MySQL Connection section of the Home tab contains a connection \nnamed ''Local Instance 3306'', you can use that connection to code and run SQL \nstatements. \nIf the MySQL Connections section doesn't include a connection, you'll need to create one \nso you can use it to code and run SQL statements. To do that, click the + icon to the right \nof MySQL Connections section. Then, enter ''Local instance MySQL80'' for the connec-\ntion name in the resulting dialog box and click the OK button. \nNotes \n• \nAlthough you can use any names you want for the connections you create in \nMySQL Workbench, ''Local instance MySQL80'' is the name of the default \nconnection that is created on a Windows system for MySQL 8.0, and that's the \nname we use in this book. \n• \nTo 1nake it easy to start MySQL Workbench, you may want to keep this application \nin your dock. \nFigure B-2 \nHow to install MySQL Workbench\n\n606 \nAppendix B \nHow to install the software for this book on macOS \nHow to install the software \nfron, n,urach.con, \nOnce you have installed the MySQL software products, we recommend that \nyou install the source files for this book. In addition, we recommend that you \ncreate the databases that are used throughout this book. \nHow to install the source files for this book \nFigure B-3 shows how to install the source files for this book. This includes \na SQL script that you can use to create the databases that are used throughout \nthis book as described in the next figure. It includes SQL scripts that contain the \nSQL code for all of the examples in this book. And it includes the SQL scripts \nthat contain the solutions to the exercises that are at the end of each chapter. \nThe source files for this book are contained in a zip file that you can \ndownload from www.mt1rach.com. When you download this file and unzip it, it \nstores the SQL script files for this book in a directory named mysql. Within this \ndirectory, you can find the subdirectories that contain the sot1rce files as shown in \nthis figure. After unzipping these files into the mysql directory, we recommend \nmoving this directory into another directory named murach that you can create \ndirectly on your hard disk. That way, the directories and files on your system will \n1natch the directories and files show11 in this book. \nTo make that easy to do, you may want to open Finder and modify its prefer-\nences so that it includes your hard disk in its sidebar. When you do that, the hard \ndisk typically has a name of Macintosh HD. Then, you can easily access this \nhard disk by clicking on it in your sidebar.\n\nAppendix B \nHow to i11stall the software for this book on macOS \n607 \nThe default installation directory for the source files \n/murach/mysql \nHow to download and install these files \n1. Go to www.murach.com, and navigate to the page for Murach's MySQL (3 rd Edition). \n2. Scroll down the page until you see the ''FREE downloads'\n1 tab and then click on it. \nThen, click on the DOWNLOAD NOW button for the zip file for any system. This \nwill download a setup file named msq3_allfiles.zip onto your hard drive. \n3. Use the Finder to locate the zip file on your hard disk, and double-click on it to \nunzip it. This creates the mysql directory and its subdirectories. \n4. If necessary, use the Finder to create the murach directory directly on your hard \ndisk. To make that easy to do, you can modify the preferences for Finder so it \nincludes your hard disk in its sidebar. \n5. Use the Finder to move the mysql directory into the murach directory. \nThe directories that contain the source files \nDirectory \nDescription \ndb_ set up \nbook_ s cripts \nex_ s o lutions \nThe SQL script that's used to create the three databases for this book. \nThe SQL scripts for all of the examples presented in this book. \nThe SQL scripts for the solutions to the exercises tl1at are at the end \nof each chapter. \ndi agrams \njav a \nphp \nThe MySQL Workbench file for the diagram that's presented in chapter 10. \nThe source code for the Java application that's presented in chapter 1. \nThe source code for the PHP application that's presented in chapter 1. \nThe databases \nDatabase \nDescription \nap \nom \nex \nDescription \nThe AP (Accounts Payable) database. This is the \np1imary database that's used in this book. \nThe OM (Order Management) database. This database \njs used in some of the examples in this book. \nThe EX (Examples) database. This database contains \nseveral tabl.es that are used for short examples. \n• \nAll of the source files described in this book are in a zip file that can be \ndownloaded from www.murach.com. \nA note about right-clicking \n• \nThis book often instructs you to right-click, because that's common in Windows. \nOn a Mac, right-clicking is not enabled by default. Instead, you can use the \nCtrl-click instead of the right-click. Or, if you prefer, you can enable right-clicking \nby editing the system preferences for your mouse. \nFigure B-3 \nHow to install the source files for this book\n\n608 \nAppendix B \nHow to install the software for this book on macOS \nHow to create the databases for this book \nBefore you can run the SQL statements presented in this book, you need to \ncreate the three databases desc1ibed in the previous figure. The easiest way to \ndo that is to use MySQL Workbench to run the SQL script that's stored in the \ncreate_databases.sql file. The procedure for doing this is described in figure B-4. \nTo determine if the SQL script ran successfully, you can review the results \nin the Output window. In this figure, for example, the Output window shows a \nseries of statements that have executed successfully. In addition, the Navigator \nwindow shows that the three databases have been created. The other database, \nnamed sys, is a database that comes with MySQL. \nIf the script encounters problems, MySQL Workbench displays one or more \nerrors in the Output window. Then, you can read these errors to figure out why \nthe script isn't executing correctly. \nBefore you can run the create_databases.sql script, the database server must \nbe running. By default, the database server is automatically started when you \nstart your computer, so this usually isn't a problem. However, if it isn't running \non your system, you can start it as described in figure B-1. \nHow to restore the databases \nAs you work with the code that's presented in this book, you may make \nchanges to the databases or tables that you don't intend to make. In that \ncase, you may want to restore the databases to their original state so your \nresults match the results shown in this book. To do that, you can run the \ncreate_databases.sql file again. This drops the three databases described in this \nappendix and recreates them.\n\nAppendix B \nHow to i11stall the software for this book on macOS \nThe directory that contains the create_databases.sql file \n/ murach/ mysql/ db_ setup \nMySQL Workbench after executing the create_databases.sql file \n• \nMySQL Workbench \n-A \nLocal instance 3306 \n~'1i & 6;.J&]@]&]ci] ~ J;! \nSCHl'..MA.S \nQ \n► I ap \n► \nex \n► \nom \n► \nsys \nOlljec1 Info \n-•Ion \nSchama:• o \nAct ve schema was clewed \n8 \n9 \n10 \n• • •• \n~ \n• \n• \n11 • \nDROP DA \nASE IF EXISTS ap; \n12 • \nCREATE DATA \nap; \n13 \n14 \n. \n15 • \nUSE ap; \n16 \n17 \nLim't 10 1000 rows \n18 • \nCREATE TABLE general_ledger_accounls \n20 \naccount_number \nINT \nPRIMARY KEY. \n19 t( \n21 \naccount_desoription VARCHAR( \n) \nUNIQUE \n22 \n); \n23 \nB \nExecute SQL Script \nbutton \nOpen SQL Script \nFile button \n?4 • \nl\"RF'.t,Tr: TARI F tormct \ntoo% \nC· \n1:-1 \n/\\ct'on Output \nT1me \n0 1 \n1s:os,1s \n0 \n2 \n1e:0s,1s \n0 \n3 \n18:05:15 \n0 \n4 \n16:05:\\5 \n0 \n5 \n1e,os:1s \n0 \n6 \n16:05:15 \n0 7 \n16:05:15 \n0 \n8 \n18:05:15 \n0 \n9 \n18:05:15 \n0 10 \n16:05!16 \n0 ,, \n16::05:15 \n0 \n12 \n16:05:tS \n0 \n13 \n,e,os,15 \n0 \n14 \n16:05:16 \nA \ny \nAct'0t1 \nRMponse \nDROP DATABASE IF' EXISTS ap \n7 row(sl affected \nCREATE DATABASE ap \n1 rowtsJ 3ff~1ed \nUSE op \nO rowfs) affcctoo \nCREATE TABL£ gonera;_Joo'ger..accour.15 1-\n0 row(sJ offectl!d \nCREATE TABLE !erms I tcrm .. _ld \nIN \nO row(s) affecteo \nCREATE TABLE ,enoo~ ( ,andor Jd \nO row(s) affcctod \nCREATE TABLE l~vo'ces I 'nvolc,,Jd \nI,_ 0 row(s) affected \nCREATE TABLE 11Tvaice_l'neJ1ems ( ·nvolce~- O row(s) affoctod \nDut-atlon f Fetch Tll'lle \n0,114 soc \n0.0024 sec \n000028 sec \n0.012 see \n00078 soc \n0 017 ffC \n0,017 sec \n0.016 M!C \nCREATE INDEX ,n-.ofccsJ1TVo·cc_datc.Jx ON,_ o row(sl affoctod Records: O Oupr,c;itcs· o Warning,_ 0.024 sce \nCREATE TABLE ..,,,dor_COl!tacts ( vondorJ ,_ 0 row(s) affcctod \nO 012 $CC \nCREATE TABLE i\"vo'cc_arch,ve ( lnvo:ce_KL O row(sl affocte<I \n0.010 scc \nINSERT INTO gcncr11l__lodO@r_occou\"ts VALU \n75 row(sl olfoctod R1N>ords· 75 Duptlcates: 0 Warnl._ 0.0085 sce \nINSERT INTO !erTnS VALUES (1,'Not oue 10 d.. \n5 rowts) alfecled Records: 5 Dup1cincs: 0 W3m,ng_ 0.0031 see \nINSERT INTO vendors VALUES (1,'US Post.al,_ \n122 row(st offccled Records J22 Duplicates: 0 \\Var_ 0 012 sec \nHow to create the databases \n1. \n2. \n3. \nStart MySQL Workbench. \nClick on a stored connection for the root user to connect to an instance of MySQL \nthat's running on the localhost computer. If you created the connection named \n''Local instance MySQL80'' in figure B-2, you can use this connection. \nOpen the create_databases.sql file by clicking the Open SQL Script File button in \nthe SQL Editor toolbar. Then, use the resulting dialog box to locate and open the \nfile. When you do, MySQL Workbench displays this script in a code editor tab. \n4. Execute the script by clicking the Execute SQL Script button in the code editor \ntoolbar. When you do, the Output window displays messages that indicate whether \nthe sc1ipt executed successfully. \nHow to restore the databases \n• \nRun the create_databases.sql script again to drop the databases and recreate them. \nFigure 8-4 \nHow to create and restore the databases for this book \n609\n\nIndex \n- operator (subtraction), 83 \n-- characters (comment), 32-33 \n! = operator, 93 \n% operator (modulo), 83 \n*, in SELECT clause, 76-79 \n* operator (multiplication), 83 \n.NET application, 34-35 \n.NET driver, 35 \n/ operator (division), 83 \n/* ... */ characters (block comment), 32-33 \n+ operator (addition), 83 \n< operator, 92-93 \n<= operator, 92-93 \n<> operator, 92-93 \n= operator, 92-93 \n> operator, 92-93 \n>= operator, 92-93 \nA \nABS function, 266-267 \nAccount name, 534-535 \nAd hoc re.lationship, 114-115 \nADD clause (ALTER TABLE), 350-351 \nADD FOREIGN KEY clause (ALTER TABLE), 352-\n353 \nADD PRIMARY KEY clause (ALTER TABLE), 352-\n353 \nAddition operator, 83 \nAdministrative privileges, 528-529 \nADO.NET, 34-35 \nAFTER keyword (CREATE TRIGGER), 478-479 \nAFTER trigger, 482-483 \nAggregate function, 170-173 \nexamples, 172-173 \nwindow, 188-195 \nAlias \ncolumn, 80-81 \nin ORDER BY clause, 106-107 \nin self-join, 122-123 \ntable, 116-117 \nALL keyword \naggregate function, 170-171 \nREVO.KE statement, 540-541 \nSELECT clause, 79, 91 \nsubquery, 206-209 \nunion, 140-141 \nALL privilege, 528-529 \nALTER EVENT statement, 488-489 \nALTER INDEX state1nent, 23 \nBETWEEN operator (WHERE clause) \n611 \nALTER TABLE state1nent, 23 \nfor altering columns, 350-351 \nfor altering constraints, 352-353 \nALTER USER statement, 542-543 \nALTER VIEW statement, 396 \nAmerican National Standards Institute (ANSI), 18-19 \nAnalytic functions, 296-299 \nAND operator (WHERE clause), 94-95 \njoin, 120-121 \nANSI (American National Standards Institute), 18-19 \nANSI/ISO SQL, 19 \nANSI-standard SQL, 18-19 \nANY keyword (subquery), 206-207, 210-211 \nAPI (Application programming interface), 6-7, 34-35 \nApplication \nserver, 8-9 \nsoftware, 6-7 \nweb, 8-9 \nApproximate numeric type, 238-239 \nArgument, 84-85 \nArithmetic expression, 82-83 \nArithmetic operator, 82-83 \nAS clause \nCREATE VIEW statement, 386-387 \nSELECT clause, 78-79 \nAS keyword \ncolumn specification, 80-81 \nCTE, 224-225 \nASC keyword \nGROUP BY clause, 182-183 \nindex, 356-357 \nORDER BY clause, 104-105 \nASCII control character, 252-253 \nAssociate table, 314-315 \nAttribute, 306-307 \ncolumn, 344-345 \nAuto increment column, 14-15, 154-155 \nAUTO_INCREMENT attribute (column), 344-345 \nAutocommit mode, 430-431 \nAVG function, 170-173 \nB \nBack end, 7 \nBack up a database, 564-573 \nBack-end processing, 7 \nBackup, 564-565 \nBase table, 26-27, 74-75, 382-383 \nBEFORE keyword (CREATE TRIGGER), 478-479 \nBEGIN keyword, 402-403 \nevent, 486-487 \nfunction, 464-465 \nstored procedure, 446-447 \ntrigger, 478-479 \nBETWEEN clause (frame), 190-193 \nBETWEEN operator (WHERE clause), 98-99\n\n612 \nBIG/NT data type \nBIGINT data type, 237 \nBin directory (MySQL), 566-567 \nBinary log, 466-467, 496-497 \nconvert to SQL file, \nfor backup, 564-565 \nusing to restore a database, 576-577 \nBinary logging (CREATE FUNCTION), 466-467 \nBit, 234-235 \nBLOB (binary large object) data type, 247 \nBLOB data types, 246-247 \nBlock comment, 32-33 \nBlock of code, 402-403 \nevent, 486-487 \nstored procedure, 446-447 \ntrigger, 478-479 \nBook files \ninstal ling on macOS, 606-607 \ninstalling on Windows, 596-597 \nBOOL data type, 236-237 \nBOOLEAN data type, 236-237 \nBoolean expression, 410-41 I \nWHERE clause, 74-75 \nBoyce-Codd normal form (BCNF), 322-323 \nBrowser (web), 8-9 \nBusiness components, 8-9 \nByte, 234-235 \nC \nC#.NET, 34-35 \nCalculated value, 26-27, 79 \nalias, 80-81 \nCall a stored procedure, 446-447 \nCALL statement, 403, 404 \ndefault value, 450-451 \nstored procedure, 446-447 \nCartesian product, 138-139 \nCASCADE option (foreign key constraint), 348-349 \nCascading delete, 348-349 \nCASE (computer-aided software engineering), 312-313 \nCASE function, 284-285 \nCASE statement, 412-413 \nCast an expressio11, 250-251 \nCAST function, 250-251 \nstring to integer, 262-263 \nCEILING function, 266-267 \nCell, 10-11 \nCHANGE clause (ALTER TABLE), 350 \nCHAR data type, 15, 234-235, 368 \nCHAR function, 252-253 \nCharacter comparison, 92-93 \nCharacter data types, 232-235 \nCharacter set, 368-373 \nspecify, 372-373 \nview, 370-371 \nConipound condition \nCHARACTER SET keywords, 372-373 \nCharacteristics (function), 464-465 \nCHARSET clause, 372-373 \nCHECK TABLE statement, 582-583 \nClient, 4-5 \nsoftware, 6-7 \nClient/server system, 4-5 \narchitectures, 8-9 \nvs. file-handling system, 7 \nCLOB (character large object) data types, 246-247 \nCLOSE statement (cursor), 416-417 \nCOALESCE function, 286-287 \nCodd, E.F., 10, 18-19 \nCode \nblock, 402-403 \nprocedural, 406-425 \nCoding guidelines (SQL), 32-33 \nCOLLATE clause, 372-373 \nCollation, 368-373 \nspecify, 372-373 \nview, 370-371 \nColumn, 10-11 \nalias, 80-81 \nalter, 350-351 \nattribute, 344-345 \nauto incren1ent, 154-155 \ndefinition, 52-53 \nfunction, 170-171 \nindex, 320-321 \nlist (INSERT), 152-153 \nMySQL Workbench, 362-363 \nposition (ORDER BY), 106-107 \nprivileges, 530-531 \nqualified name, 114-115 \nspecification, 78-79 \ntable design, 312-313 \nColumn-level constraint \nforeign key, 348-349 \nprimary key, 346-347 \nComma-delimited file, 578-581 \nComment, 32-33 \nin complex subquery, 220-221 \nCommit changes, 430-431 \nCOMMIT statement, 430-431 \nCommon tabJe expression (CTE), 224-227 \nComparison operator (WHERE clause), 92-93 \nwith subquery, 206-211 \nCompile a stored procedure, 446 \nCo111plex query, 220-223 \nCo111posite \nindex, 320-321 \nprimary key, 10-11 \nCompound condition, 94-95 \njoin, 120-121 \nsearch, 180-181\n\nCO NCAT.function \nCONCAT function, 78-79, 84-85, 258-261 \nCONCAT WS function, 258-261 \nConcatenate, 84-85 \nConcurrency, 434-443 \nproblems, 436-437 \nCondition \ncompound, 94-95 \ncompound join, 120-121 \njoin, 114-115 \nCondition handler \ndeclare, 418-419 \nm11ltiple, 424-425 \nuse, 420-421 \nConfiguration file, 496-497, 508-509 \nchange using a text erutor, 508-509 \nchange using MySQL Workbench, 506-507 \nConfigure a server, 506-511 \nConnect as a user, 556-559 \nConnecting table, 314-315 \nConnector/J driver, 34-35, 38 \nConnector/Net driver, 34-35 \nConstraint, 24-25 \nalter, 352-353 \nforeign key, 316-317 \nprimary key, 346-347 \nCONSTRAINT keyword \nALTER TABLE statement, 352-353 \nforeign key constraint, 348-349 \nprimary key constraint, 346-347 \nCONTAINS SQL characteristic (CREATE FUNC-\nTION), 466-467 \nCONTINUE handler, 420-423 \nCONTINUE keyword (DECLARE ... HANDLER), \n418-421 \nConversion \nexplicit, 248, 250-251 \nimplicit, 92, 93, 248-249 \nCONVERT function, 250-251 \nCorrelated subquery, 212-213 \nCOUNT function, 170-173 \nCounter, 414-415 \nCREATE DATABASE statement, 23, 342-343 \nCREATE EVENT state1nent, 486-488 \nCREATE FUNCTION state1nent, 464-465 \ncharacteristics, 466-467 \nCREATE INDEX statement, 23, 356-357 \nCREATE PROCEDURE statement, 402-403, 446-447 \nCREATE ROLE statement, 546-547 \nCREATE TABLE statement, 23, 150-151, 344-345 \nCREATE TABLE AS statement, 150-151 \nCREATE TRIGGER statement, 478-480 \nCREATE USER statement, 524-525, 532-534 \nCREATE VIEW statement, 382-383, 386-397 \nCross join, 138-139 \nCROSS JOIN keywords, 138-139 \nCTE (common table expression), 224-227 \nDatabase server \nCUME_DIST function, 297-299 \nCumulative distribution, 298 \nCURDATE function, 270-271 \nCURRENT_DATE function, 88-89, 270-271 \nCURRENT_ROLE function, 548-549 \nCURRENT_TIME function, 270-271 \nCURRENT_TIMESTAMP function, 270-271 \nCursor, 416 \nCURSOR vaiiable type, 416-417 \nCURTIME function, 270-271 \nD \nData \ndisplay, 406-407 \nexport to a file, 578-580 \nimport from a file, 580-58 l \nData access API, 6-7 \nData consistency (enforce with trigger), 480-481 \nData definition language (DDL), 22-23 \nData directory (MySQL), 496-497 \nData elements (data structure), 308-311 \nData file, 496-497 \nData manipulation language (DML), 22-23 \nData redundancy, 318-319 \nData structure, 306-307 \ndenormalize, 330-331 \ndesign, 306-321 \nnormalize, 322-330 \nnormalized, 318-319 \nunnormalized, 318-319 \nData type, 14, 232-247 \nconverting, 248-253 \nMySQL, 14-15 \nData validation (para1neter), 452-453 \nDatabase \nback up, 564-565 \ncreate, 342-343 \ndrop, 342-343 \nrelational, 10-11 \nrestore, 564-565, 574-577 \nselect (MySQL Workbench), 54-55 \nselect (USE statement), 342-343 \nserver, 4-5 \nDatabase administrator (DBA) 22-23, 494-495 \nDatabase diagram, 16, 332-333 \nDatabase driver, 34-35 \nDatabase engine, 46-47 \nDatabase files, 496-497 \nDatabase management system (DBMS), 6-7 \nDatabase objects, 24, 48-49 \nDatabase privileges, 530-531 \nDatabase replication, 494-495 \nDatabase server, 46-47 \nstart and stop, 46-47 \n613\n\n614 \nDatabase service \nDatabase service, 46-47 \nDatabase system, 306-307 \nDate and time data types, see Date/time data types \nDATE data type, 15, 232-233, 241 \nDate formats, 242-243 \nDate literal (in a comparison), 92-93 \nDate values \nignore, 282-283 \nsearch for, 280-281 \nDate/time data types, 232-233, 240-241, 270-283 \nparse, 272-273 \nperform calculations, 278-279 \nDate/time format strings, 276-277 \nDate/time functions, 270-283 \nDate/tim.e units, 274-275 \nDate/time values \nchecking, 242-243 \nformat, 276-277 \nliteral, 242-243 \nDATE_ADD function, 278-279 \nDATE_FORMAT function, 86-87, 276-277 \nDATE_SUB function, 278-279 \nDATEDIFF function, 278-279 \nDATETIME data type, 240-241 \nDAYNAME function, 272-273 \nDAYOFMONTH function, 273 \nDAYOFWEEK function, 272-273 \nDAYOFYEAR function, 273 \nDB2 database system, 18-19 \ncompared to other databases, 20-21 \nDBA (database administrator), 22-23, 494-495 \nDBMS (database management system), 6-7 \nDDL (data definition language), 22-23 \nDDL statements, 24-25 \nDeadlock, 442-443 \nDEALLOCATE PREPARE statement, 460-461 \nDEC data type, 239 \nDECIMAL data type, 15, 238-239 \nDeclarative referential integrity (DRI), 316-317 \nDECLARE statement, 402-403, 408-409 \nDECLARE ... COND[TION statement, 418-419 \nDECLARE ... CURSOR staten1ent, 416-417 \nDECLARE ... HANDLER statement, 416-419 \nDEFAULT attribute (column), 344-345 \nDEFAULT keyword \nDECLARE statement, 408-409 \nINSERT statement, 153-155 \nsystem variable, 510-511 \nUPDATE statement, 158-159 \nDefault role (set), 548-549 \nDEFAULT ROLE clause (CREATE USER), 548 \nDefault value, 14-15 \nparameter, 450-451 \nDELETE keyword (CREATE TRIGGER), 479 \nDELETE statement, 23, 30-31, 162-163 \nthrough view, 394-395 \nwith subquery, 162-163 \nDELI MITER statement, 402-403, 404 \nDenormal ization, 330-331 \nDenormalize a data structure, 330-331 \nDENSE_RANK function, 293-295 \nDerived data, 329 \nDESC keyword \nGROUP BY clause, 182-183 \nindex, 356-357 \nORDER BY clause, 104-105 \nDynamic SQL \nDETERMINISTIC characteristic (CREATE FUNC-\nTION), 464-467 \nDeterministic function, 466 \nDiagram (database), 332-333 \nDialect (SQL), 18-19 \nDirty read, 437 \nDISABLE keyword (ALTER EVENT), 488-489 \nDisplay data, 406-407 \nDIST[NCT keyword \naggregate function, 170-173 \nSELECT clause, 78-79, 90-91 \nself-joins, 122-123 \nsubquery, 204-205 \nWITH ROLLUP clause, 183 \nDISTINCTROW keyword, 91 \nDIV operator, 82-83 \nDivision operator, 83 \nDML (data manipulation language), 22-23 \nDO clause (CREATE EVENT), 486-487 \nDomain, 323 \nDomain-key normal form (DKNF), 322-323 \nDOUBLE data type, 238-239 \nDOUBLE PRECISION data type, 239 \nDouble-precision number, 238-239 \nDRI (declarative referential integrity), 316-317 \nDriver (database), 34-35 \nDROP COLUMN (ALTER TABLE), 350-351 \nDROP DATABASE statement, 23, 342-343 \nDROP EVENT statement, 488-489 \nDROP FOREIGN KEY clause (ALTER TABLE), 352-\n353 \nDROP FUNCTION statement, 470-471 \nDROP INDEX statement, 23, 356-357 \nDROP PRIMARY KEY clause (ALTER TABLE), \n352-353 \nDROP PROCEDURE statement, 402-403, 462-463 \nDROP TABLE statement, 23, 150-151, 354-355 \nDROP TRIGGER statement, 484-485 \nDROP USER statement, 533-534 \nDROP VIEW statement, 382-383, 396-397 \nDump, 566-567 \nDuplicate rows (eliminate), 90-91 \nDynamic SQL, 460-461\n\nEER diagram \nE \nEER diagram, 332-333, 336-337 \nfor the AP database, 336-337 \nEER modeJ, 332-335 \nfor the AP database, 334-335 \nMySQL Workbench, 42-43 \nELSE clause \nCASE function, 284-285 \nCASE statement, 412-413 \nIF state1nent, 410-411 \nELSEIF clause (IF), 410-411 \nENABLE keyword (ALTER EVENT), 488-489 \nEND keyword, 402-403 \nevent, 486-487 \nstored procedure, 446-447 \ntrigger, 478-479 \nENGINE clause, 376-377 \nEnhanced entity-relationship (EER) diagram, 16-17 \nEnhanced entity-relationship (EER) model, 332-333 \nEnterprise system, 4-5 \nEntity, 306-307 \nEntity-relationship (ER) diagram, 16-17 \nEntity-relationship (ER) model, 332-335 \nEntity-relationship (ER) modeling, 306-307 \nENUM data type, 243, 244 \nEqual operator, 92-93 \nEquijoin, 134-135 \nER (entity-relationship) model, 332-333 \nER (entity-relationship) modeling, 306-307 \nError \ncom1non causes, 58-59 \nraise in stored procedure, 452-453 \nError codes (MySQL), 418-419 \nError handler, 416-418 \nErrorlog, 496-497 \nEscape character, 578-579 \nEvent, 402-403, 486-489 \nalter, 488-489 \ncreate, 486-488 \ndrop, 488-489 \nfire,486-487 \nshow, 488-489 \nto rotate general log, 518-519 \nEvent scheduler, 486-487 \nExact numeric type, 238-239 \nException handler, 418 \nEXECUTE statement, 460-461 \nEXISTS operator (subquery), 214-215 \nEXIT handler, 422-423 \nEXIT keyword (DECLARE ... HANDLER), 418-419, \n422-423 \nExplicit conversion, 248, 250-251 \nExplicit syntax Uoin), 114-115 \nExport data (to a file), 578-580 \nExpression, 78-79 \narithmetic, 82-83 \ncomparing, 92-93 \nin ORDER BY clause, 106-107 \nstring, 84-85 \ntesting, 88-89 \nExtension (SQL), 18-19 \nEXTRACT function, 274-275 \nF \nFALSE keyword, 236-237 \nFETCH statement (cursor), 416-417 \nField, 10-1 L \nFIELDS clause \nLOAD DATA statement, 580-581 \nSELECT statement, 578-579 \nFROM clause \nFifth normal form, 322-323, 330-331 \nFile-handling system vs. client/server system, 7 \nFilter (WHERE clause), 74-75 \nFire \nevent, 486-487 \ntrigger, 478-479 \nFirst normal form (INF), 323-325 \nFIRST_ VALUE function, 296-297 \nFIXED data type, 239 \nFixed-length string, 234-235 \nFixed-point data type, 238-239 \nFixed-point number, 238-239 \nFLOAT data type, 15, 238-239 \nFloating-point data type, 238-239 \nFloating-point nL1mber, 238-239 \nsearch for, 268-269 \nFLOOR function, 266-267 \nFlow of execution (statements), 404-405 \nFOR clause (SET PASSWORD), 542-543 \nFOR EACH ROW clause (CREATE TRIGGER), 478-\n479 \nFOR SHARE clause (SELECT), 440-441 \nFOR UPDATE clause (SELECT), 440-441 \nForeign key, 12-13, 314-315 \nMySQL Workbench, 366-367 \nForeign key constraint, 316-317, 348-349 \nFOREIGN KEY keywords, 348-349 \nFORMAT function, 252-253 \nFormat strings (date/ti1ne), 276-277 \nFourth normal form (4NF), 322-323, 330-331 \nFrame, 190-193 \nanalytic function, 296-297 \nranking function, 294 \nFROM clause \nDELETE stateme11t, 162-163 \njoin, 114-115 \nSELECT statement, 26-27, 74-75 \nREVOKE statement, 540-541 \nsubquery, 218-219 \n615\n\n616 \nFront end \nFront end, 7 \nFront-end processing, 7 \nFull backup, 564-565 \nFull outer join, 144-145 \nFULLTEXT index, 374-375 \nFull-text search, 374-375 \nFunction, 84-87, 258-299, 464-465 \naggregate, 170-173 \naggregate window, 188-195 \ncall 464-465 \ncolumn, 170-171 \ncreate, 464-465 \ndeterministic, 466 \ndrop,470-471 \nnon-deterministic, 466-467 \nthat calculates balance due, 468-469 \nFunction characteristics, 464-465 \nFt1nctionally dependent column, 174-175 \nG \nGeneral log, 496-497 \nGeometry data types, 232-233 \nGLOBAL keyword \nSET statement, 510-511 \nSET TRANSACTION LEVEL statement, 438-439 \nGlobal positioning system (GPS). 232-233 \nGlobal privileges, 530-531 \nGMT (Greenwich Mean Time), 270-271 \nGRANT OPTION p1ivilege, 528-529 \nGrant privileges \nrole, 546-547 \nuser, 536-538 \nGRANT statement, 524-525 \nassign a user to a role, 546-547 \ngrant privileges to a role, 546-547 \ngrant privileges to a user, 536-538 \nGrant tables (mysql database), 530-531 \nGreater than operator, 92-93 \nGreater than or equal to operator, 92-93 \nGreenwich Mean Ti1ne (GMT), 270-271 \nGROUP BY clause (SELECT), 174-177, 182-183 \nWITH ROLLUP operator, 182-183 \nGROUPING function, 184-187 \nH \nHAVING clause, 174-181 \ncompared to WHERE clause, 178-179 \nGROUPING function, 186-187 \nsubquery, 216-217 \nHome page (MySQL Workbench), 42-43 \nHostname, 534-535 \nHOUR function, 272-273 \nHTML tags, 36 \nI \nIBM (DB2), 18-19 \nIDENTIFIED BY clause \nINSERT statement \nALTER USER statement, 542-543 \nCREATE USER statement, 532-533 \nIF clause, 410-411 \nIF EXISTS clause \nALTER USER statement, 542-543 \nDROP DATABASE statement, 342-343 \nDROP EVENT statement, 489 \nDROP FUNCTION statement, 470-471 \nDROP PROCEDURE staten1ent, 462-463 \nDROP TRIGGER statement, 484-485 \nDROP USER statement, 533, 534 \nIF function, 184-187, 286-287 \nIF NOT EXISTS clause \nCREATE DATABASE statement, 342-343 \nCREATE ROLE statement, 546-547 \nCREATE USER statement, 532-533 \nIF statement, 410-411 \nnesting, 411 \nstored procedure, 403,404 \nIFNULL function, 286-287 \nImp.licit conversion, 92, 248-249 \nImplicit inner join syntax, 126-127 \nImport data (from a file), 580-581 \nIN keyword (para1neter), 448-449 \nIN operator \nsubquery, 204-205 \nWHERE clause, 96-97 \nlncren1ental backup, 564-565 \nIndex, 10-11 , 356-357 \ncolumn, 320-321 \ncomposite, 320-321 \ncreate, 356-357 \ndrop, 356-357 \nFULLTEXT, 374-375 \nMySQL Workbench, 364-365 \nInline view, 218-219 \nInner join, 28-29, 114-117 \ncombined with outer join, 130, 133 \nexplicit syntax, 114-115 \nimplicit syntax, 126-127 \nSQL-92 syntax, 114-115 \nINNER keyword, 114-115 \nlnnoDB storage engine, 374-375 \nlnnoDB table (repair), 584-585 \nINOUT keyword (parameter), 448-449 \nInput parameter, 448-449 \nInput/output parameter, 448-449 \nINSERT function, 258-261 \nINSERT keyword (CREATE TRIGGER), 479 \nINSERT statement, 23, 30-31, 152-153 \ndefault value, 154-1 55 \nnull value, 154-155\n\nINSERT state merit ( continued) \nthrough view, 394-395 \nwith subquery, 156-157 \nInstance, 306-307 \nINT data type, 15, 237 \nInteger, 232-233 \nINTEGER data type, 236-237 \nInteger data types, 236-237 \nInteger division, 82-83 \nINTO clause (SELECT), 403, 404, 408-409 \nINTO keyword (INSERT), 152-153 \nINTO OUTFILE clause (SELECT), 578-579 \nINTO TABLE clause (LOAD DATA), 580-581 \nIntroduce a subquery, 200-201 \nIS NULL clause (WHERE clause), 102-103 \nIsolation Jevel (transaction), 438-439 \nITERATE statement (loop), 414-415 \nJ \nJAR file, 38-39 \nJava, 34-35, 38-39 \nJava Database Connectivity (JDBC), 6-7, 34-35 \nJava driver, 35 \nJavaScript Object Notation (JSON), 232-233 \nJDBC (Java Database Connectivity), 6-7, 34-35 \nJDBC API, 38 \nJDBC object, 39 \nJoin, 28-29, 114-139 \nbetween databases, 118-119 \ncompound condition, 120-121 \ncondition, 114-115 \ncross, 138-139 \nimplicit syntax, 126-127 \ninner, 28-29, 114-117 \nmul.ti-table, 124-125 \nnatural, 136-137 \nouter, 28-29, 128-133 \nself, 122-123 \nvs. subquery, 202-203 \nJOIN keyword, 114-139 \nJSON (JavaScript Object Notatio11), 232-233 \nJSON data types, 232-233 \nK \nKey \ncolumn, 13 \ncomposite primary, 10-11 \nforeign, 12-13, 314-315 \nnon-primary, 10-11 \nprimary, 10-11, 314-315 \nunique, 10-11 \nKeyword, 74 \nKILL statement, 500-501 \nL \nLAG function, 297-299 \nLAN, 4-5 \nLTRIM function \nLarge object (LOB) data types, 232-233, 246-247 \nLAST_DAY function, 273 \nLAST_ VALUE function, 296-297 \nl.atin 1 character set, 234-235, 368-369 \nLEAD function, 297-298 \nLEAVE statement (loop), 414-415 \nLEFT function, 86-87, 258-261 \nLEFT keyword (outer join), 128-129 \nLeft outer join, 128-133 \nLENGTH function 258-261 \nLess than operator, 92-93 \nLess than or equal to operator, 92-93 \nLIKE clause (SHOW), 370-371 \nLIKE operator (WHERE clause), 100-101 \nLIMIT clause (SELECT), 74-75, 108-109 \nLinking table, 314-315 \nLiteral value, 82 \ndate, 92-93 \ndate/time, 242-243 \nnumeric, 92-93 \nstring, 84-85, 92-93 \nLOAD DATA statement, 580-581 \nLOB (large object) data types, 246-247 \nLocal area network (LAN), 4-5 \nLocal instance MySQL80 (MySQL Workbench), 44-45 \nLOCAL keyword (SET), 511 \nLOCATE function, 258-261, 264-265 \nLock, 434-435 \nselected rows, 440-441 \nLOCK IN SHARE MODE (SELECT), 440 \nLOCK TABLES statement (backup), 570-571 \nLocki11g, 434-443 \nchange,438-439 \nLog, 512-513 \nmanage, 518-519 \ntext-based, 516-517 \nLog file, 496-497 \ntypes, 496-497 \nwrite to tables, 516-517 \nLog rotation, 518-519 \nLogging, 512-519 \nconfigure, 514-515 \ndisable, 512-513 \nenable, 512-513 \nLogical operator (WHERE clause), 94-95 \nLONGBLOB data type, 247 \nLONGTEXT data type, 247 \nLoop, 414-415 \nLost update, 436-437 \nLOWER function, 258-261 \nLPAD function, 258-259, 262-263 \nLTRIM function, 258-261 \n617\n\n618 \nn1acOS operating system \nM \nmacOS operating system, 20-21 \nMany-to-many relationship, 12-13, 314-315 \nMask, 100-101 \nMaster server, 494-495 \nMAX function, 170-173 \nMEDIUMBLOB data type, 247 \nMEDIUMINT data type, 237 \nMEDIUMTEXT data type, 247 \nMIN function, 170-173 \nMINUTE function, 273 \nMOD operator, 82-83 \nMODIFIES SQL DATA characteristic (CREATE \nFUNCTION), 466-467 \nMODIFY clause (ALTER TABLE), 350-351 \nModulo operator, 83 \nMONTH function, 192-193, 272-273 \nMONTHNAME function, 272-273 \nMoving average, 192-193 \nMultiple-byte character set, 234-235 \nMultiplication operator, 83 \nMulti-table join, 124-125 \nMultivalued dependencies, 322-323 \nmy.cnf file, 496-497 \nmy.ini file, 496-497 \nMylSAM storage engine, 374-375 \nMylSAM table \ncheck with myisamchk, 588-589 \nrepair with myisamchk, 588-589 \nrepair with REPAIR TABLE, 584-585 \nmyisamchk program, 588-589 \nMySQL \ncommand line, 66-67 \ncompared to other databases, 20-21 \ndaemon, 500 \ndata directory, 496-497 \ndata types, 14-15 \ndatabase system, 20-21 \ndriver 35 \nerror codes, 418-419 \nMySQL Command Line Client, 66-69 \nMySQL Community Server \ninstall on macOS, 602-603 \ninstall on Windows, 594-595 \nMySQL connection (MySQL Workbench), 42-45 \nMySQL Improved Extension (mysqli), 34-35 \nmysql program, 565, 574-575 \nMySQL Reference Manual, 64-65 \nMySQL Server \ninstall on macOS, 602-603 \ninstall on Windows, 594-595 \nMySQL Workbench, 42-65 \nadd connection, 44-45 \nadministrative roles, 554-555 \nconnections, 42-45 \ndatabase backup, 566, 568 \ndatabase creation, 362-367 \ndatabase design, 332-337 \nEER model, 42-43 \nHome page, 42-43 \ninstall on macOS, 604-605 \ninstall on Windows, 594-595 \nlocal instance MySQL80, 44-45 \nmigrating MySQL databases, 43 \nNavigator window, 46-53 \nopen database connection, 44-45 \nOutput tab, 59 \nprivileges, 552-555 \nrestore a database, 574 \nResult grid, 50-51, 54-55 \nsafe update mode, 158-160, 162-163 \nselect database, 54-55 \nSQL editor, 54-55 \nSQL staten1ent, 54-55 \nStartup/Shutdown option, 46-47 \nstored routine, 472-473 \nsyntax errors, 58-59 \nusers, 552-553 \nmysqlbinlog program, 565, 576-577 \nmysqlcheck program, 586-587 \nmysqld program, 500 \nmysqldump program, 564-568 \nadvanced options, 572-573 \nNornial.forms \nmysqli, (MySQL Improved Extension), 34 , 35 \nN \nNamed condition, 418-419 \nhandling, 422-423 \nNamed window, 194-195 \nNatural join, 136-137 \nNATURAL keyword Uoin), 136-137 \nNavigator window (MySQL Workbench), 46-53 \nNested \nif statement, 411 \nsort, 104-105 \nsubquery, 200-201 \nview, 388-389 \nNetwork, 4-5 \nNEW keyword (trigger), 478-479 \nNO SQL characteristic (CREATE FUNCTION), 466-\n467 \nNO WAIT option (FOR SHARE/FOR UPDATE \nclause), 440-442 \nNon-deterministic function, 466-467 \nNon-primary key, 10-11 \nNonrepeatable read, 437 \nNormal forms, 318-319, 322-323 \nBoyce-Codd, 322-323 \nDomain-key, 322-323 \nfifth, 322-323, 330-331\n\nNormal forms ( continued) \nfirst, 323, 324-325 \nfourth, 322-323, 330-331 \nsecond, 323,326-327 \nsixth, 322-323 \nthird, 323, 328-330 \nNormalization, 318-319 \nNormalize (data structure), 322-330 \nNormalized data structure, 318-319 \nNOT DETERMINISTIC characteristic (CREATE \nFUNCTION), 466-467 \nNot equal operator, 92-93 \nNOT EXISTS operator (subquery), 214-215 \nNOT FOUND condition, 418-419 \nNOT IN operator (subquery), 204-205, 208-209 \nNOT NULL attribute (column), 344-347 \nNot null constraint, 346-347 \nNOT operator, 94-95 \nBETWEEN, 98-99 \nIN, 96-97 \nIS NULL, 102-103 \nLIKE, 100-101 \nREGEXP, 100-101 \nNOW function, 270-271 \nNTH_VALUE function, 296-297 \nNTILE function, 293-295 \nNULL keyword \nINSERT statement, 152-155 \nUPDATE statement, 158-159 \nNull value, 14-15, 102-103 \naggregate function, 170-171 \nGROUPING function, 184-187 \nNumeric data, 266-269 \nNUMERIC data type, 239 \nNumeric data types, 232-233 \nNumeric functions, 266-269 \nNumeric literal (in a comparison), 92-93 \n0 \nObject privileges, 528-529 \nOffset (LIMIT clause), 108-109 \nOLD keyword (trigger), 478-479 \nON clause \nCREATE TRIGGER, 478-479 \nGRANT, 536-537 \nON DELETE clause (foreign key constraint), 348-349 \nON phrase (join), 114-115 \nON SCHEDULE clause (CREATE EVENT), 487 \nOne-time event, 486-487 \nOne-to-many relationship, 12-13, 314-315 \nOne-to-one relationship, 12-13, 315 \nOPEN statement (cursor), 416-417 \nOpen-source database, 20-21 \nOR operator (WHERE clause), 94-95 \njoin, 120-121 \nOR REPLACE keywords (CREATE VIEW), 386-387 \nPASSWORD HISTORY clause \nOracle relational DBMS, 18-19 \ncompared to other databases, 20-21 \nORDER BY clause \naggregate window function, 188-195 \nanalytic function, 296-299 \nGROUP BY clause, 182-183 \nGROUPING function, 187 \nranking function, 292-295 \nSELECT statement, 26-27, 74-75, 104-109 \nunion, 140-141 \nOrder of precedence \narithmetic operators, 82-83 \nlogical operators, 94-95 \nOrphaned row, 316-317 \nOS/390 operating system, 21 \nOUT keyword (parameters), 448-449 \nOuter join, 28-29, 128-1 33 \ncombined with inner join, 130, 133 \nexa1nples, 130-133 \nOUTER keyword (outer join), 128-129 \nOutput parameter, 448-449 \nOutput tab (MySQL Workbench) 59 \nOVER clause \np \naggregate window function, 188-189 \nanalytic function, 296-299 \nranking function, 292-293 \nParameter, 84-85 \ndefault value, 450-451 \nfunction, 464-465 \ninput, 448-449 \ninput/output, 448-449 \noutput, 448-449 \npass by position, 446-447 \nstored procedure, 446-447 \nParse \ndates and times, 272-273 \nstrings, 264-265 \nPartition (window function), 188-189, 292-293 \nPARTION BY clause \naggregate window function, 188-189 \nanalytic function, 296-297 \nnamed window, 194-195 \nranking function, 292-295 \nPassword, 532-533 \nchange, 542-543 \nMySQL Workbench 44-45 \nPASSWORD EXPIRE clause \nALTER USER statement, 542-543 \nCREATE USER statement, 532-533 \nPASSWORD function (SET PASSWORD), 542 \nPASSWORD HISTORY clause \nALTER USER statement, 542-543 \nCREATE USER statement, 532-533 \n619\n\n620 \nPASSWORD REUSE INTERVAL clause \nPASSWORD REUSE INTERVAL clause \nALTER USER statement, 542-543 \nCREATE USER statement, 532-533 \nPDO (PHP Data Objects), 34-35 \nPDO API, 36-37 \nPDQ object, 36 \nPeer, 192-193 \nPERCENT_RANK function, 297-299 \nPhantom read, 436-437 \nPHP, 34-37 \nPHP Data Objects (PDO), 34-35 \nPoint-in-time recovery (PITR), 564-565 \nPOWER function, 266-267 \nPrecision, 238-239 \nPREPARE statement, 460-461 \nPrimary key, 10-11, 12-13, 314-315 \nco1nposite, 10-11 \nconstraint, 346-347 \nPRIMARY KEY keywords, 346-347 \nPrivilege, 524-541 \nadministrative, 528-529 \ngrant to role, 546-547 \ngrant to user, 536-538 \nMySQL Workbench, 552-555 \nobject, 528-529 \nrevoke from role, 548-549 \nrevoke from user, 540-541 \nview for role, 546-547 \nview for user, 538-539 \nPrivilege levels, 530-531 \nProceduralcode,406-425 \nProcedure, see Stored procedure \nProcess, 500-501 \nPROXY privilege, 538-539 \nPseudocode (complex query), 222-223 \nQ \nQualified column name, 114-115 \nin self-join, 122-123 \nQUARTER function, 273 \nQuery, 26-27 \nresults, 7 \nSQL, 6-7 \nsummary, 170-173 \nR \nRAND function, 266-267 \nRANGE keyword (frame), 190-193 \nanalytic function, 296-297 \nRANK function, 293-295 \nRanking functions, 292-295 \nREAD COMMITTED isolation level, 438-439 \nREAD UNCOMMITTED isolation level, 438-439 \nRETURNS keyword (CREATE FUNCTION) \nRead-only view, 391 \nREADS SQL DATA characteristic (CREATE FUNC-\nTION), 464-465, 466-467 \nREAL data type, 239 \nRea] number, 232-233, 238-239 \nReal-world systen1, 306-307 \nRecord, 10-11 \nRecurri.ng event, 486-487 \nRecursive CTE, 226-227 \nRECURSIVE keyword (CTE), 225 \nRecursive query, 226-227 \nRedundant data, 318-319 \nRedundant rows, 326-327 \nALTER TABLE, 352-353 \nforeign key constraint, 348-349 \nReference constraint, 348-349 \nReference Manual (MySQL), 64-65 \nREFERENCES clause \nReferential integrity, 12-13, 316-317 \ndeclarative, 316-317 \nREGEXP operator (WHERE clause), 100-101 \nREGEXP_INSTR function, 288-291 \nREG EXP _LIKE function, 288-291 \nREGEXP_REPLACE function, 288-291 \nREGEXP_SUBSTR function, 288-291 \nRegular expression, 100 \nRegular expression functions, 288-291 \nRelational database, 10-11 \nRelational database manage1nent syste1n (RDBMS), \n18-19 \nRelationship \nad hoc, 114-115 \nbetween tables, 12-13, 314-315 \nenforcing 316-317 \nRelay log, 496-497 \nRENAME COLUMN clause (ALTER TABLE), 350-\n351 \nRENAME TABLE statement, 354-355 \nRENAME TO keywords (ALTER EVENT), 488-489 \nRENAME USER statement, 533, 534 \nREPAIR TABLE statement, 584-585 \nREPEAT function, 258-259 \nREPEAT loop, 414-415 \nREPEAT statement, 414-415 \nREPEATABLE READ isolation level, 438-439 \nRepeating columns, 318-319 \nRepeating values, 324-325 \nREPLACE function, 258-261 \nRestore a database, 564-565, 574-577 \nResult grid (MySQL Workbench), 50-51, 54-55 \nResult set, 26-27 \nsorting, 104-105 \nResult table, 26-27 \nResults (query), 7 \nRETURN stateme11t (function), 464-465 \nRETURNS keyword (CREATE FUNCTION), 464-465\n\nREVERSE function \nREVERSE functio11, 258-261 \nREVOKE statement \nremove user from role, 548-549 \nrevoke privileges from a role, 548-549 \nrevoke privileges from a user, 540-541 \nRIGHT function, 258-261 \nRIGHT keyword (outer join), 128-129 \nRight outer join, 128-133 \nRole, 546-551 \nactive, 548-549 \nassign user to, 546-547 \ncreate, 546-547 \ndefault, 548-549 \ngrant privileges, 546-547 \nMySQL Workbench, 554-555 \nremove user, 548-549 \nrevoke privileges, 548-549 \nset for session, 548-549 \nRollback. changes, 430-431 \nROLLBACK statement, 430-431 \nROLLBACK TO SAVEPOINT statement, 433, 434 \nROUND function, 86-87, 266-269 \nRow, 10-11 \ndelete, 162-163 \nduplicate, 90-91 \ninsert, 152-153 \nupdate, 158-159 \nRow-level trigger, 478-479 \nROW_NUMBER function, 292-293 \nROWS keyword (frame), 190-191 \nanalytic function, 296-297 \nRPAD function, 258-259 \nRTRIM function, 258-261 \ns \nSafe update mode (MySQL Workbench), 158-160, 162-\n163 \nSave point, 433, 434 \nSAVEPOINT statement, 433, 434 \nScalar function 170, 464-465 \nScale, 238-239 \nScheduled event, 486-487 \nSchema, 48-49, 118-119 \nScientific n.otation, 238-239 \nScript, see SQL script \nSearch \nfor a date, 280-281 \nfor a floating-point number, 268-269 \nfor a time, 282-283 \nfull-text, 374-375 \nSearch condition, 74-75 \ncompound, 180-181 \nSearched CASE function, 284-285 \nSearched CASE statement, 412-413 \nSECOND function, 273 \nSHOW GRANTS statement \nSecond normal form (2NF), 323, 326-327 \nSELECT clause (SELECT), 26-27, 74-75, 78-91 \nsubquery, 216-217 \nSELECT statement, 23, 26-27, 74-109 \nbasic syntax, 74-75 \nCTE, 224-225 \ndisplay data, 406-407 \nexamples, 76-77 \nfive clauses of, 74-75 \nGROUP BY clause, 174-175 \nHAVING clause, 174-175 \njoin, 114-139 \nsubquery, 200-223 \nview, 382-383, 386-387 \nSelected row (locking), 440-441 \nSelf-join, 122-123 \nSERlALIZABLE isolation level, 438-439 \nServer, 4-5 \napplication, 8-9 \nconfigure, 506-511 \nmonitor, 498-499 \nsoftware, 6-7 \nweb, 8-9 \nServer configuration \nchange using a text editor, 508-509 \nchange using MySQL Workbench, 506-507 \nServer configuration options (log files), 513 \nService (web), 8-9 \nSESSION keyword \nSET statement, 510-511 \nSET TRANSACTION ISOLATION LEVEL state-\nment, 438-439 \nSET clause (UPDATE), 158-159 \nSET data type, 244-245 \nSET DEFAULT ROLE statement, 548-549 \nSET NULL option (foreign key constraint), 348-349 \nSET PASSWORD staten1ent, 542-543 \nSET ROLE statement, 548-549 \nSET SESSION statement (storage engine), 376-377 \nSET statement \nevent scheduler, 486-487 \nsystem variable, 510-511 \nuser variable, 458-459 \nvariable, 408-409 \nSET TRANSACTION ISOLATION LEVEL \nstatement, 438-439 \nSHOW CHARSET statement, 370-371 \nSHOW COLLATION statement, 370-371 \nSHOW ENGINES statement, 374-375 \nSHOW ERRORS statement, 418-419 \nSHOW EVENTS statement, 488-489 \nSHOW FUNCTION STATUS statement, 473 \nSHOW GRANTS statement \nrole, 546-547 \nuser, 524-525, 538-539 \n621\n\n622 \nSHOW PRIVILEGES statement \nSHOW PRIVILEGES statement, 528-529 \nSHOW PROCEDURE STATUS statement, 473 \nSHOW PROCESSLIST statement, 500-501 \nSHOW STATUS statement, 503 \nSHOW TRIGGERS statement, 484-485 \nSHOW VARIABLES statement \ncharacter sets and collations, 370-371 \nevent scheduler, 486-487 \nstorage engine, 374-375 \nsystem variables, 505 \nSHOW WARNINGS statement, 418-419 \nSIGN function, 266-267 \nSIGNAL statement, 452-453 \nSignificant digits, 238-239 \nSimple CASE function, 284-285 \nSimple CASE statement, 412-413 \nSimple loop, 414-415 \nSingle-byte character set, 234-235 \nSingle-line comment, 32-33 \nSingle-precision 11umber, 238-239 \nSixth normal form (6NF), 322-323 \nSKIP LOCKED option (FOR SHARE/FOR UPDATE \nclause), 440-442 \nSlave server, 494-495 \nSlow query log, 496-497 \nSMALL INT data type, 237 \nSnippets (MySQL Workbench), 56-57 \nSOME keyword (subquery), 206-207, 210-211 \nSort order, 104-105, see also ORDER BY clause \nSPACE function, 258-259 \nSpatial data types, 232-233 \nSpecialized window functions, 292-299 \nSproc, see Stored procedure \nSQL, 6-7 \nANSI-standards, 18-19 \ncoding guidelines, 32-33 \ndynamic, 460-461 \nextensions to, 18, \nhistory, 18-19 \nstandards, 18-19 \nvariant, 18-19 \nSQL Additions window (MySQL Workbench) 56-57 \nSQL editor (MySQL Workbench), 54-55 \nSQL query, 6-7 \nSQL script, 60-63 \nMySQL Workbench, 60-63 \nPHP, 36 \nto back up a database, 568-571 \nto create a stored procedure, 402-404 \nto create the AP database, 358-361 \nto create users and grant privileges, 544-545 \nto create users and roles, 550-551 \nto restore a database, 574-575 \nSQL Server, 18-19 \ncon1pared to other databases, 20-21 \nSubquery \nSQL statements, 22-23 \nfor controlling the flow of execution, 404-405 \nrun in MySQL Workbench, 54-55 \nSQL-92 syntax (join), 114-115 \nSQL/Data System (SQL/DS), 18-19 \nSQLEXCEPTION condition, 418-419 \nSQLSTATE code, 418-419, 452-453 \nSQLSTATE keyword (SIGNAL), 452-453 \nSQLWARNING condition, 418-419 \nSQRT function, 266-267 \nStandard SQL, 19 \nSTART TRANSACTION statement, 430-431 \nStartup/Shutdown option (MySQL Workbench), 46-47 \nStatus variables, 502-503 \nStorage engine (view and specify), 374-377 \nStored function, 402-403, 464-471 \nStored procedure, 402-403, 446-463 \ncall, 446-447 \ncompile, 446 \ndefault parameter, 450-451 \ndrop, 462-463 \nparameter validation, 452-453 \nparameters, 448-449 \nto insert a row, 454-457 \nStored Program, 402-425 \nStored routi11e, 402 \nMySQL Workbench, 472-473 \nString, 258-265 \nconcatenate, 84-85 \ndata, 232-233 \nparse, 264-265 \nsort, 262-263 \nString expression, 84, 85 \nString functions, 258-265 \nString literal, 84-85 \nin a comparison, 92-93 \nString pattern, I 00-101, 288-289 \nStructured Query Language, see SQL \nSubquery, 96-97, 200-223 \nALL keyword, 208-209 \nANY keyword, 210-211 \ncomparison operator, 206-207 \ncorrelated, 212-213 \nDELETE staten1ent, 162-163 \nEXISTS operator, 214-215 \nFROM clause, 218-219 \nHAVING clause, 216-217 \nIN operator, 204-205 \nINSERT statement, 156-157 \nintroduce, 200-201 \nNOT EXISTS operator, 214-215 \nNOT IN operator, 204-205 \nSELECT clause, 216-217 \nSOME keyword, 210-211 \nuncorrelated, 212-213 \nUPDATE statement, 160-161 \nvs. join, 202-203\n\nSUBSTRING function \nSUBSTRING function, 258-261, 264-265 \nSUBSTRING_INDEX ft1nction, 258-261, 264-265 \nSubtraction operator, 83 \nSUM function, 170-173 \nSummary query, 170-173 \nSyntax conventions, 74-75, 78-79 \nSyntax errors (MySQL Workbench), 58-59 \nSYSDATE function, 270-271 \nSystem variable, 504-505 \nT \nenable logging, 513 \nlog files, 514-515 \nset using a text editor, 508-509 \nset using MySQL Workbench, 506-507 \nset using SET statement, 510-511 \nTab-delimited file, 578-581 \nTable, 10-11 \nalias, 116-117, 122-123 \nbase, 26-27, 382-383 \ncheck witl1 CHECK TABLE, 582-583 \ncheck with myisamchk, 588-589 \ncheck with mysqlcheck, 586-587 \ncreate, 344-345 \ndrop, 354-355 \nrename, 354-355 \nrepair with myisamchk, 588-589 \nrepair with mysqlcheck, 586-587 \nrepair with REPAIR TABLE, 584-585 \ntest, 150-151 \ntruncate, 354-355 \nviewed, 383 \nTable data (view and edit), 50-51 \nTable name (qualifying), 118-l 19 \nTable privileges, 530-531 \nTable scan, 320 \nTable-level constraint \nforeign key, 348-349 \nprimary key, 346-347 \nTemporal data types, see Date/time data types \nTest table, 150-151 \nText data, 232-233 \nTEXT data type, 246-247 \nText-based logs, 516-517 \nTHEN clause \nCASE function, 284-285 \nIF statement, 403-404 \nThin client, 8 \nThird normal form (3NF), 323, 328-330 \nTIME data type, 240-241 \nTime formats, 242-243 \nTime values \nignore, 280-281 \nsearch for, 282-283 \nUPDATE statement \nTIME_FORMAT function, 276-277 \nTIME_TO_SEC function, 278-279 \nTIMESTAMP data type, 240-241 \nTINYBLOB data type, 247 \nTINYINT data type, 237 \nTINYTEXT data type, 247 \nTO clause (GRANT), 537 \nTO_DAYS functio~ 278-279 \nTransaction, 430-433 \nwhen to use, 4 77 \nTransaction isolation level, 438-439 \nTransitive dependencies, 322-323 \nTrigger, 402-403, 478-485 \nAFTER, 482-483 \nBEFORE, 478-479 \ncreate, 478-480 \ndrop, 484-485 \nenforce data consistency, 480-481 \nrow-level, 478-479 \nview, 484-485 \nTrim characters, 258 \nTRIM function, 258-261 \nTRUE keyword, 236-237 \nTRUNCATE function, 266-267 \nTRUNCATE TABLE statement, 354-355 \nType (data), see Data type \nu \nUncorrelated st1bquery, 212-213 \nUnicode character set, 368 \nUnicode standard, 234-235 \nUnion, 140-145 \nsyntax, 140-141 \nthat simulates full outer join, 144-145 \nUNION ALL operator (recursive CTE), 226-227 \nUNION keyword, 140-145 \nUNION operator (recursive CTE), 227 \nUNIQUE attribute (column), 344-347 \nUnique constraint, 346-347 \nUnique key, 10-1 l \nUNIQUE keyword (index), 356-357 \nUniversal Time Coordinate (UTC), 270-271 \nUnix Millennium bug, 240-241 \nUnix operating system, 20 \nUNLOCK TABLES statement (backup), 570-571 \nUnnormalized data structure, 318-319 \nUNSIGNED attribute, 236-239 \nUpdatable view, 390-391 \nWITH CHECK OPTION clause, 392-393 \nUPDATE keyword (CREATE TRIGGER), 478-479 \nUPDATE statement, 23, 30-31, 158-159 \nthrough view, 392-393 \nwith subquery, 160-161 \n623\n\n624 \nUP PER function \nUPPER function, 258-261 \nUSAGE privilege, 528-529 \nUSE statement, 342-343 \nUser account, 524-525 \nassign to role, 546-547 \nconnection, 556-559 \ncreate, 532-534 \nMySQL Workbench, 552-553 \nremove from role, 548-549 \nspecify name, 534-535 \nUSER function (ALTER USER), 542-543 \nUser variable, 448-449, 458-459 \nUsername, 534-535 \nUSING keyword (join), 134-135 \nUTC (Universal Time Coordinate), 270-271 \nUTC_DATE function, 270-271 \nUTC_TIME function, 270-271 \nutf8 character set, 368 \nutf8mb3 character set, 234-235, 368-369 \nutf8n1b4 character set, 234-235, 368-369 \nV \nValue, 10-11 \nliteral, 82, 84-85 \nnull, 102-103 \nVALUE ERROR exception, 452-453 \nVALUES clause (INSERT), 152-153 \nV ARCHAR data type, 15, 234-235, 368 \nVariable, 408-409 \ndeclare, 408-409 \nset, 408-409 \nstatus, 502-503 \nsystern, 504-509 \nuser, 448-449, 458-459 \nVariable-length string, 234-235 \nVariant (SQL), 19 \nVB.NET, 34-35 \nView, 382-397 \nbenefits, 384-385 \ncreate, 386-389 \ndelete through, 394-395 \ninsert through, 394-395 \nnested, 388-389 \nprocess, 500-501 \nread-only, 391 \nreplace, 386-387 \nupdatable, 390-391 \nupdate through, 390-393 \nViewed table, 383 \nVisual Basic.NET, 34-35 \nw \nWAN, 4-5 \nWeb application, 8-9 \nWeb browser, 8-9 \nWeb server, 8-9 \nWeb services, 8-9 \nWeb-based syste1n, 8-9 \nWEEK function, 273 \nWHEN clause \nCASE function, 284-285 \nCASE statement, 412-413 \nWHERE clause \nZERO FILL attribute \ncompared to HAVING clause, 178-179 \nDELETE staten1ent, 162-163 \nSELECT staten1ent, 26-27, 74-75, 92-103 \nsubquery,204-215 \nUPDATE statement, 158-159 \nWHILE loop, 414-415 \nWHILE statement, 414-415 \nWide-area network (WAN), 4-5 \nWildcard (LIKE), 100-101 \nWindow, 188-189 \nnamed, 194-195 \nWINDOW clause (named window), 194-195 \nWindow functions \naggregate, 188-195 \nspecialized, 292-299 \nWindows operati ng syste1n, 20-21 \nWITH ADMIN option (GRANT), 546-547 \nWITH CHECK OPTION clause (CREATE VIEW), \n392-393 \nWITH GRANT OPTION (GRANT), 536-537 \nWITH keyword (CTE), 224-225 \nWITH ROLLUP operator, 182-183 \nGROUPING function, 184-187 \nXYZ \nY2K38 problem, 240-241 \nYear 2038 problem, 240-241 \nYEAR data type, 241 \nYEAR function, 273 \nz/OS operating system , 20-21 \nZEROFILL attribute, 236-239\n\nThe software that you need for this book \n• \nMySQL Community Server (a free download). \n• \nMySQL Workbench (a free download). \nThe source code that you can download \n• \nThe script file that creates the three databases used in this book. \n• \nThe source code for all of the examples in this book. \n• \nThe solutions to the exercises that are at the end of each chapter. \nHow to download the software \n1. Go to www.mysql.com. \n2. Use the pages on that site to dow.nload and install the MySQL Co1nmunity Server \nand MySQL Workbench. \n• \nFor 1nore details, see appendix A (Windows) or appendix B (macOS). \nHow to download the source code \n1. Go to www.murach.com and navigate to the page for Murach 's MySQL (Third \nEdition). \n2. Use the links on that page to download the sot1rce code. For Windows, download \nthe self-extracting zip file (an exe file). For macOS, download the regular zip file. \n3. Double-click the downloaded file and respond to the dialog boxes that follow. \n• \nFor more details, see appendix A (Windows) or appendix B (macOS). \nHow to create the databases \n1. Start MySQL Workbench. \n2. Run the script named create_databases.sql. By default, this file is stored in the \nmurach/mysql/db_setup directory. \n• \nFor more details, see appendix A (Windows) or appendix B (macOS). \nwww.murach.com",
          "pages": [
            1
          ]
        }
      },
      "educational_notes": {
        "definition": "The SELECT statement is used in SQL to retrieve data from one or more tables in a database. It's essential for querying and analyzing data stored in MySQL databases.",
        "explanation": "The SELECT statement allows you to specify which columns of data you want to retrieve from a table. It works by selecting rows that meet certain conditions, defined using the WHERE clause. This is crucial for developers who need to access specific information from large datasets efficiently. Knowing how to use SELECT effectively can save time and improve the performance of your applications.",
        "key_points": [
          "Key point 1: The SELECT statement retrieves data from tables based on specified conditions.",
          "Key point 2: Use aliases to name columns in the result set for clarity and convenience.",
          "Key point 3: Common mistakes include forgetting to specify a condition in the WHERE clause, which can return all rows instead of just the desired ones.",
          "Key point 4: Always test your SELECT statements with small datasets first to ensure they work as expected before running them on larger databases.",
          "Key point 5: Understanding JOINs and subqueries is essential for more advanced SELECT statement usage."
        ],
        "examples": [
          {
            "title": "Basic Usage",
            "code": "-- Select all columns from a table\nSELECT * FROM employees;",
            "explanation": "This example retrieves all columns (indicated by *) from the 'employees' table. It's useful when you need to view all available data."
          },
          {
            "title": "Practical Example",
            "code": "-- Select specific columns with conditions\nSELECT name, salary FROM employees WHERE department = 'Sales';",
            "explanation": "This practical example retrieves the 'name' and 'salary' of employees in the 'Sales' department. It demonstrates how to specify column names and use a condition to filter data."
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Forgetting the WHERE clause",
            "incorrect_code": "-- Incorrect: Returns all rows\nSELECT name FROM employees;",
            "correct_code": "-- Correct: Filters by department\nSELECT name FROM employees WHERE department = 'Sales';",
            "explanation": "This mistake happens when a developer assumes that SELECT will always return all data, forgetting to specify conditions. Always include the WHERE clause if you want to filter results."
          }
        ],
        "practice": {
          "question": "Write a SELECT statement to retrieve the names and email addresses of customers who have made purchases over $1000.",
          "solution": "-- Solution\nSELECT c.name, c.email FROM customers c JOIN orders o ON c.customer_id = o.customer_id WHERE o.total > 1000;\n-- Explanation: This query joins the 'customers' and 'orders' tables on the customer ID, then filters for orders with a total greater than $1000."
        }
      },
      "llm_enhanced": true,
      "raw_text_preview": ", ___ _ \n. --· . \n. -\n-.. \n.. \n-- . \n,. -\nMASTER THE SQL STATEMENTS \ntl1at every application developer needs \nfor retrieving and updating the data \nin a MySQL database \nD SIGN DATABASES IKE A PRO \nand"
    },
    "stores-the-output-of-the-general-and-slow-query-lo": {
      "id": "stores-the-output-of-the-general-and-slow-query-lo",
      "title": "stores the output of the general and slow query logs in a table",
      "definition": "",
      "difficulty": "intermediate",
      "page_references": [
        535
      ],
      "sections": {
        "content": {
          "text": "log_output = TABLE",
          "pages": [
            535
          ]
        }
      },
      "educational_notes": {
        "definition": "Learn about stores the output of the general and slow query logs in a table - a key concept in SQL and database management.",
        "explanation": "log_output = TABLE",
        "key_points": [
          "Understanding stores the output of the general and slow query logs in a table is essential for working with databases"
        ],
        "examples": [
          {
            "title": "Example",
            "code": "-- See textbook for examples",
            "explanation": "Code examples available in the source material"
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Not understanding the concept fully",
            "incorrect_code": "-- Incorrect usage",
            "correct_code": "-- Correct usage (see textbook)",
            "explanation": "Review the textbook explanation carefully"
          }
        ],
        "practice": {
          "question": "Practice using stores the output of the general and slow query logs in a table in your own SQL queries",
          "solution": "Try writing queries and compare with textbook examples"
        }
      },
      "llm_enhanced": false,
      "raw_text_preview": "log_output = TABLE"
    },
    "logs-errors-warnings-and-informational-messages": {
      "id": "logs-errors-warnings-and-informational-messages",
      "title": "logs errors, warnings, and informational messages",
      "definition": "",
      "difficulty": "intermediate",
      "page_references": [
        535
      ],
      "sections": {
        "content": {
          "text": "log_error_verbosity = 3",
          "pages": [
            535
          ]
        }
      },
      "educational_notes": {
        "definition": "Learn about logs errors, warnings, and informational messages - a key concept in SQL and database management.",
        "explanation": "log_error_verbosity = 3",
        "key_points": [
          "Understanding logs errors, warnings, and informational messages is essential for working with databases"
        ],
        "examples": [
          {
            "title": "Example",
            "code": "-- See textbook for examples",
            "explanation": "Code examples available in the source material"
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Not understanding the concept fully",
            "incorrect_code": "-- Incorrect usage",
            "correct_code": "-- Correct usage (see textbook)",
            "explanation": "Review the textbook explanation carefully"
          }
        ],
        "practice": {
          "question": "Practice using logs errors, warnings, and informational messages in your own SQL queries",
          "solution": "Try writing queries and compare with textbook examples"
        }
      },
      "llm_enhanced": false,
      "raw_text_preview": "log_error_verbosity = 3"
    },
    "deletes-binary-log-files-that-are-more-than-7-days": {
      "id": "deletes-binary-log-files-that-are-more-than-7-days",
      "title": "deletes binary log files that are more than 7 days old",
      "definition": "",
      "difficulty": "intermediate",
      "page_references": [
        535
      ],
      "sections": {
        "content": {
          "text": "expire_ logs_days = 7",
          "pages": [
            535
          ]
        }
      },
      "educational_notes": {
        "definition": "Learn about deletes binary log files that are more than 7 days old - a key concept in SQL and database management.",
        "explanation": "expire_ logs_days = 7",
        "key_points": [
          "Understanding deletes binary log files that are more than 7 days old is essential for working with databases"
        ],
        "examples": [
          {
            "title": "Example",
            "code": "-- See textbook for examples",
            "explanation": "Code examples available in the source material"
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Not understanding the concept fully",
            "incorrect_code": "-- Incorrect usage",
            "correct_code": "-- Correct usage (see textbook)",
            "explanation": "Review the textbook explanation carefully"
          }
        ],
        "practice": {
          "question": "Practice using deletes binary log files that are more than 7 days old in your own SQL queries",
          "solution": "Try writing queries and compare with textbook examples"
        }
      },
      "llm_enhanced": false,
      "raw_text_preview": "expire_ logs_days = 7"
    },
    "sets-the-maximum-binary-log-file-size-to-1mb": {
      "id": "sets-the-maximum-binary-log-file-size-to-1mb",
      "title": "sets the maximum binary log file size to 1MB",
      "definition": "",
      "difficulty": "intermediate",
      "page_references": [
        535
      ],
      "sections": {
        "content": {
          "text": "max_binlog_size = 1048576",
          "pages": [
            535
          ]
        }
      },
      "educational_notes": {
        "definition": "Learn about sets the maximum binary log file size to 1MB - a key concept in SQL and database management.",
        "explanation": "max_binlog_size = 1048576",
        "key_points": [
          "Understanding sets the maximum binary log file size to 1MB is essential for working with databases"
        ],
        "examples": [
          {
            "title": "Example",
            "code": "-- See textbook for examples",
            "explanation": "Code examples available in the source material"
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Not understanding the concept fully",
            "incorrect_code": "-- Incorrect usage",
            "correct_code": "-- Correct usage (see textbook)",
            "explanation": "Review the textbook explanation carefully"
          }
        ],
        "practice": {
          "question": "Practice using sets the maximum binary log file size to 1MB in your own SQL queries",
          "solution": "Try writing queries and compare with textbook examples"
        }
      },
      "llm_enhanced": false,
      "raw_text_preview": "max_binlog_size = 1048576"
    },
    "writes-queries-to-the-slow-query-log-if-they-take-": {
      "id": "writes-queries-to-the-slow-query-log-if-they-take-",
      "title": "writes queries to the slow query log if they take longer than 5 seconds",
      "definition": "",
      "difficulty": "intermediate",
      "page_references": [
        535
      ],
      "sections": {
        "content": {
          "text": "long_query_time = 5 \nDescription \n• \nYou can use any of the techniques for setting global system variables that are \ndescribed in this chapter to set logging options. \nFigure 17-11 \nHow to configure logging",
          "pages": [
            535
          ]
        }
      },
      "educational_notes": {
        "definition": "The slow query log in SQL is a feature that records queries that take longer than a specified amount of time to execute. This helps database administrators identify and optimize slow-performing queries.",
        "explanation": "Imagine you're building a house, and some parts are taking much longer to construct than others. The slow query log is like a checklist that identifies which parts of the construction process are taking too long. By focusing on these slow parts, you can make improvements to speed up the entire project. In SQL databases, this helps identify queries that take too long to execute and need optimization.",
        "key_points": [
          "Key point 1: The slow query log helps identify slow-performing queries so they can be optimized.",
          "Key point 2: Set the `long_query_time` variable to specify how long a query needs to take before it's logged. In this case, any query taking longer than 5 seconds will be recorded.",
          "Key point 3: Common mistakes include not setting the `long_query_time` correctly or forgetting to enable logging altogether.",
          "Key point 4: Always test your queries in a development environment before applying them to production to avoid unintended consequences.",
          "Key point 5: Understanding slow query logs is crucial for maintaining efficient database performance."
        ],
        "examples": [
          {
            "title": "Basic Usage",
            "code": "-- Set the long_query_time to 5 seconds\nSET GLOBAL long_query_time = 5;",
            "explanation": "This example sets the `long_query_time` variable to 5 seconds. Any query that takes longer than this will be recorded in the slow query log."
          },
          {
            "title": "Practical Example",
            "code": "-- Enable logging and set long_query_time\nSET GLOBAL slow_query_log = 'ON';\nSET GLOBAL long_query_time = 5;",
            "explanation": "This example enables the slow query log and sets it to record queries that take longer than 5 seconds. This helps identify any slow queries in your database."
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Forgetting to enable logging",
            "incorrect_code": "-- Attempt to set long_query_time without enabling logging\nSET GLOBAL long_query_time = 5;",
            "correct_code": "-- Enable logging first, then set long_query_time\nSET GLOBAL slow_query_log = 'ON';\nSET GLOBAL long_query_time = 5;",
            "explanation": "If you forget to enable the slow query log before setting `long_query_time`, no queries will be recorded. Always make sure to enable logging first."
          },
          {
            "mistake": "Incorrectly setting the time value",
            "incorrect_code": "-- Set long_query_time to a non-numeric value\nSET GLOBAL long_query_time = '5';",
            "correct_code": "-- Correctly set long_query_time to 5 seconds\nSET GLOBAL long_query_time = 5;",
            "explanation": "The `long_query_time` variable should be set to a numeric value representing the time in seconds. Setting it as a string will cause an error."
          }
        ],
        "practice": {
          "question": "How would you enable the slow query log and set the threshold for logging queries that take longer than 10 seconds?",
          "solution": "To enable the slow query log and set the threshold to 10 seconds, you would use the following SQL commands:\n\nSET GLOBAL slow_query_log = 'ON';\nSET GLOBAL long_query_time = 10;\n\nThis will start recording any queries that take longer than 10 seconds to execute."
        }
      },
      "llm_enhanced": true,
      "raw_text_preview": "long_query_time = 5 \nDescription \n• \nYou can use any of the techniques for setting global system variables that are \ndescribed in this chapter to set logging options. \nFigure 17-11 \nHow to configure l"
    }
  }
}