{
  "concepts": {
    "mysql-intro": {
      "id": "mysql-intro",
      "title": "Introduction to MySQL",
      "definition": "Overview of MySQL database management system and relational databases",
      "difficulty": "beginner",
      "page_references": [
        1,
        2,
        3,
        4,
        5,
        6,
        7,
        8,
        9,
        10,
        11,
        12,
        13,
        14,
        15,
        16,
        17,
        18,
        19,
        20,
        21,
        22,
        23,
        24,
        25,
        26,
        27,
        28,
        29,
        30
      ],
      "sections": {
        "definition": {
          "text": ", ___ _ \n. --· . \n. -\n-.. \n.. \n-- . \n,. -\nMASTER THE SQL STATEMENTS \ntl1at every application developer needs \nfor retrieving and updating the data \nin a MySQL database \nD SIGN DATABASES IKE A PRO \nand code tl1e SQL state1nents tl1at create \ndatabases, tables, indexes, and ,ie,vs \nGAIN PROFESSIONAL SKILLS \nlike using transactions, stored procedures, \nfunctions, triggers, and events \nGET STARTED AS A DBA \nby learning l1ow to configure tl1e server, \nmanage security, and create bacluips\n\n3RD EDITION \nJoel Murach\n\nTRAINING & REFERENCE \n3RD EDITION \nJoel Murach \nM IKE M URACH & A SSOCIATES, I NC. \n4340 N. Knoll Ave. • Fresno, CA 93722 \nwww.murach.com • murachbooks@murach.com\n\nEditorial team \nAuthor: \nWriter/Editor: \nEditorial Support: \nProduction: \nJoel Murach \nAnne Boehm \nSteven Mannion \nSamantha Walker \nBooks on general-purpose programming languages \nMurach's Python Programming \nMurach's Java Programming \nMurach's C++ Programming \nMurach's C# \nMurach 's Visual Basic \nBooks for web developers \nMurach's HTML5 and CSS3 \nMurach's JavaScript and)Query \nMurach's PHP and MySQL \nMurach.'s Java Servlets and JSP \nMurach's ASP.NET Web Progra11iming with C# \nBooks for database programmers \nMurach 's MySQL \nMurach's SQL Server for Developers \nMurach's Oracle SQL and PLJSQL for Developers \nFor more on Murach books, \nplease visit us at www.murach.com \n© 2019, Mike Murach & Associates, Inc. \nAll rights reserved. \nPrinted in the United States of America \n10 9 8 7 6 5 4 3 2 1 \nISBN: 978-1-943872-36-7\n\nContent \nIntroduction \nSection 1 An introduction to MySQL \nChapter 1 \nChapter 2 \nChapter 3 \nChapter 4 \nChapter 5 \nAn introduction to relational databases \nHow to use MySQL Workbench and other development tools \nHow to retrieve data from a single table \nHow to retrieve data from two or more tables \nHow to insert, update, and delete data \nSection 2 More SQL skills as you need them \nChapter 6 \nChapter 7 \nChapter 8 \nChapter 9 \nHow to code summary queries \nHow to code subqueries \nHow to work with data types \nHow to use functions \nSection 3 Database design and implementation \nHow to design a database \nHow to create databases, tables, and indexes \nHow to create views \nSection 4 Stored program development \nLanguage skills for writing stored programs \nHow to use transactions and locking \nHow to create stored procedures and functions \nHow to create triggers and events \nSection 5 Database administration \nAn introduction to database administration \nHow to secure a database \nHow to backup and restore a database \nAppendixes \nAppendix A \nAppendix B \nHow to install the software for this book on Windows \nHow to install the software for this book on macOS \n• •• \nXlll\n\n•• \nExpanded contents \nVI I \nExpanded contents \nSection 1 An introduction to MySQL \n============= \nChapter 1 \nAn introduction to relational databases \nAn introduction to client/server systems ......................................... 4 \nThe hardware con1ponents of a client/server system ...................................................... 4 \nThe software components of a client/server syste111 ....................................................... 6 \nOther client/server architectures .................................................................................... 8 \nAn introduction to the relational database model ......................... 10 \nHow a table is organized ............................................................................................... 10 \nHow tables are related ................................................................................................... 12 \nHow columns are defined ............................................................................................. 14 \nHow to read a database diagram ................................................................................... 16 \nAn introduction to SQL and SQL-based systems ......................... 18 \nA brief history of SQL .................................................................................................. 18 \nA comparison of Oracle, DB2, Microsoft SQL Server, and MySQL ........................... 20 \nThe SQL statements ......................................................................... 22 \nAn introduction to the SQL statements ........................................................................ 22 \nHow to work with database objects .............................................................................. 24 \nHow to query a sin.gle table ........................................................................................... 26 \nHow to join data from two or more tables .................................................................... 28 \nHow to add, update, and delete data in a table ............................................................. 30 \nSQL coding guidelines ................................................................................................. 32 \nHow to use SQL from an application program .............................. 34 \nCommon options for accessing MySQL data ............................................................... 34 \nPHP code that retrieves data from MySQL .................................................................. 36 \nJava code that retrieves data from MySQL ................................................................... 38 \nChapter 2 \nHow to use MySQL Workbench \nand other development tools \nAn introduction to MySQL Workbench ........................................... 42 \nThe Home page of MySQL Workbench ....................................................................... 42 \nHow to open a database connection .............................................................................. 44 \nHow to start and stop the database server .................................................................... 46 \nHow to navigate through the database objects ............................................................. 48 \nHow to view and edit the data for a table ..................................................................... 50 \nHow to view and edit the column definitions for a table .............................................. 52 \nHow to use MySQL Workbench to run SQL statements ............... 54 \nHow to enter and execute a SQL statement .................................................................. 54 \nHow to use snippets ...................................................................................................... 56 \nHow to handJe syntax errors ......................................................................................... 58 \nHow to open and. save SQL scripts ............................................................................... 60 \nHow to enter and execute SQL scripts .......................................................................... 62 \nHow to use the MySQL Reference Manual ..................................... 64 \nHow to view the manual ............................................................................................... 64 \nHow to look up information .......................................................................................... 64 \nHow to use the MySQL Command Line Client ............................... 66 \nHow to start and stop the MySQL Command Line Client ........................................... 66 \nHow to use the MySQL Command Line Client to work with a database .................... 68\n\n••• \nVIII \nExpanded contents \nChapter 3 \nHow to retrieve data from a single table \nAn introduction to the SELECT statement ..................................... 74 \nThe basic syntax of the SELECT statement ................................................................. 74 \nSELECT statement examples ....................................................................................... 76 \nHow to code the SELECT clause ..................................................... 78 \nHow to code column specifications .............................................................................. 78 \nHow to name the columns in a result set using aliases ................................................ 80 \nHow to code arithmetic expressions ............................................................................. 82 \nHow to use the CONCAT function to join strings ........................................................ 84 \nHow to use functions with strings, dates, and numbers ............................................... 86 \nHow to test expressions by coding statements without FROM clauses ....................... 88 \nHow to eliminate duplicate rows .................................................................................. 90 \nHow to code the WHERE clause ..................................................... 92 \nHow to use the compariso11 operators ........................................................................... 92 \nHow to use the AND, OR, and NOT logical operators ................................................ 94 \nHow to ·use the IN\" operator ........................................................................................... 96 \nHow to use the BETWEEN operator ............................................................................ 98 \nHow to use the LIKE and REG EXP operators .......................................................... 100 \nHow to use the IS NULL clause ................................................................................. I 02 \nHow to code the ORDER BY clause .............................................. 104 \nHow to sort by a column name ................................................................................... 104 \nHow to sort by an alias, expression, or colun1n number ............................................. 106 \nHow to code the LIMIT clause ....................................................... 108 \nHow to limit the number of rows ................................................................................ 108 \nHow to return a range of rows .................................................................................... 108 \nChapter 4 \nHow to retrieve data from two or more tables \nHow to work with inner joins ......................................................... 114 \nHow to code an inner join ........................................................................................... 114 \nHow to use table aliases ................................................................................................. 116 \nHow to join to a table in another database .................................................................. 118 \nHow to use compound join conditions ........................................................................ 120 \nHow to use a self-join .................................................................................................. 122 \nHow to join more than_ two ta.bl es ............................................................................... 124 \nHow to use the in1plicit in11er join syntax ................................................................... 126 \nHow to work with outer joins ......................................................... 128 \nHow to code a·n outer join ........................................................................................... 128 \nOuter join examples .................................................................................................... 130 \nOther skills for working with joins ................................................ 134 \nHow to join tables with the USING keyword ............................................................. 134 \nHow to join tables with the NATURAL keyword ...................................................... 136 \nHow to use c·rossjoins ................................................................................................ 138 \nHow to work with unions ................................................................ 140 \nHow to code a union ................................................................................................... 140 \nA union that combi11es result sets frorn different tables ............................................. 140 \nA union that combines result sets from the same tables ............................................ 142 \nA union that si1nulates a full outer join ...................................................................... 144",
          "pages": [
            1,
            2,
            3,
            4,
            5,
            6,
            7,
            8,
            9,
            10
          ],
          "relevance": {
            "score": 0.6,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.2,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "examples": {
          "text": "• \nExpanded contents \nIX \nChapter 5 \nHow to insert, update, and delete data \nHow to create test tables ............................................................... 150 \nHow to create the tables for this book ........................................................................ 150 \nHow to create a copy of a table ................................................................................... 150 \nHow to inser,t new rows .................................................................. 152 \nHow to insert a single row .......................................................................................... 152 \nHow to insert multiple rows ........................................................................................ 152 \nH.ow to insert default values and null vaJues .............................................................. 154 \nHow to use a subquery in an INSERT statement ....................................................... 156 \nHow to update existing rows ......................................................... 158 \nHow to update rows .................................................................................................... 158 \nHow to use a subquery in an UPDATE statement ...................................................... 160 \nHow to delete existing rows ........................................................... 162 \nHow to delete rows ........................................................................................................ 162 \nHow to use a subquery in a DELETE statement ........................................................ 162 \nSection 2 More SQL skills as you need them \nChapter 6 \nHow to code summary queries \nHow to work with aggregate functions ......................................... 170 \nHow to code aggregate functions ................................................................................ 170 \nQueries that use aggregate functions .......................................................................... 172 \nHow to group and summarize data ............................................... 174 \nHow to code the GROUP BY and HAVING clauses ................................................. 174 \nQueries that use the GROUP BY and HAVING clauses ............................................ 176 \nHow the HAVING clause compares to the WHERE clause ...................................... 178 \nHow to code compound search conditions ................................................................. 180 \nHow to use the WITH ROLLUP operator .................................................................. 182 \nHow to use the GROUPING fu nction ........................................................................ 184 \nHow to code aggregate window functions ................................... 188 \nHow the aggregate window functions work ............................................................... 188 \nHow to use frames ................................................................................... ..................... 190 \nHow to use named windows ........................................................................................ 194 \nChapter 7 \nHow to code subqueries \nAn introduction to subqueries ...................................................... 200 \nWhere to code subqueries ............................................................................................. 200 \nWhen to use subqueries ............................................................................................... 202 \nHow to code subqueries in the WHERE clause ........................... 204 \nHow to use the IN operator ......................................................................................... 204 \nHow to use the comparison operators ......................................................................... 206 \nHow to use the ALL keyword ......................................................... 208 \nHow to use the ANY and SOME keywords ............................................................... 210 \nHow to code correlated subqueries ............................................................................. 212 \nHow to use the EXISTS operator ............................................................................... 214 \nHow to code subqueries in other clauses .................................... 216 \nHow to code subqueries in the HAVING cJause ........................................................ 216 \nHow to code subqueries in the SELECT clause ......................................................... 216 \nHow to code subqueries in the FROM clause ............................................................. 218\n\nX \nExpanded contents \nHow to work with complex queries ............................................... 220 \nA complex query that uses subqueries ........................................................................ 220 \nA procedure for building complex queries ................................................................ 222 \nHow to work with common table expressions ............................. 224 \nHow to code a CTE ..................................................................................................... 224 \nHow to code a recursive CTE ..................................................................................... 226 \nChapter 8 \nHow to work with data types \nThe data types ................................................................................. 232 \nOverview ....................................................................................................................... 232 \nThe character types ..................................................................................................... 234 \nThe integer types ......................................................................................................... 236 \nThe fixed-point and floating-point types .................................................................... 238 \nThe date and time types .............................................................................................. 240 \nThe ENUM and SET types ......................................................................................... 244 \nThe large object types ................................................................................................. 246 \nHow to convert data ........................................................................ 248 \nHow implicit data conversion works ........................................................................... 248 \nHow to convert data using the CAST and CONVERT functions .............................. 250 \nHow to convert data using the FORMAT and CHAR functions ............................... 252 \nChapter 9 \nHow to use functions \nHow to work with string data ......................................................... 258 \nA sum mary of the string functions ............................................................................. 258 \nExamples that use string functions ............................................................................. 260 \nHow to sort by a string column that contains nun1bers .............................................. 262 \nHow to parse a string .................................................................................................. 264 \nHow to work with numeric data ..................................................... 266 \nHow to use the numeric functions .............................................................................. 266 \nHow to search for floating-point numbers .................................................................. 268 \nHow to work with date/time data ................................................... 270 \nHow to get the current date and time .......................................................................... 270 \nHow to parse dates and times with date/time functions ............................................ 272 \nHow to parse dates and times with the EXTRACT function ..................................... 274 \nHow to format dates and times ................................................................................... 276 \nHow to perform calculations on dates and times ....................................................... 278 \nHow to search for a date ............................................................................................. 280 \nHow to search for a time ............................................................................................. 282 \nOther functions you should know about ...................................... 284 \nHow to use the CASE fu nction ................................................................................... 284 \nHow to use the IF, IFNULL, and COALESCE functions .......................................... 286 \nHow to use the regular expression functjons .............................................................. 288 \nHow to use the ranking functions ............................................................................... 292 \nHow to use the analytic functions ....................................................................................... 296 \nSection 3 Database design and implementation \nChapter 10 How to design a database \nHow to design a data structure ..................................................... 306 \nThe basic steps for designing a data structure ............................................................ 306 \nHow to identify the data elements .............................................................................. 308\n\n• \nExpanded contents \nXI \nHow to subdivide the data elements ........................................................................... 310 \nHow to identify the tables and assign colu1nns .......................................................... 312 \nHow to identify the primary and foreign keys ............................................................ 314 \nHow to enforce the relationships between tables ....................................................... 316 \nHow normalizatio·n works .......................................... \nH \n••• • •••• •\n•\n• •• •\n•\n•\n••\n•\n•\n•\n• •• •\n•\n•\n• •• • •• •\n•\n• •••• •\n• •• •\n•\n• 318 \nHow to identify the colun1 ns to be indexed ................................................................ 320 \nHow to normalize a data structure ................................................ 322 \nThe seven nor111a I forms ............................................................................................. 322 \nHow to apply the first normal forn1 ............................................................................ 324 \nHow to apply the second normal form ........................................................................ 326 \nHow to apply the third normal form ........................................................................... 328 \nWhen and how to denormalize a data structure ......................................................... 330 \nHow to use MySQL Workbench for database design ................. 332 \nHow to open an existing EER model .......................................................................... 332 \nHow to create a new EER model ................................................................................ 332 \nHow to work w itb an EER 1n odel ............................................................................... 334 \nHow to work with an EER diagran1 ............................................................................ 336 \nHow to create databases, tables, and indexes \nHow to work with databases .......................................................... 342 \nHow to create and drop a database ............................................................................. 342 \nHow to select a. database ............................................................................................. 342 \nHow to work with tables ................................................................. 344 \nHow to create a. table ................................................................................................... 344 \nHow to code a primary key constraint. ....................................................................... 346 \nHow to code a foreign key constraint ......................................................................... 348 \nHow to alter the columns of a table ............................................................................ 350 \nHow to alter the constraints of a table ........................................................................ 352 \nHow to rename, truncate, and drop a table ................................................................. 354 \nHow to work with indexes .............................................................. 356 \nHow to create an index ................................................................................................ 356 \nHow to dJ·op an index .................................................................................................... 356 \nA script that creates a database .................................................... 358 \nHow to use MySQL Workbench ..................................................... 362 \nHow to work with the columns of a table ................................................................... 362 \nHow to work with the indexes of a table ..................................................................... 364 \nHow to work with the foreign keys of a table ............................................................. 366 \nHow to work with character sets and collations .......................... 368 \nAn introduction to character sets and collations ........................................................ 368 \nHow to view character sets and collations .................................................................. 370 \nHow to specify a character set and a collation ........................................................... 372 \nHow to work with storage engines ................................................ 374 \nAn introduction to storage engines ............................................................................. 374 \nHow to view storage engines ...................................................................................... 374 \nHow to specify a storage engine ................................................................................. 376\n\n•• \nXII \nExpanded contents \nChapter 12 How to create views \nAn introduction to views ................................................................ 382 \nHow views work .......................................................................................................... 3 82 \nBenefits of using views ............................................................................................... 384 \nHow to work with views .................................................................. 386 \nHow to create a view ................................................................................................... 3 86 \nHow to create an updatable view ................................................................................ 390 \nHow to use the WITH CHECK OPTION clause ....................................................... 392 \nHow to insert or delete rows through a view .............................................................. 394 \nHow to alter or drop a view ........................................................................................ 396 \nSection 4 Stored program= develop==m= e=n=t======~ \nChapter 13 Language skills for writing stored programs \nAn introduction to stored programs ............................................. 402 \nFour types of stored programs .................................................................................... 402 \nA script that creates and calls a stored procedure ...................................................... 402 \nA summary of statements for coding stored programs .............................................. 404 \nHow to write procedural code ....................................................... 406 \nHow to display data ..................................................................................................... 406 \nHow to declare and set variables ................................................................................ 408 \nHow to code IF statements .......................................................................................... 410 \nHow to code CASE statements ................................................................................... 412 \nHow to code loops ........................................................................................................... 414 \nHow to use a cursor ........................................................................................................ 416 \nHow to declare a condition handler ............................................................................ 418 \nHow to use a condition handler .................................................................................. 420 \nHow to use multiple condition handlers ..................................................................... 424 \nChapter 14 How to use transactions and locking \nHow to work with transactions ...................................................... 430 \nHow to conllllit and rollback transactions .................................................................. 430 \nHow to work with save points ..................................................................................... 432 \nHow to work with concurrency and locking ................................. 434 \nHow concurrency and locking are related .................................................................. 434 \nThe four concurrency problems that locks can prevent .............................................. 436 \nHow to set the transaction isolation level ................................................................... 438 \nHow to lock selected rows .......................................................................................... 440 \nHow to preve.nt deadlocks .............................................................................................. 442 \nChapter 15 How to create stored procedures and functions \nHow to code stored procedures .................................................... 446 \nHow to create and cal 1 a stored procedure ................................................................. 446 \nHow to code input and output paran1eters .................................................................. 448 \nHow to set a default value for a para1neter ................................................................. 450 \nHow to validate parameters and raise errors .............................................................. 452 \nA stored procedure tl1at inserts a row ......................................................................... 454 \nHow to work with user variables ................................................................................ 458 \nHow to work with dynamic SQL ................................................................................ 460 \nHow to drop a stored procedure .................................................................................. 462 \nHow to code stored functions ....................................................... 464 \nHow to create and cal I a function ............................................................................... 464\n\n••• \nExpanded contents \nXI 11 \nHow to use function characteristics ............................................................................ 466 \nA function that calculates balance due ....................................................................... 468 \nHow to drop a function ............................................................................................... 470 \nHow to use Workbench with procedures \nand functions .................................................................................. 472 \nHow to view and edit to red routines ......................................................................... 472 \nHow to create stored routines ..................................................................................... 472 \nHow to drop stored routines ........................................................................................ 472 \nChapter 16 How to create triggers and events \nHow to work with triggers .............................................................. 478 \nHow to create a BEFORE trigger ............................................................................... 478 \nHow to use a trigger to enforce data consistency ....................................................... 480 \nHow to create an AFTER trigger ............................................................................... 482 \nHow to view or drop triggers ...................................................................................... 484 \nHow to work with events ................................................................ 486 \nHow to turn the event scheduler on or off .................................................................. 486 \nHow to create an event ................................................................................................ 486 \nHow to view, alter, or drop events .............................................................................. 488 \nSection 5 Database administration \nChapter 17 An introduction to database administration \nDatabase administration concepts ............................................... 494 \nDatabase administrator responsibilities ...................................................................... 494 \nTypes of database files ................................................................................................ 496 \nTypes of log fi Jes .......................................................................................................... 496 \nHow to monitor the server ............................................................. 498 \nHow to view the server status ...................................................................................... 498 \nHow to view a11d kill processes .................................................................................. 500 \nHow to view the status variables ................................................................................ 502 \nHow to view the system variables ............................................................................... 504 \nHow to configure the server .......................................................... 506 \nHow to set system variables using MySQL Workbench ............................................. 506 \nHow to set system variables using a text editor .......................................................... 508 \nHow to set system variables using the SET statement ................................................ 510 \nHow to work with logging .............................................................. 512 \nHow to enable and disable logging ............................................................................. 512 \nHow to configure logging ........................................................................................... 514 \nHow to view text-based logs ....................................................................................... 516 \nHow to manage logs ..................................................................................................... 518 \nChapter 18 How to secure a database \nAn introduction to user accounts ................................................. 524 \nAn introduction to SQL statements for user accounts ................................................ 524 \nA sum 1nary of privileges ............................................................................................ 526 \nThe four privilege levels ............................................................................................. 530 \nThe grant tables in the mysql database ....................................................................... 530 \nHow to work with users and privileges ........................................ 532 \nHow to create, rename, and drop users ....................................................................... 532 \nHow to specify user account names ........................................................................... 534 \nHow to grant privileges ............................................................................................... 536\n\n• \nXIV \nExpanded contents \nHow to view privileges ............................................................................................... 538 \nHow to revoke privileges ............................................................................................ 540 \nHow to change passwords ........................................................................................... 542 \nA script that creates users ........................................................................................... 544 \nHow to work with roles ................................................................... 546 \nHow to create, manage, and drop roles ....................................................................... 546 \nA script that creates users and roles ........................................................................... 550 \nHow to use MySQL Workbench ..................................................... 552 \nHow to work with users and privileges ....................................................................... 552 \nHow to connect as a user for testing ........................................................................... 556 \nChapter 19 How to backup and restore a database \nStrategies for backing up and restoring a database ................... 564 \nA backup strategy ....................................................................................................... 564 \nA 1·estoi·e strategy ........................................................................................................ 564 \nHow to back-up a database ............................................................ 566 \nHow to use 1n.ysqldump to back up a database ........................................................... 566 \nA SQL script file for a database backup ..................................................................... 568 \nHow to set advanced options for a database backup .................................................. 572 \nHow to restore a database ............................................................. 574 \nHow to use a SQL script file to restore a full backup ................................................. 574 \nHow to execute statements in the binary log .............................................................. 576 \nHow to import and export data ...................................................... 578 \nHow to export data to a file ......................................................................................... 578 \nHow to import data from a file ................................................................................... 580 \nHow to check and repair tables ..................................................... 582 \nHow to use the CHECK TABLE statement ................................................................ 582 \nHow to repair a My ISAM table .................................................................................. 584 \nHow to repair an InnoDB table ................................................................................... 584 \nHow to use the mysqlcheck program .......................................................................... 586 \nHow to use the 1nyisa1nchk program .......................................................................... 588 \nAppendix A How to install the software for this book \non Windows \nHow to install the software from mysql.com ............................... 594 \nHow to install the MySQL Community Server .......................................................... 594 \nHow to install MySQL Workbench ............................................................................ 594 \nHow to install the software from murach.com ............................. 596 \nHow to install the source files for tbis book ............................................................... 596 \nHow to create the databases for this book .................................................................. 598 \nHow to 1·estore the databases ...................................................................................... 598 \nAppendix B How to install the software for this book \non macOS \nHow to install the MySQL Co1nmunity Server .......................................................... 602 \nHow to install the source files for this book ............................................................... 606 \nHow to restore the databases ...................................................................................... 608\n\nIntroduction \nSince its release in 2000, MySQL has become the world's most popular open-\nsource database. It has been used by everyone from hobbyists to the world's \nlargest companies to deliver cost-effective, high-performance, scalable database \napplications .. . the type of applications that the web is built on. In fact, MySQL \nhas been used as the database for many high-profile websites, including \nWikipedia, Facebook, and Twitter. So knowing MySQL is a plus for any \ndeveloper today. \nWho this book is for \nThis book is designed for developers who are new to MySQL, as well as \ndevelopers who have been using MySQL for years but who still aren't getting \nthe most from it. It shows how to code all the SQL statements that developers \nneed for their applications, and it shows how to code these statements so they run \nefficiently. \nThis book is also a good choice for anyone who wants to learn standard \nSQL. Since SQL is a standard language for accessing database data, most of the \nSQL code in this book will work with any database management system. As a \nresult, once you use this book to learn how to use SQL to work with a MySQL \ndatabase, you can transfer most of what you have learned to another database \nmanagement system, such as Oracle, SQL Server, or DB2. \nThis book is also the right.first book for anyone who wants to become a \ndatabase administrator. Although this book doesn't present all of the advanced \nskills that are needed by a DBA, it will get you started. Then, when you complete \nthis book, you'll be prepared for more advanced books on the subject. \n5 reasons why you'll learn faster with this book \n• \nUnlike most MySQL books, this one starts by showing you how to query an \nexisting database rather than how to create a new database. Why? Because \nthat's what you're most likely to need to do first on the job. Once you master \nthose skills, you can learn how to design and implement a database if you\n\n• \nXVI \nIntroduction \nneed to do that. Or, you can learn how to work with other database features \nlike transactions or stored procedures if you need to do that. \n• \nUnlike most MySQL books, this one shows you how to use MySQL \nWorkbench to enter and run your SQL statements. MySQL Workbench is a \ngraphical tool that's an intuitive and user-friendly alternative to the MySQL \nCommand Line Client, a command-line program that has been around sin,ce \nthe beginning of MySQL. In 011r experience, using MySQL Workbench \ninstead of the command line helps you learn more quickly. \n• \nLike all of our books, this one includes hundreds of examples that range \nfrom the simple to the complex. That way, you can quickly get the idea of \nhow a feature works from the simple examples, but you'll also see how the \nfeature is used in the real world from the complex examples. \n• \nLike all of our books, this one has exercises at the end of each chapter that \ngive you hands-on experience by letting you practice what you've learned. \nThese exercises also encourage you to experiment and to apply what you've \nlearned in new ways. \n• \nIf you page through this book, you'll see that all of the info1·mation is \npresented in ''paired pages,\" with the essential syntax, examples, and \nguidelines on the right page and the perspective and extra explanation on \nthe left page. This helps you learn more with less reading, and it is the ideal \nreference format when you need to refresh your memory about how to do \nsomething. \nWhat you'll learn in this book \n• \nIn section 1, you'll learn the concepts and terms you need for working with \nany database. Yot1'll learn how to use MySQL Workbench to work with a \ndatabase and run SQL statements. You'll also learn all the SQL skills for \nretrieving data from a database and for adding, updating, and deleting that \ndata. These skills are the critical SQL skills that you'll need to get started. \n• \nIn section 2, you can learn more SQL skills as you need them. You can \nlearn how to sun1marize the data that you retrieve. You can learn how \nto code subqueries. You can learn about the types of data that MySQL \ns11pports. And you can learn how to use MySQL functions in your SQL \nstaten1ents. These advanced skills are sure to raise your expertise even if \nyou already have SQL experience. \n• \nIn section 3, you'll learn how to design a database. This includes learning \nhow to use MySQL Workbench to create an EER ( enhanced entity-\nrelationship) model for your database. Then, you'll learn how to implement \nthat design by using the DDL (Data Definition Language) statements \nthat are a part of SQL. When you're done, you'll be able to design and \nimplement your own database. In addition, you'll gain valuable perspective \nthat will make you a better SQL programmer, even if you never have to \ndesign a database.\n\n•• \nIntroduction. \nXVI I \n• \nIn section 4, you'll learn how to use MySQL to create stored procedures, \nfunctions, triggers, and events. In addition, you'll learn how to manage \ntransactions and locking. These features allow you to create programs \nmade up of multiple SQL statements that can be stored in the database \nand accessed as needed, either to run on their own or to use in application \nprograms ... a great productivity booster! So once you master these features, \nyou'll have a powerful set of MySQL skills. \n• \nIn section 5, you'll learn a starting set of skills for becoming a database \nadministrator (DBA). These skills include how to secure a database, how to \nback up a database, and how to restore a database. \nWhat software you need for this book \nAlthough you should be able to use this book with most versions of MySQL, \nwe recommend that you use: \n• \nMySQL Community Server 8.0 or higher \n• \nMySQL Workbench 8.0 or higher \nBoth of these products can be downloaded for free from MySQL's website. And \nappendixes A (for Windows) and B (for macOS) provide complete instructions \nfor installing them. \nSince the MySQL server is backwards compatible, all of the SQL statements \npresented in this book should also work with future versions of MySQL. In \naddition, most statements presented in this book work with earlier versions of \nMySQL, and we have done our best to identify any statements that don't. \nIf you use MySQL Workbench 8.0, all of the skills presented in this book \nshould work exactly as described. However, MySQL Workbench is being actively \ndeveloped, so its functionality is improving all the time. As a result, you may \nwant to use a later version of MySQL Workbench. If you do, the skills presented \nin this book may not work exactly as described, but they sl1ould work similarly. \nWhat you can download from our website \nYou can download all the source code for this book from our website. That \nincludes: \n• \nA script file that creates the three databases used by this book \n• \nThe source code for all of the examples in this book \n• \nThe solutions to the exercises that are at the end of each chapter \nAgai11, appendixes A (Windows) and B (macOS) provide complete instructions \nfor installing these items on yot1r computer.\n\n••• \nXVI 11 \nIntroduction \nSupport materials for trainers and instructors \nIf you're a corporate trainer or a college instructor who would like to use \nthis book for a course, we've created a set of instructional materials that include: \n(1) a complete set of PowerPoint slides that you can use to review and reinforce \nthe content of the book; (2) instructional objectives that describe the skills a \nstudent should have upon completion of each chapter; (3) test banks that measure \nmastery of those skills; (4) additional exercises that aren't in this book; and (5) \nsolutions to those exercises. \nTo learn more about these instructional materials, please go to our website \nat www.murachforinstructors.com if you're an instructor. Or if you're a trainer, \nplease go to www.murach.co1n and click on the Coursewa,·e for Traine,·s link, or \ncontact Kelly at 1-800-221-5528 or kelly@murach.com. \nPlease let me know how this book works for you \nWhen I started this book, I had two goals. First, I wanted to get you started \nwith MySQL as quickly and easily as possible. Second, I wanted to raise your \ndatabase development skills to a professional level. \nNow, I thank you for buying this book. I wish you all the best with your \nMySQL development. And if you have any comments about this book, I'd love to \nhear from you. \nJoelMurach,Author \njoel@murach.com",
          "pages": [
            11,
            12,
            13,
            14,
            15,
            16,
            17,
            18,
            19,
            20
          ],
          "relevance": {
            "score": 0.8,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.0,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "commonMistakes": {
          "text": "An introduction to MySQL \nBefore you begin to learn how to write SQL statements that work with \nMySQL, you need to understand some concepts and terms related to SQL \nand relational databases. That's what you'll learn in chapter 1. In addition, \nyou'll need to learn about some of the tools you can use to work with a \nMySQL database. That's what you'll learn in chapter 2. \nAfter that, you'll be ready to learn about the most important SQL \nstatements. In chapter 3, you'll learn how to use the SELECT statement \nto retrieve data from a single table. In chapter 4, you'll learn how to use \nthe SELECT statement to retrieve data from two or more tables. And in \nchapter 5, you'll learn how to use the INSERT, UPDATE, and DELETE \nstatements to add, update, and delete rows. At that point, you'll have all of \nthe background and skills that you need to work with the rest of this book.\n\nAn introduction \nto relational databases \nThis chapter presents the concepts and term.~ that you should understand \nbefore }rou begin learning how to \\Vork \\Vith a SQL database such as 1'1ySQL. \nAlthough thi chapter doesn't present the coding details. it doe pre. ent an \no~·en·ie\"'' of the most importa.11t type ot· SQL staten1ents that are presented in \nthis book. \nAn introduction to client/server systems ·····~····················~·4 \n·n1e l1ardware co1nponeru of a cl1entlser,er sy!den1 ...................................... 4 \n·rhe . ot l\\vare con1ponents at a client/. er,,er S)' ten1 ........................................ 6 \n01.he1 cl ie r1t/.ser, er architec1 ut es ..................................................................... & \nAn intr,oductlon to the relational database model ............ 10 \nHo\\\\' a table is 01gan1zed ........................................ - ..................................... 10 \nHo'\\\\' r:ible~ are re lated .................................. --· ................... -· .............................................. 12 \nHo\\.v column!! are uelined .............................................................................. 14 \nHov.• Lo read a database diagratn .................................................................... 16 \n... \nAn introduction to SQL and SOL-based systems ............. 18 \nA briet J1i tor) ot SQL ............................................................... .., ................................ .-......................... _ ... 18 \nA co111par1sot1 oJ Orucle. 082. ~1 icrt)s.oft SQL Sen,er. and My QL ........... 20 \nThe SOL stateme.nts ................................................................ 22 \nAn 1nuoducuon to the SQL ~ta1e1nenb ................................................... ·-···21 \nHov.• 10 v.ork '\"itJ1 database objel.L'i ... - ..................................... ·-················· 24 \nHo\\\\ to query a ;;;1ngle table ........................................................................... 26 \nHow to join data lrorn 1,-.0 or 1nore tables ..................................................... 28 \nHov.• Lo add, update, and dele1e dam in a rab1e .............................................. 30 \nSQL codtng guidelines ...... - ............. - ................... ~ ................. - ........... ._ ............. - ............................. ._ ... - ... .32 \nHow to use SQL from an application program .................. 34 \nComn1on opt1ons for acces ing MySQL data ................................................ 34 \nPHP code tJ1at reLrieves data from ~fySQL ................................................... 36 \nJava code that retrLeve~ daca I ron1 ~1)1SQL ................................................... 38 \nPerspective ..................................... _. ......................................... 40\n\nSection 1 \nAn introduction to MySQL \nAn introduction \nto client/server syste111s \nIn case you aren't familiar with client/server systems, the topics that follow \nintroduce you to their essential hardware and software components. When \nyou use SQL to access a MySQL database, that system is often a client/server \nsystem. \nThe hardware components \nof a client/server system \nsystem: the clients, the network, and the server. The clients are usually the PCs \nthat are already available on the desktops throughout a company. Clients can also \nbe mobile devices like laptops, tablets, and smrutphones. And the network is the \ncabling, communication lines, network interface cards, hubs, routers, and other \ncomponents that connect the clients and the server. \nThe server, commonly referred to as a database server, is a con1puter that \nhas enough processor speed, inte1·nal memory (RAM), and disk storage to store \nthe files and databases of the system and provide services to the clients of the \nsystem. This computer can be a high-powered PC, a 1nidrange system like \nan IBM Power System or Unix system, or even a mainframe system. When a \nsystem consists of networks, midrange systems, and mainframe systems, often \nspread throughout the country or world, it is commonly referred to as an enter-\nprise system. \nTo back up the files of a client/server system, a server usually has a backup \ndisk drive or some other form of offline storage. It often has one or more printers \nor specialized devices that can be shared by the users of the system. And it can \nprovide programs or services like e-mail that can be accessed by all the users of \nthe system. \nIn a simple client/server system, the clients and the server are part of a \nlocal area network (LAN). However, two or more LANs that reside at separate \ngeographical locations can be connected as part of a larger network such as a \nwide area network (WAN). In addition, individual systems or networks can be \nconnected over the Internet.\n\nCl1t1pter 1 \nAi, i11trodi1ctio11 to 1?latio1,al datal1t1ses \nA simple client/server system \nI \nDatabase Server \nNetwork \nClient \nClient \nClient \nThe three hardware components of a client/server system \n• \nThe clie111.r are the PC . • Mac . or workstation. of the system. Tl1ey can also be \nmobile de,1ice like laptops. tablet~, and smartphones. \n• \nThe set1rer is a con1puter that stores the files and database of· the system and \nprovide services to the clients. W11en it stores dntabnses. itls often referred to as a \ndatab,1~~e sen·er. \n• \nThe 11en,•ork con. i ts of the cabling. communication line , and other component \nthat connect the clienu and the erver ot· lhe . y tem. \nClient/server system implementations \n• \nIn a si1nple clie11t/sen•er S)'Ste111 like the one above. the sen·er i t),.pically a \nhigh-po\\vered PC that comn1unicate \\vith the clients o er a local area nen,•ork \n(IAN). \n• \nThe er,·er can aJ o be a n1idrange sy. tern, like a t1 IBM Po\\ver Sy tern or a Unix \nyste111. or it can be a mainframe . y ten1. \n• \nA client/server system can also con ist of one or more PC-b~ed S)'Stems, one \nor n1ore n1idrange system , and a mainfran1e ystem in dispersed geographical \nlocations. Thi. type ot· system is commonly referred to as an e11terprise S)·ste11-1. \n• \nlndi\\,idual sy ten1s and LAN can be connected and share data over larger pfi,,ate \nnetwork .. such as a li1ide area 11et,,·ork (\\VA.A~. or a public net\\\\'Ork like the Internet. \nThe hardware components of a client/server system",
          "pages": [
            21,
            22,
            23,
            24,
            25
          ],
          "relevance": {
            "score": 0.8,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.0,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        }
      },
      "educational_notes": {
        "definition": "The SELECT statement is used to retrieve data from a database. It allows you to specify which columns and rows to fetch based on certain conditions.",
        "explanation": "The SELECT statement is one of the most fundamental tools in SQL, allowing developers to extract specific information from a database. It works by specifying the columns you want to retrieve and optionally filtering the data with WHERE clauses. This statement is crucial for querying databases and retrieving the necessary data for applications. Understanding how to use SELECT effectively can greatly enhance your ability to interact with and manipulate data in MySQL.",
        "key_points": [
          "Key point 1: The SELECT statement retrieves data from a database based on specified conditions.",
          "Key point 2: You can specify which columns to retrieve using column names or aliases.",
          "Key point 3: Use the WHERE clause to filter rows based on specific conditions.",
          "Key point 4: Always ensure your SQL statements are optimized for performance by selecting only necessary columns and using efficient queries.",
          "Key point 5: Understanding SELECT is essential for all database operations, including data retrieval, analysis, and reporting."
        ],
        "examples": [
          {
            "title": "Basic Usage",
            "code": "-- Selecting specific columns FROM a TABLE SELECT name, age FROM users;",
            "explanation": "This example demonstrates how to select the 'name' and 'age' columns from the 'users' table. It retrieves all rows in the table.",
            "validation_note": "SQL auto-fixed: "
          },
          {
            "title": "Practical Example",
            "code": "-- Selecting data with a condition\nSELECT name FROM users WHERE age > 18;",
            "explanation": "This practical example shows how to select only the names of users who are older than 18 years. It uses a WHERE clause to filter the results based on the 'age' column."
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Forgetting to specify columns",
            "incorrect_code": "-- Incorrect: SELECT FROM users;",
            "correct_code": "-- Correct: SELECT * FROM users;",
            "explanation": "This mistake occurs when a developer tries to run a SELECT statement without specifying any columns. This will result in an error because SQL needs to know which data to retrieve."
          },
          {
            "mistake": "Using incorrect column names",
            "incorrect_code": "-- Incorrect: SELECT name, age FROM users WHERE email = 'test@example.com';",
            "correct_code": "-- Correct: SELECT name, age FROM users WHERE email = 'test@example.com';",
            "explanation": "This mistake happens when a developer specifies a column that does not exist in the table. It's crucial to double-check column names and ensure they match exactly with those in the database schema."
          }
        ],
        "practice": {
          "question": "Write a SELECT statement to retrieve the 'product_name' and 'price' from the 'products' table where the 'category' is 'Electronics'.",
          "solution": "SELECT product_name, price FROM products WHERE category = 'Electronics';\nThis query will return the names and prices of all products in the 'Electronics' category."
        }
      },
      "llm_enhanced": true,
      "raw_text_preview": ", ___ _ \n. --· . \n. -\n-.. \n.. \n-- . \n,. -\nMASTER THE SQL STATEMENTS \ntl1at every application developer needs \nfor retrieving and updating the data \nin a MySQL database \nD SIGN DATABASES IKE A PRO \nand",
      "content_relevance": {
        "score": 0.6,
        "sql_score": 1.0,
        "concept_score": 1.0,
        "non_sql_penalty": 0.2,
        "is_relevant": true,
        "analysis": "SQL content"
      }
    },
    "relational-databases-murach": {
      "id": "relational-databases-murach",
      "title": "Relational Databases",
      "definition": "Tables, rows, columns, keys, and relationships in relational databases",
      "difficulty": "beginner",
      "page_references": [
        21,
        22,
        23,
        24,
        25,
        26,
        27,
        28,
        29,
        30,
        31,
        32,
        33,
        34,
        35,
        36,
        37,
        38,
        39,
        40
      ],
      "sections": {
        "definition": {
          "text": "An introduction to MySQL \nBefore you begin to learn how to write SQL statements that work with \nMySQL, you need to understand some concepts and terms related to SQL \nand relational databases. That's what you'll learn in chapter 1. In addition, \nyou'll need to learn about some of the tools you can use to work with a \nMySQL database. That's what you'll learn in chapter 2. \nAfter that, you'll be ready to learn about the most important SQL \nstatements. In chapter 3, you'll learn how to use the SELECT statement \nto retrieve data from a single table. In chapter 4, you'll learn how to use \nthe SELECT statement to retrieve data from two or more tables. And in \nchapter 5, you'll learn how to use the INSERT, UPDATE, and DELETE \nstatements to add, update, and delete rows. At that point, you'll have all of \nthe background and skills that you need to work with the rest of this book.\n\nAn introduction \nto relational databases \nThis chapter presents the concepts and term.~ that you should understand \nbefore }rou begin learning how to \\Vork \\Vith a SQL database such as 1'1ySQL. \nAlthough thi chapter doesn't present the coding details. it doe pre. ent an \no~·en·ie\"'' of the most importa.11t type ot· SQL staten1ents that are presented in \nthis book. \nAn introduction to client/server systems ·····~····················~·4 \n·n1e l1ardware co1nponeru of a cl1entlser,er sy!den1 ...................................... 4 \n·rhe . ot l\\vare con1ponents at a client/. er,,er S)' ten1 ........................................ 6 \n01.he1 cl ie r1t/.ser, er architec1 ut es ..................................................................... & \nAn intr,oductlon to the relational database model ............ 10 \nHo\\\\' a table is 01gan1zed ........................................ - ..................................... 10 \nHo'\\\\' r:ible~ are re lated .................................. --· ................... -· .............................................. 12 \nHo\\.v column!! are uelined .............................................................................. 14 \nHov.• Lo read a database diagratn .................................................................... 16 \n... \nAn introduction to SQL and SOL-based systems ............. 18 \nA briet J1i tor) ot SQL ............................................................... .., ................................ .-......................... _ ... 18 \nA co111par1sot1 oJ Orucle. 082. ~1 icrt)s.oft SQL Sen,er. and My QL ........... 20 \nThe SOL stateme.nts ................................................................ 22 \nAn 1nuoducuon to the SQL ~ta1e1nenb ................................................... ·-···21 \nHov.• 10 v.ork '\"itJ1 database objel.L'i ... - ..................................... ·-················· 24 \nHo\\\\ to query a ;;;1ngle table ........................................................................... 26 \nHow to join data lrorn 1,-.0 or 1nore tables ..................................................... 28 \nHov.• Lo add, update, and dele1e dam in a rab1e .............................................. 30 \nSQL codtng guidelines ...... - ............. - ................... ~ ................. - ........... ._ ............. - ............................. ._ ... - ... .32 \nHow to use SQL from an application program .................. 34 \nComn1on opt1ons for acces ing MySQL data ................................................ 34 \nPHP code tJ1at reLrieves data from ~fySQL ................................................... 36 \nJava code that retrLeve~ daca I ron1 ~1)1SQL ................................................... 38 \nPerspective ..................................... _. ......................................... 40\n\nSection 1 \nAn introduction to MySQL \nAn introduction \nto client/server syste111s \nIn case you aren't familiar with client/server systems, the topics that follow \nintroduce you to their essential hardware and software components. When \nyou use SQL to access a MySQL database, that system is often a client/server \nsystem. \nThe hardware components \nof a client/server system \nsystem: the clients, the network, and the server. The clients are usually the PCs \nthat are already available on the desktops throughout a company. Clients can also \nbe mobile devices like laptops, tablets, and smrutphones. And the network is the \ncabling, communication lines, network interface cards, hubs, routers, and other \ncomponents that connect the clients and the server. \nThe server, commonly referred to as a database server, is a con1puter that \nhas enough processor speed, inte1·nal memory (RAM), and disk storage to store \nthe files and databases of the system and provide services to the clients of the \nsystem. This computer can be a high-powered PC, a 1nidrange system like \nan IBM Power System or Unix system, or even a mainframe system. When a \nsystem consists of networks, midrange systems, and mainframe systems, often \nspread throughout the country or world, it is commonly referred to as an enter-\nprise system. \nTo back up the files of a client/server system, a server usually has a backup \ndisk drive or some other form of offline storage. It often has one or more printers \nor specialized devices that can be shared by the users of the system. And it can \nprovide programs or services like e-mail that can be accessed by all the users of \nthe system. \nIn a simple client/server system, the clients and the server are part of a \nlocal area network (LAN). However, two or more LANs that reside at separate \ngeographical locations can be connected as part of a larger network such as a \nwide area network (WAN). In addition, individual systems or networks can be \nconnected over the Internet.\n\nCl1t1pter 1 \nAi, i11trodi1ctio11 to 1?latio1,al datal1t1ses \nA simple client/server system \nI \nDatabase Server \nNetwork \nClient \nClient \nClient \nThe three hardware components of a client/server system \n• \nThe clie111.r are the PC . • Mac . or workstation. of the system. Tl1ey can also be \nmobile de,1ice like laptops. tablet~, and smartphones. \n• \nThe set1rer is a con1puter that stores the files and database of· the system and \nprovide services to the clients. W11en it stores dntabnses. itls often referred to as a \ndatab,1~~e sen·er. \n• \nThe 11en,•ork con. i ts of the cabling. communication line , and other component \nthat connect the clienu and the erver ot· lhe . y tem. \nClient/server system implementations \n• \nIn a si1nple clie11t/sen•er S)'Ste111 like the one above. the sen·er i t),.pically a \nhigh-po\\vered PC that comn1unicate \\vith the clients o er a local area nen,•ork \n(IAN). \n• \nThe er,·er can aJ o be a n1idrange sy. tern, like a t1 IBM Po\\ver Sy tern or a Unix \nyste111. or it can be a mainframe . y ten1. \n• \nA client/server system can also con ist of one or more PC-b~ed S)'Stems, one \nor n1ore n1idrange system , and a mainfran1e ystem in dispersed geographical \nlocations. Thi. type ot· system is commonly referred to as an e11terprise S)·ste11-1. \n• \nlndi\\,idual sy ten1s and LAN can be connected and share data over larger pfi,,ate \nnetwork .. such as a li1ide area 11et,,·ork (\\VA.A~. or a public net\\\\'Ork like the Internet. \nThe hardware components of a client/server system\n\nSection 1 \nAn introduction to MySQL \nThe software components \nof a client/server system \nsystem. Here, the server requires a database management system (DBMS) like \nMySQL or Microsoft SQL Server. This DBMS manages the databases that are \nstored on the server. \nIn contrast to a server, each client requires application software to perform \nuseful work. This can be a purchased software package like a financial \naccounting package, or it can be custom software that's developed for a specific \napplication. \nAlthough the application software is run on the client, it uses data that's \nstored on the server. To do that, it uses a data access AP/ (application program-\n1ning interface). Since the technique you use to work with an API depends on the \nprogramming language and API you're using, you won't learn those techniques \nin this book. Instead, you'll learn about a standard language called SQL \n(Structured Query Language) that lets any application communicate with any \nDBMS. (In conversation, SQL is pronounced as either S-Q-L or sequel.) \nOnce the software for both client and server is installed, the client commu-\nnicates with the server via SQL queries (or just queries) that are passed to the \nDBMS through the API. After the client sends a query to the DBMS, the DBMS \ninterprets the query and sends the results back to the client. \nIn a client/server system, the processing is divided between the clients and \nthe server. In this figure, for example, the DBMS on the server processes the \nrequests that are made by the application running on the client. Theoretically, at \nleast, this balances the workload between the clients and the server so the systen1 \nworks more efficiently.\n\nCl1apter 1 \nAn introduction to relational databases \nClient software, server software, and the SQL interface \nClient \nApplication software \nData access API \nServer software \nSQL queries \nResults \nI \nDatabase Server \nDatabase management system \nDatabase \n• \nTo store and manage the databases of the client/server system, each server requires \na database management systeni (DBMS) like MySQL. \n• \nThe processing that's done by the DBMS is typically referred to as back-end \nprocessing, and the database server is referred to as the back end. \nClient software \n• \nThe application software does the work that the user wants to do. This type of \nsoftware can be purchased or developed. \n• \nThe data access API (application programming interface) provides the interface \nbetween the application program and the DBMS. For example, for Java applica-\ntions, the most common data access API for MySQL is JDBC (Java Database \nConnectivity). \n• \nThe processing that's done by the client software is typically referred to as \nfront-end processing, and the client is typically referred to as the front end. \nThe SQL interface \n• \nThe application software communicates with the DBMS by sending SQL queries \nthrough the data access API. When the DBMS receives a query, it provides a \nservice like returning the requested data (the query results) to the client. \n• \nSQL stands for Structured Query Language, which is the standard language for \nworking with a relational database. \nClient/server versus file-handling systems \n• \nIn a client/server system, the processing done by an application is typically divided \nbetween the client and the server. \n• \nIn a file-handling system, all of the processing is done on the clients. Although the \nclients may access data that's stored in files on the server, none of the processing is \ndone by the server. As a result, a file-handling system isn't a client/server system. \nThe software components of a client/server system",
          "pages": [
            21,
            22,
            23,
            24,
            25,
            26,
            27
          ],
          "relevance": {
            "score": 0.7,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "examples": {
          "text": "Section 1 \nAn introduction to MySQL \nOther client/server architectures \nIn its simplest form, a client/server system consists of a single database \nserver a.nd one or more clients. Many client/server systems today, though, \ninclude additional servers. For example, figure 1-3 shows two client/server \nsystems that include an additional server between the clients and the database \nserver. \nThe first illustration is for a simple networked system. With this system, only \nthe user interface for an application runs on the client. The rest of the processing \nthat's done by the application is stored in one or more business coniponents on \nthe application server. Then, the client sends requests to the application server \nfor processing. If the request involves accessing data in a database, the applica-\ntion server formulates the appropriate query and passes it on to the database \nserver. The results of th.e query are then sent back to the application server, \nwhich processes the results and sends the appropriate respon.se back to the client. \nSimilar processing is done by a web-based system, as illustrated by the \nsecond example in this figure. In thjs case, though, a web brotvser running on \nthe client is used to send requests to a web application running on a web server \nsomewhere on the Internet. The web application, in turn, can use web services \nto perform some of its processing. Then, the web application or web service can \npass requests for data on to the database server. \nAlthough this figure shot1ld give you an idea of how client/server systems \ncan be configured, you should realize that they can be much more complicated \nthan what's shown here. For example, business components can be distributed \nover any number of application servers, and those components can communicate \nwith databases on any number of database servers. Similarly, the web applica-\ntions and services in a web-based system can be distributed over numerous web \nservers that access numerous database servers. In most cases, though, you don't \nneed to know how a system is configured to use SQL. \nBefore I go on, you should know that client/server systems aren't the only \nsystems that support SQL. For example, traditional mainframe systems and \nnewer thin client systems also use SQL. Unlike client/server systems, though, \nmost of the processing for these types of systems is done by a mainframe or \nanother high-powered machine. The terminals or PCs that are connected to the \nsystem do little or no work.\n\nCl1apter 1 \nAn introduction to relational databases \nA networked system that uses an application server \nClient \nUser interface \nUser request \nSQL queries \n-------► ,_______.--------. \n~ \n◄ \nResponse \nI \n◄ \nApplication Server \nBusiness components \nResults \nI \nDatabase Server \nDBMS \nDatabase \nA simple web-based system \nClient \nWeb browser \nDescription \n◄ \nUser request \nResponse \nInternet \nUser request \nSQL queries \n---------►-- 1---t \n- ------------ .,____ \n◄ \nResponse \n,...,_-1--\\~\n◄---­\nResults \nI \nWeb Server \nWeb applications \nWeb services \nI \nDatabase Server \nDBMS \nDatabase \n• \nIn addition to a database server and clients, a client/server system can include \nadditional servers, such as application servers and web servers. \n• \nApplication servers are typically used to store business comporients that do part \nof the processing of the application. In particular, these components are used to \nprocess database requests from the user interface running on the client. \n• \nWeb servers are typically used to store web applications and web services. Web \napplications are applications that are designed to run on a web server. Web services \nare like business components, except that, like web applications, they are designed \nto run on a web server. \n• \nIn a web-based system, a web browser running on a client sends a request to a web \nserver over the Internet. Then, the web server processes the request and passes any \nrequests for data on to the database server. \n• \nMore complex system architectures can include two or more application servers, \nweb servers, and database servers. \nOther client/server architectures\n\nSection 1 \nAn introduction to MySQL \nAn introduction \nto the relational database model \nIn 1970, Dr. E. F. Codd developed a model for a new type of database called \na relational database. Thjs type of database eliminated some of the problems \nthat were associated with standard files and other database designs. By using the \nrelational model, you can reduce data redundancy, which saves disk storage and \nleads to efficient data retrieval. You can also view and manipulate data in a way \nthat is both intuitive and efficient. Today, relational databases are the de facto \nstandard for database applications. \nHow a table is organized \nThe model for a relational database states that data is stored in one or more \ntables. It also states that each table can be viewed as a two-dimensional matrix \nconsisting of rows and columns. This is illustrated by the relational table in \nIn practice, the rows and columns of a relational database table are often \nreferred to by the more traditional terms, records and.fields. In fact, some \nsoftware packages use one set of terms, some use the other, and some use a \ncombination. In this book, I llSe the terms rows and columns because those are \nthe terms used by MySQL. \nIn general, each table is modeled after a real-world entity such as a vendor \nor an invoice. Then, the columns of the table represent the attributes of the entity \nsuch as name, address, and phone number. And each row of the table represents \none instance of the entity. A value is stored at the intersection of each row and \ncolu1nn, sometimes called a cell. \nIf a table contains one or more columns that uniquely identify each row \nin the table, you can define these columns as the primary key of the table. For \ninstance, the primary key of the Vendors table in this figure is the vendor_id \ncolumn. In this example, the primary key consists of a single column. However, \na primary key can also consist of two or more columns, in which case it's called \na composite primary key. \nIn addition to primary keys, some database management systems let you \ndefine additional keys that uniquely identify each row in a table. If, for example, \nthe vendor_name column in the Vendors table contains unique data, it can be \ndefined as a non-priniary key. In MySQL, this is called a unique key. \nIndexes provide an efficient way of accessing the rows in a table based on \nthe values in one or more columns. Because applications typically access the \nrows in a table by referring to their key values, an index is automatically created \nfor each key you define. However, you can define indexes for other columns as \nwell. If, for example, you frequently need to sort the Vendor rows by zip code, \nyou can set t1p an index for that column. Like a key, an index can include one or \nmore columns.\n\nCl1apter 1 \nAn introduction to relational databases \nThe Vendors table in an Accounts Payable database \nPrimary key \nColumns \nvendor_id \nvendor _name \nvendor _address 1 \nvendor _address2 \nvendor_city r. \n-\n► \nUS Postal Service \nAttn: Supt. Window Services \nPO Box 7005 \nMadison \nNational Inft>rmation Data Ctr \nPOBox96621 \nU®!I \nWashington \nRegister of Copyrights \nLibrary Of Congress \nU©!I \nWashington \nJobtrak \n1990 Westwood Blvd Ste 260 \nUOO!I \nLos Angeles \nNewbrige Book Clubs \n3000 Cindel Drive \num,, \nWashington \nCa&fomia Chamber Of Commerce \n3255 Ramos Cir \nIU!l!I \nSacramento \nTowne Advertiser's Mailing Svcs \nKevin Minder \n3441 W Macarthur Blvd \nSanta Ana \nBFI Industries \nPOBox9369 \nliW!I \nFresno \nPacific Gas & Electric \nBox 52001 \n\"®'' \nSan Franciscc \nRobbins Mobile Lode And Key \n'1669N Fresno \nIM!I \nFresno \nBill Marvin aectric Inc \n4583EHome \nIU9!1 \nFresno \nOty Of Fresno \nPO Box 2069 \nm!t!I \nFresno \n'V \n< \n> \nConcepts \n• \nA relational database consists of tables. Tables consist of rows and columns, which \ncan also be referred to as records and fields. \n• \nA table is typically modeled after a real-world entity, such as an invoice or a \nvendor. \n• \nA colu1nn represents some attribute of the entity, such as the amount of an invoice \nor a vendor's address. \n• \nA row contains a set of values for a single instance of the entity, such as one invoice \nor one vendor. \n• \nThe intersection of a row and a column is so1netimes called a cell. A cell stores a \nsingle value. \n• \nMost tables have a primary key that unjquely identifies each row in the table. The \nprimary key is usually a single column, but it can also consist of two or more \ncolumns. If a primary key uses two or more columns, it's called a composite \npriniary key. \n• \nIn addition to primary keys, some database management systems let you define one \nor more non-primary keys. In MySQL, these keys are called unique keys. Like a \nprimary key, a non-primary key uniquely identifies each row in tl1e table. \n• \nA table can also be defined with one or more indexes. An index provides an \nefficient way to access data from a table based on the values in specific columns. \nAn index is automatically created for a table's primary and non-primary keys. \nHow a database table is organized \n- Rows\n\nSection 1 \nAn introduction to MySQL \nHow tables are related \nThe tables in a database can be related to other tables by values in specific \ncolumns. The two tables shown in figure 1-5 illustrate this concept. Here, each \nrow in the Vendors table is related to one or more rows in the Invoices table. This \nis called a one-to-niany relationship. \nTypically, relationships exist between the primary key in one table and the \nforeign key in another table. The foreign key is simply one or more columns in a \ntable that refer to a primary key in another table. In this figure, for example, the \nvendor_id column is the foreign key in the Invoices table and is used to create \nthe relationship between the Vendors table and the Invoices table. \nAlthough one-to-many relationships are the most common, two tables can \nalso have a one-to-one or many-to-many relationship. If a table has a one-to-one \nrelationship with another table, the data in the two tables could be stored in a \nsingle table. Because of that, one-to-one relationships are used infrequently. \nIn contrast, a many-to-many relationship is usually implemented by using \nan intermediate table that has a one-to-many relationship with the two tables in \nthe many-to-many relationship. In other words, a many-to-many relationship can \nusually be broken down into two one-to-many relationships. \nIf yo11 define a foreign key for a table in MySQL, you can have the foreign \nkey enforce referential integrity. When MySQL enforces referential integrity, \nit makes sure that any changes to the data in the database don't create invalid \nrelationships between tables. For example, if you try to add a row to the Invoices \ntable with a vendor_id value that doesn't exist in the Vendors table, MySQL \nwon't add the row and will display an error. This helps to maintain the integrity \nof the data that's stored in the database.\n\nCl1apter 1 \nAn introduction to relational databases \nThe relationship between the Vendors and Invoices tables in the database \nPrimary key \nl vendorjd \nvendor name \nvendor address 1 \nvendor _address2 \nvendor_dty \"' \n-\n0@11 \nOffice Depot \nFile No 81901 \nLos Angeles \nPoftstar \n4697 W Jacquelyn A-ve \n1®11 \nFresno \nPostmaster \nPostage Due Technician \n1900 E Street \nFresno \nRoadway Package System, Inc \nDept la 21095 \n0©11 \nPasadena \nState of California \nEmployment Development Dept PO Box 826276 \nSacramento \nSuburban Propane \n2874 S Cherry Ave \nH@il \nFresno \nUnocal \nP.O. Box 860070 \nHPHI \nPasadena \nYesmed, Inc \nPO Box 2061 \nHW!I \nFresno \nData forms NI est \n1617W. Shaw Avenue \nSuite F \nFresno \nZylka Design \n3'167 W Shaw Ave :.103 \nHW!I \nFresno \nUnited Parcel Service \nP.O. Box 505820 \nIIL9!1 \nReno \n-\nFederal Express Corporation \nP.O. Box 1140 \nDept A \nMemphis \n\\; \n• \n< \n> \ninvoicejd \nvendor_ld \ninvoice_number \ninvoice_date \ninvoice_ total \npayment_total \ncredit_total \ntermsjd \n~-\n2018-06-10 \n40.75 \n40.75 \no.oo \nl 56 \n2018-06-11 \n2433.00 \n2433.00 \n0.00 \n7SC-90227 \n2018-06-11 \n1367.50 \n1367.50 \n0.00 \n2018-06· 11 \n53.25 \n53.25 \n0.00 \n--\n4-314-3057 \n2018-06-11 \n13.75 \n13.75 \no.oo \nJJ \n. \n989319~7 \n2018-06-12 \n2312.20 \n2312.20 \n0.00 \nI~: \n2494'6731 \n2018-06-15 \n25.67 \n25.67 \n0.00 \n. \n2018-06-15 \n26.75 \n26.75 \no.oo \n• \n989319-427 \n2018-06-16 \n2115.81 \n2115.81 \n0.00 \n. \n. \n2018--06-17 \n23.50 \n23.50 \n0.00 \nI - , \n. \n< \nForeign key \nConcepts \n• \nThe vendor_id column in the Invoices table is called aforeign key because it \nidentifies a related row in the Vendors table. A table may contain one or more \nforeign keys. \n• \nWhen you define a foreign key for a table in MySQL, you can have that foreign key \nenforce referential integrity. Then, MySQL makes sure that any changes to the data \nin the database don't create invalid relationships between tables. \n• \nThe most common type of relationship is a one-to-many relationship as illustrated \nby the Vendors and Invoices tables. A table can also have a one-to-one relationship \nor a many-to-many relation,ship with another table. \nHow tables are related \n> \nI \" \n• \n---\nV\n\nSection 1 \nAn introduction to MySQL \nHow columns are defined \nWhen you define a column in a table, you assign properties to it as indicated \nby the design of the Invoices table in figure 1-6. The most critical property for \na column is its data type, which determines the type of information that can be \nstored in the column. With MySQL, you can choose from the data types listed in \nthis figure as well as several other data types that are described in chapter 8. As \nyou define each column in a table, you generally try to assign the data type that \nminimizes the use of disk storage because that improves the performance of the \nqueries later. \nIn addition to a data type, you must identify whether the column can store a \nnull value (or just null). A null represents a value that's unknown, unavailable, \nor not applicable. In this figure, th.e columns that have the NN (not null) box \nchecked don't allow null values. If you don't allow null values for a column, you \nmust provide a value for that column when you store a new row in the table. \nYou can also assign a default value to each column. Then, that value is \nassigned to the column if another value isn't provided. As you can see, three of \nthe columns of the Invoices table have a default value. You '11 learn more about \nhow to work with null and defa1tlt values later in this book. \nEach table can also contain a numeric column whose value is generated \nautomatically by the DBMS. In MySQL, a column like this is called an auto \nincremen.t column. You'll learn more about defining auto increment columns \nin chapter 11. For now, just note that the primary key of both the Vendors and \nInvoices tables-vendor_id and invoice _id-are auto increment columns.\n\nThe columns of the Invoices table \nColumn Name \nDatatype \nPK \nNIii \ninvoice_id \n[N'T{ll) \nvendor_id \nIN'T{ll) \n□ 0 \ninvoice_number \nVARCHAR{SO) \n□ 0 \ninvoice_date \nDATE \n□ 121 \nlnvoice_toti.i \nD ECIMAL(9,2) \n□ 121 \npayment_total \nDECIMAL{9,2) \n□ 0 \ncredjt_toti.i \nDECIMAL(9,2) \n□ 121 \nterms Id \nINT(ll) \n□ 0 \ninvoice_due_dare \nDATE \n□ 121 \npayment_dat e \nDATE \n□ □ \n□ □ \nColumn Name: \nO,arset/CoDation: \nComments: \nCommon MySQL data types \nType \nDescription \nCl1apter 1 \nAn introduction to relational databases \nUQ \nB \nUN \nZf \nAI \n□ □ □ □ 0 \n□ □ □ □ □ \n□ □ □ □ □ \n□ □ □ □ □ \n□ □ □ □ □ \n□ □ □ □ □ \n□ □ □ □ □ \n□ □ □ □ □ \n□ □ □ □ □ \n□ □ □ □ □ \n□ □ □ □ □ \nData Type: \nDefault: \nStorage: \nV-rb.Jal \nPrrnary Key \nBrlary \nG \n□ \n□ \n□ \n□ \n□ \n□ \n□ \n□ \n□ \n□ \n□ \nDefaultJExpression \n·o.oo· \n'0.00' \nNULL \nStored \nNotNul \nUnsigned \nUnique \nZero Al \nAuto Increment \nGenerated \nCHAR, VARCHAR \nINT, DECIMAL \nFLOAT \nA string of letters, symbols, and numbers. \nDATE \nDescription \nInteger and deci111al numbers that contain an exact value. \nFloating-point numbers that contain an approximate value. \nDates and times. \n• \nThe data type that's assigned to a column determines the type of information that \ncan be stored in the column. \n• \nEach column definition also indicates whether or not it can contain null values. A \nnull value indicates that the value of the column is unknown. \n• \nA column can also be defined with a def a ult value. Then, that value is used if \nanother value isn't provided when a row is added to the table. \n• \nA column can also be defined as an auto increment column. An auto increment \ncolumn is a numeric column whose value is generated automatically when a row is \nadded to the table. \nHow columns are defined",
          "pages": [
            28,
            29,
            30,
            31,
            32,
            33,
            34,
            35
          ],
          "relevance": {
            "score": 0.7,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "commonMistakes": {
          "text": "Section 1 \nAn introduction to MySQL \nHow to read a database diagram \nWhen working with relational databases, you can use an entity-relationship \n(ER) diagrani to show how the tables in a database are defined and related. Or, \nyou can use a newer version of an ER diagram known as an enhanced \nentity-relationship (EER) diagram. In figure 1-7, for example, you can see an \nEER diagram for the AP (Accounts Payable) database that's used throughout this \nbook. This diagram shows that the database contains five related tables: Vendors, \nTerms, Invoices, Invoice_Line_Items, and General_Ledger_Accounts. \nFor each table, this diagran1 shows how the columns are defined. For \nexample, it shows that the Vendors table has 12 columns. It shows the name \nand data type for each column. It uses a key icon to show that the primary key \nfor this table is the vendor id column. And it uses a dark diamond icon to show \nthat the table has two columns that are foreign keys: default_terms_id and \ndefault account number. \n-\nThis diagram also shows how the tables are related. To do that, it places a \nconnector symbol between the tables. For example, the connector between the \nVendors and Invoices table shows that these tables have a one-to-many relation-\nship. On this connector, the symbol closest to the Invoices table indicates that \nmany invoices can exist for each vendor, and the symbol closest to the Vendors \ntable shows that only one vendor can exist for each invoice. If you study the \nprimary and foreign keys for these tables, you can deduce that these tables are \ndesigned to be joined on the vendor_id column that's in both tables. \nSimilarly, this diagram shows that there's a one-to-many relationship \nbetween the Terms and Vendors table. In other words, each terms of payment \ncan have many vendors, but each vendor can only have one default ter1ns of \npayment. If you study the primary and foreign keys for these tables, you can \ndeduce that these tables are designed to be joined on the terms_id column of the \nTerms table and the default terms id column of the Vendors table. \n-\nMost of the tables in this diagram begin with a single column that defines \nthe primary key for the table. However, the Invoice_Line_ltems table begins with \ntwo columns (invoice_id and invoice_sequence) that define the primary key for \nthis table. In other words, since the invoice_id column doesn't uniquely identify \nthe line item, the primary key must include the invoice_sequence column so it \ncan uniquely identify each row. \nIn chapter 10, you'll learn how to use MySQL Workbench to create and \nwork with EER diagrams. For now, you just need to understand how to read the \ndiagram presented in this figure so you can understand the relationships between \nthe tables in the AP database.\n\nCl1apter 1 \nAn introduction to relational databases \nAn EER diagram for the AP (Accounts Payable) database \n:J vendoes \nveidorjd INT \nveidor_nane VARQ-IAA(SO) \nvaidor_addressl VARCHAR{SO) \nveidor_address2 VARCHAR(SO) \nve,dor_city VARQ-INl(SO) \nveidor_state Q-IAA(2) \nveidor_zip_code VAACHAR(20) \nveidor_phone VAACHAR(SO) \nveidor_contactjast_name V M CHAR(SO) \nveidor_contact_first_nan e VARQ-IM (SO) \ndefault_termsjd INT \ndefaul t_crcount_number INT \nf \nI \nI f \n~ general_ledger_acoounts • \naccou,t_number INT \naccouit_descriptia, V AACHAR( SO) \nT \nI \nI \nI \n► \n► \n• • \n-\n--I \nI \nI \n--\nt+---, \nI \nI \nI \nI \nI --\nt __________ _ \nDescription \n':J WI\\IS \nrermsjd INT \n• \nl \nrerms_des:ription VARQ-IM (SO} \nrerm s_due_days INT \n► \n:] irwoices \ni nwi ce Jd INT \nvmdorJd INT \nirwoice_number VARCHAR(SO) \ninvoice_date DATE \ni nwi ce _ lotal DECIMAL(9 ,2) \npa~ e, t_total DECIMAL{9,2) \ncredrt_total DEOMAL(9,2) \nterm s _id INT \ninwice_due_date DATE \npa~ent_date DATE \n► \n: \n. -\n1ft . -\n::] irwoiceJine_ Jb.J:.s \ninwi ce jd INT \ninwice_!equence INT \nacmu,t_number INT \nlinejlem_amount DECIMAL{9,2} \nhnejtem_desaipton VARCHAR(lOO) \n► \n• \nAn entity-relationship (ER) diagram or enhanced entity-relationship (EER) \ndiagram can be used to show how the tables in a database are defmed and related. \nHow to read a database diagram\n\nSection 1 \nAn introduction to MySQL \nAn introduction to SQL \nand SQL-based systems \nIn the topics that follow, you '11 learn how SQL and SQL-based database \nmanagement systems evolved. In addition, you'll lea111 how some of the most \npopular SQL-based systems compare. \nA brief history of SQL \nPrior to the release of the frrst relational database management system, each \ndatabase had a unique physical structure and a unique programming language \nthat the programmer had to understand. That all changed with the advent of SQL \nand the relational database management system. \nDr. E. F. Codd published an article that described the relational database model \nhe had been working on with a research team at IBM. Then, in 1979, Relational \nSoftware, Inc. released the first relational database management system, \ncalled Oracle. This RDBMS ran on a minicomputer and used SQL as its query \nlanguage. This product was widely successful, and the company later changed its \nname to Oracle to reflect that success. \nIn 1982, IBM released its first commercial SQL-based RDBMS, called \nSQUDS (SQUData S)1stem). This was followed in 1985 by DB2 (Database 2). \nBoth systems ran only on IBM mainframe computers. Later, DB2 was ported to \nother operating systems, including Unix and Windows. Today, it continues to be \nIBM's premier database system. \nDuring the 1980s, other SQL-based database syste1ns, including SQL \nServer, were developed. Although each of these systems used SQL as its query \nlanguage, each implementation was unique. That began to change in 1989, \nwhen the American National Standards Institute (ANSI) published its first set \nof standards for a database query language. As each database manufacturer \nhas attempted to co1nply with these standards, their implementations of SQL \nhave become more similar. However, each still has its own dialect of SQL that \nincludes additions, or exte11sions, to the standards. \nAlthough you should be aware of the SQL standards, they will have little \neffect on your job as a MySQL programmer. The main benefit of the standards \nis that the basic SQL statements are the same in each dialect. As a result, once \nyou've learned one dialect, it's relatively easy to learn another. On the other \nhand, porting applications that use SQL from one type of database to another \noften requires substantial changes. \n1995 saw the first release of MySQL, which was used internally by the \ncompany that developed it, MySQL AB. In 2000, MySQL became an \nopen-source database. Since then, MySQL has become one of the most popular \ndatabases, especially for web applications. In 2008, MySQL was acquired by \nSun Microsystems, and in 2010, Oracle acquired Sun.\n\nCl1apter 1 \nAn introduction to relational databases \nImportant events in the history of SQL \nVear \nEvent \nDr. E. F. Codd deveJoped the relational database model. \nRelational Software, Inc. (later renamed Oracle) released the fii-st relatio11al DBMS, Oracle. \nIBM released their first relational database system, SQL/DS (SQL/Data System). \nIBM released DB2 (Database 2). \nMicrosoft released SQL Server. \nThe American National Standards Institute (ANSI) published the first set of standards for a \ndatabase query language, called ANSI/ISO SQL-89, or SQLI. \nANSI published revised standards (ANSI/ISO SQL-92, or SQL2) that were more stringent \nthan SQLl arid incorporated many new features. These standards introduced levels of \ncompliance, or levels of conforn1ance, that indicated the extent to which a dialect met the \nstandards. \nMySQL AB released MySQL for internal use. \nANSI published SQL3 (ANSI/ISO SQL: 1999). These standards incorporated new features, \nincluding suppo1t for objects. Levels of compliance were dropped and were replaced by a \ncore specification that defined the essential elements for compliance. plus nine packages. \nEach package is designed to serve a specific market niche. \nMySQL became an open-source database. \nANSI pubJished SQlA (ANSI/ISO SQL:2003). These stan.dards introduced XML-related \nfeatures, standardized sequences, and identity columns. \nANSI published SQL:2006, which defined bow SQL can be used with XML. These \nstandards also allowed applications to integrate XQuery into their SQL code. \nSun Microsystems acquired MySQL. \nANSI published SQL:2008. These standards introduced INSTEAD OF triggers and the \nTRUNCATE statement. \nOracle acquired Sun Microsystems and MySQL. Soon after the acquisitio11, many of the \noriginal developers of MySQL left and begin working on a fork of the open-source code \nnamed MariaDB. \nANSI published SQL:2016, which includes support for regt1lar expressions and JavaScript \nObject Notation (JSON). \nDescription \n• \nAlthough SQL is a standard langt1age, each vendor has its own SQL dialect, or \nvariant, that may include extensions to the standards. \nHow knowing ''standard SQL'' helps you \n• \nThe most basic SQL statements are the same for all SQL dialects. \n• \nOnce you have learned one SQL dialect, you can easily learn other dialects. \nHow knowing ''standard SQL'' does not help you \n• \nAny non-trivial application will require modification when moved from one SQL \ndatabase to another. \nA brief history of SQL",
          "pages": [
            36,
            37,
            38,
            39
          ],
          "relevance": {
            "score": 0.7,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        }
      },
      "educational_notes": {
        "definition": "A relational database is a collection of related tables that store data in rows and columns. It uses SQL (Structured Query Language) to manage and manipulate this data.",
        "explanation": "Relational databases are essential for organizing and retrieving information efficiently. They solve the problem of managing large amounts of data by breaking it into smaller, manageable pieces called tables. Each table has a unique structure with specific columns and rows. SQL is used to interact with these tables, allowing you to query, insert, update, and delete data. Understanding relational databases is crucial for anyone working with data in a structured format.",
        "key_points": [
          "Key point 1: Tables store data in rows and columns",
          "Key point 2: SQL is used to interact with the database",
          "Key point 3: Common operations include SELECT, INSERT, UPDATE, DELETE",
          "Key point 4: Normalization ensures data integrity and reduces redundancy",
          "Key point 5: Relationships between tables allow for complex queries"
        ],
        "examples": [
          {
            "title": "Basic Usage",
            "code": "-- SELECT all columns FROM a TABLE SELECT * FROM employees;",
            "explanation": "This example demonstrates how to retrieve all data from an 'employees' table. The asterisk (*) is a wildcard that selects all columns.",
            "validation_note": "SQL auto-fixed: "
          },
          {
            "title": "Practical Example",
            "code": "-- Retrieve specific information based on a condition\nSELECT name, salary FROM employees WHERE department = 'Sales';",
            "explanation": "This practical example shows how to query the 'employees' table for names and salaries of those in the Sales department."
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Forgetting to specify a column name or using an asterisk without context",
            "incorrect_code": "-- Incorrect usage\nSELECT FROM employees;",
            "correct_code": "-- Correct usage\nSELECT * FROM employees;",
            "explanation": "Always specify the columns you need. Using an asterisk is fine if you want all columns, but it's better to be specific for clarity and performance."
          }
        ],
        "practice": {
          "question": "Create a table named 'students' with columns for id (integer), name (varchar), and age (integer). Insert two students into the table. Then, write a query to retrieve all student names.",
          "solution": "-- Create the table\nCREATE TABLE students (\n  id INT PRIMARY KEY,\n  name VARCHAR(100),\n  age INT\n);\n-- Insert data\nINSERT INTO students (id, name, age) VALUES (1, 'Alice', 20);\nINSERT INTO students (id, name, age) VALUES (2, 'Bob', 22);\n-- Query for names\nSELECT name FROM students;"
        }
      },
      "llm_enhanced": true,
      "raw_text_preview": "An introduction to MySQL \nBefore you begin to learn how to write SQL statements that work with \nMySQL, you need to understand some concepts and terms related to SQL \nand relational databases. That's w",
      "content_relevance": {
        "score": 0.6,
        "sql_score": 1.0,
        "concept_score": 1.0,
        "non_sql_penalty": 0.2,
        "is_relevant": true,
        "analysis": "SQL content"
      }
    },
    "select-statement-murach": {
      "id": "select-statement-murach",
      "title": "SELECT Statement",
      "definition": "Retrieving data from a single table with column selection and aliases",
      "difficulty": "beginner",
      "page_references": [
        73,
        74,
        75,
        76,
        77,
        78,
        79,
        80,
        81,
        82,
        83,
        84,
        85,
        86,
        87,
        88,
        89,
        90,
        91,
        92,
        93,
        94,
        95,
        96,
        97,
        98,
        99,
        100
      ],
      "sections": {
        "definition": {
          "text": "Cliapter 2 \nHow to use MySQL Workbench and other develop,nent tools \nThe column definitions for the Vendors table \n8 MySQL Workbench \nLocal insmnce MySQLSO X \nFile \nEdit \nVif!!N \nQuery \nDatabase \nSenter \nTools \nScnptmo \nHelp \nQue,y1 \nSCHEMAS \nTable Name: lvendc.-s \nJ Sdtema: ap \nq, I \nRI~ ob)ects \nT .J ap \nOwset/Colation: \nutfBni>'l \nv j utf8mb'1_0900_ v \nEngine: \nlmo06 \nT'cl Tables \n► \ngeneral_ledger_accounts \n► \nfnvo1ce_archlve \n► \nmvoice_lme_iteJT'6 \n► \nInvokes \n► \nte_rms \n► II vendor_contacts \nT \nvendors \n►[;:) Co lumns \n► \nInd!!RS \n► ~ \nFore:ion Keys \n► \nTriggers \nViews \nstorNI Procedures \n'i!5J Functions \n► \nex \n► \nom \n► \nsys \nAdministration ~as \n• for, \nuo \nTable: vendors \nColumns: \nlnt(ll) \nAIPK \nvardia \nva<cha \nvarcha \nvar cha \nchar(2: \nComments: \nCoumName \nvendor_id \nvendor_name \nJ vendor _addressl \n; vie_ndor _address2 \nvendor_dty \nvendor_sta2 \nvendor_zip_codt \nvendor_phone \nvendor_contact_last_name \nvie_ndor _contact_firsLname \n~ ddault_terms_id \n~ ddauft_account_number \n< \nColum Name.: \nCharset/Cola6on: \nComments: \nDatatype \nINT(U) \nVARCHAA(SO} \nVAACHAA(SO) \nVARCHAA(SO) \nVAACHAA(SO} \nCHAR{2) \nVARCHAA(20) \nVARCHAA(SO) \nVARCHAR(SO) \nVARCHAA(SO} \n!Nl{l 1) \n!Nl{U) \nPK \nl'-N \nUQ \nB \n~ lF \n0 D D D D \nD \nE2l \nE2I D D D \nD D D D D D \n□ D □ D D □ \n□ E2I \n□ □ □ □ \n□ E2I \n□ □ D □ \n□ 0 \n□ D D □ \n□ D D D D □ \nD D □ □ D □ \n□ D D □ D □ \n□ E2I \n□ □ D □ \n□ E2I \n□ D D □ \nData Type: \nDefalJt: \nStarage: \nVirtual \nPrimary Key \nBnarv \nAutolncr~t \nvendor id \nvendor_naml! \nveocb _address! \nvendor _address2 \nvendc<_oty \nvendor _state \nvendor _zlp_code \nvendor _phone \nVatchll \nvarcha \nColu111ns \nIndexes \nForeign Keys \nTrfggers \nPartitioning \nOptions \nvarcha v \nAl \nE2l \nD \nD \nD \nD \nD \nD \n□ \nD \nD \nD \nD \n□ \nV \n.. \nG \nOefault,bilresslon \nD \nD \nD \nD \nD \n□ \n□ \nD \nD \nD \nD \nD \nSto,-ed \nNULL \nNULL \nNULL \nNULL \nNULL \nNotl'd \nUrtqie \nu~ \naroMlf \n> \nven<!or _contact_l!9!l'l_name \nObject Info \nSession \nApply \nRevert \nDescription \n• \nTo view the column definitions for a table, right-click the table name in the \nNavigator window and select the Alter Table command. Then, select the Columns \ntab at the bottom of the window that's displayed to view the column definitions for \nthe table. \n• \nTo edit the column definitions for a table, view the column definitions. Then, you \ncan t1se the resulting window to add new columns and modify and delete existing \ncolumns. \n• \nFor more information about creating and modifying tables, see chapter 11. \nHow to view and edit the column definitions \nX \nV\n\nSection 1 \nAn introduction to MySQL \nHow to use MySQL Workbench \nto run SQL staten,ents \nBesides letting you review the design of a database, MySQL Workbench is a \ngreat tool for entering and running SQL statements. \nHow to enter and execute a SQL statement \nWhen you first connect to a MySQL server in MySQL Workbench, a SQL \nEditor tab is automatically opened. Figure 2-7 shows how to use the SQL editor \nto enter and execute a SQL statement. The easiest way to open a SQL Editor tab \nis to click the Create New SQL Tab button in the SQL Editor toolbar or p1·ess the \nCtrl+ T keys. \nOnce you open a SQL tab, you can use standard techniques to enter or edit a \nSQL statement. As you enter statements, you'll notice that MySQL Workbench \nautomatically applies colors to various elements. For example, it displays \nkeywords in blue. This makes your state1nents easier to read and understand and \ncan help you identify coding en·ors. \nTo execute a single SQL statement like the one in this figure, you can press \nCtrl+Enter or click the Execute Current Statement button in the SQL Editor \ntoolbar. If the statement returns data, that data is displayed below the SQL editor \nin a corresponding Result grid. In this figure, for example, the result set returned \nby the SELECT statement is displayed. If necessary, you can adjust the height \nof the Result grid by dragging the bar that separates the SQL Editor tab from the \nResult grid. \nBefore you execute a SQL statement, make sure you've selected a database \nby double-clicking the database in the Navigator window. Otherwise, you'll get \nan error message like this: \nError Code: 1046. No database selected \nSimilarly, if you haven't selected the co1Tect database, you'll get an error \nmessage that says the table doesn't exist. For exan1ple, if the EX database is \nselected when you attempt to retrieve data from the Vendors table, you' 11 get an \nerror message like this: \nError Code: 1146. Table •ex.vendors' doesn't exist \nTo fix this, you can double-click the AP database to select it.\n\nCliapter 2 \nHow to use MySQL Workbench and other develop,nent tools \nA SELECT statement and its results \nCreate New \nSQL Tab button \n11 M \norkbench \n/ wcat tns:tance MySQL.80 X \nExecute Current \nStatement button \nFile 1 -1 V!e'N \nQuery \nDatabase \nSaver \nT oals \nSc · · no \nHelp \nQuery 1 \nX \nSQL \neditor \nSCHEMAS \n~ I \nFil~ ob]l!CIS \n,, J ap \nu .,,. \nl\"'\"'I \nUmil to 100(hows \n• I 1-9 I ~ Q. l1l ~ \n• \nTables \n► Ell 9enual_led9l!l'_accounts \n► iJ invoice_archlve \n► El lnvoice_ll~_,t,ms \n► ii Invoices \n► \nterms \n► el ve.ndor_contacts \n\" El vendors \n► t-1 Columns \n► \nIndexes \n► \nForeigo Keys \n►~Triggers \nVi~ \n'al Stored Procedures \n!?Ii Funrtlnn~ \nAdml11istrallon Sch~as \nll'form.won \nTable: vendors \nColumns: \nvernlor ld \nvendor_name \nvendor _addressl \nvendor _address2 \nvt'fldor -dty \nvendor _state \n... \nlnl{I I) \nAlPK \nvard,a \nvarcha \nvarc:ha \nvarcha \ndiar(2 \"' \nl • \nSELECT vendor_naee, vendor_city, vendor_state \nFR0'-1 vendors \nORDER 8Y ve ndor_nam~ \n< \nvendor_name \n► \nAbbev 0~ F\\lnlsmgs \nAmencan Booksde's Assoc \nAmerican Elqlress \nASC~ \nAscom Hasler Maino Systems \nAT&T \nAztekl.cbel \nBaker & Taylor Books \nBertelsmam indus1Jy Svcs. Inc \n6fl tndUstrles \nBil Jon6 \nBil Marvn Electnc Inc \nBlanchartf & Johnson Associates \nBkietross \nBlue Shield of California \nBouche,- Cwmncabons Inc \nearners Pub\\shino ~v \nCal State Termite \nvendor_dty \nFresno \nTarrytown \nvendor _state \nCA \nNY \nLos Angdes \nCA \nFresno \nSheltot'I \nPhoenix \nAnahesn \nOwtotte \nValenoa \nFresno \nCA \nCT \nA1. \nCA \nNC \nCA \nCA \nSacrament!> \nCA \nFresno \nCA \nMssion Viejo \nCA \n())cnard \nCA \nMahe.Tl \nCA \nFortWashi... PA \nTuel.ala! \nm \nSelma \nCA \nFresno \nCA \nResult \ngrid \nD \nX \n□ \n... \n\"' \nFeld \nTvi-\n> \nObJect Info \nSession \nCalifumia Business Machines \nvendors 1 >< \n0 ReadOnly \nDescription \n• \nTo open a new SQL tab, press Ctrl+T or click the Create New SQL Tab button ( \n) \nin the SQL Editor toolbar. \n• \nTo select the current database, double-click it in the Schemas tab of the Navigator \nwindow. This displays the selected database in bold. \n• \nTo enter a SQL statement, type it into the SQL editor. \n• \nAs you enter the text for a statement, the SQL editor applies color to various \nelements, such as SQL keywords, to make them easy to identify. \n• \nTo execute a SQL statement, press Ctrl+Enter or click the Execute Current \nStatement button ({if) in the SQL Editor toolbar. If the statement retrieves data, the \ndata is displayed in a Result grid below the SQL tab. \nHow to enter and execute a SOL statement\n\nSection 1 \nAn introduction to MySQL \nHow to use snippets \nYou can think of the srzippets that come with MySQL Workbench as a \nlibrary of SQL syntax. This library is divided into statements that you can use \nto manage a database, define objects in a database, and manipulate the data in \na database. You can also create your own snippets that provide custom code. \nIn fact, you're more likely to create your own snippets than you are to use \nthe built-in snippets. That's because the syntax that's provided for the bt1ilt-in \nsnippets is much more complex than what you typically need. \nisn't displayed, you can display it by clicking on the rightmost button at the 1ight \nside of the SQL Editor tab. Then, you can display the snippets tab and use the \ndrop-down list at the top of the tab to select a category of snippets. In this figUI·e, \nfor example, the My Snippets category is displayed. From here, you can select a \nsnippet and then click the Insert Snippet button to enter the snippet into the SQL \nEditor tab. Finally, you can edit the snippet code so it's appropriate for your SQL \nstatement. \nIn this figure, the snippet contains code that I wrote for joining the vendors, \ninvoices, and invoice_line_items tables. To create this snippet, I entered it into \na SQL Editor tab and then clicked the Add New Snippet button. By saving this \nstatement as a snippet, I can now use it anytime I want to join these tru·ee tables \ninstead of having to type it each time. \nFor now, don't wo1Ty if you don't understand the SQL statement p1·esented \nin this figure. The main point is that you can use the Snippets tab to save and \nretrieve a variety of SQL code. As you learn more about SQL statements, you'll \nsee how useful this can be.\n\nCliapter 2 \nHow to use MySQL Workbench and other develop,nent tools \nThe SQL Additions tab with a snippet created by a user \n■ \nMysQL Workbench \nA \nLocal instance MySQLSO x \nFile \nEdit \nView \nQuery \nDatabase \nServer \nTools \nScnptmg \nHelp \nq_ 11,ter objects \n• @ ap \n►~Tables \nV,ev.-s \n'5l Stored Procedures \n'al Functions \n► \nex \n► \nom \n► \nsys \nDescription \nSQl ~dd1i:Jons \nQ Q I f' W ~ I~ I \nlmlto 1000rows \n• I ..(> I My~s \n1 ♦ \nSELECT a \nfRCf'I vendor-s v \nJOIII invoices i \nOIi v. vendor id % i. vendor id \n-\nJOill invoice_line_iteflls li \nOH i. invoice id = li. invoice id \n-\nX \n• \nThe SQL Additions window contains context help and snippets. Snippets contain \nthe syntax for many common SQL statements. You can use the snippets to guide \nyou as you create a SQL statement. You can also create your own snippets and save \nthem for later use. \n• \nThe SQL Additions window is displayed to the right of the SQL Editor tab by \ndefault. If this window isn't displayed, you can display it by clicking the rightmost \nbutton (□) at the right side of the SQL Editor toolbar. Then, you can click the \nSnippets tab to display the available snippets. \n• \nThe snippets are organized into categories. To display any category of snippets, \nselect the category from the drop-down list at the top of the Snippets tab. \n• \nTo enter a snippet into a SQL editor, select the snippet and then click the Insert \nSnippet button (~\nat the top of the Snippets tab. Then, edit the snippet code so it's \nappropriate for your SQL statement. \n• \nTo replace code in the SQL editor with a snippet, select the code, select the snippet \nyou want to replace it with, and then click the Replace Current Text button ( ~ ). \n• \nTo create your own snippet, enter the code for the snippet into a SQL editor tab. \nThen, select the category where you want to save the snippet, click the Save \nSnippet button ( 1-¢) in the SQL Editor toolbar, and enter a name for the snippet. \n• \nTo delete a snippet, right-click it in the Snippets tab and select the Delete Snippet \nitem. \nHow to use the Snippets tab\n\nSection 1 \nAn introduction to MySQL \nHow to handle syntax errors \nIf an error occurs during the execution of a SQL statement, MySQL \nWorkbench displays a message that includes the error numbe1· and a brief \ndescription of the error. In figure 2-9, for example, the message displays an error \nnumber of 1146 and a brief description that says ''Table ap.vendor doesn't exist.\" \nIn this example, the problem is that the Vendor table doesn't exist in the \ndatabase. To fix the problem, you need to edit the SQL statement so the table is \nVendors instead of Vendor. Then, you should be able to successfully run the SQL \nstatement. \nThis figure also lists some other common causes of errors. As you can see, \nmost e1Tors are caused by incorrect syntax. However, it's also common to get an \nerror if you have selected the wrong database. If, for example, you have selected \nthe EX database and you try to run a statement that refers to tables in the AP \ndatabase, you will get an error. Regardless of what's causing the problem, you \ncan usually identify and correct the problem without much trouble. In some \ncases, though, it may be diffict1lt to figure out the cause of an error. Then, you \ncan usually get more information about the error by searching the Internet or by \nsearching the MySQL Reference Manual as described later in this chapter.",
          "pages": [
            73,
            74,
            75,
            76,
            77,
            78
          ],
          "relevance": {
            "score": 0.7,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "examples": {
          "text": "Cliapter 2 \nHow to use MySQL Workbench and other develop,nent tools \nHow to handle syntax errors \niJ MySQL Workbench \nD \nX \n4i-\nLocal inslance MySOl.80 X \nFile \n&lit v,_ 0uef)' \nOatabas-e \nServer \nTools \nScnpb119 \nHelp \niil'Hi1 _________________________ _ \nSCKEMAS \nc;i Q I ~ lll' fl \nI~ I \nQ I Lmit to 1000rows \n• I \nq_ [niter obJeds \ny § ap \n1 • \nSE~ECT vendor_name, vendor_city, vendor_shrte \nFR0'1 vendor \nT \nTables \nORDER BV vendor _nam~ \n► II Qeneral_ledger_accounts \n► II lnvolce_archlve \n► II lnvolce:_line:_ltems \n► \nInvoices \n► II terms \n► 8 ve:ndor_contacls \n► \nvendors \nViews \n'rJl Stored Procedures \ni;ai Funcbons \n► \nex \n► \nom \n► \nsys \nAdministration \nSchemas \nTable: vendors \nColumns: \nvendor id \nvendor_name \nvendor llddress l \nvendor -address2 \nvendof =dty \nvendor _state \nObJe:ct Info \nSession \n< \n014)1 \n,. \n[jl .Action Outpt.d \nIt \nrrM \n.1,aion \nMltSH9\" \nOurmon I Fttcl\\ \nll'lt,U) \nO \n1 12.19:45 SELECT vendor_name. vendor_cty. vend«_slal... &rorCode: 1146 Table 'ap.vendor' doesn\\ eiosl \n0.000 sec \nAJPK \nvarcha \nv11rd'la \nvarcha \n~archa \nchar(! .., \nCommon causes of errors \n• \nHaving the wrong database selected \n• \nMisspelling the name of a table or column \n• \nMisspelling a keyword \n• \nOmitting the closing quotation mark for a character string \nDescription \n• \nIf an error occurs during the execution of a SQL statement, MySQL Workbench \ndisplays a message in the Output tab that includes an error code and a brief descrip-\ntion of the error. \n• \nMost errors are caused by incorrect syntax and can be corrected without any \nadditional assistance. Otherwise, you can usually get more information about \nan error by searching for the error code or description in the MySQL Reference \nManual or on the Internet. \nHow to handle syntax errors \n>\n\nSection 1 \nAn introduction to MySQL \nHow to open and save SQL scripts \nIn MySQL, a script is a file that contains one or more SQL statements. To \ncreate a script, you enter the state1nents you want it to include into a SQL Editor \ntab. You '11 learn more about that in the next figure. Then, you can click the Save \nbutton or press Ctrl+S to save the script as described in figure 2-10. \nOnce you've saved a script, you can open it later. To do that, you can click \nthe Open SQL Script File button in the SQL Editor toolbar, or you can press \nCtrl+Shift+O. In this figure, the dialog box that's displayed shows the script files \nthat have been saved for chapter 2. These files are created when you download \nand install the source code for this book. Note that the names of these files have \nthe .sql extension. (If you're using Windows 10 and the file extensions aren't \ndisplayed, you can display them by opening the File Explorer, displaying the \nView tab, and selecting the ''File name extensions'' option in the Show/hide \ngroup.) \nOnce you open a script, you can run it as shown in the next figure. You can \nalso t1se it as the basis for a new SQL script. To do that, just modify it any way \nyou want. Then, you can save it as a new script by pressing the Ctrl+Shift+S \nkeys or selecting the File➔ Save Script As command. \nThe screen in this figure shows the tabs for two script files that have been \nopened. After you open two or more scripts, you can switch between them by \nclicking on the appropriate tab. Then, you can cut, copy, and paste code from \none script to another.\n\nCliapter 2 \nHow to use MySQL Workbench and other develop,nent tools \nThe Open SQL Script dialog box \nOpen SQL Script \nFile button \nD \nX \n._....., ms_tance MySQL.80 X \nv~N \nQue,y \nDatabase \nServer \nTools \nScriJ>lino \nHelp \navu;ator \nSOifMAS \nq, I \nF\\ltl!r ob)«ts \n\" J ap \n\" \nTables \n► II 9eneral_led9er_accounts \nI \nQuery 1 \nselect_ ~endor _mb rna!Jon \nI Limll to 1000 rows \nJ • \nSELECT vendor_natie, vcndor_city, vendor_strte \nfRc»1 vendors \nORDER BY vendor name; \n► Ill invoice_archlve \n► EJ lnvolce_llne_ltern, \n► Ii) Invoices \n► II terms \n► Iii vendor _contacts \n► iJ vendors \nVlews \nOpen SQl Scnpt \n~ \nv 't \n« book_scripts > ch02 \nOrganize T \nNew folder \nv \n~ \nSearch chil2 \nX \n.P \n[I 0 \nA \n1!,. Windows (C:) \nExamView \ninetpub \nLogs \nmurach \n\" \nName \nDate modified \nTyp \ntai Stored Procedures \n,:jl Functions \n► \nex \n► \nom \nselect_vendor_city_state.sql \nselect_vendor_inform8tion.sql \nsel«t_ vendor_tot11l_due.sql \n12/19'2014 9:52 AM \n12/29/2014 9:52 AM \nll/29/201.49:52 At,1 \nSQl \n► \nsys \nAdmlnistnllon Scb=as \nlniorrnat ~n \nTable: vendors \nColumns: \nvendor 1d \n< \nCn.'!pUt \n... \no1I Adlon Ouu:,ut \nmysql \nPerflogs \nProgram Files \nProgram Files (x86) \nSWSmp \nV \n( \nFile name: I select_vendor_total_due.sql \nV \nvcndor_namc \nve-m addressl \nvendor -addrcss2 \nvendor: city \nvendor _state \nObJect: Info \nSession \nW'lt{l l) \nAlPK \nvarcha \nvarcha \nvartha \nvard'la \ndw(2 V \nv J \nSQl Files (°.sql) \nOpen \nCancel \n] \nDescription \n• \nA SQL script is a ftle that contains one or more SQL statements. \n• \nTo open a file that contains a SQL script, click the Open SQL Script File button in \nthe SQL Editor toolbar or press the Ctrl+Shift+O keys. Then, use the Open SQL \nScript dialog box to locate and open the SQL script. \n• \nWhen you open a SQL script, MySQL Workbench displays it in its own SQL \nEditor tab. To switch between open scripts, select the appropriate tab. \n• \nTo cut, copy, and paste code from one SQL script to another, use the standard \ntechniques. \n• \nTo save a SQL statement to a script file, click the Save btttton in the SQL Editor \ntoolbar or press Ctrl+S. Then, use the Save SQL Script dialog box to specify a \nlocation and name for the file. \n• \nTo save a script you've modified to a new file, press the Ctrl+Shift+S keys or select \nthe File➔Save Script As command. \nHow to open and save SQL scripts\n\nSection 1 \nAn introduction to MySQL \nHow to enter and execute SQL scripts \nIn the last topic, you saw a SQL script that contained a single SQL state-\nment. However, a SQL sc1ipt typically contains multiple statements. Figure 2-11 \nshows how to enter and execute scripts like that. \nWhen you code multiple SQL statements within a script, you must code a \nsemicolon at the end of each statement. For example, this figure shows a script \nthat contains two SELECT statements. To execute both of these statements, you \ncan press the Ctrl+Shift+Enter keys, or you can click the Execute SQL Script \nbutton in the SQL Editor toolbar. When you do, the results of each script are \ndisplayed in a separate Result g1·id. To switch between Result grids, you can \nclick on the tabs that are displayed below the current Result grid. \nIf you want to execute a single SQL statement that's stored within a script, \nyou can do that by moving the insertion point into the statement and pressing the \nCtrl+Enter keys or clicking the Execute Current Statement button. Then, if the \nstatement retrieves data, the data is displayed in a single Result grid. \nIf you need to, you can also execute two or more statements in a script. To \ndo that, you select the statements and then press the Ctrl+Shift+Enter keys or \nclick the Execute SQL Script button. This is useful if a script contains many \nstatements and you just want to execute some of them.\n\nCliapter 2 \nHow to use MySQL Workbench and other develop,nent tools \nA SQL script and its results \nExecute SOL \nScript button \n■ \nMySQL Workbench \nlocal ins!ance MySQLBO x \nFile \nEdit \n1/,e,, \nQue,y \nDatabffe \nServer \nTools \nNaV19atOC\" \nSCHEMAS \n~ I ~to 1000rows \n• I ~ I \n0.. Llli L!!J \nq_ IAl:rr ~1$ \nT J ap \n1 • \nSELECT vendor_name, vendor_city \nFR<Y-1 vendors \nT \nTables \n► II gcneral_ledger_accounts \n► 6J lnvoice_archlve \n► \ninvoiu_line_items \nl,lfERE vendor_id: \n; \n5 • \nSELECT COUttT(*) AS number_of_invoices, \nSUM(invoice_total - payment_total - credit_total) AS total_due \nFRCJ1 invoices \n► \nInvoice \n► II terms \ni..HERE vendor id= \n; \n► El vendor_contacts \n< \nD \nX \n> \n► C vcndo3 \nVitv,'S \nI Result Grid \nJJ t'\\ F.l.r Row11 ~I---~' f>ll>o<t: Eg I w~ eel c.ontent: IA \n□ \n1211 Stored Procedures \n'al fundions \n► \ne,,. \n► \nom \n► \nsys \nAaminls~on Schemas \nTable: vetdors \nColumns: \nvendor id \nvendor name \nvendor address 1 \nvendor :address2 \nvendor_oty \nvendor _state \nObJect Info \nSession \nDescription \nI \nvendor_~ \nvendcr_oty \n► \nIBM \nSanfraooscx> \nvendors 1 x \nResult 2 \n.Jutp..l \n,., \nC, Action Ou!pul \nnt(Ul \nAIPK \nvarcha \nVill'a>a \nvard,a \nvl!\"tha \nchar(Z: .., \n• \nTun• \nAction \nMHD;i• \n1 12.53.11 SELECT vendor_narne. vendol'_c:iy FROM VEn... 1 row~) retuned \n2 12:53.11 SELECTCOUNTOASrunber_of_lnvoices, \n.. \nlrow(s)rllh.med \n0 Reac!Orly \no.mmn I Foteh \n0.000 sec / 0.000 sec: \n0.000 sec/ OJ)OO sec \n• \nWhen you code a script that contains more than one statement, you must code a \nsemicolon at the end of each statement. \n• \nTo run an entire SQL script, press the Ctrl+Shift+Enter keys or click the Execute \nSQL Script button ('I ) that's located just to the left of the Execute Current \nStatement button in the SQL Editor toolbar. \n• \nWhen you run a SQL script, the results of each statement that returns data are \ndisplayed in a separate Result grid. To switch between these Result grids, you can \nclick on the tabs that are displayed below the current Result grid. \n• \nTo execute one SQL statement within a script, move the insertion point into that \nstatement and press the Ctrl + Enter keys or click the Execute Current Statement \nbutton ( fi). If the statement retrieves data, the data is displayed in a Result grid. \n• \nTo execute two or more statements within a script, select them in the editor and \nthen press the Ctrl+Shift+Enter keys or click the Execute SQL Script button. \nHow to enter and execute SQL scripts\n\nSection 1 \nAn introduction to MySQL \nHow to use the MySQL Reference \nManual \nMySQL database: the MySQL Reference Manual. In most cases, you'll use \na web browser to view this manual directly from the Internet. That way, you \ncan be sure that the information is always up-to-date. However, you can also \ndownload this manual and save it on your hard drive. Either way, you can use \nthe MySQL Reference Manual to quickly look up detailed technical information \nabout the MySQL database, including information about SQL statements and \nfunctions. \nHow to view the manual \nYou can view the MySQL Reference Manual by using a web browser to go \nto the web address shown at the top of this figure. Here, the Reference Manual \nfor version 8.0 of MySQL is displayed. However, you can easily select another \nversion by selecting it from the drop-down list at the right side of the page. \nHow to look up information \nOnce you've navigated to the correct ve1·sion of the MySQL Reference \nManual, it's easy to look up information. To do that, you can use the links in \nthe left sidebar to drill down to the information that you're looking for. When \nyou find the topic you want, you can click it to display it in the main part of the \nwindow. Then, if you want to navigate back up the hierarchy of information, \nyou can use the breadcrumb links ac1·oss the top of the page. In this figure, fo1· \nexample, you can click the ''MySQL 8.0 Reference Manual'' link to return to the \nHorne page for the manual. Or, you can click the ''General Information'' link to \nnavigate to that page. \nAnother easy way to look up information is to search for a specific word or \nphrase. To do that, type the word or phrase in the ''Search this Ma11ual'' text box \nlocated at the top of the sidebar and click the Search icon or press the Enter key. \nThen, you can click the links in the search results to view infor1nation about the \nsearch terms.\n\nCliapter 2 \nHow to use MySQL Workbench and other develop,nent tools \nThe web address for the MySQL 8.0 Reference Manual \nhttps://dev.rrwsgl.com/doc/refman/8.0/en/ \nA web page from the MySQL Reference Manual \nB MySQL MySQL 8.0 'le!erence \n)( \n+ \nD \nC \ni \nhnps dev.mysql.com oc/refman/8.0/en/manual-1nfo.html \n* e \n= \nThe v10rld s most popula Of)\"'JI source database 0. \nContact MySQL I Login I Register \nMyS~ . \nMYSQL.COM \nOOWNLO.-\\DS \nDOCUMENTATION \nDEVELO?ER ZOl~E \nQ. \nA Documentation Home \nMySQL 8.0 Reference Manual \nPreface and Legal Notices \n., General Information \nAbout This Manual \nTypographical and Syntax Convenoons \n> overview of the MY5QL Database \nManagement System \n• What Is New In MySQL 8.0 \n• Server and Status vanables and \nopoons Added, Deprecated, or \nRem011ed jr) MY5QL 8.0 \nDescription \nMySQL 8.0 Reference Manual I General lnformaOOl'I I About Ths Manua \nversion 8.0 \n¥ \n1.1 About This Manual \nThis 1s the Reference Manual for the MySQL Database System, version 8.0, \nthrough release 8.0.15. Differences between minor versions of MySQL 8.0 are \nnoted In the present text with reference to release numbers (8.0. x). For license \n1nformatlon, see the Legal Notices . \nThis manual Is not intended for use with older versions of the MySQL software \ndue to the many functional and other differences between MY5QL 8.0 and \nprevious versions. If you are using an earlier release of the MySQL software, \nplease refer to the appropnate manual. For example, MY5QL 5. 7 Reference \nMonuol covers the S.7 senes of MySQL software releases . \nBecause this manual serves as a reference, It does not provide general \n• \nTo view the MySQL Reference Manual, go to the MySQL website and select the \ncorrect version of the manual. The web address for MySQL 8.0 is shown above. \n• \nTo view a chapter, click the link for the chapter in the table of contents on the right \nside of the page. \n• \nTo return to the Home page for the manual, click the Start icon ( \nthat's displayed at the top of the left sidebar. \nfor the manual \n• \nTo search for a particular word or plu·ase, type the word or phrase in the ''Search \nthis Manual'' text box in the left sidebar and click the Search icon or press the \nEnter key. Then, you can scroll through the results and click links to get more \ninformation. \n• \nYou can also download the MySQL Reference Manual. However, it typically makes \nsense to use it online. \nHow to use the MySQL Reference Manual\n\nSection 1 \nAn introduction to MySQL \nHow to use the MySQL Co111111and Line \nClient \nBefore MySQL Workbench was available, programmers used a \ncommand-line tool known as the MySQL Command Line Client to connect \nto a MySQL server and work with it. This tool is also known as the MySQL \ncommand line. Although you may never need this tool, you shot1ld at least \nbe aware that it exists. This tool comes with MySQL, and it can be useful if \nMySQL Workbench isn't installed on the system that you're using. \nHow to start and stop the MySQL Command Line \nClient \nin Windows. Although this figure shows the Command Prompt window that's \navailable from Windows, you can use the MySQL Command Line Client on \nother operating systems too. In particular, on macOS, you can use the Terminal \nwindow to start the MySQL Command Line Client. \nWhen you use Windows, there's an easy way to start the MySQL Command \nLine Client if you want to log in as the root user for the database server that's \nrunning on the local computer. To do that, you just select the MySQL Command \nLine Client command from the Start menu. Then, MySQL will prompt you for \na password. If you enter the password correctly, you will be logged on to the \ndatabase server as the root user. \nIn some cases, you'll need to use a command line to start the MySQL \nCommand Line Client instead of using the Start menu. For example, you may \nneed to do that if you want to log into a database that's running on a different \ncomputer, if you want to log in as a user other than the root user, or if you 're \nusing another operating system such as macOS. In those cases, you can open \na command line and change the directory to the bin dil·ectory for the MySQL \ninstallation. Then, you can execute the mysql command and supply the param-\neters that are needed to connect to the database server. \nIf the MySQL server is located on a remote computer, you can specify \n-h, followed by the host name of the computer, and -u, followed by a valid \nusername. In addition, you specify -p so MySQL prompts you for a valid \npassword. Although it can take some experimentation to get these connection \nparameters right, you only need to figure this out once. \nOnce you enter a valid password for the specified username, the MySQL \nCommand Line Client displays a welcome message and a command line that \nlooks like this: \nmy sql> \nFrom this prompt, you can enter any statement that works with MySQL. When \nyou're done, you can exit the MySQL Command Line Client by entering ''exit'' \nor ''quit'' followed by a semicolon.\n\nCliapter 2 \nHow to use MySQL Workbench and other develop,nent tools \nThe MySQL Command Line Client displayed by Windows \n■ \nMySQL 8.0 Command Line Client \n□ \nX \nHow to start the MySQL Command Line Client (Windows only) \nStart➔ All Programs ➔ \nMySQL➔ MySQL Server 8.0➔ MySQL 8.0 Command Line Client \nHow to start the MySQL Command Line Client from the command line \nFor Windows \ncd \\ Program Files\\ MySQL\\ MySQL Server 8.0 \\ bin \nmysql -u r oot -p \nFor macOS \ncd / usr/ local/ mysql / bin \n. / mysql -u root -p \nHow the mysql command works \nThe syntax \nmysql -h hostname -u username -p \nExamples \nmysql - u ap_ tester -p \nmysql -h localhost -u root -p \nmysql -h murach. com -u ap_tester -p \nHow to exit from the MySQL Command Line Client \nmysql>exit; \nDescription \n• \nMySQL provides a command-line client program called the MySQL Command \nLine Client that lets you enter SQL statements that work with MySQL databases. \nThis program is also known as the MySQL command line. \n• \nFor Windows, use a Command Prompt window to start the MySQL Command Line Client. \n• \nFor macOS, use a Terminal window to start the MySQL Command Line Client. \n• \nTo stop the MySQL Command Line Client, enter ''exit'' or ''quit'' at the cominand \nline, followed by a semicolon. \n• \nMySQL 8.0 also includes a Unicode version of the command-line client program. For more \ninformation on this program, you can refer to section 4.5.1.6.2 of the reference manual. \nHow to start and stop the MySQL Command Line Client\n\nSection 1 \nAn introduction to MySQL \nHow to use the MySQL Command Line Client \nto work with a database \nOnce the MySQL Command Line Client is connected to a database server, \nyou can use it to run SQL statements that work with the databases that are \navailable from that server. When you enter a statement, you must end it with a \nsemicolon. Otherwise, the mysql command line displays a second line when you \npress the Enter key like this: \nmysql> show databases \n-> \nThis shows that the MySQL Command Line Client is waiting for you to finish \nyour statement. To finish a statement and execute it, you just type a semicolon \nand press the Enter key. \nthree of these statements in lowercase letters. That's because SQL isn't case-\nsensitive, and lowercase letters are easier to type. \nTo list the names of the databases stored on a server, you use the SHOW \nDATABASES statement as illustrated by the first example. Here, the ''ap'', ''ex'', \nand ''om'' databases are the databases that are created when you install our \ndownloadable databases as described in appendixes A and B. The \n''information_schema'', ''performance_schema'', and ''mysql'' databases are \ninternal databases that are used by the MySQL server. And the ''sys'' database \nis a database that comes with MySQL and can be used to interpret data in the \n''performance_schema'' database. \nTo select the database that you want to work with, you can enter a USE \nstatement as illustrated by the second example. Here, the AP database is \nselected, and the message after this statement says ''Database changed'' to \nindicate that the statement was successful. After you select a database, the \ncommands and statements that you enter will work with that database. \nTo retrieve data from the database, you use a SELECT statement as illus-\ntrated by the third example. Here, the vendor_name column from the Vendors \ntable is displayed. Note, however, that the result set is limited to only the first \nfive rows. When you successfully execute a SELECT statement, the MySQL \nCommand Line Client displays a message giving the nu1nber of rows that are \nincluded in the result set and the amount of time it took to run the query. In this \ncase, it took less than 1/100 of a second to run the query.\n\nCliapter 2 \nHow to use MySQL Workbench and other develop,nent tools \nHow to list the names of all databases managed by the server \nmysql> show databases; \n+--------------------+ \nI Database \nI \n+--------------------+ \nI ap \nI \nI \nI \nI \nex \ninformation \nmysql \nschema I \nI \nI \nI \nI \nom \nperformance_ schema \nsys \nI \nI \nI \nI \n+--------------------+ \n7 rows in set (0.00 sec) \nHow to select a database for use \nmysql> use ap; \nDatabase changed \nHow to select data from a database \nmysql> select vendor_name from vendors limit 5; \n+------------------------------+ \nI vendor_name \nI Abbey Office Furnishings \nI American Booksellers Assoc \nI American Express \nI ASC Signs \nI Ascom Hasler Mailing Systems \n5 rows in set (0.00 sec) \nDescription \n• \nYou can use the MySQL Command Line Client to work with any of the databases \nrunning on the database server. To do that, you can use any SQL statement that \nworks with a MySQL database. \n• \nTo execute a SQL statement, type the statement on the command line, followed by \na semicolon. Then, press the Enter key. \n• \nTo show a list of all available databases, you can use the SHOW DATABASES \nstatement. \n• \nTo select the database that you want to work with, you can use the USE statement. \n• \nSQL statements aren't case-sensitive. As a result, when using the MySQL \nCommand Line Client, most programmers enter their statements in lowercase \nletters beca11se they 're easier to type. \nHow to use the MySQL Command Line Client to work with a database\n\nSection 1 \nAn introduction to MySQL \nPerspective \nIn this chapter, you learned how to use MySQL Workbench to start and \nstop a MySQL server and to enter and execute SQL statements. With that \nas background, you're ready to go on to the next chapter, where you'll start \nlearning the details of coding your own SQL state1nents. \nTerms \nMySQL Workbench \ndatabase server \ndatabase service \ndatabase engine \ndatabase object \nschema \nsnippet \nSQL script \nMySQL Reference manual \nMySQL Command Line Client \nBefore you start the exercises ... \nBefore you start the exercises for this chapte1·, you need to install the MySQL \nServer and MySQL Workbench. In addition, you need to download and install \nthe source files for this book, and you need to create the databases and tables for \nthis book. The procedures for doing all of these tasks are provided in appendix \nA (Windows) and B (macOS). \nExercises \nIn these exercises, you'll use MySQL Workbench to review the tables in the AP \ndatabase. In addition, you'll use MySQL Workbench to enter SQL statements \nand run them against these tables. \nMake sure the MySQL server is running \n1. \nStart MySQL Workbench and open a connection for the root user. \n2. \nCheck whether the MySQL server is running. If it isn't, start it. When you're \ndone, close the Startup/Shutdown tab. \nUse MySQL Workbench to review the Accounts Payable (AP) \ndatabase \n3. \nIn the Navigato1· window, expand the node for the AP database so you can see \nall of the database objects it contains. \n4. \nView the data for the Vendors and Invoices tables.",
          "pages": [
            79,
            80,
            81,
            82,
            83,
            84,
            85,
            86,
            87,
            88,
            89,
            90
          ],
          "relevance": {
            "score": 0.6,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.2,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "commonMistakes": {
          "text": "Cliapter 2 \nHow to use MySQL Workbench and other develop,nent tools \n5. \nNavigate through the database objects and view the column definitions for at \nleast the Vendors and Invoices tables. \nUse MySQL Workbench to enter and run SQL statements \n6. \nDouble-click the AP database to select it. When you do that, MySQL \nWorkbench should display the database in bold. \n7. \nOpen a SQL Editor tab. Then, enter and run this SQL statement: \nSELECT vendor_ namA FROM vendors \n8. \nDelete thee at the end of vendor_name and run the statement again. Note the \nerror number and the description of the error. \n9. \nOpen another SQL Editor tab. Then, enter and run this statement: \nSELECT COUNT(*) AS nwnber_ of_ invoices, \nSUM(invoice_total) AS grand_ invoice_total \nFROM invoices \nUse MySQL Workbench to open and run scripts \n10. Open the select_vendor_city_state script that's in the \nc:\\rnu1·ach\\mysql\\scripts\\ch02 directory. Note that this script contains just one \nSQL statement. Then, run the statement. \n11. Open the select_ vendor_total_due script that's in the ch02 directory. Note that \nthis opens another SQL Editor tab. \n12. Open the select_ vendor_info1·mation script that's in the ch02 directory. Notice \nthat this script contains two SQL statements that end with semicolons (scroll \ndown if you need to). \n13. Press the Ctrl+Shift+Enter keys or click the Execute SQL Script button to tun \nboth of the statements in this script. Note that this displays the results in two \nResult grids. Make sure to view the results of both SELECT statements. \n14. Move the insertion point into the frrst statement and press Ctrl+Enter to run \njust that statement. \n15. Move the insertion point into the second statement and press Ctrl+Enter to run \njust that statement. \n16. Exit from MySQL Workbench.\n\nHow to retrieve data \nfrom a single table \nIn this chapter, you'll learn how to code SELECT statements that 1·etrieve data \nfrom a single table. The skills covered here are the essential ones that apply to \nany SELECT statement you code ... no matter how many tables it operates on, \nno matter how complex the retrieval. So you'll want to be sure you have a good \nunderstanding ot· the material in this chapter before you go on to the chapters \nthat follow. \nAn introduction to the SELECT statement ........................ 74 \nThe basic syntax of the SELECT statement .................................................. 74 \nSELECT statement examples ........................................................................ 76 \nHow to code the SELECT clause ........................................ 78 \nHow to code column specifications ............................................................... 78 \nHow to name the columns in a result set using aliases ................................. 80 \nHow to code arithmetic expressions .............................................................. 82 \nHow to use the CONCAT function to join strings ....................................... 84 \nHow to use functions with strings, dates, and n11mbers ................................ 86 \nHow to test expressions by coding statements without FROM clauses ........ 88 \nHow to eliminate duplicate rows .................................................................. 90 \nHow to code the WHERE clause ......................................... 92 \nHow to use the comparison operators ........................................................... 92 \nHow to use the AND, OR, and NOT logical operators ................................. 94 \nHow to use the IN operator ............................................................................ 96 \nHow to use the BETWEEN operator ............................................................ 98 \nHow to use the LIKE and REGEXP operators ........................................... 100 \nHow to use the IS NULL clause .................................................................. 102 \nHow to code the OR DER BY clause ................................. 104 \nHow to sort by a column narne .................................................................... 104 \nHow to sort by an alias, expression, or column number ............................. 106 \nHow to code the LIM IT clause ........................................... 108 \nHow to limit the number of rows ................................................................. 108 \nHow to return a range of rows ..................................................................... 108 \nPerspective ......................................................................... 110\n\nSection 1 \nAn introduction to MySQL \nAn introduction \nto the SELECT staten,ent \nTo get you started quickly, this chapter begins by presenting the basic syntax \nof the SELECT statement. Then, it presents several examples that should give \nyou an overview of how this statement works. \nThe basic syntax of the SELECT statement \nsummary at the top of this figure uses conventions that are similar to those used \nin other programming manuals. Capitalized words are keywords that you have \nto type exactly as shown. In contras~ you have to provide replacements for \nthe lowercase words. For example, you can enter a list of columns in place of \nselect_list, and you can enter a table name in place of table_source. \nBeyond that, you can omit the clauses enclosed in brackets ( [] ). If you \ncompare the syntax in this figure with the coding examples in the next figure, \nyou should easily see how the two are related. \nThis syntax summary has been simplified so you can focus on the five main \nclauses of the SELECT stateme·nt: SELECT, FROM, WHERE, ORDER BY, \nand LIMIT. Most SELECT statements contain the frrst four of these clauses. \nHowever, only the SELECT clause is required. \nThe SELECT clause is al ways the first clause in a SELECT statement. It \nidentifies the columns in the result set. These columns are retrieved from the \nbase tables named in the FROM clause. Since this chapter focuses on retrieving \ndata from a single table, the examples in this chapter use FROM clau.ses that \nname a single base table. In the next chapter, though, you'll learn how to retrieve \ndata from two or more tables. \nThe WHERE, ORDER BY, and LIMIT clauses ru·e optional. The \nORDER BY clause determines how the rows in the result set are sorted, and \nthe WHERE clause determines which rows in the base table are included in the \nresult set. The WHERE clause specifies a search condition that's used to filter \nthe rows in the base table. When this condition is true, the row is included in the \nresult set. \nThe LIMIT clause limits the number of rows in the result set. In contrast to \nthe WHERE clause, which uses a search condition, the LIMIT clause simply \nreturns a specified number of rows, regardless of the size of the full result set. Of \ncotrrse, if the result set has fewer rows than are specified by the LIMIT clause, \nall the rows in the result set are returned.\n\nChapter 3 \nHow to retrieve datafrom a single table \nThe basic syntax of the SELECT statement \nSELECT select_ list \n[FROM table_ source] \n[WHERE search condition] \n[ORDER BY order_by_ list] \n[LIMIT row_ limit] \nThe five clauses of the SELECT statement \nClause \nDescription \nSELECT \nFROM \nWHERE \nORDER BY \nLIMIT \nDescription \nDescribes the columns in the result set. \nNames the base table from which the query retrieves the data. \nSpecifies the conditions that must be met for a row to be included ia tbe result set. \nSpecifies how to sort the rows in the result set. \nSpecifies the number of rows to return. \n• \nYou use the basic SELECT statement shown above to retrieve the columns speci-\nfied in the SELECT clause from the base table specified in the FROM clause and \nstore them in a result set. \n• \nThe WHERE clause is used to filter the rows in the base table so that only those \nrows that match the search condition are included in the result set. If you omit the \nWHERE clause, all of the rows in the base table are included. \n• \nThe search condition of a WHERE clause consists of one or more Boolean expres-\nsions that result in a true, false, or null value. If the combination of all the expres-\nsions is a t1ue value, the row being tested is included in the result set. Otherwise, \nit's not. \n• \nIf you include the ORDER BY clause, the rows in the result set are sorted in the \nspecified sequence. Otherwise, the sequence of the rows is not guaranteed by \nMySQL. \n• \nIf you include the LIMIT clause, the result set that's retrieved is limited to a speci-\nfied number of 1·ows. If you omit this clause, all rows that match are returned. \n• \nYou 1nust code the clauses in the 01·der shown or you'll get a syntax error. \nNote \n• \nThe syntax shown above does not include all of the clauses of the SELECT state-\nment. You '11 learn about the other clauses later in this book.",
          "pages": [
            91,
            92,
            93,
            94,
            95
          ],
          "relevance": {
            "score": 0.8,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.0,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        }
      },
      "educational_notes": {
        "definition": "A SELECT statement is used to retrieve data from a database table. It allows you to specify which columns and rows of data you want to see.",
        "explanation": "The SELECT statement is one of the most fundamental tools in SQL for querying databases. It enables users to extract specific information from tables based on certain conditions. Here’s how it works:\n1. **Specify Columns**: You list the column names you want to retrieve, separated by commas.\n2. **FROM Table**: This specifies the table from which to fetch the data.\n3. **WHERE Condition (Optional)**: This filters the rows that are returned based on a condition.\n4. **ORDER BY Clause (Optional)**: This sorts the results in ascending or descending order based on one or more columns.\nYou use SELECT statements whenever you need to view, analyze, or manipulate data stored in your database.",
        "key_points": [
          "Key point 1: Always specify which columns you want to retrieve to avoid unnecessary data transfer.",
          "Key point 2: Use the WHERE clause to filter data based on specific conditions.",
          "Key point 3: ORDER BY is useful for organizing results in a meaningful way, making it easier to analyze.",
          "Key point 4: Always double-check your SQL syntax and test with small datasets before running on large tables.",
          "Key point 5: Understanding JOINs will help you combine data from multiple tables, which is essential for more complex queries."
        ],
        "examples": [
          {
            "title": "Basic Usage",
            "code": "SELECT vendor_name, vendor_address1, vendor_state FROM vendors;",
            "explanation": "This example retrieves the names and addresses of all vendors in the database."
          },
          {
            "title": "Practical Example",
            "code": "SELECT vendor_name, vendor_phone FROM vendors WHERE vendor_state = 'CA';",
            "explanation": "This practical example fetches the names and phone numbers of vendors located in California."
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Forgetting to specify columns",
            "incorrect_code": "SELECT FROM vendors;",
            "correct_code": "SELECT vendor_name FROM vendors;",
            "explanation": "Always include column names after SELECT. If you omit them, the query will return all columns."
          },
          {
            "mistake": "Using incorrect syntax for WHERE clause",
            "incorrect_code": "SELECT vendor_name FROM vendors WHERE vendor_state = 'CA';",
            "correct_code": "SELECT vendor_name FROM vendors WHERE vendor_state = 'CA';",
            "explanation": "Ensure that the condition in the WHERE clause is correctly formatted. SQL is case-sensitive, so make sure keywords and column names match exactly."
          },
          {
            "mistake": "Not ordering results",
            "incorrect_code": "SELECT vendor_name FROM vendors;",
            "correct_code": "SELECT vendor_name FROM vendors ORDER BY vendor_state;",
            "explanation": "Ordering your results can help you analyze data more effectively. Always consider sorting if the order of results matters."
          }
        ],
        "practice": {
          "question": "Write a SELECT statement to retrieve the names and email addresses of all customers from the 'customers' table who are located in New York City.",
          "solution": "SELECT customer_name, email FROM customers WHERE city = 'New York';\nThis query will return the names and emails of all customers living in New York City."
        }
      },
      "llm_enhanced": true,
      "raw_text_preview": "Cliapter 2 \nHow to use MySQL Workbench and other develop,nent tools \nThe column definitions for the Vendors table \n8 MySQL Workbench \nLocal insmnce MySQLSO X \nFile \nEdit \nVif!!N \nQuery \nDatabase \nSent",
      "content_relevance": {
        "score": 0.6,
        "sql_score": 1.0,
        "concept_score": 1.0,
        "non_sql_penalty": 0.2,
        "is_relevant": true,
        "analysis": "SQL content"
      }
    },
    "where-clause-murach": {
      "id": "where-clause-murach",
      "title": "WHERE Clause",
      "definition": "Filtering rows with comparison operators, AND, OR, NOT, IN, BETWEEN, LIKE",
      "difficulty": "beginner",
      "page_references": [
        85,
        86,
        87,
        88,
        89,
        90,
        91,
        92,
        93,
        94,
        95,
        96,
        97,
        98,
        99,
        100,
        101,
        102,
        103,
        104,
        105,
        106,
        107,
        108,
        109,
        110
      ],
      "sections": {
        "definition": {
          "text": "Cliapter 2 \nHow to use MySQL Workbench and other develop,nent tools \nThe web address for the MySQL 8.0 Reference Manual \nhttps://dev.rrwsgl.com/doc/refman/8.0/en/ \nA web page from the MySQL Reference Manual \nB MySQL MySQL 8.0 'le!erence \n)( \n+ \nD \nC \ni \nhnps dev.mysql.com oc/refman/8.0/en/manual-1nfo.html \n* e \n= \nThe v10rld s most popula Of)\"'JI source database 0. \nContact MySQL I Login I Register \nMyS~ . \nMYSQL.COM \nOOWNLO.-\\DS \nDOCUMENTATION \nDEVELO?ER ZOl~E \nQ. \nA Documentation Home \nMySQL 8.0 Reference Manual \nPreface and Legal Notices \n., General Information \nAbout This Manual \nTypographical and Syntax Convenoons \n> overview of the MY5QL Database \nManagement System \n• What Is New In MySQL 8.0 \n• Server and Status vanables and \nopoons Added, Deprecated, or \nRem011ed jr) MY5QL 8.0 \nDescription \nMySQL 8.0 Reference Manual I General lnformaOOl'I I About Ths Manua \nversion 8.0 \n¥ \n1.1 About This Manual \nThis 1s the Reference Manual for the MySQL Database System, version 8.0, \nthrough release 8.0.15. Differences between minor versions of MySQL 8.0 are \nnoted In the present text with reference to release numbers (8.0. x). For license \n1nformatlon, see the Legal Notices . \nThis manual Is not intended for use with older versions of the MySQL software \ndue to the many functional and other differences between MY5QL 8.0 and \nprevious versions. If you are using an earlier release of the MySQL software, \nplease refer to the appropnate manual. For example, MY5QL 5. 7 Reference \nMonuol covers the S.7 senes of MySQL software releases . \nBecause this manual serves as a reference, It does not provide general \n• \nTo view the MySQL Reference Manual, go to the MySQL website and select the \ncorrect version of the manual. The web address for MySQL 8.0 is shown above. \n• \nTo view a chapter, click the link for the chapter in the table of contents on the right \nside of the page. \n• \nTo return to the Home page for the manual, click the Start icon ( \nthat's displayed at the top of the left sidebar. \nfor the manual \n• \nTo search for a particular word or plu·ase, type the word or phrase in the ''Search \nthis Manual'' text box in the left sidebar and click the Search icon or press the \nEnter key. Then, you can scroll through the results and click links to get more \ninformation. \n• \nYou can also download the MySQL Reference Manual. However, it typically makes \nsense to use it online. \nHow to use the MySQL Reference Manual\n\nSection 1 \nAn introduction to MySQL \nHow to use the MySQL Co111111and Line \nClient \nBefore MySQL Workbench was available, programmers used a \ncommand-line tool known as the MySQL Command Line Client to connect \nto a MySQL server and work with it. This tool is also known as the MySQL \ncommand line. Although you may never need this tool, you shot1ld at least \nbe aware that it exists. This tool comes with MySQL, and it can be useful if \nMySQL Workbench isn't installed on the system that you're using. \nHow to start and stop the MySQL Command Line \nClient \nin Windows. Although this figure shows the Command Prompt window that's \navailable from Windows, you can use the MySQL Command Line Client on \nother operating systems too. In particular, on macOS, you can use the Terminal \nwindow to start the MySQL Command Line Client. \nWhen you use Windows, there's an easy way to start the MySQL Command \nLine Client if you want to log in as the root user for the database server that's \nrunning on the local computer. To do that, you just select the MySQL Command \nLine Client command from the Start menu. Then, MySQL will prompt you for \na password. If you enter the password correctly, you will be logged on to the \ndatabase server as the root user. \nIn some cases, you'll need to use a command line to start the MySQL \nCommand Line Client instead of using the Start menu. For example, you may \nneed to do that if you want to log into a database that's running on a different \ncomputer, if you want to log in as a user other than the root user, or if you 're \nusing another operating system such as macOS. In those cases, you can open \na command line and change the directory to the bin dil·ectory for the MySQL \ninstallation. Then, you can execute the mysql command and supply the param-\neters that are needed to connect to the database server. \nIf the MySQL server is located on a remote computer, you can specify \n-h, followed by the host name of the computer, and -u, followed by a valid \nusername. In addition, you specify -p so MySQL prompts you for a valid \npassword. Although it can take some experimentation to get these connection \nparameters right, you only need to figure this out once. \nOnce you enter a valid password for the specified username, the MySQL \nCommand Line Client displays a welcome message and a command line that \nlooks like this: \nmy sql> \nFrom this prompt, you can enter any statement that works with MySQL. When \nyou're done, you can exit the MySQL Command Line Client by entering ''exit'' \nor ''quit'' followed by a semicolon.\n\nCliapter 2 \nHow to use MySQL Workbench and other develop,nent tools \nThe MySQL Command Line Client displayed by Windows \n■ \nMySQL 8.0 Command Line Client \n□ \nX \nHow to start the MySQL Command Line Client (Windows only) \nStart➔ All Programs ➔ \nMySQL➔ MySQL Server 8.0➔ MySQL 8.0 Command Line Client \nHow to start the MySQL Command Line Client from the command line \nFor Windows \ncd \\ Program Files\\ MySQL\\ MySQL Server 8.0 \\ bin \nmysql -u r oot -p \nFor macOS \ncd / usr/ local/ mysql / bin \n. / mysql -u root -p \nHow the mysql command works \nThe syntax \nmysql -h hostname -u username -p \nExamples \nmysql - u ap_ tester -p \nmysql -h localhost -u root -p \nmysql -h murach. com -u ap_tester -p \nHow to exit from the MySQL Command Line Client \nmysql>exit; \nDescription \n• \nMySQL provides a command-line client program called the MySQL Command \nLine Client that lets you enter SQL statements that work with MySQL databases. \nThis program is also known as the MySQL command line. \n• \nFor Windows, use a Command Prompt window to start the MySQL Command Line Client. \n• \nFor macOS, use a Terminal window to start the MySQL Command Line Client. \n• \nTo stop the MySQL Command Line Client, enter ''exit'' or ''quit'' at the cominand \nline, followed by a semicolon. \n• \nMySQL 8.0 also includes a Unicode version of the command-line client program. For more \ninformation on this program, you can refer to section 4.5.1.6.2 of the reference manual. \nHow to start and stop the MySQL Command Line Client\n\nSection 1 \nAn introduction to MySQL \nHow to use the MySQL Command Line Client \nto work with a database \nOnce the MySQL Command Line Client is connected to a database server, \nyou can use it to run SQL statements that work with the databases that are \navailable from that server. When you enter a statement, you must end it with a \nsemicolon. Otherwise, the mysql command line displays a second line when you \npress the Enter key like this: \nmysql> show databases \n-> \nThis shows that the MySQL Command Line Client is waiting for you to finish \nyour statement. To finish a statement and execute it, you just type a semicolon \nand press the Enter key. \nthree of these statements in lowercase letters. That's because SQL isn't case-\nsensitive, and lowercase letters are easier to type. \nTo list the names of the databases stored on a server, you use the SHOW \nDATABASES statement as illustrated by the first example. Here, the ''ap'', ''ex'', \nand ''om'' databases are the databases that are created when you install our \ndownloadable databases as described in appendixes A and B. The \n''information_schema'', ''performance_schema'', and ''mysql'' databases are \ninternal databases that are used by the MySQL server. And the ''sys'' database \nis a database that comes with MySQL and can be used to interpret data in the \n''performance_schema'' database. \nTo select the database that you want to work with, you can enter a USE \nstatement as illustrated by the second example. Here, the AP database is \nselected, and the message after this statement says ''Database changed'' to \nindicate that the statement was successful. After you select a database, the \ncommands and statements that you enter will work with that database. \nTo retrieve data from the database, you use a SELECT statement as illus-\ntrated by the third example. Here, the vendor_name column from the Vendors \ntable is displayed. Note, however, that the result set is limited to only the first \nfive rows. When you successfully execute a SELECT statement, the MySQL \nCommand Line Client displays a message giving the nu1nber of rows that are \nincluded in the result set and the amount of time it took to run the query. In this \ncase, it took less than 1/100 of a second to run the query.\n\nCliapter 2 \nHow to use MySQL Workbench and other develop,nent tools \nHow to list the names of all databases managed by the server \nmysql> show databases; \n+--------------------+ \nI Database \nI \n+--------------------+ \nI ap \nI \nI \nI \nI \nex \ninformation \nmysql \nschema I \nI \nI \nI \nI \nom \nperformance_ schema \nsys \nI \nI \nI \nI \n+--------------------+ \n7 rows in set (0.00 sec) \nHow to select a database for use \nmysql> use ap; \nDatabase changed \nHow to select data from a database \nmysql> select vendor_name from vendors limit 5; \n+------------------------------+ \nI vendor_name \nI Abbey Office Furnishings \nI American Booksellers Assoc \nI American Express \nI ASC Signs \nI Ascom Hasler Mailing Systems \n5 rows in set (0.00 sec) \nDescription \n• \nYou can use the MySQL Command Line Client to work with any of the databases \nrunning on the database server. To do that, you can use any SQL statement that \nworks with a MySQL database. \n• \nTo execute a SQL statement, type the statement on the command line, followed by \na semicolon. Then, press the Enter key. \n• \nTo show a list of all available databases, you can use the SHOW DATABASES \nstatement. \n• \nTo select the database that you want to work with, you can use the USE statement. \n• \nSQL statements aren't case-sensitive. As a result, when using the MySQL \nCommand Line Client, most programmers enter their statements in lowercase \nletters beca11se they 're easier to type. \nHow to use the MySQL Command Line Client to work with a database\n\nSection 1 \nAn introduction to MySQL \nPerspective \nIn this chapter, you learned how to use MySQL Workbench to start and \nstop a MySQL server and to enter and execute SQL statements. With that \nas background, you're ready to go on to the next chapter, where you'll start \nlearning the details of coding your own SQL state1nents. \nTerms \nMySQL Workbench \ndatabase server \ndatabase service \ndatabase engine \ndatabase object \nschema \nsnippet \nSQL script \nMySQL Reference manual \nMySQL Command Line Client \nBefore you start the exercises ... \nBefore you start the exercises for this chapte1·, you need to install the MySQL \nServer and MySQL Workbench. In addition, you need to download and install \nthe source files for this book, and you need to create the databases and tables for \nthis book. The procedures for doing all of these tasks are provided in appendix \nA (Windows) and B (macOS). \nExercises \nIn these exercises, you'll use MySQL Workbench to review the tables in the AP \ndatabase. In addition, you'll use MySQL Workbench to enter SQL statements \nand run them against these tables. \nMake sure the MySQL server is running \n1. \nStart MySQL Workbench and open a connection for the root user. \n2. \nCheck whether the MySQL server is running. If it isn't, start it. When you're \ndone, close the Startup/Shutdown tab. \nUse MySQL Workbench to review the Accounts Payable (AP) \ndatabase \n3. \nIn the Navigato1· window, expand the node for the AP database so you can see \nall of the database objects it contains. \n4. \nView the data for the Vendors and Invoices tables.\n\nCliapter 2 \nHow to use MySQL Workbench and other develop,nent tools \n5. \nNavigate through the database objects and view the column definitions for at \nleast the Vendors and Invoices tables. \nUse MySQL Workbench to enter and run SQL statements \n6. \nDouble-click the AP database to select it. When you do that, MySQL \nWorkbench should display the database in bold. \n7. \nOpen a SQL Editor tab. Then, enter and run this SQL statement: \nSELECT vendor_ namA FROM vendors \n8. \nDelete thee at the end of vendor_name and run the statement again. Note the \nerror number and the description of the error. \n9. \nOpen another SQL Editor tab. Then, enter and run this statement: \nSELECT COUNT(*) AS nwnber_ of_ invoices, \nSUM(invoice_total) AS grand_ invoice_total \nFROM invoices \nUse MySQL Workbench to open and run scripts \n10. Open the select_vendor_city_state script that's in the \nc:\\rnu1·ach\\mysql\\scripts\\ch02 directory. Note that this script contains just one \nSQL statement. Then, run the statement. \n11. Open the select_ vendor_total_due script that's in the ch02 directory. Note that \nthis opens another SQL Editor tab. \n12. Open the select_ vendor_info1·mation script that's in the ch02 directory. Notice \nthat this script contains two SQL statements that end with semicolons (scroll \ndown if you need to). \n13. Press the Ctrl+Shift+Enter keys or click the Execute SQL Script button to tun \nboth of the statements in this script. Note that this displays the results in two \nResult grids. Make sure to view the results of both SELECT statements. \n14. Move the insertion point into the frrst statement and press Ctrl+Enter to run \njust that statement. \n15. Move the insertion point into the second statement and press Ctrl+Enter to run \njust that statement. \n16. Exit from MySQL Workbench.",
          "pages": [
            85,
            86,
            87,
            88,
            89,
            90,
            91
          ],
          "relevance": {
            "score": 0.7,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "examples": {
          "text": "How to retrieve data \nfrom a single table \nIn this chapter, you'll learn how to code SELECT statements that 1·etrieve data \nfrom a single table. The skills covered here are the essential ones that apply to \nany SELECT statement you code ... no matter how many tables it operates on, \nno matter how complex the retrieval. So you'll want to be sure you have a good \nunderstanding ot· the material in this chapter before you go on to the chapters \nthat follow. \nAn introduction to the SELECT statement ........................ 74 \nThe basic syntax of the SELECT statement .................................................. 74 \nSELECT statement examples ........................................................................ 76 \nHow to code the SELECT clause ........................................ 78 \nHow to code column specifications ............................................................... 78 \nHow to name the columns in a result set using aliases ................................. 80 \nHow to code arithmetic expressions .............................................................. 82 \nHow to use the CONCAT function to join strings ....................................... 84 \nHow to use functions with strings, dates, and n11mbers ................................ 86 \nHow to test expressions by coding statements without FROM clauses ........ 88 \nHow to eliminate duplicate rows .................................................................. 90 \nHow to code the WHERE clause ......................................... 92 \nHow to use the comparison operators ........................................................... 92 \nHow to use the AND, OR, and NOT logical operators ................................. 94 \nHow to use the IN operator ............................................................................ 96 \nHow to use the BETWEEN operator ............................................................ 98 \nHow to use the LIKE and REGEXP operators ........................................... 100 \nHow to use the IS NULL clause .................................................................. 102 \nHow to code the OR DER BY clause ................................. 104 \nHow to sort by a column narne .................................................................... 104 \nHow to sort by an alias, expression, or column number ............................. 106 \nHow to code the LIM IT clause ........................................... 108 \nHow to limit the number of rows ................................................................. 108 \nHow to return a range of rows ..................................................................... 108 \nPerspective ......................................................................... 110\n\nSection 1 \nAn introduction to MySQL \nAn introduction \nto the SELECT staten,ent \nTo get you started quickly, this chapter begins by presenting the basic syntax \nof the SELECT statement. Then, it presents several examples that should give \nyou an overview of how this statement works. \nThe basic syntax of the SELECT statement \nsummary at the top of this figure uses conventions that are similar to those used \nin other programming manuals. Capitalized words are keywords that you have \nto type exactly as shown. In contras~ you have to provide replacements for \nthe lowercase words. For example, you can enter a list of columns in place of \nselect_list, and you can enter a table name in place of table_source. \nBeyond that, you can omit the clauses enclosed in brackets ( [] ). If you \ncompare the syntax in this figure with the coding examples in the next figure, \nyou should easily see how the two are related. \nThis syntax summary has been simplified so you can focus on the five main \nclauses of the SELECT stateme·nt: SELECT, FROM, WHERE, ORDER BY, \nand LIMIT. Most SELECT statements contain the frrst four of these clauses. \nHowever, only the SELECT clause is required. \nThe SELECT clause is al ways the first clause in a SELECT statement. It \nidentifies the columns in the result set. These columns are retrieved from the \nbase tables named in the FROM clause. Since this chapter focuses on retrieving \ndata from a single table, the examples in this chapter use FROM clau.ses that \nname a single base table. In the next chapter, though, you'll learn how to retrieve \ndata from two or more tables. \nThe WHERE, ORDER BY, and LIMIT clauses ru·e optional. The \nORDER BY clause determines how the rows in the result set are sorted, and \nthe WHERE clause determines which rows in the base table are included in the \nresult set. The WHERE clause specifies a search condition that's used to filter \nthe rows in the base table. When this condition is true, the row is included in the \nresult set. \nThe LIMIT clause limits the number of rows in the result set. In contrast to \nthe WHERE clause, which uses a search condition, the LIMIT clause simply \nreturns a specified number of rows, regardless of the size of the full result set. Of \ncotrrse, if the result set has fewer rows than are specified by the LIMIT clause, \nall the rows in the result set are returned.\n\nChapter 3 \nHow to retrieve datafrom a single table \nThe basic syntax of the SELECT statement \nSELECT select_ list \n[FROM table_ source] \n[WHERE search condition] \n[ORDER BY order_by_ list] \n[LIMIT row_ limit] \nThe five clauses of the SELECT statement \nClause \nDescription \nSELECT \nFROM \nWHERE \nORDER BY \nLIMIT \nDescription \nDescribes the columns in the result set. \nNames the base table from which the query retrieves the data. \nSpecifies the conditions that must be met for a row to be included ia tbe result set. \nSpecifies how to sort the rows in the result set. \nSpecifies the number of rows to return. \n• \nYou use the basic SELECT statement shown above to retrieve the columns speci-\nfied in the SELECT clause from the base table specified in the FROM clause and \nstore them in a result set. \n• \nThe WHERE clause is used to filter the rows in the base table so that only those \nrows that match the search condition are included in the result set. If you omit the \nWHERE clause, all of the rows in the base table are included. \n• \nThe search condition of a WHERE clause consists of one or more Boolean expres-\nsions that result in a true, false, or null value. If the combination of all the expres-\nsions is a t1ue value, the row being tested is included in the result set. Otherwise, \nit's not. \n• \nIf you include the ORDER BY clause, the rows in the result set are sorted in the \nspecified sequence. Otherwise, the sequence of the rows is not guaranteed by \nMySQL. \n• \nIf you include the LIMIT clause, the result set that's retrieved is limited to a speci-\nfied number of 1·ows. If you omit this clause, all rows that match are returned. \n• \nYou 1nust code the clauses in the 01·der shown or you'll get a syntax error. \nNote \n• \nThe syntax shown above does not include all of the clauses of the SELECT state-\nment. You '11 learn about the other clauses later in this book.\n\nSection 1 \nAn introduction to MySQL \nSELECT statement examples \nments retrieve data from the Invoices table that you expe1imented with in the last \nchapter. After each statement, you can see its result set as displayed by MySQL \nWorkbench. In these examples, a horizontal or vertical sc1·oll bar indicates that \nthe result set contains more rows or columns than can be displayed at one time. \nThe first statement in this figure retrieves all of the rows and columns from \nthe Invoices table. Here, an asterisk (*) is used as a shorthand to indicate that \nall of the columns should be retrieved, and the WHERE and LIMIT clauses are \nomitted so all of the rows in the table are retrieved. In addition, this statement \ndoesn't include an ORDER BY clause, so the rows are in primary key sequence. \nThe second statement retrieves selected columns from the Invoices table. \nThese columns are listed in the SELECT clause. Like the first statement, this \nstatement doesn't include a WHERE or a LIMIT clause, so all the rows are \nretrieved. Then, the ORDER BY clause causes the rows to be sorted by the \ninvoice_total column in descending order, from largest to smallest. \nThe third statement also lists the columns to be retrieved. In this case, \nthough, the last column is calculated from two columns in the base table, \ncredit_total and payment_total, and the resulting column is given the name \ntotal_credits. In addition, the WHERE clause specifies that only the invoice \nwhose invoice_id column has a value of 17 should be retrieved. \nThe fourth SELECT statement includes a WHERE clause whose condition \nspecifies a range of values. In this case, only invoices with invoice dates between \n06/01/2018 and 06/30/2018 are retrieved. In addition, the rows in the result set \nare sorted by invoice date. \nThe last statement in this figure shows another example of the WHERE \nclause. In this case, only those rows with invoice totals greater than 50,000 are \nretrieved. Since none of the rows in the Invoices table satisfy this condition, the \nresult set is empty.\n\nChapter 3 \nHow to retrieve datafrom a single table \nA SELECT statement that retrieves all the data from the Invoices table \nSELECT* FROM invoices \ninvoice_id \nvendor_id \ninvoice_number \ninvoice_date \ninvoice_total \npayment_total \ncredit_total \ntermsjd \n~\n989319-457 \n2018-04-08 \n3813.33 \n3813.33 \n0.00 \n2018-04-10 \n40.20 \n40. 20 \n0.00 \n2018-04-13 \n138.75 \n1.38. 75 \n0.00 \n< \n(114 rows) \nA SELECT statement that retrieves three columns from each row, \nsorted in descending sequence by invoice total \nSELECT invoice_number, invoice_date, invoice_ total \nFROM invoices \nORDER BY invoice_total DESC \ninvoice number \ninvoice date \ninvoice total \n-\n-;-l o-20sa \n2018-05-28 \n37966.19 \nP-0259 \n2018-07-19 \n2688L40 \n0-2060 \n2018-07-24 \n23517. 58 \n( 114 rows ) \nIt,. \n\\I \n> \nl.-\n1; \nA SELECT statement that retrieves two columns and a calculated value \nfor a specific invoice \nSELECT invoice_ id, invoice_total, \ncredit total+ payment_total AS total credits \n• \n• \nFROM invoices \nWHERE invoice_ id = 17 \ninvoice_id \ninvoice_total \ntotal_credits \n--I \n► \n10.00 \n10.00 \nA SELECT statement that retrieves all invoices between given dates \nSELECT invoice_ n11mher, invoice_date, invoice_total \nFROM invoices \nWHERE invoice date BETWEEN '2018-06-01' AND \n1 2018-06-30' \nORDER BY invoice_date \n_J invoice_number \ninvoice date \ninvoice total \n► \n989319·-437 \n2018-06-01 \n2765.36 \nlll-92R-10094 \n2018-06-01 \n19.67 \n2018-06-01 \n21842.00 \n(37 rows ) \nA SELECT statement that returns an empty result set \nFROM invoices \nWHERE invoice_ total > 50000 \ninvoice_number \ninvoice date \ninvoice tot.al \n-\nSELECT statement examples \n,_ . \n1. \n'\n\nSection 1 \nAn introduction to MySQL \nHow to code the SELECT clause \nNow that you have a general idea of how the main clauses of a SELECT \nstatement work, you're ready to learn the details for coding the frrst clause, the \nSELECT clause. You can use this clause to specify the columns for a result set. \nHow to code column specifications \nclause. In this syntax, you can choose between the items in a syntax summary \nthat are separated by pipes ( I ), and you can omit items enclosed in brackets \n( [] ). If you have a choice between two or more optional items, the default item \nis underlined. And if an element can be coded multiple times in a statement, it's \nfollowed by an ellipsis ( ... ). \nThis figure continues by summarizing four techniques you can use to specify \nthe columns for a result set. First, you can code an asterisk in the SELECT \nclause to retrieve all of the columns in the base table. When you use this \ntechnique, MySQL returns the columns in the order that they are defined in the \nbase table. \nSecond, you can code a list of column names from the base table separated \nby commas. In this figure, for instance, the second example specifies three \ncolumns that are in the Vendors table. \nThird, you can code an expression that t1ses arithmetic operators. The result \nof an expression is a single value. In this figure, for instance, the third example \nuses an expression to subtract the payment_total and credit_total columns from \nthe invoice total column and return the balance due. \nFourth, you can code an expression that uses functions. In this figure, for \ninstance, the fourth example uses the CONCAT function to join a column named \nfirst_name, a space, and a column named last_name. Here, two single quotes are \nused to identify the literal value for the space. \nWhen you code the SELECT clause, you should include only the columns \nyou need. For example, you shouldn't code an asterisk to retrieve all the columns \nunless you need all the columns. That's because the amount of data that's \nretrieved can affect system performance. This is particularly important if you 're \ndeveloping SQL statements that will be used by application programs. \nFor now, don't worry if you don't completely understand all four techniques. \nIn the next four figures, you'll learn 1nore about how they work.\n\nChapter 3 \nHow to retrieve datafrom a single table \nThe expanded syntax of the SELECT clause \nSELECT [ALLIDISTINCT] \ncolumn_ specification [[AS] result_ column] \n[, column_ specification [[AS] result_ column]J ... \nFour ways to code column specifications \nSource \nOption \nSyntax \nBase table value \nAll columns \nColumn name \nCalculated value \nResult of a calculation \nResult of a function \n* \ncolumn_11a1ne \nArithmetic expressions (see figure 3-5) \nFunctions (see figures 3-6 and 3-7) \nColumn specifications that use base table values \nThe * is used to retrieve all columns \nSELECT* \nColumn names are used to retrieve specific columns \nSELECT vendor_ name, vendor_ city, vendor_ state \nColumn specifications that use calculated values \nAn arithmetic expression that calculates the balance due \nSELECT invoice_ total -\npayment_ total - credit_ total AS balance_due \nA function that returns the full name \nSELECT CONCAT(first_ name, ' ', last_name) AS full_ name \nDescription \n• \nUse SELECT * only when you need to retrieve all of the columns from a table. \nOtherwise, list the names of the columns you need. \n• \nAn expression is a combination of column names and operators that evaluate to a \nsingle value. In the SELECT clause, you can code expressions that include one or \nmore arithmetic operators and expressions that include one or more functions. \n• \nAfter each column specification, you can code an AS clause to specify the name for \nthe column in the result set. See figure 3-4 for details. \nNote \n• \nThe ALL and DISTINCT keywords specify whether or not duplicate rows are \nrettn·ned. See figlll·e 3-9 for details. \nHow to code column specifications\n\nSection 1 \nAn introduction to MySQL \nHow to name the columns \nin a result set using aliases \nBy default, MySQL gives a column in a result set the same name as the \ncolumn in the base table. If the column is based on a calculated value, it's \nassigned a name based on the expression for the value. However, whenever you \nwant, you can specify a different name known as a column alias as shown in \nTo assign a column alias, you code the column specification followed by \nthe AS keyword and the new name as shown by the first example in this figure. \nHere, the statement creates an alias of ''Invoice Number'' for the invoice_number \ncolumn, ''Date'' for the invoice_date column, and ''Total'' for the invoice_total \ncolumn. To include a space in the alias for the first column, this statement \nencloses that alias in double quotes ( \" ). \nThe second example in this figure shows what happens when you don't \nassign an alias to a calculated column. In that case, MySQL automatically \nassigns the column an alias that's the same as the column's expression. Since the \nexpressions for many calculated values are cumbersome, you typically assign a \nshorter alias for calculated values as shown throughout the rest of this chapter.\n\nChapter 3 \nHow to retrieve datafrom a single table \nA SELECT statement that renames the columns in the result set \nSELECT invoice_number AS \"Invoice Number\", invoice_date AS Date, \ninvoice total AS Total \nFROM invoices \nInvoice Number \nDate \nTotal \n► \n989319-457 \n2018-04-08 \n3813.33 \n2018-04-10 \n-10.20 \n2018-04-13 \n138. 75 \n2-000-2993 \n2018-04-16 \n144. 70 \n2018-04-16 \n15.50 \n2018-04-16 \n42.75 \n(114 rows) \nA SELECT statement that doesn't name a calculated column \nSELECT invoice_number, invoice_date, invoice_total, \ninvoice_total - payment_total - credit_total \nFROM invoices \n~ \ninvoice_number \ninvoice date \ninvoice total \ninvoice_tot.al - payment_total - credit_tot.al \n-\n2018-04-08 \n3813, 33 \n0.00 \n► \n989319-457 \n2018-04-10 \n\"10. 20 \n0.00 \n2018-04-13 \n138.75 \n0.00 \n2-000-2993 \n2018-04-16 \n144.70 \n0.00 \n2018-04-16 \n15.50 \n0.00 \n2018-04-16 \n42. 75 \n0.00 \n(114 rows) \nDescription \n• \nBy default, a column in the result set is given the same name as the column in \nthe base table. If that's not what you want, you can specify a substitute name, or \ncolumn alias, for the column. \n• \nTo specify an alias for a column, use the AS phrase. Although the AS keyword is \noptional, I recommend you code it for readability. \n• \nIf you don't specify an alias for a column that's based on a calculated value, \nMySQL uses the expression for the calculated value as the column name. \n• \nTo include spaces or special characters in an alias, enclose the alias in double \nquotes ( \" ) or single quotes ( ' ). \nHow to name the columns in a result set using aliases \nV \n-\n\nSection 1 \nAn introduction to MySQL \nHow to code arithmetic expressions \nthe arithmetic operators you can use in this type of expression. Then, it presents \nthree examples that show bow you use these operators. \nThe SELECT statement in the fu·st example includes an arithmetic expres-\nsion that calculates the balance due for an invoice. This expression subtracts \nthe payment_total and credit_total columns from the invoice_total column. The \nresulting column is given an alias of balance_due. \nWhen MySQL evaluates an arithmetic expression, it performs the operations \nfrom left to right based on the order of precedence. To start, MySQL performs \nmultiplication, division, and modulo operations. Then, it performs addition and \nsubtraction operations. \nIf that's not what you want, you can use parentheses to specify how an \nexpression is evaluated. Then, MySQL evaluates the expressions in the inner-\nmost sets of parentheses first, followed by the expressions in outer sets of \nparentheses. Within each set of parentheses, MySQL evaluates the expression \nfrom left to right in the order of precedence. \nIf you want, you can also use parentheses to clarify an expression even if \nthey're not needed for the expression to be evaluated properly. However, you \nshould avoid cluttering your SQL statements with unnecessary parentheses. \nTo show how pai·entheses and the order of precedence affect the evaluation \nof an expression, consider the second example in this figure. Here, the expres-\nsions in the second and third columns both perform the same operations. These \nexpressions use one column name (invoice_id) that returns a number and two \nliteral values for numbers (7 and 3). When you code a literal value for a number, \nyou don't need to enclose it in quotes. \nWhen MySQL evaluates the exp1·ession in the second column, it perfo1ms \nthe multiplication operation before the addition operation because multiplica-\ntion comes before addition in the order of precedence. When MySQL evaluates \nthe expression in the third column, though, it perfor1ns the addition operation \nfirst because it's enclosed in parentheses. Because of this, these two expressions \nreturn different values as shown in the result set. \nAlthough you're probably familiar with the addition, subtraction, multipli-\ncation, and division operators, you may not be familiar with the MOD (%) or \nDIV operators. MOD returns the remainder of a division of two integers, and \nDIV returns the integer quotient of two numbers. These are shown in the third \nexample in this figure. Here, the second column contains the quotient of the \ntwo numbers, which MySQL automatically converts from an integer value to a \ndecimal value. Then, the third column uses the DIV operator to return the integer \nquotient of the same division operation. The fourth column uses the modt1lo \noperator to return the remainder of the division operation. \nBefore going on, you should notice that the second and third SELECT \nstatements include an ORDER BY clause that sorts the result set in ascending \nsequence by the invoice_id column. Although you might think that this would \nbe the default, that's not the case with MySQL. Instead, the rows in a result set \nare returned in the most efficient way. If you want the rows returned in a specific \nsequence, then, you need to include the ORDER BY clause.",
          "pages": [
            92,
            93,
            94,
            95,
            96,
            97,
            98,
            99,
            100,
            101,
            102
          ],
          "relevance": {
            "score": 0.6,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.2,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "commonMistakes": {
          "text": "Chapter 3 \nHow to retrieve datafrom a single table \nThe arithmetic operators in order of precedence \nOperator \nName \nOrder of precedence \n* \nMultiplication \nI \nDivisio11 \nDIV \nInteger division \n~ \n(MOD) \nModulo (remainder) \n+ \nAddition \nSubtraction \nA SELECT statement that calculates the balance due \nSELECT invoice_total, payment_total, credit_total, \ninvoice_total - payment_ total - credit_ total AS balance_due \nFROM invoices \ninvoice_ total \npayment_total \naedit_total \nbalance_due \n► \n3813.33 \n38L3.33 \n0.00 \n0.00 \n40.20 \n40.20 \n0.00 \n0.00 \n1 m . 75 \n138.75 \n0.00 \n0.00 \nUse parentheses to control the sequence of operations \nSELECT invoice_ id, \ninvoice_id + 7 * 3 AS multiply_first, \n(invoice_id + 7) * 3 AS add first \nFROM invoices \nORDER BY invoice_id \ninvoice_id \nmultiply _first \nadd_first \n► \nUse the DIV and modulo operators \nSELECT invoice_ id, \ninvoice_id / 3 AS decimal_quotient, \ninvoice_id DIV 3 AS integer_quotient, \ninvoice_id % 3 AS remainder \nFROM invoices \nORDER BY invoice_id \n_J invorce_id \ndecimal_quotient \ninteger _quotient \nremainder \n► \n0.3333 \n0.6667 \nI \n1.0000 \nl \nDescription \n'--\n. \n'--\n• \nUnless parentheses are used, the operations in an expression take place from left to right \nin the order of precedence. For arithmetic expressions, MySQL performs multiplication, \ndivision, and modulo operations first. Then, it performs addition and subtraction operations. \n• \nWhen necessary, you can use parentheses to override or clarify the sequence of operations. \nHow to code arithmetic expressions\n\nSection 1 \nAn introduction to MySQL \nHow to use the CONCAT function \nto join strings \njoin, or concatenate, strings. In MySQL, a string can contain any combination of \ncharacters, and a function performs an operation and returns a value. To code a \nfunction, you begin by entering its name followed by a set of parentheses. If the \nfunction requires an argument, or parameter, you enter it within the parentheses. \nIf the function takes more than one argument, you separate them with commas. \nIn this figure, the first example shows how to use the CONCAT function to \njoin the vendor_city and vendor_state columns in the Vendors table. Since this \nexample doesn't assign an alias to this column, MySQL automatically assigns \nthe expression formula as the column name. In addition, there isn't a space \nbetween the vendor_state and the vendor_city in the result set. Since this makes \nthe data difficult to read, this string should be formatted as shown in the second \nor third example. \nThe second example shows how to format a string expression by adding \nspaces and punctuation. Here, the vendor_city column is concatenated with a \nliteral value for a string that contains a comma and a space. Then, the \nvendor_state column is concatenated with that result, followed by a literal value \nfor a string that contains a single space and the vendor_zip_code column. \nTo code a string literal, you can enclose the value in either single quotes ( ' ) \nor double quotes ( \" ). Occasionally, you may need to include a single quote as \nan apostrophe within a literal value for a string. If you're using single quotes \naround the literal, however, MySQL will misinterpret the aposn·ophe as the end \nof the string. To solve this, you can code two single quotation marks in a row as \nshown by the third example. Or, you can use double quotes like this: \nCONCAT(vendor_name, \"'s Address: \") AS vendor\n\nChapter 3 \nHow to retrieve data from a single table \nThe syntax of the CONCAT function \nCONCAT(stringl[, string2] ... } \nHow to concatenate string data \nSELECT vendor_ city, vendor_ state, CONCAT(vendor_city, vendor_ state} \nFROM vendors \n~ \nvendor _city \nvendor _state \nCONCAT(vendor _city, vendor _state) -\nWI \nMadisonWI \n► \nMadison \nWashington \nDC \n\\~ashingtonDC \n(122 rows) \nHow to format string data using literal values \nSELECT vendor_name, \nCONCAT(vendor_city, \nAS address \nFROM vendors \nvendor _name \naddress \n----, \n', ', vendor_ state, \n► \nUS Postal Service \nNational Information Data Ctr \nMadison, WI 53707 \nWashington, DC 20120 \n(122 rows} \nHow to include apostrophes in literal values \n1 , \nvendor_ zip_code) \nSELECT CONCAT(vendor_name, '' 's Address: ') AS Vendor, \nCONCAT(vendor_city, ', ', vendor_state, ' ', vendor_ zip_code} \nAS Address \nFROM vendors \nVendor \nAddress \n► \nUS Postal Service's Address: \nMadison, WI 53707 \nNational Information Data Ctr's Address: \n\\n/ashington, DC 20120 \n(122 rows) \nDescription \n• \nAn expression can include any of the functions that are supported by MySQL. A \nfunction performs an operation and returns a value. \nl.-\nI\\ \n\\I \n• \nTo code a function, code the function name followed by a set of parentheses. Within \nthe parentheses, code any parameters, or arguments, required by the function. If a \nfunction requires two or more arguments, separate them with commas. \n• \nTo code a literal value for a string, enclose one or more characters within single \nquotes ( ' ) or double quotes ( \" ). \n• \nTo include a single quote within a literal value for a string, code two single quotes. \nOr, use double quotes instead of single quotes to start and end the literal value. \n• \nTo join, or concatenate, two or more string columns or literal values, use the \nCONCAT function. \nHow to use the CONCAT function to join strings\n\nSection 1 \nAn introduction to MySQL \nHow to use functions with strings, dates, \nand numbers \nfunctio11 operates on strings, the DATE_FORMAT function operates on dates, \nand the ROUND function operates on numbers. For now, don't worry about the \ndetails of how the functions shown here work, because you'll learn more about \nall of these functions in chapter 9. Instead, just focus on how they're used in \ncolumn specifications. \nThe first example in this figure shows how to use the LEFT function to \nextract the first character of the vendor_contact_frrst_name and \nvendor_contact_last_name columns. The frrst parameter of this function speci-\nfies the string value, and the second parameter specifies the number of charac-\nters to return. Then, this statement concatenates the results of the two LEFT \nfunctions to form initials as shown in the result set. \nThe second example shows how to use the DATE_FORMAT function \nto change the format used to display date values. This function requires two \nparameters. The first parameter is the date value to be formatted and the second \nis a format string that uses specific values as placeholders for the various parts \nof the date. The first column in this example renrrns the invoice_date column in \nthe default MySQL date format, ''yyyy-mm-dd''. Since this format isn't used as \noften in the USA, the second column is formatted in the more typical \n''mm/dd/yy'' format. In the third column, the invoice date is in another format \nthat's commonly used. In chapter 9, you'll leait1 1nore about specifying the \nformat string for the DATE_FORMAT function. \nThe third example uses the ROUND function to round the value of the \ninvoice total column to the nearest dollai· and nearest dime. This function can \naccept eitl1er one or two parameters. The first parameter specifies the number to \nbe rounded and the optional second parameter specifies the number of decimal \nplaces to keep. If the second parameter is omitted, the function rounds to the \nnearest integer.\n\nChapter 3 \nHow to retrieve datafrom a single table \nThe syntax of the LEFT, DATE_FORMAT, and ROUND functions \nLEFT(string, number_of_characters) \nDATE_ FORMAT (date, format_string) \nROUND(number[, number_of_decimal_places]) \nA SELECT statement that uses the LEFT function \nSELECT vendor_ contact_ first_name, vendor_contact_ last_ name, \nCONCAT(LEFT(vendor_ contact_first_ namA, 1 ) , \nLEFT (vendor_ contact_ last_ namA, 1)) AS initials \nFROM vendors \nvendor _contact_first_name \nvendor contact last name \ninitials \n- -\n► \nFrancesco \nAlberto \nFA \nI Ania \nIrvin \nAI \nLukas \nLiana \nLL \n(122 rows ) \nA SELECT statement that uses the DATE FORMAT function \nSELECT invoice_date, \nDATE_ FORMAT(invoice_date, •~oro/%d /%y') AS 'MM/ DD/YY', \nDATE_ FORMAT{invoice_date, ' %e-%b-%Y') AS 'DD-Mon-YYYY' \nFROM invoices \nORDER BY invoice_date \ninvoice_date \n~ \n2018-04-08 \n2018-04-10 \nI 20 18-04-13 \n(114 rows) \nMM/00/'(Y \n04/08/18 \n04/10/18 \n04/ 13/18 \nDD-Mon-YYYY \n8-Apr-2018 \n10--Apr-2018 \n13-Apr-2018 \nA SELECT statement that uses the ROUND function \nSELECT invoice_date, invoice_total, \nROUND(invoice_ total) AS nearest_dollar, \nROUND (invoice_ total, 1) AS nearest_dime \nFROM invoices \nORDER BY invoice date \nI invoice_date \ninvoice _total \nnearest_dollar \nnearest_dime \n► \n2018--04-08 \n3813.33 \n3813.3 \n2018-04-10 \n40.20 \n40.2 \n2018-04-13 \n138.75 \n138.8 \n( 114 rows ) \nDescription \n• \nWhen using the DATE_FORMAT function to specify the format of a date, you use \nthe percent sign (%) to identify a format code. For example, a format code of m \nreturns the month number with a leading zero if necessary. For more information \nabout these codes, see chapter 9. \n• \nFor more information about using functions, see chapter 9. \nHow to use functions with strings, dates, and numbers \nI\\ \n'--\nV",
          "pages": [
            103,
            104,
            105,
            106,
            107
          ],
          "relevance": {
            "score": 0.8,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.0,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        }
      },
      "educational_notes": {
        "definition": "The WHERE clause is used in SQL to filter records and only return those that meet certain conditions.",
        "explanation": "The WHERE clause is essential for narrowing down data in a database. It allows you to specify conditions that rows must meet to be included in the result set. For example, if you want to find all customers who live in New York City, you would use the WHERE clause to filter out only those records where the city column equals 'New York City'. This is crucial for retrieving specific data efficiently and avoiding unnecessary processing of large datasets.",
        "key_points": [
          "Key point 1: The WHERE clause filters rows based on conditions",
          "Key point 2: It can be used with various operators like =, >, <, LIKE, etc.",
          "Key point 3: Always end the condition with a semicolon (;)",
          "Key point 4: Use parentheses to group complex conditions for clarity",
          "Key point 5: The WHERE clause is often used in conjunction with SELECT, INSERT, UPDATE, and DELETE statements"
        ],
        "examples": [
          {
            "title": "Basic Usage",
            "code": "-- SELECT all customers FROM New York City SELECT * FROM customers WHERE city = 'New York City';",
            "explanation": "This example selects all columns (indicated by *) from the 'customers' table where the 'city' column equals 'New York City'.",
            "validation_note": "SQL auto-fixed: "
          },
          {
            "title": "Practical Example",
            "code": "-- Find employees who earn more than $50,000\nSELECT name, salary FROM employees WHERE salary > 50000;",
            "explanation": "This practical example retrieves the 'name' and 'salary' of all employees whose salary is greater than $50,000."
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Forgetting to include a semicolon at the end of the condition",
            "incorrect_code": "-- Incorrect: No semicolon\nSELECT * FROM customers WHERE city = 'New York City'",
            "correct_code": "-- Correct: Semicolon included\nSELECT * FROM customers WHERE city = 'New York City';",
            "explanation": "SQL statements must end with a semicolon to indicate the end of the command. Forgetting it can lead to syntax errors."
          }
        ],
        "practice": {
          "question": "Write a SQL query that selects all products from the 'products' table where the price is less than $100 and the category is 'Electronics'.",
          "solution": "-- Solution: Selecting products based on multiple conditions\nSELECT * FROM products WHERE price < 100 AND category = 'Electronics';\nExplanation: This query filters the 'products' table to return only those rows where both the 'price' column is less than $100 and the 'category' column equals 'Electronics'."
        }
      },
      "llm_enhanced": true,
      "raw_text_preview": "Cliapter 2 \nHow to use MySQL Workbench and other develop,nent tools \nThe web address for the MySQL 8.0 Reference Manual \nhttps://dev.rrwsgl.com/doc/refman/8.0/en/ \nA web page from the MySQL Reference ",
      "content_relevance": {
        "score": 0.5,
        "sql_score": 1.0,
        "concept_score": 1.0,
        "non_sql_penalty": 0.3,
        "is_relevant": true,
        "analysis": "SQL content"
      }
    },
    "order-by-murach": {
      "id": "order-by-murach",
      "title": "ORDER BY Clause",
      "definition": "Sorting query results by one or more columns, ascending and descending",
      "difficulty": "beginner",
      "page_references": [
        101,
        102,
        103,
        104,
        105,
        106,
        107,
        108,
        109,
        110,
        111,
        112,
        113,
        114,
        115,
        116
      ],
      "sections": {
        "definition": {
          "text": "Chapter 3 \nHow to retrieve datafrom a single table \nA SELECT statement that renames the columns in the result set \nSELECT invoice_number AS \"Invoice Number\", invoice_date AS Date, \ninvoice total AS Total \nFROM invoices \nInvoice Number \nDate \nTotal \n► \n989319-457 \n2018-04-08 \n3813.33 \n2018-04-10 \n-10.20 \n2018-04-13 \n138. 75 \n2-000-2993 \n2018-04-16 \n144. 70 \n2018-04-16 \n15.50 \n2018-04-16 \n42.75 \n(114 rows) \nA SELECT statement that doesn't name a calculated column \nSELECT invoice_number, invoice_date, invoice_total, \ninvoice_total - payment_total - credit_total \nFROM invoices \n~ \ninvoice_number \ninvoice date \ninvoice total \ninvoice_tot.al - payment_total - credit_tot.al \n-\n2018-04-08 \n3813, 33 \n0.00 \n► \n989319-457 \n2018-04-10 \n\"10. 20 \n0.00 \n2018-04-13 \n138.75 \n0.00 \n2-000-2993 \n2018-04-16 \n144.70 \n0.00 \n2018-04-16 \n15.50 \n0.00 \n2018-04-16 \n42. 75 \n0.00 \n(114 rows) \nDescription \n• \nBy default, a column in the result set is given the same name as the column in \nthe base table. If that's not what you want, you can specify a substitute name, or \ncolumn alias, for the column. \n• \nTo specify an alias for a column, use the AS phrase. Although the AS keyword is \noptional, I recommend you code it for readability. \n• \nIf you don't specify an alias for a column that's based on a calculated value, \nMySQL uses the expression for the calculated value as the column name. \n• \nTo include spaces or special characters in an alias, enclose the alias in double \nquotes ( \" ) or single quotes ( ' ). \nHow to name the columns in a result set using aliases \nV \n-\n\nSection 1 \nAn introduction to MySQL \nHow to code arithmetic expressions \nthe arithmetic operators you can use in this type of expression. Then, it presents \nthree examples that show bow you use these operators. \nThe SELECT statement in the fu·st example includes an arithmetic expres-\nsion that calculates the balance due for an invoice. This expression subtracts \nthe payment_total and credit_total columns from the invoice_total column. The \nresulting column is given an alias of balance_due. \nWhen MySQL evaluates an arithmetic expression, it performs the operations \nfrom left to right based on the order of precedence. To start, MySQL performs \nmultiplication, division, and modulo operations. Then, it performs addition and \nsubtraction operations. \nIf that's not what you want, you can use parentheses to specify how an \nexpression is evaluated. Then, MySQL evaluates the expressions in the inner-\nmost sets of parentheses first, followed by the expressions in outer sets of \nparentheses. Within each set of parentheses, MySQL evaluates the expression \nfrom left to right in the order of precedence. \nIf you want, you can also use parentheses to clarify an expression even if \nthey're not needed for the expression to be evaluated properly. However, you \nshould avoid cluttering your SQL statements with unnecessary parentheses. \nTo show how pai·entheses and the order of precedence affect the evaluation \nof an expression, consider the second example in this figure. Here, the expres-\nsions in the second and third columns both perform the same operations. These \nexpressions use one column name (invoice_id) that returns a number and two \nliteral values for numbers (7 and 3). When you code a literal value for a number, \nyou don't need to enclose it in quotes. \nWhen MySQL evaluates the exp1·ession in the second column, it perfo1ms \nthe multiplication operation before the addition operation because multiplica-\ntion comes before addition in the order of precedence. When MySQL evaluates \nthe expression in the third column, though, it perfor1ns the addition operation \nfirst because it's enclosed in parentheses. Because of this, these two expressions \nreturn different values as shown in the result set. \nAlthough you're probably familiar with the addition, subtraction, multipli-\ncation, and division operators, you may not be familiar with the MOD (%) or \nDIV operators. MOD returns the remainder of a division of two integers, and \nDIV returns the integer quotient of two numbers. These are shown in the third \nexample in this figure. Here, the second column contains the quotient of the \ntwo numbers, which MySQL automatically converts from an integer value to a \ndecimal value. Then, the third column uses the DIV operator to return the integer \nquotient of the same division operation. The fourth column uses the modt1lo \noperator to return the remainder of the division operation. \nBefore going on, you should notice that the second and third SELECT \nstatements include an ORDER BY clause that sorts the result set in ascending \nsequence by the invoice_id column. Although you might think that this would \nbe the default, that's not the case with MySQL. Instead, the rows in a result set \nare returned in the most efficient way. If you want the rows returned in a specific \nsequence, then, you need to include the ORDER BY clause.\n\nChapter 3 \nHow to retrieve datafrom a single table \nThe arithmetic operators in order of precedence \nOperator \nName \nOrder of precedence \n* \nMultiplication \nI \nDivisio11 \nDIV \nInteger division \n~ \n(MOD) \nModulo (remainder) \n+ \nAddition \nSubtraction \nA SELECT statement that calculates the balance due \nSELECT invoice_total, payment_total, credit_total, \ninvoice_total - payment_ total - credit_ total AS balance_due \nFROM invoices \ninvoice_ total \npayment_total \naedit_total \nbalance_due \n► \n3813.33 \n38L3.33 \n0.00 \n0.00 \n40.20 \n40.20 \n0.00 \n0.00 \n1 m . 75 \n138.75 \n0.00 \n0.00 \nUse parentheses to control the sequence of operations \nSELECT invoice_ id, \ninvoice_id + 7 * 3 AS multiply_first, \n(invoice_id + 7) * 3 AS add first \nFROM invoices \nORDER BY invoice_id \ninvoice_id \nmultiply _first \nadd_first \n► \nUse the DIV and modulo operators \nSELECT invoice_ id, \ninvoice_id / 3 AS decimal_quotient, \ninvoice_id DIV 3 AS integer_quotient, \ninvoice_id % 3 AS remainder \nFROM invoices \nORDER BY invoice_id \n_J invorce_id \ndecimal_quotient \ninteger _quotient \nremainder \n► \n0.3333 \n0.6667 \nI \n1.0000 \nl \nDescription \n'--\n. \n'--\n• \nUnless parentheses are used, the operations in an expression take place from left to right \nin the order of precedence. For arithmetic expressions, MySQL performs multiplication, \ndivision, and modulo operations first. Then, it performs addition and subtraction operations. \n• \nWhen necessary, you can use parentheses to override or clarify the sequence of operations. \nHow to code arithmetic expressions",
          "pages": [
            101,
            102,
            103
          ],
          "relevance": {
            "score": 0.62,
            "sql_score": 0.9,
            "concept_score": 0.9,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "examples": {
          "text": "Section 1 \nAn introduction to MySQL \nHow to use the CONCAT function \nto join strings \njoin, or concatenate, strings. In MySQL, a string can contain any combination of \ncharacters, and a function performs an operation and returns a value. To code a \nfunction, you begin by entering its name followed by a set of parentheses. If the \nfunction requires an argument, or parameter, you enter it within the parentheses. \nIf the function takes more than one argument, you separate them with commas. \nIn this figure, the first example shows how to use the CONCAT function to \njoin the vendor_city and vendor_state columns in the Vendors table. Since this \nexample doesn't assign an alias to this column, MySQL automatically assigns \nthe expression formula as the column name. In addition, there isn't a space \nbetween the vendor_state and the vendor_city in the result set. Since this makes \nthe data difficult to read, this string should be formatted as shown in the second \nor third example. \nThe second example shows how to format a string expression by adding \nspaces and punctuation. Here, the vendor_city column is concatenated with a \nliteral value for a string that contains a comma and a space. Then, the \nvendor_state column is concatenated with that result, followed by a literal value \nfor a string that contains a single space and the vendor_zip_code column. \nTo code a string literal, you can enclose the value in either single quotes ( ' ) \nor double quotes ( \" ). Occasionally, you may need to include a single quote as \nan apostrophe within a literal value for a string. If you're using single quotes \naround the literal, however, MySQL will misinterpret the aposn·ophe as the end \nof the string. To solve this, you can code two single quotation marks in a row as \nshown by the third example. Or, you can use double quotes like this: \nCONCAT(vendor_name, \"'s Address: \") AS vendor\n\nChapter 3 \nHow to retrieve data from a single table \nThe syntax of the CONCAT function \nCONCAT(stringl[, string2] ... } \nHow to concatenate string data \nSELECT vendor_ city, vendor_ state, CONCAT(vendor_city, vendor_ state} \nFROM vendors \n~ \nvendor _city \nvendor _state \nCONCAT(vendor _city, vendor _state) -\nWI \nMadisonWI \n► \nMadison \nWashington \nDC \n\\~ashingtonDC \n(122 rows) \nHow to format string data using literal values \nSELECT vendor_name, \nCONCAT(vendor_city, \nAS address \nFROM vendors \nvendor _name \naddress \n----, \n', ', vendor_ state, \n► \nUS Postal Service \nNational Information Data Ctr \nMadison, WI 53707 \nWashington, DC 20120 \n(122 rows} \nHow to include apostrophes in literal values \n1 , \nvendor_ zip_code) \nSELECT CONCAT(vendor_name, '' 's Address: ') AS Vendor, \nCONCAT(vendor_city, ', ', vendor_state, ' ', vendor_ zip_code} \nAS Address \nFROM vendors \nVendor \nAddress \n► \nUS Postal Service's Address: \nMadison, WI 53707 \nNational Information Data Ctr's Address: \n\\n/ashington, DC 20120 \n(122 rows) \nDescription \n• \nAn expression can include any of the functions that are supported by MySQL. A \nfunction performs an operation and returns a value. \nl.-\nI\\ \n\\I \n• \nTo code a function, code the function name followed by a set of parentheses. Within \nthe parentheses, code any parameters, or arguments, required by the function. If a \nfunction requires two or more arguments, separate them with commas. \n• \nTo code a literal value for a string, enclose one or more characters within single \nquotes ( ' ) or double quotes ( \" ). \n• \nTo include a single quote within a literal value for a string, code two single quotes. \nOr, use double quotes instead of single quotes to start and end the literal value. \n• \nTo join, or concatenate, two or more string columns or literal values, use the \nCONCAT function. \nHow to use the CONCAT function to join strings\n\nSection 1 \nAn introduction to MySQL \nHow to use functions with strings, dates, \nand numbers \nfunctio11 operates on strings, the DATE_FORMAT function operates on dates, \nand the ROUND function operates on numbers. For now, don't worry about the \ndetails of how the functions shown here work, because you'll learn more about \nall of these functions in chapter 9. Instead, just focus on how they're used in \ncolumn specifications. \nThe first example in this figure shows how to use the LEFT function to \nextract the first character of the vendor_contact_frrst_name and \nvendor_contact_last_name columns. The frrst parameter of this function speci-\nfies the string value, and the second parameter specifies the number of charac-\nters to return. Then, this statement concatenates the results of the two LEFT \nfunctions to form initials as shown in the result set. \nThe second example shows how to use the DATE_FORMAT function \nto change the format used to display date values. This function requires two \nparameters. The first parameter is the date value to be formatted and the second \nis a format string that uses specific values as placeholders for the various parts \nof the date. The first column in this example renrrns the invoice_date column in \nthe default MySQL date format, ''yyyy-mm-dd''. Since this format isn't used as \noften in the USA, the second column is formatted in the more typical \n''mm/dd/yy'' format. In the third column, the invoice date is in another format \nthat's commonly used. In chapter 9, you'll leait1 1nore about specifying the \nformat string for the DATE_FORMAT function. \nThe third example uses the ROUND function to round the value of the \ninvoice total column to the nearest dollai· and nearest dime. This function can \naccept eitl1er one or two parameters. The first parameter specifies the number to \nbe rounded and the optional second parameter specifies the number of decimal \nplaces to keep. If the second parameter is omitted, the function rounds to the \nnearest integer.\n\nChapter 3 \nHow to retrieve datafrom a single table \nThe syntax of the LEFT, DATE_FORMAT, and ROUND functions \nLEFT(string, number_of_characters) \nDATE_ FORMAT (date, format_string) \nROUND(number[, number_of_decimal_places]) \nA SELECT statement that uses the LEFT function \nSELECT vendor_ contact_ first_name, vendor_contact_ last_ name, \nCONCAT(LEFT(vendor_ contact_first_ namA, 1 ) , \nLEFT (vendor_ contact_ last_ namA, 1)) AS initials \nFROM vendors \nvendor _contact_first_name \nvendor contact last name \ninitials \n- -\n► \nFrancesco \nAlberto \nFA \nI Ania \nIrvin \nAI \nLukas \nLiana \nLL \n(122 rows ) \nA SELECT statement that uses the DATE FORMAT function \nSELECT invoice_date, \nDATE_ FORMAT(invoice_date, •~oro/%d /%y') AS 'MM/ DD/YY', \nDATE_ FORMAT{invoice_date, ' %e-%b-%Y') AS 'DD-Mon-YYYY' \nFROM invoices \nORDER BY invoice_date \ninvoice_date \n~ \n2018-04-08 \n2018-04-10 \nI 20 18-04-13 \n(114 rows) \nMM/00/'(Y \n04/08/18 \n04/10/18 \n04/ 13/18 \nDD-Mon-YYYY \n8-Apr-2018 \n10--Apr-2018 \n13-Apr-2018 \nA SELECT statement that uses the ROUND function \nSELECT invoice_date, invoice_total, \nROUND(invoice_ total) AS nearest_dollar, \nROUND (invoice_ total, 1) AS nearest_dime \nFROM invoices \nORDER BY invoice date \nI invoice_date \ninvoice _total \nnearest_dollar \nnearest_dime \n► \n2018--04-08 \n3813.33 \n3813.3 \n2018-04-10 \n40.20 \n40.2 \n2018-04-13 \n138.75 \n138.8 \n( 114 rows ) \nDescription \n• \nWhen using the DATE_FORMAT function to specify the format of a date, you use \nthe percent sign (%) to identify a format code. For example, a format code of m \nreturns the month number with a leading zero if necessary. For more information \nabout these codes, see chapter 9. \n• \nFor more information about using functions, see chapter 9. \nHow to use functions with strings, dates, and numbers \nI\\ \n'--\nV\n\nSection 1 \nAn introduction to MySQL \nHow to test expressions by coding statements \nwithout FROM clauses \nWhen you use MySQL, you don't have to code FROM clat1ses in SELECT \nstatements. This makes it easy for you to code SELECT statements that test \nexpressions and functions like those that you've seen in this chapter. Instead of \ncoding column specifications in the SELECT clause, you use literals or functions \nto supply the test values you need. And you code column aliases to display \nthe results. Then, once you're sure that the code works as you intend it to, you \ncan add the FROM clause and replace the literals or functions with the correct \ncolumn specifications. \nan arithmetic expression using numeric literals that make it easy to verify the \nresults. The remaining examples test the functions that you saw in figure 3-7. If \nyou compare these statements, you'll see that the second and fourth examples \nsimply replace the column specifications in figure 3-7 with literal values. The \nthird example uses another function, CURRENT_DATE, to supply a date value \nin place of the invoice_date column that's coded in figure 3-7.\n\nChapter 3 \nHow to retrieve datafrom a single table \nFour SELECT statements without FROM clauses \nExample 1 : Testing a calculation \nSELECT 1000 * (1 + .1) AS \n1110% More Than 1000\" \n10°/4 More Than 1000 \n---I \n--\n► \n1100.0 \n\"'-~------;;;==========------;================~!' \nExample 2: Testing the CON CAT function \nSELECT \"Ed\" AS first_name, \"Williams\" AS last_ name, \nCONCAT(LEFT(\"Ed\", 1), LEFT(\"Williams\", 1)) AS initials \nI first_name \nlast_name \ninitials \n~ \nEd \nWllliams \nE\\ft/ \nExample 3: Testing the DATE_FORMAT function \nSELECT CURRENT_DATE, \nDATE_ FORMAT(CURRENT_ DATE, •~orn/%d/%y') AS 'MM/DD/YY', \nDATE_ FORMAT(CURRENT_ DATE, \n1 %e-~ob-%Y 1 ) \nAS 'DD-Mon-YYYY' \nI CURRENT _DATE \nMM/DO/YY \nDD+ion-YYYY \n► \n2018-11-06 \n11/06/18 \n6-Nov-2018 \nExample 4: Testing the ROUND function \nSELECT 12345.6789 AS value, \nROUND(12345.6789) AS nearest_dollar, \nROUND(12345.6789, 1) AS nearest_ dime \nI value \nnearest_dollar \nnearest_dime \n► \n12345.6789 \n12345.7 \nDescription \n• \nWith MySQL, you don't have to code a FROM clause. This makes it easy to test \nexpressions that include arithmetic operators and functions. \n• \nThe CURRENT _DATE function returns the current date. The parentheses are \noptional for this function. \nHow to test expressions \nI\n\nSection 1 \nAn introduction to MySQL \nHow to eliminate duplicate rows \nBy default, all of the rows in the base table that satisfy the search condition \nin the WHERE clause are included in the result set. In some cases, though, that \nmeans that the result set will contain duplicate rows, or rows whose column \nvalues are identical. If that's not what you want, you can include the DISTINCT \nkeyword in the SELECT clause to eliminate the duplicate rows. \nthe vendor_city and vendor_state columns from the Vendors table. The frrst \nstatement doesn't include the DISTINCT keyword. Because of that, the same \ncity and state can appear in the result set more than once. In the results shown \nin this figure, for example, you can see that Anaheim CA occurs twice and \nBoston MA occurs three times. In contrast, the second statement includes the \nDISTINCT keyword, so each city and state combination is included only once.\n\nChapter 3 \nHow to retrieve data from a single table \nA SELECT statement that returns all rows \nSELECT vendor_ city, vendor_ state \nFROM vendors \nORDER BY vendor_city \n~ \nvendor _city \nvendor _state \n► \nAnaheim \nCA \nAnaheim \nCA \nAnn Arbor \nMI \nI Auburn Hils \nMl \nBoston \nMA \njBoston \nMA \nMA \n1Boston \n(122 rows) \nA SELECT statement that eliminates duplicate rows \nSELECT DISTINCT vendor_city, vendor_ state \nFROM vendors \nORDER BY vendor_city \n_J vendor _city \nvendor _state \n► \nAnaheim \nCA \nI Ann Arbor \nMl \nAuburn Hils \nMI \n1Bostcn \nMA \nBrea \nCA \n, Carol Stream \nIL \nI Charlotte \nNC \n(53 rows ) \nDescription \n• \nThe DISTINCT keyword prevents duplicate (identical) rows from being included in \nthe result set. DISTINCTROW is a synonym for DISTINCT. \n• \nThe ALL keyword causes all rows matching the search condition to be included in \nthe result set, regardless of whether rows are duplicated. Since this is the defat1lt, \nyou'll usually omit the ALL keyword. \n• \nTo use the DISTINCT or ALL keyword, code it immediately after the SELECT \nkeyword as shown above. \nHow to eliminate duplicate rows\n\nSection 1 \nAn introduction to MySQL \nHow to code the WHERE clause \nEarlier in this chapter, I mentioned that to improve performance, you should \ncode your SELECT statements so they retrieve o.nly the columns you need. That \ngoes for retrieving rows too: The fewer rows you retrieve, the more efficient the \nstatement will be. Because of that, yot1 typically include a WHERE clat1se on \nyour SELECT statements with a search condition that filters the 1·ows in the base \ntable so only the rows you need are retrieved. In the topics that follow, you '11 \nlearn a variety of ways to code this clause. \nHow to use the comparison operators \ncondition of a WHERE clause to compare two expressions. If the result of the \ncomparison is true, the row being tested is included in the query results. \nThe examples in this figure show how to use the comparison operators. The \nfirst WHERE clause, for example, uses the equal operator(=) to retrieve only \nthose rows whose vendor_state column has a value of 'IA' . Here, the state code \nis a string literal so it must be enclosed in single or double quotes. In contrast, \nthe second WHERE clause uses the greater than (>) operator to retrieve only \nthose rows that have a balance greater than zero. In this case, zero (0) is a \nnumeric literal so it isn't enclosed in quotes. \nThe third WHERE clause shows another way to retrieve all the invoices with \na balance due by rean·anging the comparison expression. Like the second clause, \nit uses the greater than operator. Instead of comparing the balance due to a valt1e \nof zero, however, it compares the invoice total to the total of the payments and \ncredits that have been applied to the invoice. \nThe fourth WHERE clause shows how you can use comparison operators \nother than equal wit11 string data. In this example, the less than operator (<)is \nused to compare the value of the vendor_name column to a literal string that \ncontains the letter M. That causes the query to return all vendors with names that \nbegin with the letters A through L. \nYou can also use the comparison operators with date literals, as shown by the \nfifth and sixth WHERE clauses. The fifth clause reti·ieves rows with invoice dates \non or before July 31, 2018, and the sixth clause retrieves rows with invoice dates \non 01· after July 1, 2018. Like literal values for strings, literal values for dates \nmust be enclosed in single or double quotes. Also, literal values for dates must \nuse this format: YYYY-MM-DD. This is the default date format used by MySQL. \nThe last two WHERE clauses show how you can test for a not-equal condi-\ntion. In both cases, only rows with a credit total that isn 't equal to zero are \n1·etrieved. \nWhenever possible, you should compare expressions that have similar data \ntypes. If you compare expressions that have different data types, MySQL implic-\nitly converts the data type for you. Generally, this implicit conversion is accept-\nable. However, implicit conversions can occasionally yield unexpected results. \nTo prevent this, you can explicitly convert the data type by using the CAST or \nCONVERT functions, which you'll learn about in chapter 8.",
          "pages": [
            104,
            105,
            106,
            107,
            108,
            109,
            110,
            111,
            112
          ],
          "relevance": {
            "score": 0.7,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "commonMistakes": {
          "text": "Chapter 3 \nHow to retrieve datafrom a single table \nThe syntax of the WHERE clause with comparison operators \nWHERE expression_ l operator expression_ 2 \nThe comparison operators \n= \nEqual \n< \nLess than \n> \nGreater than \n< = \nLess than or equal to \n> = \nGreater than or equal to \n<> \nNot equal \n! = \nNot equal \nExamples of WHERE clauses that retrieve ... \nVendors located in Iowa \nWHERE vendor_ state = 'IA' \nInvoices with a balance due (two variations) \nWHERE invoice_total -\npayment_ total - credit_ total > 0 \nWHERE invoice_ total > payment_total + credit total \nVendors with names from A to L \nWHERE vendor_name < 'M' \nInvoices on or before a specified date \nWHERE invoice date <= '2018-07-31' \nInvoices on or after a specified date \nWHERE invoice_date >= '2018-07-01' \nInvoices with credits that don't equal zero (two variations) \nWHERE credit_ total <> 0 \nWHERE credit_ total != 0 \nDescription \n• \nYou can use a comparison operator to compare any two expressions. Since MySQL \nautomatically converts the data for comparison, the expressions may be of unlike \ndata types. However, the comparison may sometimes produce unexpected results. \n• If the result of a compaiison is a true value, the row being tested is included in the \nresult set. If it's a false or null value, the row isn't included. \n• \nTo use a string literal or a date literal in a comparison, enclose it in quotes. To use a \nnumeric literal, enter the number without quotes. \n• \nCharacter comparisons perforrr1ed on MySQL databases are not case-sensitive. So, \nfor example, 'CA' and 'ca' are considered equivalent. \n• \nIf you compare a null value using one of these comparison operators, the result is \nalways a null value. To test for null values, use the IS NULL clause presented in \nHow to use the comparison operators\n\nSection 1 \nAn introduction to MySQL \nHow to use the AND, OR, \nand NOT logical operators \ncan use the AND and OR operators to combine two or more search conditions \ninto a compound conditiori. And you can use the NOT operator to negate a \nsearch condition. The examples in this figure show how these operators work. \nThe first two examples show the AND and OR operators. When you use \nthe AND operator, both conditions must be true. So, in the first example, only \nthose vendors in the state of New Jersey and the city of Springfield are retrieved \nfrom the Vendors table. When you use the OR operator, though, only 011e of the \nconditions must be true. So, in the second example, all the vendors in the state of \nNew Jersey and all the vendors in the city of Pittsburg (no matter what state) are \nretrieved. \nThe third example shows how to use the NOT operator to negate a condi-\ntion. Here, vendors that are not in the state of California are returned. The fourth \nexample shows a compound condition that uses two NOT operators. This condi-\ntion is difficult to understand. To make it easier to understand, you can rewrite \nthis condition to remove the NOT operators as shown in the fifth example. \nThe last two examples in this figure show how the order of precedence for \nthe logical operators and the use of parentheses affect the result of a search \ncondition. By default, the NOT operator is evaluated first, followed by AND, \nand then by OR. However, you can use parentheses to override the order of \nprecedence or to clarify a logical expression, just as you can with aritlunetic \n• \nexpressions. \nIn the next to last example, for instance, no parentheses are used, so the \ntwo conditions connected by the AND operator are evaluated first. In the last \nexample, though, parentheses are used so the two conditions connected by the \nOR operator are evaluated first. If you take a minute to review the results in this \nfigure, you should quickly see how these two conditions differ.\n\nChapter 3 \nHow to retrieve datafrom a single table \nThe syntax of the WHERE clause with logical operators \nWHERE [NOT] search_condition_ l \n{ANDIOR} [NOT] search_ condition_ 2 \nExamples of WHERE clauses that use logical operators \nThe AND operator \nWHERE vendor_state = 'NJ' AND vendor_city = 'Springfield' \nThe OR operator \nWHERE vendor_state = 'NJ' OR vendor_city = 'Pittsburg' \nThe NOT operator \nWHERE NOT vendor_state = 'CA' \nThe NOT operator in a complex search condition \n• • • \nWHERE NOT {invoice_ total >= 5000 OR NOT invoice_date <= '2018-08-01') \nThe same condition rephrased to eliminate the NOT operator \nWHERE invoice_ total < 5000 AND invoice_date <= '2018-08-01' \nA compound condition without parentheses \nWHERE invoice_date > '2018-07-03' OR invoice_total > 500 \nAND invoice_ total -\npayment_total - credit_ total > O \ninvoice_number \ninvoice_date \ninvoice_total \nbalance_due \n-\n► \n203339-13 \n2018-07-05 \n17.50 \n0.00 \n111-92R-10093 \n2018-07-06 \n39.n \n0,00 \n2018-07-06 \n111.00 \n0.00 \n{33 rows ) \nThe same compound condition with parentheses \nWHERE (invoice_date > '2018-07-03' OR invoice_ total > 500) \nAND invoice_ total - payment_total - credit_total > 0 \n~ \ninvoice-:..number \ninvoice_date \ninvoice_total \nbalance_due \n2018~7-10 \n85.31 \n85.31 \n► \n2018-07-18 \n52.25 \n52.25 \n2018-07-21 \n579.42 \n579.42 \n{11 rows) \nDescription \n• \nYou can use the AND and OR logical operators to create compound conditions that \nconsist of two or more conditions. You use the AND operator to specify that the \nsearch must satisfy both of the conditions, and you use the OR operator to specify \nthat the search must satisfy at least one of the conditions. \n• \nYou can use the NOT operator to negate a condition. Because this can make the \nsearch condition unclear, you should rephrase the condition if possible so it doesn't \nuse NOT. \n• \nWhen MySQL evaluates a compound condition, it evaluates the operators in this \nsequence: (1) NOT, (2) AND, and (3) OR. You can use parentheses to override this \norder of precedence or to clarify the sequence in which the operations are evaluated. \nHow to use the AND, OR, and NOT logical operators",
          "pages": [
            113,
            114,
            115
          ],
          "relevance": {
            "score": 0.8,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.0,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        }
      },
      "educational_notes": {
        "definition": "The ORDER BY clause is used to sort the results of a query in ascending or descending order based on one or more columns.",
        "explanation": "The ORDER BY clause is essential for organizing data in a meaningful way after retrieving it from a database. It allows you to control the sequence in which rows are displayed, making it easier to analyze and understand the data. By default, ORDER BY sorts data in ascending order (A-Z, 0-9). However, you can specify descending order by using the DESC keyword.",
        "key_points": [
          "Key point 1: The ORDER BY clause is used for sorting query results.",
          "Key point 2: It can sort based on one or more columns.",
          "Key point 3: Use ASC for ascending order (default) and DESC for descending order.",
          "Key point 4: Always include the column names in the ORDER BY clause to avoid ambiguity.",
          "Key point 5: ORDER BY should be placed at the end of a SELECT statement."
        ],
        "examples": [
          {
            "title": "Basic Usage",
            "code": "SELECT invoice_number, invoice_date FROM invoices ORDER BY invoice_date;",
            "explanation": "This example sorts all invoices by their date in ascending order. The result will show the oldest invoices first."
          },
          {
            "title": "Practical Example",
            "code": "SELECT product_name, price FROM products ORDER BY price DESC LIMIT 5;",
            "explanation": "This practical example retrieves the top 5 most expensive products by sorting them in descending order based on their prices. This helps quickly identify the highest-priced items."
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Forgetting to specify column names",
            "incorrect_code": "SELECT invoice_number, invoice_date FROM invoices ORDER BY;",
            "correct_code": "SELECT invoice_number, invoice_date FROM invoices ORDER BY invoice_date;",
            "explanation": "This mistake occurs when the ORDER BY clause is used without specifying any columns. It results in an error because MySQL doesn't know what to sort by."
          },
          {
            "mistake": "Using DESC for ascending order",
            "incorrect_code": "SELECT product_name, price FROM products ORDER BY price DESC;",
            "correct_code": "SELECT product_name, price FROM products ORDER BY price ASC;",
            "explanation": "This mistake happens when the DESC keyword is used instead of ASC to sort in ascending order. It results in the data being sorted in descending order."
          }
        ],
        "practice": {
          "question": "Write a SQL query that retrieves all employees from the 'employees' table, sorted by their hire date in descending order.",
          "solution": "SELECT employee_name, hire_date FROM employees ORDER BY hire_date DESC;"
        }
      },
      "llm_enhanced": true,
      "raw_text_preview": "Chapter 3 \nHow to retrieve datafrom a single table \nA SELECT statement that renames the columns in the result set \nSELECT invoice_number AS \"Invoice Number\", invoice_date AS Date, \ninvoice total AS To",
      "content_relevance": {
        "score": 0.6,
        "sql_score": 1.0,
        "concept_score": 1.0,
        "non_sql_penalty": 0.2,
        "is_relevant": true,
        "analysis": "SQL content"
      }
    },
    "joins-murach": {
      "id": "joins-murach",
      "title": "Joining Tables",
      "definition": "Inner joins, outer joins, and cross joins in MySQL",
      "difficulty": "intermediate",
      "page_references": [
        117,
        118,
        119,
        120,
        121,
        122,
        123,
        124,
        125,
        126,
        127,
        128,
        129,
        130,
        131,
        132,
        133,
        134,
        135,
        136,
        137,
        138,
        139,
        140,
        141,
        142
      ],
      "sections": {
        "definition": {
          "text": "Chapter 3 \nHow to retrieve data from a sin.gle table \nThe syntax of the WHERE clause with an IN phrase \nWHERE test_expression [NOT] IN \n({subquerylexpression_ l [, expression_2 ] ... }) \nExamples of the IN phrase \nAn IN phrase with a list of numeric literals \nWHERE terms_ id IN (1, 3, 4) \nAn IN phrase preceded by NOT \nWHERE vendor_ state NOT IN ('CA', 'NV', 'OR') \nAn IN phrase with a subquery \nWHERE vendor id IN \n(SELECT vendor id \nFROM invoices \nWHERE invoice_date = \n1 2018-07-18 1\n) \nDescription \n• \nYou can use the IN phrase to test whether an expression is equal to a value in a list \nof expressions. Each of the expressions in the list is automatically converted to the \nsame type of data as the test expression. \n• \nThe list of expressions can be coded in any order without affecting the order of the \nrows in the result set. \n• \nYou can use the NOT operator to test for an expression that's not in the list of \n• \nexpressions. \n• \nYou can also compare the test expression to the items in a list returned by a \nsubquery. You'll learn more about coding subqueries in chapter 7. \nHow to use the IN operator\n\nSection 1 \nAn introduction to MySQL \nHow to use the BETWEEN operator \nWhen you use this operator, the value of a test expression is compared to the \nrange of values specified in the BETWEEN phrase. If the value falls within this \nrange, the row is included in the query results. \nThe first example in this figure shows a simple WHERE clause that uses the \nBETWEEN operator. It retrieves invoices with invoice dates between June 1, \n2018 and June 30, 2018. Note that the range is inclusive, so invoices with invoice \ndates of June 1 and June 30 are included in the results. \nThe second example shows how to use the NOT operator to select rows \nthat aren't within a given range. In this case, vendors with zip codes that aren't \nbetween 93600 and 93799 are included in the results. \nThe third example shows bow you can use a calculated value in the test \nexpression. Here, the payment_total and credit_total columns are subtracted \nfrom the invoice_total column to give the balance due. Then, this value is \ncompared to the range specified in the BETWEEN pln·ase. \nThe last example shows how you can use calculated values in the \nBETWEEN phrase. Here, the frrst value is the credit_total column and the \nsecond value is the credit_total column plus 500. So the results include all those \ninvoices where the amount paid is between the credit amount and $500 more \nthan the credit amount.\n\nChapter 3 \nHow to retrieve datafrom a sin.gle table \nThe syntax of the WHERE clause with a BETWEEN phrase \nWHERE test_expression [NOT] BETWEEN begin_ expression AND end_ expression \nExamples of the BETWEEN phrase \nA BETWEEN phrase with literal values \nWHERE invoice_date BETWEEN '2018-06-01' AND '2018-06-30' \nA BETWEEN phrase preceded by NOT \nWHERE vendor_ zip_ code NOT BETWEEN 93600 AND 93799 \nA BETWEEN phrase with a test expression coded as a calculated value \nWHERE invoice_total -\npayment_total - credit_total BETWEEN 200 AND 500 \nA BETWEEN phrase with the upper and lower limits \ncoded as calculated values \nWHERE payment_ total BETWEEN credit_total AND credit_total + 500 \nDescription \n• \nYou can use the BETWEEN phrase to test whether an expression falls within a \nrange of values. The lower limit must be coded as the frrst expression, and the \nupper limit must be coded as the second expression. Otherwise, MySQL returns an \nempty result set. \n• \nThe two expressions used in the BETWEEN phrase for the range of values are \ninclusive. That is, the result set includes values that are equal to the upper or lower \nlimit. \n• \nYou can use the NOT operator to test for an expression that's not within the given \nrange. \nHow to use the BETWEEN operator\n\nSection 1 \nAn introduction to MySQL \nHow to use the LIKE and REGEXP operators \nTo retrieve rows that match a specific string pattern, or mask, you can use \nthe LIKE or REGEXP operators as shown in figure 3-14. The LIKE operator is \nan older operator that lets you search for simple string patterns. When you use \nthis operator, the mask can contain one or both of the wildcard symbols shown \nin the first table in this figure. \nIn contrast to the LIKE operator, the REGEXP operator allows you to create \ncomplex string patterns known as regular expressions. To do that, you can use \nthe special characters and constructs shown in the second table in this figure. \nAlthough creating regular expressions can be tricky at frrst, they allow you to \nsearch for virtually any string pattern. \nIn the first example in this figure, the LIKE phrase specifies that all vendors \nin cities that start with the letters SAN should be included in the query results. \nHere, the percent sign (%) indicates that any character or characters can follow \nthese three letters. So San Diego and Santa Ana are both included in the results. \nThe second example selects all vendors whose vendor name starts with the \nletters COMPU, followed by any one character, the letters ER, and any charac-\nters after that. The vendor names Compuserve and Computerworld both match \nthat pattern. \nIn the third example, the REGEXP phrase searches for the letters SA within \nthe vendor_city column. Since the letters can be in any position within the string, \nboth Pasadena and Santa Ana are included in the results. \nThe next two examples demonstrate how to use REGEXP to match a pattern \nto the beginning or end of the string being tested. In the fourth example, the \n1nask /\\SA matches the letters SA at the beginning of vendor_city, as in Santa \nAna and Sacramento. In contrast, the mask NA$ matches the letters NA at the \nend of vendor_city, as shown in the fifth example. \nThe sixth example uses the pipe ( I ) character to search fo1· either of two \nstring patterns: RS or SN. In this case, the first pattern would match Traverse \nCity and the second would match Fresno, so both are included in the result set. \nThe last four examples use brackets to specify multiple values. In the \nseventh example, the vendor_state column is searched for values that contain \nthe letter N followed by either C or V. That excludes NJ and NY. In contrast, the \neighth example searches for states that contain the letter N followed by any letter \nfrom A to J. Trus excludes NV and NY. \nThe ninth example searches the values in the vendor_contact_last_name \ncolumn for a name that can be spelled two different ways: Damien or Damion. \nTo do that, the mask specifies the two possible characters in the fifth position, E \nand 0 , within brackets. In the final example, the REGEXP phrase searches for a \nvendor_city that ends with any letter, a vowel, and then the letter N. \nBoth the LIKE and REGEXP operators provide powerful functionality for \nfinding information in a database. However, searches that use these operators \nsometimes run slowly since they can't use a table's indexes. As a result, you \nshould only use these operators when necessary.\n\nChapter 3 \nHow to retrieve data from a sin.gle table \nThe syntax of the WHERE clause with a LIKE phrase \nWHERE match_expression [NOT] LIKE pattern \nThe syntax of the WHERE clause with a REGEXP phrase \nWHERE match_expression [NOT] REGEXP pattern \nLIKE wildcards \nSymbol \nDescription \n~ \nMatches any string of zero or more characters. \nMatches any single character. \nREGEXP special characters and constructs \nCharacter/Construct \nDescription \nA \n$ \n• \nMatches the pattern to the beginning of the value being tested. \nMatches the pattern to the end of tl1e value being tested. \nMatches any single character . \n[charlist] \n[charl-char2] \nMatches any single character listed within the brackets. \nMatches any single character within the given range. \nSeparates two string patterns and matches either one. \nWHERE clauses that use the LIKE and REGEXP operators \nExample \nResults that match the mask \nWHERE vendor_city LIKE 'SAN%' \nWHERE vendor_nam~ LIKE \n1 COMPU_ER%1 \nWHERE vendor_city REGEXP \n1 SA 1 \nWHERE vendor_city REGEXP ,,.SA' \nWHERE vendor_ city REGEXP 'NA$' \nWHERE vendor_city REGEXP 'RSISN' \nWHERE vendor state REGEXP 'N[CV] 1 \nWHERE vendor_state REGEXP 'N[A-J] I \nWHERE vendor_contact_ last_ name REGEXP 'DAMI[EO]N' \nWHERE vendor_city REGEXP '[A-Z] [AEIOU]N$' \nDescription \n\"San Dieoo\" \"Santa Ana\" \nt, \n, \n\"Compus!rr,ve\", \"Comput~world\" \n\"Pasadena\" \"Santa Ana\" \n' -\n\"Sa.11ta Ana'', \"Sacramento\" \n\"Gardena\" \"Pasadena\" \"Santa Ana\" \n' \n' \n\"Trave!],e City\", \"Frefil}o\" \n\"NC\" and \"NV\" but not \"NJ\" or \"NY\" \n\"NC\" and \"NJ\" but not \"NV\" or \"NY\" \n\"Damien'' and \"Damion\" \n\"Boston\" \"Mclean\" \"Oberlin\" \n=\n• \n=\n• \n• \nYou use the LIKE and REGEXP operators to retrieve rows that match a string pattern, \ncalled a mask. The mask determines which values in the column satisfy the condition. \n• \nThe mask for a LIKE phrase can contain special symbols, called wildcards. The mask \nfor a REGEXP phrase can contain special characters and constructs. Masks aren't \ncase-sensitive. \n• \nIf you use the NOT keyword, only those 1·ows with values that don't match the string \npattern are included in the result set. \n• \nMost LIKE and REGEXP phrases significantly degrade performance compared to \nother types of searches, so use the1n only when necessary. \nHow to use the LIKE and REGEXP operators\n\nSection 1 \nAn introduction to MySQL \nFor the sake of brevity, this chapter only presents the most common symbols \nthat are used in regular expressions. However, MySQL supports most of the \nsymbols that ru:e standard for creating regular expressions. Fo1· more information \nabout creating regular expressions, please consult the online MySQL Reference \nManual. If you 're familiar with using regular expressions in other programming \nlanguages such as PHP, you'll fmd that they work similarly in MySQL. \nIn addition to the REGEXP operator, MySQL 8.0 provides some new \nfunctions that work with regular expressions. You'll learn about these functions \nin chapter 9 when you learn about some other functions for working with strings. \nHow to use the IS NULL clause \nIn chapter 1, you learned that a column can contain a null value. A null value \nis typically used to indicate that a value is not known. A null value is not the \nsame as an empty string (' '). An empty st1·ing is typically used to indicate that \nthe value is known, and it doesn't exist. \nIf you're working with a database that allows null values, you need to know \nhow to test for them in search conditions. To do that, you use the IS NULL \nclause as shown in figm·e 3-15. \nThis figure uses a table named Null_Sample to show how to search for \nnull values. This table contains two columns: invoice id and invoice total. The \n-\nvalues in this table are displayed in the first example. \nThe second example shows what happens when you retrieve all the rows \nwith invoice_total equal to zero. In this case, the row that has a null value isn't \nincluded in the resttlt set. As the third example shows, this row isn't included in \nthe result set when invoice_total isn't equal to zero either. Instead, you have to \nuse the IS NULL clause to retrieve rows with null values, as shown by the fourth \nexample. \nYou can also use the NOT operator with the IS NULL clause, as shown by \nthe last example. When you use this operator, all of the rows that don't contain \nnull values are included in the query results.",
          "pages": [
            117,
            118,
            119,
            120,
            121,
            122
          ],
          "relevance": {
            "score": 0.31,
            "sql_score": 1.0,
            "concept_score": 0.22,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "examples": {
          "text": "Chapter 3 \nHow to retrieve data f rom a sin.gle table \nThe syntax of the WHERE clause with the IS NULL clause \nWHERE expression IS [NOT] NULL \nThe contents of the Null_Sample table \nSELECT * FROM null_ sample \ninvoice_id \n► \ninvoice_total \n125.00 \n0.00 \n2199.99 \n0.00 \nA SELECT statement that retrieves rows with zero values \nSELECT* FROM null_ sample \nWHERE invoice_ total = 0 \ninvoice_id \n► \ns \ninvoice total \n0.00 \n0.00 \nA SELECT statement that retrieves rows with non-zero values \nSELECT* FROM null_ sample \nWHERE invoice_ total <> O \ninvoice id \ninvoice total \n-\n► \n125.00 \n2199.99 \nA SELECT statement that retrieves rows with null values \nSELECT* FROM null_ sample \nWHERE invoic e _ t otal IS NULL \ninvoice id \ninvoice_total \n► \nIUIJII \nA SELECT statement that retrieves rows without null values \nSELECT* \nFROM null_ sample \nWHERE invoice_ total IS NOT NULL \ninvoice_id \ninvoice_total \n► I i \n125.00 \n0.00 \n2199.99 \n0.00 \nDescription \n• \nA null value represents a value that's unknown, unavailable, or not applicable. It \nisn't the same as a zero or an empty string(\"). \nHow to use the IS NULL clause \nI \nV\n\nSection 1 \nAn introduction to MySQL \nHow to code the ORDER BY clause \nThe ORDER BY clause specifies the sort order for the rows in a 1·esult set. \nIn most cases, you '11 use column names from the base table to specify the sort \norder as you saw in some of the examples earlier in this chapter. However, you \ncan also use other techniques to sort the rows in a result set, as described in the \ntopics that follow. \nHow to sort by a column name \nsyntax shows that you can sort by one or more expressions in either ascending \nor descending sequence. The three examples in this figure show how to code this \nclause for expressions that involve column names. \nThe first two examples show how to sort the rows in a result set by a \nsingle column. In the frrst example, the rows in the Vendors table are sorted in \nascending sequence by the vendor_name column. Since ascending is the default \nsequence, the ASC keyword can be omitted. In the second example, the rows are \nsorted by the vendor_name column in descending sequence. \nTo sort by more than one column, you simply list the names in the ORDER \nBY clause separated by commas as shown in the third example. This can be \nreferred to as a nested sort because one sort is nested within another. Here, \nthe rows in the Vendors table are first sorted by the vendor_state column in \nascending sequence. Then, within each state, the rows are sorted by the \nvendor_city column in ascending sequence. Finally, within each city, the rows \nare sorted by the vendor_name column in ascending sequence.\n\nChapter 3 \nHow to retrieve data from a sin.gle table \nThe expanded syntax of the ORDER BY clause \nORDER BY expression [ASCIDESC] [, expression [ASCIDESC]] ••. \nAn ORDER BY clause that sorts by one column in ascending sequence \nSELECT vendor_name, \nCONCAT(vendor_city, ', ', vendor_ state, ' ', vendor_ zip_ code) AS address \nFROM vendors \nORDER BY vendor_name \n..-------------------------------------, \nI vendor _name \naddress \n~ \n----, \n► \nAbbey Office Furnishings \nFresno, CA 93722 \nAmencan Booksellers Assoc \nTarryto1A'rl, NY 10591 \nAmerican Express \nLos Angeles, CA 90096 \nASC Signs \nFresno, CA 93703 \nAn ORDER BY clause that sorts by one column in descending sequence \nSELECT vendor_name, \nCONCAT(vendor_city, ', •, vendor_ state, ' •, vendor_ zip_code) AS address \nFROM vendors \nORDER BY vendor_name DESC \nJ vendor _name \naddress \n► I Zylka Design \nFresno, CA 93711 \nZlp Print &. Copy Center \nFresno, CA 93777 \nZee Medical Service Co \nWashington, IA 52353 \nYesmed, Inc \nFresno, CA 93718 \nAn ORDER BY clause that sorts by three columns \nSELECT vendor_name, \nCONCAT(vendor_city, ', •, vendor_ state, ' ', vendor_ zip_code) AS address \nFROM vendors \nORDER BY vendor_ state, vendor_city, vendor_name \nvendor _name \naddress \n► \nAT&T \nPhoenix, AZ 85062 \nComputer Library \nPhoenix, AZ 85023 \nWells Fargo Bank \nPhoenix, AZ 85038 \nAztek Labe.l \nAnaheim, CA 92807 \nDescription \n• \nThe ORDER BY clause specifies how you want the rows in the result set sorted. \nYou can sort by one or more columns, and you can sort each column in either \nascending (ASC) or descending (DESC) sequence. ASC is the default. \n• \nBy default, in an ascending sort, special characters appear frrst in the sort \nsequence, followed by numbers, then letters. Thls sort order is determined by the \ncharacter set used by the server, wbjch you can change when you start the server. \n• \nNull values appear frrst in the sort sequence, even if you 're using DESC. \n• \nYou can sort by any column in the base table regardless of whether it's included \nin the SELECT clause. \nHow to sort by a column name \nA \n1--\n\"\"\n\nSection 1 \nAn introduction to MySQL \nHow to sort by an alias, expression, \nor column number \ncolumns. FiI·st, you can use a column alias that's defined in the SELECT clause. \nThe first SELECT statement in this figure, for example, sorts by a column \nnamed Address, which is an alias for the concatenation of the vendor_city, \nvendor_state, and vendor_zip_code columns. Notice that within the Address \ncolumn, the result set is also sorted by the vendor_name column. \nYou can also use an arithmetic or string expression in the ORDER BY \nclause, as shown by the second example in this figure. Here, the expression \nconsists of the vendor_contact_last_name column concatenated with the \nvendor_contact_first_name column. Notice that neither of these columns is \nincluded in the SELECT clause. Although MySQL allows this coding technique, \nmany other SQL dialects don't. \nThe last example in this figure shows how you can use column numbers to \nspecify a sort order. To use this technique, you code the number that corresponds \nto the column of the result set, where 1 is the first column, 2 is the second \ncolumn, and so on. In this example, the ORDER BY clause sorts the result set \nby the second column, which contains the concatenated address, then by the first \ncolumn, which contains the vendor name. As a result, this statement returns the \nsame result set that's returned by the first statement. \nHowever, the statement that uses column numbers is more difficult to \nread because you have to look at the SELECT clause to see what columns the \nnumbers refer to. In addition, if you add or remove columns from the SELECT \nclause, you may also have to change the ORDER BY clause to reflect the new \ncolumn positions. As a result, you should avoid using this technique in most \nsituations.\n\nChapter 3 \nHow to retrieve data from a sin.gle table \nAn ORDER BY clause that uses an alias \nSELECT vendor_name, \nCONCAT(vendor_city, ', ', vendor_ state, \nFROM vendors \nORDER BY address, vendor_name \nvendor _name \n► \nAztek Label \nBlue Shield of Califomla \nMalloy Lithographing Inc \nData Reproductions Corp \naddress \nAnaheim, CA 92807 \nAnaheim, CA 92850 \nAnn Arbor, MI 48106 \nAuburn Hills, MI 48326 \n• •, vendor_ zip_ code} AS address \nAn ORDER BY clause that uses an expression \nSELECT vendor_name, \nCONCAT(vendor_city, ', •, vendor_ state, \nFROM vendors \nORDER BY CONCAT(vendor_contact_last_name, \nvendor _name \n► \nDristas Groom & McCormick \nInternal Revenue Service \nUS Postal Service \nYale Industrial Trucks-Fresno \naddress \nFresno, CA 93720 \nFresno, CA 93888 \nMadison, WI 53707 \nFresno, CA 93706 \n• •, vendor_ zip_code} AS address \nvendor contact first name} \n-\nAn ORDER BY clause that uses column positions \nSELECT vendor_ name, \nFROM vendors \nORDER BY 2, 1 \nvendor _name \naddress \n► \nArtek Label \nAnaheim, CA 92807 \nBlue Shield of California \nAnahevn, CA 92850 \nMalloy Lithographing Inc \nAnn Arbor, MI 48106 \nData Reproductions Corp \nAuburn Kills, MI 4832-6 \nDescription \n• \nThe ORDER BY clause can include a column alias that's specified in the SELECT \nclause if the column alias does not include spaces. \n• \nThe ORDER BY clause can include any valid expression. The expression can refer \nto any column in the base table, even if it isn't included in the result set. \n• \nThe ORDER BY clause can use numbers to specify the columns to use for sorting. \nIn that case, 1 represents the frrst column in the result set, 2 represents the second \ncolumn, and so on. \nHow to sort by an alias, expression, or column number\n\nSection 1 \nAn introduction to MySQL \nHow to code the LIMIT clause \nThe LIMIT clause specifies the maximum number of rows that are returned \nin the result set. For most queries, you want to see the entire result set so you \nwon't use this clause. However, there may be times when you want to retrieve \njust a subset of a larger result set. \ncan take one or two arguments as shown by the three examples in this figure. \nHow to limit the number of rows \nIn its simplest form, you code the LIMIT clause with a single numeric \nargument. Then, the number of rows in the result set is, at most, the number you \nspecify. But if the result set is smaller than the number you specify, the LIMIT \nclause has no effect. \nIn the first example, the SELECT state1nent includes the LIMIT 5 clause, so \nthe entire result set is five rows. Without the LIMIT clause, this statement would \nreturn 114 rows. Because the result set is sorted by invoice_total in descending \nsequence, this result set represents the five largest invoices. \nHow to return a range of rows \nIf you code the optional offset argument of the LIMIT clause, it represents \nan offset, or starting point for the result set. This offset starts from a value of 0, \nwhich refers to the first row in the result set. In the second example, then, the \noffset is 2 so the result set starts with the third invoice. Then, since the row count \nis 3, the result set contains just 3 rows. \nSimilarly, the third example bas an offset of 100, so the result set starts with \nrow 101. Note that the row count for the LIMIT clause in this example is 1000. \nSince the table contains only 114 rows, though, the result set contains just the \nlast 14 rows in the table.\n\nChapter 3 \nHow to retrieve data from a sin.gle table \nThe expanded syntax of the LIMIT clause \nLIMIT [offset,] row_count \nA SELECT statement with a LIMIT clause that starts with the first row \nSELECT vendor_ id, invoice_ total \nFROM invoices \nORDER BY invoice_total DESC \nLIMIT 5 \nvendorjd \ninvoice_ total \n► \n37966.19 \n26881 .40 \n23517.58 \n21842.00 \n20551. 18 \nSELECT invoice_ id, vendor_ id, invoice_ total \nFROM invoices \nORDER BY invoice_ id \nLIMIT 2, 3 \ninvoice id -\nvendor_id \ninvoice total \n-\n► \n138.75 \n144.70 \n15.50 \nSELECT invoice_ id, vendor_ id, invoice_total \nFROM invoices \nORDER BY invoice id \nLIMIT 100, 1000 \ninvoice id -\nvendor_id \ninvoice_total \n► \n30.75 \n20551.18 \n2051.59 \n44.44 \n(14 rows ) \nDescription \n• \nYou can use the LIMIT clause to limit the number of rows returned by the SELECT \nstatement. This clause takes one or two intege1· arguments. \n• \nIf you code a single argument, it specifies the maximum row count, beginning with \nthe first row. If you code both arguments, the offset specifies the first row to return, \nwhere the offset of the first row is 0. \n• If you want to retrieve all of the rows from a certain offset to the end of the result \nset, code -1 for the row count. \n• \nTypically, you'll use an ORDER BY clause whenever you use the LIMIT clause. \nHow to code the LIMIT clause \n'\n\nSection 1 \nAn introduction to MySQL \nPerspective \nThe goal of this chapter has been to teach you the basic skills for coding \nSELECT statements. As a result, you'll use these skills in almost every \nSELECT statement you code. \nAs you'll see in the next chapter and in chapters 6 and 7, though, there's \na lot more to coding SELECT statements than what's presented here. In these \nchapters, then, you'll learn additional skills for coding SELECT statements. \nWhen you complete these chapters, you' 11 know everything you need to know \nabout retrieving data from a MySQL database. \nTerms \nkeyword \nbase table \nsearch condition \nfilter \nBoolean expression \n• \nexpression \ncolumn alias \narithmetic expression \narithmetic operator \norder of precedence \nliteral value \nstring \nfunction \nargument \nExercises \nparameter \nconcatenate \ncomparison operator \nlogical operator \ncompound condition \nsubquery \nstring patten1 \nmask \nwildcard \nregular expression \nnull value \nnested sort \noffset \nRun some of the examples in this chapter \nIn these exercises, you '11 use MySQL Workbench to run some of the scripts for \nthe examples in this chapter. This assumes that you already know how to use \nMySQL Workbench, as described in chapter 2. \n1. \nStart MySQL Workbench. \n2. \nOpen the script named 3-02.sql that you should fmd in this directory: \nc:\\murach\\rnysql\\book_scripts\\ch03. When it opens, you should see all of the \nqueries for figure 3-2. Note that each of these queries has a semicolon at the \nend of it. \n3. \nMove the insertion point into the first query and press Ctrl+Enter or click on \nthe Exectite Current Statement button to run the query. This shows you the \ndata that's in the Invoices table that you'll be working with in this chapter. \n4. \nMove the insertion point into the second query and run it.\n\nChapter 3 \nHow to retrieve data from a sin.gle table \n5. \nOpen the script named 3-05.sql in the ch03 directory. Then, run the second \nquery. When you do, you '11 see that the 1·esult set is in sequence by the \ninvoice id column. \n6. \nDelete the ORDER BY clause from the SELECT statement and run the query \nagain. Scroll through the result set to see that the rows are no longer in a \nparticular sequence. When you 're done, close the script without saving the \nchanges. \n7. \nOpen and run the queries for any of the other examples in this chapter that \nyou're interested in reviewing. \nEnter and run your own SELECT statements \nIn these exercises, you'll enter and run your own SELECT statements. To do \nthat, you can open the script for an example that is similar to the state1nent you \nneed to write, copy the statement into a new SQL tab, and modify the statement. \nThat can save you both time and syntax errors. \n8. \nWrite a SELECT statement that returns three columns fro1n the Vendors table: \nvendor_11ame, vendor_contact_last_naine, and vendor_contact_first_naine. \nThen, run this statement to make sure it works correctly. \nAdd an ORDER BY clause to this state1nent that sorts the result set by last \nname and then first name, both in ascending sequence. Then, run this state-\nment again to make sure it works correctly. This is a good way to build and \ntest a statement, one clause at a time. \n9. \nWrite a SELECT statement that returns one column from the Vendors table \nnamed full_name that joins the vendor_contact_last_name and \nvendor contact first name columns. \n-\nFor1nat this column with the last name, a co1nma, a space, and the first 11arne \nlike this: \nDoe, John \nSort the result set by last name and then first name in ascending sequence. \nReturn only the contacts whose last name begins with the letter A, B, C, or E. \nThis should retrieve 41 rows. \n10. Write a SELECT statement that returns these column names and data from \nthe Invoices table: \nDue Date \nThe invoice due date column \nInvoice Total \nThe invoice total colu1nn \n10% \nlOo/o of the value of invoice total \nPlus lOo/o \nThe value of invoice_total plus 10% \nReturn only the rows with an invoice total that's greater than or equal to 500 \nand less than or equal to 1000. This should retrieve 12 rows. \nSort the result set in descending sequence by invoice_due_date.\n\nSection 1 \nAn introduction to MySQL \n11. Write a SELECT statement that returns these columns from the Invoices \ntable: \ninvoice number \ninvoice total \npayment_credit_total \nbalance_due \nThe invoice number column \nThe invoice total column \nSum of the payment_total and credit_total \ncolumns \nThe invoice total column minus the \npayment_total and credit_total columns \nReturn only invoices that have a balance due that's greater than $50. \nSort the result set by balance due in descending sequence. \nUse the LIMIT clause so the result set contains only the rows with the 5 \nlargest balances. \nWork with nulls and test expressions \n12. Write a SELECT statement that returns these columns from the Invoices \ntable: \ninvoice number \ninvoice date \nbalance due \npayment_date \nThe invoice_number column \nThe invoice date column \nThe invoice_tota] column minus the payment_total \nand credit total columns \nThe payment_date column \nReturn only the rows where the payment_date column contains a null value. \nThis should retrieve 11 rows. \n13. Write a SELECT statement without a FROM clause that uses the \nc ·URRENT DATE function to return the current date in its default format. \nUse the DATE FORMAT function to format the current date in this format: \nnun-dd-yyyy \nThis displays the month, day, and four-digit year of the current date. \nGive this column an alias of current_date. To do that, you must enclose the \nalias in quotes since that name is already used by the CURRENT_DATE \nfunction. \n14. Write a SELECT statement without a FROM clause that creates a row with \nthese columns: \nstarting_principal \ninterest \nprincipal_plus_interest \nStarting principal of $50,000 \n6.5% of the principal \nThe principal plus the interest \nTo calculate the third column, add the expressions you used fo1· the first two \ncolumns.\n\nHow to retrieve data \nfrom two or more tables \nln the last chapter, you lea111ed how to create result sets that contain data from a \nsingle table. Now, this chapter shows you how to create result sets that contain \ndata from two or more tables. To do that, you can use an inner join, an outer \n• \n• \n• \nJOin, or a union. \nHow to work with inner joins ............................................. 114 \nHow to code an i11ner join ............................................................................ 114 \nHow to use table aliases ............................................................................... 116 \nHow to join to a table in another database .................................................. 118 \nHow to use compound join conditions ........................................................ 120 \nHow to use a self-join .................................................................................. 122 \nHow to join more than two tables ................................................................ 124 \nHow to use the implicit inner join syntax .................................................... 126 \nHow to work with outer joins ............................................. 128 \nHow to code an outer join ............................................................................ 128 \nOuter join examples ...................................................................................... 130 \nOther skills for working with joins .................................... 134 \nHow to join tables with the USING keyword .............................................. 134 \nHow to join tables with the NATURAL keyword ....................................... 136 \nHow to use cross joins ....................................................................................... 138 \nHow to work with unions ................................................... 140 \nHow to code a union .................................................................................... 140 \nA union that combines result sets from different tables .............................. 140 \nA union that combines result sets from the same tables ............................. 142 \nA union that simulates a full outer join ....................................................... 144 \nPerspective ......................................................................... 146\n\nSection 1 \nAn introduction to MySQL \nHow to work with inner joins \nA join lets you combine columns from two or more tables into a single result \nset. To start, this chapter shows how to code the most common type of join, an \n• \n• \n• \ninner JOtn. \nHow to code an inner join \nsyntax is also called the SQL-92 syritax because it was introduced by the SQL-92 \nstandards. It's generally considered a best p1·actice to use this syntax. \nTo join data from two tables, you code the names of the two tables in the \nFROM clause along with the JOIN keyword and an ON phrase that specifies \nthe join condition. The join condition indicates how the two tables should be \ncompared. In most cases, they're compared based on the relationship between \nthe primary key of the first table and a foreign key of the second table. \nIn this figure, for example, the SELECT statement joins data from the \nVendors and Invoices tables based on the vendor_id column in each table. Since \nthe join condition uses the equal operator, the value of the vendor_id column in a \nrow in the Vendors table must match the vendor_id in a row in the Invoices table \nfor that row to be included in the result set. In other words, only vendors with \none or more invoices are included. Although you code most inner joins using \nthe equal operator, you can compare two tables based on other conditions too. \nFor example, you can use the greater than or less than operators for an inner join \ncondition. \nIn this figure, the Vendors table is joined with the Invoices table using \na column that has the same name in both tables: vendor_id. As a result, the \ncolumns must be qualified so MySQL can tell which table they come from. To \ncode a qualified column name, you can enter the table name and a pe1iod in front \nof the column name. In this figure, the SELECT statement only uses quali-\nfied column names in the join condition. However, you must qualify a column \nname anywhere it appears in the statement if the same name occurs in both \ntables. If you don't, MySQL returns an error indicating that the column name is \nambiguous.",
          "pages": [
            123,
            124,
            125,
            126,
            127,
            128,
            129,
            130,
            131,
            132,
            133,
            134
          ],
          "relevance": {
            "score": 0.59,
            "sql_score": 1.0,
            "concept_score": 0.78,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "commonMistakes": {
          "text": "Chapter 4 \nHow to retrieve data f rom two or m.ore tables \nThe explicit syntax for an inner join \nSELECT select_ list \nFROM table_ l \n[INNER] JOIN table_ 2 \nON join_condition_ l \n[[INNER] JOIN table_ 3 \nON join_condition_ 2] ... \nAn inner join of the Vendors and Invoices tables \nSELECT invoice_number, vendor_name \nFROM vendors INNER JOIN invoices \nON vendors.vendor_ id = invoices.vendor_id \nORDER BY invoice_number \ninvoice_number \nvendor name \n-\n► \n0-2058 \nMalloy Lithographing Inc \n0-2060 \nMalloy Lithographing Inc \n0-2436 \nMalloy Lithographing Inc \n1-200-5164 \nFederal Express Corporation \n1-202-2978 \nFederal Express Corporation \nYesmed,Inc \n(114 rows ) \nDescription \n• \nA join combines columns from two or more tables into a result set based on the \njoin conditions you specify. For an inner join, only those rows that satisfy the join \ncondition are included in the result set. \n• \nA join condition names a column in each of the two tables involved in the join and \nindicates how the two columns should be compared. In most cases, you use the \nequal operator to retrieve rows with matching columns. However, you can also use \nany of the other comparison operators in a join condition. \n• \nTables are typically joined on the relationship between the primary key in one table \nand a foreign key in the other table. However, you can also join tables based on \nrelationships not defined in the database. These are called ad hoc r·elationships. \n• \nIf the two co]umns in a join condition have the same name, you must qualify them \nwith the table name so MySQL can distinguish between them. To code a qitalified \ncolumn name, type the table name, followed by a period, followed by the column \nname. \nNote \n• \nThe INNER keyword is optional and is seldom used. \nHow to code an inner join \n\" L\n\nSection 1 \nAn introduction to MySQL \nHow to use table aliases \nWhen you name a table to be joined in the FROM clause, you can refer to \nthe table by an alias as shown in figure 4-2. A table alias is an alternative table \nname that's typically just a letter or two. This makes it easier to qualify the \ncolumn names in the rest of the statement, and it makes the query easier to code \nand read, especially when the table names are long. \nThe first example in this figure joins data from the Vendors and Invoices \ntables. Here, both tables have been assigned aliases that consist of a single letter. \nThe second example only assigns an alias to the second table, not the first. \nHere, the alias shortens the name of the Invoice_Line_Items table to just \nLine_ltems. As a result, the shorter name can be used to refer to the invoice_id \ncolumn of the table in the join condition. Although you can use this technique \nwhen you code a query, most programmers use abbreviations of the table names \nas shown in the first example and throughout the rest of this chapter. \nAfter you assign a table alias, you must use the alias in ,place of the original \ntable name throughout the query. Otherwise, MySQL returns an error message \ninstead of a result set.\n\nChapter 4 \nHow to retrieve data f rom two or m.ore tables \nThe syntax for an inner join that uses table aliases \nSELECT select_ list \nFROM table_ l al \n[INNER] JOIN table_ 2 a2 \nON al.colwnn_ name operator a2.colwnn_name \n[[INNER] JOIN table_ 3 a3 \nON a2.colwnn_ name operator a3.colwnn_name] ••• \nAliases for all tables \nSELECT invoice_number, vendor_name, invoice_due_date, \ninvoice_ total - payment_total - credit total AS balance due \nFROM vendors v JOIN invoices i \nON v.vendor_ id = i.vendor_ id \nWHERE invoice_total - payment_total - credit total> 0 \nORDER BY invoice_due_date DESC \ninvoice_nurnber \nvendor _name \ninvoice_due_date \nbalance_due \n► \nBlue Cross \n2018-08-31 \n224.00 \n0-2436 \nMalloy Lithographing Inc \n2018-08-30 \n10976.06 \n9982nl \nFord Motor Crecfrt Company \n2018-08-23 \n503. 20 \nP-0608 \nMalloy Lithographing Inc \n2018-08-22 \n19351.18 \n(11 rows) \nAn alias for only one table \nSELECT invoice_n.11mhAr, line_ item_ amnunt, line_ item_description \nFROM invoices JOIN invoice_line_ items line_ items \nON invoices.invoice id= line items.invoice id \nWHERE account_number = 540 \nORDER BY invoice date \nf invoice_number \nline item amount \nline j tern_ desoiption \n-\n► \nm211-001 \n478.00 \nPubftshers Marketing \n207. 78 \nProspect &st \n175-.00 \nCard deck advertising \n197/522 \n765.13 \nCatalog design \n(6 rows ) \nDescription \n• \nA table cilias is an alternative table name assigned in the FROM clause. You can use \nan alias, which is typically just a letter or two, to make a SQL statement easier to \ncode and read. \n• \nIf you assign an alias to a table, you must use that alias to refer to the table \nthroughout your query. You can't use the original table name. \n• \nYou ca11 use an alias for one table in a join without using an alias for another table. \nHow to use table aliases \nL \nV\n\nSection 1 \nAn introduction to MySQL \nHow to join to a table in another database \nIf you use the procedure described in appendix A (Windows) or appendix \nB (macOS) of this book to create the databases for this book, all of the tables \nare organized into three databases, which are also known as sche,nas. First, all \ntables pertaining to accounts payable such as the Vendors and Invoices tables are \nstored in the database, or schema, named AP. Then, all tables pertaining to order \nmanagement are stored in a database named OM. Finally, all tables that are used \nby the smaller examples presented in this book are stored in a database named \nEX. \nWhen you use MySQL Workbench to run a query against a database, you \ndon't need to qualify any table name with its database name. For example, when \nyou run a query against the AP database, you don't need to qualify the Vendors \ntable with the name of the database. \nHowever, you may occasionally need to join to a table that's in another \ndatabase. To do that, you must qualify the table name in the other database by \nprefixing the table name with the database name. For example, let's say you need \nto join the Vendors table in the AP database with the Customers table in the OM \ndatabase. To do that, you need to qualify the Customers table with the name of \nthe database as shown in figt1re 4-3.\n\nChapter 4 \nHow to retrieve data from two or m.ore tables \nThe syntax of a table name that's qualified with a database name \ndatabase_name.table_ name \nJoin to a table in another database \nSELECT vendor_ name, customer_ last_ name, customer_ first_ name, \nvendor_state AS state, vendor_city AS city \nFROM vendors v \nJOIN om.customers c \nON v.vendor_ zip_code = c.customer_ zip \nORDER BY state, city \n~ \nvendor name \nrustomer _last_name \nrustomer first name \nWells Fa~go Bank \n-\nMarissa \nKyle \nAzteklabel \nIrvin \nAnia \nZylka Design \nHolbrooke \nRashad \nLou Gentile's Flower Basket \nDamien \nDeborah \nCostco \nNeftaly \nThalia \nCostco \nHo!brooke \nRashad \nShields Design \nDamien \nDeborah \nWakefield Co \nHolbrooke \nRashad \nWakefield Co \nNeftaly \nThaffa \nGary McKeighan Insl.l' ance \nNeftaly \nThalia \nGary Mc:Keighan lnsllance \nHolbrooke \nRashad \nDigital Dreamwori<s \nNeftaly \nThaffa \n(37 rows) \nDescription \nstate \ncity \nAl. \nPhoenix \nCA \nAnaheim \nCA \nFresno \nCA \nFresno \nCA \nFresno \nCA \nFresno \nCA \nFresno \nCA \nFresno \nCA \nFresno \nCA \nFresno \nCA \nFresno \nCA \nFresno \n• \nA MySQL server can store tables in multiple databases. These databases are \nsometimes refe1Ted to as schemas. \n• \nWhen you run a SELECT statement against one database, you can join to a table in \nanother database if you have appropriate privileges. To do that, you must prefix the \ntable name in the other database with the name of that database. \nHow to join to a table in another database",
          "pages": [
            135,
            136,
            137,
            138,
            139
          ],
          "relevance": {
            "score": 0.48,
            "sql_score": 1.0,
            "concept_score": 0.56,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        }
      },
      "educational_notes": {
        "definition": "Joining tables is a method used in database management to combine rows from two or more tables based on a related column between them. It's essential for retrieving data that spans multiple tables and allows for complex queries.",
        "explanation": "Imagine you have two tables: one with customer information (Customers) and another with their order details (Orders). If you want to find all orders made by a specific customer, you'd need to join these tables based on the customer's ID. This concept is crucial because it enables you to access comprehensive data that might be distributed across different tables in your database.",
        "key_points": [
          "Key point 1: Joins are used to combine rows from two or more tables based on a related column.",
          "Key point 2: Common types of joins include INNER JOIN, LEFT JOIN, RIGHT JOIN, and FULL OUTER JOIN.",
          "Key point 3: Always ensure the join condition is correct to avoid missing data or incorrect results.",
          "Key point 4: Use aliases for table names in complex queries to make them more readable.",
          "Key point 5: Understanding joins connects to other database concepts like subqueries and views."
        ],
        "examples": [
          {
            "title": "Basic INNER JOIN",
            "code": "-- Selecting customer names and their order IDs\nSELECT Customers.customer_name, Orders.order_id\nFROM Customers\nINNER JOIN Orders ON Customers.customer_id = Orders.customer_id;",
            "explanation": "This example demonstrates how to join two tables using an INNER JOIN. It retrieves the names of customers who have placed orders."
          },
          {
            "title": "Practical Example: Finding All Orders by a Specific Customer",
            "code": "-- Selecting all orders for customer 'John Doe' SELECT * FROM Orders WHERE customer_id = (SELECT customer_id FROM Customers WHERE customer_name = 'John Doe');",
            "explanation": "This practical example shows how to combine a join with a subquery to find all orders made by a specific customer.",
            "validation_note": "SQL auto-fixed: "
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Using the wrong type of join",
            "incorrect_code": "-- Incorrectly using LEFT JOIN instead of INNER JOIN\nSELECT * FROM Customers\nLEFT JOIN Orders ON Customers.customer_id = Orders.customer_id;",
            "correct_code": "-- Correct usage of INNER JOIN\nSELECT * FROM Customers\nINNER JOIN Orders ON Customers.customer_id = Orders.customer_id;",
            "explanation": "This mistake occurs when the type of join used does not match the desired outcome. Always choose the appropriate join type based on your query requirements."
          }
        ],
        "practice": {
          "question": "Create a query that retrieves all employees who have worked on projects in the 'Technology' department.",
          "solution": "SELECT Employees.employee_name FROM Employees\nINNER JOIN Employee_Projects ON Employees.employee_id = Employee_Projects.employee_id\nINNER JOIN Projects ON Employee_Projects.project_id = Projects.project_id\nWHERE Projects.department = 'Technology';"
        }
      },
      "llm_enhanced": true,
      "raw_text_preview": "Chapter 3 \nHow to retrieve data from a sin.gle table \nThe syntax of the WHERE clause with an IN phrase \nWHERE test_expression [NOT] IN \n({subquerylexpression_ l [, expression_2 ] ... }) \nExamples of t",
      "content_relevance": {
        "score": 0.59,
        "sql_score": 1.0,
        "concept_score": 0.78,
        "non_sql_penalty": 0.1,
        "is_relevant": true,
        "analysis": "SQL content"
      }
    },
    "inner-join-murach": {
      "id": "inner-join-murach",
      "title": "Inner Join",
      "definition": "Matching rows from two or more tables",
      "difficulty": "beginner",
      "page_references": [
        117,
        118,
        119,
        120,
        121,
        122,
        123,
        124,
        125,
        126,
        127,
        128
      ],
      "sections": {
        "definition": {
          "text": "Chapter 3 \nHow to retrieve data from a sin.gle table \nThe syntax of the WHERE clause with an IN phrase \nWHERE test_expression [NOT] IN \n({subquerylexpression_ l [, expression_2 ] ... }) \nExamples of the IN phrase \nAn IN phrase with a list of numeric literals \nWHERE terms_ id IN (1, 3, 4) \nAn IN phrase preceded by NOT \nWHERE vendor_ state NOT IN ('CA', 'NV', 'OR') \nAn IN phrase with a subquery \nWHERE vendor id IN \n(SELECT vendor id \nFROM invoices \nWHERE invoice_date = \n1 2018-07-18 1\n) \nDescription \n• \nYou can use the IN phrase to test whether an expression is equal to a value in a list \nof expressions. Each of the expressions in the list is automatically converted to the \nsame type of data as the test expression. \n• \nThe list of expressions can be coded in any order without affecting the order of the \nrows in the result set. \n• \nYou can use the NOT operator to test for an expression that's not in the list of \n• \nexpressions. \n• \nYou can also compare the test expression to the items in a list returned by a \nsubquery. You'll learn more about coding subqueries in chapter 7. \nHow to use the IN operator\n\nSection 1 \nAn introduction to MySQL \nHow to use the BETWEEN operator \nWhen you use this operator, the value of a test expression is compared to the \nrange of values specified in the BETWEEN phrase. If the value falls within this \nrange, the row is included in the query results. \nThe first example in this figure shows a simple WHERE clause that uses the \nBETWEEN operator. It retrieves invoices with invoice dates between June 1, \n2018 and June 30, 2018. Note that the range is inclusive, so invoices with invoice \ndates of June 1 and June 30 are included in the results. \nThe second example shows how to use the NOT operator to select rows \nthat aren't within a given range. In this case, vendors with zip codes that aren't \nbetween 93600 and 93799 are included in the results. \nThe third example shows bow you can use a calculated value in the test \nexpression. Here, the payment_total and credit_total columns are subtracted \nfrom the invoice_total column to give the balance due. Then, this value is \ncompared to the range specified in the BETWEEN pln·ase. \nThe last example shows how you can use calculated values in the \nBETWEEN phrase. Here, the frrst value is the credit_total column and the \nsecond value is the credit_total column plus 500. So the results include all those \ninvoices where the amount paid is between the credit amount and $500 more \nthan the credit amount.\n\nChapter 3 \nHow to retrieve datafrom a sin.gle table \nThe syntax of the WHERE clause with a BETWEEN phrase \nWHERE test_expression [NOT] BETWEEN begin_ expression AND end_ expression \nExamples of the BETWEEN phrase \nA BETWEEN phrase with literal values \nWHERE invoice_date BETWEEN '2018-06-01' AND '2018-06-30' \nA BETWEEN phrase preceded by NOT \nWHERE vendor_ zip_ code NOT BETWEEN 93600 AND 93799 \nA BETWEEN phrase with a test expression coded as a calculated value \nWHERE invoice_total -\npayment_total - credit_total BETWEEN 200 AND 500 \nA BETWEEN phrase with the upper and lower limits \ncoded as calculated values \nWHERE payment_ total BETWEEN credit_total AND credit_total + 500 \nDescription \n• \nYou can use the BETWEEN phrase to test whether an expression falls within a \nrange of values. The lower limit must be coded as the frrst expression, and the \nupper limit must be coded as the second expression. Otherwise, MySQL returns an \nempty result set. \n• \nThe two expressions used in the BETWEEN phrase for the range of values are \ninclusive. That is, the result set includes values that are equal to the upper or lower \nlimit. \n• \nYou can use the NOT operator to test for an expression that's not within the given \nrange. \nHow to use the BETWEEN operator\n\nSection 1 \nAn introduction to MySQL \nHow to use the LIKE and REGEXP operators \nTo retrieve rows that match a specific string pattern, or mask, you can use \nthe LIKE or REGEXP operators as shown in figure 3-14. The LIKE operator is \nan older operator that lets you search for simple string patterns. When you use \nthis operator, the mask can contain one or both of the wildcard symbols shown \nin the first table in this figure. \nIn contrast to the LIKE operator, the REGEXP operator allows you to create \ncomplex string patterns known as regular expressions. To do that, you can use \nthe special characters and constructs shown in the second table in this figure. \nAlthough creating regular expressions can be tricky at frrst, they allow you to \nsearch for virtually any string pattern. \nIn the first example in this figure, the LIKE phrase specifies that all vendors \nin cities that start with the letters SAN should be included in the query results. \nHere, the percent sign (%) indicates that any character or characters can follow \nthese three letters. So San Diego and Santa Ana are both included in the results. \nThe second example selects all vendors whose vendor name starts with the \nletters COMPU, followed by any one character, the letters ER, and any charac-\nters after that. The vendor names Compuserve and Computerworld both match \nthat pattern. \nIn the third example, the REGEXP phrase searches for the letters SA within \nthe vendor_city column. Since the letters can be in any position within the string, \nboth Pasadena and Santa Ana are included in the results. \nThe next two examples demonstrate how to use REGEXP to match a pattern \nto the beginning or end of the string being tested. In the fourth example, the \n1nask /\\SA matches the letters SA at the beginning of vendor_city, as in Santa \nAna and Sacramento. In contrast, the mask NA$ matches the letters NA at the \nend of vendor_city, as shown in the fifth example. \nThe sixth example uses the pipe ( I ) character to search fo1· either of two \nstring patterns: RS or SN. In this case, the first pattern would match Traverse \nCity and the second would match Fresno, so both are included in the result set. \nThe last four examples use brackets to specify multiple values. In the \nseventh example, the vendor_state column is searched for values that contain \nthe letter N followed by either C or V. That excludes NJ and NY. In contrast, the \neighth example searches for states that contain the letter N followed by any letter \nfrom A to J. Trus excludes NV and NY. \nThe ninth example searches the values in the vendor_contact_last_name \ncolumn for a name that can be spelled two different ways: Damien or Damion. \nTo do that, the mask specifies the two possible characters in the fifth position, E \nand 0 , within brackets. In the final example, the REGEXP phrase searches for a \nvendor_city that ends with any letter, a vowel, and then the letter N. \nBoth the LIKE and REGEXP operators provide powerful functionality for \nfinding information in a database. However, searches that use these operators \nsometimes run slowly since they can't use a table's indexes. As a result, you \nshould only use these operators when necessary.",
          "pages": [
            117,
            118,
            119,
            120
          ],
          "relevance": {
            "score": 0.31,
            "sql_score": 1.0,
            "concept_score": 0.22,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "examples": {
          "text": "Chapter 3 \nHow to retrieve data from a sin.gle table \nThe syntax of the WHERE clause with a LIKE phrase \nWHERE match_expression [NOT] LIKE pattern \nThe syntax of the WHERE clause with a REGEXP phrase \nWHERE match_expression [NOT] REGEXP pattern \nLIKE wildcards \nSymbol \nDescription \n~ \nMatches any string of zero or more characters. \nMatches any single character. \nREGEXP special characters and constructs \nCharacter/Construct \nDescription \nA \n$ \n• \nMatches the pattern to the beginning of the value being tested. \nMatches the pattern to the end of tl1e value being tested. \nMatches any single character . \n[charlist] \n[charl-char2] \nMatches any single character listed within the brackets. \nMatches any single character within the given range. \nSeparates two string patterns and matches either one. \nWHERE clauses that use the LIKE and REGEXP operators \nExample \nResults that match the mask \nWHERE vendor_city LIKE 'SAN%' \nWHERE vendor_nam~ LIKE \n1 COMPU_ER%1 \nWHERE vendor_city REGEXP \n1 SA 1 \nWHERE vendor_city REGEXP ,,.SA' \nWHERE vendor_ city REGEXP 'NA$' \nWHERE vendor_city REGEXP 'RSISN' \nWHERE vendor state REGEXP 'N[CV] 1 \nWHERE vendor_state REGEXP 'N[A-J] I \nWHERE vendor_contact_ last_ name REGEXP 'DAMI[EO]N' \nWHERE vendor_city REGEXP '[A-Z] [AEIOU]N$' \nDescription \n\"San Dieoo\" \"Santa Ana\" \nt, \n, \n\"Compus!rr,ve\", \"Comput~world\" \n\"Pasadena\" \"Santa Ana\" \n' -\n\"Sa.11ta Ana'', \"Sacramento\" \n\"Gardena\" \"Pasadena\" \"Santa Ana\" \n' \n' \n\"Trave!],e City\", \"Frefil}o\" \n\"NC\" and \"NV\" but not \"NJ\" or \"NY\" \n\"NC\" and \"NJ\" but not \"NV\" or \"NY\" \n\"Damien'' and \"Damion\" \n\"Boston\" \"Mclean\" \"Oberlin\" \n=\n• \n=\n• \n• \nYou use the LIKE and REGEXP operators to retrieve rows that match a string pattern, \ncalled a mask. The mask determines which values in the column satisfy the condition. \n• \nThe mask for a LIKE phrase can contain special symbols, called wildcards. The mask \nfor a REGEXP phrase can contain special characters and constructs. Masks aren't \ncase-sensitive. \n• \nIf you use the NOT keyword, only those 1·ows with values that don't match the string \npattern are included in the result set. \n• \nMost LIKE and REGEXP phrases significantly degrade performance compared to \nother types of searches, so use the1n only when necessary. \nHow to use the LIKE and REGEXP operators\n\nSection 1 \nAn introduction to MySQL \nFor the sake of brevity, this chapter only presents the most common symbols \nthat are used in regular expressions. However, MySQL supports most of the \nsymbols that ru:e standard for creating regular expressions. Fo1· more information \nabout creating regular expressions, please consult the online MySQL Reference \nManual. If you 're familiar with using regular expressions in other programming \nlanguages such as PHP, you'll fmd that they work similarly in MySQL. \nIn addition to the REGEXP operator, MySQL 8.0 provides some new \nfunctions that work with regular expressions. You'll learn about these functions \nin chapter 9 when you learn about some other functions for working with strings. \nHow to use the IS NULL clause \nIn chapter 1, you learned that a column can contain a null value. A null value \nis typically used to indicate that a value is not known. A null value is not the \nsame as an empty string (' '). An empty st1·ing is typically used to indicate that \nthe value is known, and it doesn't exist. \nIf you're working with a database that allows null values, you need to know \nhow to test for them in search conditions. To do that, you use the IS NULL \nclause as shown in figm·e 3-15. \nThis figure uses a table named Null_Sample to show how to search for \nnull values. This table contains two columns: invoice id and invoice total. The \n-\nvalues in this table are displayed in the first example. \nThe second example shows what happens when you retrieve all the rows \nwith invoice_total equal to zero. In this case, the row that has a null value isn't \nincluded in the resttlt set. As the third example shows, this row isn't included in \nthe result set when invoice_total isn't equal to zero either. Instead, you have to \nuse the IS NULL clause to retrieve rows with null values, as shown by the fourth \nexample. \nYou can also use the NOT operator with the IS NULL clause, as shown by \nthe last example. When you use this operator, all of the rows that don't contain \nnull values are included in the query results.\n\nChapter 3 \nHow to retrieve data f rom a sin.gle table \nThe syntax of the WHERE clause with the IS NULL clause \nWHERE expression IS [NOT] NULL \nThe contents of the Null_Sample table \nSELECT * FROM null_ sample \ninvoice_id \n► \ninvoice_total \n125.00 \n0.00 \n2199.99 \n0.00 \nA SELECT statement that retrieves rows with zero values \nSELECT* FROM null_ sample \nWHERE invoice_ total = 0 \ninvoice_id \n► \ns \ninvoice total \n0.00 \n0.00 \nA SELECT statement that retrieves rows with non-zero values \nSELECT* FROM null_ sample \nWHERE invoice_ total <> O \ninvoice id \ninvoice total \n-\n► \n125.00 \n2199.99 \nA SELECT statement that retrieves rows with null values \nSELECT* FROM null_ sample \nWHERE invoic e _ t otal IS NULL \ninvoice id \ninvoice_total \n► \nIUIJII \nA SELECT statement that retrieves rows without null values \nSELECT* \nFROM null_ sample \nWHERE invoice_ total IS NOT NULL \ninvoice_id \ninvoice_total \n► I i \n125.00 \n0.00 \n2199.99 \n0.00 \nDescription \n• \nA null value represents a value that's unknown, unavailable, or not applicable. It \nisn't the same as a zero or an empty string(\"). \nHow to use the IS NULL clause \nI \nV\n\nSection 1 \nAn introduction to MySQL \nHow to code the ORDER BY clause \nThe ORDER BY clause specifies the sort order for the rows in a 1·esult set. \nIn most cases, you '11 use column names from the base table to specify the sort \norder as you saw in some of the examples earlier in this chapter. However, you \ncan also use other techniques to sort the rows in a result set, as described in the \ntopics that follow. \nHow to sort by a column name \nsyntax shows that you can sort by one or more expressions in either ascending \nor descending sequence. The three examples in this figure show how to code this \nclause for expressions that involve column names. \nThe first two examples show how to sort the rows in a result set by a \nsingle column. In the frrst example, the rows in the Vendors table are sorted in \nascending sequence by the vendor_name column. Since ascending is the default \nsequence, the ASC keyword can be omitted. In the second example, the rows are \nsorted by the vendor_name column in descending sequence. \nTo sort by more than one column, you simply list the names in the ORDER \nBY clause separated by commas as shown in the third example. This can be \nreferred to as a nested sort because one sort is nested within another. Here, \nthe rows in the Vendors table are first sorted by the vendor_state column in \nascending sequence. Then, within each state, the rows are sorted by the \nvendor_city column in ascending sequence. Finally, within each city, the rows \nare sorted by the vendor_name column in ascending sequence.\n\nChapter 3 \nHow to retrieve data from a sin.gle table \nThe expanded syntax of the ORDER BY clause \nORDER BY expression [ASCIDESC] [, expression [ASCIDESC]] ••. \nAn ORDER BY clause that sorts by one column in ascending sequence \nSELECT vendor_name, \nCONCAT(vendor_city, ', ', vendor_ state, ' ', vendor_ zip_ code) AS address \nFROM vendors \nORDER BY vendor_name \n..-------------------------------------, \nI vendor _name \naddress \n~ \n----, \n► \nAbbey Office Furnishings \nFresno, CA 93722 \nAmencan Booksellers Assoc \nTarryto1A'rl, NY 10591 \nAmerican Express \nLos Angeles, CA 90096 \nASC Signs \nFresno, CA 93703 \nAn ORDER BY clause that sorts by one column in descending sequence \nSELECT vendor_name, \nCONCAT(vendor_city, ', •, vendor_ state, ' •, vendor_ zip_code) AS address \nFROM vendors \nORDER BY vendor_name DESC \nJ vendor _name \naddress \n► I Zylka Design \nFresno, CA 93711 \nZlp Print &. Copy Center \nFresno, CA 93777 \nZee Medical Service Co \nWashington, IA 52353 \nYesmed, Inc \nFresno, CA 93718 \nAn ORDER BY clause that sorts by three columns \nSELECT vendor_name, \nCONCAT(vendor_city, ', •, vendor_ state, ' ', vendor_ zip_code) AS address \nFROM vendors \nORDER BY vendor_ state, vendor_city, vendor_name \nvendor _name \naddress \n► \nAT&T \nPhoenix, AZ 85062 \nComputer Library \nPhoenix, AZ 85023 \nWells Fargo Bank \nPhoenix, AZ 85038 \nAztek Labe.l \nAnaheim, CA 92807 \nDescription \n• \nThe ORDER BY clause specifies how you want the rows in the result set sorted. \nYou can sort by one or more columns, and you can sort each column in either \nascending (ASC) or descending (DESC) sequence. ASC is the default. \n• \nBy default, in an ascending sort, special characters appear frrst in the sort \nsequence, followed by numbers, then letters. Thls sort order is determined by the \ncharacter set used by the server, wbjch you can change when you start the server. \n• \nNull values appear frrst in the sort sequence, even if you 're using DESC. \n• \nYou can sort by any column in the base table regardless of whether it's included \nin the SELECT clause. \nHow to sort by a column name \nA \n1--\n\"\"\n\nSection 1 \nAn introduction to MySQL \nHow to sort by an alias, expression, \nor column number \ncolumns. FiI·st, you can use a column alias that's defined in the SELECT clause. \nThe first SELECT statement in this figure, for example, sorts by a column \nnamed Address, which is an alias for the concatenation of the vendor_city, \nvendor_state, and vendor_zip_code columns. Notice that within the Address \ncolumn, the result set is also sorted by the vendor_name column. \nYou can also use an arithmetic or string expression in the ORDER BY \nclause, as shown by the second example in this figure. Here, the expression \nconsists of the vendor_contact_last_name column concatenated with the \nvendor_contact_first_name column. Notice that neither of these columns is \nincluded in the SELECT clause. Although MySQL allows this coding technique, \nmany other SQL dialects don't. \nThe last example in this figure shows how you can use column numbers to \nspecify a sort order. To use this technique, you code the number that corresponds \nto the column of the result set, where 1 is the first column, 2 is the second \ncolumn, and so on. In this example, the ORDER BY clause sorts the result set \nby the second column, which contains the concatenated address, then by the first \ncolumn, which contains the vendor name. As a result, this statement returns the \nsame result set that's returned by the first statement. \nHowever, the statement that uses column numbers is more difficult to \nread because you have to look at the SELECT clause to see what columns the \nnumbers refer to. In addition, if you add or remove columns from the SELECT \nclause, you may also have to change the ORDER BY clause to reflect the new \ncolumn positions. As a result, you should avoid using this technique in most \nsituations.\n\nChapter 3 \nHow to retrieve data from a sin.gle table \nAn ORDER BY clause that uses an alias \nSELECT vendor_name, \nCONCAT(vendor_city, ', ', vendor_ state, \nFROM vendors \nORDER BY address, vendor_name \nvendor _name \n► \nAztek Label \nBlue Shield of Califomla \nMalloy Lithographing Inc \nData Reproductions Corp \naddress \nAnaheim, CA 92807 \nAnaheim, CA 92850 \nAnn Arbor, MI 48106 \nAuburn Hills, MI 48326 \n• •, vendor_ zip_ code} AS address \nAn ORDER BY clause that uses an expression \nSELECT vendor_name, \nCONCAT(vendor_city, ', •, vendor_ state, \nFROM vendors \nORDER BY CONCAT(vendor_contact_last_name, \nvendor _name \n► \nDristas Groom & McCormick \nInternal Revenue Service \nUS Postal Service \nYale Industrial Trucks-Fresno \naddress \nFresno, CA 93720 \nFresno, CA 93888 \nMadison, WI 53707 \nFresno, CA 93706 \n• •, vendor_ zip_code} AS address \nvendor contact first name} \n-\nAn ORDER BY clause that uses column positions \nSELECT vendor_ name, \nFROM vendors \nORDER BY 2, 1 \nvendor _name \naddress \n► \nArtek Label \nAnaheim, CA 92807 \nBlue Shield of California \nAnahevn, CA 92850 \nMalloy Lithographing Inc \nAnn Arbor, MI 48106 \nData Reproductions Corp \nAuburn Kills, MI 4832-6 \nDescription \n• \nThe ORDER BY clause can include a column alias that's specified in the SELECT \nclause if the column alias does not include spaces. \n• \nThe ORDER BY clause can include any valid expression. The expression can refer \nto any column in the base table, even if it isn't included in the result set. \n• \nThe ORDER BY clause can use numbers to specify the columns to use for sorting. \nIn that case, 1 represents the frrst column in the result set, 2 represents the second \ncolumn, and so on. \nHow to sort by an alias, expression, or column number",
          "pages": [
            121,
            122,
            123,
            124,
            125,
            126,
            127
          ],
          "relevance": {
            "score": 0.41,
            "sql_score": 1.0,
            "concept_score": 0.22,
            "non_sql_penalty": 0.0,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "commonMistakes": {
          "text": "Section 1 \nAn introduction to MySQL \nHow to code the LIMIT clause \nThe LIMIT clause specifies the maximum number of rows that are returned \nin the result set. For most queries, you want to see the entire result set so you \nwon't use this clause. However, there may be times when you want to retrieve \njust a subset of a larger result set. \ncan take one or two arguments as shown by the three examples in this figure. \nHow to limit the number of rows \nIn its simplest form, you code the LIMIT clause with a single numeric \nargument. Then, the number of rows in the result set is, at most, the number you \nspecify. But if the result set is smaller than the number you specify, the LIMIT \nclause has no effect. \nIn the first example, the SELECT state1nent includes the LIMIT 5 clause, so \nthe entire result set is five rows. Without the LIMIT clause, this statement would \nreturn 114 rows. Because the result set is sorted by invoice_total in descending \nsequence, this result set represents the five largest invoices. \nHow to return a range of rows \nIf you code the optional offset argument of the LIMIT clause, it represents \nan offset, or starting point for the result set. This offset starts from a value of 0, \nwhich refers to the first row in the result set. In the second example, then, the \noffset is 2 so the result set starts with the third invoice. Then, since the row count \nis 3, the result set contains just 3 rows. \nSimilarly, the third example bas an offset of 100, so the result set starts with \nrow 101. Note that the row count for the LIMIT clause in this example is 1000. \nSince the table contains only 114 rows, though, the result set contains just the \nlast 14 rows in the table.",
          "pages": [
            128
          ],
          "relevance": {
            "score": 0.29,
            "sql_score": 0.6,
            "concept_score": 0.22,
            "non_sql_penalty": 0.0,
            "is_relevant": false,
            "analysis": "SQL content"
          }
        }
      },
      "educational_notes": {
        "definition": "An Inner Join is a type of join operation that returns rows from two tables where there is a match between their common columns. It's essential for combining data from multiple tables based on related information.",
        "explanation": "Imagine you have two tables: one with vendor details (VendorID, VendorName) and another with invoice details (InvoiceID, VendorID, InvoiceDate). An Inner Join allows you to combine these tables so that you can see the vendor name along with their invoices. This is particularly useful when you need to analyze data from multiple sources that are related through a common attribute.",
        "key_points": [
          "Key point 1: It returns only rows where there is a match in both tables based on the join condition.",
          "Key point 2: The join condition specifies which columns to compare for matching values.",
          "Key point 3: Common mistakes include using the wrong column names or not specifying the join type correctly."
        ],
        "examples": [
          {
            "title": "Basic Usage",
            "code": "-- Joining two tables on a common column\nSELECT V.VendorName, I.InvoiceDate\nFROM Vendors AS V\nINNER JOIN Invoices AS I ON V.VendorID = I.VendorID;",
            "explanation": "This example joins the Vendors and Invoices tables based on the VendorID column. It returns the vendor name and invoice date for each matching record."
          },
          {
            "title": "Practical Example",
            "code": "-- Finding all invoices FROM a specific vendor SELECT I.InvoiceID, I.InvoiceDate FROM Invoices AS I INNER JOIN Vendors AS V ON I.VendorID = V.VendorID WHERE V.VendorName = 'ABC Corp';",
            "explanation": "This practical example demonstrates how to find all invoices for a specific vendor by joining the Invoices and Vendors tables and filtering by the vendor name.",
            "validation_note": "SQL auto-fixed: "
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Using the wrong column names in the join condition",
            "incorrect_code": "-- Incorrect join condition\nSELECT V.VendorName, I.InvoiceDate\nFROM Vendors AS V\nINNER JOIN Invoices AS I ON V.VendorID = I.CustomerID;",
            "correct_code": "-- Correct join condition\nSELECT V.VendorName, I.InvoiceDate\nFROM Vendors AS V\nINNER JOIN Invoices AS I ON V.VendorID = I.VendorID;",
            "explanation": "This mistake occurs when the column names used in the join condition do not match between tables. Always double-check that you're using the correct column names."
          }
        ],
        "practice": {
          "question": "Write an SQL query to find all customers who have made at least one order from a specific vendor, given the VendorID of the vendor.",
          "solution": "-- Solution\nSELECT C.CustomerName\nFROM Customers AS C\nINNER JOIN Orders AS O ON C.CustomerID = O.CustomerID\nWHERE O.VendorID = 123;"
        }
      },
      "llm_enhanced": true,
      "raw_text_preview": "Chapter 3 \nHow to retrieve data from a sin.gle table \nThe syntax of the WHERE clause with an IN phrase \nWHERE test_expression [NOT] IN \n({subquerylexpression_ l [, expression_2 ] ... }) \nExamples of t",
      "content_relevance": {
        "score": 0.31,
        "sql_score": 1.0,
        "concept_score": 0.22,
        "non_sql_penalty": 0.1,
        "is_relevant": true,
        "analysis": "SQL content"
      }
    },
    "outer-join-murach": {
      "id": "outer-join-murach",
      "title": "Outer Join",
      "definition": "Left, right, and full outer joins in MySQL",
      "difficulty": "intermediate",
      "page_references": [
        129,
        130,
        131,
        132,
        133,
        134,
        135,
        136,
        137,
        138,
        139,
        140,
        141,
        142,
        143,
        144
      ],
      "sections": {
        "definition": {
          "text": "Chapter 3 \nHow to retrieve data from a sin.gle table \nThe expanded syntax of the LIMIT clause \nLIMIT [offset,] row_count \nA SELECT statement with a LIMIT clause that starts with the first row \nSELECT vendor_ id, invoice_ total \nFROM invoices \nORDER BY invoice_total DESC \nLIMIT 5 \nvendorjd \ninvoice_ total \n► \n37966.19 \n26881 .40 \n23517.58 \n21842.00 \n20551. 18 \nSELECT invoice_ id, vendor_ id, invoice_ total \nFROM invoices \nORDER BY invoice_ id \nLIMIT 2, 3 \ninvoice id -\nvendor_id \ninvoice total \n-\n► \n138.75 \n144.70 \n15.50 \nSELECT invoice_ id, vendor_ id, invoice_total \nFROM invoices \nORDER BY invoice id \nLIMIT 100, 1000 \ninvoice id -\nvendor_id \ninvoice_total \n► \n30.75 \n20551.18 \n2051.59 \n44.44 \n(14 rows ) \nDescription \n• \nYou can use the LIMIT clause to limit the number of rows returned by the SELECT \nstatement. This clause takes one or two intege1· arguments. \n• \nIf you code a single argument, it specifies the maximum row count, beginning with \nthe first row. If you code both arguments, the offset specifies the first row to return, \nwhere the offset of the first row is 0. \n• If you want to retrieve all of the rows from a certain offset to the end of the result \nset, code -1 for the row count. \n• \nTypically, you'll use an ORDER BY clause whenever you use the LIMIT clause. \nHow to code the LIMIT clause \n'\n\nSection 1 \nAn introduction to MySQL \nPerspective \nThe goal of this chapter has been to teach you the basic skills for coding \nSELECT statements. As a result, you'll use these skills in almost every \nSELECT statement you code. \nAs you'll see in the next chapter and in chapters 6 and 7, though, there's \na lot more to coding SELECT statements than what's presented here. In these \nchapters, then, you'll learn additional skills for coding SELECT statements. \nWhen you complete these chapters, you' 11 know everything you need to know \nabout retrieving data from a MySQL database. \nTerms \nkeyword \nbase table \nsearch condition \nfilter \nBoolean expression \n• \nexpression \ncolumn alias \narithmetic expression \narithmetic operator \norder of precedence \nliteral value \nstring \nfunction \nargument \nExercises \nparameter \nconcatenate \ncomparison operator \nlogical operator \ncompound condition \nsubquery \nstring patten1 \nmask \nwildcard \nregular expression \nnull value \nnested sort \noffset \nRun some of the examples in this chapter \nIn these exercises, you '11 use MySQL Workbench to run some of the scripts for \nthe examples in this chapter. This assumes that you already know how to use \nMySQL Workbench, as described in chapter 2. \n1. \nStart MySQL Workbench. \n2. \nOpen the script named 3-02.sql that you should fmd in this directory: \nc:\\murach\\rnysql\\book_scripts\\ch03. When it opens, you should see all of the \nqueries for figure 3-2. Note that each of these queries has a semicolon at the \nend of it. \n3. \nMove the insertion point into the first query and press Ctrl+Enter or click on \nthe Exectite Current Statement button to run the query. This shows you the \ndata that's in the Invoices table that you'll be working with in this chapter. \n4. \nMove the insertion point into the second query and run it.\n\nChapter 3 \nHow to retrieve data from a sin.gle table \n5. \nOpen the script named 3-05.sql in the ch03 directory. Then, run the second \nquery. When you do, you '11 see that the 1·esult set is in sequence by the \ninvoice id column. \n6. \nDelete the ORDER BY clause from the SELECT statement and run the query \nagain. Scroll through the result set to see that the rows are no longer in a \nparticular sequence. When you 're done, close the script without saving the \nchanges. \n7. \nOpen and run the queries for any of the other examples in this chapter that \nyou're interested in reviewing. \nEnter and run your own SELECT statements \nIn these exercises, you'll enter and run your own SELECT statements. To do \nthat, you can open the script for an example that is similar to the state1nent you \nneed to write, copy the statement into a new SQL tab, and modify the statement. \nThat can save you both time and syntax errors. \n8. \nWrite a SELECT statement that returns three columns fro1n the Vendors table: \nvendor_11ame, vendor_contact_last_naine, and vendor_contact_first_naine. \nThen, run this statement to make sure it works correctly. \nAdd an ORDER BY clause to this state1nent that sorts the result set by last \nname and then first name, both in ascending sequence. Then, run this state-\nment again to make sure it works correctly. This is a good way to build and \ntest a statement, one clause at a time. \n9. \nWrite a SELECT statement that returns one column from the Vendors table \nnamed full_name that joins the vendor_contact_last_name and \nvendor contact first name columns. \n-\nFor1nat this column with the last name, a co1nma, a space, and the first 11arne \nlike this: \nDoe, John \nSort the result set by last name and then first name in ascending sequence. \nReturn only the contacts whose last name begins with the letter A, B, C, or E. \nThis should retrieve 41 rows. \n10. Write a SELECT statement that returns these column names and data from \nthe Invoices table: \nDue Date \nThe invoice due date column \nInvoice Total \nThe invoice total colu1nn \n10% \nlOo/o of the value of invoice total \nPlus lOo/o \nThe value of invoice_total plus 10% \nReturn only the rows with an invoice total that's greater than or equal to 500 \nand less than or equal to 1000. This should retrieve 12 rows. \nSort the result set in descending sequence by invoice_due_date.\n\nSection 1 \nAn introduction to MySQL \n11. Write a SELECT statement that returns these columns from the Invoices \ntable: \ninvoice number \ninvoice total \npayment_credit_total \nbalance_due \nThe invoice number column \nThe invoice total column \nSum of the payment_total and credit_total \ncolumns \nThe invoice total column minus the \npayment_total and credit_total columns \nReturn only invoices that have a balance due that's greater than $50. \nSort the result set by balance due in descending sequence. \nUse the LIMIT clause so the result set contains only the rows with the 5 \nlargest balances. \nWork with nulls and test expressions \n12. Write a SELECT statement that returns these columns from the Invoices \ntable: \ninvoice number \ninvoice date \nbalance due \npayment_date \nThe invoice_number column \nThe invoice date column \nThe invoice_tota] column minus the payment_total \nand credit total columns \nThe payment_date column \nReturn only the rows where the payment_date column contains a null value. \nThis should retrieve 11 rows. \n13. Write a SELECT statement without a FROM clause that uses the \nc ·URRENT DATE function to return the current date in its default format. \nUse the DATE FORMAT function to format the current date in this format: \nnun-dd-yyyy \nThis displays the month, day, and four-digit year of the current date. \nGive this column an alias of current_date. To do that, you must enclose the \nalias in quotes since that name is already used by the CURRENT_DATE \nfunction. \n14. Write a SELECT statement without a FROM clause that creates a row with \nthese columns: \nstarting_principal \ninterest \nprincipal_plus_interest \nStarting principal of $50,000 \n6.5% of the principal \nThe principal plus the interest \nTo calculate the third column, add the expressions you used fo1· the first two \ncolumns.\n\nHow to retrieve data \nfrom two or more tables \nln the last chapter, you lea111ed how to create result sets that contain data from a \nsingle table. Now, this chapter shows you how to create result sets that contain \ndata from two or more tables. To do that, you can use an inner join, an outer \n• \n• \n• \nJOin, or a union. \nHow to work with inner joins ............................................. 114 \nHow to code an i11ner join ............................................................................ 114 \nHow to use table aliases ............................................................................... 116 \nHow to join to a table in another database .................................................. 118 \nHow to use compound join conditions ........................................................ 120 \nHow to use a self-join .................................................................................. 122 \nHow to join more than two tables ................................................................ 124 \nHow to use the implicit inner join syntax .................................................... 126 \nHow to work with outer joins ............................................. 128 \nHow to code an outer join ............................................................................ 128 \nOuter join examples ...................................................................................... 130 \nOther skills for working with joins .................................... 134 \nHow to join tables with the USING keyword .............................................. 134 \nHow to join tables with the NATURAL keyword ....................................... 136 \nHow to use cross joins ....................................................................................... 138 \nHow to work with unions ................................................... 140 \nHow to code a union .................................................................................... 140 \nA union that combines result sets from different tables .............................. 140 \nA union that combines result sets from the same tables ............................. 142 \nA union that simulates a full outer join ....................................................... 144 \nPerspective ......................................................................... 146",
          "pages": [
            129,
            130,
            131,
            132,
            133
          ],
          "relevance": {
            "score": 0.59,
            "sql_score": 1.0,
            "concept_score": 0.78,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "examples": {
          "text": "Section 1 \nAn introduction to MySQL \nHow to work with inner joins \nA join lets you combine columns from two or more tables into a single result \nset. To start, this chapter shows how to code the most common type of join, an \n• \n• \n• \ninner JOtn. \nHow to code an inner join \nsyntax is also called the SQL-92 syritax because it was introduced by the SQL-92 \nstandards. It's generally considered a best p1·actice to use this syntax. \nTo join data from two tables, you code the names of the two tables in the \nFROM clause along with the JOIN keyword and an ON phrase that specifies \nthe join condition. The join condition indicates how the two tables should be \ncompared. In most cases, they're compared based on the relationship between \nthe primary key of the first table and a foreign key of the second table. \nIn this figure, for example, the SELECT statement joins data from the \nVendors and Invoices tables based on the vendor_id column in each table. Since \nthe join condition uses the equal operator, the value of the vendor_id column in a \nrow in the Vendors table must match the vendor_id in a row in the Invoices table \nfor that row to be included in the result set. In other words, only vendors with \none or more invoices are included. Although you code most inner joins using \nthe equal operator, you can compare two tables based on other conditions too. \nFor example, you can use the greater than or less than operators for an inner join \ncondition. \nIn this figure, the Vendors table is joined with the Invoices table using \na column that has the same name in both tables: vendor_id. As a result, the \ncolumns must be qualified so MySQL can tell which table they come from. To \ncode a qualified column name, you can enter the table name and a pe1iod in front \nof the column name. In this figure, the SELECT statement only uses quali-\nfied column names in the join condition. However, you must qualify a column \nname anywhere it appears in the statement if the same name occurs in both \ntables. If you don't, MySQL returns an error indicating that the column name is \nambiguous.\n\nChapter 4 \nHow to retrieve data f rom two or m.ore tables \nThe explicit syntax for an inner join \nSELECT select_ list \nFROM table_ l \n[INNER] JOIN table_ 2 \nON join_condition_ l \n[[INNER] JOIN table_ 3 \nON join_condition_ 2] ... \nAn inner join of the Vendors and Invoices tables \nSELECT invoice_number, vendor_name \nFROM vendors INNER JOIN invoices \nON vendors.vendor_ id = invoices.vendor_id \nORDER BY invoice_number \ninvoice_number \nvendor name \n-\n► \n0-2058 \nMalloy Lithographing Inc \n0-2060 \nMalloy Lithographing Inc \n0-2436 \nMalloy Lithographing Inc \n1-200-5164 \nFederal Express Corporation \n1-202-2978 \nFederal Express Corporation \nYesmed,Inc \n(114 rows ) \nDescription \n• \nA join combines columns from two or more tables into a result set based on the \njoin conditions you specify. For an inner join, only those rows that satisfy the join \ncondition are included in the result set. \n• \nA join condition names a column in each of the two tables involved in the join and \nindicates how the two columns should be compared. In most cases, you use the \nequal operator to retrieve rows with matching columns. However, you can also use \nany of the other comparison operators in a join condition. \n• \nTables are typically joined on the relationship between the primary key in one table \nand a foreign key in the other table. However, you can also join tables based on \nrelationships not defined in the database. These are called ad hoc r·elationships. \n• \nIf the two co]umns in a join condition have the same name, you must qualify them \nwith the table name so MySQL can distinguish between them. To code a qitalified \ncolumn name, type the table name, followed by a period, followed by the column \nname. \nNote \n• \nThe INNER keyword is optional and is seldom used. \nHow to code an inner join \n\" L\n\nSection 1 \nAn introduction to MySQL \nHow to use table aliases \nWhen you name a table to be joined in the FROM clause, you can refer to \nthe table by an alias as shown in figure 4-2. A table alias is an alternative table \nname that's typically just a letter or two. This makes it easier to qualify the \ncolumn names in the rest of the statement, and it makes the query easier to code \nand read, especially when the table names are long. \nThe first example in this figure joins data from the Vendors and Invoices \ntables. Here, both tables have been assigned aliases that consist of a single letter. \nThe second example only assigns an alias to the second table, not the first. \nHere, the alias shortens the name of the Invoice_Line_Items table to just \nLine_ltems. As a result, the shorter name can be used to refer to the invoice_id \ncolumn of the table in the join condition. Although you can use this technique \nwhen you code a query, most programmers use abbreviations of the table names \nas shown in the first example and throughout the rest of this chapter. \nAfter you assign a table alias, you must use the alias in ,place of the original \ntable name throughout the query. Otherwise, MySQL returns an error message \ninstead of a result set.\n\nChapter 4 \nHow to retrieve data f rom two or m.ore tables \nThe syntax for an inner join that uses table aliases \nSELECT select_ list \nFROM table_ l al \n[INNER] JOIN table_ 2 a2 \nON al.colwnn_ name operator a2.colwnn_name \n[[INNER] JOIN table_ 3 a3 \nON a2.colwnn_ name operator a3.colwnn_name] ••• \nAliases for all tables \nSELECT invoice_number, vendor_name, invoice_due_date, \ninvoice_ total - payment_total - credit total AS balance due \nFROM vendors v JOIN invoices i \nON v.vendor_ id = i.vendor_ id \nWHERE invoice_total - payment_total - credit total> 0 \nORDER BY invoice_due_date DESC \ninvoice_nurnber \nvendor _name \ninvoice_due_date \nbalance_due \n► \nBlue Cross \n2018-08-31 \n224.00 \n0-2436 \nMalloy Lithographing Inc \n2018-08-30 \n10976.06 \n9982nl \nFord Motor Crecfrt Company \n2018-08-23 \n503. 20 \nP-0608 \nMalloy Lithographing Inc \n2018-08-22 \n19351.18 \n(11 rows) \nAn alias for only one table \nSELECT invoice_n.11mhAr, line_ item_ amnunt, line_ item_description \nFROM invoices JOIN invoice_line_ items line_ items \nON invoices.invoice id= line items.invoice id \nWHERE account_number = 540 \nORDER BY invoice date \nf invoice_number \nline item amount \nline j tern_ desoiption \n-\n► \nm211-001 \n478.00 \nPubftshers Marketing \n207. 78 \nProspect &st \n175-.00 \nCard deck advertising \n197/522 \n765.13 \nCatalog design \n(6 rows ) \nDescription \n• \nA table cilias is an alternative table name assigned in the FROM clause. You can use \nan alias, which is typically just a letter or two, to make a SQL statement easier to \ncode and read. \n• \nIf you assign an alias to a table, you must use that alias to refer to the table \nthroughout your query. You can't use the original table name. \n• \nYou ca11 use an alias for one table in a join without using an alias for another table. \nHow to use table aliases \nL \nV\n\nSection 1 \nAn introduction to MySQL \nHow to join to a table in another database \nIf you use the procedure described in appendix A (Windows) or appendix \nB (macOS) of this book to create the databases for this book, all of the tables \nare organized into three databases, which are also known as sche,nas. First, all \ntables pertaining to accounts payable such as the Vendors and Invoices tables are \nstored in the database, or schema, named AP. Then, all tables pertaining to order \nmanagement are stored in a database named OM. Finally, all tables that are used \nby the smaller examples presented in this book are stored in a database named \nEX. \nWhen you use MySQL Workbench to run a query against a database, you \ndon't need to qualify any table name with its database name. For example, when \nyou run a query against the AP database, you don't need to qualify the Vendors \ntable with the name of the database. \nHowever, you may occasionally need to join to a table that's in another \ndatabase. To do that, you must qualify the table name in the other database by \nprefixing the table name with the database name. For example, let's say you need \nto join the Vendors table in the AP database with the Customers table in the OM \ndatabase. To do that, you need to qualify the Customers table with the name of \nthe database as shown in figt1re 4-3.\n\nChapter 4 \nHow to retrieve data from two or m.ore tables \nThe syntax of a table name that's qualified with a database name \ndatabase_name.table_ name \nJoin to a table in another database \nSELECT vendor_ name, customer_ last_ name, customer_ first_ name, \nvendor_state AS state, vendor_city AS city \nFROM vendors v \nJOIN om.customers c \nON v.vendor_ zip_code = c.customer_ zip \nORDER BY state, city \n~ \nvendor name \nrustomer _last_name \nrustomer first name \nWells Fa~go Bank \n-\nMarissa \nKyle \nAzteklabel \nIrvin \nAnia \nZylka Design \nHolbrooke \nRashad \nLou Gentile's Flower Basket \nDamien \nDeborah \nCostco \nNeftaly \nThalia \nCostco \nHo!brooke \nRashad \nShields Design \nDamien \nDeborah \nWakefield Co \nHolbrooke \nRashad \nWakefield Co \nNeftaly \nThaffa \nGary McKeighan Insl.l' ance \nNeftaly \nThalia \nGary Mc:Keighan lnsllance \nHolbrooke \nRashad \nDigital Dreamwori<s \nNeftaly \nThaffa \n(37 rows) \nDescription \nstate \ncity \nAl. \nPhoenix \nCA \nAnaheim \nCA \nFresno \nCA \nFresno \nCA \nFresno \nCA \nFresno \nCA \nFresno \nCA \nFresno \nCA \nFresno \nCA \nFresno \nCA \nFresno \nCA \nFresno \n• \nA MySQL server can store tables in multiple databases. These databases are \nsometimes refe1Ted to as schemas. \n• \nWhen you run a SELECT statement against one database, you can join to a table in \nanother database if you have appropriate privileges. To do that, you must prefix the \ntable name in the other database with the name of that database. \nHow to join to a table in another database\n\nSection 1 \nAn introduction to MySQL \nHow to use compound join conditions \nAlthough a join condition typically consists of a single comparison, you can \ninclude two or more co1nparisons in a join condition using the AND and OR \noperators. Figure 4-4 shows how this works. \nThe query in tllis figure uses the AND operator to return the frrst and last \nnames of all customers in the Customers table whose frrst and last names also \nexist in the Employees table. Since Thomas Hardy is the only name that exists in \nboth tables, this is the only row that's returned in the result set for this query.\n\nChapter 4 \nHow to retrieve data from two or m.ore tables \nThe Customers table \nrustomerJd \nrustomer _last_name \nrustomer _first_name \ncustomer _address \nrustomer _city \nrustomer _state \"\" \n► \nAnders \nMaria \n345WinchellPI \nTrujillo \nAna \n1298 E Smathers St \nMoreno \nAntonio \n6925 N Parkland Ave \nHardy \nThomas \n83 d'Urberville Ln \nBerglund \nChristina \n22717E 73rd Ave \nMoos \nHanna \n1778 N Bovine Ave \nCiteaux \nFred \n1234Main St \n< \n(24 rows) \nThe Employees table \nemployeejd \nlast_name \nfirst_name \ndepartment_JlUJTiber \nmanagerJd \n► \nSmith \nCindy \n2. \nOOJ◄I \nJones \n8mer \nSimonian \nRalph \n2. \nHernandez \nOlivia \nAaronsen \nRobert \n2. \nWatson \nDenise \nHardy \nThomas \n(9 rows) \nAn inner join with two conditions \nSELECT customer_first_ name, customer_ last_name \nFROM customers c JOIN employees e \nON c.customer first name= e.first_ name \nAND c.customer_ last_name = e.last_name \nrustomer _first_name \nrustomer last name \n-\n--+--\n► \nThomas \nHardy \n(1 row) \nDescription \nAnderson \nIN \nBenton \nAR \nPuyaftup \n'vVA \nCasterbridge \nGA \nDubuque \nIA \nPeona \nIL \nNormal \nIL \n• \nA join condition can include two or more conditions connected by AND or OR \noperators. \nHow to use compound join conditions \nL \n'V \n>",
          "pages": [
            134,
            135,
            136,
            137,
            138,
            139,
            140,
            141
          ],
          "relevance": {
            "score": 0.48,
            "sql_score": 1.0,
            "concept_score": 0.56,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "commonMistakes": {
          "text": "Section 1 \nAn introduction to MySQL \nHow to use a self-join \nA self-join. joins a table to itself. Although self-joins are rare, they are \nsometimes useful for retrieving data that can't be retrieved any other way. For \nexample, figure 4-5 presents a self-join that returns rows from the Vendors table \nwhere the vendor is in a city and state that has at least one other vendor. In other \nwords, it does not return a vendor if that vendor is the only vendor in that city \nand state. \nSince this example uses the same table twice, it must use aliases to distin-\nguish one occurrence of the table from the other. In addition, this query must \nqualify each column name with a table alias since every column occurs in both \ntables. \nThen, the join condition uses three comparisons. The first two match the \nvendor_city and vendor_state columns in the two tables. As a result, the query \nreturns rows for vendors that are in the same city and state as another vendor. \nHowever, since a vendor resides in the same city and state as itself, a third \ncomparison is included to exclt1de rows that match a vendor with itself. To do \nthat, this condition uses the not-equal operator to compare the vendor_name \ncolumns in the two tables. \nIn addition, this statement includes the DISTINCT keyword. That way, a \nvendor appears only once in the result set. Otherwise, a vendor would appear \nonce for every other row with a matching city and state. For example, if a vendor \nis in a city and state that has nine other vendors in that city and state, this query \nwould return nine rows for that vendor. \nThis example also shows how you can use columns other than key columns \nin a join condition. Keep in nund, however, that this is an unusual situation and \nyou 're not likely to code joins like this often.\n\nChapter 4 \nHow to retrieve data f rom two or m.ore tables \nA self-join that returns vendors from cities in common with other vendors \nSELECT DISTINCT vl.vendor_name, vl.vendor_ city, \nvl.vendor_ state \nFROM vendors vl JOIN vendors v2 \nON vl.vendor_city = v2.vendor_city AND \nvl.vendor_state = v2.vendor_state AND \nvl.vendor_name <> v2.vendor_name \nORDER BY vl.vendor_state, vl.vendor_city \n__l vendor _name \nvendor_dty \nvendor _state \n► \nComputer Library \nPhoenix \nAZ \nAT&T \nPhoenix \nAZ \nWells Fargo Bank \nPhoenix \nAZ \nAztel< Label \nAnaheim \nCA \nBlue Shield of California \nAnaheim \nCA \nAbbey Office Fumshings \nFresno \nCA \nCalifornia Business Machines \nFresno \nCA \nPostmaster \nFresno \nCA \n(84 rows) \nDescription \n• \nA self-join is a join that joins a table with itself. \n• \nWhen you code a self-join, you must use aliases for the tables, and you must \nqualify each column name with the alias. \nHow to use a self-join\n\nSection 1 \nAn introduction to MySQL \nHow to join more than two tables \nSo far, this chapter has only showed how to join data from two tables. \nHowever, it's common for programmers to need to join data from more than \ntwo tables. For example, it's not unheard of to need to join 10 or more tables. \nFortunately, once you code the join condition correctly, you can often reuse it. \nThe SELECT statement in figure 4-6 joins data from four tables: Vendors, \nInvoices, Invoice_Line_Items, and General_Ledger_Accounts. Each of the \njoins is based on the relationship between the primary key of one table and a \nforeign key of the other table. For example, the account_number column is the \nprimary key of the General_Ledger_Accounts table and a foreign key of the \nInvoice Line Items table. \n-\nThis SELECT statement also begins to show how table aliases make a state-\nment easier to code and read. Here, the one-letter and two-letter aliases that are \nused for the tables allow you to code the ON clause more concisely.",
          "pages": [
            142,
            143,
            144
          ],
          "relevance": {
            "score": 0.37,
            "sql_score": 1.0,
            "concept_score": 0.33,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        }
      },
      "educational_notes": {
        "definition": "An outer join is a type of SQL join that returns all records from both tables, even if there are no matching rows between them. This is useful for retrieving data from multiple tables where you want to ensure all records from both tables are included in the result set.",
        "explanation": "Outer joins solve the problem of missing data when using inner joins. An inner join only returns rows where there is a match in both tables, which can lead to incomplete results if some records don't have corresponding entries in the other table. Outer joins include all records from both tables, filling in NULL values for non-matching rows. This ensures that no data is lost and provides a complete picture of the data across multiple tables.",
        "key_points": [
          "Key point 1: Outer joins return all records from both tables, including those without matches.",
          "Key point 2: Use LEFT JOIN to include all records from the left table and matching records from the right table.",
          "Key point 3: Be cautious with NULL values in outer join results, as they indicate no match was found.",
          "Key point 4: Always specify the columns you want to retrieve in an outer join query.",
          "Key point 5: Understand that outer joins can be more resource-intensive than inner joins due to the need to include non-matching records."
        ],
        "examples": [
          {
            "title": "Basic Usage",
            "code": "-- Basic LEFT JOIN example\nSELECT employees.employee_id, departments.department_name\nFROM employees\nLEFT JOIN departments ON employees.department_id = departments.department_id;",
            "explanation": "This query retrieves all employee records and their corresponding department names. If an employee does not have a department (NULL in the department_id), it will still include that employee's record with NULL for the department name."
          },
          {
            "title": "Practical Example",
            "code": "-- Practical scenario: Finding customers who have never made a purchase\nSELECT customers.customer_id, customers.customer_name\nFROM customers\nLEFT JOIN orders ON customers.customer_id = orders.customer_id\nWHERE orders.order_id IS NULL;",
            "explanation": "This query identifies all customers who have not placed any orders. It uses a LEFT JOIN to include all customer records and only those that do not have a matching order (NULL in the order_id) are returned."
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Forgetting to specify columns",
            "incorrect_code": "-- Incorrect: No column specified\nSELECT * FROM employees LEFT JOIN departments ON employees.department_id = departments.department_id;",
            "correct_code": "-- Correct: Specify columns explicitly\nSELECT employees.employee_id, departments.department_name FROM employees LEFT JOIN departments ON employees.department_id = departments.department_id;",
            "explanation": "Always specify the columns you want to retrieve. Using '*' can lead to unexpected results and is generally not recommended."
          },
          {
            "mistake": "Using INNER JOIN instead of OUTER JOIN",
            "incorrect_code": "-- Incorrect: Using INNER JOIN\nSELECT employees.employee_id, departments.department_name FROM employees INNER JOIN departments ON employees.department_id = departments.department_id;",
            "correct_code": "-- Correct: Use LEFT JOIN to include all records FROM both tables SELECT employees.employee_id, departments.department_name FROM employees LEFT JOIN departments ON employees.department_id = departments.department_id;",
            "explanation": "Outer joins are necessary when you want to ensure all records from both tables are included. Using an inner join will exclude non-matching records."
          }
        ],
        "practice": {
          "question": "Write a query that retrieves all products and their corresponding suppliers, including those without suppliers.",
          "solution": "-- Solution\nSELECT products.product_id, products.product_name, suppliers.supplier_name FROM products LEFT JOIN suppliers ON products.supplier_id = suppliers.supplier_id;"
        }
      },
      "llm_enhanced": true,
      "raw_text_preview": "Chapter 3 \nHow to retrieve data from a sin.gle table \nThe expanded syntax of the LIMIT clause \nLIMIT [offset,] row_count \nA SELECT statement with a LIMIT clause that starts with the first row \nSELECT ",
      "content_relevance": {
        "score": 0.59,
        "sql_score": 1.0,
        "concept_score": 0.78,
        "non_sql_penalty": 0.1,
        "is_relevant": true,
        "analysis": "SQL content"
      }
    },
    "insert-murach": {
      "id": "insert-murach",
      "title": "INSERT Statement",
      "definition": "Adding rows to tables with INSERT INTO and INSERT SELECT",
      "difficulty": "beginner",
      "page_references": [
        149,
        150,
        151,
        152,
        153,
        154,
        155,
        156,
        157,
        158,
        159,
        160,
        161,
        162,
        163,
        164,
        165,
        166,
        167,
        168
      ],
      "sections": {
        "definition": {
          "text": "Chapter 4 \nHow to retrieve data f rom two or m.ore tables \nThe explicit syntax for an outer join \nSELECT select_ list \nFROM table_ l \n{LEFTIRIGHT} [OUTER] JOIN table_ 2 \nON join_condition_ l \n[{LEFTIRIGHT} [OUTER] JOIN table_ 3 \nON join_condition_ 2] ... \nWhat outer joins do \nJoins of this type \nRetrieve unmatched rows from \nLeft outer join \nRight outer join \nA left outer join \nThe first (left) table \nThe second (right) table \nSELECT vendor_ name, invoice_number, invoice_total \nFROM vendors LEFT JOIN invoices \nON vendors.vendor_ id = invoices.vendor_id \nORDER BY vendor_name \n_J vendor _name \n► \nAbbey Office Furnishings \nAmerican Booksellers Assoc \nAmerican Express \nASCSigns \nI \nAse.om Hasler Mailing Systems \n(202 rows) \nDescription \ninvoice_number \nnvoice_total \n203339-13 \n17.50 \nl)QJ!t \n'®'' \nHWSI \nUPJII \nOPill \nUl9!1 \nl:tt!I \n• \nAn outer join 1·etrieves all rows that satisfy the join condition, plus unmatched rows \nin the left or right table. \n• \nIn most cases, you use the equal operator to retrieve rows with matching columns. \nHowever, you can also use any of the other comparison operators. \n• \nWhen a row with unmatched columns is retrieved, any columns from the other \ntable that are included in the result set are given null values. \nNote \n• \nThe OUTER keyword is optional and typically omitted. \nHow to code an outer join\n\nSection 1 \nAn introduction to MySQL \nOuter join examples \nTo give yot1 a better understanding of how outer joins work, figure 4-9 \nshows four more examples. To start, part 1 of this figure shows the Departments \ntable, the Employees table, and the Projects table from the EX database. These \ntables are used by the examples shown in parts 2 and 3 of this figure. In addition, \nthey're used in other examples later in this chapter. \nThe first example performs a left outer join on the Departments and \nEmployees tables. Here, the join condition joins the tables based on the values in \ntheir department_number columns. Then, the result set produced by this state-\nment, shows that department number 3 (Operations) is included in the result set \neven though none of the employees in the Employees table work in that depart-\nment. As a result, MySQL assigns a null value to the last_name column from \nthat table. \nThe second example uses a right outer join to join the Departments and \nEmployees table. In this case, all of the rows from the Employees table are \nincluded in the result set. However, two of the employees, Locario and Watson, \nare assigned to a department that doesn't exist in the Departments table. If \nthe department_number column in the Employees table had been defined as \na foreign key to the Departments table, this would not have been allowed by \nMySQL. In this case, though, a foreign key wasn't defi11ed, so null values are \nreturned for the department_name column in these two rows. \nWhen coding outer joins, it's a common practice to avoid using right joins. \nTo do that, yot1 can substitute a left outer join for a right outer join by reversing \nthe order of the tables in the FROM clause and using the LEFT keyword instead \nof RIGHT. This often makes it easier to read statements that join more than two \ntables. \nThe tlru:d example shows that you can use outer joins to work with more \nthan two tables. To do that, you use skills similar to those that you use to work \nwith inner joins with more than two tables. In this example, the statement uses \nleft outer joins to join all three tables: Departments, Employees, and Projects. \nBecause of this, the result set uses a null value to show that none of the \nemployees are assigned to the Operations department. In addition, the result set \nuses null values to show that two employees, Hardy and Jones, aren't assigned to \na project. \nThe fourth example shows that you can combine inner joins and outer joins \nin the same query. Here, the query works like the third example, but it uses \nan inner join for the frrst join instead of a left outer join. Because of this, the \nresult set doesn't include a row for the Operations department. However, it still \ndisplays the rows for the two employees, Hardy and Jones, that aren't assigned \nto a project.\n\nChapter 4 \nHow to retrieve data from two or m.ore tables \nThe Departments table \ndepartment_number \ndepartment_name \n► \nAccounting \nPayroU \nOperations \nPersonnel \nMaintenance \nThe Employees table \nI employeejd \nlast_name \nfirst_name \ndepartment_number \nmanager,Jd \n► \nSmith \nCindy \nU®Mi \nJones \nElmer \nSimonian \nRalph \nHernandez \nOlivia \nAaronsen \nRobert \nWatson \nDenise \nHardy \nThomas \nO'Leary \nRhea \nLocario \nPaulo \nThe Projects table \n_j project_number \nemployee_id \n► \nPlOll \nPlOll \nP1012 \nP1012 \nP1012 \ns \nP1013 \nP1013 \nP1014 \nDescription \n• \nThe examples in this figure use the Departments, Employees, and Projects tables \nfrom the EX database. \nOuter join examples (part 1 of 3)\n\nSection 1 \nAn introduction to MySQL \nA left outer join \nSELECT department_ name, d.department_number, last_name \nFROM departments d \nLEFT JOIN employees e \nON d.department_number = e.department_number \nORDER BY department_name \ndepartment_name \ndepartment_number \nlast_name \n► \nAccounting \nHernandez \nMaintenance \ns \nHardy \nOperations \nHlf191 \nPayroO \nSmith \nPayroU \nSimonian \nPayroO \nAaronsen \nPersonnel \nJones \nPersonnel \nO'Leary \n(8 rows) \nA right outer join \nSELECT department_ name, e.department_number, last_name \nFROM departments d \nRIGHT JOIN employees e \nORDER BY department_name \ndeparbnent_name \ndeparbnent_number \nlast name \n-\n► \nWatson \nLocario \nAccounting \nHernandez \nMahtenance \ns \nHardy \nPayroD \nSmith \nPayroO \nSimonian \nPayroll \nAaronsen \nPersonnel \nJones \nPersonnel \nO'leary \n(9 rows) \nDescription \n• \nA left outer join returns unmatched rows from the first (left) table. \n• \nA right outer join returns unmatched rows from the second (right) table. \nOuter join examples (part 2 of 3)",
          "pages": [
            149,
            150,
            151,
            152
          ],
          "relevance": {
            "score": 0.5,
            "sql_score": 1.0,
            "concept_score": 0.6,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "examples": {
          "text": "Chapter 4 \nHow to retrieve data from two or m.ore tables \nJoin three tables using left outer joins \nSELECT department_ name, last_name, project_nwnber \nFROM departments d \nLEFT JOIN employees e \nON d.department_nwnber = e.department_ nwnber \nLEFT JOIN projects p \nON e.employee_ id = p.employee_ id \nORDER BY department_name, last_name \n__l department_name \nlast name \nproject_number \n► \nAccounting \nHernandez \nPlOll \nMaintenance \nHardy \nIU991 \nOperations \nD©91 \n11®11 \nPayroD \nAaronsen \nPlOU \nPayroU \nSimonian \nPlOU \nPayroll \nSmith \nPlOU \nPersonnel \nJones \nOWII \nPersonnel \nO'Leary \nP1011 \n(8 rows ) \nCombine an outer and an inner join \nSELECT department_name, last_name, project_nwnber \nFROM departments d \nJOIN employees e \nON d. department_nwnber = e. department_ n11mber \nLEFT JOIN projects p \n~ \n~ \ndepartment_name \nlast name \nproject_number \nAccounting \nHernandez \nP10 11 \nMaintenance \nHardy \nIU991 \nPayroD \nAaronsen \nPlOU \nPayroll \nSimonian \nPlOU \nPayroll \nSmith \nPlOU \nPersonnel \nJones \n0®91 \nPersonnel \nO'Leary \nPlOll \n( 7 rows) \nDescription \n• \nYou can use outer joins to join multiple tables. \n• \nYou can combine inner and outer joins within a single SELECT statement. \nOuter join examples (part 3 of 3)\n\nSection 1 \nAn introduction to MySQL \nOther skills for working with joins \nNow that you know how to work with inner and outer joins, you 're ready to \nlearn how to join tables with the USING and NATURAL keywords. In addition, \nyou're ready to learn about another type of join, called a cross join. \nHow to join tables with the USING keyword \nWhen you use the equal operator to join two tables on a common column, \nthe join can be referred to as an equijoin (or an eqiti-join). When you code an \nequijoin, it's common for the columns that are being compared to have the same \nname. For joins like these, you can simplify the query with the USING keyword. \nTo do that, you code a USING clause instead of an ON clause to specify the join \nas shown in figure 4-10. \nThe first example in this figure shows how to join the Vendors and Invoices \ntables on the vendor id column with a USING clause. This returns the same \nresults as the query shown in figure 4-1 that uses the ON clause. However, the \nUSING clause only works because the vendor_id column exists in both the \nVendors and Invoices tables. \nThe second example shows how to join the Departments, Employees, and \nProjects tables with the USING keyword. Here, the first USING clause uses an \ninner join to join the Departments table to the Employees table on the depart-\nment_number column. Then, the second USING clause uses a left join to join \nthe Employees table to the Projects table on the employee_id column. This \nshows that you can use a USING clause for both inner and outer joins, and this \nquery returns the same result as the last query shown in figure 4-9. \nIn some rare cases, you may want to join tables by multiple columns. To \ndo that with a USING clause, you can code multiple column names within the \nparentheses, separating the column names with commas. This yields the same \nresult as coding two equijoins connected with the AND operator. \nSince the USING clause is more concise than the ON clause, it can make \nyour code easier to read and maintain. As a result, it often makes sense to use the \nUSING clause when you're developing new statements. However, if you can't \nget the USING clause to work correctly because of the way your database is \nstructured, you can always use the ON clause instead.\n\nChapter 4 \nHow to retrieve data from two or m.ore tables \nThe syntax for a join that uses the USING keyword \nSELECT select_list \nFROM table_ l \n[{LEFT IRIGHT} [OUTER]] JOIN table_ 2 \nUSING (join_colwnn_ l[, join_colwnn_ 2] ••• ) \n[[{LEFT IRIGHT} [OUTER]] JOIN table_ 3 \nUSING (join_ colwnn_ l[, join_colwnn_ 2] ••• )] • •• \nUse the USING keyword to join two tables \nSELECT invoice_number, vendor_name \nFROM vendors \nJOIN invoices USING (vendor_ id) \nORDER BY invoice_number \ninvoice_number \nvendor name \n-\n► \n0-2058 \nMalloy Lithographing Inc \n0-2060 \nMalloy Lithographing Inc \n0-2436 \nMalloy Lithographing Inc \n1-200-5164 \nFederal Express Corporation \n1-202-2978 \nFederal Express Corporation \nYesmed, Inc \n(114 rows) \nUse the USING keyword to join three tables \nSELECT department_name, last_name, project_number \nFROM departments \nJOIN employees USING (department_ number) \nLEFT JOIN projects USING (employee_id) \nORDER BY department_name \nf department_name \nlast name \nproject_number \n-\n► \nAccounting \nHernandez \nP1011 \nMaintenance \nHardy \nPayroD \nSimonian \nPlOU \nPayroll \nSmi1h \nPlOU \nPayroll \nAaronsen \nPlOU \nPersonnel \nO'Leary \nP1011 \nPersonnel \nJones \nt:[991 \n(7 rows) \nDescription \n• \nYou can use the USING keyword to simplify the syntax for joining tables. \n• \nThe join can be an inner join or an outer join. \n• \nThe tables must be joined by a column that bas the same name in both tables. \n• \nTo include multiple colu1nns, separate them with commas. \n• \nThe join must be an equijoin, which means that the equals operator is used to \ncompare the two columns. \nHow to join tables with the USING keyword \nL \nI \nI\n\nSection 1 \nAn introduction to MySQL \nHow to join tables with the NATURAL keyword \njoin. When you code a natural join, you don't specify the column that's used to \njoin the two tables. Instead, the database automatically joins the two tables based \non all columns in the two tables that have the same name. As a result, this type \nof join only works correctly if the database is designed in a certain way. \nFor instance, if you use a natural join to join the Vendors and Invoices tables \nas shown in the first example, the join works correctly because these tables only \nhave one column in common: the vendor_id column. As a result, the database \njoins these two tables on the vendor_id column. However, if these tables had \nanother column in common, this query would attempt to join these tables on \nboth columns and wot1ld yield unexpected results. \nIn addition, you may get unexpected results if you use natural joins for \ncomplex queries. In that case, you can use the USING or ON clause to explicitly \nspecify the join since these clauses give you more control over the join. If neces-\nsary, you can mix a natural join with the USING or ON clause within a single \nSELECT statement. In this figure, for example, the second SELECT statement \nuses a natural join for the first join and a USING clat1se for the second join. The \nresult is the same as the result for the second statement in figure 4-10. \nFinally, since natural joins don't explicitly specify the join colu1nn, they may \nnot work correctly if the structure of the database changes later. So although \nnatural joins are easy to code, you'll usually want to avoid using them for \nproduction code.\n\nChapter 4 \nHow to retrieve data f rom two or m.ore tables \nThe syntax for a join that uses the NATURAL keyword \nSELECT select_ list \nFROM table_ l \nNATURAL JOIN table_ 2 \n[NATURAL JOIN table 3] ••• \nUse the NATURAL keyword to join tables \nSELECT invoice_n,,rnber, vendor_name \nFROM vendors \nNATURAL JOIN invoices \nORDER BY invoice_ n11mhP.r \ninvoice number \nvendor _name \n-\n► \n0-2058 \nMalloy Lithographing Inc \n0-2060 \nMalloy Lithographing Inc \no-2.q36 \nMalloy Lithographing Inc \n1-200-5164 \nFederal Express Corporation \n1-202-2978 \nFederal Express Corporation \n108-13 \nYesmed, Inc \n(114 rows) \nUse the NATURAL keyword in a statement that joins three tables \nSELECT departrnent_name AS dept_name, last_name, project_number \nFROM departments \nNATURAL JOIN employees \nLEFT JOIN projects USING (employee_ id) \nORDER BY departme.nt_name \ndept_name \nlast_name \nproject_number \n► \nAccounting \nHernandez \nPlOll \nMaintenance \nHardy \nUPJ!I \nPayroD \nSimonian \nPlOU \nPayroD \nSmith \nP1012 \nPayroD \nAaronsen \nP1012 \nPersonnel \nO'Leary \nPlDll \nPersonnel \nJones \nIIOJ!I \n(7 rows ) \nDescription \n• \nYou can use the NATURAL keyword to create a natural join that joins two tables \nbased on all columns in the two tables that have the same name. \n• \nAlthough the code for a nat1rral join is shorter than the code for joins that use \nthe ON or USING clause, a natural join only works correctly for ce1tain types of \ndatabase structures. In addition, a natural join often yields unexpected results for \ncomplex queries. As a rest1lt, it's more common to t1se the ON or USING clause to \njoin tables. \nHow to join tables with the NATURAL keyword\n\nSection 1 \nAn introduction to MySQL \nHow to use cross joins \nA cross join produces a result set that includes each row from the first \ntable joined with each row fro1n the second table. The result set is known as \nthe Cartesian product of the tables. Figure 4-12 shows how to code a cross join \nusing either the explicit or implicit syntax. \nTo use the explicit syntax, you include the CROSS JOIN keywords between \nthe two tables in the FROM clause. Because of the way a cross join works, you \ndon't code an ON clause that includes a join condition. The same is true when \nyou use the implicit syntax. In that case, you simply list the tables in the FROM \nclause and omit the join condition from the WHERE clause. \nThe two SELECT statements in this figure illustrate how cross joins work. \nBoth of these statements combine data from the Departments and Employees \ntables. For both statements, the result is a table that includes 45 rows. That's \neach of the five rows in the Departments table combined with each of the nine \nrows in the Employees table. Although this result set is relatively small, you can \nimagine how large it would be if the tables included hundreds or thousands of \nrows. \nAs you study these examples, you should realize that cross joins have few \npractical uses. As a result, you'll rarely, if ever, need to use one. In fact, you're \nmost likely to code a cross join by accident if you use the implicit join syntax \nand forget to code the join condition in the WHERE clause. That's one of the \nreasons why it's generally considered a good practice to use the explicit join \nsyntax.\n\nChapter 4 \nHow to retrieve data f rom two or m.ore tables \nHow to code a cross join using the explicit syntax \nThe explicit syntax for a cross join \nSELECT select_list \nFROM table_ l CROSS JOIN table_ 2 \nA cross join that uses the explicit syntax \nSELECT departments.department_number, department_name, employee_id, \nlast name \nFROM departments CROSS JOIN employees \nORDER BY departments. department_n,,rnber \ndepartment_number \ndepartment_name \nemployeejd \nlast_name \n► \nAccounting \nJones \nAccounting \nHardy \nAccounting \nHernandez \nAccounbng \nSmith \nAccounting \nLocar10 \n(45 rows) \nHow to code a cross join using the implicit syntax \nThe implicit syntax for a cross join \nSELECT select_ list \nFROM table_l, table_2 \nA cross join that uses the implicit syntax \nSELECT departments. department_n,1rnber, department_name, employee_id, \nlast name \nFROM departments, employees \nORDER BY departments.department_number \ndepartment_number \ndepartment_name \nemployee_id \nlast name \n► \nAccounting \nJones \nAccounting \nHardy \nAccounting \nHernandez \nAccounting \nSrruth \nAccounting \nLocario \n(45 rows) \nDescription \n• \nA cross join joins each row from the first table with each row from the second \ntable. The resuJt set returned by a cross join is known as a Cartesian product. \nHow to use cross joins \n'--\n\nSection 1 \nAn introduction to MySQL \nHow to work with unions \nLike a join, a uriion combines data from two or more tables. Instead of \ncombining columns from base tables, however, a union combines rows from two \nor more result sets. \nHow to code a union \nkeyword to connect two or more SELECT statements. For this to work, the result \nof each SELECT statement must have the same number of columns, and the data \ntypes of the corresponding columns in each table must be compatible. \nIn this figure, we have indented all of the SELECT statements that are \nconnected by the UNION operator to make it easier to see how this statement \nworks. However, in a production environment, it's common to see the SELECT \nstatements and the UNION operator coded at the same level of indentation. \nIf you want to sort the result of a union operation, you can code an ORDER \nBY clause after the last SELECT statement. In an ORDER BY clause, you must \nuse the column names that are specified in the frrst SELECT statement. That's \nbecause the column names in the first SELECT statement are the ones that are \nused in the final result set. \nBy default, a union operation removes duplicate rows from the result set. \nIf that's not what you want, you can include the ALL keyword. In most cases, \nthough, you'll omit this keyword. \nA union that combines result sets \nfrom different tables \nThe example in figure 4-13 shows how to use a union to combine data from \ntwo different tables. In this case, the Active_Invoices table contains invoices with \noutstanding balances, and the Paid_Invoices table contains invoices that have \nbeen paid in full. Both of these tables have the same structure as the Invoices \ntable that's been used in this book so far. \nThis union operation combines the rows in both tables that have an invoice \ndate on or after June 1, 2018. Here, the first SELECT statement includes a \ncolumn named source that contains a literal value of ''Active.\" Then, the second \nSELECT statement includes a column by the same name, but it contains a literal \nvalue of ''Paid.\" This column is used to indicate which table each row in the \nresult set came from. \nAlthough this column is assigned the same name in both SELECT state-\nments, you don't have to use the same name for corresponding columns. That's \nbecause the corresponding relationships are determined by the order in which the \ncolumns are coded in the SELECT clauses, not by their names. When you use \ncolumn aliases, though, you'll typically assign the same name to corresponding \ncolumns so the statement is easier to understand.\n\nChapter 4 \nHow to retrieve data f rom two or m.ore tables \nThe syntax for a union operation \nSELECT_ statement_ l \nUNION [ALL] \nSELECT_ statement_ 2 \n[UNION [ALL] \nSELECT_ statement_ 3] ... \n[ORDER BY order_by_ list] \nA union that combines result sets from two different tables \nSELECT 'Active• AS source, invoice_number, invoice_date, invoice_total \nFROM active_ invoices \nWHERE invoice_date >= '2018-06-01' \nUNION \nSELECT 'Paid' AS source, invoice_numher, invoice_date, invoice total \nFROM paid_ invoices \nWHERE invoice_date >= \n1 2018-06-01 1 \nORDER BY invoice_ total DESC \nsource \ninvoice_number \ninvoice_date \ninvOlce _total \n► \nActive \n2018-07-18 \n21842.00 \nPaid \nP02-3772 \n2018-06-03 \n7125.3-1 \nPaid \n2018-06-0-1 \n4901.26 \nPaid \n2018-06-04 \n1750.00 \nPaid \nRTR-72-3662-X \n2018-06-0-1 \n1600.00 \nPaid \n75C-90227 \n2018-06-06 \n1367.50 \nPaid \nP02-88D77S7 \n2018-06-06 \n856.92 \nActive \nI7n71-001 \n2018-06-05 \n662.00 \nI \nActive \n9982nl \n2018-06-03 \n503.20 \n(22 rows) \nDescription \n• \nA union combines the result sets of two or more SELECT statements into one \nresult set. \n• \nEach result set must return the same number of columns, and the corresponding \ncolumns in each result set must have compatible data types. \n• \nBy default, a union eliminates duplicate rows. If you want to include duplicate \nrows, code the ALL keyword. \n• \nThe column names in the final result set are taken from the first SELECT clause. \nColumn aliases assigned by the other SELECT clauses have no effect on the final \nresult set. \n• \nTo sort the rows in the fmal result set, code an ORDER BY clause after the last \nSELECT statement. This clause must refer to the column names assigned in the \nfirst SELECT clause. \nHow to combine result sets from different tables\n\nSection 1 \nAn introduction to MySQL \nA union that combines result sets \nfrom the same tables \nThe first example in figure 4-14 shows how to use unions to combine result \nsets created from a single table. In this example, rows from the Invoices table \nthat have a balance due are combined with rows from the same table that ru:e \npaid in full. As in the previous figure, a column named source is added at the \nbeginning of each result set. That way, the final result set indicates whether each \ninvoice is active or paid. \nThe second example shows how to use unions to combine result sets created \nfrom the same two tables after they have been joined. Here, each SELECT \nstate1nent joins data from the Invoices and Vendors tables. The frrst SELECT \nstatement retrieves invoices with totals greater than $10,000. Then, it calculates \na payment of 33% of the invoice total. The two other SELECT statements are \nsimilar. The second one retiieves invoices with totals between $500 and $10,000 \nand calculates a 50% payment. And the third one retrieves invoices with totals \nless than $500 and sets the payment amount at 100% of the total. Although \nthis isn't the n1ost practical example, it helps illustrate the flexibility of union \noperations. \nIn both of these examples, the same column aliases are assigned in each \nSELECT statement. Although the aliases in the second and third SELECT state-\nments are optional, they make the query easier to read. In particular, they make \nit easy to see that the three SELECT statements have the same number and types \nof columns.",
          "pages": [
            153,
            154,
            155,
            156,
            157,
            158,
            159,
            160,
            161,
            162
          ],
          "relevance": {
            "score": 0.5,
            "sql_score": 1.0,
            "concept_score": 0.6,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "commonMistakes": {
          "text": "Chapter 4 \nHow to retrieve data from two or m.ore tables \nA union that combines result sets from a single table \nSELECT 'Active' AS source, invoice_number, invoice_date, invoice_total \nFROM invoices \nWHERE invoice_ total - payment_total - credit_ total > 0 \nUNION \nSELECT 'Paid' AS source, invoice_ number, invoice_date, invoice_ total \nFROM invoices \nWHERE invoice_total - payment_total - credit_total <= 0 \nORDER BY invoice_total DESC \nsource \ninvoice_number \ninvoice_date \ninvoice_total \n► \nPaid \n0-2058 \n2018-05-28 \n37966.19 \nPaid \nP-0259 \n2018-07-19 \n26881.40 \nPaid \n0-2060 \n2018-07-24 \n23517.58 \nPaid \n2018-06--01 \n21842.00 \nActive \nP-0608 \n2018-07-23 \n20551.18 \nActive \n0-2436 \n2018,-07-31 \n10976.06 \n(114 rows ) \nA union that combines result sets from the same two tables \nL , \nV \nSELECT invoice_number, vendor_name, '33% Payment' AS payment_type, \ninvoice_total AS total, invoice_total * 0.333 AS payment \nFROM invoices JOIN vendors \nON invoices.vendor_id = vendors.vendor_ id \nWHERE invoice_total > 10000 \nUNION \nSELECT invoice_number, vendor_ name, '50% Payment' AS payment_type, \ninvoice_total AS total, invoice_total * 0.5 AS payment \nFROM invoices JOIN vendors \nON invoices.vendor_ id = vendors.vendor_ id \nWHERE invoice total BETWEEN 500 AND 10000 \nUNION \nSELECT invoice_number, vendor_ name, 'Full amount' AS payment_type, \ninvoice_total AS total, invoice_total AS payment \nFROM invoices JOIN vendors \nWHERE invoice total < 500 \nORDER BY payment_type, vendor_name, invoice_ number \n► \ninvoice_number \n0-2058 \n0-2060 \n0-2436 \nP-0259 \nP-0608 \n(114 rows ) \nvendor _name \nData Reproductions Corp \nMalloy Lithographing Inc \nMalloy Lithographing Inc \nMalloy Lithographing Inc \nMaUoy Lithographing Inc \nMalloy Lithographing Inc \nBertelsmann Industry Svcs. Inc \npayment_type \n33o/o Payment \n33%Payment \n33%Payment \n33%Payment \n33%Payment \n33% Payment \n50°/4 Payment \ntotal \n21842.00 \n37966.19 \n23517. 58 \n10976.06 \n26881.40 \n20551.18 \n6g,.q().25 \npayment \n7273.38600 \n126-42. 74127 \n7831.35414 \n3655.02798 \n8951.50620 \n6843.54294 \n3470.12500 \nHow to combine result sets from the same tables \nI---\nI\n\nSection 1 \nAn introduction to MySQL \nA union that simulates a full outer join \nAfull outer join. returns unmatched rows from both the left and right tables. \nAlthough MySQL doesn't provide language for coding a full outer join, you can \nsimulate a full outer join by coding a union that combines the result sets for a \nleft outer join and a right outer join as shown in figu1·e 4-15. \nThe example in this figure uses the UNION keyword to combine the result \nsets for the left and 1ight outer joins shown in figure 4-9. As a result, this \nexample returns all the rows from the Departments and Employees tables even if \nthese rows don't have matching columns in the other table. \nTo make it easier to identify the unmatched rows, this statement includes \nthe department_number column from both tables. This shows that two rows in \nthe Employees table don't have matching rows in the Departments table, and \nit shows that one row in the Departments table doesn't have a matching row in \nthe Employees table. In other words, two employees haven't been assigned to a \ndepartment, and one depa1tment doesn't have any employees.\n\nChapter 4 \nHow to retrieve data from two or m.ore tables \nA union that simulates a full outer join \nSELECT department_name AS dept_name, d.department_ n11mber AS d_ dept_no, \ne.department_number AS e _dept_no, last_ name \nFROM departments d \nLEFT JOIN employees e \nON d. department_number = e. department_ n11mber \nUNION \nSELECT department_ name AS dept_name, d.department_number AS d_ dept_ no, \nFROM departments d \nRIGHT JOIN employees e \nORDER BY dept_name \n► \ndept_name \nAccounting \nMaintenance \nOperations \nPayroll \nPayroll \nPayroll \nI \nPersonnel \nPersonnel \n(10 rows ) \nDescription \nd_dept_no \nffi991 \ne_dept_no \nlast_name \nWatson \nlocario \nHernandez \nHardy \n001!1 \nlit!lil \nSmith \nSimonian \nAaronsen \nJones \nOleary \n• \nWhen you use afull outer join, the result set includes all the 1·ows from both tables. \n• \nMySQL doesn't provide language keywords for full outer joins, but you can \nsimulate a full outer join by using the UNION keyword to combine the result sets \nfrom a left outer join and a right outer join. \nHow to simulate a full outer join\n\nSection 1 \nAn introduction to MySQL \nPerspective \nIn this chapter, you learned a variety of techniques for combining data \nfrom two or more tables into a single result set. In particular, you learned how \nto use the explicit syntax to code inner joins. Of all the techniques presented in \nthis chapter, this is the one you'll use most often. So you'll want to be sure you \nunderstand it thorough! y before you go on. \nTerms \n• \n• \nJOin \njoin condition \n• \n• \n• \nmner JOtn \nad hoc relationship \nqualified column name \nexplicit syntax \nSQL-92 syntax \ntable alias \nschema \nself-join \nExercises \nimplicit syntax \nouter join \nleft outer join \nright outer join \n• • \n• \neqUIJOlll \nnatural join \n• \n• \ncross JOtn \nCa1tesian product \n• \nunion \nfull outer join \n1. \nWrite a SELECT statement that returns all columns from the Vendors table \ninner-joined with all columns from the Invoices table. This should return 114 \nrows. Hint: You can use an asterisk(*) to select the columns from both tables. \n2. \nWrite a SELECT statement that returns these four columns: \nvendor name \ninvoice number \ni11voice date \nbalance due \nThe vendor_name column from the Vendors table \nThe invoice number column from the Invoices table \nThe invoice date coltrmn from the Invoices table \nThe invoice_total column minus the payment_total \nand credit_total columns from the Invoices table \nUse these aliases for the tables: v for Vendors and i for Invoices. \nReturn one row for each invoice with a non-zero balance. This should return \n11 rows. \nSort the result set by vendor_name in ascending order. \n3. \nWrite a SELECT statement that returns these three columns: \nvendor name \ndefault account \ndescription \nThe vendor name column from the Vendors table \nThe default account number column from the \n-\nVendors table \nThe account_description column from the \nGeneral_Ledger_Accounts table \nReturn one row for eac.h vendor. This should return 122 rows. \nSort the result set by account_description and then by vendor_name.",
          "pages": [
            163,
            164,
            165,
            166
          ],
          "relevance": {
            "score": 0.4,
            "sql_score": 1.0,
            "concept_score": 0.4,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        }
      },
      "educational_notes": {
        "definition": "An outer join is a type of SQL query that retrieves rows from two or more tables based on a related column between them. It returns all records when there is a match in either left or right table, and null values for unmatched rows.",
        "explanation": "Outer joins are essential when you need to ensure that no data is lost due to missing matches between tables. For example, if you have two tables: one with vendor information and another with their invoices, an outer join will return all vendors, even those without any invoices, filling in null values for the invoice details.",
        "key_points": [
          "Key point 1: Outer joins include unmatched rows from both tables.",
          "Key point 2: Use LEFT JOIN to get all rows from the left table and matched rows from the right table.",
          "Key point 3: Avoid RIGHT JOINs; use LEFT JOIN with reversed tables instead.",
          "Key point 4: Combine inner and outer joins for more complex queries.",
          "Key point 5: Understand that unmatched columns are filled with null values."
        ],
        "examples": [
          {
            "title": "Basic Usage",
            "code": "SELECT vendor_name, invoice_number, invoice_total FROM vendors LEFT JOIN invoices ON vendors.vendor_id = invoices.vendor_id;",
            "explanation": "This query retrieves all vendors and their corresponding invoices. If a vendor has no invoices, the invoice details will be null."
          },
          {
            "title": "Practical Example",
            "code": "SELECT department_name, last_name, project_number FROM departments LEFT JOIN employees ON departments.department_number = employees.department_number LEFT JOIN projects ON employees.employee_id = projects.employee_id;",
            "explanation": "This query combines three tables to show all departments, their employees, and the projects they are assigned to. Unmatched rows will have null values for missing data."
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Using RIGHT JOIN instead of LEFT JOIN",
            "incorrect_code": "SELECT department_name, last_name FROM departments RIGHT JOIN employees ON departments.department_number = employees.department_number;",
            "correct_code": "SELECT department_name, last_name FROM departments LEFT JOIN employees ON departments.department_number = employees.department_number;",
            "explanation": "Students often mistakenly use RIGHT JOIN when they should be using LEFT JOIN to ensure all rows from the left table are included."
          }
        ],
        "practice": {
          "question": "Write a query that retrieves all customers and their orders, including those with no orders. Assume you have two tables: 'customers' and 'orders'.",
          "solution": "SELECT customer_name, order_id FROM customers LEFT JOIN orders ON customers.customer_id = orders.customer_id; This query will return all customers, even if they don't have any orders, filling in null values for the order details."
        }
      },
      "llm_enhanced": true,
      "raw_text_preview": "Chapter 4 \nHow to retrieve data f rom two or m.ore tables \nThe explicit syntax for an outer join \nSELECT select_ list \nFROM table_ l \n{LEFTIRIGHT} [OUTER] JOIN table_ 2 \nON join_condition_ l \n[{LEFTIR",
      "content_relevance": {
        "score": 0.6,
        "sql_score": 1.0,
        "concept_score": 0.8,
        "non_sql_penalty": 0.1,
        "is_relevant": true,
        "analysis": "SQL content"
      }
    },
    "update-murach": {
      "id": "update-murach",
      "title": "UPDATE Statement",
      "definition": "Modifying existing data with UPDATE and UPDATE JOIN",
      "difficulty": "beginner",
      "page_references": [
        165,
        166,
        167,
        168,
        169,
        170,
        171,
        172,
        173,
        174,
        175,
        176,
        177,
        178,
        179,
        180
      ],
      "sections": {
        "definition": {
          "text": "Chapter 4 \nHow to retrieve data from two or m.ore tables \nA union that simulates a full outer join \nSELECT department_name AS dept_name, d.department_ n11mber AS d_ dept_no, \ne.department_number AS e _dept_no, last_ name \nFROM departments d \nLEFT JOIN employees e \nON d. department_number = e. department_ n11mber \nUNION \nSELECT department_ name AS dept_name, d.department_number AS d_ dept_ no, \nFROM departments d \nRIGHT JOIN employees e \nORDER BY dept_name \n► \ndept_name \nAccounting \nMaintenance \nOperations \nPayroll \nPayroll \nPayroll \nI \nPersonnel \nPersonnel \n(10 rows ) \nDescription \nd_dept_no \nffi991 \ne_dept_no \nlast_name \nWatson \nlocario \nHernandez \nHardy \n001!1 \nlit!lil \nSmith \nSimonian \nAaronsen \nJones \nOleary \n• \nWhen you use afull outer join, the result set includes all the 1·ows from both tables. \n• \nMySQL doesn't provide language keywords for full outer joins, but you can \nsimulate a full outer join by using the UNION keyword to combine the result sets \nfrom a left outer join and a right outer join. \nHow to simulate a full outer join\n\nSection 1 \nAn introduction to MySQL \nPerspective \nIn this chapter, you learned a variety of techniques for combining data \nfrom two or more tables into a single result set. In particular, you learned how \nto use the explicit syntax to code inner joins. Of all the techniques presented in \nthis chapter, this is the one you'll use most often. So you'll want to be sure you \nunderstand it thorough! y before you go on. \nTerms \n• \n• \nJOin \njoin condition \n• \n• \n• \nmner JOtn \nad hoc relationship \nqualified column name \nexplicit syntax \nSQL-92 syntax \ntable alias \nschema \nself-join \nExercises \nimplicit syntax \nouter join \nleft outer join \nright outer join \n• • \n• \neqUIJOlll \nnatural join \n• \n• \ncross JOtn \nCa1tesian product \n• \nunion \nfull outer join \n1. \nWrite a SELECT statement that returns all columns from the Vendors table \ninner-joined with all columns from the Invoices table. This should return 114 \nrows. Hint: You can use an asterisk(*) to select the columns from both tables. \n2. \nWrite a SELECT statement that returns these four columns: \nvendor name \ninvoice number \ni11voice date \nbalance due \nThe vendor_name column from the Vendors table \nThe invoice number column from the Invoices table \nThe invoice date coltrmn from the Invoices table \nThe invoice_total column minus the payment_total \nand credit_total columns from the Invoices table \nUse these aliases for the tables: v for Vendors and i for Invoices. \nReturn one row for each invoice with a non-zero balance. This should return \n11 rows. \nSort the result set by vendor_name in ascending order. \n3. \nWrite a SELECT statement that returns these three columns: \nvendor name \ndefault account \ndescription \nThe vendor name column from the Vendors table \nThe default account number column from the \n-\nVendors table \nThe account_description column from the \nGeneral_Ledger_Accounts table \nReturn one row for eac.h vendor. This should return 122 rows. \nSort the result set by account_description and then by vendor_name.\n\nChapter 4 \nHow to retrieve data from two or m.ore tables \n4. \nWrite a SELECT statement that returns these five columns: \nvendor name \ninvoice date \ninvoice number \nli_sequence \nIi amount \nThe vendor name column from the Vendors table \nThe invoice date column from the Invoices table \nThe invoice number column from the Invoices table \nThe invoice_sequence column from the \nInvoice_Line_Items table \nThe line item amount column from the \n-\nInvoice_Line_Items table \nUse aliases for the tables. This should return 118 rows. \nSort the final result set by vendor_name, invoice_date, invoice_number, and \n• \n• \n1n voice _sequence. \n5. \nWrite a SELECT statement that returns three columns: \nvendor id \nvendor name \ncontact_name \nThe vendor id column from the Vendors table \nA concatenation of the vendor_contact_first_name \nand vendor_contact_last_name columns with a space \nbetween \nReturn one row for each vendor whose contact has the same last name as \nanother vendor's contact. This should return 2 rows. Hint: Use a self-join to \ncheck that the vendor_id columns aren't equal but the \nvendor _contact_last_name colu,nns are equal. \nSort the result set by vendor_contact_last_name. \n6. \nWrite a SELECT statement that returns these three columns: \naccount number \naccount_ description \ninvoice id \nThe account number column from the \nGeneral_Ledger_Accounts table \nThe account_description column from the \nGeneral_Ledger_Accounts table \nThe invoice id column from the \nInvoice Line Items table \n-\nReturn one row for each account number that has never been used. This \nshould return 54 rows. Hint: Use an outer join and only return rows where the \ninvoice_id column contains a null value. \nRemove the invoice_id column from the SELECT clause. \nSort the final result set by the account_number column. \n7. \nUse the UNION operator to generate a result set consisting of two columns \nfrom the Vendors table: vendor_name and vendor_state. If the vendor is in \nCalifornia, the vendor_state value should be ''CA''; otherwise, the \nvendor_state value should be ''Outside CA.\" Sort the final result set by \nvendor name.",
          "pages": [
            165,
            166,
            167,
            168
          ],
          "relevance": {
            "score": 0.42,
            "sql_score": 1.0,
            "concept_score": 0.25,
            "non_sql_penalty": 0.0,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "examples": {
          "text": "How to insert, update, \nand delete data \nln the last two chapters, you learned how to code the SELECT statement to \nretrieve and summarize data. Now, you'll learn how to code the INSERT, \nUPDATE, and DELETE statements to modify the data in a table. When you 're \ndone with this chapter, you' 11 know bow to code the four statements that are \nused every day by professional application developers. \nAs you read this chapter, keep in mind that by defau]t, MySQL automati-\ncally conunits changes to the database immediately after each INSERT, \nUPDATE, or DELETE statement is executed. Usually, that's what you want. \nIf it isn't, you can refer to chapter 14 to learn how to turn off auto-commit \nmode. \nHow to create test tables ................................................... 150 \nHow to create the tables for this book ......................................................... 150 \nHow to create a copy of a table .................................................................... 150 \nHow to insert new rows ..................................................... 152 \nHow to insert a single row ........................................................................... 152 \nHow to insert multiple rows ......................................................................... 152 \nHow to insert default values and null values ............................................... 154 \nHow to use a subquery in an INSERT statement ........................................ 156 \nHow to update existing rows ............................................. 158 \nHow to update rows ..................................................................................... 158 \nHow to use a subquery in an UPDATE statement ....................................... 160 \nHow to delete existing rows .............................................. 162 \nHow to delete rows ................. ...................................................................... 162 \nHow to use a subquery in a DELETE statement ......................................... 162 \nPerspective ......................................................................... 164\n\nSection 1 \nAn introduction to MySQL \nHow to create test tables \nBefore you begin experimenting with INSERT, UPDATE, and DELETE \nstatements, you need to make sure that your experimentation won't affect ''live'' \ndata that's used by other people at your business or school. \nHow to create the tables for this book \nIf you 're only working with the tables for this book, you can use the proce-\ndure shown in appendix A (Windows) or B (1nacOS) to create the tables for this \nbook. Then, you can experiment all you want without worrying about how much \nyou change these tables. If yot1 ever want to restore these tables to their original \nstate, you can use the procedure shown in the appendix to do that. \nHow to create a copy of a table \nIf you're working with tables that are running on a server that's available \nfrom your business or school, it's usually a good idea to create a copy of some \nor all of a table before you do any testing. To do that, you can use the CREATE \nTABLE AS statement with a SELECT statement as shown in figure 5-1 . When \nyou use this technique, the result set that's defmed by the SELECT statem.ent \nis copied into a new table. Then, you can experiment all you want with the test \ntable and delete it when you 're done. \nWhen you use this technique to create tables, MySQL only copies the \ncolumn definitions and data. In other words, MySQL doesn't retain other parts \nof the column definitions such as primary keys, foreign keys, and indexes. As \na result, when you experiment with copied tables, you may get different results \nthan you would get with the original tables. Still, this is usually preferable to \nexperimenting with live data. \nThe examples in this figure show how to use the CREATE TABLE AS \nstatement. Here, the frrst example copies all of the columns from all of the \nrows in the Invoices table into a new table named Invoices_ Copy. The second \nexample copies all of the columns in the Invoices table into a new table named \nOld_lnvoices, but only for rows where the balance due is zero. And the third \nexample c1·eates a table that contains summary data from the Invoices table. \nWhen you're done experimenting with test tables, you can use the DROP \nTABLE statement that's shown in this figure to delete any tables you don't need \nanymore. In this figure, for instance, the fourth example shows how to drop the \nOld Invoices table. \n-\n\nClzapter 5 \nHow to insert, update, and delete data \nThe syntax of the CREATE TABLE AS statement \nCREATE TABLE table_name AS select_ statement \nCreate a complete copy of the Invoices table \nCREATE TABLE invoices_copy AS \nSELECT* \nFROM invoices \nCreate a partial copy of the Invoices table \nCREATE TABLE old_ invoices AS \nSELECT* \nFROM invoices \nWHERE invoice_ total - payment_total - credit_total = 0 \nCreate a table with summary rows from the Invoices table \nCREATE TABLE vendor_balances AS \nSELECT vendor_ id, SUM(invoice_total) AS sum_of_ invoices \nFROM invoices \nWHERE (invoice_total - payment_total - credit_total) <> 0 \nGROUP BY vendor_ id \nDelete a table \nDROP TABLE old invoices \nDescription \n• \nYou can use the CREATE TABLE AS statement to create a new table based on the \nresult set defined by a SELECT state1nent. \n• \nEach column name in the SELECT clause must be unique. If you use calculated \nvalues in the select list, you 1nust name the column. \n• \nYou can code the other clauses of the SELECT statement just as yo11 would for any \nother SELECT statement, inclucling grouping, aggregates, joins, and subqueries. \n• If you code the CREATE TABLE AS statement as shown above, the table you \nname must not exist. If it does, you must delete the table by using the DROP \nTABLE statement before you execute the CREATE TABLE AS statement. \n• \nWhen you use the CREATE TABLE AS state1nent to create a table, only the \ncolumn definitions and data are copied. Definitions of primary keys, foreign keys, \nindexes, and so on are not included in the new table. \nHow to create a table from a SELECT statement\n\nSection 1 \nAn introduction to MySQL \nHow to insert new rows \nTo add rows to a table, you use the INSERT statement. In most cases, you \nuse this statement to add a single row to a table. However, you can also use it to \nadd multiple rows to a table. \nHow to insert a single row \na single row. Because the examples in this figure i11sert rows into the Invoices \ntable, this figure reviews the column definitions for this table. This shows the \nsequence of the columns in the table and which columns have default values or \nallow null values. It also shows that invoice_id is an auto increment column. \nWhen you code an INSERT statement, you name the table on the INSERT \nclause, followed by an optional list of columns. Then, you list the values to be \ninserted on the VALUES clause. \nThe first two examples in this figure illustrate how this works. The frrst \nexample doesn't include a column list. Because of that, the VALUES clause must \ninclude a value for every column in the table, and those values must be listed \nin the same sequence that the columns appear in the table. That way, MySQL \nknows which value to assign to which column. Notice that this statement uses \nthe NULL keyword to assign a null value to the payment_date column. You'll \nlearn more about using this keyword in the next figure. \nThe second INSERT statement includes a column list. However, this list \ndoesn't include four columns. It doesn't include the invoice id column since \nMySQL automatically increments this column if a value isn't specified. It \ndoesn't include the payment_total and credit_total columns since these columns \nprovide a default value of 0. And it doesn't include the payment_date column \nsince this column allows a null value. In addition, the columns aren't listed in the \nsame sequence as the columns in the table. When you include a list of columns, \nyou can code the columns in any sequence you like. Then, you just need to be \nsure you code the values in the VALUES clause in the same sequence. \nWhen you specify the values for the columns to be inserted, you must be \nsure that those values are compatible with the data types of the columns. For \nexample, you must enclose literal values for dates and strings within quotes. \nHowever, the quotes are optional when you code literal values for numbers. \nYou'll learn more about working with data types in chapter 8. For now, just \nrealize that if any of the values aren't compatible with the corresponding column \ndata types, MySQL returns an etTor and the row isn't inse1·ted. \nHow to insert multiple rows \nThe third example in figure 5-2 shows how to insert multiple rows. When \nyou do that, yot1 follow the same rules as you do for inserting a single row. Then, \nyou separate each list of values with a comma. This technique is often useful \nwhen you need to create a script that inserts data into a database.\n\nClzapter 5 \nHow to insert, update, and delete data \nThe syntax of the INSERT statement \nINSERT [INTO] table_ name [(column_ list)] \nVALUES (expression_ l[, expression_ 2] ... ) [, \n(expression_ l[, expression_ 2] ... )] ... \nThe column definitions for the Invoices table \ninvoice_ id \nINT \nNOT NULL \nvendor id \nINT \nNOT NULL, \ninvoice_ number \nVARCHAR ( 5 0) \nNOT NULL, \ninvoice_date \nDATE \nNOT NULL, \ninvoice_ total \nDECIMAL(9,2) \nNOT NULL, \npayment_ total \nDECIMAL(9,2) \nNOT NULL \ncredit_ total \nDECIMAL(9,2) \nNOT NULL \nterms id \nINT \nNOT NULL, \ninvoice_due_date \nDATE \nNOT NULL, \npayment_date \nDATE \nInsert a single row without using a column list \nINSERT INTO invoices VALUES \nAUTO_ INCREMENT, \nDEFAULT 0, \nDEFAULT 0, \n( 115, 9 7 , \n' 4 5 6 7 8 9 ' , \n' 2018-08-01 ' , 8 3 4 4 . 5 0, 0 , 0, 1, ' 2018-0 8 - 31 ' , NULL) \n( 1 row affected) \nInsert a single row using a column list \nINSERT INTO invoices \n(vendor_ id, invoice_number, invoice_ total, terms_ id, invoice_ date, \ninvoice_due_ date) \nVALUES \n( 97 I \nI 456789 I I \n8344 • 50 I \n1, \nI 2018-08-01 I I \nI 2018-08-31 1 ) \n( 1 row affected ) \nInsert multiple rows \nINSERT INTO invoices VALUES \n( 116 , 9 7 , \n' 4 5 6 7 01 ' , \n' 2 018 - 0 8 - 0 2 ' , 2 7 0 . 5 0 , 0 , 0 , 1, ' 2 0 18 - 0 9 - 01 ' , NULL) , \n( 117, 97, '456791', '2018-08-03', 4390. 00, 0, 0, 1, '2018-09-02', NULL), \n(118, 97, \n1 456792', '2018-08-03', 565.60, 0, 0, 1, '2018-09-02', NULL) \n( 3 rows affected) \nDescription \n• \nYou use the INSERT statement to add one or more rows to a table. \n• \nIn the INSERT clause, you specify the name of the table that you want to add a row \nto, along with an optional column list. The INTO keyword is also optional. \n• \nIn the VALUES clause, you specify the values to be inserted. If you don't include a \ncolumn list in the INSERT clause, you must specify the column values in the same \norder as in the table, and you must code a value for each column. If you include a \ncolumn list, you must specify the column values in the same order as in the column \nlist, and you can omit columns that have default values, accept null values, or are \nautomatically generated. \n• \nTo insert a null value into a colt1mn, you can use the NULL keyword. To insert a \ndefault value or to have MySQL generate a value for an auto increment column, \nyou can use the DEFAULT keyword. For more information, see figure 5-3. \nHow to insert rows\n\nSection 1 \nAn introduction to MySQL \nHow to insert default values and null values \nIf a column allows null values, you can use the INSERT statement to insert \na null value into that column. Si1nilarly, if a column is defined with a default \nvalue, you can use the INSERT statement to inse1t that value. Finally, if a \ncolumn is defined as an auto increment column, you can have MySQL generate \na value for the column. The technique you use depends on whether the INSERT \nstatement includes a column list, as shown by the examples in figure 5-3. \nAll of these INSERT statements use a table named Color_Sample from \nthe EX database. This table contains the three columns shown at the top of this \nfigure. The first column, color_id, is defined so MySQL automatically generates \nits value whenever necessary. The second column, color_number, is defined with \na default value of 0. And the third column, color_name, is defined so it allows \nnull values. \nThe first two statements show how to assign an automatically incremented \nvalue, a default value, or a null value using a column list. To do that, you omit \nthe column from the list. In the first statement, for example, the column list \nnames only the color_number column. As a result, MySQL automatically \nassigns a value of 1 to the color_id column (assuming the table doesn't contain \nany rows) and a null value to the color_name column. Similarly, in the second \nstatement, the column list na1nes only the color_name column. As a result, \nMySQL assigns a value of 2 to the color_id column and a value of O to the \ncolo1· number column. \nThe next three statements show how to assign an automatically incremented, \ndefault, or null value to a column without including a column list. To do that, \nyou can use the DEFAULT and NULL keywords. For example, the third state-\nment specifies a value for the colo1·_name column, but uses the DEFAULT \nkeyword for the color_id and color_number columns. As a result, MySQL \nassigns an automatically incremented value of 3 to the color_id column and a \ndefault value of O to the color_number column. The fourth statement uses the \nNULL keyword to assign a null value to the color_name column. Finally, the \nfifth statement shows what happens if you use the DEFAULT keyword for the \nfirst two columns and the NULL keyword for the third column.\n\nClzapter 5 \nHow to insert, update, and delete data \nThe column definitions for the Color_Sample table \ncolor_ id \ncolor_number \ncolor_name \nINT \nINT \nVARCHAR { 5 0) \nNOT NULL \nNOT NULL \nAUTO_ INCREMENT, \nDEFAULT O, \nFive INSERT statements for the Color_Sample table \nINSERT INTO color_ sample {color_number) \nVALUES {606) \nINSERT INTO color_ sample {color_ namA) \nVALUES {'Yellow') \nINSERT INTO color_ sample \nVALUES {DEFAULT, DEFAULT, 'Orange') \nINSERT INTO color_ sample \nVALUES (DEFAULT, 808, NULL) \nINSERT INTO color_ sample \nVALUES (DEFAULT, DEFAULT, NULL) \nThe Color_Sample table after the rows have been inserted \ncolor Jd \ncolor _number \ncolor_name \n► \nUM!I \nYellow \nOrange \n.q \n\"®'' \nH®!I \nDescription \n• If a column is defined so it allows null values, you can use the NULL keyword in \nthe list of values to insert a null value into that column. \n• \nIf a column is defined with a default va]11e, you can use the DEFAULT keyword in \nthe list of values to insert the default value for t11at column. \n• If a column is defined as an auto increment column, you can use the DEFAULT \nkeyword in the list of values to have MySQL generate the value for the column. \n• If you include a column list, you can omit columns with default values and null \nvalues. Then, the default value or null value is assigned automatically. You can also \nomit an auto increment column. Then, MySQL generates the value for the column. \nHow to insert default values and null values\n\nSection 1 \nAn introduction to MySQL \nHow to use a subquery in an INSERT statement \nA subquery is just a SELECT statement that's coded within another SQL \nstatement. Since you ah·eady know how to code SELECT statements, you \nshouldn't have much trouble coding subqueries as described in this chapter. \nThen, in chapter 7, you'll learn more about coding subqueries. \nboth examples use a SELECT statement instead of a VALUES clause. As a \nresult, the subquery specifies the values for the new rows by selecting these \nvalues from another table. \nBoth examples retrieve rows from the Invoices table and insert them into a \ntable named Invoice_Archive. This table is defined with the same columns as the \nInvoices table. However, the invoice_id column isn't defined as an auto incre-\nment column, and the payment_total and credit_total columns aren't defined \nwith default values. As a result, you must include values for these columns. \nThe first example shows how you can use a subquery in an INSERT state-\nment without a column list. In this example, the SELECT clause of the subquery \nuses an asterisk to retrieve all the columns in the Invoices table. Then, after \nMySQL applies the search condition in the WHERE clause, all the rows in the \nresult set are inserted into the Invoice Archive table. \nThe second example shows how you can use a subquery in an INSERT state-\n1nent with a column list. Just as when you use the VALUES clause, you can list \nthe columns in any sequence. However, the columns must be listed in the same \nsequence in the SELECT clause of the subquery. In addition, yot1 can omit auto \nincrement columns, columns that are defined with default values, and columns \nthat allow null values. \nWhen you code a subquery in an INSERT statement, you don't code paren-\ntheses around the SELECT statement. That's because the SELECT statement is \ncoded instead of the VALUES clause. However, when you code a subquery in \nthe WHERE clause of an UPDATE or INSERT statement, you do code paren-\ntheses around the SELECT statement. Later in this chapter, you'll see some \nexamples of this. \nBefo1·e you execute an INSERT statement that uses a subquery, you should \nmake sure that the rows and columns retrieved by the subquery are the ones \nyou want to insert. To do that, you can execute the SELECT statement by itself. \nThen, when you're sure it retrieves the co1Tect data, you can add the INSERT \nclause to insert the rows into another table.",
          "pages": [
            169,
            170,
            171,
            172,
            173,
            174,
            175,
            176
          ],
          "relevance": {
            "score": 0.7,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "commonMistakes": {
          "text": "Clzapter 5 \nHow to insert, update, and delete data \nThe syntax for using a subquery to insert one or more rows \nINSERT [INTO] table_ name [(column_ list)] select_statement \nInsert paid invoices into the lnvoice_Archive table \nINSERT INTO invoice_archive \nSELECT* \nFROM invoices \nWHERE invoice_ total - payment_total - credit_total = 0 \n(103 rows affected) \nThe same statement with a column list \nINSERT INTO invoice archive \n(invoice_id, vendor_ id, invoice_number, invoice_total, credit_ total, \npayment_total, terms_id, invoice_date, invoice_due_date) \nSELECT \ninvoice_ id, vendor_ id, invoice_number, invoice_ total, credit_ total, \npayment_total, terms_ id, invoice_date, invoice_due_date \nFROM invoices \nWHERE invoice total - payment_total - credit_total = 0 \n(103 rows affected) \nDescription \n• \nA subquery is a SELECT statement that's coded within another SQL statement. \n• \nTo insert rows selected from one or more tables into another table, you can code a \nsubquery in place of the VALUES clause. Then, MySQL inserts the rows returned \nby the subquery into the target table. For this to work, the target table must already \n. \nexist. \n• \nThe rules for working with a column list are the same as they are for any INSERT \nstatement. \nHow to use a subquery in an INSERT statement\n\nSection 1 \nAn introduction to MySQL \nHow to update existing rows \nTo modify the data in one or 1nore rows of a table, you use the UPDATE \nstatement. Although most of the UPDATE statements you code will perform \nsimple updates, you can also code more complex UPDATE statements that \ninclude subqueries if necessary. \nHow to update rows \nstatements include all three of the clauses shown here. The UPDATE clause \nnames the table to be updated. The SET clause names the columns to be updated \nand the values to be assigned to those columns. And the WHERE clause speci-\nfies the condition a row must meet to be updated. \nWhen you use MySQL Workbench, you should realize that it will execute \nan UPDATE statement only if the condition on the WHERE clause refers to a \nprimary or foreign key. That's because, by default, Workbench runs in ''safe \nupdate'' mode. If that's not what you want, you can turn safe update mode off \nas described in this figure. For example, because the WHERE clause in the first \nand third UPDATE statements in this figure refer to the invoice_number column, \nwhich isn't a key column, you have to turn safe mode off to execute them. \nThe first UPDATE statement modifies the values of two columns in the \nInvoices table: payment_date and payment_total. Since the WHERE clause in \nthis statement identifies a single row, MySQL only updates the columns in that \nrow. In this example, the values for the columns are coded as a literal values. You \nshould realize, though, that you can assign any valid expression to a column as \nlong as it evaluates to a value that's compatible with the data type of the column. \nYou can also use the NULL keyword to assign a null value to a column that \nallows nulls, and you can use the DEFAULT keyword to assign the default value \nto a column that's defined with a default value. \nThe second UPDATE statement modifies a single column in the Invoices \ntable: terms_id. This time, however, the WHERE clause specifies that all the \nrows for vendor 95 should be updated. Since this vendor has six rows in the \nInvoices table, MySQL updates all six rows. \nThe third UPDATE statement shows how you can use an expression to \nassign a value to a column. In this case, the expression increases the value of \nthe credit_total column by 100. Like the first UPDATE state1nent, this state1nent \nupdates a single row. \nBefore you execute an UPDATE statement, you may want to make sure that \nyou've selected the correct rows. To do that, you can code a SELECT statement \nwith the same seai·ch condition. Then, if the SELECT statement returns the \ncorrect rows, you can copy its WHERE clause into your UPDATE statement.\n\nClzapter 5 \nHow to insert, update, and delete data \nThe syntax of the UPDATE statement \nUPDATE table_name \nSET column_name_ l = expression_l[, column name 2 = expression_ 2] ..• \n[WHERE search_ condition] \nUpdate two columns for a single row \nUPDATE invoices \nSET payment_date = '2018-09-21', \npayment_ total = 19351.18 \nWHERE invoice_number = \n1 97/522 1 \n(1 row affected) \nUpdate one column for multiple rows \nUPDATE invoices \nSET terms_ id = 1 \nWHERE vendor_ id = 95 \n(6 rows affected) \nUpdate one column for one row \nUPDATE invoices \nSET credit_ total = credit_ total + 100 \nWHERE invoice_ D11mbP.r = '97 /522' \n(1 row affected) \nDescription \n• \nYou use the UPDATE statement to modify one or more rows in a table. \n• \nIn the SET clause, you name each column and its new value. Yott can specify the \nvalue for a column as a literal or an expression. \n• \nIn the WHERE clause, you can specify the conditions that 1nust be met for a row to \nbe updated. \n• \nYou can use the DEFAULT and NULL keywords to specify default and null values \nas described in figure 5-3. \n• \nBy default, MySQL Workbench 1uns in safe update mode. That prevents you from \nupdating rows if the WHERE clause is omitted or doesn't 1·efer to a primary key or \nforeign key column. \n• \nTo get around the restrictions of safe update mode, you can turn this mode off. To \ndo that, select the Edit➔ \nPreferences command, select the SQL Editor node, change \nthe ''Safe Updates'' option, and restart MySQL Workbench. \nWarning \n• \nIf you turn off safe update mode and omit the WHERE clause, all rows in the table \nwill be updated. \nHow to update rows",
          "pages": [
            177,
            178,
            179
          ],
          "relevance": {
            "score": 0.7,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        }
      },
      "educational_notes": {
        "definition": "The UPDATE statement is used to modify existing records in a database table. It allows you to change data without having to delete and recreate rows.",
        "explanation": "The UPDATE statement solves the problem of needing to change data in an existing table without losing any other information. Here's how it works:\n1. You specify which table you want to update.\n2. You define a condition that identifies which rows should be updated.\n3. You set new values for one or more columns in those rows.\n\nFor example, if you have a 'students' table and you need to change the grade of a student with ID 101, you would use an UPDATE statement like this:\nUPDATE students SET grade = 'A' WHERE student_id = 101;\nThis changes only the grade for that specific student without affecting any other data in the table.\n\nYou should use the UPDATE statement when you need to make changes to existing records. Be careful not to update too many rows at once, as this can be time-consuming and may cause unintended side effects.",
        "key_points": [
          "Most important thing to remember: Always specify a WHERE clause to avoid updating all rows in the table.",
          "Critical detail about usage: Use transactions for large updates to ensure data integrity.",
          "Common pitfall to avoid: Forgetting to include a WHERE clause and accidentally updating every row.",
          "Best practice or tip: Test your UPDATE statement on a small subset of data before running it on the entire table.",
          "How this connects to other concepts: The UPDATE statement is often used in conjunction with SELECT statements to identify which rows need to be updated."
        ],
        "examples": [
          {
            "title": "Basic Usage",
            "code": "UPDATE employees SET salary = salary * 1.10 WHERE department_id = 5;",
            "explanation": "This example updates the salary of all employees in department 5 by increasing it by 10%. The WHERE clause ensures that only relevant rows are affected.",
            "validation_note": "SQL auto-fixed: "
          },
          {
            "title": "Practical Example",
            "code": "UPDATE inventory SET stock_level = stock_level - 1 WHERE product_id = 'P1234';",
            "explanation": "In a real-world scenario, this might be used to decrease the stock level of a specific product after it has been sold. The WHERE clause ensures that only the correct product is updated.",
            "validation_note": "SQL auto-fixed: "
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Forgetting the WHERE clause",
            "incorrect_code": "UPDATE employees SET salary = salary * 1.10;",
            "correct_code": "UPDATE employees SET salary = salary * 1.10 WHERE department_id = 5;",
            "explanation": "This mistake updates all rows in the table, which is usually not intended. Always include a WHERE clause to specify which rows should be updated."
          }
        ],
        "practice": {
          "question": "Write an UPDATE statement that increases the price of all products in category 'Electronics' by 5%. Use a transaction to ensure data integrity.",
          "solution": "BEGIN TRANSACTION;\nUPDATE products SET price = price * 1.05 WHERE category = 'Electronics';\nCOMMIT;"
        }
      },
      "llm_enhanced": true,
      "raw_text_preview": "Chapter 4 \nHow to retrieve data from two or m.ore tables \nA union that simulates a full outer join \nSELECT department_name AS dept_name, d.department_ n11mber AS d_ dept_no, \ne.department_number AS e ",
      "content_relevance": {
        "score": 0.7,
        "sql_score": 1.0,
        "concept_score": 1.0,
        "non_sql_penalty": 0.1,
        "is_relevant": true,
        "analysis": "SQL content"
      }
    },
    "delete-murach": {
      "id": "delete-murach",
      "title": "DELETE Statement",
      "definition": "Removing rows with DELETE and DELETE JOIN",
      "difficulty": "beginner",
      "page_references": [
        177,
        178,
        179,
        180,
        181,
        182,
        183,
        184,
        185,
        186,
        187,
        188
      ],
      "sections": {
        "definition": {
          "text": "Clzapter 5 \nHow to insert, update, and delete data \nThe syntax for using a subquery to insert one or more rows \nINSERT [INTO] table_ name [(column_ list)] select_statement \nInsert paid invoices into the lnvoice_Archive table \nINSERT INTO invoice_archive \nSELECT* \nFROM invoices \nWHERE invoice_ total - payment_total - credit_total = 0 \n(103 rows affected) \nThe same statement with a column list \nINSERT INTO invoice archive \n(invoice_id, vendor_ id, invoice_number, invoice_total, credit_ total, \npayment_total, terms_id, invoice_date, invoice_due_date) \nSELECT \ninvoice_ id, vendor_ id, invoice_number, invoice_ total, credit_ total, \npayment_total, terms_ id, invoice_date, invoice_due_date \nFROM invoices \nWHERE invoice total - payment_total - credit_total = 0 \n(103 rows affected) \nDescription \n• \nA subquery is a SELECT statement that's coded within another SQL statement. \n• \nTo insert rows selected from one or more tables into another table, you can code a \nsubquery in place of the VALUES clause. Then, MySQL inserts the rows returned \nby the subquery into the target table. For this to work, the target table must already \n. \nexist. \n• \nThe rules for working with a column list are the same as they are for any INSERT \nstatement. \nHow to use a subquery in an INSERT statement\n\nSection 1 \nAn introduction to MySQL \nHow to update existing rows \nTo modify the data in one or 1nore rows of a table, you use the UPDATE \nstatement. Although most of the UPDATE statements you code will perform \nsimple updates, you can also code more complex UPDATE statements that \ninclude subqueries if necessary. \nHow to update rows \nstatements include all three of the clauses shown here. The UPDATE clause \nnames the table to be updated. The SET clause names the columns to be updated \nand the values to be assigned to those columns. And the WHERE clause speci-\nfies the condition a row must meet to be updated. \nWhen you use MySQL Workbench, you should realize that it will execute \nan UPDATE statement only if the condition on the WHERE clause refers to a \nprimary or foreign key. That's because, by default, Workbench runs in ''safe \nupdate'' mode. If that's not what you want, you can turn safe update mode off \nas described in this figure. For example, because the WHERE clause in the first \nand third UPDATE statements in this figure refer to the invoice_number column, \nwhich isn't a key column, you have to turn safe mode off to execute them. \nThe first UPDATE statement modifies the values of two columns in the \nInvoices table: payment_date and payment_total. Since the WHERE clause in \nthis statement identifies a single row, MySQL only updates the columns in that \nrow. In this example, the values for the columns are coded as a literal values. You \nshould realize, though, that you can assign any valid expression to a column as \nlong as it evaluates to a value that's compatible with the data type of the column. \nYou can also use the NULL keyword to assign a null value to a column that \nallows nulls, and you can use the DEFAULT keyword to assign the default value \nto a column that's defined with a default value. \nThe second UPDATE statement modifies a single column in the Invoices \ntable: terms_id. This time, however, the WHERE clause specifies that all the \nrows for vendor 95 should be updated. Since this vendor has six rows in the \nInvoices table, MySQL updates all six rows. \nThe third UPDATE statement shows how you can use an expression to \nassign a value to a column. In this case, the expression increases the value of \nthe credit_total column by 100. Like the first UPDATE state1nent, this state1nent \nupdates a single row. \nBefore you execute an UPDATE statement, you may want to make sure that \nyou've selected the correct rows. To do that, you can code a SELECT statement \nwith the same seai·ch condition. Then, if the SELECT statement returns the \ncorrect rows, you can copy its WHERE clause into your UPDATE statement.\n\nClzapter 5 \nHow to insert, update, and delete data \nThe syntax of the UPDATE statement \nUPDATE table_name \nSET column_name_ l = expression_l[, column name 2 = expression_ 2] ..• \n[WHERE search_ condition] \nUpdate two columns for a single row \nUPDATE invoices \nSET payment_date = '2018-09-21', \npayment_ total = 19351.18 \nWHERE invoice_number = \n1 97/522 1 \n(1 row affected) \nUpdate one column for multiple rows \nUPDATE invoices \nSET terms_ id = 1 \nWHERE vendor_ id = 95 \n(6 rows affected) \nUpdate one column for one row \nUPDATE invoices \nSET credit_ total = credit_ total + 100 \nWHERE invoice_ D11mbP.r = '97 /522' \n(1 row affected) \nDescription \n• \nYou use the UPDATE statement to modify one or more rows in a table. \n• \nIn the SET clause, you name each column and its new value. Yott can specify the \nvalue for a column as a literal or an expression. \n• \nIn the WHERE clause, you can specify the conditions that 1nust be met for a row to \nbe updated. \n• \nYou can use the DEFAULT and NULL keywords to specify default and null values \nas described in figure 5-3. \n• \nBy default, MySQL Workbench 1uns in safe update mode. That prevents you from \nupdating rows if the WHERE clause is omitted or doesn't 1·efer to a primary key or \nforeign key column. \n• \nTo get around the restrictions of safe update mode, you can turn this mode off. To \ndo that, select the Edit➔ \nPreferences command, select the SQL Editor node, change \nthe ''Safe Updates'' option, and restart MySQL Workbench. \nWarning \n• \nIf you turn off safe update mode and omit the WHERE clause, all rows in the table \nwill be updated. \nHow to update rows",
          "pages": [
            177,
            178,
            179
          ],
          "relevance": {
            "score": 0.32,
            "sql_score": 1.0,
            "concept_score": 0.25,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "examples": {
          "text": "Section 1 \nAn introduction to MySQL \nHow to use a subquery in an UPDATE statement \nWhen you code the search condition on the WHERE clause of an UPDATE \nstatement, you can include a subquery to identify the rows to be updated. \nFigUI·e 5-6 presents two statements that ill11strate how you do that. \nIn the frrst statement, a subquery is used in the WHERE clause to identify \nthe invoices to be updated. This subquery returns the vendor_id value for the \nvendor in the Vendors table with the name ''Pacific Bell.\" Then, all the invoices \nwith that vendor_id value are updated. \nThe second UPDATE statement also uses a subquery in the WHERE clause. \nThis subquery returns a list of the vendor_id values for all vendors in Califorrtia, \nArizona, and Nevada. Then, the IN operator is used to update all the invoices \nwith vendor_id values in that list. Although this subquery returns 80 vendors, \nmany of these vendors don't have invoices. As a result, the UPDATE statement \nonly affects 40 invoices. \nTo execute the second UPDATE statement from MySQL Workbench, you \nhave to turn safe update mode off. That's because the WHERE clause in this \nstatement uses the IN operator.\n\nUpdate all invoices for a vendor \nUPDATE invoices \nSET terms id= 1 \nWHERE vendor_ id = \n(SELECT vendor_ id \nFROM vendors \nClzapter 5 \nHow to insert, update, and delete data \nWHERE vendor_name = 'Pacific Bell' ) \n(6 rows affected) \nUpdate the terms for all invoices for vendors in three states \nUPDATE invoice s \nSET terms_ id = 1 \nWHERE vendor_ id IN \n(SELECT vendor_ id \nFROM vendors \nWHERE vendor_ state IN ( 'CA', 'AZ', 'NV' )) \n(40 rows affected) \nDescription \n• \nYou can code a subquery in the WHERE clause of an UPDATE statement to \nprovide one 01· more values used in the search condition. \nHow to use a subquery in an UPDATE statement\n\nSection 1 \nAn introduction to MySQL \nHow to delete existing rows \nTo delete one or more rows from a table, you use the DELETE statement. If \nnecessary, you can use subqueries in a DELETE statement to help identify the \nrows to be deleted. \nHow to delete rows \nexamples that show how it works. To start, the DELETE clause specifies the \nname of the table and must include the FROM keyword. \nThe WHERE clause specifies a search condition that identifies the rows to \nbe deleted. Although this clause is optional, you'll almost always include it. If \nyou don't, you could inadvertently delete all of the rows in the table. Fortunately, \nM ySQL Workbench runs in safe t1pdate mode by default, which prevents a \nDELETE statement from executing if it doesn't include a WHERE clause that \nrefers to a primary key or foreign key column. \nIf you want to make sure that you've selected the correct rows before you \ndelete them, you can code a SELECT statement that retrieves those rows. Then, \nonce you're sure the SELECT state1nent is retii eving the con·ect rows, you can \nconvert the SELECT statement to a DELETE statement. \nThe first DELETE statement in this figure deletes a single row from the \nGeneral_Ledger_Accounts table. To do that, it specifies the account_number \nvalue of the row to be deleted in the WHERE clause. The second DELETE \nstatement deletes a single row from the Invoice_Line_ltems table. To do that, \nit specifies the invoice_id value and the invoice_sequence value of the row to \nbe deleted in the WHERE clause. Finally, the third DELETE statement deletes \nfour rows from the Invoice_Line_Items table. To do that, it specifies 12 as the \ninvoice id value of the row to be deleted. Since the invoice for this ID has four \nline items, this deletes all four line items. \nIf you try to delete a row that has one or more related rows in another table, \nMySQL typically returns an error message and doesn't delete the row. For \nexample, MySQL returns an error message if you attempt to delete a row from \nthe Vendors table that has related rows in the Invoices table. Usually, that's what \nyou want. \nHow to use a subquery in a DELETE statement \nIf you want to delete a row from the Vendors table that has related rows in \nthe Invoices table, you need to start by deleting the rows in the \nInvoice_Line_Items table for the vendor's invoices. To do that, you can use \na subquery as shown in the fourth example in figure 5-7. Here, the subquery \nselects all the invoice IDs for the vendor from the Invoices table. Then, the \nDELETE statement deletes all the invoice line items with those IDs.\n\nThe syntax of the DELETE statement \nDELETE FROM table_name \n[WHERE search_ condition] \nDelete one row \nDELETE FROM general_ledger_accounts \nWHERE account_ number = 306 \n(1 row affected) \nClzapter 5 \nHow to insert, update, and delete data \nDelete one row using a compound condition \nDELETE FROM invoice_ line_items \nWHERE invoice id= 78 AND invoice_ sequence = 2 \n(1 row affected) \nDelete multiple rows \nDELETE FROM invoice_line_ items \nWHERE invoice id= 12 \n(4 rows affected) \nUse a subquery in a DELETE statement \nWHERE invoice_ id IN \n(SELECT invoice_ id \nFROM invoices \nWHERE vendor id= 115) \n(4 rows affected) \nDescription \n• \nYou can use the DELETE statement to delete one or more rows from the table you \nname in the DELETE clause. \n• \nYou specify the conditions that must be met for a row to be deleted in the WHERE \nclause. \n• \nYou can use a subquery within the WHERE clause. \n• \nA foreign key constraint may prevent you from deleting a row. In that case, you can \nonly delete the row if you delete all child rows for that row first. \n• \nBy default, MySQL Workbench runs in safe update mode. That prevents you from \ndeleting rows if the WHERE clause is omitted or doesn't refer to a primary key or \nforeign key column. For information on turning safe update mode off, see figure \n5-5. \nWarning \n• \nIf you tum safe update mode off and omit th.e WHERE clause from a DELETE \nstatement, all the rows in the table will be deleted. \nHow to delete rows\n\nSection 1 \nAn introduction to MySQL \nPerspective \nIn this chapter, you learned how to use the INSERT, UPDATE, and \nDELETE statements to modify the data in a database. In chapters 10 and 11, \nyou'll learn more about how table definitions can affect the way these state-\nments work. And in chapter 14, you'll leam more about executing gi·oups of \nINSERT, UPDATE, and DELETE statements as a single transaction. \nTerm \nsubquery \nExercises \nTo test whether a table has been modified correctly as you do these exercises, \nyou can write and run an appropriate SELECT statement. Or, when you 're \nusing MySQL Workbench, you can right-click on a table name in the Navigator \nwindow and select the Select Rows - Limit 1000 command to display the data \nfor the table in a Result tab. To refresh the data in this tab after modifying the \ntable data, click the Refresh button in the toolbar at the top of the tab. \n1. \nWrite an INSERT statement that adds this row to the Terms table: \nterms id: \nterms_ description: \nterms_due_days: \nNet due 120 days \nUse MySQL Workbench to review the column definitions for the Terms table, \nand include a column list with the required colu1nns in the INSERT statement. \n2. \nWrite an UPDATE statement that modifies the row you just added to the \nTerms table. This statement should change the terms_description column to \n''Net due 125 days'', and it should change the terms_due_days column to 125. \n3. \nWrite a DELETE statement that deletes the row you added to the Terrns table \nin exercise 1. \n4. \ninvoice id: \nvendor id: \ninvoice number: \ninvoice date: \ninvoice total: \npayment_ total: \ncredit total: \nterms id: \ninvoice due date: \n-\npayment_ date: \nThe next automatically generated ID \nAX-014-027 \n8/1/2018 \n$434.58 \n$0.00 \n$0.00 \n8/31/2018 \nnull \nWrite this statement without using a column list.\n\nClzapter 5 \nHow to insert, update, and delete data \n5. \nWrite an INSERT statement that adds these rows to the Invoice Line Items \ntable: \n• \n• \n1nvo1ce _sequence: \naccount number: \nline item amount: \n-\nline _item_ description: \n$180.23 \nHard drive \n$254.35 \n-\nExchange Server update \nSet the invoice_id column of these two rows to the invoice ID that was gener-\nated by MySQL for the invoice you added in exercise 4. \n6. \nWrite an UPDATE statement that modifies the invoice you added in exercise \n4. This statement should change the credit_total column so it's 10% of the \ninvoice_total column, and it should change the payment_total column so the \nsum of the payment_total and credit_total columns are equal to the \ninvoice total column. \n7. \nWrite an UPDATE statement that modifies the Vendors table. Change the \ndefault account number column to 403 for the vendor with an ID of 44. \n-\n8. \nWrite an UPDATE statement that modifies the Invoices table. Change the \nterms_id column to 2 for each invoice that's for a vendor with a \ndefa11lt_terms_id of 2. \n9. \nWrite a DELETE statement that deletes the row that you added to the Invoices \ntable in exercise 4. When you execute this statement, it will produce an error \nsince the invoice has 1·elated rows in the Invoice_Line_Items table. To fix that, \nprecede the DELETE statement with another DELETE statement that deletes \nthe line items for this invoice. (Remember that to code two or more statements \nin a script, you must end each statement with a semicolon.)",
          "pages": [
            180,
            181,
            182,
            183,
            184,
            185
          ],
          "relevance": {
            "score": 0.32,
            "sql_score": 1.0,
            "concept_score": 0.25,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "commonMistakes": {
          "text": "More SQL skills \nas you need them \nIn section 1, you learned a professio11al subset of SQL skills that you can \nuse to work with data in an existing database. Now, in this section, you \ncan add to those skills by learning new skills whenever you need them. To \nmake that possible, each chapter in this section has been designed as an \nindependent module. As a result, you can read these chapters in whatever \nsequence you prefer. \nIn chapter 6, you '11 learn how to summarize the data that you retrieve. \nIn chapter 7, you'll learn more about coding subqueries. In chapter 8, \nyou'll learn more about the types of data that MySQL suppo11s. And \nin chapter 9, you'll learn how to use MySQL functions in your SQL \nstatements.",
          "pages": [
            186,
            187
          ],
          "relevance": {
            "score": 0.12,
            "sql_score": 0.4,
            "concept_score": 0.0,
            "non_sql_penalty": 0.0,
            "is_relevant": false,
            "analysis": "SQL content"
          }
        }
      },
      "educational_notes": {
        "definition": "The DELETE statement is used to remove rows from a table based on a specified condition.",
        "explanation": "The DELETE statement is essential for managing data integrity and cleaning up unnecessary records. It allows you to specify exactly which rows should be removed, ensuring that only the intended data is deleted. This is particularly useful in maintaining accurate and up-to-date databases.",
        "key_points": [
          "Key point 1: The DELETE statement removes rows from a table based on a condition specified in the WHERE clause.",
          "Key point 2: It's important to include the WHERE clause to avoid deleting all rows unintentionally.",
          "Key point 3: Always test your DELETE statements with a SELECT query first to ensure you're targeting the correct rows.",
          "Key point 4: Be cautious when using wildcards in the WHERE clause, as they can lead to unintended deletions.",
          "Key point 5: Understanding how DELETE interacts with transactions is crucial for maintaining data consistency."
        ],
        "examples": [
          {
            "title": "Basic Usage",
            "code": "-- DELETE a single row FROM the 'employees' TABLE WHERE the employee ID is 101 DELETE FROM employees WHERE employee_id = 101;",
            "explanation": "This example demonstrates how to delete a specific row based on its unique identifier.",
            "validation_note": "SQL auto-fixed: "
          },
          {
            "title": "Practical Example",
            "code": "-- DELETE all records FROM the 'temp_data' TABLE WHERE the date is older than one year DELETE FROM temp_data WHERE date_column < DATE_SUB(CURDATE(), INTERVAL 1 YEAR);",
            "explanation": "This practical example shows how DELETE can be used to clean up old data that's no longer needed.",
            "validation_note": "SQL auto-fixed: "
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Forgetting the WHERE clause",
            "incorrect_code": "-- Incorrectly deletes all rows FROM 'employees' DELETE FROM employees;",
            "correct_code": "-- Correctly deletes a specific row\nDELETE FROM employees WHERE employee_id = 101;",
            "explanation": "This mistake can result in accidental deletion of all data in the table. Always include the WHERE clause to target specific rows."
          },
          {
            "mistake": "Using wildcards without caution",
            "incorrect_code": "-- Incorrectly deletes multiple rows due to wildcard usage\nDELETE FROM employees WHERE department LIKE '%Sales%';",
            "correct_code": "-- Correctly deletes a single row using an exact match\nDELETE FROM employees WHERE employee_id = 101;",
            "explanation": "Wildcards can lead to unintended deletions if not used carefully. Always ensure that your conditions are specific enough."
          }
        ],
        "practice": {
          "question": "Write a DELETE statement to remove all records from the 'logs' table where the log level is 'DEBUG'.",
          "solution": "-- Correct solution\nDELETE FROM logs WHERE log_level = 'DEBUG';\nExplanation: This statement will delete all rows in the 'logs' table where the log level column has the value 'DEBUG'."
        }
      },
      "llm_enhanced": true,
      "raw_text_preview": "Clzapter 5 \nHow to insert, update, and delete data \nThe syntax for using a subquery to insert one or more rows \nINSERT [INTO] table_ name [(column_ list)] select_statement \nInsert paid invoices into t",
      "content_relevance": {
        "score": 0.32,
        "sql_score": 1.0,
        "concept_score": 0.25,
        "non_sql_penalty": 0.1,
        "is_relevant": true,
        "analysis": "SQL content"
      }
    },
    "data-types-murach": {
      "id": "data-types-murach",
      "title": "MySQL Data Types",
      "definition": "Numeric, string, date/time, and large object data types",
      "difficulty": "beginner",
      "page_references": [
        193,
        194,
        195,
        196,
        197,
        198,
        199,
        200,
        201,
        202,
        203,
        204,
        205,
        206,
        207,
        208,
        209,
        210,
        211,
        212
      ],
      "sections": {
        "definition": {
          "text": "Chapter 6 \nHow to code sum1n.ary queries \nA summary query that uses the COUNT(*), AVG, and SUM functions \nSELECT 'After 1/1/2018' AS selection_date, \nCOUNT(*) AS number_of_ invoices, \nROUND{AVG{invoice_total), 2) AS avg_ invoice_amt, \nSUM{invoice_total) AS total_ invoice_amt \nFROM invoices \nWHERE invoice_date > '2018-01-01' \nselection_date \nnumber _of _lnvOJces \navg_ilvoice_amt \ntotal_invoice_amt \n► \nAfter 1/1/2018 \n1879.74 \n214290.51 \nA summary query that uses the MIN and MAX functions \nCOUNT { *) AS n11mh~r_of_ invoices, \nMAX{invoice_total) AS highest_ invoice_ total, \nMIN(invoice_total) AS lowest_ invoice_total \nFROM invoices \nWHERE invoice date> '2018-01-01' \nseJection_date \n► \nAfter 1/1/2018 \nnumber _of Jnvoices \nhighest_invoice_total \nlowest_invoice_total \n37966.19 \n6.00 \nA summary query that works on non-numeric columns \nSELECT MIN{vendor_name) AS first_vendor, \nMAX{vendor_name) AS last_vendor, \nCOUNT(vendor_name) AS number_of_vendors \nFROM vendors \nI flrst_vendor \n► I Abbey Office Furnishings \nlast_vendor \nZylka Design \nnumber _of _vendors \nA summary query that uses the DISTINCT keyword \nSELECT COUNT(DISTINCT vendor_ id) AS number_of_vendors, \nCOUNT{vendor_ id) AS number_of_ invoices, \nROUND(AVG(invoice_ total), 2) AS avg_ invoice_amt, \nSUM(invoice_total) AS total_ invoice_ amt \nFROM invoices \nnumber _of_vendors \nnumber _of_involces \navg_invoic:e_amt \ntotal_invoice_amt \n-\n► \n1879.74 \n214290.51 \nDescription \n• \nTo cot1nt all of the selected 1·ows, you typically use the COUNT(*) function. \nAlternately, you can use the COUNT function with the name of any column that \ncan't contain null values. \n• \nTo cot1nt only the rows with unique values in a specified column, you can code \nthe COUNT function with the DISTINCT keyword followed by the name of the \ncolumn. \nQueries that use aggregate functions\n\n17 4 \nSection 2 \nMore SQL skills cts you need them \nHow to group and summarize data \nNow that you understand how aggregate functions work, you're ready to \nlearn how to group data and use aggregate functions to summarize the data in \neach group. To do that, you can use two new clauses of the SELECT statement: \nGROUP BY and HAVING. \nHow to code the GROUP BY and HAVING clauses \nand HAVING clauses. The GROUP BY clause determines how the selected rows \nare grouped, and the HAVING clause determines which groups are included in \nthe final results. These clauses are coded after the WHERE clause but before the \nORDER BY clause. That makes sense because the WHERE clause is applied \nbefore the rows are grouped, and the ORDER BY clause is applied after the rows \nare grouped. \nIn the GROUP BY clause, you list one or more columns or expressions \nseparated by commas. Then, the rows in the result set are grouped by those \ncolumns or expressions in ascending sequence. That means that a single row is \nreturned for each unique set of values in the GROUP BY columns. In this figure, \nfor instance, the frrst example groups the results by a single column. In the next \nfigure, you can see examples that group by multiple columns. \nThis example calculates the average invoice amount for each vendor who has \ninvoices in the Invoices table. To do that, it uses a GROUP BY clause to group \nthe invoices by vendor_id. As a result, the AVG function calculates the average \nof the invoice_total column for each group rather than for the entire result set. \nThe example in this figure also includes a HAVING clause. The search \ncondition in this clause specifies that only those vendors with invoices that \naverage over $2,000 should be included. Note that this condition must be applied \nafter the rows are grouped and the average for each group has been calculated. \nIn addition to the AVG function, the SELECT clause includes the vendor_id \ncolumn. That's usually what you want since the rows are grouped by this \ncolumn. However, if you don't want to include the coluID11s used in the GROUP \nBY clause in the SELECT clause, you don't have to. \nIn most cases, the SELECT clause for a statement that includes a GROUP \nBY clause will only include the columns that are used for grouping, along with \nthe aggi·egate functions. However, you can also include expressions that result \nin a constant value as well as columns that are functionally dependent on a \ncolumn that's used for grouping. For a column to be functionally dependent on a \ngrouping column, the grouping column must be a primary key for the column in \nthe SELECT clause or it must be unique and not allow null values. \nThe second example illusu·ates how this works. This example gets the \nvendor name, vendor state, and the average invoice total for each vendor. \nTo do that, it joins the Vendors and Invoices table and groups the rows by \nvendor_name. Although the vendor_state column isn't included in the GROUP \nBY clause, it can be included in the SELECT clause because the vendor_name \ncolumn is a unique colt1mn that can't contain null values. Because of that, the \nvendor_state colu1nn is functionally dependent on it.\n\nChapter 6 \nHow to code sum1ncary queries \nThe syntax of a SELECT statement with GROUP BY and HAVING clauses \nSELECT select_list \nFROM table_ source \n[WHERE search_ condition] \n[GROUP BY group_by_ list] \n[HAVING search_condition] \n[ORDER BY order_by_ list] \nA summary query that calculates the average invoice amount by vendor \nSELECT vendor_ id, ROUND(AVG(invoice_total), 2) AS average_ invoice_amount \nFROM invoices \nGROUP BY vendor_ id \nHAVING AVG(invoice_total) > 2000 \nORDER BY average_ invoice_amount DESC \nvendor id \naverage_lnvoice_amount \n► \n23978.48 \n10963.66 \n7125.34 \n6940.25 \n4901.26 \n2575.33 \n2433.00 \n2184.50 \n(8 rows) \nA summary query that includes a functionally dependent column \nSELECT vendor_ name, ~endor_ state, \nROUND(AVG(invoice_total), 2) AS average_ invoice_amount \nFROM vendors JOIN invoices ON vendors.vendor_ id = invoices.vendor_ id \nGROUP BY vendor_narn~ \nHAVING AVG(invoice total) > 2000 \nDescription \n• \nThe GROUP BY clause groups the rows of a result set based on one or more columns or \nexpressions. To include two or more columns or expressions, separate them by commas. \n• If you include aggregate functions in the SELECT clause, the aggregate is calculated for \neach group specified by the GROUP BY clause. \n• If you include two or more colu1nns or expressions in the GROUP BY clause, they form \na hierarchy where each column or expression is subordinate to the previous one. \n• \nThe HAVING clause specifies a search condition for a group or an aggregate. MySQL \napplies this condition after it groups the rows that satisfy the search condition in the \nWHERE clause. \n• \nWhen a SELECT statement includes a GROUP BY clause, the SELECT clause can \ninclude the columns used for grouping, aggregate functions, and expressions that \nresult in a constant value. \n• \nThe SELECT clause can also include columns that are functionally dependent on a \ncolumn used fo1· grouping. To be functionally dependent, the grouping column must \nbe a primary key of the table that contains the column in the SELECT clause or it \nmust be unique and not allow null values. \nHow to code the GROUP BY and HAVING clauses\n\nSection 2 \nMore SQL skills cts you need them \nQueries that use the GROUP BY \nand HAVING clauses \nfigure groups the rows in the Invoices table by vendor_id and returns a count of \nthe number of invoices for each vendor. \nThe second query shows how you can group by mo1·e than one column. \nHere, a join is used to combine the vendor_state and vendor_city columns from \nthe Vendors table with a count and average of the invoices in the Invoices table. \nBecause the rows are grouped by both state and city, a row is returned for each \nstate and city combination. \nThe third query is identical to the second query except that it includes a \nHAVING clause. This clause uses the COUNT function to limit the state and city \ngroups that are included in the result set to those that have two or more invoices. \nIn other words, it excludes groups that have only one invoice. \nWith MySQL 8.0.12 and earlier, the GROUP BY clause sorted the columns \nin ascending sequence by default. Then, to change that sequence, you could \ncode the DESC keyword after the column name in the GROUP BY clause. You \ncould also code the ASC keyword to make it clear that the rows were sorted in \nascending sequence. And, yot1 could improve the performance of a query by \ncoding an ORDER BY NULL clause so the result set wasn't sorted at all. \nWith MySQL 8.0.13 and later, the columns in a GROUP BY clause are \nno longer sorted by default. In addition, you can no longer specify the ASC or \nDESC keywords on this clause. Instead, you must code an ORDER BY clause \nto sort the rows in a result set. Otherwise, MySQL doesn't guarantee the sort \nsequence.\n\nChapter 6 \nHow to code sum1ncary queries \nA summary query that counts the number of invoices by vendor \nSELECT vendor_ id, COUNT(*) AS invoice_qty \nFROM invoices \nGROUP BY vendor_ id \nI vendor Jd \nlnvoice_Qty \n► \n(34 rows ) \nA summary query that calculates the number of invoices \n\"\"' \nIce \n. \nand the average invoice amount for the vendors in each state and city \nSELECT vendor_state, vendor_city, COUNT(*) AS invoice_qty, \nROUND(AVG(invoice_total), 2) AS invoice_avg \nFROM invoices JOIN vendors \nON invoices.vendor id= vendors.vendor id \nGROUP BY vendor_state, vendor_city \nORDER BY vendor_state, vendor_city \nvendor _state \nvendor _city \nnvolce_qty \ninv01ce_avg \n► \nAZ. \nPhoenix \n662.00 \nCA \nFresno \n1208.75 \nCA \nLos Angeles \n503.20 \nCA \nOxnard \n188.00 \n(20 rows) \nA summary query that limits the groups \nto those with two or more invoices \nSELECT vendor_ state, vendor_city, COUNT(*) AS invoice_qty, \nFROM invoices JOIN vendors \nON invoices.vendor_ id = vendors.vendor_id \nHAVING COUNT(*) >= 2 \nvendor state \n-\n► \nCA \nCA \nCA \n(12 rows) \nDescription \nvendor_dty \nFresno \nOxnard \nPasadena \nSacramento \ninvoice_Qty \n111voice_avg \n1208.75 \n188,00 \n196. 12 \n253.00 \nI\\ \n1--\n\\I \n• \nWith MySQL 8.0.12 and earlier, the GROUP BY clause sorted the columns in ascending \nsequence by default. Then, to change the sort sequence, you could code the DESC \nkeyword after the column name in the GROUP BY clause. In addition, to get your results \nfaster, you cot1ld code an ORDER BY NULL clause to prevent MySQL from sorting the \nrows in the GROUP BY clause. \n• \nWith MySQL 8.0.13 and later, the columns in a GROUP BY clause are no longer sorted by \ndefault, and you can't code the ASC or DESC keyword on this clause. Instead, you must \nuse the ORDER BY clause to specify the sort sequence. \nQueries that use the GROUP BY and HAVING clauses",
          "pages": [
            193,
            194,
            195,
            196,
            197
          ],
          "relevance": {
            "score": 0.38,
            "sql_score": 1.0,
            "concept_score": 0.17,
            "non_sql_penalty": 0.0,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "examples": {
          "text": "Section 2 \nMore SQL skills cts you need them \nHow the HAVING clause compares \nto the WHERE clause \nAs you've seen, you can limit the groups included in a result set by coding \na search condition in the HAVING clause. In addition, you can apply a search \ncondition to each row before it's included in a group. To do that, you code the \nsearch condition in the WHERE clause just as you would for any SELECT state-\nment. To make sure you understand the differences between search conditions \ncoded in the HAVING and WHERE clauses, figure 6-5 presents two examples. \nThe first example groups the invoices in the Invoices table by vendor name \nand calculates a count and average invoice amount for each group. Then, the \nHA VINO clause limits the groups in the result set to those that have an average \ninvoice total greater than $500. \nIn contrast, the second example includes a WHERE clause that limits the \ninvoices included in the groups to those that have an invoice total greater than \n$500. In other words, the search condition in this example is applied to every \nrow. In the previous example, it was applied to each group of rows. As a result, \nthese examples show that there are eight invoices for Zylka Design in the \nInvoices table, but only seven of them are over $500. \nBeyond this, there are two differences in the expressions that you can \ninclude in the WHERE and HAVING clauses. First, the HAVING clause can \ninclude aggregate functions as shown in the frrst example, but the WHERE \nclause can't. That's because the search condition in a WHERE clause is applied \nbefore the rows are grouped. Second, although the WHERE clause can refer to \nany column in the base tables, the HAVING clause can only refer to columns \nincluded in the SELECT clause. That's because it filters the summarized result \nset that's defmed by the SELECT, FROM, WHERE, and GROUP BY clauses. In \nother words, it doesn't filter the base tables.\n\nChapter 6 \nHow to code sum1ncary queries \nA summary query with a search condition in the HAVING clause \nSELECT vendor_name, \nCOUNT(*) AS invoice_qty, \nROUND{AVG{invoice_total), 2) AS invoice_ avg \nFROM vendors JOIN invoices \nON vendors.vendor_ id = invoices.vendor_ id \nGROUP BY vendor_ name \nHAVING AVG{invoice_total) > 500 \nORDER BY invoice_qty DESC \nvendor_name \ninvoice_qty \nlnvoice_avg \n► \nUnited Parcel Service \n2575.33 \nZylka Design \n867.53 \nMaftoy lithographing Inc \n23978.48 \nIBM \n600.06 \n(19 rows) \nA summary query with a search condition in the WHERE clause \nSELECT vendor_name, \nCOUNT{*) AS invoice_qty, \nROUND(AVG(invoice_total), 2) AS invoice_avg \nFROM vendors JOIN invoices \nON vendors.vendor_ id = invoices.vendor_id \nWHERE invoice_total > 500 \nGROUP BY vendor_ name \nORDER BY invoice_qty DESC \nvendor _name \ninvoice_qty \n• \n• \nnvotCe_avg \n► \nUnrted Parcel Service \n2575.33 \nZylka Design \n9~.67 \nMaDoy lithographing Inc \n23978.48 \nIngram \n1on.21 \n{20 rows) \nDescription \nI\\ \n.,__ \n• \nWhen you include a WHERE clat1se in a SELECT statement that uses grouping \nand aggregates, MySQL applies the search condition before it groups the rows and \ncalculates the aggregates. \n• \nWhen you include a HAVING clause in a SELECT statement that uses grouping \ncalculates the aggregates. \n• \nA WHERE clause can refer to any colwnn in the base tables. \n• \nA HAVING clause can only refer to a column included in the SELECT clause. \n• \nA WHERE clause can't contain aggregate ft1nctions. \n• \nA HAVING clause can contain aggregate functions. \nHow the HAVING clause compares to the WHERE clause \nI\n\nSection 2 \nMore SQL skills cts you need them \nHow to code compound search conditions \nYou can code compound search conditions in a HAVING clause just as you \ncan in a WHERE clause. The first example in figure 6-6 shows how this works. \nThis query groups invoices by invoice date and calculates a count of the invoices \nand the sum of the invoice totals for each date. In addition, the HA YING clause \nspecifies three conditions. First, the invoice date must be between 5/1/2018 and \n5/31/2018. Second, the invoice count must be greater than 1. And third, the sum \nof the invoice totals must be greater than $100. \nIn the HAVING clause of this query, the second and third conditions include \naggregate functions. As a result, they must be coded in the HAVING clause. The \nfrrst condition, however, doesn't include an aggregate function, so it could be \ncoded in either the HAVING or WHERE clause. The second example shows this \ncondition coded in the WHERE clause. Either way, both queries return the same \nresult set. \nSo, where should you code your search conditions? In general, I think \nqueries are easier to 1·ead when they include al] the search conditions in the \nHAVING clause. However, if you prefer to code non-aggregate search conditions \nin the WHERE clause, that's OK too.\n\nChapter 6 \nHow to code sum1ncary queries \nA summary query with a compound condition in the HAVING clause \nSELECT \ninvoice_date, \nCOUNT(*) AS invoice_qty, \nSUM(invoice total) AS invoice_ sum \nFROM invoices \nGROUP BY invoice_date \nHAVING invoice_date BETWEEN '2018-05-01' AND '2018-05-31' \nAND COUNT(*) > 1 \nAND SUM(invoice_total) > 100 \nORDER BY invoice_date DESC \nThe same query coded with a WHERE clause \nSELECT \ninvoice_date, \nCOUNT(*) AS invoice_qty, \nSUM(invoice_total) AS invoice_ sum \nFROM invoices \nWHERE invoice_ date BETWEEN '2018-05-01' AND '2018-05-31' \nGROUP BY invoice_date \nHAVING COUNT(*) > 1 \nAND SUM(invoice_total) > 100 \nORDER BY invoice_ date DESC \nThe result set returned by both queries \ninvoice_date \ninvoice_qty \n• \n• \nmvo,ce_sum \n► \n2018-05-31 \n453.75 \n2018-05-25 \n220L15 \n2018-05-23 \n347. 75 \n2018-05-21 \n8078.44 \n2018-05-13 \n1888.95 \n2018-05-11 \n5009.51 \n2018-05-03 \n866.87 \n(7 rows) \nDescription \n• \nYou can use the AND and OR operators to code compound search conditions in a \nHAVING clause just as you can in a WHERE clause. \n• \nIf a search condition includes an aggregate function, it must be coded in the \nHAVING clause. Otherwise, it can be coded in either the HAVING or the WHERE \nclause. \nHow to code compound search conditions\n\nSection 2 \nMore SQL skills cts you need them \nHow to use the WITH ROLLUP operator \nSo far, this chapter has discussed standard SQL keywords and functions. \nHowever, MySQL provides an extension to standard SQL that's useful for \nsummarizing data: the WITH ROLLUP operator. \nYou can use the WITH ROLLUP operator to add one or more summary rows \nto a result set that uses gi·ouping and aggregates. The two examples in figure 6-7 \nshow how this works. \nThe first example shows how the WITH ROLLUP operator works when you \ngroup by a single column. This statement groups the invoices by vendor_id and \ncalculates an invoice count and invoice total for each vendor group. In addition, \nsince the GROUP BY clause includes the WITH ROLLUP operator, this query \nadds a summary row to the end of the result set. This row summaiizes all of the \naggregate columns in the result set. In this case, it summarizes the invoice_count \nand invoice_total columns. Since the vendor_id column can't be summarized, \nit's assigned a null value. \nThe second query in this figure shows how the WITH ROLLUP operator \nworks when you group by two columns. This query groups vendors by state \nand city and counts the number of vendors in each group. Then, this query adds \nsummary rows for each state, and it adds a final summary row at the end of the \nresult set. \nBefore MySQL 8.0.13, you couldn't use the use an ORDER BY clause to \nsort a result set if the GROUP BY clause included the WITH ROLLUP operator. \nInstead, you had to sort the individual columns by coding the ASC or DESC \nkeyword after the column name in the GROUP BY clause. With MySQL 8.0.13 \nand later, however, you can't code the ASC or DESC keyword on the GROUP \nBY clause. Instead, if you want to sort the result set, you can now use an \nORDER BY clause. Keep in mind, though, that when you use WITH ROLLUP, \nthe result set is sorted by the columns in the GROUP BY clause in ascending \nsequence by default. So you'll only code an ORDER BY clause if you want to \nchange this sequence.\n\nChapter 6 \nHow to code sum1ncary queries \nA summary query that includes a final summary row \nSELECT vendor_ id, COUNT(*) AS invoice_count, \nSUM(invoice_ total) AS invoice_total \nFROM invoices \nGROUP BY vendor_ id WITH ROLLUP \nvendorj d \n111voice_cou,t \ninvolce_total \n~01.26 \n6940.25 \n2Jln .96 \n4378.02 \nlml!!I \n214290.51 \n(35 rows) \n~ .., \nA summary query that includes a summary row for each grouping level \nSELECT vendor_ state, vendor_city, COUNT(*) AS qty_vendors \nFROM vendors \nWHERE vendor_ state IN ( • IA• , \n•NJ• ) \nGROUP BY vendor_state, vendor_city WITH ROLLUP \nvendor _state \nvendor_dty \nqty_ vendors \n► \nIA \nFairfield \nIA \nWashington \nIA \nom,, \nNJ \nEast Brunswick \nNJ \nFairfield \nNJ \nWashington \nNJ \nHW!I \nml \n11111!1 \nDescription \n• \nYou can use the WITH ROLLUP operator in the GROUP BY clause to add \nsummary rows to the final result set. \n• \nThe WITH ROLLUP operator adds a summary row for each group specified in the \nGROUP BY clause. It also adds a summary row to the end of the result set that \nsummarizes the entire result set. \n• \nIf the GROUP BY clause specifies a single group, the WITH ROLLUP operator \nonly adds the fmal summary row. \n• \nWith MySQL 8.0.12 and earlier, you couldn't use the ORDER BY clause with the \nWITH ROLLUP operator. Instead, to sort individual columns, you coded the ASC \nor DESC keyword after the column in the GROUP BY clause. \n• \nWith MySQL 8.0.13 and later, you can't code the ASC or DESC keyword on the \nGROUP BY clause. However, you can now include an ORDER BY clause to sort \nthe result set when the GROUP BY clause includes WITH ROLLUP. \n• \nof the aggregate functions when you used the WITH ROLLUP operator. With \nMySQL 8.0.13 and later, you can use the DISTINCT keyword. \nHow to use the WITH ROLLUP operator\n\nSection 2 \nMore SQL skills cts you need them \nHow to use the GROUPING function \nWhen you group by a column that can contain null values, the result of the \ngrouping can be a null value. In addition, when you use the WITH ROLLUP \noperator to summarize a column that can contain null values, the summary row \nwill contain a null value in that column. Because of that, it can be difficult to \ndistinguish between the null values due to grouping and the null values due to \n• \n• \nsummanz1ng. \nThe first query in figure 6-8 illustrates how this works. Here, the query \nincludes the invoice date and payment date from the Invoices table, as well as \nthe sum of the invoice totals and the sum of the invoice balances. The first five \nrows in the result set are for the same invoice date. Both the first and the last of \nthose five rows contains a null value in the Payment Date column. The first row \ncontains a null value because one or more of the invoices for that invoice date \ncontain a null value. The last row contains a null value because it is a summary \nrow for all of the invoices for that invoice date. Without studying this result set \ncarefully, though, it's difficult to tell which null values are for summary rows \nand which aren't. \nTo help distinguish between these null values, you can use the GROUPING \nfunction that was introduced with MySQL 8.0. This function evaluates the \nexpression you specify to determine if the expression results in a null value \nbecause it's in a sum1nary row. If it does, the GROUPING function returns a \nvalue of 1. Otherwise, it returns a value of 0. \nThis is illustrated by the second query in this figure. This query is the \nsame as the first query except that it uses IF and GROUPING functions for the \ninvoice_date and pay1nent_date columns in the SELECT clause. You'll learn \nabout the IF function in chapter 9. For now, just realize that it evaluates the \nexpression in the first argument and returns the second argument if the expres-\nsion is true or the third argument if it's not. \nIn this case, the first argument of each IF function is a GROUPING function. \nThese GROUPING functions test if the invoice_date or payment_date column \ncontains a null value because it's in a summary row. If so, the IF function returns \nthe literal value that's specified by the second argument. Otherwise, it returns \nthe value of the column grouping that's specified by the third argument. If \nyou compare the results of this query with the results of the first query, you'll \nsee that it's now obvious which rows are summary rows because they contain \nliteral values instead of null values. This is a common use for the GROUPING \nfunction.\n\nChapter 6 \nHow to code sum1ncary queries \nThe basic syntax of the GROUPING function \nGROUPING (expression) \nA summary query that uses WITH ROLLUP on a table with null values \nSELECT invoice_date, payment_date, \nSUM(invoice_total) AS invoice_total, \nSUM(invoice_total - credit_total - payment_total) AS balance_due \nFROM invoices \nWHERE invoice_date BETWEEN '2018-07-24' AND \n1 2018-07-31 1 \nGROUP BY invoice_date, payment_date WITH ROLLUP \ninvoice_date \npayment_date \nInvoice_ total \nbalance_ due \n► \n2018-07-24 \n0®91 \n503.20 \n503.20 \n2018-07-24 \n2018-08-19 \n3689.99 \n0.00 \n2018-07-24 \n2018-08-23 \n67.00 \n0.00 \n2018-07-24 \n2018-08-27 \n23517.58 \n0.00 \n2018-07-24 \nHPJII \n27777.n \n503.20 \n2018-07-25 \n2018-08-22 \n1000.'16 \n0,00 \n2018-07-25 \nl®!I \n1000.-46 \n0.00 \n2018-07-28 \nUQl!I \n90.36 \n90.36 \n2018-07-28 \nHW!I \n90.36 \n90.36 \n2018-07-30 \n2018-09-03 \n22.57 \n0.00 \n2018--0 7-30 \n®J!I \n22.57 \no.oo \n2018-07-31 \nlllij!i \n10976.06 \n10976.06 \n~&,;8-07-31 \nil®!I \n10976.06 \n10976.06 \nHW!I \n39867.22 \n11569.62 \nA query that substitutes literals for nulls in summary rows \nSELECT IF(GROUPI:NG(invoice_ date) = 1 , 'Grand totals', invoice_ date) \nAS invoice_date, \nIF(GROUPI:NG(payment_ date) = 1 , 'Invoice date totals', payment_ date) \nAS payme.nt_date, \nSUM(invoice_total - credit_total - payment_ total) AS balance_ due \nFROM invoices \n1 2018-07-31 1 \nJ \ninvoice_date \npayment_date \nInvoice_ total \nbalance _due \nH©il \n► \n2018-07-24 \n503.20 \n503.20 \n2018-07-24 \n2018-08-19 \n3689.99 \n0.00 \n2018-07-24 \n2018-08-23 \n67.00 \no.oo \n2018-07-24 \n2018-08-27 \n23517.58 \n0.00 \n2018-07-24 \nInvoice date totals \nL777/.77 \n503.20 \n2018-07-25 \n2018-08-22 \n1000.-46 \n0.00 \n2018-07-25 \nInvoice date totals \n1000.-46 \n0.00 \n2018-07-28 \nllill!I \n90.36 \n90.36 \n2018-07-28 \nInvoice date totals \n90.36 \n90.36 \n2018-07-30 \n2018-09-03 \n22.57 \n0.00 \n2018-07-30 \nInvoice date totals \n22.57 \n0.00 \n2018-07-31 \nUt!HI \n10976.06 \n10976.06 \n2018-07-31 \nInvoice date totals \n10976.06 \n10976.06 \nGrand totals \nInvoice date totals \n39867.22 \n11569.62 \nDescription \n• \nThe GROUPING function returns 1 if the expression is null because it's in a \nsummary row. Otherwise, it returns 0. \nHow to use the GROUPING function (part 1 of 2)\n\nSection 2 \nMore SQL skills cts you need them \nPart 2 of figure 6-8 shows another common use for the GROUPING \nfunction. The query in this example is identical to the second one in part 1 \nof this figure, except that it includes a HAVING clause. This clause uses the \nGROUPING function to filter the result set so only the summary rows are \nincluded. To do that, it checks if this function returns a value of 1 for the \ninvoice_date or payment_date column.",
          "pages": [
            198,
            199,
            200,
            201,
            202,
            203,
            204,
            205,
            206
          ],
          "relevance": {
            "score": 0.37,
            "sql_score": 1.0,
            "concept_score": 0.33,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "commonMistakes": {
          "text": "Chapter 6 \nHow to code sum1n.ary queries \nA query that displays only summary rows \nSELECT IF(GROUPING(invoice_date) = l , 'Grand totals', invoice_date) \nAS invoice_date, \nIF(GROUPING (payment_date) = l , 'Invoice date totals', payment_date) \nAS payment_date, \nSUM(invoice_total) AS invoice_total, \nSUM(invoice_ total - credit_ total - payment_total) AS balance_due \nFROM invoices \nWHERE invoice_date BETWEEN '2018-07-24' AND '2018-07- 31' \nGROUP BY invoice_date, payment_date WITH ROLLUP \nHAVING GROUPING(invoice date) = 1 OR GROUPING{payment date)\n= ~ \n• \n-\ninvoice _date \npayment_date \ninvoice_total \nbalance_due \n► \n2018-07-24 \nInvoice date totals \nl.7111. n \n503.20 \n2018-07-25 \nInvoice date totals \n1000.46 \n0.00 \n2018-07-28 \nInvoice date l'Otals \n90.36 \n90.36 \n2018-07-30 \nInvoice date totals \n22.57 \n0.00 \n2018-07·31 \nInvoice date totals \n10976.06 \n10976.06 \nGrand totals \nInvoice date totals \n39867.22 \n11569.62 \n. .., \nDescription \n• \nThe GROUPING function is co1nmo1tly used to replace the nulls that are gener-\nated by WITH ROLLUP with literal values. To do that, you can use it with the IF \nfunction as shown in this figure. \ni \n' \n' \n• \nThe IF function evaluates the expression in the frrst argument and returns the \nsecond argument if the expression is true and the third argument if the expression is \nfalse. See chapter 9 for more information on this function. \n• \nIf you want to display just the summary rows produced by the WITH ROLL UP \noperator, you can include one or more GROUPING functions in the HAVING \nclause. \n• \nIn addition to the SELECT and HA VINO clauses, you can code the GROUPING \nfunction in the ORDER BY clause. \nHow to use the GROUPING function (part 2 of 2) \n'\n\nSection 2 \nMore SQL skills cts you need them \nHow to code aggregate \nwindow functions \nIn the topics that follow, you '11 learn how to use the aggregate window \nfunctions that were introduced with MySQL 8.0. You can use the window \nfunctions with any of the aggregate functions you learned about in this chapter. \nHow the aggregate window functions work \nEarlier in this chapter, you learned how to use some of the aggregate \nfunctions with the GROUP BY clause to group and summarize data. When \nyou use GROUP BY, a single row is returned for each unique set of values in \nthe grouped columns. If a result set is grouped by the vendor_id column, for \nexample, only one row is returned for each vendor, and that vendor is summa-\nrized by the aggregate functions that are included in the SELECT clause. \nAggregate window functions are similar except that the groups, or partitions, \nai:en't collapsed to a single row. Instead, all of the rows in the result set are \nreturned. \nwindow function by including the OVER clause. This clause defines the window \nthat's used by the aggregate function. A window consists of all of the rows that \nare needed to evaluate the function for the current row. You'll learn more about \nhow this works as you review the examples that follow. \nThe fust example in this figure shows a SELECT statement that includes \ntwo aggregate window functions. Both of these functions use the SUM function \nto calculate a total of the invoice_total column. However, the OVER clause for \nthe first function is empty, which means that all of the rows in the result set \nare included in a single partition. Because of that, the total_invoices column \ncontains the same value for each column, which is the total of all of the invoices \nin the result set. In this case, to calculate the total of all invoices, the SUM \nfunction for each row needs a window into all of the other rows in the result set. \nBy contrast, the second window function in this query uses the PARTITION \nBY clause to partition the result set by the vendor_id column. That way, the sum \nof the invoice totals is calculated for each vendor instead of for all vendors. You \ncan see the result of this function in the vendor_total column. In this case, to \ncalculate the total of all invoices for each vendor, the SUM function for each row \nneeds a window into all the other rows for the same vendor. That means that if \nthe fust row for vendor 110 is the current row, it needs a window into the other \nfour rows for that vendor. \nIf you want to sort the rows within each partition, you can code the ORDER \nBY clause on the OVER clause. This is illustrated by the second example in this \nfigure. Here, the second aggregate window fi.1nction indicates that the invoices \nfor eacl1 vendor should be sorted by the invoice_total column. If you compare \nthe sequence of the invoices for vendor 110 in this result set with the sequence in \nthe first result set, you shouldn't have any trouble understanding how this works.\n\nChapter 6 \nHow to code sum1ncary queries \nThe basic syntax of the OVER clause \nOVER{[PARTITION BY expressionl [, expression2] ••• \n[ORDER BY expressionl [ASCjDESC] [, expression2 [ASC IDESC]] ••• ) \nA SELECT statement with two aggregate window functions \nSELECT vendor_ id, invoice_date, invoice_ total, \nSUM{invoice_total) OVER() AS total_ invoices, \nSUM{invoice_ total) OVER(PARTITION BY vendor_ id) AS vendor_total \nFROM invoices \nWHERE invoice_total > 5000 \n,- I vendor_id \ninvoice_date \n1nvolce_total \ntotal_invoices \nvendor _total \n► \n2018-06-01 \n21842.00 \n155800.00 \n21842.00 \n2018-06-18 \n6940.25 \n155800.00 \n6940.25 \n2018-05-21 \n7125.34 \n155800.00 \n7125.34 \n2018-05-28 \n37966.19 \n155800.00 \n119892.41 \n2018-07-19 \n26881.-10 \n155800.00 \n119892.41 \n2018-07-23 \n20551.18 \n155800.00 \n119892.41 \n2018-07-24 \n23517.58 \n155800.00 \n119892.41 \n2018-07-31 \n10976.06 \n155800.00 \n119892.41 \nA SELECT statement that includes a cumulative total \nSELECT vendor_ id, invoice_date, invoice_total, \nSUM{invoice_total ) OVER() AS total_ invoices, \nSUM{invoice_total) OVER(PARTITION BY vendor_ id \nORDER BY invoice_ total) AS vendor_total \nFROM invoices \nWHERE invoice_total > 5000 \nvendor id \ninvoice date \ninvoice total \ntotal invoices \nvendor total \n-\n-\n► \n2018-06-01 \n21842.00 \n155800.00 \n21842.00 \n2018-06-18 \n6940.25 \n155800.00 \n6940.25 \n2018-05-21 \n7125.34 \n155800.00 \n7125.34 \n2018-07-31 \n10976.06 \n155800.00 \n10976.06 \n2018--07-23 \n20551.18 \n155800.00 \n31527.24 \n2018-07-24 \n23517.58 \n155800.00 \n55044.82 \n2018-07-19 \n26881.40 \n155800.00 \n81926.22 \n2018-05-28 \n37966.19 \n155800.00 \n119892.41 \nDescription \n• \nThe window functions can be used with all of the aggregate functions listed in \n• \nUnlike aggregate functions that use GROUP BY, the groups, or partitions, in an \naggregate window function are not collapsed to a single row. \n• \nA window consists of all of the rows that are needed to calculate the aggregate \nvalue for the current row. \n• \nTo treat an aggregate function as a window function, you include an OVER clause \nthat indicates how to partition the rows in the result set. \n' \n• If you code an e1npty OVER clause, the entire result set is treated as a single partition. \n• If you code an OVER clause with a PARTITION BY clause, the aggregate function \nis performed on each partition. \n• \nIf you code an ORDER BY clause on the OVER clause, the rows within each parti-\ntion are sorted and the values from one row to the next are cumulative. \nHow the aggregate window functions work",
          "pages": [
            207,
            208,
            209
          ],
          "relevance": {
            "score": 0.47,
            "sql_score": 1.0,
            "concept_score": 0.33,
            "non_sql_penalty": 0.0,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        }
      },
      "educational_notes": {
        "definition": "MySQL data types are specific formats used to store different kinds of data in a database table. Understanding and using the correct data type is crucial for efficient data storage and retrieval.",
        "explanation": "Data types in MySQL determine how data is stored and manipulated within a database. Common data types include INT for integers, VARCHAR for variable-length strings, DATE for dates, and FLOAT for floating-point numbers. Choosing the right data type ensures that data is stored efficiently and accurately. For example, using an INT instead of a VARCHAR for numerical data can save space and improve query performance.",
        "key_points": [
          "Key point 1: Each column in a table should have a specific data type to optimize storage and retrieval.",
          "Key point 2: Choosing the wrong data type can lead to inefficient use of disk space and slower query performance.",
          "Key point 3: Common mistakes include using VARCHAR for numeric data or INT for text data, which can result in data truncation or incorrect calculations."
        ],
        "examples": [
          {
            "title": "Basic Usage",
            "code": "-- Define a TABLE with appropriate data types CREATE TABLE products ( product_id INT PRIMARY KEY, product_name VARCHAR(100), price FLOAT );",
            "explanation": "This example demonstrates how to create a table with columns of different data types. The product_id is an integer, product_name is a variable-length string, and price is a floating-point number.",
            "validation_note": "SQL auto-fixed: "
          },
          {
            "title": "Practical Example",
            "code": "-- INSERT data into the products TABLE INSERT INTO products (product_id, product_name, price) VALUES (1, 'Laptop', 999.99);",
            "explanation": "This practical example shows how to insert data into a table using the correct data types for each column.",
            "validation_note": "SQL auto-fixed: "
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Using VARCHAR for numeric data",
            "incorrect_code": "-- Incorrect usage CREATE TABLE products ( product_id INT PRIMARY KEY, product_name VARCHAR(100), price VARCHAR(10) );",
            "correct_code": "-- Correct usage CREATE TABLE products ( product_id INT PRIMARY KEY, product_name VARCHAR(100), price FLOAT );",
            "explanation": "Using VARCHAR for numeric data can lead to issues with sorting and calculations. Always use the appropriate numeric data type like INT or FLOAT."
          }
        ],
        "practice": {
          "question": "Create a table called 'employees' with columns: employee_id (INT), first_name (VARCHAR), last_name (VARCHAR), hire_date (DATE), salary (FLOAT). Insert one row of data into the table.",
          "solution": "-- Create and insert data into employees table\nCREATE TABLE employees (\n  employee_id INT PRIMARY KEY,\n  first_name VARCHAR(50),\n  last_name VARCHAR(50),\n  hire_date DATE,\n  salary FLOAT\n);\nINSERT INTO employees (employee_id, first_name, last_name, hire_date, salary) VALUES (1, 'John', 'Doe', '2020-06-15', 75000.00);"
        }
      },
      "llm_enhanced": true,
      "raw_text_preview": "Chapter 6 \nHow to code sum1n.ary queries \nA summary query that uses the COUNT(*), AVG, and SUM functions \nSELECT 'After 1/1/2018' AS selection_date, \nCOUNT(*) AS number_of_ invoices, \nROUND{AVG{invoic",
      "content_relevance": {
        "score": 0.37,
        "sql_score": 1.0,
        "concept_score": 0.33,
        "non_sql_penalty": 0.1,
        "is_relevant": true,
        "analysis": "SQL content"
      }
    },
    "mysql-functions": {
      "id": "mysql-functions",
      "title": "MySQL Functions",
      "definition": "String, numeric, date/time, and conversion functions",
      "difficulty": "intermediate",
      "page_references": [
        217,
        218,
        219,
        220,
        221,
        222,
        223,
        224,
        225,
        226,
        227,
        228,
        229,
        230,
        231,
        232,
        233,
        234,
        235,
        236,
        237,
        238,
        239,
        240
      ],
      "sections": {
        "definition": {
          "text": "Chapter 6 \nHow to code sum1ncary queries \nThe sum of the line item amount columns in the Invoice Line Items table \n-\nthat have the same account_nu1nber \nReturn only those rows where the count of line items is greater than 1. This \nsl1ould return 10 rows. \nGroup the result set by the account_description column. \nSort the resL1lt set in descending sequence by the sum of the line item \na1nounts. \n5. \nModify the solution to exercise 4 so it returns only invoices dated in the \nsecond quarter of 2018 (April 1, 2018 to June 30, 2018). This should still \nreturn 10 rows but with some different line item counts for each vendor. Hint: \nJoin to tlie Invoices table to code a secirch condition based on invoice_date. \n6. \nWrite a SELECT statement that answers this question: What is the total \namount invoiced for each general ledger account nt1mber? Return these \ncolumns: \nThe account number column fro1n the Invoice Line Items table \n-\nThe sum of the line_item_amount columns from the Invoice_Line_Items \ntable \nUse the WITH ROLLUP operator to include a row that gives the grand total. \nThis should return 22 rows. \n7. \nbeing paid from more than one account? Return these columns: \nThe vendor name colL1mn from the Vendors table \nThe count of distinct general ledger accounts that apply to that vendor's \n• \n• \n1nvo1ces \nThis should return 2 rows. \n8. \npayment date and total amount due for each vendor with each terms id? \nReturn these columns: \nThe terms id column from the Invoices table \nThe vendor id column from the Invoices table \nThe last payment date for each combination of terms id and vendor id in the \nInvoices table \nThe sum of the balance due (invoice_total - payment_total - credit_total) \nfor each combination of terms id and vendor id in the Invoices table \nUse the WITH ROLLUP operator to include rows that give a summa1-y for \neach terms id as well as a row that gives the grand total. This should return 40 \nrows. \nUse the IF and GROUPING functions to replace the null values in the terms_id \nand vendor_id columns with literal values if they're for st1mmary rows.\n\nSection 2 \nMore SQL skills cts you need them \n9. \nWrite a SELECT statement that uses aggregate window functions to calculate \nthe total due for all vendors and the total due for each vendor. Return these \ncolumns: \nThe vendor id from the Invoices table \nThe balance due (invoice_total - payment_total - credit_total) for each \ninvoice in the Invoices table with a balance due greater than 0 \nThe total balance due for all vendors in the Invoices table \nThe total balance due for each vendor in the Invoices table \nModify the column that contains the balance due £01· each vendor so it \ncontains a cumulative total by balance due. This should return 11 rows. \n10. Modify the solution to exercise 9 so it includes a column that calculates the \naverage balance due for each vendor in the Invoices table. This column should \ncontain a cumulative average by balance due. \nModify the SELECT statement so it uses a named window for the last two \naggregate window functions. \n11. Write a SELECT statement that uses an aggregate window function to calcu-\nlate a moving average of the sum of invoice totals. Return these columns: \nThe month of the invoice date from the Invoices table \nThe sum of the invoice totals from the Invoices table \nThe moving average of the invoice totals sorted by invoice month \nThe result set should be grouped by invoice month and the frame for the \nmoving average should include the current row plus tlu·ee rows before the \ncurrent row.\n\nHow to code subqueries \nSubqueries allow you to build queries that would be difficult or impossible \nto build otherwise. In chapter 5, you learned how to use them in INSERT, \nUPDATE, and DELETE statements. In this chapter, you'll learn how to use \nsubqueries in SELECT statements. \nAn introduction to subqueries .......................................... 200 \nWhere to code subqueries ........................................................................... 200 \nWhen to use subqueries .............................................................................. 202 \nHow to code subqueries in the WHERE clause .............. 204 \nHow to use the IN operator ......................................................................... 204 \nHow to use the comparison operators ........................................................ 206 \nHow to use the ALL keyword .................................................................... 208 \nHow to use the ANY and SOME keywords ................................................ 210 \nHow to code correlated subqueries .............................................................. 212 \nHow to use the EXISTS operator ................................................................ 214 \nHow to code subqueries in other clauses ....................... 216 \nHow to code subqueries in the HAVING clause ......................................... 216 \nHow to code subqueries in the SELECT clause .......................................... 216 \nHow to code subqueries in the FROM clattse ............................................. 218 \nHow to work with complex queries .................................. 220 \nA complex query that uses subqueries ........................................................ 220 \nA procedure for building complex queries ................................................. 222 \nHow to work with common table expressions ................ 224 \nHow to code a CTE .............................................. ....................................... 224 \nHow to code a recursive CTE ...................................................................... 226 \nPerspective ......................................................................... 228\n\nSection 2 \nMore SQL skills cts you need them \nAn introduction to subqueries \nAs you learned in chapter 5, a subquery is a SELECT statement that's coded \nwithin another SQL statement. Since you already know how to code SELECT \nstatements, you already know how to code subqueries. Now you just need to \nlearn where you can code them and when you should use them. \nWhere to code subqueries \nWHERE, HAVING, FROM, or SELECT clause of a SELECT statement. In this \nfigure, for example, the SELECT statement shows how you can use a subquery \nin a WHERE clause. This statement retrieves all the invoices from the Invoices \ntable that have invoice totals greater than the average of all the invoices. To do \nthat, the subquery calculates the average of all the invoices. Then, the search \ncondition tests each invoice to see if its invoice total is greater than that average. \nWhen a subquery returns a single value as it does in this example, you can \nuse it anywhere you would normally use a single value. However, a subquery \ncan also return a list of values (a result set that has one column). In that case, \nyou can use the subque1·y in place of a list of values, such as the list for an IN \noperator. In addition, a subquery can return a table of values (a result set that has \nmultiple columns). In that case, you can use the subquery in the FROM clause in \nplace of a table. In this chapter, you '11 learn about all of these different types of \nsubqueries. \nFinally, you can code a subquery within another subquery. In that case, the \nsubqueries are said to be nested. Because nested subqueries can be difficult to \nread, you should use them only when necessary.\n\nChapter 7 \nHow to l·ode subqueries \nFour ways to introduce a subquery in a SELECT statement \n1. In a WHERE clause as a search condition \n2. In a HAVING clause as a search condition \n3. In the FROM clause as a table specification \n4. In the SELECT clause as a column specification \nUse a subquery in the WHERE clause \nSELECT invoice_ n.11mh,=ir, invoice_date, invoice total \nFROM invoices \nWHERE invoice total> \n(SELECT AVG(invoice_ total) \nFROM invoices) \nORDER BY invoice_total \nThe value returned by the subquery \n1879.741316 \nThe result set \n' invoice number \ninvoice_date \ninvoice_ total \n► \n939319-qa7 \n2018-06-20 \n1927. 54 \n97/Sn. \n2018-06-28 \n1962.13 \n989319-417 \n.20 18-07 · 23 \n2051.59 \n989319-427 \n2018-06-16 \n2 115.81 \n989319-4n \n2018-06-08 \n2 184.11 \n2018-06-30 \n2184.50 \n( 2 1 rows ) \nDescription \n• \nA subquery is a SELECT statement that's coded within another SQL statement. For \nthis to work, yo11 m11st enclose the subquery in parentheses. \n• \nA subquery can return a single value, a list of values ( a result set that has a single \ncolumn), or a table of values (a result set that has multiple columns). \n• \nA subquery can be coded, or introduced, anywhere a single value, a list of values, \nor a table is allowed. \n• \nThe syntax for a subquery is the same as for a standard SELECT statement. \nHowever, a subquery can't include an ORDER BY clause. \n• \nSubqueries can be nested within other subqueries. \nWhere to code subqueries \nL \n'",
          "pages": [
            217,
            218,
            219,
            220,
            221
          ],
          "relevance": {
            "score": 0.55,
            "sql_score": 1.0,
            "concept_score": 0.5,
            "non_sql_penalty": 0.0,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "examples": {
          "text": "Section 2 \nMore SQL skills cts you need them \nWhen to use subqueries \nIn the last figure, you saw an example of a subquery that returns an aggre-\ngate value that's used in the search condition of a WHERE clause. This type of \nsubquery provides for processing that can't be done any other way. However, \nmost subqueries can be restated as joins, and most joins can be restated as \nsubqueries as shown by the SELECT statements in figure 7-2. \nBoth SELECT statements in this figure return a result set that consists of \nselected rows and columns from the Invoices table. In this case, only the invoices \nfor vendors in California are 1·eturned. The first statement uses a join to con1bine \nthe Vendors and Invoices tables so the vendor_state column can be tested for \neach invoice. In contrast, the second statement uses a subquery to return a \nresult set that consists of the vendor id column for each vendor in California. \nThen, that result set is used with the IN operator in the search condition so only \ninvoices with a vendor id in that result set are included in the final result set. \nSo if you have a choice, which technique should you use? In general, we \nrecommend that you use the technique that results in the most readable code. \nFor example, a join tends to be more intuitive than a subquery when it uses an \nexisting relationship between two tables. That's the case with the Vendors and \nInvoices tables used in this figure. On the other hand, a sttbquery tends to be \nmore intuitive when it uses an ad hoc relationship. \nYou should also realize that when you use a subquery in a WHERE clause, \nits results can't be included in the final result set. For instance, the second \nexample in this figure can't be changed to include the vendor_name column \nfrom the Vendors table. That's because the Vendors table isn't named in the \nFROM clause of the main query. So if you need to include information fro1n \nboth tables in the result set, you need to use a join.\n\nChapter 7 \nHow to l·ode subqueries \nA query that uses an inner join \nSELECT invoice_ n11mber, invoice_date, invo ice_total \nFROM invoices JOIN vendors \nON invoic e s.vendor_ id = vendors.vendor_ id \nWHERE vendor_ state = 'CA' \nORDER BY invoice_ date \nThe same query restated with a subquery \nSELECT invoice_ n1JmhP.r, invoice_date, invoice_total \nFROM invoic es \nWHERE vendor_ id IN --\n(SELECT vendor_ i ~ \nFROM vendors \nNBERE vendor_ state = 'CA') \nORDER BY invoic e _ date \nThe result set returned by both queries \nl invoice_number \ninvoice_date \ninv01ce_total \n► \n125520-1 \n2018-04-24 \n95.00 \n97/488 \n2018-04-24 \n601.95 \n111-92R-10096 \n2018-04-30 \n16.33 \n2018-05-01 \n6.00 \n(40 rows ) \nAdvantages of joins \n• \nThe SELECT clause of a join can include columns from both tables. \n• \nA join tends to be more intuitive when it uses an existing relationship between the \ntwo tables, such as a primary key to foreign key relationship. \nAdvantages of subqueries \n• \nYou can use a subquery to pass an aggregate value to the main query. \n• \nA subquery tends to be more intuitive when it uses an ad hoc relationship between \nthe two tables. \n• \nLong, complex queries can sometimes be easier to code using subqueries. \nDescription \n• \nLike a join, a subquery can be used to code queries that work with two or more \ntables. \n• \nMost subqueries can be restated as joins and most joins can be restated as \nsubqueries. \nWhen to use subqueries\n\nSection 2 \nMore SQL skills cts you need them \nHow to code subqueries \nin the WHERE clause \nYou can use a variety of techniques to work with a subquery in a WHERE \nclause. You'll learn about these techniques in the topics that follow. \nHow to use the IN operator \nIn chapter 3, you learned how to use the IN operator to test whether an \nexpression is contained in a list of values. One way to provide that list of values \nis to use a subquery as shown by figure 7-3. \nThe example in this figure retrieves the vendors from the Vendors table that \ndon't have invoices in the Invoices table. To do that, it uses a subquery to return \na list of IDs for each vendor that's in the Invoices table. Then, the main query \nreturns some data about the vendors whose IDs aren't in that list. \nWhen you use the IN operator with a subquery, the subquery must return a \nsingle column that provides the list of values. In this figure, the subquery also \nincludes the DISTINCT keyword. That way, if more than one invoice exists for \na vendor, the subquery only includes a single ID for th.e vendor. However, this \nkeyword is optional and has no effect on the final result set. \nIn the previous figure, you saw that a query that uses a subq11ery with the \nIN operator can be restated using an inner join. Similarly, a query that uses a \nsubquery with the NOT IN operator can typically be restated using an outer join. \nIn this figure, for instance, the first query can be restated as shown in the second \nquery. In this case, though, the first query is more readable.\n\nChapter 7 \nHow to l·ode subqueries \nThe syntax of a WHERE clause that uses an IN phrase \nWHERE test_expression [NOT] IN (subquery) \nGet vendors without invoices \nSELECT vendor_ id, vendor_name, vendor_state \nFROM vendors \nWHERE vendor_ id NOT IN \n(SELECT DISTINCT vendor_ id \nFROM invoic es ) \nORDER BY vendor id \nThe result of the subquery \nvendor_id \n► \n'18 \n(34 rows) \nThe result set \nvendor jd \nvendor _name \nNielson \nCal State Termite \nGraylift \nVenture Communications Int'I \nCustom Printing Company \nI \ntlO \nNat Assoc of College Stores \n(88 rows) \nvendor _state \nOH \nCA \nCA \nNY \nMO \nOH \nThe query restated without a subquery \nSELECT v .vendor_ id, vendor_ name, vendor_ state \nFROM vendors v LEFT JOIN invoices i \nON v . vendor_ id = i .vendor_ id \nWHERE i.vendor_ id IS NULL \nORDER BY v .vendor_ id \nDescription \n• \nYou can introduce a subquery with the IN operator to provide the list of values that \nare tested against the test expression. \n• \nWhen you use the IN operator, the subquery must return a single column of values. \n• \nA query that uses the NOT IN operator with a subquery can typically be restated \nusing an outer join. \nHow to use the IN operator\n\nSection 2 \nMore SQL skills cts you need them \nHow to use the comparison operators \nexpression with the result of a subquery. In this example, the subquery returns \nthe average balance due of the invoices in the Invoices table that have a balance \ndue greater than zero. Then, it uses that value to retrieve all invoices with a \nbalance due that's less than the average. \nWhen you use a compaiison operator as shown in this figure, the subquery \nmust return a single value. In most cases, that means that it uses an aggregate \nfunction. However, you can also use the comparison operators with subque-\nries that return a list of values. To do that, you use the SOME, ANY, or ALL \nkeywords as shown in the next two figures.\n\nChapter 7 \nHow to l·ode subqueries \nThe syntax of a WHERE clause that uses a comparison operator \nWHERE expression comparison_ operator [SOMEIANYIALL] (subquery) \nGet invoices with a balance due less than the average \nSELECT invoice_ r.t,,rnh~r, invoice_date, \ninvoice_ total - payment_ total - credit_ total AS halance_due \nFROM invoices \nWHERE invoice_ total - payment_ total - credit_ total > 0 \nAND invoice total - payment_ total - credit total< \n( \nSELECT AVG(invoice_ total - payment_ total - credit_ total) \nFROM invoices \n) \nORDER BY invoice_ total DESC \nThe value returned by the subquery \n2910.947273 \nThe result set \ninvoice _number \ninvoice_date \nbalance_due \n► \n2018-07-21 \n579.42 \n99s2n1 \n.2018-07-24 \n503.20 \n2018-08-01 \n224.00 \n2018-07-28 \n90.36 \n2018-07-10 \n85.31 \n2018-07-22 \n67.92 \n( 9 rows ) \nDescription \n• \nYou can use a comparison operator in a WHERE clause to compare an expression \nwith the results of a subquery. \n• \nIf you code a search condition without the ANY, SOME, and ALL keywords, the \nsubquery must return a single value. \n• \nIf you include the ANY, SOME, or ALL keyword, the subquery can return a list of \nvalues. See figures 7-5 and 7-6 for more information on using these keywords. \nHow to use the comparison operators\n\nSection 2 \nMore SQL skills cts you need them \nHow to use the ALL keyword \noperator so the condition must be true for all the values returned by a subquery. \nThe table at the top of this figure shows how this works. Here, the values in \nparentheses 1·epresent the values returned by the query. \nIf you use the greater than operator(>), the expression must be greater than \nthe maximum value returned by the subquery. Conversely, if you use the less \nthan operator ( < ), the expression must be less than the minimum value returned \nby the subquery. If you use the equal operator ( = ), all of the values returned by \nthe subquery must be the same and the expression must be equal to that value. \nAnd if you use the not equal operator ( <>), the expression must not equal any \nof the values returned by the subquery. However, a not equal condition can be \nrestated using the NOT IN operator, which is easier to read. As a result, it's a \nbetter practice to use the NOT IN operator for this type of condition. \nThe query in this figure shows how to use the greater than operator with the \nALL keyword. Here, the subquery selects the invoice_total column for all the \ninvoices with a vendor_id value of 34. This results in a list of two values. Then, \nthe main query retrieves the rows from the Invoices table that have invoice totals \ngreater than both of the values returned by the subquery. In other words, this \nquery returns all the invoices that have totals greater than 1083.58, which is the \nlargest invoice for vendor number 34. \nWhen you use the ALL operator, the comparison evaluates to true if the \nsubquery doesn't return any rows. In contrast, the comparison evaluates to false \nif the subquery returns only null values. \nIn many cases, you can rewrite a condition with the ALL keyword so it's \neasier to read. For example, you could rewrite the query in this figure to use the \nMAX function like this: \nWHERE invoice_total > \n(SELECT MAX(invoice_total) \nFROM invoices \nWHERE vendor_ id = 34) \nAs a result, we recommend replacing the ALL keyword with an equivalent \ncondition whenever it makes the query easier to read.\n\nChapter 7 \nHow to l·ode subqueries \nHow the ALL keyword works \nCondition \nEquivalent expression \nDescription \nX > ALL (1, 2} \nX > 2 \nEvaluates to true if x is greater than the \nmaximum value returned by the subquery. \nX < ALL (1, 2 } \nX < 1 \nEvaluates to true if x is less than the mini-\nmum value returned by the subquery. \nX = ALL (1, 2 } \n(x = 1 } AND (x = 2} \nEvaluates to true if the subquery returns a \nsingle value that's equal to x or if the sub-\nquery returns multiple values that are the \nsame and these values are all equal to x. \nX <> ALL (1, 2 } \nx NOT IN (1, 2} \nEvaluates to true if xis not one of the \nvalues returned by the subquery. \nGet invoices larger than the largest invoice for vendor 34 \nSELECT vendor_name, invoice_ n,,rnber, invoice_ total \nFROM invoices i JOIN vendors v ON i.vendor_ id = v.vendor_ id \nWHERE invoice total > ALL \n( SELECT invoice_ total \nFROM invoices \nWHERE vendor_ id = 34} \nORDER BY vendor name \nThe result of the subquery \ninvoice total \n► \n116.54 \n1083.58 \nThe result set \nI vendor name \n► f Bertelsm~ \nIndustry Svcs. Inc \nCahners Publishing Company \nComputerworid \ninvoice_number \ninvoice_total -\n69~.25 \n2184.50 \n2433,00 \nData Reproducbons Corp \n~318 \n21842.00 \n(2 5 rows ) \nDescription \n• \nYou can use the ALL keyword to test that a comparison condition is true for all of \nthe values returned by a subquery. \n• \nIf no rows are returned by the subquery, a comparison that uses the ALL keyword is \nalways true. \n• \nIf all of the rows returned by the subquery contain a null value, a comparison that \nuses the ALL keyword is always false. \nHow to use the ALL keyword \n.t\n\nSection 2 \nMore SQL skills cts you need them \nHow to use the ANY and SOME keywords \na comparison is true for any of the values returned by a subquery. Since both of \nthese keywords work the same, you can use whichever one you pref er. For the \nsake of brevity, this figure uses the ANY keyword in its examples. However, you \ncan substitute the SOME keyword for the ANY keyword to get the same results. \nThe example in this figure shows how you can use the ANY keyword \nwith the less than operator. This statement is similar to the one you saw in the \nprevious figure, except that it retrieves invoices with invoice totals that are less \nthan at least one of the invoice totals for a given vendor. Like the statement in \nthe previous figure, this condition can be rewritten using the MAX function, as \nfollows: \nWHERE invoi ce_total < \n(SELECT MAX (invoice _t otal) \nFROM i nvoices \nWHERE vendor id = 115) \nSince this statement is easier to read, we recommend using statements like this \none instead of statements that use the ANY keyword whenever possible.\n\nChapter 7 \nHow to l·ode subqueries \nHow the ANY keyword works \nCondition \nEquivalent expression \nDescription \nx > ANY (1, 2) \nX > 1 \nx < ANY (1 , 2) \nX < 2 \nx = ANY (1 , 2) \nx IN (1 , 2) \nX <> ANY (1 , 2 ) \n(x <> 1) OR (x <> 2 ) \nEvaluates to true if x is greater than the \n1.n.inimum value returned by the subquery. \nEvaluates to true if xis less than the maxi-\nmum value returned by the subquery. \nEvaluates to true if x is equal to any of the \nvalues returned by the subquery. \nEvaluates to true if x is not equal to at least \none of the values returned by the subquery. \nGet invoices smaller than the largest invoice for vendor 115 \nSELECT vendor_name, invo ice_number, invoic e_ total \nFROM vendors JOIN invoices ON vendors.vendor_ id = invoices.vendor id \nWHERE invoic e _ total < ANY \n(SELECT invoice_total \nFROM invoices \nWHERE vendor_ id = 115 ) \nThe result of the subquery \ninvoice_total \n► \n6.00 \n6.00 \n25.67 \n6.00 \nThe result set \n_ l vendor_name \n► \nFederal Express Corporation \nPacific BeD \nRoadway Pad<age System, Inc \nCompuserve \nI \nFederal Express Corporation \n(17 rows ) \nDescription \ninvolce_number \n11 l-92R-10096 \n21-4748363 \n+321-2596 \n1nvoice_total \n15.50 \n16.33 \n6.00 \n9.95 \n10.00 \n• \nYou can use the ANY keyword to test that a condition is true for one or more of the \nvalues returned by a subquery. \n• \nIf the subquery doesn't return any values, or if it only returns null values, a compar-\nison that uses the ANY keyword evaluates to false. \n• \nThe SOME keyword works the same as the ANY keyword. \nHow to use the ANY and SOME keywords\n\nSection 2 \nMore SQL skills cts you need them \nHow to code correlated subqueries \nSo far, all of the subqueries in this chapter have been uncorrelated subque-\nries. An uncorrelated subquery is executed only once for the entire query. \nHowever, you can also code a correlated subquery that's executed once for each \nrow that's processed by the main query. This type of query is similar to using a \nloop to do repetitive processing in a procedural programming language like PHP \nor Java. \nrows from the Invoices table for those invoices that have an invoice total that's \ngreater than the average of all the invoices for the same vendor. To do that, the \nWHERE clause of the subquery refers to the vendor_id value of the main query. \nThat way, only the invoices for the current vendor are included in the average. \nEach time MySQL processes a row in the main query, it substitutes the \nvalue in the vendor_id column for the column reference in the subquery. Then, \nMySQL executes the subquery based on that value. For example, if the vendor_ \nid value is 95, MySQL executes this subquery: \nSELECT AVG (invoice_ total) \nFROM i nvoic e s \nWHERE vendor_ id = 95 \nAfter MySQL executes this subquery, it uses the returned value to detern1ine \nwhether to include the current invoice in the result set. For example, for vendor \n95, the subquery returns a value of 28.501667. Then, MySQL compares that \nvalue with the invoice total of the current invoice. If the invoice total is greater \nthan that value, MySQL includes the invoice in the result set. Otherwise, it \ndoesn't. MySQL repeats this process until it has processed each of the invoices \nin the Invoices table. \nIn this figure, the WHERE clause of the subquery qualifies the vendor_id \ncolumn from the main query with the alias that's assigned to the Invoices table \nin that query. This is necessary because this statement uses the same table in the \nsub and main queries. So, the use of a table alias avoids ambiguity. However, if a \nsubquery uses a different table than the main query, a table alias isn't necessary. \nSince correlated subqueri.es can be difficult to code, you may want to test \na subquery separately before using it within another SELECT statement. To \ndo that, however, you'll need to substitute a constant value for the variable that \nrefers to a column in the outer query. That's what we did to get the average \ninvoice total for vendor 95. Once you 're sure that the subquery works on its own, \nyou can replace the constant value with a reference to the outer query so you can \nuse it within a SELECT statement.",
          "pages": [
            222,
            223,
            224,
            225,
            226,
            227,
            228,
            229,
            230,
            231,
            232
          ],
          "relevance": {
            "score": 0.45,
            "sql_score": 1.0,
            "concept_score": 0.5,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "commonMistakes": {
          "text": "Get each invoice amount that's higher \nthan the vendor's average invoice amount \nSELECT vendor_ id, invoice_ number, invoice_ total \nFROM invoices i \nWHERE invoice_ total > \n(SELECT AVG(invoice_total) \nFROM invoices \nWHERE vendor_ id = i.vendor_id) \nORDER BY vendor_ id, invoice_total \nChapter 7 \nHow to l·ode subqueries \nThe value returned by the subquery for vendor 95 \n28.501667 \nThe result set \n_j_ vendor jd \nlnvoice_number \ninvoice_ total \n1575.00 \n111-92R-10095 \n32.70 \nlll-92R-10093 \n39.77 \n111-92R-10092 \n~ .21 \nI 110 \nP-0259 \n26881.40 \n( 36 rows ) \nDescription \n• \nA correlated subquery is a subquery that is executed once for each row in the \nmain query. In contrast, an uncorrelated subquery is executed only once. All of the \nsubqueries in the previous figures are uncorrelated subqueries. \n• \nA correlated subquery refers to a value that's provided by a column in the main \nquery. For each different value that's returned by the main query for that column, \nthe su bquery returns a different result. \n• \nTo refer to a column in the main query, you can qualify the column with a table \nname or alias. If a correlated subquery uses the same table as the main query, you \ncan use table aliases to re1nove ambiguity. \nHow to code correlated subqueries\n\nSection 2 \nMore SQL skills cts you need them \nHow to use the EXISTS operator \noperator tests whether the subquery returns a result set. In other words, it tests \nwhether the result set exists. When you use this operator, the subquery doesn't \nactually return a result set to the outer query. Instead, it returns an indication of \nwhether any rows satisfy the search condition of the subquery. Because of that, \nqueries that use this operator execute quickly. \nYou typically use the EXISTS operator with a correlated subquery as shown \nin this figure. This query retrieves all the vendors in the Vendors table that don't \nhave invoices in the Invoices table. Although this query returns the same vendors \nas the queries shown in figure 7-3, it executes more quickly than either of those \n• \nquenes. \nIn this example, the correlated subquery selects all invoices that have the \nsame vendor_id value as the current vendor in the outer query. Because the \nsubquery doesn't actually return a result set, it doesn't matter what columns \nare included in the SELECT clause. As a result, it's customary to j11st code an \nasterisk. \nAfter the subquery is executed, the search condition in the WHERE clause \nof the main query uses the NOT EXISTS operator to test whether any invoices \nwere found for the current vendor. If not, the vendor row is included in the result \nset.\n\nChapter 7 \nHow to l·ode subqueries \nThe syntax of a subquery that uses the EXISTS operator \nWHERE [NOT] EXISTS (subquery) \nGet all vendors that don't have invoices \nSELECT vendor id, vendor_ name, vendor_state \nFROM vendors \nWHERE NOT EXISTS \n(SELECT* \nFROM invoices \nWHERE vendor_ id = vendors.vendor_ id) \nThe result set \nvendor jd \nvendor _name \n-33 \n39 I \n'10 \n(88 rows ) \nDescription \nNielson \nCal State Termite \nGrayfift \nVenture Communications Int'I \nCustom Printing Company \nNat Assoc of CoUege Stores \nvendor _state \nOH \nCA \nCA \nNY \nMO \nOH \n• \nYou can use the EXISTS operator to test that one or more rows are returned by the \nsubquery. \n• \nYou can use the NOT EXISTS operator to test that no rows are returned by the \nsubquery. \n• \nWhen you use these operators with a subquery, it doesn't matter what columns you \nspecify in the SELECT clause. As a result, you typically just code an asterisk ( * ). \nHow to use the EXISTS operator \n-\n\nSection 2 \nMore SQL skills cts you need them \nHow to code subqueries \nin other clauses \nNow that you know how to code subqueries in the WHERE clause of a \nSELECT statement, you're ready to learn how to code them in the HAVING, \nFROM, and SELECT clauses. \nHow to code subqueries in the HAVING clause \nWhen you code a HA YING clause, you specify a search condition just as \nyou do when you code a WHERE clause. That includes search conditions that \ncontain subqueries. To learn how to code subqueries in a HAVING clause, then, \nyou can refer back to figures 7-3 through 7-8. \nHow to code subqueries in the SELECT clause \nthat, you code the subquery in place of a column specification. As a result, the \nsubquery must return a single value for that column. \nIn most cases, you code correlated subqueries in the SELECT clause. In this \nfigure, for example, the subquery calculates the maximum invoice date for each \nvendor in the Vendors table. To do that, the subquery refers to the vendor_id \ncolumn from the Vendors table in the main query. \nSubqueries coded in the SELECT clause are typically difficult to read. As \na result, you shouldn't use them if you can fmd another solution. In most cases, \nyou can replace the subquery with a join. In this figure, for example, the frrst \nquery can be restated as shown in the second query. This query joins the Vendors \nand Invoices tables, groups the rows by vendor_name, and uses the MAX \nfunction to calculate the maximum invoice date for each vendor. As a result, this \nquery is easier to read.",
          "pages": [
            233,
            234,
            235,
            236
          ],
          "relevance": {
            "score": 0.45,
            "sql_score": 1.0,
            "concept_score": 0.5,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        }
      },
      "educational_notes": {
        "definition": "MySQL functions are pre-defined routines that perform specific operations on data. They help simplify complex queries and make your database more efficient.",
        "explanation": "MySQL functions are essential for performing calculations, manipulating text, and handling dates and times directly within SQL queries without needing to write additional programming code. These functions can be grouped into several categories: arithmetic, string, date and time, and aggregate functions. Understanding how to use these functions correctly is crucial for writing efficient and powerful SQL queries.",
        "key_points": [
          "MySQL functions simplify complex operations by performing them directly within the database.",
          "Common function types include arithmetic (SUM, AVG), string (CONCAT, SUBSTRING), date and time (NOW, DATE_ADD), and aggregate (COUNT, MAX).",
          "Using functions correctly can significantly improve query performance and readability."
        ],
        "examples": [
          {
            "title": "Basic Usage of an Aggregate Function",
            "code": "-- Calculate the total amount invoiced for each account\nSELECT account_number, SUM(line_item_amount) AS total_amount FROM Invoice_Line_Items GROUP BY account_number;",
            "explanation": "This example demonstrates how to use the SUM function to calculate the total line item amount for each account number. The results are grouped by account number."
          },
          {
            "title": "Practical Example: Using a String Function",
            "code": "-- Concatenate vendor name and account description\nSELECT CONCAT(vendor_name, ' - ', account_description) AS vendor_info FROM Vendors JOIN Invoice_Line_Items ON Vendors.account_number = Invoice_Line_Items.account_number;",
            "explanation": "This practical example shows how to use the CONCAT function to combine vendor name and account description into a single column. It joins two tables based on account number."
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Incorrectly using aggregate functions without grouping",
            "incorrect_code": "-- This will cause an error\nSELECT SUM(line_item_amount) FROM Invoice_Line_Items;",
            "correct_code": "-- Correct usage with GROUP BY\nSELECT account_number, SUM(line_item_amount) AS total_amount FROM Invoice_Line_Items GROUP BY account_number;",
            "explanation": "Aggregates like SUM and AVG require a GROUP BY clause to operate on each group of rows. Failing to include it will result in an error."
          },
          {
            "mistake": "Forgetting to use parentheses with functions",
            "incorrect_code": "-- This will cause an error\nSELECT SUBSTRING(vendor_name, 1, 3) vendor_name FROM Vendors;",
            "correct_code": "-- Correct usage with parentheses\nSELECT SUBSTRING(vendor_name, 1, 3) AS vendor_name FROM Vendors;",
            "explanation": "Parentheses are necessary to define the arguments for functions. Forgetting them can lead to syntax errors."
          }
        ],
        "practice": {
          "question": "Write a query that calculates the average invoice total for each quarter of 2018.",
          "solution": "-- Calculate average invoice total per quarter\nSELECT QUARTER(invoice_date) AS quarter, AVG(invoice_total) AS avg_total FROM Invoices WHERE YEAR(invoice_date) = 2018 GROUP BY quarter;"
        }
      },
      "llm_enhanced": true,
      "raw_text_preview": "Chapter 6 \nHow to code sum1ncary queries \nThe sum of the line item amount columns in the Invoice Line Items table \n-\nthat have the same account_nu1nber \nReturn only those rows where the count of line ",
      "content_relevance": {
        "score": 0.45,
        "sql_score": 1.0,
        "concept_score": 0.5,
        "non_sql_penalty": 0.1,
        "is_relevant": true,
        "analysis": "SQL content"
      }
    },
    "string-functions": {
      "id": "string-functions",
      "title": "String Functions",
      "definition": "CONCAT, SUBSTRING, LENGTH, TRIM, UPPER, LOWER, and more",
      "difficulty": "beginner",
      "page_references": [
        218,
        219,
        220,
        221,
        222,
        223,
        224,
        225,
        226,
        227,
        228
      ],
      "sections": {
        "definition": {
          "text": "Section 2 \nMore SQL skills cts you need them \n9. \nWrite a SELECT statement that uses aggregate window functions to calculate \nthe total due for all vendors and the total due for each vendor. Return these \ncolumns: \nThe vendor id from the Invoices table \nThe balance due (invoice_total - payment_total - credit_total) for each \ninvoice in the Invoices table with a balance due greater than 0 \nThe total balance due for all vendors in the Invoices table \nThe total balance due for each vendor in the Invoices table \nModify the column that contains the balance due £01· each vendor so it \ncontains a cumulative total by balance due. This should return 11 rows. \n10. Modify the solution to exercise 9 so it includes a column that calculates the \naverage balance due for each vendor in the Invoices table. This column should \ncontain a cumulative average by balance due. \nModify the SELECT statement so it uses a named window for the last two \naggregate window functions. \n11. Write a SELECT statement that uses an aggregate window function to calcu-\nlate a moving average of the sum of invoice totals. Return these columns: \nThe month of the invoice date from the Invoices table \nThe sum of the invoice totals from the Invoices table \nThe moving average of the invoice totals sorted by invoice month \nThe result set should be grouped by invoice month and the frame for the \nmoving average should include the current row plus tlu·ee rows before the \ncurrent row.\n\nHow to code subqueries \nSubqueries allow you to build queries that would be difficult or impossible \nto build otherwise. In chapter 5, you learned how to use them in INSERT, \nUPDATE, and DELETE statements. In this chapter, you'll learn how to use \nsubqueries in SELECT statements. \nAn introduction to subqueries .......................................... 200 \nWhere to code subqueries ........................................................................... 200 \nWhen to use subqueries .............................................................................. 202 \nHow to code subqueries in the WHERE clause .............. 204 \nHow to use the IN operator ......................................................................... 204 \nHow to use the comparison operators ........................................................ 206 \nHow to use the ALL keyword .................................................................... 208 \nHow to use the ANY and SOME keywords ................................................ 210 \nHow to code correlated subqueries .............................................................. 212 \nHow to use the EXISTS operator ................................................................ 214 \nHow to code subqueries in other clauses ....................... 216 \nHow to code subqueries in the HAVING clause ......................................... 216 \nHow to code subqueries in the SELECT clause .......................................... 216 \nHow to code subqueries in the FROM clattse ............................................. 218 \nHow to work with complex queries .................................. 220 \nA complex query that uses subqueries ........................................................ 220 \nA procedure for building complex queries ................................................. 222 \nHow to work with common table expressions ................ 224 \nHow to code a CTE .............................................. ....................................... 224 \nHow to code a recursive CTE ...................................................................... 226 \nPerspective ......................................................................... 228\n\nSection 2 \nMore SQL skills cts you need them \nAn introduction to subqueries \nAs you learned in chapter 5, a subquery is a SELECT statement that's coded \nwithin another SQL statement. Since you already know how to code SELECT \nstatements, you already know how to code subqueries. Now you just need to \nlearn where you can code them and when you should use them. \nWhere to code subqueries \nWHERE, HAVING, FROM, or SELECT clause of a SELECT statement. In this \nfigure, for example, the SELECT statement shows how you can use a subquery \nin a WHERE clause. This statement retrieves all the invoices from the Invoices \ntable that have invoice totals greater than the average of all the invoices. To do \nthat, the subquery calculates the average of all the invoices. Then, the search \ncondition tests each invoice to see if its invoice total is greater than that average. \nWhen a subquery returns a single value as it does in this example, you can \nuse it anywhere you would normally use a single value. However, a subquery \ncan also return a list of values (a result set that has one column). In that case, \nyou can use the subque1·y in place of a list of values, such as the list for an IN \noperator. In addition, a subquery can return a table of values (a result set that has \nmultiple columns). In that case, you can use the subquery in the FROM clause in \nplace of a table. In this chapter, you '11 learn about all of these different types of \nsubqueries. \nFinally, you can code a subquery within another subquery. In that case, the \nsubqueries are said to be nested. Because nested subqueries can be difficult to \nread, you should use them only when necessary.",
          "pages": [
            218,
            219,
            220
          ],
          "relevance": {
            "score": 0.55,
            "sql_score": 1.0,
            "concept_score": 0.5,
            "non_sql_penalty": 0.0,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "examples": {
          "text": "Chapter 7 \nHow to l·ode subqueries \nFour ways to introduce a subquery in a SELECT statement \n1. In a WHERE clause as a search condition \n2. In a HAVING clause as a search condition \n3. In the FROM clause as a table specification \n4. In the SELECT clause as a column specification \nUse a subquery in the WHERE clause \nSELECT invoice_ n.11mh,=ir, invoice_date, invoice total \nFROM invoices \nWHERE invoice total> \n(SELECT AVG(invoice_ total) \nFROM invoices) \nORDER BY invoice_total \nThe value returned by the subquery \n1879.741316 \nThe result set \n' invoice number \ninvoice_date \ninvoice_ total \n► \n939319-qa7 \n2018-06-20 \n1927. 54 \n97/Sn. \n2018-06-28 \n1962.13 \n989319-417 \n.20 18-07 · 23 \n2051.59 \n989319-427 \n2018-06-16 \n2 115.81 \n989319-4n \n2018-06-08 \n2 184.11 \n2018-06-30 \n2184.50 \n( 2 1 rows ) \nDescription \n• \nA subquery is a SELECT statement that's coded within another SQL statement. For \nthis to work, yo11 m11st enclose the subquery in parentheses. \n• \nA subquery can return a single value, a list of values ( a result set that has a single \ncolumn), or a table of values (a result set that has multiple columns). \n• \nA subquery can be coded, or introduced, anywhere a single value, a list of values, \nor a table is allowed. \n• \nThe syntax for a subquery is the same as for a standard SELECT statement. \nHowever, a subquery can't include an ORDER BY clause. \n• \nSubqueries can be nested within other subqueries. \nWhere to code subqueries \nL \n'\n\nSection 2 \nMore SQL skills cts you need them \nWhen to use subqueries \nIn the last figure, you saw an example of a subquery that returns an aggre-\ngate value that's used in the search condition of a WHERE clause. This type of \nsubquery provides for processing that can't be done any other way. However, \nmost subqueries can be restated as joins, and most joins can be restated as \nsubqueries as shown by the SELECT statements in figure 7-2. \nBoth SELECT statements in this figure return a result set that consists of \nselected rows and columns from the Invoices table. In this case, only the invoices \nfor vendors in California are 1·eturned. The first statement uses a join to con1bine \nthe Vendors and Invoices tables so the vendor_state column can be tested for \neach invoice. In contrast, the second statement uses a subquery to return a \nresult set that consists of the vendor id column for each vendor in California. \nThen, that result set is used with the IN operator in the search condition so only \ninvoices with a vendor id in that result set are included in the final result set. \nSo if you have a choice, which technique should you use? In general, we \nrecommend that you use the technique that results in the most readable code. \nFor example, a join tends to be more intuitive than a subquery when it uses an \nexisting relationship between two tables. That's the case with the Vendors and \nInvoices tables used in this figure. On the other hand, a sttbquery tends to be \nmore intuitive when it uses an ad hoc relationship. \nYou should also realize that when you use a subquery in a WHERE clause, \nits results can't be included in the final result set. For instance, the second \nexample in this figure can't be changed to include the vendor_name column \nfrom the Vendors table. That's because the Vendors table isn't named in the \nFROM clause of the main query. So if you need to include information fro1n \nboth tables in the result set, you need to use a join.\n\nChapter 7 \nHow to l·ode subqueries \nA query that uses an inner join \nSELECT invoice_ n11mber, invoice_date, invo ice_total \nFROM invoices JOIN vendors \nON invoic e s.vendor_ id = vendors.vendor_ id \nWHERE vendor_ state = 'CA' \nORDER BY invoice_ date \nThe same query restated with a subquery \nSELECT invoice_ n1JmhP.r, invoice_date, invoice_total \nFROM invoic es \nWHERE vendor_ id IN --\n(SELECT vendor_ i ~ \nFROM vendors \nNBERE vendor_ state = 'CA') \nORDER BY invoic e _ date \nThe result set returned by both queries \nl invoice_number \ninvoice_date \ninv01ce_total \n► \n125520-1 \n2018-04-24 \n95.00 \n97/488 \n2018-04-24 \n601.95 \n111-92R-10096 \n2018-04-30 \n16.33 \n2018-05-01 \n6.00 \n(40 rows ) \nAdvantages of joins \n• \nThe SELECT clause of a join can include columns from both tables. \n• \nA join tends to be more intuitive when it uses an existing relationship between the \ntwo tables, such as a primary key to foreign key relationship. \nAdvantages of subqueries \n• \nYou can use a subquery to pass an aggregate value to the main query. \n• \nA subquery tends to be more intuitive when it uses an ad hoc relationship between \nthe two tables. \n• \nLong, complex queries can sometimes be easier to code using subqueries. \nDescription \n• \nLike a join, a subquery can be used to code queries that work with two or more \ntables. \n• \nMost subqueries can be restated as joins and most joins can be restated as \nsubqueries. \nWhen to use subqueries\n\nSection 2 \nMore SQL skills cts you need them \nHow to code subqueries \nin the WHERE clause \nYou can use a variety of techniques to work with a subquery in a WHERE \nclause. You'll learn about these techniques in the topics that follow. \nHow to use the IN operator \nIn chapter 3, you learned how to use the IN operator to test whether an \nexpression is contained in a list of values. One way to provide that list of values \nis to use a subquery as shown by figure 7-3. \nThe example in this figure retrieves the vendors from the Vendors table that \ndon't have invoices in the Invoices table. To do that, it uses a subquery to return \na list of IDs for each vendor that's in the Invoices table. Then, the main query \nreturns some data about the vendors whose IDs aren't in that list. \nWhen you use the IN operator with a subquery, the subquery must return a \nsingle column that provides the list of values. In this figure, the subquery also \nincludes the DISTINCT keyword. That way, if more than one invoice exists for \na vendor, the subquery only includes a single ID for th.e vendor. However, this \nkeyword is optional and has no effect on the final result set. \nIn the previous figure, you saw that a query that uses a subq11ery with the \nIN operator can be restated using an inner join. Similarly, a query that uses a \nsubquery with the NOT IN operator can typically be restated using an outer join. \nIn this figure, for instance, the first query can be restated as shown in the second \nquery. In this case, though, the first query is more readable.\n\nChapter 7 \nHow to l·ode subqueries \nThe syntax of a WHERE clause that uses an IN phrase \nWHERE test_expression [NOT] IN (subquery) \nGet vendors without invoices \nSELECT vendor_ id, vendor_name, vendor_state \nFROM vendors \nWHERE vendor_ id NOT IN \n(SELECT DISTINCT vendor_ id \nFROM invoic es ) \nORDER BY vendor id \nThe result of the subquery \nvendor_id \n► \n'18 \n(34 rows) \nThe result set \nvendor jd \nvendor _name \nNielson \nCal State Termite \nGraylift \nVenture Communications Int'I \nCustom Printing Company \nI \ntlO \nNat Assoc of College Stores \n(88 rows) \nvendor _state \nOH \nCA \nCA \nNY \nMO \nOH \nThe query restated without a subquery \nSELECT v .vendor_ id, vendor_ name, vendor_ state \nFROM vendors v LEFT JOIN invoices i \nON v . vendor_ id = i .vendor_ id \nWHERE i.vendor_ id IS NULL \nORDER BY v .vendor_ id \nDescription \n• \nYou can introduce a subquery with the IN operator to provide the list of values that \nare tested against the test expression. \n• \nWhen you use the IN operator, the subquery must return a single column of values. \n• \nA query that uses the NOT IN operator with a subquery can typically be restated \nusing an outer join. \nHow to use the IN operator\n\nSection 2 \nMore SQL skills cts you need them \nHow to use the comparison operators \nexpression with the result of a subquery. In this example, the subquery returns \nthe average balance due of the invoices in the Invoices table that have a balance \ndue greater than zero. Then, it uses that value to retrieve all invoices with a \nbalance due that's less than the average. \nWhen you use a compaiison operator as shown in this figure, the subquery \nmust return a single value. In most cases, that means that it uses an aggregate \nfunction. However, you can also use the comparison operators with subque-\nries that return a list of values. To do that, you use the SOME, ANY, or ALL \nkeywords as shown in the next two figures.\n\nChapter 7 \nHow to l·ode subqueries \nThe syntax of a WHERE clause that uses a comparison operator \nWHERE expression comparison_ operator [SOMEIANYIALL] (subquery) \nGet invoices with a balance due less than the average \nSELECT invoice_ r.t,,rnh~r, invoice_date, \ninvoice_ total - payment_ total - credit_ total AS halance_due \nFROM invoices \nWHERE invoice_ total - payment_ total - credit_ total > 0 \nAND invoice total - payment_ total - credit total< \n( \nSELECT AVG(invoice_ total - payment_ total - credit_ total) \nFROM invoices \n) \nORDER BY invoice_ total DESC \nThe value returned by the subquery \n2910.947273 \nThe result set \ninvoice _number \ninvoice_date \nbalance_due \n► \n2018-07-21 \n579.42 \n99s2n1 \n.2018-07-24 \n503.20 \n2018-08-01 \n224.00 \n2018-07-28 \n90.36 \n2018-07-10 \n85.31 \n2018-07-22 \n67.92 \n( 9 rows ) \nDescription \n• \nYou can use a comparison operator in a WHERE clause to compare an expression \nwith the results of a subquery. \n• \nIf you code a search condition without the ANY, SOME, and ALL keywords, the \nsubquery must return a single value. \n• \nIf you include the ANY, SOME, or ALL keyword, the subquery can return a list of \nvalues. See figures 7-5 and 7-6 for more information on using these keywords. \nHow to use the comparison operators",
          "pages": [
            221,
            222,
            223,
            224,
            225,
            226,
            227
          ],
          "relevance": {
            "score": 0.45,
            "sql_score": 1.0,
            "concept_score": 0.5,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "commonMistakes": {
          "text": "Section 2 \nMore SQL skills cts you need them \nHow to use the ALL keyword \noperator so the condition must be true for all the values returned by a subquery. \nThe table at the top of this figure shows how this works. Here, the values in \nparentheses 1·epresent the values returned by the query. \nIf you use the greater than operator(>), the expression must be greater than \nthe maximum value returned by the subquery. Conversely, if you use the less \nthan operator ( < ), the expression must be less than the minimum value returned \nby the subquery. If you use the equal operator ( = ), all of the values returned by \nthe subquery must be the same and the expression must be equal to that value. \nAnd if you use the not equal operator ( <>), the expression must not equal any \nof the values returned by the subquery. However, a not equal condition can be \nrestated using the NOT IN operator, which is easier to read. As a result, it's a \nbetter practice to use the NOT IN operator for this type of condition. \nThe query in this figure shows how to use the greater than operator with the \nALL keyword. Here, the subquery selects the invoice_total column for all the \ninvoices with a vendor_id value of 34. This results in a list of two values. Then, \nthe main query retrieves the rows from the Invoices table that have invoice totals \ngreater than both of the values returned by the subquery. In other words, this \nquery returns all the invoices that have totals greater than 1083.58, which is the \nlargest invoice for vendor number 34. \nWhen you use the ALL operator, the comparison evaluates to true if the \nsubquery doesn't return any rows. In contrast, the comparison evaluates to false \nif the subquery returns only null values. \nIn many cases, you can rewrite a condition with the ALL keyword so it's \neasier to read. For example, you could rewrite the query in this figure to use the \nMAX function like this: \nWHERE invoice_total > \n(SELECT MAX(invoice_total) \nFROM invoices \nWHERE vendor_ id = 34) \nAs a result, we recommend replacing the ALL keyword with an equivalent \ncondition whenever it makes the query easier to read.",
          "pages": [
            228
          ],
          "relevance": {
            "score": 0.55,
            "sql_score": 1.0,
            "concept_score": 0.5,
            "non_sql_penalty": 0.0,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        }
      },
      "educational_notes": {
        "definition": "String functions are built-in SQL commands used to manipulate and process character data within a database. They help in extracting specific parts of strings, converting their case, removing spaces, and more. Understanding string functions is crucial for data cleaning, formatting, and analysis.",
        "explanation": "String functions are essential tools in SQL that allow you to work with text data effectively. These functions can be used to perform various operations such as extracting substrings, replacing characters, converting case, trimming spaces, and more. By mastering string functions, you can enhance the quality of your data and make it easier to analyze and manipulate.",
        "key_points": [
          "Most important thing to remember: String functions are powerful tools for handling text data in SQL.",
          "Critical detail about usage: Always ensure that the correct function is used based on the specific operation needed. For example, use `SUBSTRING` for extracting parts of a string, and `UPPER` or `LOWER` for case conversion.",
          "Common pitfall to avoid: Overusing string functions can lead to performance issues. Only apply them when necessary and consider using other SQL features like joins and conditions if possible.",
          "Best practice or tip: Always test your string functions with sample data to ensure they work as expected before applying them to large datasets.",
          "How this connects to other concepts: String functions are often used in conjunction with aggregate functions (like `SUM`, `AVG`) and window functions (like `ROW_NUMBER`, `RANK`) for complex data analysis."
        ],
        "examples": [
          {
            "title": "Basic Usage",
            "code": "-- Extract the first 5 characters FROM a string SELECT SUBSTRING(column_name, 1, 5) FROM table_name;",
            "explanation": "This example demonstrates how to use the `SUBSTRING` function to extract the first 5 characters from a column in a table.",
            "validation_note": "SQL auto-fixed: "
          },
          {
            "title": "Practical Example",
            "code": "-- Convert all text in a column to uppercase\nSELECT UPPER(column_name) FROM table_name;",
            "explanation": "This practical example shows how to use the `UPPER` function to convert all text in a specific column to uppercase."
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Using incorrect function parameters",
            "incorrect_code": "-- Incorrect parameter usage\nSELECT SUBSTRING(column_name, 10, -5) FROM table_name;",
            "correct_code": "-- Correct parameter usage\nSELECT SUBSTRING(column_name, 10, 5) FROM table_name;",
            "explanation": "This mistake occurs when the parameters for a string function are incorrect. Always ensure that the start position and length are correctly specified."
          }
        ],
        "practice": {
          "question": "Write a SQL query to extract the last name from a full name stored in a column named `full_name`.",
          "solution": "-- Correct solution\nSELECT SUBSTRING(full_name, CHARINDEX(' ', full_name) + 1) AS last_name FROM table_name;"
        }
      },
      "llm_enhanced": true,
      "raw_text_preview": "Section 2 \nMore SQL skills cts you need them \n9. \nWrite a SELECT statement that uses aggregate window functions to calculate \nthe total due for all vendors and the total due for each vendor. Return th",
      "content_relevance": {
        "score": 0.45,
        "sql_score": 1.0,
        "concept_score": 0.5,
        "non_sql_penalty": 0.1,
        "is_relevant": true,
        "analysis": "SQL content"
      }
    },
    "date-functions": {
      "id": "date-functions",
      "title": "Date and Time Functions",
      "definition": "NOW, CURDATE, DATE_FORMAT, DATE_ADD, DATEDIFF, and more",
      "difficulty": "intermediate",
      "page_references": [
        228,
        229,
        230,
        231,
        232,
        233,
        234,
        235,
        236,
        237,
        238
      ],
      "sections": {
        "definition": {
          "text": "Section 2 \nMore SQL skills cts you need them \nHow to use the ALL keyword \noperator so the condition must be true for all the values returned by a subquery. \nThe table at the top of this figure shows how this works. Here, the values in \nparentheses 1·epresent the values returned by the query. \nIf you use the greater than operator(>), the expression must be greater than \nthe maximum value returned by the subquery. Conversely, if you use the less \nthan operator ( < ), the expression must be less than the minimum value returned \nby the subquery. If you use the equal operator ( = ), all of the values returned by \nthe subquery must be the same and the expression must be equal to that value. \nAnd if you use the not equal operator ( <>), the expression must not equal any \nof the values returned by the subquery. However, a not equal condition can be \nrestated using the NOT IN operator, which is easier to read. As a result, it's a \nbetter practice to use the NOT IN operator for this type of condition. \nThe query in this figure shows how to use the greater than operator with the \nALL keyword. Here, the subquery selects the invoice_total column for all the \ninvoices with a vendor_id value of 34. This results in a list of two values. Then, \nthe main query retrieves the rows from the Invoices table that have invoice totals \ngreater than both of the values returned by the subquery. In other words, this \nquery returns all the invoices that have totals greater than 1083.58, which is the \nlargest invoice for vendor number 34. \nWhen you use the ALL operator, the comparison evaluates to true if the \nsubquery doesn't return any rows. In contrast, the comparison evaluates to false \nif the subquery returns only null values. \nIn many cases, you can rewrite a condition with the ALL keyword so it's \neasier to read. For example, you could rewrite the query in this figure to use the \nMAX function like this: \nWHERE invoice_total > \n(SELECT MAX(invoice_total) \nFROM invoices \nWHERE vendor_ id = 34) \nAs a result, we recommend replacing the ALL keyword with an equivalent \ncondition whenever it makes the query easier to read.\n\nChapter 7 \nHow to l·ode subqueries \nHow the ALL keyword works \nCondition \nEquivalent expression \nDescription \nX > ALL (1, 2} \nX > 2 \nEvaluates to true if x is greater than the \nmaximum value returned by the subquery. \nX < ALL (1, 2 } \nX < 1 \nEvaluates to true if x is less than the mini-\nmum value returned by the subquery. \nX = ALL (1, 2 } \n(x = 1 } AND (x = 2} \nEvaluates to true if the subquery returns a \nsingle value that's equal to x or if the sub-\nquery returns multiple values that are the \nsame and these values are all equal to x. \nX <> ALL (1, 2 } \nx NOT IN (1, 2} \nEvaluates to true if xis not one of the \nvalues returned by the subquery. \nGet invoices larger than the largest invoice for vendor 34 \nSELECT vendor_name, invoice_ n,,rnber, invoice_ total \nFROM invoices i JOIN vendors v ON i.vendor_ id = v.vendor_ id \nWHERE invoice total > ALL \n( SELECT invoice_ total \nFROM invoices \nWHERE vendor_ id = 34} \nORDER BY vendor name \nThe result of the subquery \ninvoice total \n► \n116.54 \n1083.58 \nThe result set \nI vendor name \n► f Bertelsm~ \nIndustry Svcs. Inc \nCahners Publishing Company \nComputerworid \ninvoice_number \ninvoice_total -\n69~.25 \n2184.50 \n2433,00 \nData Reproducbons Corp \n~318 \n21842.00 \n(2 5 rows ) \nDescription \n• \nYou can use the ALL keyword to test that a comparison condition is true for all of \nthe values returned by a subquery. \n• \nIf no rows are returned by the subquery, a comparison that uses the ALL keyword is \nalways true. \n• \nIf all of the rows returned by the subquery contain a null value, a comparison that \nuses the ALL keyword is always false. \nHow to use the ALL keyword \n.t\n\nSection 2 \nMore SQL skills cts you need them \nHow to use the ANY and SOME keywords \na comparison is true for any of the values returned by a subquery. Since both of \nthese keywords work the same, you can use whichever one you pref er. For the \nsake of brevity, this figure uses the ANY keyword in its examples. However, you \ncan substitute the SOME keyword for the ANY keyword to get the same results. \nThe example in this figure shows how you can use the ANY keyword \nwith the less than operator. This statement is similar to the one you saw in the \nprevious figure, except that it retrieves invoices with invoice totals that are less \nthan at least one of the invoice totals for a given vendor. Like the statement in \nthe previous figure, this condition can be rewritten using the MAX function, as \nfollows: \nWHERE invoi ce_total < \n(SELECT MAX (invoice _t otal) \nFROM i nvoices \nWHERE vendor id = 115) \nSince this statement is easier to read, we recommend using statements like this \none instead of statements that use the ANY keyword whenever possible.",
          "pages": [
            228,
            229,
            230
          ],
          "relevance": {
            "score": 0.55,
            "sql_score": 1.0,
            "concept_score": 0.5,
            "non_sql_penalty": 0.0,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "examples": {
          "text": "Chapter 7 \nHow to l·ode subqueries \nHow the ANY keyword works \nCondition \nEquivalent expression \nDescription \nx > ANY (1, 2) \nX > 1 \nx < ANY (1 , 2) \nX < 2 \nx = ANY (1 , 2) \nx IN (1 , 2) \nX <> ANY (1 , 2 ) \n(x <> 1) OR (x <> 2 ) \nEvaluates to true if x is greater than the \n1.n.inimum value returned by the subquery. \nEvaluates to true if xis less than the maxi-\nmum value returned by the subquery. \nEvaluates to true if x is equal to any of the \nvalues returned by the subquery. \nEvaluates to true if x is not equal to at least \none of the values returned by the subquery. \nGet invoices smaller than the largest invoice for vendor 115 \nSELECT vendor_name, invo ice_number, invoic e_ total \nFROM vendors JOIN invoices ON vendors.vendor_ id = invoices.vendor id \nWHERE invoic e _ total < ANY \n(SELECT invoice_total \nFROM invoices \nWHERE vendor_ id = 115 ) \nThe result of the subquery \ninvoice_total \n► \n6.00 \n6.00 \n25.67 \n6.00 \nThe result set \n_ l vendor_name \n► \nFederal Express Corporation \nPacific BeD \nRoadway Pad<age System, Inc \nCompuserve \nI \nFederal Express Corporation \n(17 rows ) \nDescription \ninvolce_number \n11 l-92R-10096 \n21-4748363 \n+321-2596 \n1nvoice_total \n15.50 \n16.33 \n6.00 \n9.95 \n10.00 \n• \nYou can use the ANY keyword to test that a condition is true for one or more of the \nvalues returned by a subquery. \n• \nIf the subquery doesn't return any values, or if it only returns null values, a compar-\nison that uses the ANY keyword evaluates to false. \n• \nThe SOME keyword works the same as the ANY keyword. \nHow to use the ANY and SOME keywords\n\nSection 2 \nMore SQL skills cts you need them \nHow to code correlated subqueries \nSo far, all of the subqueries in this chapter have been uncorrelated subque-\nries. An uncorrelated subquery is executed only once for the entire query. \nHowever, you can also code a correlated subquery that's executed once for each \nrow that's processed by the main query. This type of query is similar to using a \nloop to do repetitive processing in a procedural programming language like PHP \nor Java. \nrows from the Invoices table for those invoices that have an invoice total that's \ngreater than the average of all the invoices for the same vendor. To do that, the \nWHERE clause of the subquery refers to the vendor_id value of the main query. \nThat way, only the invoices for the current vendor are included in the average. \nEach time MySQL processes a row in the main query, it substitutes the \nvalue in the vendor_id column for the column reference in the subquery. Then, \nMySQL executes the subquery based on that value. For example, if the vendor_ \nid value is 95, MySQL executes this subquery: \nSELECT AVG (invoice_ total) \nFROM i nvoic e s \nWHERE vendor_ id = 95 \nAfter MySQL executes this subquery, it uses the returned value to detern1ine \nwhether to include the current invoice in the result set. For example, for vendor \n95, the subquery returns a value of 28.501667. Then, MySQL compares that \nvalue with the invoice total of the current invoice. If the invoice total is greater \nthan that value, MySQL includes the invoice in the result set. Otherwise, it \ndoesn't. MySQL repeats this process until it has processed each of the invoices \nin the Invoices table. \nIn this figure, the WHERE clause of the subquery qualifies the vendor_id \ncolumn from the main query with the alias that's assigned to the Invoices table \nin that query. This is necessary because this statement uses the same table in the \nsub and main queries. So, the use of a table alias avoids ambiguity. However, if a \nsubquery uses a different table than the main query, a table alias isn't necessary. \nSince correlated subqueri.es can be difficult to code, you may want to test \na subquery separately before using it within another SELECT statement. To \ndo that, however, you'll need to substitute a constant value for the variable that \nrefers to a column in the outer query. That's what we did to get the average \ninvoice total for vendor 95. Once you 're sure that the subquery works on its own, \nyou can replace the constant value with a reference to the outer query so you can \nuse it within a SELECT statement.\n\nGet each invoice amount that's higher \nthan the vendor's average invoice amount \nSELECT vendor_ id, invoice_ number, invoice_ total \nFROM invoices i \nWHERE invoice_ total > \n(SELECT AVG(invoice_total) \nFROM invoices \nWHERE vendor_ id = i.vendor_id) \nORDER BY vendor_ id, invoice_total \nChapter 7 \nHow to l·ode subqueries \nThe value returned by the subquery for vendor 95 \n28.501667 \nThe result set \n_j_ vendor jd \nlnvoice_number \ninvoice_ total \n1575.00 \n111-92R-10095 \n32.70 \nlll-92R-10093 \n39.77 \n111-92R-10092 \n~ .21 \nI 110 \nP-0259 \n26881.40 \n( 36 rows ) \nDescription \n• \nA correlated subquery is a subquery that is executed once for each row in the \nmain query. In contrast, an uncorrelated subquery is executed only once. All of the \nsubqueries in the previous figures are uncorrelated subqueries. \n• \nA correlated subquery refers to a value that's provided by a column in the main \nquery. For each different value that's returned by the main query for that column, \nthe su bquery returns a different result. \n• \nTo refer to a column in the main query, you can qualify the column with a table \nname or alias. If a correlated subquery uses the same table as the main query, you \ncan use table aliases to re1nove ambiguity. \nHow to code correlated subqueries\n\nSection 2 \nMore SQL skills cts you need them \nHow to use the EXISTS operator \noperator tests whether the subquery returns a result set. In other words, it tests \nwhether the result set exists. When you use this operator, the subquery doesn't \nactually return a result set to the outer query. Instead, it returns an indication of \nwhether any rows satisfy the search condition of the subquery. Because of that, \nqueries that use this operator execute quickly. \nYou typically use the EXISTS operator with a correlated subquery as shown \nin this figure. This query retrieves all the vendors in the Vendors table that don't \nhave invoices in the Invoices table. Although this query returns the same vendors \nas the queries shown in figure 7-3, it executes more quickly than either of those \n• \nquenes. \nIn this example, the correlated subquery selects all invoices that have the \nsame vendor_id value as the current vendor in the outer query. Because the \nsubquery doesn't actually return a result set, it doesn't matter what columns \nare included in the SELECT clause. As a result, it's customary to j11st code an \nasterisk. \nAfter the subquery is executed, the search condition in the WHERE clause \nof the main query uses the NOT EXISTS operator to test whether any invoices \nwere found for the current vendor. If not, the vendor row is included in the result \nset.\n\nChapter 7 \nHow to l·ode subqueries \nThe syntax of a subquery that uses the EXISTS operator \nWHERE [NOT] EXISTS (subquery) \nGet all vendors that don't have invoices \nSELECT vendor id, vendor_ name, vendor_state \nFROM vendors \nWHERE NOT EXISTS \n(SELECT* \nFROM invoices \nWHERE vendor_ id = vendors.vendor_ id) \nThe result set \nvendor jd \nvendor _name \n-33 \n39 I \n'10 \n(88 rows ) \nDescription \nNielson \nCal State Termite \nGrayfift \nVenture Communications Int'I \nCustom Printing Company \nNat Assoc of CoUege Stores \nvendor _state \nOH \nCA \nCA \nNY \nMO \nOH \n• \nYou can use the EXISTS operator to test that one or more rows are returned by the \nsubquery. \n• \nYou can use the NOT EXISTS operator to test that no rows are returned by the \nsubquery. \n• \nWhen you use these operators with a subquery, it doesn't matter what columns you \nspecify in the SELECT clause. As a result, you typically just code an asterisk ( * ). \nHow to use the EXISTS operator \n-\n\nSection 2 \nMore SQL skills cts you need them \nHow to code subqueries \nin other clauses \nNow that you know how to code subqueries in the WHERE clause of a \nSELECT statement, you're ready to learn how to code them in the HAVING, \nFROM, and SELECT clauses. \nHow to code subqueries in the HAVING clause \nWhen you code a HA YING clause, you specify a search condition just as \nyou do when you code a WHERE clause. That includes search conditions that \ncontain subqueries. To learn how to code subqueries in a HAVING clause, then, \nyou can refer back to figures 7-3 through 7-8. \nHow to code subqueries in the SELECT clause \nthat, you code the subquery in place of a column specification. As a result, the \nsubquery must return a single value for that column. \nIn most cases, you code correlated subqueries in the SELECT clause. In this \nfigure, for example, the subquery calculates the maximum invoice date for each \nvendor in the Vendors table. To do that, the subquery refers to the vendor_id \ncolumn from the Vendors table in the main query. \nSubqueries coded in the SELECT clause are typically difficult to read. As \na result, you shouldn't use them if you can fmd another solution. In most cases, \nyou can replace the subquery with a join. In this figure, for example, the frrst \nquery can be restated as shown in the second query. This query joins the Vendors \nand Invoices tables, groups the rows by vendor_name, and uses the MAX \nfunction to calculate the maximum invoice date for each vendor. As a result, this \nquery is easier to read.\n\nChapter 7 \nHow to l·ode subqueries \nGet the most recent invoice date for each vendor \nSELECT vendor_name, \n(SELECT MAX(invoice_date) FROM invoices \nWHERE vendor_ id = vendors.vendor_ id) AS latest_inv \nFROM vendors \nORDER BY latest inv DESC \nThe result set \nvendor _name \nlatest_lllV \n► \nFederal Express Corporation \n2018-08-02 \nBlue Cross \n2018-08.Ql \nMaftoy Lithographing Inc \n2018-07-31 \nCardinal Business Media, Inc. \n2018-07-28 \nI \nZylka Design \n2018--07-25 \nFord Motor Credit Company \n2018-07-24 \n(122 rows) \nThe same query restated using a join \nSELECT vendor_name, MAX(invoice_date) AS latest_ inv \nFROM vendors v \nLEFT JOIN invoices i ON v.vendor_ id = i.vendor_ id \nGROUP BY vendor_name \nORDER BY latest_inv DESC \nDescription \n• \nWhen you code a subquery in the SELECT clause, the subquery must return a \nsingle value. \n• \nWhen you code a subquery in the SELECT clause, you typically use a correlated \nsubquery. \n• \nA query that includes a subquery in its SELECT clause can typically be restated \nusing a join instead of the subquery. Because a join is usually faster and easier to \nread, subqueries are seldom coded in the SELECT clause. \nHow to code subqueries in the SELECT clause \n. \nI",
          "pages": [
            231,
            232,
            233,
            234,
            235,
            236,
            237
          ],
          "relevance": {
            "score": 0.45,
            "sql_score": 1.0,
            "concept_score": 0.5,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "commonMistakes": {
          "text": "Section 2 \nMore SQL skills cts you need them \nHow to code subqueries in the FROM clause \nyou code a subquery in place of a table specification. When you code a subquery \nin the FROM clause, it can return a result set that contains any number of rows \nand columns. This result set is sometimes referred to as an inline view. \nSubqueries are typically used in the FROM clause to create inline views that \nprovide summarized data to another summary query. In this figure, for example, \nthe subquery returns a result set that contains the vendor state, the vendor name, \nand the sum of invoice totals for each vendor. To do that, it groups the vendors \nby state and name. Once the subquery returns this result set, the main query \ngroups the result set by vendor state and gets the largest sum of invoice totals for \neach state. This rettrrns the invoice total for the top vendor in each state. \nWhen you code a subquery in the FROM clause, you must assign a table \nalias to the subquery. This is required even if you don't use the table alias in the \nmain query. In this figure, for example, the query assigns a table alias oft (for \nte.mporary table) to the subquery. \nIn addition, you should assign a column alias to all calculated columns in \na subquery. In this figure, for example, the subquery assigns a column alias \nof sum_of_invoices to the result of the SUM function. That makes it easier to \nrefer to these columns from other clauses in the st1bquery if you need to do \nthat. It also makes it possible to refer to the column from the main query. In \nthis example, for instance, the sum_of_invoices column is referred to by tl1e \nSELECT clause.",
          "pages": [
            238
          ],
          "relevance": {
            "score": 0.52,
            "sql_score": 0.9,
            "concept_score": 0.5,
            "non_sql_penalty": 0.0,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        }
      },
      "educational_notes": {
        "definition": "Date and Time Functions are built-in SQL functions that allow you to manipulate and extract information from date and time data types.",
        "explanation": "These functions are essential for performing operations on dates and times in your database. They help you filter, sort, and analyze data based on specific time-related criteria. For example, you might want to find all records from a particular month or year, calculate the age of users, or determine if an event has passed. By using date and time functions, you can make your queries more powerful and flexible.",
        "key_points": [
          "Key point 1: Date and Time Functions allow for precise data manipulation and extraction.",
          "Key point 2: Common functions include EXTRACT, DATE_ADD, DATE_SUB, and DATEDIFF.",
          "Key point 3: Always ensure the correct syntax to avoid errors in your queries."
        ],
        "examples": [
          {
            "title": "Extracting Year from a Date",
            "code": "SELECT EXTRACT(YEAR FROM order_date) AS year FROM orders;",
            "explanation": "This example demonstrates how to extract the year from an 'order_date' column in the 'orders' table. The result will be a list of years.",
            "validation_note": "SQL auto-fixed: "
          },
          {
            "title": "Adding Days to a Date",
            "code": "SELECT DATE_ADD(order_date, INTERVAL 7 DAY) AS next_week FROM orders;",
            "explanation": "This example shows how to add 7 days to each 'order_date' in the 'orders' table. The result will be a list of dates one week after each original order date."
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Using incorrect function names",
            "incorrect_code": "SELECT EXTRACT(YEAR FROM order_date) AS year FROM orders;",
            "correct_code": "SELECT YEAR(order_date) AS year FROM orders;",
            "explanation": "The correct function name is 'YEAR', not 'EXTRACT' with the argument 'YEAR'. Always refer to the SQL documentation for the right function names."
          }
        ],
        "practice": {
          "question": "Write a query that selects all records from the 'employees' table where the employee's hire date was in the year 2015.",
          "solution": "SELECT * FROM employees WHERE YEAR(hire_date) = 2015;"
        }
      },
      "llm_enhanced": true,
      "raw_text_preview": "Section 2 \nMore SQL skills cts you need them \nHow to use the ALL keyword \noperator so the condition must be true for all the values returned by a subquery. \nThe table at the top of this figure shows h",
      "content_relevance": {
        "score": 0.45,
        "sql_score": 1.0,
        "concept_score": 0.5,
        "non_sql_penalty": 0.1,
        "is_relevant": true,
        "analysis": "SQL content"
      }
    },
    "aggregate-functions-murach": {
      "id": "aggregate-functions-murach",
      "title": "Aggregate Functions",
      "definition": "COUNT, SUM, AVG, MAX, MIN, and DISTINCT aggregates",
      "difficulty": "beginner",
      "page_references": [
        241,
        242,
        243,
        244,
        245,
        246,
        247,
        248,
        249,
        250,
        251,
        252,
        253,
        254,
        255,
        256,
        257,
        258,
        259,
        260
      ],
      "sections": {
        "definition": {
          "text": "Chapter 7 \nHow to l·ode subqueries \nA complex query that uses three subqueries \nSELECT tl.vendor_ state, vendor_name, tl.sum of invoices \nFROM \n( \n) tl \n-- invoice totals by vendor \nSELECT vendor_ state, vendor_name, \nSUM(invoice_total) AS sum_of_ invoices \nFROM vendors v JOIN invoices i \nON v.vendor_ id = i.vendor_ id \nGROUP BY vendor_ state, vendor_ name \nJOIN \n( \n-- top invoice totals by state \nSELECT vendor_ state, \nMAX(sum_of_ invoices) AS sum_of_ invoices \nFROM \n( \n) t2 \n-- invoice totals by vendor \nFROM vendors v JOIN invoices i \nON v.vendor id= i.vendor id \nGROUP BY vendor_ state, vendor_name \nGROUP BY vendor_state \n) t3 \nON tl.vendor_ state = t3.vendor_ state AND \ntl.sum of invoices= t3.sum of invoices \n-\nORDER BY vendor_ state \nThe result set \nI vendor _state \n► \nAZ \nCA \nI~ \n(10 rows) \nDescription \nvendor _name \n\\ft/eDs Fargo Bank \nDigital Dreamworks \nReiter's Scientific &.Pro Books \nDean \\!'Jitter Reynolds \nsum_of _invoices \n662.00 \n7125.34 \n600.00 \n1367.50 \n• \nThis query retrieves the vendor from each state that has the largest invoice total. To \ndo that, it uses three subqueries. \n• \nThis query uses comments to clearly identify its three queries. \n• \nThe subqueries named tl and t2 return the same result set. This result set includes \nthe vendor state, name, and sum of invoices. \n• \nThe subquery named t3 returns a result set that includes the vendor state and the \nlargest sum of invoices for any vendor in that state. To do that, this subquery uses a \nnested subquery named t2. \n• \nThe subqueries named tl and t3 are joined on both the vendor_state and st1m_of_invoices \ncolumns. \nA complex query that uses subqueries\n\nSection 2 \nMore SQL skills cts you need them \nA procedure for building complex queries \nTo build a complex query like the one in the previous figure, you can use a \nprocedure like the one in figure 7-12. To sta1t, you should state the question in \nEnglish so you're clear about what you want the query to answer. In this case, \nthe question is, ''Which vendor in each state has the largest invoice total?'' \nOnce you're clear about the problem, you can outline the query using \npseudocode. Pseudocode is code that represents the intent of the query, but \ndoesn't necessarily use SQL code. The pseudocode shown in this figure, for \nexample, uses part SQL code and part English. This pseudocode identifies the \nthree columns returned by the main query, two subqueries, and even the join \ncondition for the two subqueries. \nThe next step in the procedure is to code and test the subqueries to be sure \nthey work the way you want them to. For example, this figure shows the code \nfor the frrst subquery along with its result set. This returns all of the data that \nyou want, but it also includes extra rows that you don't want. To remove the \nextra rows from the frrst query, you can code the second subquery shown in this \nfigure. This subquery uses the first subquery as a nested subquery. Although this \nremoves the extra rows, it also removes the vendor_name column. \nOnce you 're sure that both subqueries work the way you want them to, you \ncan use them in the main query. For example, the pseudocode in this figure \nshows that you should join the result sets returned by the subqueries on the \nvendor_state and sum_of_invoices columns. In addition, the code in the previous \nfigure shows how these two subq11eries are used in the main query. This allows \nyou to get all of the columns you want in the final result set without any of the \nextra rows that you don't want. \nWriting complex queries is difficult, but following a procedure like the one \nshown in this figure can make it a little easier. At first, you might not be able to \nuse pseudocode to identify subqueries. In that case, it's OK to skip ahead to step \n3 and begin experimenting with possible subqueries. This may give you some \nideas for how to solve the problem. Once you get these subqueries working \ncorrectly, you can begin coding a main query, and you can cut and paste the \nsubqueries into the main query.\n\nChapter 7 \nHow to l·ode subqueries \nA procedure for building complex queries \n1. State the problem to be solved by the query in English. \n2. Use pseudocode to outline the query. \n3. Code the subqueries and test them to be sure that they return the correct data. \n4. Code and test the final query. \nThe problem to be solved by the query in figure 7-11 \nWhich vendor in each state has the largest invoice total? \nPseudocode for the query \nSELECT vendor_state, vendor_name, sum_of_ invoices \nFROM {subquery returning vendor_ state, vendor_name, sum_of_ invoices) \nJOIN (subquery returning vendor_ state, largest_ sum_of_ invoices) \nON vendor_state AND swn_of_ invoices \nORDER BY vendor_state \nThe code for the first subquery \nSELECT vendor_state, vendor_name, SUM(invoice_total) AS swn_of_ invoices \nFROM vendors v JOIN invoices i \nON v.vendor_ id = i.vendor_id \nGROUP BY vendor_ state, vendor_name \nThe result set for the first subquery \nvendor _state \nvendor _name \nsum_of_invoices \n► \nNV \nUnited Parcel Service \n23177.96 \n1N \nFederal Express Corporation \n4378.02 \nCA \nEvans Exerutone Inc \n95.00 \n(34 rows) \nThe code for the second subquery \nSELECT vendor_ state, MAX(sum_of_ invoices) AS sum_of_ invoices \nFROM \n( \n) t \nSELECT vendor_state, vendor_name, \nSUM(invoice_total) AS sum_of_ invoices \nFROM vendors v JOIN invoices i \nON v.vendor_ id = i.vendor_ id \nGROUP BY vendor_ state, vendor name \nGROUP BY vendor state \nThe result set for the second subquery \nvendor _state \nsum_of _Invoices \n► \nNV \n23177.96 \n1N \n4378.02 \nCA \n7125.34 \n(10 rows) \n\" \nV \n\" \n,___ \nV\n\nSection 2 \nMore SQL skills cts you need them \nHow to work with \ncommon table expressions \nA common table expression ( CTE) is a new feature of MySQL 8.0 that \nallows you to code an expression that defines a named temporary result set. You \ncan use CTEs to simplify complex queries that use subque1ies. This can make \nyour code easier to read and maintain. In addition, you can use a CTE to loop \nthrough nested structures. \nHow to code a CTE \npresented in figure 7-11. To start, the statement for the query begins with the \nWITH keyword to indicate that you are about to define a CTE. Then, it speci-\nfies summary as the name for the first result set, followed by the AS keyword, \nfollowed by a SELECT statement enclosed in parentheses that defines the 1·esult \nset. In this figure, for example, this statement returns the same result set as the \nsubqueries named tl and t2 that were presented in figure 7-11. \nAfter the frrst CTE is defmed, this example continues by defining a second \nCTE named top_in_state. To start, a comma is coded to separate the two CTEs. \nThen, this query specifies top_in_state as the name for the second result set, \nfollowed by the AS keyword, followed by a SELECT statement enclosed in \nparentheses that defines the result set. This SELECT statement refers to the \nsummary result set that was defined by the first CTE. When coding multiple \nCTEs like this, a CTE can refer to any CTEs in the same WITH clause that are \ncoded before it, but it can't refer to CTEs coded after it. As a result, this state-\nment wouldn't work if the two CTEs were coded in the reverse order. \nFinally, the SELECT statement that's coded immediately after the two CTEs \nuses both of these CTEs just as if they were tables. To do that, this SELECT \nstatement joins the two rest1lt sets, specifies the columns to retrieve, and speci-\nfies the sort order. To avoid ambiguous references, each column is qualified \nby the name for the CTE. If yot1 compare figure 7-13 with figure 7-11, I think \nyou' 11 agree that the code in figure 7-13 is easier to read. That's partly because \nthe 1·esult sets defmed by the subqueries aren't nested within the SELECT state-\nment. In addition, I think you'll agree that the code in figure 7-13 is easier to \nmaintain. That's because this query reduces code duplication by only coding the \nsummary subquery in one place, not in two places. \nWhen using the syntax shown here to define CTEs, you must supply distinct \nnames for all columns defined by the SELECT statement, including calculated \nvalues. That way, it's possible for other statements to refer to the columns in the \nresult set. Most of the time, that's all you need to know to be able to work with \nCTEs. For more information about working with CTEs, you can look up ''WITH \nSyntax (Common Table Expressions)'' in the documentation for MySQL.",
          "pages": [
            241,
            242,
            243,
            244
          ],
          "relevance": {
            "score": 0.39,
            "sql_score": 1.0,
            "concept_score": 0.38,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "examples": {
          "text": "Chapter 7 \nHow to l·ode subqueries \nThe syntax of a CTE \nWITH [RECURSIVE] cte_namel AS {subqueryl) \n[, cte_ name2 AS {subquery2)] \nC ••• l \nsql_statement \nTwo CTEs and a query that uses them \nWITH summary AS \n{ \nSELECT vendor_ state, vendor_ name, SUM{invoice total) AS sum_of_ invoices \nFROM vendors v JOIN invoices i \nON v.vendor_ id = i.vendor_ id \nGROUP BY vendor_state, vendor_name \n) , \ntop_ in_state AS \n( \nSELECT vendor_state, MAX(sum_of_invoices) AS sum_of_ invoices \nFROM summary \nGROUP BY vendor_state \n) \nSELECT summary.vendor_state, summary.vendor_ name, \ntop_ in_ state.sum_of_ invoices \nFROM summary JOIN top_ in_state \nON summary.vendor_state = top_ in_ state.vendor_state AND \nsummary.sum_of_ invoices = top_ in_ state.sum_of_ invoices \nORDER BY summary.vendor_state \nThe result set \nvendor _state \nvendor _name \nsum_ of _invoices \n► \nAZ \n\\A/ells Fargo Bank \n662.00 \nCA \nDigital Dreamworks \n7125.34 \nDC \nReiter's Scientific & Pro Books \n600.00 \nMA \nDean Witter Reynolds \n1367.50 \nMI \nMalloy Lithographing Inc \n119892.41 \nINV \nUnited Parcel Service \n231n.96 \nOH \nEdward Data Services \n207. 78 \nPA \ncardinal Business Media, Inc. \n265.36 \n(10 rows ) \nDescription \n• \nA common table expression (CTE) is a SELECT statement that creates one or \nmore named temporary result sets that can be used by the query that follows. \n• \nTo use a CTE, you code the WITH keyword followed by the definition of the \nCTE. Then, iminediately after the CTE, you code the statement that uses it. \nV \n• \nTo code multiple CTEs, separate them with commas. Then, each CTE can refer to \nitself and any previously defined CTEs in the same WITH clause. \n• \nTo code a recursive CTE, include the RECURSIVE keyword after the WITH \nkeyword. See figure 7-14 for more on recursive CTEs. \n• \nAlthough you can use CTEs with SELECT, INSERT, UPDATE, and DELETE \nstatements, you'r·e most likely to use them with SELECT statements. \nHow to code a CTE\n\nSection 2 \nMore SQL skills cts you need them \nHow to code a recursive CTE \nA recursive qLtery is a query that is able to loop through a result set and \nperform processing to return a final result set. Recursive queries are commonly \nused to return hierarchical data such as an organizational chart in which a parent \nelement may have one or more child elements, and each child element may have \none or more child elements. Prior to MySQL 8.0, a recursive query required \nusing inline views, cursors, and logic to control the flow of the rect1rsive steps. \nWith MySQL 8.0 and later, you can use a recursive CTE to code recursive \nqueries more easily. Figure 7-14 shows how. \nThe top of this figure shows an Employees table where the manager_id \ncolumn is used to identify the manager for each employee. Here, Cindy Smith is \nthe top level manager since she doesn't have a manager, Elmer Jones and Paulo \nLocario report to Cindy, and so on. \nThe recursive CTE shown in this figure returns each employee according \nto their level in the organization chart for the company. To do that, this state-\nment begins by defining a CTE named employees_cte. Note here that the \nWITH clause includes the RECURSIVE keyword. This is required for recursive \ncommon table expressions. If you forget this keyword, you'll get error code \n1146: ''Table 'table name' doesn't exist''. \nWithin the CTE, two SELECT statements are joined by the UNION ALL \noperator. Here, the frrst SELECT statement uses the IS NULL operator to return \nthe frrst row of the result set. Because this statement doesn't refer to the name of \nthe CTE, it is non-recursive. \nThe second SELECT statement creates a loop by referring to the name of the \nCTE. Specifically, this state1nent joins the Employees table to the employees_cte \nresult set that's defined by the CTE. Because of that, it is a recursive SELECT \nstatement that loops through eacl1 row in the Employees table. With each loop, it \nadds 1 to the ranking column and appends the current result set to the fmal result \nset. For example, on the first loop, it appends Elmer Jones and Paulo Locario \nto the final result set. On the second loop, it appends Ralph Simonian, Thomas \nHardy, Olivia Hernandez, and Rhea O'Leary to the final result set. And so on. \nWl1en coding a recursive CTE, you must follow some rules. FiI·st, you must \nsupply a name for each column defmed by the CTE. To do that, you just need to \nmake sure to specify a name for each column in the non-recursive query. Second, \nthe rules for coding a union that you learned in chapter 4 still apply. In particular, \nthe two SELECT statements must have the same number of columns and the \ncolumns must have compatible data types. \nMost of the time, that's all you need to know to be able to work with recur-\nsive CTEs. However, the goal of this topic is to show a simple recursive CTE to \ngive you a general idea of how they work. For more inf or1nation about working \nwith recursive CTEs, you can start by looking up ''WITH Syntax (Common \nTable Expressions)'' in the documentation for MySQL and then clicking on the \n''Recursive Common Table Expressions'' link.\n\nChapter 7 \nHow to l·ode subqueries \nThe Employees table \nemployee_id \nlast_name \nfirst_name \ndepartment_number \nmanagerj d \n► \nSmith \nCindy \njl(IJ!I \nJones \nElmer \nSimonian \nRalph \nHernandez \nOlivia \nAaronsen \nRobert \nWatson \nDenise \nHardy \nThomas \nO'Leary \nRhea \nLocario \nPaulo \nA recursive CTE that returns hierarchical data \nWITH U CURSIVE employees_cte AS \n( \n-- Nonrecursive query \nSELECT employee_ id, \nCONCAT(first_pam~, ' ', last_ name) AS employee_name, \n1 AS ranking \nFROM employees \nWHERE manager_id IS NULL \nUNION ALL \n-- Recursive query \nSELECT employees.employee_id, \nCONCAT(first_ name, ' ', last_name), \nranking+ 1 \nFROM employees \nJOIN employees_cte \nON employees.manager_ id = employees_cte.employee_ id \n) \nSELECT* \nFROM employees_cte \nORDER BY ranking, employee_id \nThe final result set \nemployee_id \nemployee_name \nranking \n► \nCindy Smith \nBmer Jones \nPaulo Locario \nRalph Simonian \nOlivia Hernandez \nThomas Hardy \nRhea O'Leary \nRobert Aaronsen \nDenise Watson \nDescription \n• \nA recursive query is a query that can loop through a result set and perform processing \nto return a final result set. A recursive CTE can be used to create a recursive query. \n• \nA recursive CTE contains a non-recursive SELECT statement followed by a \nrecursive SELECT statement, and these two statements must be connected by the \nUNION or UNION ALL operator. \nHow to code a recursive CTE\n\nSection 2 \nMore SQL skills cts you need them \nPerspective \nSubqueries are a powerful tool that you can use to solve difficult problems. \nBefore you use a subquery, however, remember that a subqt1ery can often be \nrestated more clearly by using a join. If so, you '11 typically want to use a join \ninstead of a subquery. \nIf you find yourself coding the same subqueries in multiple places, you \nshould consider cr·eating a view for that subquery as desc1ibed in chapter 12. \nThis will help you develop queries more quickly since you can use the view \ninstead of coding the subquery again. In addition, since views typically execute \nmore quickly than subqueries, this may improve the performance of your \n• \nquenes. \nTerms \nsubquery \nintroduce a subquery \nnested subquery \ncorrelated subquery \nuncOI*related subquery \ninline view \nExercises \ncomment \npseudocode \ncommon table expression (CTE) \n• \nrecursive query \nrecursive CTE \n1. \nWrite a SELECT statement that returns the same result set as this SELECT \nstatement, but don't use a join. Instead, use a subquery in a WHERE clause \nthat uses the IN keyword. \nSELECT DISTINCT vendor name \nFROM vendors JOIN invoices \nON vendors.vendor id= invoices.vendor id \nORDER BY vendor_name \n2. \nWrite a SELECT statement that answers this question: Which invoices have \na payment total that's greater than the average payment total for all invoices \nwith a payment total greater tl1an O? \nReturn the invoice number and invoice total colu1nns for each invoice. This \n-\nshould return 20 rows. \nSort the results by the invoice_total column in descending order. \n3. \nWrite a SELECT statement that returns two columns from the \nGeneral_Ledger_Accounts table: account_number and account_description. \nReturn one row for each account number that has never been assigned to any \nline item in the Invoice_Line_Items table. To do that, use a subquery intro-\nduced with the NOT EXISTS operator. This should return 54 rows. \nSort the results by the account_number column.\n\nChapter 7 \nHow to l·ode subqueries \n4. \nWrite a SELECT statement that returns four columns: vendor_name, invoice_id, \ninvoice_sequence, and line_item_amount. \nReturn a row for each line item of each invoice that has more than one line \nitem in the Invoice_Line_Items table. Hint: Use a s·ubquery that tests for \ninvoice_sequence > 1. This should return 6 rows. \nSort the results by the vendor_name, invoice_id, and invoice_sequence \ncolumns. \n5. \nWrite a SELECT statement that returns two columns: vendor id and the \nlargest unpaid invoice for each vendor. To do this, you can group the result set \nby the vendor_id column. This should return 7 rows. \nWrite a second SELECT statement that uses the first SELECT statement in its \nFROM clause. The main query should return a single value that represents the \nsum of the largest unpaid invoices for each vendor. \n6. \nWrite a SELECT statement that returns the name, city, and state of each \nvendor that's located in a unique city and state. In other words, don't include \nve.ndors that have a city and state in common with another vendor. This \nshould return 38 rows. \nSort the results by the vendor_state and vendor_city columns. \n7. \nUse a correlated subquery to return one row per vendor, representing the \nvendor's oldest invoice (the one with the earliest date). Each row should \ninclude these four columns: vendor_name, invoice_number, invoice_date, and \ninvoice total. This should return 34 rows. \nSort the results by the vendor_name column. \n8. \nRewrite exercise 7 so it gets the same result but uses an inline view instead of \na correlated subquery. \n9. \nRewrite exercise 5 so it uses a common table expression (CTE) instead of an \ninline view.\n\nHow to work \nwith data types \nSo far, you have been using SQL statements to work with the three most \ncommon types of data: strings, numbers, and dates. Now, this chapter takes a \nmore in-depth look at the data types that are available with MySQL and shows \nsome basic skills for working with them. When you complete this chapter, \nyou'll have a thorough understanding of the data types, and you'll know how to \nuse some functions to convert one data type to another. \nThe data types .................................................................... 232 \nOve1·view ...................................................................................................... 232 \nThe character types ...................................................................................... 234 \nThe integer types ......................................................................................... 236 \nThe fixed-point and floating-point types ..................................................... 238 \nThe d.ate and time types .............................................................................. 240 \nThe ENUM and SET types ........................................................................ 244 \nThe large object types ................................................................................. 246 \nHow to convert data ........................................................... 248 \nHow implicit data conversion works .......................................................... 248 \nHow to convert data using the CAST and CONVERT functions ............... 250 \nHow to convert data using the FORMAT and CHAR functions ................ 252 \nPerspective ......................................................................... 254\n\nSection 2 \nMore SQL skills cts you need them \nThe data types \nA column's data type specifies the kind of information the column is \nintended to store. In addition, a column's data type determines the operations \nthat can be performed on the column. \nOverview \nThe MySQL data types can be divided into the five categories shown in \none or more characters, which can include letters, numbers, sy1nbols, or special \ncharacters. The terms character, string, and text are used interchangeably to \ndescribe this type of data. \nThe numeric data types are intended for storing numbers that can be used \nfor mathematical calculations. As you'll see in this chapter, MySQL can store \nnumbers in a variety of formats. At a basic level, you can divide numbers into \ntwo categories: integers and real numbers. Integers are numbers that don't have a \ndecimal point, and real numbers are numbers that have a decimal point. \nThe date and time data types are intended for storing dates, times, or \nboth dates and times. These data types are typically referred to as date/time or \ntemporal data types. \nSince the first three categories are the most widely used, this book focuses \non these data types. However, MySQL also provides large object (LOB) data \ntypes that are useful for storing images, sound, video, and large amounts of \ncharacter data. In addition, MySQL provides spatial data types that are useful \nfor storing geographical values such as global positioning system (GPS) data. \nThese data types are referred to as geometry types because they define a point or \ngroup of points that represent any location or area in the world. \nFinally, MySQL provides the ISON data type, which is used to store \nJavaScript Object Notation (ISON) documents. Although you can store JSON \ndocuments in a character column, the JSON data type provides two advantages. \nFirst, when you store a JSON document in a JSON column, the document is \nautomatically validated. Then, if it's invalid, an error occurs. Second, the internal \nstorage format provides for quick access to the document.\n\nClzapter 8 \nHow to work with data types \nData types \nCategory \nDescription \nCharacter \nNumeric \nDate and time \nLarge Object (LOB) \nSpatial \nJSON \nDescription \nStrings of character data \nNumbers that don't include a decimal point (integers) and \nnumbers that include a decimal point (real numbers) \nDates, times, or both \nLarge strings of character or binary data \nGeographical values \nJSON documents \n• \nMySQL provides data types for storing many types of data. \n• \nNumbers that don't include a decimal point are known as integers. \n• \nNumbers that include a decimal point are known as real numbers. \n• \nThe date and time data. types are often referred to as the date/time or temporal data \ntype.';. \n• \nThe large object (LOB) data types are ·useful for storing images, sound, video, and \nlarge amounts of text. \n• \nThe spatial data types are useful for storing geometric or geographical values \nsuch as global positioning system (GPS) data. These data types are referred to as \ngeometry types. \n• \nThe ISON data type is used for storing JavaScript Object Notation (ISON) \ndocuments. \nData type overview",
          "pages": [
            245,
            246,
            247,
            248,
            249,
            250,
            251,
            252,
            253
          ],
          "relevance": {
            "score": 0.51,
            "sql_score": 1.0,
            "concept_score": 0.62,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "commonMistakes": {
          "text": "Section 2 \nMore SQL skills cts you need them \nThe character types \nMySQL: CHAR and VARCHAR. These data types store strings of characters. \nYou use the CHAR type to store fixed-length st1·ings. Data stored using this \ndata type always occupies the same number of bytes regardless of the actual \nle·ngth of the string. This data type is typically used to define columns that have \na fixed number of characters. For example, the vendor_state column in the \nVendors table is defined as CHAR(2) because it always contai11s two characters. \nHowever, if two chru·acters are stored in a CHAR(lO) column, MySQL appends \neight spaces to the string so it contains 10 char·acters. \nYou use the VARCHAR data type to store variable-length strings. Data \nstored using this data type occupies only the number of bytes needed to store \nthe string plus an extra byte to store the length of the string. This data type \nis typically used to define colt1mns whose lengths vary from one row to the \nnext. For example, the vendor_name column in the Vendors table is defined as \nVARCHAR(50) because the length of each vendor's name varies. \nWith MySQL 8.0 and later, the CHAR and VARCHAR types use the \nuif81nb4 character set by default. This character set uses up to four bytes to \nstore each character. As a 1·esult, it's referred to as a multiple-byte c·haracter set. \nThis allows the utf8mb4 character set to support the characters specified by the \nUnicode standard, which includes most characters from most of the world's \nlanguages. To do that, this character set uses 1 byte for characters that are used \nin English and by most western European languages. It uses 2 bytes for most \nEuropean and Middle Eastern script letters. And it uses 3 bytes for Korean, \nChinese, and Japanese ideographs. To store emojis and other icons, it uses 4 \nbytes. \nWhen you use the utf8mb4 character set with a CHAR type, MySQL must \nreserve four bytes for each character. As a result, MySQL must t1se 8 bytes for \nthe CHAR(2) type, and it must use 40 bytes for the CHAR(l 0) type. \nHowever, when you use the VARCHAR type, MySQL doesn't need to \nreserve space for each character. As a result, if you are using English letters and \nsymbols, MySQL only uses one byte per character, plus one byte to store the \nlength of the string. For example, when you store a string of 'CA', MySQL only \nuses 3 bytes. This shows that you can typically save storage space by using the \nVARCHAR type. \nWith MySQL 5.6 and 5.7, the CHAR and VARCHAR types used the \nuif8,nb3 character set. This character set is similar to the utf8mb4 character set, \nbut it can only use up to 3 bytes to store each chru·acter. Because of that, it's not \nable to store the emojis that are becoming so prevalent. Note that this character \nset is deprecated in MySQL 8.0 and will be removed in a future release. \nWith MySQL 5.5 and earlier, the CHAR and VARCHAR types used \nthe latinl character set by default. This character set uses one byte to store \neach character. As a result, it's referred to as a single-byte character set. This \ncharacter set supports all of the characters that are used in English and by most \nwestern European languages. However, it doesn't support other characters such \nas Middle Eastern script letters and Korean, Chinese, and Japanese ideographs.\n\nClzapter 8 \nHow to work with data types \nThe character types \nType \nBytes \nDescription \nCHAR(M) \nMx4 \nFixed-length strings of character data where M is the number of \ncharacters, between O and 255. With the utf8mb4 character set, \nMySQL must reserve four bytes for each character in a CHAR \ncolumn because that's the maximum possible length. \nVARCHAR (M) \nL+l \nVariable-lengtl1 strings of character data where M is the 1naxi-\nmum number of characters, between O and 255. For English and \nLatin characters, the number of bytes used to store the string is \nequaJ to length of the string (L) plus 1 byte to record its length. \nHow the character types work with utf8mb4 \nData type \nOriginal value \nValue stored \nBytes used \nCHAR (2) \n'CA' \n'CA ' \nCHAR ( lO ) \n'CA' \n'CA \nI \n4 0 \nVAR CHAR ( 1 0 ) \n'CA ' \n' CA ' \nVARCHAR ( 2 0) \n' California' \n'Californi a' \nVARCHAR ( 2 0 ) \n'New Yor k' \n'New York' \nVARCHAR ( 2 0 ) \n\"Murach's MySQL\" \n\"Murach's MySQL\" \nHow the utf8mb4 character set works \n• \nBasic Latin letters, digits, and punctuation signs use one byte. \n• \nMost European and Middle East script letters use 2 bytes. \n• \nKorean, Chinese, and Japanese ideographs use 3 bytes. \n• \nE1nojis and other icons use 4 bytes. \nDescription \n• \nThe CHAR type js t1sed for fixed-length strings. A column with trus type t1ses the \nsame amount of storage for each value regardless of the actual length of the st1ing. \n• \nThe VARCHAR type is used for variable-length strings. A column with this type uses \na varying amount of storage for each value depending on the length of the string. \n• \nBy default, MySQL 8.0 and later use the utj8mb4 character set for the CHAR and \nVAR CHAR types. This character set is a multiple-byte character set. It typically \nuses 1 byte per character, but can use up to 4 bytes per character. However, the \nutf8mb4 format provides for all characters in most languages by providing support \nfor all of the characters in the Unicode stan.dard. \n• \nBy default, MySQL 5.6 and 5.7 use the utj8mb3 character set for the CHAR and \nVAR CHAR types, which can use up to 3 bytes per character. \n• \nBy default, MySQL 5.5 and earlier use the latinl character set for the CHAR and \nVARCHAR types. This character set is a single-byte character set that supports all \nof the characters that are used in English and by most western European languages. \n• \nTo learn how to change the character set, please see chapter 11. \nThe character types\n\nSection 2 \nMore SQL skills cts you need them \nIn most cases, it makes sense to use the utf8mb4 character set. That way, \nyour database supports most characters in most languages as well as emojis. \nHoweve1·, if you want to use the CHAR type and you only need to support \nEnglish and western European languages, you may want to use the latinl \ncharacter set to keep storage requirements to a minimum. In chapter 11, you'll \nlearn how to change the character set for a database. \nAlthough you typically store numeric values using numeric types, the \ncharacter types may be a better choice for some numeric values. For example, \nyou typically store zip codes, telephone numbers, and social security numbers \nin character columns even if they contain only numbers. That's because their \nvalues aren't used in numeric operations. In addition, if you store these numbers \nin numeric colun111s, MySQL may strip leading zeros in some situations, which \nisn't what you want. \nIn figure 8-2, the first five examples use single quotes to specify a string \nliteral. However, the sixth example t1ses double quotes to specify a string literal. \nThis allows the string literal to include a single quote, and it shows that you \ncan use single or double quotes for string literals. Although it's common to use \nsingle quotes, double quotes are useful if you need to include a single quote in \nthe string. \nThe integer types \ndecim.al point. The integer data types differ in the amount of storage they use and \nthe range of values they can store. Since the INT type can store a wide range of \nnumbers and only requires 4 bytes of storage, it's the most commonly used of \nthe integer types. \nBy default, the integer types can store positive and negative numbers. \nHowever, you can include the UNSIGNED attrib·ute for an integer type to \nprevent negative values from being stored in the column. In that case, the range \nof acceptable positive values for the column is doubled. \nIf the ZEROFILL attribute for the integer is set, the UNSIGNED attribute is \nautomatically set, and the integer is displayed with zeros padded from the left, \nup to the maximt1m display size. For the INT type, for instance, the maximum \ndisplay size is 10 digits. If the default display size is too wide, you can specify a \nsmaller display size by coding it in parentheses after the data type. In this figure, \nfor instance, the last example specifies a display size of 4 digits. This only \naffects how MySQL displays the value, not how it stores the value. \nThe INTEGER type is a synonym for the INT type. As a result, you can use \nthese types interchangeably. However, it's a common programming practice to \nuse INT as an abbreviation for INTEGER. \nThe BOOL and BOOLEAN types are synonyms for TINYINT(l). When you \nwork with these types, you can use a value of O to store false values and a value \nof 1 to store true values. To make that more intuitive, you can use the FALSE \nkeyword, which is an alias for 0, and the TRUE keyword, which is an alias for 1.\n\nClzapter 8 \nHow to work with data types \nThe integer types \nType \nBytes \nValue ranges \nBIGINT \nSigned: -9,223,372,036,854,775,808 to 9,223,372,036,854,775,807 \nUnsigned: 0 to L8,446,744,073,709,551,615 \nINT \nSigned: -2,147,483,648 to 2,147,483,647 \nUnsigned: 0 to 4,294,967,295 \nMEDIUMINT \nSigned: -8,388,608 5to 8,388,607 \nUnsigned: 0 and 16,777,215 \nSMALLINT \nSigned: -32,768 and 32,767 \nUnsigned: 0 and 65,535 \nTINYINT \nl \nSigned: -128 and 127 \nUnsigned: 0 and 255 \nHow the UNSIGNED and ZEROFILL attributes work \nData type \nOriginal value \nValue stored \nValue displayed \nINT \nINT \nINT UNSIGNED \nINT UNSIGNED \nINT ZEROFILL \nINT(4) ZEROFILL \nDescription \n-99 \n-99 \n-99 \nNone \n-99 \nNone \n• \nThe integer types store numbers without any digits to the right of the decimal point. \n• If the UNSIGNED attribute for the integer is set, it changes the range of acceptable \nvalues. If you try to store a negative integer in a column with the UNSIGNED attri-\nbute, an error occurs. \n• If the ZEROFILL attribute for the integer is set, MySQL displays the integer with \nzeros padded from the left, up to the maximum display size. \n• If the ZEROFILL attribute is set, MySQL automatically sets the UNSIGNED \nattribute. \n• \nTo specify a display size, you can code it in _parentheses after the data type. This \nonly affects how MySQL displays the value, not how it stores the value. \n• \nThe INTEGER type is a synonym for the INT type. \n• \nThe BOOL and BOOLEAN types are synonyms for TINYINT(l). You can use \nthese types to store TRUE and FALSE values, where 1 represents a true value and 0 \nrepresents a false value. \nThe integer types",
          "pages": [
            254,
            255,
            256,
            257
          ],
          "relevance": {
            "score": 0.32,
            "sql_score": 1.0,
            "concept_score": 0.25,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        }
      },
      "educational_notes": {
        "definition": "Aggregate functions are used to perform calculations on a set of values and return a single value. They are essential for summarizing data and performing complex queries.",
        "explanation": "Aggregate functions solve problems like calculating total sales, average prices, or maximum/minimum values in a dataset. Here’s how they work:\n1. **SUM**: Adds up all the values in a column.\n2. **AVG**: Calculates the average of a set of values.\n3. **MAX** and **MIN**: Find the highest and lowest values, respectively.\n4. **COUNT**: Counts the number of rows that match a specified condition.\nThese functions are used in conjunction with GROUP BY to summarize data at different levels (e.g., by state, by product category).\nWhen to use them? Whenever you need to get a single value from a set of values, such as total revenue for each quarter or average temperature per city.",
        "key_points": [
          "Key point 1: Aggregate functions operate on groups of rows and return a single value.",
          "Key point 2: They are used with GROUP BY to summarize data at different levels.",
          "Key point 3: Common mistakes include forgetting to use GROUP BY or using the wrong function for the task.",
          "Key point 4: Practice regularly with real-world datasets to understand their practical applications.",
          "Key point 5: Aggregate functions are fundamental in SQL and form the basis for more complex queries."
        ],
        "examples": [
          {
            "title": "Basic Usage",
            "code": "-- Calculate total sales per state\nSELECT vendor_state, SUM(invoice_total) AS total_sales FROM vendors v JOIN invoices i ON v.vendor_id = i.vendor_id GROUP BY vendor_state;",
            "explanation": "This example calculates the total sales for each state by summing up the invoice totals and grouping the results by vendor state."
          },
          {
            "title": "Practical Example",
            "code": "-- Find the average price of products in each category\nSELECT product_category, AVG(price) AS avg_price FROM products GROUP BY product_category;",
            "explanation": "This practical example calculates the average price of products within each category by grouping the data and using the AVG function."
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Forgetting to use GROUP BY",
            "incorrect_code": "-- Incorrect query\nSELECT vendor_state, SUM(invoice_total) AS total_sales FROM vendors v JOIN invoices i ON v.vendor_id = i.vendor_id;",
            "correct_code": "-- Correct query with GROUP BY\nSELECT vendor_state, SUM(invoice_total) AS total_sales FROM vendors v JOIN invoices i ON v.vendor_id = i.vendor_id GROUP BY vendor_state;",
            "explanation": "This mistake happens when students try to use an aggregate function without grouping the data. Always ensure you include GROUP BY when using aggregate functions."
          }
        ],
        "practice": {
          "question": "Calculate the total number of orders per month for each year from a sales table.",
          "solution": "SELECT YEAR(order_date) AS order_year, MONTH(order_date) AS order_month, COUNT(*) AS total_orders FROM sales GROUP BY order_year, order_month ORDER BY order_year, order_month;"
        }
      },
      "llm_enhanced": true,
      "raw_text_preview": "Chapter 7 \nHow to l·ode subqueries \nA complex query that uses three subqueries \nSELECT tl.vendor_ state, vendor_name, tl.sum of invoices \nFROM \n( \n) tl \n-- invoice totals by vendor \nSELECT vendor_ sta",
      "content_relevance": {
        "score": 0.51,
        "sql_score": 1.0,
        "concept_score": 0.62,
        "non_sql_penalty": 0.1,
        "is_relevant": true,
        "analysis": "SQL content"
      }
    },
    "group-by-murach": {
      "id": "group-by-murach",
      "title": "GROUP BY Clause",
      "definition": "Grouping data for aggregate calculations",
      "difficulty": "intermediate",
      "page_references": [
        253,
        254,
        255,
        256,
        257,
        258,
        259,
        260,
        261,
        262,
        263,
        264,
        265,
        266,
        267,
        268
      ],
      "sections": {
        "definition": {
          "text": "Clzapter 8 \nHow to work with data types \nData types \nCategory \nDescription \nCharacter \nNumeric \nDate and time \nLarge Object (LOB) \nSpatial \nJSON \nDescription \nStrings of character data \nNumbers that don't include a decimal point (integers) and \nnumbers that include a decimal point (real numbers) \nDates, times, or both \nLarge strings of character or binary data \nGeographical values \nJSON documents \n• \nMySQL provides data types for storing many types of data. \n• \nNumbers that don't include a decimal point are known as integers. \n• \nNumbers that include a decimal point are known as real numbers. \n• \nThe date and time data. types are often referred to as the date/time or temporal data \ntype.';. \n• \nThe large object (LOB) data types are ·useful for storing images, sound, video, and \nlarge amounts of text. \n• \nThe spatial data types are useful for storing geometric or geographical values \nsuch as global positioning system (GPS) data. These data types are referred to as \ngeometry types. \n• \nThe ISON data type is used for storing JavaScript Object Notation (ISON) \ndocuments. \nData type overview\n\nSection 2 \nMore SQL skills cts you need them \nThe character types \nMySQL: CHAR and VARCHAR. These data types store strings of characters. \nYou use the CHAR type to store fixed-length st1·ings. Data stored using this \ndata type always occupies the same number of bytes regardless of the actual \nle·ngth of the string. This data type is typically used to define columns that have \na fixed number of characters. For example, the vendor_state column in the \nVendors table is defined as CHAR(2) because it always contai11s two characters. \nHowever, if two chru·acters are stored in a CHAR(lO) column, MySQL appends \neight spaces to the string so it contains 10 char·acters. \nYou use the VARCHAR data type to store variable-length strings. Data \nstored using this data type occupies only the number of bytes needed to store \nthe string plus an extra byte to store the length of the string. This data type \nis typically used to define colt1mns whose lengths vary from one row to the \nnext. For example, the vendor_name column in the Vendors table is defined as \nVARCHAR(50) because the length of each vendor's name varies. \nWith MySQL 8.0 and later, the CHAR and VARCHAR types use the \nuif81nb4 character set by default. This character set uses up to four bytes to \nstore each character. As a 1·esult, it's referred to as a multiple-byte c·haracter set. \nThis allows the utf8mb4 character set to support the characters specified by the \nUnicode standard, which includes most characters from most of the world's \nlanguages. To do that, this character set uses 1 byte for characters that are used \nin English and by most western European languages. It uses 2 bytes for most \nEuropean and Middle Eastern script letters. And it uses 3 bytes for Korean, \nChinese, and Japanese ideographs. To store emojis and other icons, it uses 4 \nbytes. \nWhen you use the utf8mb4 character set with a CHAR type, MySQL must \nreserve four bytes for each character. As a result, MySQL must t1se 8 bytes for \nthe CHAR(2) type, and it must use 40 bytes for the CHAR(l 0) type. \nHowever, when you use the VARCHAR type, MySQL doesn't need to \nreserve space for each character. As a result, if you are using English letters and \nsymbols, MySQL only uses one byte per character, plus one byte to store the \nlength of the string. For example, when you store a string of 'CA', MySQL only \nuses 3 bytes. This shows that you can typically save storage space by using the \nVARCHAR type. \nWith MySQL 5.6 and 5.7, the CHAR and VARCHAR types used the \nuif8,nb3 character set. This character set is similar to the utf8mb4 character set, \nbut it can only use up to 3 bytes to store each chru·acter. Because of that, it's not \nable to store the emojis that are becoming so prevalent. Note that this character \nset is deprecated in MySQL 8.0 and will be removed in a future release. \nWith MySQL 5.5 and earlier, the CHAR and VARCHAR types used \nthe latinl character set by default. This character set uses one byte to store \neach character. As a result, it's referred to as a single-byte character set. This \ncharacter set supports all of the characters that are used in English and by most \nwestern European languages. However, it doesn't support other characters such \nas Middle Eastern script letters and Korean, Chinese, and Japanese ideographs.\n\nClzapter 8 \nHow to work with data types \nThe character types \nType \nBytes \nDescription \nCHAR(M) \nMx4 \nFixed-length strings of character data where M is the number of \ncharacters, between O and 255. With the utf8mb4 character set, \nMySQL must reserve four bytes for each character in a CHAR \ncolumn because that's the maximum possible length. \nVARCHAR (M) \nL+l \nVariable-lengtl1 strings of character data where M is the 1naxi-\nmum number of characters, between O and 255. For English and \nLatin characters, the number of bytes used to store the string is \nequaJ to length of the string (L) plus 1 byte to record its length. \nHow the character types work with utf8mb4 \nData type \nOriginal value \nValue stored \nBytes used \nCHAR (2) \n'CA' \n'CA ' \nCHAR ( lO ) \n'CA' \n'CA \nI \n4 0 \nVAR CHAR ( 1 0 ) \n'CA ' \n' CA ' \nVARCHAR ( 2 0) \n' California' \n'Californi a' \nVARCHAR ( 2 0 ) \n'New Yor k' \n'New York' \nVARCHAR ( 2 0 ) \n\"Murach's MySQL\" \n\"Murach's MySQL\" \nHow the utf8mb4 character set works \n• \nBasic Latin letters, digits, and punctuation signs use one byte. \n• \nMost European and Middle East script letters use 2 bytes. \n• \nKorean, Chinese, and Japanese ideographs use 3 bytes. \n• \nE1nojis and other icons use 4 bytes. \nDescription \n• \nThe CHAR type js t1sed for fixed-length strings. A column with trus type t1ses the \nsame amount of storage for each value regardless of the actual length of the st1ing. \n• \nThe VARCHAR type is used for variable-length strings. A column with this type uses \na varying amount of storage for each value depending on the length of the string. \n• \nBy default, MySQL 8.0 and later use the utj8mb4 character set for the CHAR and \nVAR CHAR types. This character set is a multiple-byte character set. It typically \nuses 1 byte per character, but can use up to 4 bytes per character. However, the \nutf8mb4 format provides for all characters in most languages by providing support \nfor all of the characters in the Unicode stan.dard. \n• \nBy default, MySQL 5.6 and 5.7 use the utj8mb3 character set for the CHAR and \nVAR CHAR types, which can use up to 3 bytes per character. \n• \nBy default, MySQL 5.5 and earlier use the latinl character set for the CHAR and \nVARCHAR types. This character set is a single-byte character set that supports all \nof the characters that are used in English and by most western European languages. \n• \nTo learn how to change the character set, please see chapter 11. \nThe character types\n\nSection 2 \nMore SQL skills cts you need them \nIn most cases, it makes sense to use the utf8mb4 character set. That way, \nyour database supports most characters in most languages as well as emojis. \nHoweve1·, if you want to use the CHAR type and you only need to support \nEnglish and western European languages, you may want to use the latinl \ncharacter set to keep storage requirements to a minimum. In chapter 11, you'll \nlearn how to change the character set for a database. \nAlthough you typically store numeric values using numeric types, the \ncharacter types may be a better choice for some numeric values. For example, \nyou typically store zip codes, telephone numbers, and social security numbers \nin character columns even if they contain only numbers. That's because their \nvalues aren't used in numeric operations. In addition, if you store these numbers \nin numeric colun111s, MySQL may strip leading zeros in some situations, which \nisn't what you want. \nIn figure 8-2, the first five examples use single quotes to specify a string \nliteral. However, the sixth example t1ses double quotes to specify a string literal. \nThis allows the string literal to include a single quote, and it shows that you \ncan use single or double quotes for string literals. Although it's common to use \nsingle quotes, double quotes are useful if you need to include a single quote in \nthe string. \nThe integer types \ndecim.al point. The integer data types differ in the amount of storage they use and \nthe range of values they can store. Since the INT type can store a wide range of \nnumbers and only requires 4 bytes of storage, it's the most commonly used of \nthe integer types. \nBy default, the integer types can store positive and negative numbers. \nHowever, you can include the UNSIGNED attrib·ute for an integer type to \nprevent negative values from being stored in the column. In that case, the range \nof acceptable positive values for the column is doubled. \nIf the ZEROFILL attribute for the integer is set, the UNSIGNED attribute is \nautomatically set, and the integer is displayed with zeros padded from the left, \nup to the maximt1m display size. For the INT type, for instance, the maximum \ndisplay size is 10 digits. If the default display size is too wide, you can specify a \nsmaller display size by coding it in parentheses after the data type. In this figure, \nfor instance, the last example specifies a display size of 4 digits. This only \naffects how MySQL displays the value, not how it stores the value. \nThe INTEGER type is a synonym for the INT type. As a result, you can use \nthese types interchangeably. However, it's a common programming practice to \nuse INT as an abbreviation for INTEGER. \nThe BOOL and BOOLEAN types are synonyms for TINYINT(l). When you \nwork with these types, you can use a value of O to store false values and a value \nof 1 to store true values. To make that more intuitive, you can use the FALSE \nkeyword, which is an alias for 0, and the TRUE keyword, which is an alias for 1.",
          "pages": [
            253,
            254,
            255,
            256
          ],
          "relevance": {
            "score": 0.7,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "examples": {
          "text": "Clzapter 8 \nHow to work with data types \nThe integer types \nType \nBytes \nValue ranges \nBIGINT \nSigned: -9,223,372,036,854,775,808 to 9,223,372,036,854,775,807 \nUnsigned: 0 to L8,446,744,073,709,551,615 \nINT \nSigned: -2,147,483,648 to 2,147,483,647 \nUnsigned: 0 to 4,294,967,295 \nMEDIUMINT \nSigned: -8,388,608 5to 8,388,607 \nUnsigned: 0 and 16,777,215 \nSMALLINT \nSigned: -32,768 and 32,767 \nUnsigned: 0 and 65,535 \nTINYINT \nl \nSigned: -128 and 127 \nUnsigned: 0 and 255 \nHow the UNSIGNED and ZEROFILL attributes work \nData type \nOriginal value \nValue stored \nValue displayed \nINT \nINT \nINT UNSIGNED \nINT UNSIGNED \nINT ZEROFILL \nINT(4) ZEROFILL \nDescription \n-99 \n-99 \n-99 \nNone \n-99 \nNone \n• \nThe integer types store numbers without any digits to the right of the decimal point. \n• If the UNSIGNED attribute for the integer is set, it changes the range of acceptable \nvalues. If you try to store a negative integer in a column with the UNSIGNED attri-\nbute, an error occurs. \n• If the ZEROFILL attribute for the integer is set, MySQL displays the integer with \nzeros padded from the left, up to the maximum display size. \n• If the ZEROFILL attribute is set, MySQL automatically sets the UNSIGNED \nattribute. \n• \nTo specify a display size, you can code it in _parentheses after the data type. This \nonly affects how MySQL displays the value, not how it stores the value. \n• \nThe INTEGER type is a synonym for the INT type. \n• \nThe BOOL and BOOLEAN types are synonyms for TINYINT(l). You can use \nthese types to store TRUE and FALSE values, where 1 represents a true value and 0 \nrepresents a false value. \nThe integer types\n\nSection 2 \nMore SQL skills cts you need them \nThe fixed-point and floating-point types \nnumbers that have digits to the right of the decimal point. To start, you can use \nthe DECIMAL type to store.fixed-point numbers, which are numbers that have a \nfixed number of digits to the right of the decimal point. \nThe number of digits a value has to the tight of the decimal point is called \nits scale, and the total number of digits is called its precision. You can customize \nthe precision and scale of the DECIMAL type so they're right for the data to be \nstored. For instance, if you need to store monetary values, it's common to use \ntwo digits to the right of the decimal place as shown in the first three examples. \nWhen you use the DECIMAL type, MySQL uses a varying number of bytes \nto store the value. In general, it packs 9 digits into 4 bytes. However, it stores \nthe digits to the left and right of the decimal point separately, and it can use \nfewer than 4 bytes if there are fewer than 9 digits. As a result, DECIMAL(9, \n2) requires 5 bytes, while DECIMAL(18, 9) requires 8 bytes. For more details \nabout how this works, you can check the MySQL Reference Manual. \nIn contrast to the DECIMAL type, the DOUBLE and FLOAT types store \nfloating-point numbers. These data types provide for very large and very small \nnumbers, but with a limited number of significant digits. The FLOAT type can \nbe used to store a single-precision number, which provides for numbers with up \nto 7 significant digits. And the DOUBLE type can be used to store a \ndouble-precision number, which provides for numbers with up to 15 significant \ndigits. \nTo express the value of a floating-point number, you can use scientific \n,iotation. To use this notation, you type the letter E followed by a power of 10. \nFor instance, 3.65E+9 is equal to 3.65 x 109, or 3,650,000,000. Conversely, \n3.65E-9 is equal to 3.65 x 10·9, or 0.00000000365. If you have a mathematical \nbackground, of course, you 're already familiar with this notation. \nBecause the precision of the integer types and the DECIMAL type is exact, \nthese data types are considered exact numeric types. In contrast, the DOUBLE \nand FLOAT types are considered approximate numeric types because they may \nnot represent a value exactly. That can happen, for example, when a number \nis rounded to the appropriate number of significant digits. In this figure, for \ninstance, the last example shows that the FLOAT type rounds the original value \nand only stores 7 significant digits. For business applications, you typically \nuse the exact numeric types, as there's seldom the need to work with the very \nlarge and very small numbers that the floating-point data types are designed \nfor. However, for scientific applications, you n1ay sometimes 11eed to use the \nDOUBLE and FLOAT types. \nThe DECIMAL, DOUBLE, and FLOAT types have numerous synonyms. \nSometimes these synonyms are helpful because they make it easier to work with \ndata from other databases. However, when working with a MySQL database, \nmost programmers use the DECIMAL, DOUBLE, and FLOAT types. \nWhen you work with real numbers, you can use the UNSIGNED and \nZEROFILL attributes. These attributes work similarly to the way they do with \ninteger types.\n\nClzapter 8 \nHow to work with data types \nThe fixed-point type \nType \nBytes \nDescription \nDECIMAL(M, D) \nVary \nFixed-precision numbers where M specifies the maximum number \nof total digits (the precision) and D specifies the nu1nber of digits \nto the rigbl of the decimal (the scale). M can range from l to 65. D \ncan range from Oto 30 but can't be larger than M. The default is 0. \nThe floating-point types \nType \nBytes \nDescription \nDOUBLE \nFLOAT \nDouble-precisio11 floating-point numbers from - l.7976xl0308 to l .7976xl03°8. \nSingle-precision floating-point numbers from -3.4028xl038 to 3.4028xl038. \nHow the fixed-point ( exact) and floating-point (approximate) types work \nData type \nOriginal value \nValue stored \nBytes used \nDECIMAL(9,2 ) \n1.2 \n1 . 20 \nDECIMAL(9,2) \n1234567.89 \n1234567.89 \nDECIMAL(9,2) \n-1234567.89 \n-1234567.89 \ns \nDECIMAL(18,9) \n1234567.89 \n1234567.890000000 \nDOUBLE \n1234567.89 \n1234567 . 89 \nFLOAT \n1234567.89 \nDescription \n• \nReal numbers can include digits to the right of the decimal point. The precision of \na real n11mber indicates the total number of digits that can be stored, and the scale \nindicates the number of digits that can be stored to the right of the decimal point. \n• \nThe DECIMAL type is considered an exact numeric type because its precision is \nexact. \n• \nThe DOUBLE and FLOAT types store floating-point numbers, which have a \nlimited number of significant digits. These data types are considered approximate \nnumeric data types because they may not represent a val11e exactly. \n• If the UNSIGNED attribute for a real number is set, it prevents storing negative \nvalues in the column but does not affect the range of acceptable values. \n• If the ZEROFILL attribute for a real number is set, the number is displayed with \nzeros padded from the left, and the UNSIGNED attribute is automatically set. \n• \nThe DEC, NUMERIC, and FIXED types are synonyms for the DECIMAL type. \n• \nThe REAL and DOUBLE PRECISION types are synonyms for the DOUBLE type. \nThe fixed-point and floating-point types\n\nSection 2 \nMore SQL skills cts you need them \nThe date and time types \nPart 1 of figure 8-5 presents the five date and time types supported by \nMySQL. You can use the DATE type to store a date without a time. You can \nuse the TIME type to store a time without a date. And you can use either the \nDATETIME or TIMESTAMP types to store both a date and a time. \nYou typically use the TIMESTAMP type to keep track of when a row was \ninserted or last updated. For example, you might use this type to keep track \nof the entries on a blog. MySQL makes that easy by automatically setting the \nTIMESTAMP column to the current date and time whenever a row is inserted or \nupdated. If that's not what you want, you can use the DATETIME type instead. \nThe problem with the TIMESTAMP type is that it can only store dates up \nto the year 2038. This is known as the yea,-2038 problem, the Y2K38 probleni, \nand the Unix Millennium bug. As a result, if you want your database to be able \nto store dates that go beyond 2038, you should use the DATETIME type instead \nof the TIMESTAMP type. Otherwise, you can use the TIMESTAMP type since \nit only reqtrires 4 bytes to store a TIMESTAMP value, compared to 8 bytes for a \nDATETIME value. \nIf you need to store a year without any other temporal data, you can use the \nYEAR type. With MySQL 5.7.5 and later, the YEAR type stores 4-digit years \nfrom 1901 to 2155. Entries with one and two digits are still acceptable, though, \nand are converted to 4-digit years as indicated in this figure. Note that, by \ndefault, a numeric literal of O or 00 is converted to 0000. To store the value 2000 \nin a YEAR column, you must code it as a string. \nPrior to MySQL 5.7.5, the YEAR column could also store a 2-digit year. \nTo define a column like this, you coded the YEAR(2) type. Then, 2-digit entries \nwere stored as entered and 1-digit entries were converted to two digits.\n\nClzapter 8 \nHow to work with data types \nThe date and time types \nType \nBytes \nDescription \nDATE \nTIME \nDATETIME \nTI MESTAMP \nYEAR[ ( 4 )] \nDescription \nDates from January 1, 1000 through December 31, 9999. The \ndefault format for display and e.ntry is \"yyyy-m1n-dd\". \nTimes in the range -838:59:59 through 838:59:59. The default \nformat for display and entry is \"hh:1nm:ss\". \nCombination date and time from midnight January l , 1970 to \nDecember 31, 9999. The default format for display and entry \nis \"yyyy-mm-dd hh:mm:ss\". \nCombination date and time from midnight January 1, 1970 to \nthe year 2037. The default format is \"yyyy-mm-dd hh:mm:ss\". \nYears in 4-digit format. Allowable values are from 1901 to \n2155. \n• \nA column of TIMESTAMP type is auton1atically updated to the current date and \ntime when a row is inserted or updated. If a table bas multiple TIMESTAMP \ncolumns, only the first one is updated automatically. \n• \nThe TIMESTAMP type can only store dates up to the year 2038. This is known \nas the year 2038 problem, the Y2K38 problem, and the Unix Millenn.ium bug. To \nfix this problem, use the DATETIME type instead of the TIMESTAMP type and \nupdate the value manually as needed. \n• \nMySQL 5.7 .5 and later support only 4-digit years, which can be defmed as YEAR \nand YEAR( 4). I-digit and 2-digit years can still be entered but are converted to \n4-digit years. Values from Oto 69 are converted to 2000 to 2069, and values from \n70 to 99 are converted to 1970 to 1999. \n• \nFor a value of O or 00 to be stored as 2000 in a YEAR column, you 1nust enter it as \na string. Otherwise, it's stored as 0000. \nThe date and time types (part 1 of 2)\n\nSection 2 \nMore SQL skills cts you need them \nWhen you work with the date and time types, you need to know how to code \ndate and time literals. Part 2 of figure 8-5 shows how to do that. The default date \nfo1mat for MySQL is ''yyyy-mm-dd'', which is why we've used this forn1at in \nmost of the examples in this book. By default, MySQL doesn't support other \ncommon date formats such as ''m.m/dd/yy''. If you attempt to use an unsupported \nformat, MySQL returns an error. \nYou also need to be aware of the two-digit year cutoff that's defined on your \nsystem. When you code a two-digit year, the two-digit year cutoff determines \nbow MySQL interprets the year. By default, MySQL interprets the years 00 \nthrough 69 as 2000 through 2069, and it interprets the years 70 through 99 as \n1970 through 1999. Usually, that's what you want. However, the two-digit year \ncutoff can be modified if necessary. In general, it's considered a good coding \npractice to use four-digit years. That way, you can be sure that MySQL is \ninterpreting the year correctly. \nMySQL interprets any punctuation character in a literal as a delimiter \nbetween date parts or time parts. If you don't use any delimiters, you can code \nthe value as a numeric literal. In that case, you don't need to use single quotes. \nWhen storing a date in a DATE column, the values are loosely checked for \nvalid data. For instance, months must be in the range 0-12 and days must be \nin the range 0-31. For illegal dates, such as February 31, MySQL returns an \nerror. However, MySQL allows you to store unconventional date values, such as \n''2018-12-00'', which represents a month and year without a specific day. \nThe default time format for MySQL is ''hh:mm:ss'', using a 24-hour clock. \nMany of the same rules for coding date literals also apply to time literals. For \ninstance, you can use any punctuation character as a delimiter. Similarly, for \nvalid values, you can omit the delimiters. In that case, you can use a numeric \nliteral (no quotes) instead of a string literal (quotes). Finally, MySQL checks \ntimes for validity. For illegal times, such as ''19:61:11'', MySQL returns an error. \nThe default date/time format for MySQL is a combination of the date and \ntime formats. Most of the rules for coding date/time literals ru·e a combination \nof the rules for coding date and time literals. In addition, if you don't specify \na time when storing a TIMESTAMP or DATETIME value, the tim.e defaults to \n00:00:00, which is midnight.\n\nClzapter 8 \nHow to work with data types \nHow MySQL interprets literal date/time values \nLiteral value \nValue stored in DATE column \n'2018-08-15' \n2018-08-15 \n'2018-8-15' \n2018-08-15 \n'18-8-15' \n2018-08-15 \n'20180815' \n2018-08-15 \n2018-08-15 \n'2018 . 08.15' \n2018-08-15 \n'18/8/15' \n2018-08-15 \n1 8/15/18 1 \nNone \n'2018-02-31' \nNone \nLiteral value \nValue stored in TIME column \n'7:32' \n'19:32:11' \n'193211' \n1 19:61:11 1 \n07:32:00 \n19:32:11 \n19:32:11 \n19:32:11 \nNone \nLiteral value \nValue stored in DATETIME or TIMESTAMP column \n'2018-08-15 19:32:11' \n'2018-08-15' \nDescription \n2018-08-15 19:32:11 \n2018-08-15 00:00:00 \n• \nYou can specify date and time values by coding a literal value. In most cases, you \nenclose the literal value in single quotes. \n• \nFor dates, MySQL uses the ''yyyy-mm-dd'' format. For times, MySQL uses the \n''hh:mm:ss'' format, using a 24-hot1r clock. \n• \nBy default, MySQL does not support common date formats used by other systems \nsuch as ''mm/dd/yy'' and ''mon/dd/yyyy''. \n• \nBy default, MySQL interprets 2-digit years from 00 to 69 as 2000 to 2069 and the \nyears from 70 to 99 as 1970 to 1999. \n• \nMySQL interprets any punctuation character as a delimiter between date parts. If you \ndon't use any delimiters, you can code the value as a numeric literal without quotes. \n• \nIf you don't specify a time when storiI1g a DATETIME or TIMESTAMP value, \nMySQL stores a time value of 00:00:00 (12:00 midnight). \n• \nIf you don't specify seconds when storing a TIME value, MySQL stores 00 for the \nseconds. \n• \nWhen storing date and time values, MySQL loosely checks the values to make sure they \nare valid. For example, months must be in the range 0-12, days must be in the range \n0-31, and so on. If MySQL determines that a date or time isn't valid, it returns an error. \n• \nMySQL 5.5 and later are stricter than previous versions of MySQL for storing date \nand time values. If MySQL can't interpret a value, it returns an error or a warning. \nThe date and time types (part 2 of 2)\n\nSection 2 \nMore SQL skills cts you need them \nThe ENUM and SET types \nThe ENUM and SET types can be considered character data types since they \nallow you to restrict the values for a column to a limited set of strings as shown \nin figure 8-6. However, MySQL internally stores these values as integers, which \nreduces the nun1ber of bytes needed to store each string. \nThe main difference between the ENUM and SET types is that an ENUM \ncolumn can store exactly one value, but a SET column can store zero, one, or \nup to 64 different values. In other words, an ENUM column can consist of only \none member in a set of values, while the SET column may consist of any, or all, \nmembers in a set. \nYou can use the ENUM type to store values that are mutually exclusive, such \nas Yes, No, or Maybe. In other words, you can use the ENUM type to represent \na choice of one value, but not two. For example, delivery or pickup; cash, credit, \nor debit; small, medium, or large; paper or plastic; soup or salad, although I \nsuppose you might want both soup and salad. For that, you could use a SET \ncolumn. \nYou can use a SET column when you want to choose more than one value. \nFor example, the toppings on a pizza, the software on a computer, or the features \nof a car could be SET values. \nThe acceptable values for an ENUM or SET column are defined when the \ntable is created. An ENUM column can specify up to 65,535 acceptable values. \nHowever, a SET column is limited to 64 values. \nTo store a value in an ENUM column, you code a single text string. If the \nstring is one of the acceptable values for the column, MySQL stores that value. \nOtherwise, MySQL assigns an empty string to the col11mn. \nWhen you add a row to a table that contains an ENUM column, MySQL \nassigns a default value to that column if you don't explicitly specify a value. If \nthe column allows null values, MySQL assigns a null value to the col11mn. If \nthe column doesn't allow null values, MySQL assigns the first value in the set \nof acceptable values. If you want MySQL to use a specific value as the default \nvalue, then, you'll want to code that value as the first value in the set. \nTo store values in a SET coJumn, you code a single string with one or more \nvalues separated by commas. Then, MySQL stores each acceptable value and \nignores any other values. Since commas are used to separate values, you can't \nuse commas within a value when you define the SET column. \nWhen storing multiple values in a SET column, the order of the values \ndoesn't matter. That's because MySQL stores the values in the same order as \nin the column defmition. It also doesn't matter if you repeat a value because \nMySQL doesn't store duplicate values.",
          "pages": [
            257,
            258,
            259,
            260,
            261,
            262,
            263,
            264
          ],
          "relevance": {
            "score": 0.7,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "commonMistakes": {
          "text": "Clzapter 8 \nHow to work with data types \nThe ENUM and SET types \nType \nBytes \nDescription \nENUM \nSET \n1-2 \n1-8 \nStores one value selected from a list of acceptable values. \nStores zero or more values selected from a list of acceptable values. \nHow values are stored in ENUM columns \nStored in column \nValue \nENUM ('Yes', 'No', 'Maybe') \n'Yes' \n'No' \n'Maybe' \n'Possibly' \n'Yes' \n'No' \n'Maybe' \nI \nI \nHow values are stored in SET columns \nValue \n'Pepperoni• \n'Mushrooms' \n'Pepperoni, Bacon• \n'Olives, Pepperoni' \nDescription \nStored in column \nSET ('Pepperoni', 'Mushrooms', 'Olives') \n'Pepperoni' \n'Mushrooms' \n'Pepperoni' \n'Pepperoni, Olives' \n• \nThe ENUM and SET types can be used to restrict the values that you store to a \nli1nited set of values. Tl1e ENUM column can take on exactly one value, but a SET \ncolt1mn can take on zero, one, or up to 64 different values. \n• \nYou can defme the set of acceptable values for an ENUM or SET column when you \ncreate a table. An ENUM column can have up to 65,535 acceptable values, but a \nSET column is limited to 64 acceptable values. \n• \nTo specify a value for· an ENUM column, you code a single text string. If the string \ncontains an acceptable value, that value is stored in the column. Otherwise, the \ncolumn is assigned an empty string. \n• If you don't specify a value for an ENUM column when you insert a row, MySQL \nassigns a default value that depends on whether the column allows null values. If \nthe column allows null values, MySQL assigns a null value to the column. If it \ndoesn't allow null values, MySQL assigns the first value in the set of acceptable \nvalues to the column. \n• \nTo specify values for a SET column, you code a single string with the values \nseparated by commas. Each acceptable value is stored in the column, and any other \nvalues are ignored. \n• \nWhen you store values in a SET column, MySQL stores the values using the order \nspecified in the column definition, and it does not store duplicate values. \nThe ENUM and SET types\n\nSection 2 \nMore SQL skills cts you need them \nThe large object types \ndesigned to store large amounts of binary or character data. \nThe BLOB (binary large object) types store strings of binary data. This data \ntype is often used to store images, sounds, and video. However, the BLOB types \ncan be used to store any type of binary data, including the binary data that's \nnormally stored in application ftles such as PDF ftles or Word files. \nThe TEXT types work similarly to the BLOB types, but they store strings of \ncharacters. As a result, in other database systems, they are sometimes referred \nto as character large object (CLOE) types. These data types can be used to store \nlarge amounts of character data including data that's normally stored in text, \nXML, or JSON files. \nTo read and write data from a column defined with a BLOB or TEXT type, \nyou typically use another programming language such as Java or PHP. As a \nresult, we don't cover these types in this book. However, if you want to use these \ntypes, you can learn more about how to do that by reading about them in the \nMySQL Reference Manual.\n\nClzapter 8 \nHow to work with data types \nThe large object types \nType \nBytes \nDescription \nLONGBLOB \nMEDIUMBLOB \nBLOB \nTINYBLOB \nLONGTEXT \nMEDIUMTEXT \nTEXT \nTINYTEXT \nDescription \nL+4 \nL+3 \nL+2 \nL+l \nL+4 \nL+3 \nL+2 \nL+l \nVariable-length strings of binary data up to 4GB in length (L). \nVariable-length strings of binary data up to 16MB in length (L). \nVariable-length strings of binary data up to 65KB in length (L). \nVariable-length strings of binary data up to 255 bytes jn length (L). \nVariable-length strings of characters up to 4GB in length (L). \nVariable-length strings of characters up to 16MB in length (L). \nVariable-length strings of characters up to 65KB in length (L). \nVariable-length strings of characters up to 255 bytes in length (L). \n• \nThe BLOB types store strings of binary data and are referred to as binary large \nobject (BLOB) types. \n• \nThe TEXT types store strings of character data and are sometimes referred to as \ncharacter large object ( CLOE) types. \nThe large object types",
          "pages": [
            265,
            266,
            267
          ],
          "relevance": {
            "score": 0.72,
            "sql_score": 0.9,
            "concept_score": 0.9,
            "non_sql_penalty": 0.0,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        }
      },
      "educational_notes": {
        "definition": "The GROUP BY clause is used to group rows that have the same values in specified columns into summary rows.",
        "explanation": "The GROUP BY clause is essential for performing aggregate functions like SUM, AVG, COUNT, MAX, and MIN on grouped data. It works by dividing the table's rows into groups based on one or more columns. Each group can then be processed separately to compute aggregated values. This is particularly useful when you need to analyze data in a summarized form, such as calculating total sales per product category.",
        "key_points": [
          "Key point 1: GROUP BY groups rows with the same values in specified columns into summary rows.",
          "Key point 2: It must be used with aggregate functions like SUM, AVG, COUNT, MAX, and MIN to perform calculations on each group.",
          "Key point 3: Common pitfall is forgetting to include all non-aggregated columns in the GROUP BY clause, which leads to errors.",
          "Key point 4: Best practice is to always include all non-aggregated columns in the GROUP BY clause for clarity and correctness.",
          "Key point 5: It connects with other concepts like ORDER BY and HAVING to further refine and analyze grouped data."
        ],
        "examples": [
          {
            "title": "Basic Usage",
            "code": "SELECT category, SUM(sales) AS total_sales\nFROM products\nGROUP BY category;",
            "explanation": "This example groups the 'products' table by the 'category' column and calculates the total sales for each category."
          },
          {
            "title": "Practical Example",
            "code": "SELECT department, AVG(salary) AS avg_salary\nFROM employees\nGROUP BY department;",
            "explanation": "This practical example groups the 'employees' table by the 'department' column and calculates the average salary for each department."
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Forgetting to include non-aggregated columns in GROUP BY",
            "incorrect_code": "SELECT category, SUM(sales)\nFROM products;",
            "correct_code": "SELECT category, SUM(sales) AS total_sales\nFROM products\nGROUP BY category;",
            "explanation": "This mistake occurs when you try to select a column that is not aggregated without including it in the GROUP BY clause. It results in an error because MySQL doesn't know how to group rows for non-aggregated columns."
          }
        ],
        "practice": {
          "question": "Create a query that groups employees by their department and calculates the total number of employees in each department.",
          "solution": "SELECT department, COUNT(*) AS employee_count\nFROM employees\nGROUP BY department;",
          "explanation": "This solution correctly groups the 'employees' table by the 'department' column and counts the number of employees in each department using the COUNT function."
        }
      },
      "llm_enhanced": true,
      "raw_text_preview": "Clzapter 8 \nHow to work with data types \nData types \nCategory \nDescription \nCharacter \nNumeric \nDate and time \nLarge Object (LOB) \nSpatial \nJSON \nDescription \nStrings of character data \nNumbers that d",
      "content_relevance": {
        "score": 0.7,
        "sql_score": 1.0,
        "concept_score": 1.0,
        "non_sql_penalty": 0.1,
        "is_relevant": true,
        "analysis": "SQL content"
      }
    },
    "having-murach": {
      "id": "having-murach",
      "title": "HAVING Clause",
      "definition": "Filtering groups based on aggregate values",
      "difficulty": "intermediate",
      "page_references": [
        265,
        266,
        267,
        268,
        269,
        270,
        271,
        272,
        273,
        274,
        275,
        276
      ],
      "sections": {
        "definition": {
          "text": "Clzapter 8 \nHow to work with data types \nThe ENUM and SET types \nType \nBytes \nDescription \nENUM \nSET \n1-2 \n1-8 \nStores one value selected from a list of acceptable values. \nStores zero or more values selected from a list of acceptable values. \nHow values are stored in ENUM columns \nStored in column \nValue \nENUM ('Yes', 'No', 'Maybe') \n'Yes' \n'No' \n'Maybe' \n'Possibly' \n'Yes' \n'No' \n'Maybe' \nI \nI \nHow values are stored in SET columns \nValue \n'Pepperoni• \n'Mushrooms' \n'Pepperoni, Bacon• \n'Olives, Pepperoni' \nDescription \nStored in column \nSET ('Pepperoni', 'Mushrooms', 'Olives') \n'Pepperoni' \n'Mushrooms' \n'Pepperoni' \n'Pepperoni, Olives' \n• \nThe ENUM and SET types can be used to restrict the values that you store to a \nli1nited set of values. Tl1e ENUM column can take on exactly one value, but a SET \ncolt1mn can take on zero, one, or up to 64 different values. \n• \nYou can defme the set of acceptable values for an ENUM or SET column when you \ncreate a table. An ENUM column can have up to 65,535 acceptable values, but a \nSET column is limited to 64 acceptable values. \n• \nTo specify a value for· an ENUM column, you code a single text string. If the string \ncontains an acceptable value, that value is stored in the column. Otherwise, the \ncolumn is assigned an empty string. \n• If you don't specify a value for an ENUM column when you insert a row, MySQL \nassigns a default value that depends on whether the column allows null values. If \nthe column allows null values, MySQL assigns a null value to the column. If it \ndoesn't allow null values, MySQL assigns the first value in the set of acceptable \nvalues to the column. \n• \nTo specify values for a SET column, you code a single string with the values \nseparated by commas. Each acceptable value is stored in the column, and any other \nvalues are ignored. \n• \nWhen you store values in a SET column, MySQL stores the values using the order \nspecified in the column definition, and it does not store duplicate values. \nThe ENUM and SET types\n\nSection 2 \nMore SQL skills cts you need them \nThe large object types \ndesigned to store large amounts of binary or character data. \nThe BLOB (binary large object) types store strings of binary data. This data \ntype is often used to store images, sounds, and video. However, the BLOB types \ncan be used to store any type of binary data, including the binary data that's \nnormally stored in application ftles such as PDF ftles or Word files. \nThe TEXT types work similarly to the BLOB types, but they store strings of \ncharacters. As a result, in other database systems, they are sometimes referred \nto as character large object (CLOE) types. These data types can be used to store \nlarge amounts of character data including data that's normally stored in text, \nXML, or JSON files. \nTo read and write data from a column defined with a BLOB or TEXT type, \nyou typically use another programming language such as Java or PHP. As a \nresult, we don't cover these types in this book. However, if you want to use these \ntypes, you can learn more about how to do that by reading about them in the \nMySQL Reference Manual.\n\nClzapter 8 \nHow to work with data types \nThe large object types \nType \nBytes \nDescription \nLONGBLOB \nMEDIUMBLOB \nBLOB \nTINYBLOB \nLONGTEXT \nMEDIUMTEXT \nTEXT \nTINYTEXT \nDescription \nL+4 \nL+3 \nL+2 \nL+l \nL+4 \nL+3 \nL+2 \nL+l \nVariable-length strings of binary data up to 4GB in length (L). \nVariable-length strings of binary data up to 16MB in length (L). \nVariable-length strings of binary data up to 65KB in length (L). \nVariable-length strings of binary data up to 255 bytes jn length (L). \nVariable-length strings of characters up to 4GB in length (L). \nVariable-length strings of characters up to 16MB in length (L). \nVariable-length strings of characters up to 65KB in length (L). \nVariable-length strings of characters up to 255 bytes in length (L). \n• \nThe BLOB types store strings of binary data and are referred to as binary large \nobject (BLOB) types. \n• \nThe TEXT types store strings of character data and are sometimes referred to as \ncharacter large object ( CLOE) types. \nThe large object types\n\nSection 2 \nMore SQL skills cts you need them \nHow to convert data \nAs you work with the various data types, you'll find that you frequently \nneed to convert data from one type to another. Although MySQL performs many \nconversions automatically, it doesn't always perform the conversion the way you \nwant. Because of that, you need to be aware of how data conversion works, and \nyou need to know when and how to specify the type of conversion you want. \nHow implicit data conversion works \nBefore MySQL can operate on two values, it must convert those values to \nthe same data type. To understand how this works, consider the three expressions \nshown in figu.re 8-8. \nIn the first example, the second column joins a string literal of''$'' to the \ninvoice_total column, which is defined with the DECIMAL type. As a result, \nMySQL converts the DECIMAL value to its corresponding characters, appends \nthose characters to the $ character, and stores them as a CHAR type. \nIn the second example, the second column divides the INT literal of 989319 \nby the VARCHAR type that's stored in the invoice_number column. As a result, \nMySQL attempts to convert the invoice_number column to an INT type before \nit perfor1ns the division operation. If the invoice_number column contains only \nnumbers, this works as you would expect. However, if the invoice_number \ncolumn contains letters or special characters, MySQL converts only the numeric \ncharacters that precede the letters or special characters. For example, in the first \nrow in the result set, MySQL only converts the numbers before the dash in the \ninvoice number column. \nIn the third example, the second column adds an INT literal of 1 to the \ninvoice_date column, which is defined with the DATE type. As a result, MySQL \nconverts the DATE value in the invoice date column to an INT valt1e before it \nperforms the addition. In the result set, the first column uses the DATE type, \nwhich includes dashes between the parts of the date. The second column, on the \nother hand, uses the INT type, which doesn't include dashes between parts of the \ndate. \nNotice in the third row of this result set that after 1 is added to the date, \nthe date is invalid. Because MySQL doesn't check if the resulting date is valid \nwhen you perform an arithmetic operation like this, you're not likely to use the \narithmetic operators with dates. Instead, you'll use the functions for performing \ncalculations on dates that are presented in the next chapter. \nWhen MySQL performs a conversion automatically, it's called an implicit \nconversion. However, if you want to control how a conversion is performed, \nyou can code an explicit conversion. To do that, you can use the CAST and \nCONVERT functions shown in the next figure.",
          "pages": [
            265,
            266,
            267,
            268
          ],
          "relevance": {
            "score": 0.8,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.0,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "examples": {
          "text": "Clzapter 8 \nHow to work with data types \nSELECT statements that implicitly convert data from one type to another \nNumber to string \nSELECT invoice_total, CONCAT{'$', invoice_total) \nFROM invoices \ninvoice_total \nCONCATCs', invoice_total) \n-\n► \n3813.33 \n53813.33 \n'10.20 \ns-10.20 \nI 138.75 \nS138.75 \nString to number \nSELECT invoice_r.n1mh,=ir, 989319 / invoice_n11mher \nFROM invoices \ninvoice_number \n► \n989319-457 \n989 319/tnvoice _number \n0.0037580505988908225 \n0.001027060138580 3393 \nDate to number \nSELECT invoice_date, invoice date+ 1 \nFROM invoices \n. \ninvoice_date \ninvoice_date + 1 \n► \n2018-08-02 \n2018-08-01 \n2018-07-31 \nDescription \n• \nWhen MySQL automatically converts one data type to another, it's known as an \nimplicit conversion. \n• \nIf you code an expression that involves values with different data types, MySQL \nimplicitly converts them when it evaluates the expression. \n• \nIf you use a string in a numeric expression, MySQL attempts to convert the string \nto a nt1mber before evaluating the expression. If the string starts with a letter \nor special character, MySQL returns a value of zero. If it starts with a number, \nMySQL returns that number and each successive number until it encot1nters a letter \nor special character. \n• \nIf you add or subtract an integer to or from a DATE value, MySQL implicitly \nconverts the DATE value to an integer value. \nHow implicit data conversion works \n,.. \nL\n\nSection 2 \nMore SQL skills cts you need them \nHow to convert data using the CAST \nand CONVERT functions \nBecause MySQL's rules for implicit conversion are more flexible than those \nfor other SQL databases, you generally don't need to explicitly convert data \nfrom one type to another. However, whenever necessary, you can use the CAST \nand CONVERT functions to convert, or cast, an expression to the data type you \nspecify as shown in figure 8-9. Since CAST is an ANSI-standard function, it is \nused more freqt1ently than CONVERT, but both functions work equally well for \nmost tasks. \nThe first SELECT statement shows how to use the CAST function. Here, \nthe fourth column in the result set casts the DATE values of the invoice date \ncolu1nn to CHAR values. Although the fourth column looks the same as the \nsecond column, it stores a CHAR value, not a DATE value. In this case, MySQL \nconverted all of the characters in the DATE value to a CHAR value. If that's \nnot what you want, you can truncate the number of characters in the result by \nspecifying a value less than 10 after the CHAR keyword. \nThe fifth column in the 1·esult set casts the DECIMAL values in the \ninvoice_total column to signed INT values. Before the digits to the right of \nthe decimal point are dropped, the numbers are rounded to the nearest whole \nnumber. For brevity, this statement only t1ses the SIGNED keyword. For clarity, \nit could also include the optional INTEGER keyword immediately after the \nSIGNED keyword. \nThe second SELECT statement in this figure shows how to use the \nCONVERT function. If you compare this statement to the first SELECT state-\nment, you '11 see that it uses a slightly different syntax. However, both SELECT \nstatements accomplish the same task.\n\nClzapter 8 \nHow to work with data types \nThe syntax of the CAST function \nCAST(expression AS cast_type) \nThe syntax of the CONVERT function \nCONVERT(expression, cast_type) \nThe cast types you can use in the CAST and CONVERT functions \nCast type \nDescription \nCHAR [ (N)] \nA string of characters where N is the maximu1n number of characters. \nDATE \nA DATE value. \nDATETIME \nA DATETIME value. \nTIME \nA TIME value. \nSIGNED [ INTEGER] \nA signed INT value. The INTEGER keyword is optional. \nUNSIGNED [INTEGER] \nAn unsigned INT value. The INTEGER keyword is optional. \nDECIMAL [ (M [, D] ) l \nA DECIMAL value where M specifies the precision and D specifies \nthe scale. \nA statement that uses the CAST function \nSELECT invoice_ id, invoice_date, invoice_total, \nCAST(invoice_date AS CHAR(lO)) AS char_date, \nCAST(invoice_total AS SIGNED) AS integer_total \nFROM invoices \ninvoice_id \ninvoice_date \ninvoice_total \nchar_date \ninteger _total \n► \n2018-04-08 \n3813.33 \n2018-04-08 \nI~ \n2018-04-10 \n410.20 \n2018-04-10 \n2018-04-13 \n138. 75 \n2018-04-13 \nA statement that uses the CONVERT function \nCONVERT(invoice date, CHAR(lO)) AS char date, \n-\nCONVERT(invoice_total, SIGNED) AS integer_total \nFROM invoices \ninvoke id \ninvoice_date \nnvoice_total \nchar_date \ninteger_ total \n► \n2018-04-08 \n3813.33 \n2018-04-08 \n2018-04-10 \n410.20 \n2018--04-10 \n2018-04-13 \n138.75 \n2018--04-13 \nDescription \n• \nYou can use the CAST or CONVERT function to perform an explicit conversion. \nThis allows you to convert, or cast, an expression from one data type to another. \n• \nCAST is an ANSI-standard function and is used more frequently than CONVERT. \nHow to convert data using the CAST and CONVERT functions \nI\n\nSection 2 \nMore SQL skills cts you need them \nHow to convert data using the FORMAT \nand CHAR functions \nIn addition to the CAST and CONVERT functions, MySQL provides some \nfunctions that perform other types of data conversion. In particular, it provides \nthe FORMAT and CHAR functions shown in figure 8-10. \nYou can use the FORMAT function to convert a number to a string of \ncharacters. This function uses commas to group the thousands to the left of \nthe decimal point. This makes large numbers easier to read. In addition, the \nFORMAT function rounds the number to the specified number of decimal \nplaces. If you specify O decimal places, the function returns a string that doesn't \ninclude a decimal point. \nThe CHAR function returns a binary string for each specified integer. \nThis function is typically used to output ASCII (American Standard Code \nfor Information Interchange) conu·ol characters that can't be typed on your \nkeyboard. The three most common control characters are presented in this figure. \nThese characters can be used to format output so it's easy to read. In this figure, \nfor example, the SELECT statement uses the CHAR(l3) and CHAR(l O) control \ncharacters to start new lines after the vendor name and vendor address in the \noutput.\n\nClzapter 8 \nHow to work with data types \nThe FORMAT and CHAR functions \nFunction \nDescription \nFORMAT(number,decimal) \nCHAR{valuel[,value2] ... ) \nThe FORMAT function \nConverts the specified number to a character suing \nw.ith grouped digits separated by co1nmas, rounded to \nthe specified number of decimal digits. If deciinal is \nzero, then the decimal point is omitted. \nConverts one or 1nore numbers to a binary string. Each \nnumber is interpreted as an integer between O and 255. \nFunction \nResult \nFORMAT(1234567.8901,2) \nFORMAT{l234.56,4) \nFORMAT(1234.56,0) \n1,234,567.89 \n1,234.5600 \n1,235 \nThe CHAR function for common control characters \nFunction \nControl character \nCHAR(9) \nCHAR(lO) \nCHAR(13) \nTab \nLine feed \nCaniage return \nA statement that uses the CHAR function to format output \nSELECT CONCAT(vendor_ name, CHAR(13,10), vendor_addressl, CHAR(13,10), \nvendor_city, ', ', vendor_ state, ' ', vendor_ zip_code) \nFROM vendors \nWHERE vendor id= 1 \nus Postal Service \nAttn: \nSupt. Window Services \nMadison, WI 53707 \nDescription \n• \nThe CHAR function is typically used to insert control characters into a character \nstring. \nHow to convert data using the FORMAT and CHAR functions\n\nSection 2 \nMore SQL skills cts you need them \nPerspective \nIn this chapter, you learned about the different MySQL data types. In \naddition, you learned how to use some functions to convert data from one type \nto another. In the next chapter, you'll learn some of the additional functions for \nworking with data. \nTerms \ndata type \ncharacter data types \nstring \ntext \nnumeric data types \ninteger \nreal number \ndate and time data types \ndate/time data types \ntemporal data types \nlarge object (LOB) data types \nspatial data types \nglobal positioning system (GPS) \ngeometry types \nJSON data type \nJavaScript Object Notation (JSON) \nfixed-length string \nvariable-length string \nutf8mb4 character set \nmultiple-byte character set \nUnicode standard \nutf8mb3 character set \nsingle-byte character set \nlatin I character set \ninteger types \nfixed-point number \nscale \n• \n• \nprec1s1on \nfloating-point number \nsignificant digits \nsingle-precision number \ndouble-precision number \nscientific notation \nexact numeric types \napproximate numeric types \nyear 203 8 problem \nY2K38 problem \nUnix Millennium bug \nBLOB (Binary Large Object) \ncharacter large object (CLOB) \nimplicit conversion \nexplicit conversion \ncast \nASCII (American Standard \nCode for Infor1nation \nInterchange)",
          "pages": [
            269,
            270,
            271,
            272,
            273,
            274
          ],
          "relevance": {
            "score": 0.7,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "commonMistakes": {
          "text": "Clzapter 8 \nHow to work with data types \nExercises \n1. \nWrite a SELECT statement that returns these columns from the Invoices \ntable: \nThe invoice total column \nA column that t1ses the FORMAT function to return the invoice total \ncolumn with 1 digit to the right of the decimal point \nA column that uses the CONVERT function to return the invoice total \ncolumn as an integer \nA column that uses the CAST function to return the invoice total column \nas an integer \n2. \ntable: \nThe invoice date column \nwith its full date and time \nwith just the year and the month",
          "pages": [
            275,
            276
          ],
          "relevance": {
            "score": 0.48,
            "sql_score": 0.6,
            "concept_score": 0.6,
            "non_sql_penalty": 0.0,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        }
      },
      "educational_notes": {
        "definition": "The HAVING clause is used to filter groups of rows based on a condition after an aggregation has been applied. It's similar to WHERE but operates on aggregated data.",
        "explanation": "Imagine you have a dataset of sales transactions and you want to find out which products had total sales greater than $10,000. The HAVING clause allows you to specify this condition on the aggregated data (total sales). Here's how it works:\n1. GROUP BY is used to group rows that have the same values in specified columns.\n2. Aggregation functions like SUM(), COUNT(), AVG() are applied to each group.\n3. The HAVING clause then filters these groups based on a condition.",
        "key_points": [
          "The HAVING clause is used for filtering grouped data after aggregation, unlike WHERE which filters rows before grouping.",
          "It's essential when you need to apply conditions on aggregated values like totals, averages, etc.",
          "Common mistakes include using WHERE instead of HAVING and forgetting to group by the relevant columns."
        ],
        "examples": [
          {
            "title": "Basic Usage",
            "code": "SELECT product_id, SUM(sales_amount) as total_sales\nFROM sales\nGROUP BY product_id\nHAVING total_sales > 10000;",
            "explanation": "This query groups sales by product and filters out products with total sales less than or equal to $10,000."
          },
          {
            "title": "Practical Example",
            "code": "SELECT department_id, AVG(salary) as avg_salary\nFROM employees\nGROUP BY department_id\nHAVING avg_salary > 5000;",
            "explanation": "This practical example finds departments where the average salary is more than $5,000."
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Using WHERE instead of HAVING",
            "incorrect_code": "SELECT product_id, SUM(sales_amount) as total_sales\nFROM sales\nWHERE total_sales > 10000;",
            "correct_code": "SELECT product_id, SUM(sales_amount) as total_sales\nFROM sales\ngroup BY product_id\nHAVING total_sales > 10000;",
            "explanation": "Remember, HAVING is for filtering groups after aggregation. WHERE filters rows before grouping."
          }
        ],
        "practice": {
          "question": "Find the departments with more than 5 employees and list their IDs along with the number of employees in each department.",
          "solution": "SELECT department_id, COUNT(employee_id) as employee_count\nFROM employees\ngroup BY department_id\nHAVING employee_count > 5;"
        }
      },
      "llm_enhanced": true,
      "raw_text_preview": "Clzapter 8 \nHow to work with data types \nThe ENUM and SET types \nType \nBytes \nDescription \nENUM \nSET \n1-2 \n1-8 \nStores one value selected from a list of acceptable values. \nStores zero or more values ",
      "content_relevance": {
        "score": 0.7,
        "sql_score": 1.0,
        "concept_score": 1.0,
        "non_sql_penalty": 0.1,
        "is_relevant": true,
        "analysis": "SQL content"
      }
    },
    "subqueries-murach": {
      "id": "subqueries-murach",
      "title": "Subqueries",
      "definition": "Single-row, multi-row, and correlated subqueries in MySQL",
      "difficulty": "intermediate",
      "page_references": [
        277,
        278,
        279,
        280,
        281,
        282,
        283,
        284,
        285,
        286,
        287,
        288,
        289,
        290,
        291,
        292,
        293,
        294,
        295,
        296
      ],
      "sections": {
        "definition": {
          "text": "How to use functions \nIn chapter 3, you we1·e introduced to some of the scalar functions that you \ncan use in a SELECT statement. Now, this chapter expands on that coverage \nby presenting many more of the scalru: functions, as well as some specialized \nwindow functions. When you complete this chapter, you'll have a thorough \nunderstanding of the functions that you can use with MySQL. \nHow to work with string data ............................................. 258 \nA sut11mary of the string functions .............................................................. 258 \nExamples that use string functions ............................................................. 260 \nHow to sort by a string column that contains numbers ............................... 262 \nHow to parse a string .................................................................................. 264 \nHow to work with numeric data ......................................... 266 \nHow to use the numeric fu nctions .............................................................. 266 \nHow to searcl1 for floating-point nu111bers ................................................... 268 \nHow to work with date/time data ...................................... 270 \nHow to get the current date and time .......................................................... 270 \nHow to parse dates and times witl1 date/ti1ne functions ............................. 272 \nHow to parse dates and ti111es witl1 tbe EXTRACT function ...................... 274 \nHow to format dates and times .................................................................... 276 \nHow to perform calculations on dates and times ........................................ 278 \nHow to search for a date ............................................................................. 280 \nHow to search for a time .............................................................................. 282 \nOther functions you should know about ......................... 284 \nHow to use the CASE fu nction ................................................................... 284 \nHow to use the IF, IFNULL, and COALESCE functio11s .......................... 286 \nHow to use the regular expression functions ............................................... 288 \nHow to use the ranking functions ................................................................ 292 \nHow to use the ana]ytic functions ...................................................................... 296 \nPerspective ......................................................................... 300\n\nSection 2 \nMore SQL skills cts you need them \nHow to work with string data \nThis topic shows how to use the most useful functions that MySQL provides \nfor working with string data. In addition, it shows how to solve two common \nproblems that can occur when you work with string data. \nA summary of the string functions \nwith MySQL. To start, it summarizes the CONCAT function that you lea1ned \nabout in chapter 3. Then, it summarizes a related function, the CONCAT_ WS \nfunction, that you can use to specify a separator string that goes between the \nother strings that you are concatenating. (WS stands for with separator.) \nThe next three functions allow you to remove, or trim, characters from the \nbeginning or end of the string. To remove spaces from the left or right side of a \nstring, you can use the LTRIM or RTRIM function. To remove spaces from both \nsides of a string, you can use the TRIM function. You can also use the TRIM \nfunction to remove characters other than the space character from the left or \nright side of a string. \nTo find the nu1nber of characters in a string, you can use the LENGTH \nfunction. However, thjs function counts spaces at the beginning of the string \n(leading spaces), but not spaces at the end of the string (trailing spaces). As a \nresult, you need to take this into account if the string ends with spaces. \nTo locate the first occurrence of a substring within another string, you can \nuse the LOCATE function. Thls function returns an integer value that indicates \nthe position of the substring. Note that you can start the search at a position other \nthan the beginning of the string by including the optional start argument. This \nfunction is often used within other functions such as the SUBSTRING function. \nThe next four functions return a substring of the specified stting. To start, you \ncan use the LEFT and RIGHT functions to get the specified number of characters \nfrom the left or right side of a string. You can also use the SUBSTRING_INDEX \nfunction to get characters from the left or right side of a string. This function \nreturns the characters before or after a delimiter string occurs the specified number \nof times. Or, you can use the SUBSTRING function to get the specified number of \ncharacters from anywhere in a string. \nYou can use the next two functions to modify the specified string. First, you \ncan use the REPLACE function to replace a substring within the string with \nanother substring. Second, you can use the INSERT function to insert another \nstring into the string. \nFinally, you can use the last seven functions to transfor1n the string in \nother ways. To start, you can use the REVERSE function to reverse the order \nof the characters in a string. You can use the LOWER and UPPER functions to \nconvert the characters in a string to lower or uppercase. You can use the LPAD \nand RPAD functions to pad a string on the left or right until it's a specified \nlength. You can use the SPACE function to return a string that repeats the space \ncharacter the specified number of times. And you can use the REPEAT function \nto repeat any string the specified number of times.\n\nChapter 9 \nHow to use functions \nSome of the string functions \nFunction \nDescription \nCONCAT(strl[,str2] ... ) \nCONCAT_WS(sep,strl[,str2] ... ) \nLTRIM(str) \nRTRIM(str) \nTRIM([[BOTH ILEADING ITRAILING] \n[remove] FROM] str) \nLENGTH(str) \nLOCATE(find,search[,start] ) \nLEFT(str,length) \nRIGHT(str,length) \nSUBSTRING_ INDEX (str,delimiter, \ncount) \nSUBSTRING (str,start[,length] ) \nREPLACE(search,find,replac e ) \nINSERT (str,start,length,insert ) \nREVERSE(str ) \nLOWER(str) \nUPPER(str) \nLPAD (str,length,pad) \nRPAD (str,length,pad) \nSPACE (count ) \nREPEAT (str,count ) \nConcatenates the specified strings. If one of the strings \nis null, then the result is null. \nCo11catenates the strings with the specified separator \nstring added in between. If one of the strings is null \nor empty, it's ignored. If the separator is null, then the \nresult is null. \nReturns the string with any leading spaces removed. \nReturns the string with any trailing spaces removed. \nReturns the string without leading or trailing occur-\nrences of the specified 1·e1nove string. If remove strit1g \nis orni tted, spaces are removed. \nReturns the number of characters in the suing. \nReturns the position of the first occurTence of the find \nstring in the search string, starting at the specified strut \nposition. If the stai·t position is omitted, the search \nstarts at the beginning of the string. If the string isn't \nfound, the function returns zero. \nReturns the specified number of characters from the \nbeginning of the string. \nend of the string. \nReta.ms the substring before the specified number of \noccun·ences of the specified delimiter string. If count \nis positive, it returns from the beginning of the string. \nIf count is negative, it returns from the end of the string. \nReturns the specified number of charactei-s from the \nstring starting at the specified stai·t positio11. lf length \nis omitted, it i-etums from the start position to the end \nof the string. \nReturns the search string with all occurre11ces of the \nfind string replaced with the replace string. \nReturns the string with the specified insert string \ninserted into it starting at the specified start position \nand replacing the specified Jengtb. \nReturns the string with the characters in reverse order. \nReturns the string converted to lowercase letters. \nReturns the string converted to uppercase letters. \nRetu.rns the string padded on the left with the specified \npad string until it's the specified length. If the string is \nlonger than the length, it's truncated. \nReturns the string padded on the right with the speci-\nfied pad string until it's the specified length. If the \nstring is longer than the length, it's truncated. \nRetui-ns the space character repeated count times. \nReturns the specified string repeated count times. \nA summary of the string functions\n\nSection 2 \nMore SQL skills cts you need them \nExamples that use string functions \nthese examples, you shouldn't have any trouble figuring out how they work. \nIf you 're confused by any of them, though, you can refer back to the previous \nfigure to check the syntax and results. \nThe SELECT statement shown at the bottom of this figure shows how you \ncan use the CONCAT WS and RIGHT functions to format columns in a result \nset. In this case, the second column uses the CONCAT_ WS function to retrieve \ntwo columns from the Vendors table and separate them with a comn1a and a \nspace. \nThe third column in the result set lists the vendor's phone number without an \narea code. To accomplish that, this column uses the RIGHT function to extract \nthe eight rightmost characters of the vendor_phone column. This assumes that \nthe area code is enclosed in parentheses and that all of the phone numbers are \nstored in the same format. Since the vendor_phone column is defined with the \nVARCHAR(50) data type, this isn't necessarily the case. \nThis SELECT statement also shows how you can use a function in a \nWHERE clause. This WHERE clause uses the LEFT function to select only \nthose rows that begin with an area code of ''(559''. Again, this assumes that the \narea code is enclosed in parentheses and that the phone numbers are all in the \nsame format.\n\nChapter 9 \nHow to use functions \nString function examples \nFunction \nResult \nCONCAT('Last', 'First') \nCONCAT_WS(', ', 'Last•, 'First') \nLTRIM ( ' \nMySQL \nI ) \nRTRIM ( I \nMySQL \nI \n) \nTRIM ( ' \nMySQL \nI ) \nTRIM(BOTH '*' FROM '****MySQL****') \nLOWER ( I MySQL ' ) \nUPPER(' ca') \nLEFT ( 'MySQL 1 , \n3 ) \nRIGHT('MySQL', 3) \nSUBSTRING('(559) 555-1212', 7, 8) \nSUBSTRING_ INDEX('http://www.murach.com', \nLENGTH ( I MySQL ' ) \nLENGTH ( I \nMySQL \n' ) \nLOCATE('SQL', \nI \nMySQL') \nLOCATE ( ' - ' , \n1 ( 5 5 9 ) 5 5 5 -1212 1 ) \nI \nI \n• \nI \nREPLACE(RIGHT('(559) 555-1212', 13),') ', '-') \nINSERT(\"MySQL\", 1, 0, \"Murach's \") \nINSERT('MySQL', 1, 0, 'Murach' 's ') \nA SELECT statement that uses three functions \nSELECT vendor_ name, \n-2) \n'LastFirst• \n'Last, First' \n'MySQL \n' \n' \nMySQL' \n'MySQL' \n'MySQL' \n•mysql' \n'CA' \n'MyS' \n'SQL' \n'555-1212' \n'murach.com• \n'559-555-1212' \n\"Murach's MySQL\" \n\"Murach's MySQL\" \nCONCAT_WS(', ', vendor_ contact_ last_ name, \nvendor_ contact_first_ name) AS contact_name, \nRIGHT(vendor_phone, 8) AS phone \nFROM vendors \nWHERE LEFT(vendor_phone, 4) = '(559' \nORDER BY contact nam~ \nvendor _name \ncontact_name \nphone \n► \nDrist.as Groom & McCormick \nAaronsen, Thom \n555-8484 \nYale Indusbial Trucks-Fresno \nAlexis1 Alexandro \n555-2993 \nLou Gentile's Flower Basket \nAnum, Trisha \n555-6643 \nPolst.ar \nAranovitdi, Robert \n555-2631 \nExamples that use string functions \n,.. \nL",
          "pages": [
            277,
            278,
            279,
            280,
            281
          ],
          "relevance": {
            "score": 0.8,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.0,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "examples": {
          "text": "Section 2 \nMore SQL skills cts you need them \nHow to sort by a string column \nthat contains numbers \nattempt to sort string data that's stored in a numeric column. To illustrate the \nproblem, look at the first example in this figure. Here, the emp_id column in the \nString_Sample table, which contains numeric IDs, is defined with a character \ntype. Because of that, when you sort by this column, the rows aren't in numeric \nsequence. That's beca11se MySQL interprets the values as characters, not as \nnumbers. \nOne way to solve this problem is to convert the values in the emp_id column \nto integers for sorting purposes. This is illustrated in the second SELECT state-\nment in this figure, which uses the CAST function. As you can see, the rows are \nnow sorted in numeric sequence. The third example is similar, but it implicitly \ncasts the character values to integers by adding Oto the values. \nAnother way to solve this problem is to pad the numbers with leading zeros \nor spaces, as shown by the last example. Here, the LPAD function is used to pad \nthe emp_id column with zeros so the result always contains two columns. Then, \nthe columns that start with a zero are sorted before the other columns, so the \nrows are returned in numeric sequence. \nOf course, if you know that a column will always contain numbers, you'll \ntypically define it with a numeric type. If that isn't possible, though, you can \nsolve the sorting problem by using one of the techniques shown in this figure.\n\nChapter 9 \nHow to use functions \nHow to sort by a string column that contains numbers \nSorted by the emp_id column \nSELECT* \nFROM string_ sample \nORDER BY emp_id \nemp_id \nemp_name \n► \nLizbeth Darien \nLance Pinos-Potter \nDarnell O'Sullivan \nJean Paut Renard \nAlisha von Strump \nSorted by the emp_id column explicitly cast as an integer \nSELECT* \nFROM string_ sample \nORDER BY CAST(emp_ id AS SIGNED) \nempjd \n► \nemp_name \nUibeth Darien \nDarnell O'Sullivan \nAlisha von Strump \nLance Pinos-Potter \nJean Paul Renard \nSorted by the emp_id column implicitly cast as an integer \nSELECT* \nFROM string_ sample \nORDER BY emp_ id + 0 \nemp_id \nemp_name \n► \nLizbeth Darien \nDarnell O'Sullivan \nAlisha von Strump \nLance Pinos-Potter \nJean Paul Renard \n~ \n·'l!a \nl1 \nSorted by the emp_id column after it has been padded with leading zeros \nSELECT LPAD(emp_ id, 2, '0') AS emp_ id, emp_name \nFROM string_ sample \nORDER BY emp_ id \nemp_id \nemp_name \n-\n► \nUibeth Darien \nDarnen O'SUUivan \nAtisha von Strump \nlance Pinos-Pott.er \nJean Paul Renard \nDescription \n• \nThe emp_id column in the String_Sarnple table used i11 the examples above is \ndefined with the type VARCHAR(3). However, this column contains numeric \nvalues.\n\nSection 2 \nMore SQL skills cts you need them \nHow to parse a string \nAnother problem you may encounter when working with string data occurs \nwhen two or more values are stored in the same string. For example, the \nemp_name column in the String_Sample table contains both a frrst and a last \nname. If you want to work with the fu·st and last names independently, you have \nto parse the string using the string functions. Figure 9-4 shows how this works. \nThe first example uses the SUBSTRING_INDEX function to parse the frrst \nand last names. To start, the second column uses the SUBSTRING_INDEX \nfunction to return all characters from the start of the string in the emp_name \ncolumn up to the frrst space in that column. Then, the third column uses the \nSUBSTRING INDEX function to return all characters from the end of the \nstring in the emp_name column up to the last space in that column. To do that, a \nnegative value is coded for the count parameter. \nUnfortunately, this example doesn't work correctly for all rows. In pai·ticular, \nthe last name for the fifth row should probably be ''von Strump'' not ''Strump''. \nTo solve this problem, you can sometimes use the SUBSTRING function as \nshown by the third example. \nBut first, it's helpful to understand how the LOCATE function works as \nillustrated by the second example. Here, the second column returns an integer \nvalue for the location of the first space. Then, the third column returns the \nlocation of the second space. To get the location of the second space, this \nLOCATE function uses a nested LOCATE function as its third parameter. This \nstarts the search at the chai·acter after the first space. \nThe third example uses the SUBSTRING function to parse a stiing. To start, \nthe second column uses the SUBSTRING and LOCATE functions to return all \ncharacters from the beginning of the su·ing to the frrst space. Then, the third \ncolumn uses the SUBSTRING and LOCATE functions to return all characters \nafter the first space to the end of the string. \nUnfortunately, this example also doesn't work correctly for all rows. In \nparticular, the last name for the fourth row should probably be ''Renard'' not \n''Paul Renard''. However, this example does return ''von Strump'' not ''Strump'' \nfor the last row, which is probably correct. \nAs you review these examples, you can focus on how the string functions are \nused. As I've indicated, though, this code doesn't work correctly for all names. \nThis illustrates the importance of designing a database so this type of problem \ndoesn't occur. You'll learn more about that in the next chapter. For now, just \nrealize that if a database is designed correctly, you won't have to worry about \nthis type of problem. Instead, this problem should occur only if you 're importing \ndata from another file or database system.\n\nChapter 9 \nHow to use functions \nHow to use the SUBSTRING_INDEX function to parse a string \nSELECT emp_name, \nSUBSTRING_ INDEX(emp_name, \nSUBSTRING_ INDEX(emp_name, \nFROM string_ sample \nemp_name \nfirst_name \nlast_name \n► \nLizbeth Darien \nLizbeth \nDarien \nDarnel O'SuUivan \nDarnel \nO'SUiiivan \nlance Pines.Potter \nLance \nPines.Potter \nJean Paul Renard \nJean \nRenard \nAlisha van Strump \nAlisha \nStrump \n• •, 1) AS first_name, \n• •, -1) AS last_name \nHow to use the LOCATE function to find a character in a string \nSELECT emp_ name, \nLOCATE(' •, emp_name) AS first_ space, \nLOCATE{' •, emp_name, LOCATE{' •, emp_name) + 1) AS second_ space \nFROM string_ sample \nemp_name \nfirst_space \nsecond_spac.e \n► \nLizbeth Darien \nDarnel O'Sullivan \nLance Pinos.Potter \nJean Paul Renard \nAlisha van Strump \nHow to use the SUBSTRING function to parse a string \nSELECT emp_name, \nSUBSTRING(emp_name, 1, LOCATE(' \n1 , \nemp_name) - 1) AS first_name, \nSUBSTRING(emp_name, LOCATE(' \n1 , \nemp_name) + 1) AS last_name \nFROM string_ sample \nemp_name \nfirst_name \nlast_name \n► \nLizbeth Darien \nLizbeth \nDarien \nDarnel O'Sullivan \nDarnel \no'Surivan \nlance Pines.Potter \nlance \nPinos.Potter \nJean Paul Renard \nJean \nPaul Renard \nAlisha van Strump \nAlisha \nvan Strump \n= \nDescription \n• \nIf a string consists of two or more components, you can parse it into its individual \ncomponents. To do that, you can use the SUBSTRING_INDEX, SUBSTRING, and \nLOCATE functions. \nHow to parse a string\n\nSection 2 \nMore SQL skills cts you need them \nHow to work with numeric data \nIn addition to the string functions, MySQL provides several functions for \nworking with numeric data. Although you '11 probably use only a couple of these \nfunctions regularly, you should be aware of them in case you ever need them. \nHow to use the numeric functions \nprovides. The function you'll probably use most often is the ROUND function \nthat you saw back in chapter 3. This function rounds a number to the precision \nspecified by the length argument. Note that you can round the digits to the left \nof the decimal point by coding a negative value for this argument. However, \nyou 're more likely to code a positive number to round the digits to the right of \nthe decimal point. \nAnother function that you might use regularly is the TRUNCATE function. \nThis function works like the ROUND function, but it truncates the number \ninstead of roL1nding to the nearest number. In other words, this function chops off \nthe end of the number without doing any rounding. For example, if you round \n19.99 to the nearest integer, you get a value of 20. However, if you truncate \n19.99, you get a value of 19. \nYou can use the next two functions, CEILING and FLOOR, to get the \nsmallest integer greater than or equal to a number and the largest integer less \nthan or equal to a number. You can use the ABS function to get the absolute \nvalue of a number. And you can use the SIGN function to return a value that \nindicates if a number is positive, negative, or zero. If you study the examples, \nyou shouldn't have any trouble figuring out how these functions work. \nYou can use the next two functions, SQRT and POWER, to calculate the \nsquare root of a number or raise a number to a specified power. And you can \nuse the last function, RAND, to generate a floating-point number with a random \nvalue between O and 1. \nIn addition to the functions shown in this figure, MySQL provides many \nother functions for performing mathematical calculations, including trigono-\nmetric calculations. Since you 're not likely to use these functions, they aren't \npresented in this book. However, if you need a function that isn't shown here, \nyou can search for the function in the MySQL Reference Manual.\n\nChapter 9 \nHow to use functions \nSome of the numeric functions \nFunction \nDescription \nROUND(number [ , length] ) \nReturns the nt1mber rounded to the precision specified by length. \nIf length is 0, the deci1nal digits are on:litted. This is the default. \nIf length is negative, the digits to the left of the decimal point are \nrounded. \nTRUNCATE(numher,length ) \nReturns the number truncated to the precision specified by length. \nIf length is 0, the decimal digits are omitted. \nCEILING ( l'llJrnb'!r) \nFLOOR ( l'llJrnber ) \nABS(number) \nSIGN ( l'llJJDb'!r) \nSQRT ( fllJJDber) \nPOWER (numher,power) \nRAND ( [integer] ) \nReturns the smallest integer that is greater than or equal to tl1e \nnumber. \nRetw-ns the largest integer that is less than or equal to the number. \nReturns the absolute value of the number. \nReturns the sign of the number as -1 for a negative number, 1 for \na positive number, and O if the number is zero. \nReturns the square root of the number. \nReturns the nt1mber raised to the specified power. \nReturns a random floating-point number between O and 1. If inte-\nger is omitted, tl1e function returns a series of different numbers \nevery time. Otherwise, integer supplies a seed value, and the \nfunction returns the same series of numbers. \nExamples that use the numeric functions \nFunction \nResult \nROUND ( 12 . 49,0) \nROUND(12 . 50,0) \nROUND(12 . 49,1) \nTRUNCATE ( 1 2 .51,0) \nTRUNCATE ( 1 2 .49,1 ) \nCEILING (12.5 ) \nCEILING ( -12.5 ) \nFLOOR(-12.5 ) \nFLOOR ( 12.5 ) \nABS ( -1. 2 5) \nABS (l.25 ) \nSIGN ( -1.25 ) \nSIGN (l.25 ) \nSQRT ( 125 . 43 ) \nPOWER ( 9, 2) \nRAND () \nNote \n12.5 \n12.4 \n-12 \n- 1 3 \n1 2 \n1. 2 5 \n1. 2 5 \n-1 \n11.199553562530964 \n0 . 2444132019248 \n• \nIf an error occurs, each of the numeric functions returns a null value. \nHow to use the numeric functions\n\nSection 2 \nMore SQL skills as you need them \nHow to search for floating-point numbers \nIn chapter 8, you learned that floating-point types such as the DOUBLE and \nFLOAT types store approximate values, not exact values. The details of why \nthat is are beyond the scope of this book. From a practical point of view, though, \nthat means that you don't want to search for exact values when you're working \nwith floating-point numbers. If you do, you'll miss values that are approximately \nequal to the value you 're looking for. \nTo illustrate, consider the table shown in figure 9-6. This table includes a \ncolumn named float_ value that's defined with the DOUBLE type. Now, consider \nwhat would happen if you selected all the rows where the value of float_ value \nis equal to 1 as shown by the first SELECT statement. In that case, the result set \nincludes only the second row, even though the table contains two other rows that \nhave values approximately equal to I. \nThis figure shows two ways to search for approximate values. First, you can \nsearch for a range of values. In this figure, for example, the second SELECT \nstatement searches for values between .99 and 1.01. Second, you can search \nfor values that round to an exact value. This is illustrated by the third SELECT \nstatement. Both of these statements return the three rows from the Float_Sample \ntable that are approximately equal to 1. In addition, both of these statements only \ncheck whether the numbers are equal down to two decimal places. However, if \nyou want, you can modify these statements to check for 1nore decimal places.\n\nChapter 9 \nHow to use functions \nThe Float_ Sample table \nfloat_id \nRoat_value \n► \no. 999999999999999 \n1.000000000000001 \n1234.56789012345 \n999.0'l'l,qQ209348 \nI \n24.04849 \n.I \n... \nA search for an exact value that doesn't include two approximate values \nSELECT* \nFROM float_sample \nWHERE float_value = 1 \nI float_id \nfloat_value \n► r 2 \nHow to search for approximate values \nSearch for a range of values \nSELECT* \nFROM float_ sample \nWHERE float_value BETWEEN 0.99 AND 1.01 \nfloat id -\nfloat_value \n-\n► \n0.999999999999999 \nLOOOOOOOOOOOOOO 1 \nSearch for rounded values \nSELECT* \nFROM float_ sample \nWHERE ROUND(float_value, 2) = 1.00 \nfloat_id \nfloat_value \n► \n0. 999999999999999 \n1. 00000000000000 l \nDescription \n• \nBecat1se floating-point values are approximate, you'll want to search for approximate \nvalues when working with floating-point data types such as the DOUBLE and FLOAT \ntypes. \nHow to search for floating-point numbers\n\nSection 2 \nMore SQL skills cts you need them \nHow to work with date/time data \nIn the topics that follow, you'll learn how to use some of the functions that \nMySQL provides for working with dates and times. As you'll see, these include \nfunctions for extracting different parts of a date/time value and for performing \noperations on dates and times. In addition, you '11 learn how to perfor1n different \ntypes of searches on date/time values. \nHow to get the current date and time \nwork. The NOW, CURDATE, and CURTIME functions return the local dates \nand/or times based on your system's clock. However, if a session time zone \nhas been set, the value returned by the CURDATE and CURTIME functions is \nadjusted to accommodate that time zone. \nThe UTC_DATE and UTC_TIME functions work siinilarly, but they return \nthe Universal Time Coordinate (UTC) date, also known as Greenwich Mean \nTime (GMT). Although you probably won't use the UTC functions often, they're \nuseful if your system operates in different time zones. That way, the date/time \nvalues always reflect Greenwich Mean Time, regardless of the time zone in \nwhich they're entered. For example, a date/time value entered at 11 :00 a.m. Los \nAngeles time is given the same value as a date/time value entered at 2:00 p.m. \nNew York time. That makes it easy to compare and operate on these values. \nWhen you use functions to get the current date and time, you should be \naware that the CURRENT_TIMESTAMP, CURRENT_DATE, and \nCURRENT_TIME functions are synonymous with the NOW, CURDATE, \nand CURTIME functions. In practice, the NOW, CURDATE, and CURTIME \nfunctions are typically used by MySQL programmers because they've been \naround the longest and because they're shorter, which makes them easier to type. \nHowever, the CURRENT_TIMESTAMP, CURRENT_DATE, and \nCURRENT_TIME functions are the ANSI standard, so they're more likely to \nwork with other databases. As a result, if portability is a priority for you, you \nmight want to use these functions. \nWhen you use the NOW, SYSDATE, CURDATE, and CURTIME functions, \nyou must enter an empty set of parentheses after the name of the function as \nshown by this figure. However, when you use the other functions shown in this \nfigure, the parentheses are optional. For example, you can code the \nCURRENT DATE function like this: \nCURRENT_DATE \nThe advantage of coding the empty set of parentheses is that it clearly indicates \nthat the code is calling a function. The disadvantage is that it requires a little \nmore typing.",
          "pages": [
            282,
            283,
            284,
            285,
            286,
            287,
            288,
            289,
            290
          ],
          "relevance": {
            "score": 0.7,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "commonMistakes": {
          "text": "Chapter 9 \nHow to use functions \nFunctions that get the current date and time \nFunction \nDescription \nNOW(} \nSYSDATE() \nReturns the current local date and time based on the system's clock. \nCURRENT TIMESTAMP() \nCURDATE ( ) \nReturns the ctu·rent local date. \nCURRENT_ DATE() \nCURTIME ( ) \nReturns the current local time. \nCURRENT_ TIME ( ) \nUTC_ DATE() \nUTC_ TIME() \nExamples \nReturns the current date in Greenwich Mean Time (GMT). \nReturns the current time in Greenwich Mean Time (GMT). \nFunction \nResult \nNOW() \nSYSDATE() \nCURDATE() \nCURTIME() \nUTC_ DATE() \nUTC TIME() \nCURRENT_ TIMESTAMP() \nCURRENT DATE ( ) \nCURRENT_ TIME () \nDescription \n2018-12-06 14:12:04 \n2018-12-06 14:12:04 \n2018-12-06 \n14:12:04 \n2018-12-06 \n21:12:04 \n2018-12-06 14:12:04 \n2018-12-06 \n14:12:04 \n• \nParentheses are required after the NOW, SYSDATE, CURDATE, and CURTIME \nfunctions. \n• \nParentheses are optional after the UTC_DATE, UTC_TIME, \nCURRENT_TIMESTAMP, CURRENT_DATE, and CURRENT_TIME functions. \nHow to get the current date and time\n\nSection 2 \nMore SQL skills cts you need them \nHow to parse dates and times \nwith date/time functions \nand times. When you use these functions, you can retrieve any of the date parts \nlisted in this figure. \nIf you need to get an integer value for part of a date/time value, you can use \nthe first group of functions as shown by the first group of examples in this figure. \nFor example, you can use the DAYOFWEEK function to retm·n a number that \nrepresents the day of the week. You can use the MONTH function to return a \nnumber that represents the month. And you can use the HOUR function to return \na number that represents the hour. However, if you need to get the name of a day \nor month as a string, you can use the DAYNAME or MONTHNAME functions \nas shown by the second group of examples in this figure.\n\nChapter 9 \nHow to use functions \nSome of the date/time parsing functions \nFunction \nDescription \nDAYOFMONTH(date} \nMONTH(date) \nYEAR(date} \nHOUR(time} \nMINUTE(time) \nSECOND(time} \nDAYOFWEEK(date) \nQUARTER(date) \nDAYOFYEAR(date) \nWEEK (date[,first]) \nLAST DAY(date} \nDAYNAME(date ) \nMONTHNAME(date) \nExamples \nReturns the day of the month as an integer. \nReturns the month as an integer. \nReturns the 4-digit year as an integer. \nReturns the hours as an integer. \nReturns the minutes as an integer. \nReturns the seconds as an integer. \nReturns the day of the week as an integer where 1 =St1nday, \n2=Monday, etc. \nReturns the quarter of tl1e year as ai1 integer between 1 and 4. \nReturns the day of the year as an integer. \nR.eturns the week of the year as an integer. lf the first argument is 0, \nthe week starts on Sunday. If the first argument is I , the week starts \non Monday. \nRetur11S the last day of the month as an integer. \nReturns the name of the day of the week as a string. \nReturns the name of the month as a string. \nFunction \nResult \nDAYOFMONTH('2018- 12- 03') \nMONTH('2018-12-03') \nYEAR ( '2018- 12- 03') \nHOUR ( 'll:35:00') \nMINUTE('ll:35:00') \nSECOND ( 'll:35:00') \nDAYOFWEEK ( '2018-12-03' ) \nQUARTER ( '2018-12-03') \nDAYOFYEAR('2018-12-03') \nWEEK ( '2018-12-03') \nLAST_ DAY('2018-12-03' ) \nDAYNAME('2018-12-03') \nMONTHNAME('2018-12-03 ' ) \nDescription \nMonday \nDecember \n• \nThe argument for the date functions can be either a DATE value or a DATETIME \nvalue. \n• \nThe argument for the time functions can be either a TIME value or a DATETIME \nvalue. \nHow to parse dates and times with date/time functions\n\nSection 2 \nMore SQL skills cts you need them \nHow to parse dates and times \nwith the EXTRACT function \nIn the previous figure, you learned about some common date/time functions \nfor parsing dates and times. In addition to these functions, you can use the \nEXTRACT function to parse dates and times as shown by figure 9-9. Because \nthis function is part of the ANSI standard, you may want to use it to make your \ncode more portable. Or, you may just prefer how this function works. \nWhen you t1se the EXTRACT function, you can code any of the date/time \nunits shown in this figure, followed by the FROM keyword and a date/time \nvalue. Then, MySQL extracts the specified unit from the date/time value and \nreturns an integer value that corresponds to that unit. For example, you can use \nthe MONTH unit to get an integer for the month. You can also use some units to \nget multiple parts of the date. For example, you can use the \nHOUR_SECOND unit to get an integer that represents the hours, minutes, and \nseconds parts of a date/time value. In that case, the returned integer contains one \nor two digits for the hour (a leading zero is dropped), two digits for the minute, \nand two digits for the second. \nOf course, the EXTRACT function won't work correctly if you don't \nspecify a date/time value that makes sense for the specified unit. For example, \nif you specify the SECOND unit for a DATE value, the EXTRACT function \nwon't work correctly. Conversely, if you specify the MONTH unit for a TIME \nvalue, the EXTRACT function won't work correctly. However, if you specify \na DATETIME value as shown by this figure, the EXTRACT function should \nalways work correctly.",
          "pages": [
            291,
            292,
            293,
            294
          ],
          "relevance": {
            "score": 0.46,
            "sql_score": 0.7,
            "concept_score": 0.7,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        }
      },
      "educational_notes": {
        "definition": "A subquery is a query nested within another query. It allows you to perform complex data retrieval operations by breaking down the task into smaller parts.",
        "explanation": "Subqueries are incredibly useful for performing more advanced data analysis and manipulation. They allow you to filter, sort, or aggregate data based on results from other queries. For example, if you want to find all employees who earn more than the average salary, you can use a subquery to calculate the average salary first and then compare it with individual employee salaries.",
        "key_points": [
          "A subquery is a query nested within another query.",
          "It allows for complex data retrieval operations by breaking down tasks into smaller parts.",
          "Subqueries can be used in various clauses like WHERE, FROM, and HAVING."
        ],
        "examples": [
          {
            "title": "Basic Usage",
            "code": "-- Find employees earning more than the average salary SELECT name, salary FROM employees WHERE salary > (SELECT AVG(salary) FROM employees);",
            "explanation": "This example demonstrates how a subquery can be used in the WHERE clause to filter data based on results from another query.",
            "validation_note": "SQL auto-fixed: "
          },
          {
            "title": "Practical Example",
            "code": "-- Find products with stock less than 10 units SELECT product_name, stock FROM products WHERE stock < (SELECT MIN(stock) FROM products GROUP BY category HAVING COUNT(*) > 5);",
            "explanation": "This practical example shows how subqueries can be used to filter data based on aggregated results from another query.",
            "validation_note": "SQL auto-fixed: "
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Forgetting to use parentheses around the subquery.",
            "incorrect_code": "-- Incorrect: SELECT name, salary FROM employees WHERE salary > AVG(salary);",
            "correct_code": "-- Correct: SELECT name, salary FROM employees WHERE salary > (SELECT AVG(salary) FROM employees);",
            "explanation": "Subqueries must be enclosed in parentheses to ensure they are evaluated correctly."
          },
          {
            "mistake": "Using the wrong comparison operator.",
            "incorrect_code": "-- Incorrect: SELECT name, salary FROM employees WHERE salary < (SELECT MAX(salary) FROM employees);",
            "correct_code": "-- Correct: SELECT name, salary FROM employees WHERE salary > (SELECT AVG(salary) FROM employees);",
            "explanation": "It's crucial to use the correct comparison operator based on the desired outcome."
          }
        ],
        "practice": {
          "question": "Write a query that finds all customers who have made more than one purchase.",
          "solution": "-- Solution: SELECT customer_id FROM purchases GROUP BY customer_id HAVING COUNT(*) > 1;"
        }
      },
      "llm_enhanced": true,
      "raw_text_preview": "How to use functions \nIn chapter 3, you we1·e introduced to some of the scalar functions that you \ncan use in a SELECT statement. Now, this chapter expands on that coverage \nby presenting many more of",
      "content_relevance": {
        "score": 0.7,
        "sql_score": 1.0,
        "concept_score": 1.0,
        "non_sql_penalty": 0.1,
        "is_relevant": true,
        "analysis": "SQL content"
      }
    },
    "correlated-subquery-murach": {
      "id": "correlated-subquery-murach",
      "title": "Correlated Subqueries",
      "definition": "Subqueries that reference outer query columns",
      "difficulty": "advanced",
      "page_references": [
        289,
        290,
        291,
        292,
        293,
        294,
        295,
        296,
        297,
        298,
        299,
        300
      ],
      "sections": {
        "definition": {
          "text": "Chapter 9 \nHow to use functions \nThe Float_ Sample table \nfloat_id \nRoat_value \n► \no. 999999999999999 \n1.000000000000001 \n1234.56789012345 \n999.0'l'l,qQ209348 \nI \n24.04849 \n.I \n... \nA search for an exact value that doesn't include two approximate values \nSELECT* \nFROM float_sample \nWHERE float_value = 1 \nI float_id \nfloat_value \n► r 2 \nHow to search for approximate values \nSearch for a range of values \nSELECT* \nFROM float_ sample \nWHERE float_value BETWEEN 0.99 AND 1.01 \nfloat id -\nfloat_value \n-\n► \n0.999999999999999 \nLOOOOOOOOOOOOOO 1 \nSearch for rounded values \nSELECT* \nFROM float_ sample \nWHERE ROUND(float_value, 2) = 1.00 \nfloat_id \nfloat_value \n► \n0. 999999999999999 \n1. 00000000000000 l \nDescription \n• \nBecat1se floating-point values are approximate, you'll want to search for approximate \nvalues when working with floating-point data types such as the DOUBLE and FLOAT \ntypes. \nHow to search for floating-point numbers\n\nSection 2 \nMore SQL skills cts you need them \nHow to work with date/time data \nIn the topics that follow, you'll learn how to use some of the functions that \nMySQL provides for working with dates and times. As you'll see, these include \nfunctions for extracting different parts of a date/time value and for performing \noperations on dates and times. In addition, you '11 learn how to perfor1n different \ntypes of searches on date/time values. \nHow to get the current date and time \nwork. The NOW, CURDATE, and CURTIME functions return the local dates \nand/or times based on your system's clock. However, if a session time zone \nhas been set, the value returned by the CURDATE and CURTIME functions is \nadjusted to accommodate that time zone. \nThe UTC_DATE and UTC_TIME functions work siinilarly, but they return \nthe Universal Time Coordinate (UTC) date, also known as Greenwich Mean \nTime (GMT). Although you probably won't use the UTC functions often, they're \nuseful if your system operates in different time zones. That way, the date/time \nvalues always reflect Greenwich Mean Time, regardless of the time zone in \nwhich they're entered. For example, a date/time value entered at 11 :00 a.m. Los \nAngeles time is given the same value as a date/time value entered at 2:00 p.m. \nNew York time. That makes it easy to compare and operate on these values. \nWhen you use functions to get the current date and time, you should be \naware that the CURRENT_TIMESTAMP, CURRENT_DATE, and \nCURRENT_TIME functions are synonymous with the NOW, CURDATE, \nand CURTIME functions. In practice, the NOW, CURDATE, and CURTIME \nfunctions are typically used by MySQL programmers because they've been \naround the longest and because they're shorter, which makes them easier to type. \nHowever, the CURRENT_TIMESTAMP, CURRENT_DATE, and \nCURRENT_TIME functions are the ANSI standard, so they're more likely to \nwork with other databases. As a result, if portability is a priority for you, you \nmight want to use these functions. \nWhen you use the NOW, SYSDATE, CURDATE, and CURTIME functions, \nyou must enter an empty set of parentheses after the name of the function as \nshown by this figure. However, when you use the other functions shown in this \nfigure, the parentheses are optional. For example, you can code the \nCURRENT DATE function like this: \nCURRENT_DATE \nThe advantage of coding the empty set of parentheses is that it clearly indicates \nthat the code is calling a function. The disadvantage is that it requires a little \nmore typing.\n\nChapter 9 \nHow to use functions \nFunctions that get the current date and time \nFunction \nDescription \nNOW(} \nSYSDATE() \nReturns the current local date and time based on the system's clock. \nCURRENT TIMESTAMP() \nCURDATE ( ) \nReturns the ctu·rent local date. \nCURRENT_ DATE() \nCURTIME ( ) \nReturns the current local time. \nCURRENT_ TIME ( ) \nUTC_ DATE() \nUTC_ TIME() \nExamples \nReturns the current date in Greenwich Mean Time (GMT). \nReturns the current time in Greenwich Mean Time (GMT). \nFunction \nResult \nNOW() \nSYSDATE() \nCURDATE() \nCURTIME() \nUTC_ DATE() \nUTC TIME() \nCURRENT_ TIMESTAMP() \nCURRENT DATE ( ) \nCURRENT_ TIME () \nDescription \n2018-12-06 14:12:04 \n2018-12-06 14:12:04 \n2018-12-06 \n14:12:04 \n2018-12-06 \n21:12:04 \n2018-12-06 14:12:04 \n2018-12-06 \n14:12:04 \n• \nParentheses are required after the NOW, SYSDATE, CURDATE, and CURTIME \nfunctions. \n• \nParentheses are optional after the UTC_DATE, UTC_TIME, \nCURRENT_TIMESTAMP, CURRENT_DATE, and CURRENT_TIME functions. \nHow to get the current date and time\n\nSection 2 \nMore SQL skills cts you need them \nHow to parse dates and times \nwith date/time functions \nand times. When you use these functions, you can retrieve any of the date parts \nlisted in this figure. \nIf you need to get an integer value for part of a date/time value, you can use \nthe first group of functions as shown by the first group of examples in this figure. \nFor example, you can use the DAYOFWEEK function to retm·n a number that \nrepresents the day of the week. You can use the MONTH function to return a \nnumber that represents the month. And you can use the HOUR function to return \na number that represents the hour. However, if you need to get the name of a day \nor month as a string, you can use the DAYNAME or MONTHNAME functions \nas shown by the second group of examples in this figure.",
          "pages": [
            289,
            290,
            291,
            292
          ],
          "relevance": {
            "score": 0.51,
            "sql_score": 1.0,
            "concept_score": 0.43,
            "non_sql_penalty": 0.0,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "examples": {
          "text": "Chapter 9 \nHow to use functions \nSome of the date/time parsing functions \nFunction \nDescription \nDAYOFMONTH(date} \nMONTH(date) \nYEAR(date} \nHOUR(time} \nMINUTE(time) \nSECOND(time} \nDAYOFWEEK(date) \nQUARTER(date) \nDAYOFYEAR(date) \nWEEK (date[,first]) \nLAST DAY(date} \nDAYNAME(date ) \nMONTHNAME(date) \nExamples \nReturns the day of the month as an integer. \nReturns the month as an integer. \nReturns the 4-digit year as an integer. \nReturns the hours as an integer. \nReturns the minutes as an integer. \nReturns the seconds as an integer. \nReturns the day of the week as an integer where 1 =St1nday, \n2=Monday, etc. \nReturns the quarter of tl1e year as ai1 integer between 1 and 4. \nReturns the day of the year as an integer. \nR.eturns the week of the year as an integer. lf the first argument is 0, \nthe week starts on Sunday. If the first argument is I , the week starts \non Monday. \nRetur11S the last day of the month as an integer. \nReturns the name of the day of the week as a string. \nReturns the name of the month as a string. \nFunction \nResult \nDAYOFMONTH('2018- 12- 03') \nMONTH('2018-12-03') \nYEAR ( '2018- 12- 03') \nHOUR ( 'll:35:00') \nMINUTE('ll:35:00') \nSECOND ( 'll:35:00') \nDAYOFWEEK ( '2018-12-03' ) \nQUARTER ( '2018-12-03') \nDAYOFYEAR('2018-12-03') \nWEEK ( '2018-12-03') \nLAST_ DAY('2018-12-03' ) \nDAYNAME('2018-12-03') \nMONTHNAME('2018-12-03 ' ) \nDescription \nMonday \nDecember \n• \nThe argument for the date functions can be either a DATE value or a DATETIME \nvalue. \n• \nThe argument for the time functions can be either a TIME value or a DATETIME \nvalue. \nHow to parse dates and times with date/time functions\n\nSection 2 \nMore SQL skills cts you need them \nHow to parse dates and times \nwith the EXTRACT function \nIn the previous figure, you learned about some common date/time functions \nfor parsing dates and times. In addition to these functions, you can use the \nEXTRACT function to parse dates and times as shown by figure 9-9. Because \nthis function is part of the ANSI standard, you may want to use it to make your \ncode more portable. Or, you may just prefer how this function works. \nWhen you t1se the EXTRACT function, you can code any of the date/time \nunits shown in this figure, followed by the FROM keyword and a date/time \nvalue. Then, MySQL extracts the specified unit from the date/time value and \nreturns an integer value that corresponds to that unit. For example, you can use \nthe MONTH unit to get an integer for the month. You can also use some units to \nget multiple parts of the date. For example, you can use the \nHOUR_SECOND unit to get an integer that represents the hours, minutes, and \nseconds parts of a date/time value. In that case, the returned integer contains one \nor two digits for the hour (a leading zero is dropped), two digits for the minute, \nand two digits for the second. \nOf course, the EXTRACT function won't work correctly if you don't \nspecify a date/time value that makes sense for the specified unit. For example, \nif you specify the SECOND unit for a DATE value, the EXTRACT function \nwon't work correctly. Conversely, if you specify the MONTH unit for a TIME \nvalue, the EXTRACT function won't work correctly. However, if you specify \na DATETIME value as shown by this figure, the EXTRACT function should \nalways work correctly.\n\nChapter 9 \nHow to use functions \nThe EXTRACT function \nFunction \nDescription \nEXTRACT{unit FROM date) \nReturns an integer that corresponds with the \nspecified unit for the specified date/time. \nDate/time units \nUnit \nDescription \nSECOND \nMINUTE \nHOUR \nDAY \nMONTH \nYEAR \nMINUTE_ SECOND \nHOUR_ Ml:NUTE \nDAY_ HOUR \nYEAR_ MONTH \nHOUR_ SECOND \nDAY_ MINUTE \nDAY_ SECOND \nSeconds \nMinutes \nHours \nDay \nMonth \nYear \nMinutes and seconds \nHour and minutes \nDay and hours \nYear and mo11th \nHours, min·utes, and seconds \nDay, hours, and minutes \nDay, hours, minutes, and seconds \nExamples that use the EXTRACT function \nFunction \nResult \nEXTRACT{SECOND FROM '2018-12-03 11:35:00') \nEXTRACT(MINUTE FROM '2018-12-03 11:35:00') \nEXTRACT(HOUR FROM '2018-12-03 11:35:00') \nEXTRACT(DAY FROM '2018-12-03 11:35:00') \nEXTRACT(MONTH FROM ' 2018-12-03 11:35:00') \nEXTRACT(YEAR FROM '2018-12-03 11:35:00') \nEXTRACT(MINUTE_ SECOND FROM '2018-12-03 11:35:00') \nEXTRACT(HOUR_ Ml:NUTE FROM '2018-12-03 11:35:00' ) \nEXTRACT(DAY_ HOUR FROM '2018-12-03 11:35:00') \nEXTRACT(YEAR_ MONTH FROM '2018-12-03 11:35:00' ) \nEXTRACT(HOUR_ SECOND FROM '2018-12-03 11:35:00') \nEXTRACT(DAY_ MINUTE FROM '2018-12-03 11:35:00') \nEXTRACT(DAY_ SECOND FROM '2018-12-03 11:35:00') \nHow to parse dates and times with the EXTRACT function\n\nSection 2 \nMore SQL skills cts you need them \nHow to format dates and times \nand times. This function accepts two parameters. The first parameter speci-\nfies the DATE or DATETIME value that you want to format. Then, the second \nparameter specifies a format string that includes special codes for formatting \nthe various parts of the date or time. To use one of these codes within the format \nstring, you code the percent sign (%) followed by a single case-sensitive letter. \nIn this figure, for instance, the frrst example uses the %m code to get the \nnumeric month, the %d code to get the nume1ic day, and the %y code to get the \ntwo-digit year. This example also uses front slashes (/) to separate the month, \nday, and year. \nThe next three examples use other formatting codes, but they work similarly \nto the frrst example. Namely, the for1nat string contains some date/time format-\nting codes to display the different parts of the date. In addition, it contains other \ncharacters such as spaces, commas, or dashes to separate the different parts of \nthe date. \nThis figure also shows how to use the TIME_FORMAT function to format \nTIME values. This function is illustrated by the last two examples. Although \nyou can also use the TIME_FORMAT function to format the time part of a \nDATETIME value, it's more common to use the DATE_FORMAT function to do \nthat as shown by the fourth example.\n\nChapter 9 \nHow to use functions \nTwo functions for formatting dates and times \nFunction \nDescription \nDATE_ FORMAT(date,format) \nRettLrns a string for the specified DATE or DATETIME \nvalu,e with the formatting speci.fied by the forniat string. \nT:IME_ FORMAT(time,format) \nWorks like the DATE_FORMAT function but accepts \nTIME or DATETIME values, and the.format string can \nonly specify tin1es, L1ot dates. \nCommon codes for date/time format strings \nCode \nDescription \n~om \nMonth, numeric (01 ... 12) \n%c \nMonth, numeric (1 ... 12) \n~oM \nMonth name (January ... December) \n~ob \nAbbreviated month name (Jan ... Dec) \n~od \nDay ofthe 1nontb, numeric (00 ... 31) \n%e \nDay of the month, numeric (0 ... 31) \n%D \nDay of the month with suffix (1st, 2n~ 3rd, etc.) \n%y \nYear, nutneric, 2 digjts \n%Y \nYear, nwneric, 4 digits \n%W \nWeekday name (Sunday ... Saturday) \n~oa \nAbbreviated weekday name (Sun ... Sat) \n9--oH \nHour (00 ... 23) \n%k \nHour (0 ... 23) \n~oh \nHour (01 ... 12) \n%1 \nHour(l ... 12) \n%i \nMinutes (00 ... 59) \n%r \nTime, 12-hotrr (hh:mm:ss AM or PM) \n%T \nTime, 24-hour (hh:mm:ss) \n%S \nSeconds (00 ... 59) \n%p \nAM or PM \nExamples \nFunction \nResult \nDATE_FORMAT('2018-12-03', •~om/9--od/%y') \nDATE_ FORMAT('2018-12-03', \nDATE_ FORMAT('2018-12-03', \nI %e-9--ob-%y t ) \nDATE_ FORMAT('2018-12-03 16:45', '%r') \nTIME_ FORMAT('16:45', \n1 %r\n) \nTIME_FORMAT('l6:45', '%1:%i %p') \nHow to format dates and times \n%Y') \n08/03 / 18 \nMonday, December 3rd, 2018 \n3-Dec-18 \n04:45:00 PM \n04:45:00 PM \n4:45 PM\n\nSection 2 \nMore SQL skills cts you need them \nHow to perform calculations \non dates and times \nDATEDIFF functions to perform calculations on dates and times. You can use \nthe DATE_ADD function to add a specified number of date parts to a date. In \nthis figure, for instance, the first three examples show how you can add days, \nmonths, or seconds to a date/time value. \nYou can also use the DATE_ADD function to subtract date parts from a \ndate/time value. To do tl1a~ you code the expression argument as a negative \nvalue as shown by the fourth example. This performs the same calculation as the \nDATE_SUB function shown in the fifth example. \nWhen you use these date functions, MySQL checks for dates that include \nleap years and returns a null value if a date doesn't exist. For example, 2016 was \na leap year, so it has a day for February 29. However, 2018 wasn't a leap year, so \nit doesn't have a day for February 29. As a result, when the sixth example adds \none year to February 29, 2016, MySQL returns February 28, 2017. On the other \nhand, the seventh example tries to add one year to an invalid date (February 29, \n2018). As a result, MySQL retlllns a null value. \nThe eighth example shows how to use the DATE_ADD function with the \nDAY _HOUR unit to add the specified number of days and hours to a date/time \nvalue. Here, the example adds 2 days and 12 hours to the specified date. \nIf you need to find the number of days between two date/time values, you \ncan use the DATEDIFF function as shown by the second group of examples. \nNote that this function only returns days, not hours, minutes, or seconds. This \nis true even if the arguments are DATETIME values that include time values, \nas shown by the second DATEDIFF example. When you use the DATEDIFF \nfunction, you typically specify the later date as the first argument and the earlier \ndate as the second argument. That way, the result of the function is a positive \nvalue. If you code the earlier date as the first argument, the result is a negative \nvalue as shown by the third DATEDIFF example. \nThe last group of examples shows how to use the TO_DAYS and \nTIME_TO _SEC functions to perforrn calculations on dates and times. To sta~ \nthe TO_DAYS example shows how you can use this function to calct1late the \nnumber of days between two dates. This perfor1ns the same calculation as the \nfirst two DATEDIFF examples. Since the DATEDIFF function is easier to write \nand read, you'll typically use it instead of the TO_DAYS function for this type of \ncalculation. \nThe last example shows how to use the TIME_TO_SEC function to calculate \nthe number of seconds between two times. This type of calculation can be useful \nwhen you're working with time values.",
          "pages": [
            293,
            294,
            295,
            296,
            297,
            298
          ],
          "relevance": {
            "score": 0.38,
            "sql_score": 0.9,
            "concept_score": 0.43,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "commonMistakes": {
          "text": "Chapter 9 \nHow to use functions \nSome of the functions for calculating dates and times \nFunction \nDescription \nDATE_ADD(date,INTERVAL expression unit} \nDATE_ SUB(date,INTERVAL expression unit} \nDATEDIFF(datel, date2} \nTO_ DAYS(date} \nTIME_TO_ SEC(time} \nExamples \nReturns a DATE or DATETIME value \nequal to the specified date plus the speci-\nfied LO terva] . \nequal to the date minus the specified \ninterval. \nReturns the number of days from one \ndate to the other. For DATETIME values, \nthis function ignores the time parts of the \nvalue. \nReturns the number of days since the year \n0. This function does not return reliable \nresults for dates before 1582. \nReturns the number of seconds e]apsed \nsince midnight, which is useful for calcu-\nlating elapsed time. \nFunction \nResult \nDATE_ADD('2018-12-31', INTERVAL 1 DAY} \nDATE_ADD('2018-12-31', INTERVAL 3 MONTH} \nDATE_ADD('2018-12-31 23:59:59', INTERVAL 1 SECOND) \nDATE_ ADD('2019-01-01', INTERVAL -1 DAY) \nDATE_ SUB('2019-01-01', INTERVAL 1 DAY) \nDATE_ADD('2016-02-29', INTERVAL 1 YEAR) \nDATE_ ADD('2018-02-29', INTERVAL 1 YEAR) \nDATE_ADD('2018-12-31 12:00', INTERVAL '2 12' DAY_HOUR) \nDATEDIFF('2018-12-30', '2018-12-03') \nDATEDIFF('2018-12-30 23:59:59', \n1 2018-12-03') \nDATEDIFF('2018-12-03', '2018-12-30') \nTO_DAYS('2018-12-30') -\nTO_ DAYS('2018-12-03') \nTIME_ TO_ SEC('l0:00'} -\nTIME_ TO_ SEC('09:59') \nDescription \n2019-01-01 \n2019-03-31 \n2019-01-01 00:00:00 \n2018-12-31 \n2018-12-31 \n2017-02-28 \nNULL \n2019-01-03 00:00:00 \n-27 \n• If the expression you specify in the DATE_ADD function is a negative integer, the \ninterval is subtracted from the date. \n• If the expression you specify in the DATE_SUB function is a negative integer, the \ninterval is added to the date. \nHow to perform calculations on dates and times\n\nSection 2 \nMore SQL skills cts you need them \nHow to search for a date \ndates in a column that's defined with the DATETIME data type. The examples in \nthis figure use a table named Date_Sample. This table includes a date_id column \nthat's defined with the INT type and a start_date column that's defmed with \nthe DATETIME type. The time components in the first three rows in this table \nhave a zero value. In contrast, the time components in the next three rows have \nnon-zero time components. \nThe problem occurs when you try to search for a date value. In this figure, \nfor instance, the first SELECT statement searches for rows in the Date_Sample \ntable with a date of '2018-02-28'. Because this code doesn't specify a time \ncomponent, MySQL adds a zero time component ('00:00:00') when it converts \nthe date string to a DATETIME value. However, because the row with this date \nhas a non-zero time value, MySQL doesn't return any rows for this statement. \nTo solve this problem, you can use one of the three techniques shown in \nthis figure. First, you can search for a range of dates that includes only the date \nyou're looking for as shown by the second SELECT statement in this figure. The \nWHERE clause in this statement searches for dates that are greater than or equal \nto the date you're looking for and less than the date that follows the date you're \nlooking for. Because a time component of zero is implicitly added to both of the \ndates in the search condition, this statement returns the one row with the date \nyou want. \nBecause this SELECT statement doesn't use any functions in the WHERE \nclause, it provides the most efficient technique for searching for dates. That's \nparticularly true if the start_date column is indexed. By contrast, the second \ntechnique uses the MONTH, DAYOFMONTH, and YEAR functions in the \nWHERE clause to search for just for those components. And the third technique \nuses the DATE FORMAT function in the WHERE clause to return a formatted \nstring that only contains the month, day, and year. \nIf you want, you can use other date functions to search for a date. For \nexample, you can use the EXTRACT function shown earlier in this chapter. \nWhenever possible, though, you should avoid using functions so the search is as \nefficient as possible.",
          "pages": [
            299,
            300
          ],
          "relevance": {
            "score": 0.41,
            "sql_score": 0.9,
            "concept_score": 0.29,
            "non_sql_penalty": 0.0,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        }
      },
      "educational_notes": {
        "definition": "Correlated subqueries are a type of SQL query where a subquery is nested within another query and references data from the outer query.",
        "explanation": "Correlated subqueries are essential when you need to compare or filter data based on values that exist in another part of your query. They allow you to perform complex operations by leveraging data from both the main query and the subquery. This is particularly useful when dealing with conditions that depend on specific rows within a dataset.",
        "key_points": [
          "Key point 1: Correlated subqueries execute for each row in the outer query, making them computationally expensive but powerful.",
          "Key point 2: They are used to filter data based on values from another part of the query, enabling complex conditions and comparisons.",
          "Key point 3: Common pitfalls include not understanding how the subquery executes for each row or using incorrect join conditions that can lead to performance issues."
        ],
        "examples": [
          {
            "title": "Basic Usage",
            "code": "-- Find employees who earn more than the average salary in their department SELECT employee_id, first_name, last_name, salary FROM employees e1 WHERE salary > (SELECT AVG(salary) FROM employees e2 WHERE e2.department_id = e1.department_id);",
            "explanation": "This example demonstrates how a correlated subquery is used to compare each employee's salary against the average salary in their department.",
            "validation_note": "SQL auto-fixed: "
          },
          {
            "title": "Practical Example",
            "code": "-- Find customers who have made more than one purchase SELECT customer_id, first_name, last_name FROM customers c1 WHERE (SELECT COUNT(*) FROM orders o WHERE o.customer_id = c1.customer_id) > 1;",
            "explanation": "This practical example shows how a correlated subquery can be used to identify customers who have made multiple purchases.",
            "validation_note": "SQL auto-fixed: "
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Incorrectly using an outer join instead of a correlated subquery",
            "incorrect_code": "-- Incorrect use of outer join\nSELECT e.employee_id, e.first_name, e.last_name, AVG(o.order_amount) AS avg_order_amount\nFROM employees e\nLEFT JOIN orders o ON e.employee_id = o.employee_id\nGROUP BY e.employee_id;",
            "correct_code": "-- Correct use of correlated subquery SELECT employee_id, first_name, last_name, (SELECT AVG(order_amount) FROM orders WHERE employee_id = e.employee_id) AS avg_order_amount FROM employees e;",
            "explanation": "This mistake occurs when a student tries to solve a problem with an outer join instead of a correlated subquery. The correct approach uses a correlated subquery to calculate the average order amount for each employee."
          }
        ],
        "practice": {
          "question": "Write a query that finds products which have been ordered more than 10 times.",
          "solution": "-- Solution using correlated subquery\nSELECT product_id, product_name\nFROM products p\nWHERE (SELECT COUNT(*) FROM orders_items oi WHERE oi.product_id = p.product_id) > 10;"
        }
      },
      "llm_enhanced": true,
      "raw_text_preview": "Chapter 9 \nHow to use functions \nThe Float_ Sample table \nfloat_id \nRoat_value \n► \no. 999999999999999 \n1.000000000000001 \n1234.56789012345 \n999.0'l'l,qQ209348 \nI \n24.04849 \n.I \n... \nA search for an ex",
      "content_relevance": {
        "score": 0.41,
        "sql_score": 1.0,
        "concept_score": 0.43,
        "non_sql_penalty": 0.1,
        "is_relevant": true,
        "analysis": "SQL content"
      }
    },
    "unions": {
      "id": "unions",
      "title": "UNION and UNION ALL",
      "definition": "Combining results from multiple SELECT statements",
      "difficulty": "intermediate",
      "page_references": [
        301,
        302,
        303,
        304,
        305,
        306,
        307,
        308,
        309,
        310,
        311,
        312
      ],
      "sections": {
        "definition": {
          "text": "Chapter 9 \nHow to use functions \nThe contents of the Date_Sample table \ndate_id \nstart date \n► \n1986-03-0100:00:00 \n2006-02-28 00:00:00 \n2010-10-3100:00:00 \n2018-02-28 10:00:00 \n2019-02-28 13:58:32 \n2019-03-0109:02:25 \n-... \nA SELECT statement that fails to return a row \nSELECT* \nFROM date_ sample \nWHERE start_date = '2018-02-28' \nL \ndate_id \nstart_date \nThree techniques for ignoring time values \nSearch for a range of dates \nSELECT* \nFROM date_ sample \nWHERE start date >= '2018-02 -28' AND start date < '2018-03- 01' \ndate_id \nstart_date \n► \n2018-02-28 10:00:00 \nSearch for month, day, and year integers \nSELECT* \nFROM date_ sample \nWHERE MONTH(start_date } = 2 AND \nDAYOFMONTH(start_ date) = 2 8 AND \nYEAR {start_date} = 2018 \ndate id -\nstart_date \n► \n2018-02-28 10:00:00 \nSearch for a formatted date \nSELECT* \nFROM date_ sample \nWHERE DATE_ FORMAT (start_date, •~a111-%d -%Y' ) = '02 - 28- 2018' \nf \ndate ,d \nstart date \n► \n2018~2-28 10:00:00 \nDescription \n• \nYou can search for a date in a DATETIME column by searching for a range of \ndates, by using functions to specify the month, day, and year of the date, or by \nsearching for a formatted date. Of these techniques, searching for a range of dates \nis the most efficient. \nHow to search for a date \nI \n.I\n\nSection 2 \nMore SQL skills cts you need them \nHow to search for a time \nWhen you search for a time value in a DATETIME column without speci-\nfying a date component, MySQL automatically uses the default date of January \n1, 1900. That's why the first SELECT statement in figure 9-13 doesn't return a \nrow even though one row matches the specified time. \nThe second SELECT statement shows one way to solve this problem. Here, \nthe WHERE clause uses the DATE_FORMAT function to return a string for the \nstart_date column in the hh:mm:ss format. Then, the WHERE clause compares \nthis string to a literal string of 10:00:00. \nThe third SELECT statement in this figure shows another way to solve this \nproblem. This statement works similarly to the second statement, but it uses \nthe EXTRACT function to extract an integer that represents the ho1rrs, minutes, \nand seconds in the start_date column. Then, the WHERE clause compares this \ninteger to an integer value of 100000. Although this approach might run slightly \nfaster, it's also more difficult to read. As a result, I recommend using the first \napproach unless performance is critical. \nThe fourth and fifth SELECT statements show that you can use a similar \ntechnique to search for a range of times. Here, the fourth statement t1ses the \nHOUR function to search for a particular hour of the day, and the fifth statement \nuses the EXTRACT function to search for times between two times. Of course, \nyou could also use the DATE_FORMAT function to get the same results. \nBefore I go on, you should realize that many of the problems that can occur \nwhen searching for dates and times can be avoided by designing the database \nproperly. For example, if you know that only the date portion of a date/time \nvalue is significant, yot1 can store the date in a column with the DATE type. \nConversely, if you know that only the time portion of a date/time value is \nsignificant, you can store the time in a column with the TIME type. That way, \nyou won't need to use functions in your searches, and you can create an index \nfor the search column to significantly speed searches. \nHowever, if both the date and time are significant, you can store them in \na column with the DATETIME type. Then, you can use the techniques shown \nin this figure and the previous figure to search for dates and times. Remember, \nthough, that if you need to use functions in your searches, MySQL can't use the \ncolumn's index and the search will run significantly slower.\n\nThe contents of the Date_Sample table \ndate_id \nstart_date \n► \n1986-03-0100:00:00 \n2006-02-28 00:00:00 \n2010-10-3100:00:00 \n2018-02-28 10:00:00 \n2019-02-28 13:58:32 \n2019-03-0 109:02:25 \n~ \nA SELECT statement that fails to return a row \nSELECT* FROM date_ sample \nWHERE start_ date = '10:00:00' \nI date_id \nstart_date \nExamples that ignore date values \nSearch for a time that has been formatted \nSELECT* FROM date_ sample \nWHERE DATE_ FORMAT(start_date, \n1 %T 1 ) \n= \n1 10:00:00 1 \ndate 1d \nstart date \n► \n2018-02-28 10:00:00 \nSearch for a time that hasn't been formatted \nSELECT* FROM date_sample \nChapter 9 \nHow to use functions \nWHERE EXTRACT(HOUR SECOND FROM start_date) = 100000 \ndate_id \nstart_date \n► \n2018-02-28 10:00:00 \nSearch for an hour of the day \nSELECT* FROM date_ sample \nWHERE HOUR(start_ date) = 9 \ndate_id \nstart_date \n► \n2019-03-0109:02:25 \nSearch for a range of times \nSELECT* FROM date_sample \nWHERE EXTRACT (HOUR_MINUTE FROM start_date) BETWEEN 900 AND 1200 \ndate_id \nstart_date \n► \n2018-02-28 10:00:00 \n2019-03-01 09:02:25 \nDescription \n• \nYou can search for a ti1ne in a DATETIME column without specifying a date by \nusing date/time functions to get the time part of the DATETIME value. Then, you \ncan use the time parts in your WHERE clause. \nHow to search for a time",
          "pages": [
            301,
            302,
            303
          ],
          "relevance": {
            "score": 0.6,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.2,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "examples": {
          "text": "Section 2 \nMore SQL skills cts you need them \nOther functions you should know about \nThis topic describes other functions that you should know about. That \nincludes the CASE, IF, IFNULL, and COALESCE functions. It also includes the \nregular expression and specialized window functions that are new with MySQL \n8.0. \nHow to use the CASE function \nreturns a value that's determined by the conditions you specify. The easiest way \nto describe how this function works is to look at the two examples shown in this \nfigure. \nThe first example uses a simple CASE function. When you use this function, \nMySQL compares the input expression you code in the CASE clause with \nthe expressions you code in the WHEN clauses. In this exrunple, the input \nexpression is a value in the terms_id column of the Invoices table, and the \nwhen expressions are the valid values for this column. When MySQL finds an \nexpression in a WHEN clause that's equal to the input expression, it returns the \nexpression specified in the matching THEN clause. For example, if the value \nof the terms_id column is 3, this function returns a value of ''Net due 30 days.\" \nAlthough it's not shown in this example, you can also code an ELSE clause at \nthe end of the CASE function. Then, if none of the expressions in the WHEN \nclause are equal to the input expression, the function returns the value specified \nin the ELSE clause. \nThe second example uses a searched CASE function to determine the status \nof the invoices in the Invoices table. To do that, the CASE function uses the \nDATEDIFF and NOW functions to get the number of days between the current \ndate and the invoice due date. If the difference is greater than 30, the CASE \nfunction returns the value ''Over 30 days past due.\" Otherwise, if the difference \nis greater than 0, the function returns the value ''I to 30 days past due.\" Note \nthat if the condition in the frrst WHEN clause is true, the condition in the second \nWHEN clause is also true. In that case, the function returns the expression \nassociated with the first condition since this condition is evaluated first. In other \nwords, the sequence of the conditions is critical to getting the correct results. If \nneither of the conditions is true, the function returns the value ''Current.\" \nThe silnple CASE function is typically used with columns that can contain a \nlimited number of values, such as the terms_id column used in the first example. \nBy contrast, the searched CASE function can be used for a wide variety of \npurposes. For example, this function can be used to test for conditions other than \nequal, such as greater than or less than. This is shown in the second exa1nple, \nwhich couldn't be coded using the simple syntax. In addition, each condition in \na searched CASE function can be based on a different column or expression. Of \ncourse, CASE functions can be more co1nplicated than the ones that are shown \nhere, but this should give you an idea of what you can do with this function.\n\nChapter 9 \nHow to use functions \nThe syntax of the simple CASE function \nCASE input_expression \nEND \nWHEN when_expression_ l THEN result_expression_ l \n[WHEN when_expression_2 THEN result_expression_ 2] ••• \n[ELSE else_result_expression] \nA SELECT statement that uses a simple CASE function \nSELECT invoice_number, terms_id, \nCASE terms id \nWHEN 1 THEN 'Net due 10 days• \nWHEN 2 THEN 'Net due 20 days• \nWHEN 3 THEN 'Net due 30 days• \nWHEN 4 THE.N 'Net due 60 days• \nWHEN 5 THEN 'Net due 90 days• \nEND AS terms \nFROM \n• \n• \n1nvo1ces \ninvo1ce_number \nterms_id \nterms \n111-92R-10096 \nNet due 20 days \nNet due 60 days \nP02-88077S7 \nNet due 30 days \nThe syntax of the searched CASE function \nCASE \nEND \nWHEN conditional_expression_ l THEN result_expression_ l \n[WHEN conditional_expression_2 THEN result_expression_ 2] ••• \n[ELSE else_result_expression] \nA SELECT statement that uses a searched CASE function \n\"' \n. I \n'V \nSELECT invoice_n11rnbf?lr, invoice_total, invoice_date, invoice_due_date, \nCASE \nWHEN DATEDIFF(NOW(), invoice_due_date) > 30 \nTHEN 'Over 30 days past due' \nWHEN DATEDIFF(NOW(), invoice_due_date) > 0 \nTHEN '1 to 30 days past due' \nELSE 'Current' \nEND AS invoice_ status \nFROM invoices \nWHERE invoice_total - payment_total - credit_total > 0 \ninvoice_number \nlnvoice_total \ninvoice date \ninvoice_due_date \ninvoice_status \n-\n► \n391CM \n85.31 \n2018-07-10 \n2018-08-09 \nOver 30 days past due \n52.25 \n2018-07-18 \n2018-08-17 \nOver 30 days past due \n579.42 \n2.018-07-21 \n2018-08-10 \nOver 30 days past due \n= \nDescription \nL \n• \nTl1e simple CASE function tests the expression in the CASE clause against the \nexpressions in the WHEN clauses. Then, the function returns the result expression \nfor the frrst test that's true. \n• \nThe searched CASE function tests the expression in each WHEN clause and retwns \nthe result expression for the first test that's true. \nHow to use the CASE function\n\nSection 2 \nMore SQL skills cts you need them \nHow to use the IF, IFNULL, \nand COALESCE functions \nstart, you can use the IF function to test a condition and return one value if the \ncondition is true or another value if the condition is false. For instance, the first \nexample uses the IF function to return a string value of ''Yes'' if the vendor_city \ncolumn is equal to a value of ''Fresno''. Otherwise, the IF function returns a \nvalue of ''No''. \nBoth the IFNULL and COALESCE functions let you substitute non-null \nvalues for null valt1es. Although these functions are similar, the COALESCE \nfunction is more flexible because it lets you specify a list of values. Then, it \nreturns the first non-null value in the list. In contrast, the IFNULL function only \nlets you specify two expressions. If the first expression is not null, it returns that \nexpression. Otherwise, it returns the second expression. \nThe second example uses the IFNULL function to return the value of the \npayment_date column if that column doesn't contain a null value. Otherwise, it \nreturns a string that says ''No Payment''. The third example performs the same \noperation using the COALESCE function.\n\nChapter 9 \nHow to use functions \nThe syntax of the IF function \nIF(test_expression, if_true_expression, else_expression) \nA SELECT statement that uses the IF function \nSELECT vendor_name, \nIF(vendor_city = 'Fresno', 'Yes', 'No') AS is_city_ fresno \nFROM vendors \nvendor _name \nis_dty _fresno \nTowne Advertiser's Mailing Svcs \nNo \nBFl Industries \nYes \nPacific Gas & Electric \nNo \nRobbins Mobile Lock And Key \nYes \nBiO Marvin Electric Inc \nYes \nThe syntax of the IFNULL function \nIFNULL(test_expression, replacement_value ) \nA SELECT statement that uses the IFNULL function \nSELECT payment _date, \nIFNULL (payment_date, 'No Payment') AS new date \nFROM invoices \npayment_date \n2018-08·11 \ntmr!I \n2018-08·11 \nnew date \n2018-08·11 \nNo Payment \n2018-08·11 \nThe syntax of the COALESCE function \nCOALESCE(expression_l[, expression_ 2] ••• ) \nA SELECT statement that uses the COALESCE function \nSELECT payment _date, \nCOALESCE(payment_date, 'No Payment• ) AS new_date \nFROM invoices \npayment_date \nnew_date \n2018-08·11 \n2018-08·11 \nNo Payment \n2018-08·11 \n2018-08·11 \nDescription \n,.. \n~ \nV \nI \n,.. \n• \nI \nV \n• \nThe IF function lets you test an expression and return one value if the expression is \ntrue and another value if the expression is false. \n• \nThe IFNULL and COALESCE functions let you substitute non-null values for null \nvalues. \n• \nThe IFNULL function returns the first expression if it isn't null. Otherwise, it \nreturns the replacement value you specify. \n• \nThe COALESCE function returns the first expression in the list that isn't null. If all \nof the expressions are nL1ll, this function returns a null value. \nHow to use the IF, IFNULL, and COALESCE functions\n\nSection 2 \nMore SQL skills cts you need them \nHow to use the regular expression functions \nIn chapter 3, you learned how to use the REG EXP operator to work with \nstring patterris known as regular expressions to determine which values in a \ncolumn satisfy a condition. With MySQL 8.0, you can also use the regular \nexpression functions shown in the frrst table in figure 9-16 to work with string \npatterns. Although these functions have arguments in addition to the ones shown \nhere, these are the ones you'll use most often. \nAll of the regular expression ft1nctions use a pattern to search a string \nexpression. The REGEXP _LIKE function works like the REGEXP operator. It \nreturns l if the pattern is found or O if it isn't. Because of that, you can use this \nfunction in a Boolean expression. \nIf you use the REGEXP _INSTR function and the pattern is found, the index \nof the first character in the matching substring is returned. If the pattern isn't \nfound, 0 is returned. \nThe REGEXP _SUBSTR function returns the first substring that matches \nthe pattern. If the substring isn't found, it returns a null value. And the \nREGEXP _REPLACE function replaces any occurrences of the pattern it finds \nwith another string. \nTo create a string pattern, you can use the special characters and constructs \nshown in the second table in this figure. The frrst six are the same as the ones \npresented in chapter 3, so you shouldn't have any trouble understanding how \nthey work. However, the last two constructs weren't presented in chapter 3. The \nfirst one lets you match zero or more occurrences of a single character, and the \nsecond one lets you match zero or more occurrences of a sequence of characters. \nThe third table in this figure shows how the regular expression functions \nwork. Here, all five of the functions operate on the string expression ''abcl23''. \nThen, the first example uses the REGEXP _LIKE function to determine if this \nexpression co11tains the numbers 123. Since it does, the result is I. The second \nexample is similar, but it checks if the nt1mbers 123 are at the beginning of the \nexpression. Since they 're not, this function returns 0. \nThe third example uses the REGEXP _INSTR function to get the index of \nthe first character of the substring 123 that occurs in the string expression. In this \ncase, the substring starts at the fourth character in the expression, so the function \nreturns 4. \nThe fourth example uses the REGEXP _SUBSTR function to get a substring \nof the characters in the string expression. Here, the patter11 indicates that the \nsubstring consists of any letter, followed by any number of digits at the end of \nthe string expression. That returns the value ''c123''. \nThe last example uses the REGEXP _REPLACE function to replace the \nnumber 1 or 2 with the number 3. That returns the value ''abc333''.\n\nChapter 9 \nHow to use functions \nThe syntax of the regular expression functions \nFunction \nDescription \nREGEXP_LI KE (expr , pattern) \nReturns 1 (true) if the string expression matches the pat-\ntern. Otherwise, returns O (false). \nREGEXP_ I NSTR(expr, pattern \n[, start]) \nReturns the index of the first character of the \nsubstring in the string expression that matches the pat-\ntern, starting at the specified start position. If the start \nposition is omitted, the search starts at the beginning of \nthe string. If the pattern isn't found, the function returns \n0. \nREGEXP_ SUBSTR( expr, pattern \n[, start]) \nReturns the first substring of the string expression \nthat matches the pattern starting at the specified posi-\ntion. If the start position is omitted, the first substring is \nreturned. If the pattern isn't found, the function returns \na null value. \nREGEXP_ REPLACE (expr, pattern, \nreplace[, start]) \nReturns the string expression with all occurrences of \nthe pattern replaced with the replace string. \nRegular expression special characters and constructs \nCharacter/Construct \nDescription \nA \n$ \n• \n[charlist] \n[char1-char2] \nI \nchar* \n(charl ist ) * \nMatches the pattern to the beginning of the value being tested. \nMatches the pattern to the end of the value being tested. \nMatches any single character . \nMatches any single character listed within the brackets. \nMatches any single character within the given range. \nSeparates two string patterns and matches either one. \nMatches zero or more occurrences of the character. \nMatches zero or more occurrences of the sequence of characters in \nparentheses. \nExamples of the regular expression functions \nExample \nResult \nREGEXP_ LIKE('abc123', \n1 123'} \nREGEXP_LIKE ( 'abcl23 ' , \n' \"123' ) \nREGEXP_ INSTR('abc123 ', '123'} \nREGEXP_ SUBSTR('abcl2 3', '[A-Z] (1-9] *$') \nREGEXP_REPLACE ( 'abc123', '1 12', '3 ') \nDescription \nc 123 \nabc3 33 \n• \nThe regular expression functions use a string pattern to search a string expression. These \npatterns can use special characters and constructs, which are case-insensitive by default. \nHow to use the regular expression functions (part 1 of 2)",
          "pages": [
            304,
            305,
            306,
            307,
            308,
            309
          ],
          "relevance": {
            "score": 0.7,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "commonMistakes": {
          "text": "Section 2 \nMore SQL skills cts you need them \nTo help you understand how you can use the regular expression functions \nin SQL statements, part 2 of figure 9-16 presents three SELECT statements that \nuse them. The first example uses the REGEXP _INSTR function in the SELECT \nclause to return the index of the first space in the vendor_city column. The same \nREGEXP _INSTR function is also used in the WHERE clause so only the cities \nthat have a space in their names are included in the result set. \nThe second example uses the REGEXP _SUBSTR function in the SELECT \nclause to get the substring ''San'' or ''Los'' that appears at the beginning of the \nvendor_city column. Then, it uses the same function in the WHERE clause so \nif the function returns a null value, the row isn't included in the result. In other \nwords, only the cities that start with ''San'' or ''Los'' are included. \nThe third example uses the REGEXP_REPLACE function in the SELECT \nclause to replace the value ''Street'' that occt1rs anywhere in the vendor_address I \ncolumn with the value ''St''. Note that because patterns are case-insensitive by \ndefault, the pattern STREET will match both uppercase and lowercase letters \nas shown here. This example also uses the REGEXP_LIKE function in the \nWHERE clause so only vendors with a vendor_addressl column that contains \nthe pattern are included in the result set. As you saw in chapter 3, this WHERE \nclause can also be coded using the REGEXP operator like this: \nWHERE vendor addressl REGEXP 'STREET' \nAlthough these examples are relatively simple, they should give you an idea \nof what you can do with the regular expression functions. For more information \non these functions and the special characters and constructs you can use with \nthem, see the documentation for MySQL.\n\nChapter 9 \nHow to use functions \nA statement that uses the REGEXP INSTR function \nSELECT DISTINCT vendor_city, REGEXP_ INSTR(vendor_ city, ' ') AS space_ index \nFROM vendors \nWHERE REGEXP_ INSTR(vendor_ city, • ') > 0 \nORDER BY vendor_city \nvendor_aty \n-~-\nspace_index \n► \nAnn Arbor \nAubun Hills \nCarol Stream \nEast Brunswidc \nFort \\~/ashington \nLos Angeles \n(17 rows) \nA statement that uses the REGEXP SUBSTR function \nI \nSELECT vendor_ city, REGEXP_ SUBSTR(vendor_city, •ASANILOS') AS city_match \nFROM vendors \nWHERE REGEXP_ SUBSTR(vendor_city, • ASAN ILOS') IS NOT NULL \nvendor _city \ncity _match \n-\n► \nLos Angeles \nLos \nSanta Ana \nSan \nSan Francisco \nSan \nSan Diego \nSan \n(12 rows) \nA statement that uses the REGEXP REPLACE \nand REGEXP LIKE functions \nSELECT vendor_ name, vendor_addressl, \nREGEXP_REPLACE(vendor_addressl, 'STREET', 'St') AS new addressl \nFROM Vendors \nWHE.RE REGEXP_ LIKE(vendor_addressl, 'STREET') \nvendor _name \nvendor _address 1 \nnew _address 1 \n► \nExpedata Inc \n4420 N. Frst Street, SUite 108 \n4420 N. First St, SUite 108 \nFresno Photoengraving Company \n1952 \"H• Street \n1952 \"H·st \nNat Assoc of College Stores \n500 East Lorain Street \n500 East Lorain St \nlhe Fresno Bee \n1626 E Street \n1626ESt \nThe Presort Center \n1627 'c Street \n1627 \"E• St \nReiter's Scientific &. Pro Books \n2021 K Street Nw \n2021 K StNw \n(4 rows) \nDescription \n• \nThe REGEXP _LIKE function works just like the REGEXP operator that you \nlearned about in chapter 3. \n• \nThe REGEXP _REPLACE function replaces the occurrences of the regular expres-\nsion pattern only in the result set. The database table re1nains unchanged. \nHow to use the regular expression functions (part 2 of 2)",
          "pages": [
            310,
            311
          ],
          "relevance": {
            "score": 0.7,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        }
      },
      "educational_notes": {
        "definition": "UNION and UNION ALL are SQL operators used to combine the results of two or more SELECT statements into a single result set.",
        "explanation": "UNION combines the results of multiple SELECT queries, removing duplicate rows from the final output. UNION ALL includes all rows from each query, including duplicates. This is useful when you need to aggregate data from different tables or conditions without manually merging them in your application code.",
        "key_points": [
          "Key point 1: UNION removes duplicates, while UNION ALL includes all rows.",
          "Key point 2: Both queries must have the same number of columns and compatible data types.",
          "Key point 3: The column names in the final result set are taken from the first SELECT statement.",
          "Key point 4: ORDER BY can be used only once, at the end of all UNION statements.",
          "Key point 5: Performance is generally better with UNION ALL if duplicates are not a concern."
        ],
        "examples": [
          {
            "title": "Basic Usage",
            "code": "-- Combining results FROM two tables SELECT name FROM employees UNION SELECT name FROM contractors;",
            "explanation": "This example combines the names of all employees and contractors into one list, removing any duplicate names.",
            "validation_note": "SQL auto-fixed: "
          },
          {
            "title": "Practical Example",
            "code": "-- Finding customers who have made both online AND in-store purchases SELECT customer_id FROM online_orders UNION SELECT customer_id FROM store_sales;",
            "explanation": "This practical example identifies customers who have purchased items both online and in-store, using UNION to combine the results from two different tables.",
            "validation_note": "SQL auto-fixed: "
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Forgetting to use ORDER BY at the end of all UNION statements",
            "incorrect_code": "-- Incorrect usage SELECT name FROM employees UNION SELECT name FROM contractors;",
            "correct_code": "-- Correct usage SELECT name FROM employees UNION SELECT name FROM contractors ORDER BY name;",
            "explanation": "Students often forget to include ORDER BY at the end, which can lead to errors or unexpected results. Always ensure it's placed correctly if sorting is needed."
          },
          {
            "mistake": "Using UNION when UNION ALL would suffice",
            "incorrect_code": "-- Incorrect usage SELECT name FROM employees UNION SELECT name FROM contractors;",
            "correct_code": "-- Correct usage SELECT name FROM employees UNION ALL SELECT name FROM contractors;",
            "explanation": "Using UNION when duplicates are not a concern can lead to unnecessary performance overhead. Always choose the most efficient option based on your needs."
          }
        ],
        "practice": {
          "question": "Write a SQL query using UNION to combine results from two tables, one containing customer names and email addresses, and another containing customer names and phone numbers.",
          "solution": "-- Solution\nSELECT name, email FROM customers_email\nUNION\nSELECT name, phone_number FROM customers_phone;\n-- This query combines the names and contact information (email or phone) of all customers into a single result set."
        }
      },
      "llm_enhanced": true,
      "raw_text_preview": "Chapter 9 \nHow to use functions \nThe contents of the Date_Sample table \ndate_id \nstart date \n► \n1986-03-0100:00:00 \n2006-02-28 00:00:00 \n2010-10-3100:00:00 \n2018-02-28 10:00:00 \n2019-02-28 13:58:32 \n2",
      "content_relevance": {
        "score": 0.6,
        "sql_score": 1.0,
        "concept_score": 1.0,
        "non_sql_penalty": 0.2,
        "is_relevant": true,
        "analysis": "SQL content"
      }
    },
    "create-table-murach": {
      "id": "create-table-murach",
      "title": "Creating Tables",
      "definition": "CREATE TABLE with columns, data types, and constraints",
      "difficulty": "beginner",
      "page_references": [
        317,
        318,
        319,
        320,
        321,
        322,
        323,
        324,
        325,
        326,
        327,
        328,
        329,
        330,
        331,
        332,
        333,
        334
      ],
      "sections": {
        "definition": {
          "text": "Chapter 9 \nHow to use functions \nThe syntax of the analytic functions \n{FIRST_VALUEILAST_ VALUEINTH_VALUE}(scalar_expression[, numeric_ literal]) \nOVER ([partition_clause) order_clause [frame_ clause)) \n{LEADILAG}{scalar_expression [, offset [, default]]) \nOVER ([partition_clause) order_clause) \n{PERCENT_RANK() ICUME_DIST()} OVER ([partition_clause] order_ clause) \nThe columns in the Sales_Reps and Sales_Totals tables \nColumn name \nData type \nColumn name \nData type \nrep_id \nrep_first_name \nrep_last_name \nINT \nVARCHAR(50) \nVARCHAR(50) \nrep_1d \nsales_year \nsales_total \nINT \nYEAR \nDECIMAL(9,2) \nA query that uses the FIRST_VALUE, NTH_VALUE, and \nLAST VALUE functions \nSELECT sales__year, CONCAT(rep_ first_name, ' ', rep_ last_ name) AS rep_name, \nsales_total, \nFIRST_VALUE(CONCAT(rep_ first_ name, \nI \n', rep_ last_ name)) \nOVER (PARTITION BY sales__year ORDER BY sales_total DESC) \nAS highest_ sales, \nNTH_VALUE(CONCAT(rep_ first_namA, ' ', rep_ last_~arne), 2) \nRANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) \nAS second_highest_ sales, \nLAST_VALUE(CONCAT(rep_ first_ name, ' ', rep_ last_name)) \nAS lowest sales \nFROM sales totals JOIN sales_ reps ON sales_totals.rep_ id = sales_ reps.rep_ id \nsales_year \nrep_name \nsales_total \nhighest_sales \nsecond _highes t_sales \nlowest_sales \n► \nJonathon lhomas \n1274856.38 \nJonathon Thomas \nAndrew Markasian \nSonja Martinez \nAndrew Markasian \n1032875.48 \nJonathon lhomas \nAndrew Markasian \nSonja Martinez \nSonja Martinez \n978'165.99 \nJonathon lhomas \nAndrew Markasian \nSonja Martinez \nAndrewMarkasian \n1132744.56 \nAndrew Markasian \nSonja Martinez \nLydia Kramer \nSonja Martinez \n974853.81 \nAndrew Markaslan \nSonja Martinez \nLydia Kramer \nJonathon Thomas \n9237'16.85 \nAndrew Markasian \nSonja Martinez \nL ydla Kramer \nPhillip Winters \n655786.92 \nAndrew Markasian \nSonja Martinez \nLydia Kramer \nLydia Kramer \n422847,86 \nAndrew Markasian \nSonja Martinez \nLydia Kramer \nJonathon Thomas \n998337.46 \nJonathon Thomas \nSonja Martinez \nLydia Kramer \nSonja Martinez \n887695.75 \nJonathon Thomas \nSonja Martinez \nLydia Kr-amer \nPhiffip Winters \nn443.37 \nJonathon lhomas \nSonja Martinez \nLydia Kramer \nLydia Kramer \n45182.44 \nJonathon lhomas \nSonja Martinez \nLydia Kramer \nDescription \n• \nThe FIRST_ VALUE, LAST_ VALUE, NTH VALUE, LEAD, LAG, PERCENT_RANK, \nand CUME_DIST functions are sometimes referred to as analytic functions. They were \nintroduced with MySQL 8.0. \n• \nThe FIRST_ VALUE, LAST_VALUE, and NTH_ VALUE functions return the first, \nlast, and nth value in a sorted set of values. When you use the PARTITION BY \nclause with LAST_ VALUE or NTH_VALUE, you typically include the ROWS or \nRANGE clause as well to defme a subset of the current partition. \nHow to use the analytic functions (part 1 of 2)\n\nSection 2 \nMore SQL skills cts you need them \nThe LEAD and LAG functions let you refer to values in other rows of the \nresult set. The LAG function is illustrated by the first exa1nple in part 2 of figure \n9-18. Here, the OVER clause is used to group the result set by the rep_id column \nand sort it by the sales_year column. Then, the LAG function in the fourth \ncolumn gets the sales total from one row prior to the current row (the offset). \nSince the rows are sorted by year for each sales rep, that means that the function \nretrieves the sales rep's sales for the previous year. The ftfth column uses the \nsame function, but it subtracts the result of this function from the current sales to \nshow the change in sales from the previous year. The LEAD function is similar, \nbut it lets you refer to values in fo]Jowing rows rather than previous rows. \nNotice that the value of the LAG function for the first row for each sales rep \nis 0.00. That's because there isn't a row for the prior year. By default, this value \nis null. Because I wanted to calculate the change for each row in the result set, \nthough, I used the third argument of the LAG function to set the default to 0. \nThe second example shows how to use the PERCENT _RANK and \nCUME_DIST functions. Both of these functions groups the rows by year and \nsorts them by sales total in ascending sequence. \nThe PERCENT _RANK function calculates a percent that indicates the \nrank of each row within a partition. The result of this function is always a value \nbetween O and 1. If you study the results in this example, you shouldn' t have any \ntrouble understanding bow this function works. \nThe CUME_DIST function is similar, but it calculates the percent of values \nthat are less than or equal to the current value. This function represents the \ncumulative distribution of the values. The cumulative distribution is calculated \nby dividing the number of rows with the current value or a lower value by the \ntotal number of rows in the partition.\n\nChapter 9 \nHow to use functions \nA query that uses the LAG function \nSELECT rep_id, sales_year, sales_total AS current_ sales, \nLAG(sales_total, 1, 0) OVER (PARTITION BY rep_ id ORDER BY sales_year) \nAS last_ sales, \nsales_total - LAG(sales_total, 1, 0) \nOVER (PARTITION BY rep_id ORDER BY sales_year) AS 'change' \nFROM sales totals \nrepjd \nsales_year \ncurrent_sales \nlast_sales \nchange \n► \n127-18 56. 38 \n0.00 \n127-1856. 38 \n9237'16.85 \n1274856.38 \n-351109.53 \n998337.'16 \n923746.85 \n74590.61 \n978465.99 \n0.00 \n978'165.99 \n2. \n97-1853.81 \n978465.99 \n-3612. 18 \n887695.75 \n97'1853.81 \n-87158.06 \n'\"'= \n,,., \n- . \n.., \nA query that uses the PERCENT_RANK and CUME_DIST functions \nSELECT sales_year, rep_ id, sales_total, \nPERCENT_RANK() OVER (PARTITION BY sales_year ORDER BY sales_total) \nAS pct_ rank, \nCUME_DIST ( ) OVE.R ( PARTITION BY sales_year ORDER BY sales total) \nAS 'cume_dist' \nFROM sales_totals \nsales_year \nrep_ld \nsales_total \npct_rank \na.une_dist \n► \n978465.99 \n0.3333333333333333 \n1032875.'iS \n0.5 \no. --- -- -- ·---\n127'18 56. 38 \n422847.86 \n0.2 \n655786.92 \n0.25 \n0.4 \nl \n923746.85 \n0.5 \n0.6 \n974853.81 \n0.75 \n0.8 \n1132.744.56 \ns \n45182.44 \n0.25 \n72443.37 \n0.3333333333333333 \n0.5 \n887695.75 \n0.6666666666666666 \n0.75 \n998337.46 \nDescription \n• \nThe LEAD function retrieves data from a following row in a result set, and the \nLAG function retrieves data from a previous row in a result set. \n• \nThe PERCENT _RANK function calculates the rank of the values in a sorted set of \nvalues as a percent. The CUME_DIST ft1nction calculates the percent of the values \nin a sorted set of values that are less than or equal to the current value. \nHow to use the analytic functions (part 2 of 2) \n: \n' \nl \nl \nl \n'\n\nSection 2 \nMore SQL skills cts you need them \nPerspective \nIn this chapter, you learned about the different functions that you can use \nto operate on M ySQL data. At this point, you have all of the skills you need to \ndevelop SQL code at a professional level. \nHowever, there's a lot more to learn about MySQL. In the next section of \nthis book, then, you'll learn the basic skills for designing a database. Even if you \nnever need to design your own database, understanding this material will help \nyou work more efficiently with databases that have been designed by others. \nTerms \nstring pattern \nregular expression \nregular expression functions \nspecialized window functions \nranking functions \npartition \nanalytic functions \ncumulative distribution \nExercises \n1. \nWrite a SELECT staten1ent that returns these columns from the Invoices table: \nThe invoice total column \nA column that uses the ROUND function to return the invoice total \ncolumn with 1 decimal digit \ncolumn with no decimal digits \nA column that uses the TRUNCATE function to return the invoice_total \ncolumn with no decimal digits \n2. \nWrite a SELECT statement that returns these columns from the Date_Sample \ntable in the EX database: \nThe start_date column \nA column that uses the DATE_FORMAT function to return the start_date \ncolumn with its month name abbreviated and its month, day, and two-digit \nyear separated by slashes \nA column that uses the DATE FORMAT function to return the start date \n-\ncolumn with its month and day returned as integers with no leading zeros, a \ntwo-digit year, and all date parts separated by slashes \ncolumn with only the hours and minutes on a 12-hour clock with an am/pm \nindicator",
          "pages": [
            317,
            318,
            319,
            320
          ],
          "relevance": {
            "score": 0.3,
            "sql_score": 1.0,
            "concept_score": 0.2,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "examples": {
          "text": "Chapter 9 \nHow to use functions \n3. \nWrite a SELECT statement that returns these columns from the Vendors table: \nThe vendor name column \nThe vendor_name column in all capital letters \nThe vendor_phone column \nA column that displays the last four digits of each phone number \nWhen you get that working right, add the columns that follow to the result set. \nThis is more difficult because these columns require the use of functions within \nfunctions. \nThe vendor_phone column with the parts of the number separated by dots, \nas in 555.555.5555 \nA column that displays the second word in each vendor name if there is one \nand blanks if there isn't \n4. \nWrite a SELECT statement that retUI·ns these columns from the Invoices table: \nThe invoice number column \nThe invoice date column \nThe invoice_date column plus 30 days \nThe payment_date column \nA colt1mn named days_to_pay that shows the number of days between the \ninvoice date and the payment date \nThe number of the invoice date's month \nThe four-digit year of the invoice date \nWhen you have this working, add a WHERE clause that retrieves just the \ninvoices for the month of May based on the invoice date, not the number of \nthe invoice month. \n5. \ntable of the EX database: \nThe emp_name column \nA column that displays each employee's first name \nA column that displays each employee's last name \nUse regular expression functions to get the first and last name. If a name \ncontains three parts, everything after the first part should be considered part of \nthe last name. Be sure to provide for last names with hypens and apostrophes. \nHint: To include an apostrophe in a pattern, you can code a\\ in front of it or \nyou can enclose the pattern in double quotes. \n6. \nof the AP database: \nThe invoice number column \nThe balance due for each invoice with a balance due greater than zero \nA column that uses the RANK() function to rank the balance due in \ndescending sequence\n\nDatabase design \nand implementation \nFor large applications, a developer who specializes in database design \nmay be responsible for designing and creating the databases that are \nused by production applications. This developer may also be responsible \nfor designing and creating the databases that are used for testing those \napplications. Then, a database administrator (DBA) may be responsible for \nmaintaining these databases. For smaller applications, programmers are \noften asked to fill one or both of these roles. In other words, programmers \noften need to design, create, and maintain the databases that are used for \ntesting and production. \nSo, whether you 're a database designer, a database administrator, or \na SQL programmer, you need the skills and knowledge presented in this \nsection. That's true even if you aren't ever called upon to design, create, or \nmaintain a database. By understanding what's going on behind the scenes, \nyou'll be able to use SQL more effectively. \nIn chapter 10, you'll learn how to design a database. In chapter 11, \nyou'll learn how to use the Data Definition Language (DDL) statements to \ncreate and maintain databases, tables, and indexes. Finally, in chapter 12, \nyou '11 leam how to create and maintain views, which are database objects \nthat provide another way to look at tables.\n\nHow to design a database \nIn this chapter, you'll learn how to design a new database. This is useful \ninformation whether or not you ever design a database on your own. To illus-\ntrate this process, I'll use the accounts payable (AP) database that you've seen \nthroughout this book. \nHow to design a data structure ......................................... 306 \nThe basic steps for designing a data structure ............................................ 306 \nHow to identify the data elements .............................................................. 308 \nHow to subdivide the data elements ............................................................ 310 \nHow to identify the tables and assign columns ........................................... 312 \nHow to identify the primary and foreign keys ............................................ 314 \nHow to enforce the relationships between tables ........................................ 316 \nHow nor1nal·ization works ........................................................................... 318 \nHow to identify the columns to be indexed ................................................. 320 \nHow to normalize a data structure .................................... 322 \nThe seven normal forms .............................................................................. 322 \nHow to apply the first normal form ............................................................. 324 \nHow to apply the second normal form ........................................................ 326 \nHow to apply the third normal form ............................................................ 328 \nWhen and how to denormalize a data structure .......................................... 330 \nHow to use MySQL Workbench for database design ..... 332 \nHow to open an existing EER model. .......................................................... 332 \nHow to create a new EER model ................................................................. 332 \nHow to work with an EER model ................................................................ 334 \nHow to work with an EER diagram ............................................................ 336 \nPerspective ......................................................................... 338\n\nSection 3 \nDatabase design and impleme11,tation, \nHow to design a data structure \nDatabases are often designed by database administrators (DBAs) or design \nspecialists. This is especially true for large, multiuser databases. How well this \nis done can directly affect your job as a MySQL programmer. In general, a \nwell-designed database is easy to understand and query, while a poorly designed \ndatabase is difficult to work with. In fact, when you work with a poorly designed \ndatabase, you will often need to figure out how it is designed before you can \ncode your queries appropriately. \nThe topics that follow present a basic approach for designing a data struc·-\nture. We use that term to refer to a model of the database rather than the database \nitself. Once you design the data structure, you can use the techniques presented \nin the next two chapters to create a database with that design. By unde1·standing \nthe right way to design a database, you'll work more effectively as a MySQL \nprogrammer. \nThe basic steps for designing a data structure \nIn many cases, you can design a data structure based on an existing \nreal-world system. The illustration at the top of figure 10-1 presents a conceptual \nview of how this works. Here, you can see that all of the information about the \npeople, documents, and facilities within a real-world system is mapped to the \ntables, columns, and rows of a database system. \nAs you design a data structure, each table represents one object, or entity, in \nthe real-world system. Then, within each table, each column stores one item of \ninformation, or attribute, for the entity, and each row stores one occurrence, or \ninstance, of the entity. \nThis figure also presents the six steps you can follow to design a data \nstructure. You'll learn more about each of these steps in the topics that follow. In \ngeneral, though, step 1 is to identify all the data elements that need to be stored \nin the database. Step 2 is to break complex elements down into smaller compo-\nnents whenever that makes sense. Step 3 is to identify the tables that will make \nup the system and to determine which data elements are assigned as columns in \neach table. Step 4 is to define the relationships between the tables by identifying \nthe primary and foreign keys. Step 5 is to normalize the database to reduce data \nredt1ndancy. And step 6 is to identify the indexes that are needed for each table. \nTo model a database system after a real-world system, you can use a \ntechnique called entity-relationship (ER) modeling. Because this is a complex \nsubject of its own, I won't present it in this book. However, I have applied some \nof the basic elements of this technique to the design diagrams presented in this \nchapter. In effect, then, you' 11 be learning so1ne of the basics of this modeling \ntechnique.\n\nHovv to design a database \nA database system is modeled after a real-world system \nReal-world system \nDatabase system \nPeople \nFacilities \nDocuments \nOther \nsystems \nColumns \n--=.,......■ \n; ■••· \n~--·· \n·••r-\n·-· \n--\nThe six basic steps for designing a data structure \nStep 1: \nStep 2: \nStep 3: \nStep 4: \nStep 5: \nStep 6: \nDescription \nIdentify the data elements \nSubdivide each element into its smallest useful components \nIdentify the tables and assign column.s \nIdentify the primary and foreign keys \nReview whether the data structure is normalized \nIdentify the indexes \n• \nA relational database system should model the real-world environment where it's \nused. The job of the designer is to analyze the real-world system and then map it \nonto a relational database system. \n• \nA table in a relational database typically represents an object, or entity, in the real \nworld. Each column of a table is used to store an attribute associated with the \nentity, and each row represents one instance of the entity. \n• \nTo model a database and the relationships between its tables after a real-world \nsystem, you can use a technique called entity-relationship (ER) modeling. Some of \nthe diagrams you'll see in this chapter apply the basic elements of ER modeling. \nThe basic steps for designing a data structure\n\nSection 3 \nDatabase design and impleme11,tation, \nHow to identify the data elements \nThe first step for designing a data structure is to identify the data elements \nrequired by the system. You can use several techniques to do that, including \nanalyzing the existing system if there is one, evaluating comparable systems, and \ninterviewing anyone who will be using the system. One particularly good source \nof information is the documents used by an existing system. \nIn figure 10-2, for example, you can see an invoice that's used by an \naccounts payable system. We'll use this document as the main source of infor-\nmation for the database design presented in this chapte1·. Keep in mind, though, \nthat you'll want to use all available resources when you design your own \ndatabase. \nIf you study this document, you' 11 notice that it contains information about \nthree different entities: vendors, invoices, and line items. First, the form itself \nhas preprinted info1mation about the vendor who issued the invoice, such as the \nvendor's name and address. If this vendor were to issue another invoice, this \ninformation wouldn't change. \nThis document also contains specific information about the invoice. Some \nof this information, such as the invoice number, invoice date, and invoice total, \nis general in nature. Although the actL1al information will vary from one invoice \nto the next, each invoice will include this information. In addition to this general \ninformation, each invoice includes information about the items that were \npurchased. Although each line item contains similar information, each invoice \ncan contain a different number of line items. \nOne of the things you need to consider as you review a document like this \nis how much information your system needs to track. For an accounts payable \nsystem, for example, you may not need to store detailed data such as the infor-\nmation about each line item. Instead, you may just need to store summary data \nlike the invoice total. As you think about what data elements to include in the \ndatabase, then, you should have an idea of what information you'll need to get \nback out of the system.",
          "pages": [
            321,
            322,
            323,
            324,
            325,
            326,
            327,
            328
          ],
          "relevance": {
            "score": 0.3,
            "sql_score": 1.0,
            "concept_score": 0.2,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "commonMistakes": {
          "text": "Hovv to design a database \nAn invoice that can be used to identify data elements \nAcme Fabrication, Inc. \nCustotn Contraptions, Contrivances and Confa!Ju/ations \nInvoice Number: \nIOl- 1088 \n1234 West Industrial Way East Los Angeles California 90022 \nInvoice Date: \n10/05/18 \n800.555.1212 \nfax 562.555.1213 \nwww. acmef abrication. com Terms: \nNet 30 \nPart No. \nQty. \nCUST345 \nCUST281 \nCUST917 \nYour salesperson: \nAccounts receivable: \nDescription \nDesign service , hr \nBaling wire , 25x3ft roll \nDuct tape , black, yd \nRubber tubing , 100ft roll \nAssembl y , hr \nTesting, hr \nSales Tax \nRuben Goldberg, e xt 4512 \nInigo Jones , e xt 4901 \nUnit Price \n100 . 00 \n79 . 90 \n1 . 09 \n4 . 79 \n75 . 00 \n125 . 00 \nExtension \n1200 . 00 \n559 . 30 \n4768 . 75 \n9 . 58 \n525 . 00 \n250 . 00 \n245 . 20 \n$7 , 557 . 83 \nPLEASE PAY THIS AMOUNT \nThanlcs for your b1,1si11ess ! \nThe data elements identified on the invoice document \nVendor name \nVendor address \nVendor phone number \nVendor fax number \nVendor web address \nInvoice number \nDescription \nInvoice date \nInvoice terms \nItem part number \nItem quantity \nItem description \nItem unit price \nItem extension \nVendor sales contact name \nVendor sales contact extension \nVendor AR contact name \nVendor AR contact extension \nInvoice total \n• \nDepending on the nature of the system, you can identify data elements in a variety \nof ways, including interviewing users, analyzing existing systems, and evaluating \ncomparable systems. \n• \nThe documents used by a real-world system, such as the invoice shown above, can \noften help you identify the data elements of the system. \n• \nAs you identify the data elements of a system, you should begin thinking about \nthe entities that those elements are associated with. That will help you identify the \ntables of the database later on. \nHow to identify the data elements\n\nSection 3 \nDatabase design and impleme11,tation, \nHow to subdivide the data elements \nSome of the data elements you identify in step 1 of the design procedt1re will \nconsist of multiple components. The next step, then, is to divide these elements \ninto their smallest useful values. Figure 10-3 shows how you can do that. \nThe first example in this figure shows how you can divide the name of the \nsales contact for a vendor. Here, the name is divided into two elements: a first \nname and a last name. When you divide a name like this, you can easily perform \noperations like sorting by last name and using the first name in a salutation, such \nas ''Dear Ruben.\" In contrast, if the full name is stored in a single column, you \nhave to use the string functions to extract the component you need. But as you \nlearned in the last chapter, that can lead to inefficient and complicated code. In \ngeneral, then, you should separate a name like this whenever you'll need to use \nthe name components sepai·ately. Later, when you need to use the full name, you \ncan concatenate the first and last names. \nThe second example shows how you typically divide an address. Notice \nin this example that the street number and street name are stored in a single \ncolumn. Although you could store these components in separate columns, that \nusually doesn't make sense since these values are typically used together. That's \nwhat I mean when I say that the data elements should be divided into their \nsmallest useful values. \nWith that guideline in mind, you 1night even need to divide a single string \ninto two or more components. A bulk mail system, for example, might require a \nseparate column for the first three digits of the zip code. And a telephone number \ncould require as many as four columns: one for the area code, one for the \nthree-digit prefix, one for the four-digit number, and one for the extension. \nAs in the previous step, knowledge of the real-world system and of the \ninformation that will be extracted from the database is critical. In some circum-\nstances, it may be okay to store data elements with multiple components in a \nsingle column. That can simplify your design and reduce the overall number of \ncolumns. In general, though, most designers divide data elements as much as \npossible. That way, it's easy to accommodate almost any query, and you don't \nhave to change the database design later on when you realize that you need to \nuse just part of a column value.\n\nHovv to design a database \nA name that's divided into first and last names \nVendor sales contact name \nRuben Goldberg \nVendor sales contact first name \nVendor sales contact last name \nRuben \nGoldberg \nAn address that's divided into street address, city, state, and zip code \nVendor address \n1234 West Industrial Way, East Los Angeles, California 90022 \nStreet and number \nCity \nState \nZip \n1234 West Industrial Way \nEast Los Angeles \nCalifornia \nDescription \n• \nIf a data element contains two or more components, you should consider subdi-\nviding the element into those components. That way, you won't need to parse the \nelement each time you use it. \n• \nThe extent to which you subdivide a data element depends on how it will be used. \nBecause it's difficult to predict all future uses for the data, most designers subdivide \ndata elements as much as possible. \n• \nWhen you subdivide a data ele1nent, you can easily rebuild it when necessary by \nconcatenating the individt1al components. \nHow to subdivide the data elements",
          "pages": [
            329,
            330,
            331
          ],
          "relevance": {
            "score": 0.27,
            "sql_score": 0.9,
            "concept_score": 0.2,
            "non_sql_penalty": 0.1,
            "is_relevant": false,
            "analysis": "SQL content"
          }
        }
      },
      "educational_notes": {
        "definition": "Analytic functions are special SQL functions that perform calculations across a set of rows related to the current row. They help in ranking, filtering, and summarizing data within partitions.",
        "explanation": "Analytic functions are essential for complex data analysis tasks where you need to compare values across multiple rows. These functions operate on a window of rows defined by the PARTITION BY clause and sort them using the ORDER BY clause. Key analytic functions include FIRST_VALUE, LAST_VALUE, NTH_VALUE, LEAD, LAG, PERCENT_RANK, and CUME_DIST. They are particularly useful in financial analysis, sales reporting, and any scenario where you need to analyze trends or compare data points over time.",
        "key_points": [
          "Key point 1: Analytic functions operate on a window of rows rather than just the current row.",
          "Key point 2: Use PARTITION BY to divide your data into partitions for analysis.",
          "Key point 3: ORDER BY determines the order in which rows are processed within each partition.",
          "Key point 4: Common mistakes include forgetting to use PARTITION BY, using incorrect ORDER BY clauses, and misunderstanding window frame definitions."
        ],
        "examples": [
          {
            "title": "Basic Usage",
            "code": "-- Get the highest sales for each year\nSELECT sales_year, rep_first_name, rep_last_name, sales_total,\nFIRST_VALUE(sales_total) OVER (PARTITION BY sales_year ORDER BY sales_total DESC) AS highest_sales\nFROM sales_totals JOIN sales_reps ON sales_totals.rep_id = sales_reps.rep_id;",
            "explanation": "This example uses FIRST_VALUE to find the highest sales for each year by comparing sales totals within each partition defined by sales_year."
          },
          {
            "title": "Practical Example",
            "code": "-- Calculate sales change FROM previous year SELECT rep_id, sales_year, sales_total, LAG(sales_total) OVER (PARTITION BY rep_id ORDER BY sales_year) AS last_sales, sales_total - LAG(sales_total) OVER (PARTITION BY rep_id ORDER BY sales_year) AS change FROM sales_totals;",
            "explanation": "This practical example calculates the change in sales from the previous year for each sales representative.",
            "validation_note": "SQL auto-fixed: "
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Forgetting to use PARTITION BY",
            "incorrect_code": "-- Incorrect query without partitioning\nSELECT rep_id, sales_year, sales_total,\nLAG(sales_total) OVER (ORDER BY sales_year) AS last_sales\nFROM sales_totals;",
            "correct_code": "-- Correct query with partitioning\nSELECT rep_id, sales_year, sales_total,\nLAG(sales_total) OVER (PARTITION BY rep_id ORDER BY sales_year) AS last_sales\nFROM sales_totals;",
            "explanation": "This mistake occurs when students try to use LAG or other analytic functions without specifying how the data should be partitioned. Always include PARTITION BY to ensure correct results."
          }
        ],
        "practice": {
          "question": "Write a query that uses the CUME_DIST function to find the cumulative distribution of sales totals for each year in the Sales_Totals table.",
          "solution": "-- Solution using CUME_DIST\nSELECT sales_year, rep_id, sales_total,\nCUME_DIST() OVER (PARTITION BY sales_year ORDER BY sales_total) AS cume_dist\nFROM sales_totals;"
        }
      },
      "llm_enhanced": true,
      "raw_text_preview": "Chapter 9 \nHow to use functions \nThe syntax of the analytic functions \n{FIRST_VALUEILAST_ VALUEINTH_VALUE}(scalar_expression[, numeric_ literal]) \nOVER ([partition_clause) order_clause [frame_ clause)",
      "content_relevance": {
        "score": 0.3,
        "sql_score": 1.0,
        "concept_score": 0.2,
        "non_sql_penalty": 0.1,
        "is_relevant": true,
        "analysis": "SQL content"
      }
    },
    "alter-table-murach": {
      "id": "alter-table-murach",
      "title": "Altering Tables",
      "definition": "ALTER TABLE to add, modify, and drop columns",
      "difficulty": "intermediate",
      "page_references": [
        333,
        334,
        335,
        336,
        337,
        338,
        339,
        340,
        341,
        342,
        343,
        344
      ],
      "sections": {
        "definition": {
          "text": "Hovv to design a database \nPossible tables and columns for an accounts payable system \nVendors \nInvoices \nInvoice line items \nVendor name \nVendor address \nVendor city \nVendor state \nVendor zip code \nVendor phone number \nVendor fax nutuber \nVendor web address \nVendor contact first name \nVendor contact last name \n'Vendor contact phone \nVendor AR first name \nVendor AR last name \nVendor AR phone \nTerms* \nAccount number* \nDescription \nInvoice number* \nInvoice number* \nInvoice date \nItem part number \nTerms* \nItem quantity \nInvoice total \nItem description \nPayment date \nItem unit price \nPaymerit total \nItem extension \nInvoice due date \nAccoun.t nu,nber* \nCredit total \nSequence number \nAccoi,nt number* \n• \nAfter you identify and subdivide all of the data elements for a database, you should \ngroup them by the entities with which they're associated. These entities will later \nbecome the tables of the database, and the elements will become the columns. \n• \nIf a data element relates to more than one entity, you can include it under all of the \nentities it relates to. Then, when you normalize the database, you may be able to \nremove the duplicate elements. \n• \nAs you assign the elements to entities, you should omit elements that aren't needed, \nand you should add any additional elements that are needed. \nThe notation used in this figure \n• \nData elements that were previously identified but aren't needed are crossed out. \n• \nData elements that were added are displayed in italics. \n• \nData elements that are related to two or more entities are followed by an asterisk. \n• \nYou can use a similar notation or develop one of your own. You can also use a \nCASE ( computer-aided software engineering) tool if one is available to you. \nHow to identify the tables and assign columns\n\nSection 3 \nDatabase design and impleme11,tation, \nHow to identify the primary and foreign keys \nOnce you identify the entities and data elements of a system, the next step is \nto identify the relationships between the tables. To do that, you need to identify \nthe primary and foreign keys as shown in figure 10-5. \nAs you know, a primary key is used to uniquely identify each row in a table. \nIn some cases, you can use an existing column as the primary key. For example, \nyou might consider using the vendor_name column as the primary key of the \nVendors table. Because the values for this column can be long, however, and \nbecause it would be easy to enter a value like that incorrectly, that's not a good \ncandidate for a primary key. Instead, you should use an ID column like \nvendor_id that's incremented by one for each new row. \nSimilarly, you 1night consider using the invoice_number column as the \nprimary key of the Invoices table. However, it's possible for different vendors to \nuse the same invoice number, so this value isn't necessarily unique. Becat1se of \nthat, another ID column like invoice_id can be used as the primary key. \nTo uniquely identify the rows in the Invoice_Line_Items table, this design \nuses a composite key. This composite key uses two columns to identify each \nrow. The first column is the invoice_id column from the Invoices table, and \nthe second column is the invoice_sequence column. This is necessary because \nthis table may contain more than one row (line item) for each invoice. And that \nmeans that the invoice_id value by itself may not be unique. \nAfter you identify the primary key of each table, you need to identify the \nrelationships between the tables and add foreign key columns as necessary. In \nmost cases, two tables will have a one-to-many relationship with each other. For \nexample, each vendor can have many invoices, and each invoice can have many \nline items. To identify the vendor that each invoice is associated with, a \nvendor_id column is included in the Invoices table. Because the \nInvoice_Line_Items table already contains an invoice_id column, it's not neces-\nsary to add another column to this table. \nThe diagram at the top of this figure illustrates the relationships I identified \nbetween the tables in the accounts payable system. As you can see, the primary \nkeys are displayed in bold. Then, the lines between the tables indicate how the \nprimary key in one table is related to the foreign key in another table. Here, \na small, round connector indicates the ''one'' side of the relationship, and the \ntriangular connector indicates the ''many'' side of the relationship. \nIn addition to the one-to-many relationships shown in this diagram, you \ncan also use many-to-many relationships and one-to-one relationships. The \nsecond diagram in this figure, for example, shows a many-to-many relation-\nship between an Employees table and a Committees table. As you can see, this \ntype of relationship can be implemented by creating a linking table, also called \na connecting table or an associate table. This table contains the primary key \ncolumns from the two tables. Then, each table has a one-to-many relationship \nwith the linking table. Notice that the linking table doesn't have its own primary \nkey. Because this table doesn't correspond to an entity and because it's used only \nin conjunction with the Employees and Committees tables, a primary key isn't \nneeded.\n\nHovv to design a database \nThe relationships between the tables in the accounts payable system \nvendors \n• \n• \n1nvo1ces \ninvoice line items \n-\nvendor id \ninvoice id \n••----\n◄ invoice id \n-\nvendor name \nvendor address \nvendor_ city \nvendor state \nvendor_zip_code \nvendor_phone \nvendor contact first name \n-\nvendor contact last name \n-\nterms \naccount no \ni.-..a vendor id \ninvoice number \ninvoice date \ninvoice total \npayment_total \ncredit total \nterms \ninvoice due date \n-\npayment_date \naccount no \nTwo tables with a many-to-many relationship \nemployees \nmemberships \ncommittees \n. \n. \n1nvo1ce_sequence \naccount no \nline _item_ description \nitem_quantity \nitem_ unit_price \nline item amount \n-\nemployee_id ••----\n◄ employee_id \nfirst name \ncommittee id \ncommittee id \ncommittee name \n-\nlast name \nLinking table \nTwo tables with a one-to-one relationship \nemployees \nemployee _photos \nemployee_id ••--• employee_id \nfirst_name \nemployee_photo \nlast name \nDescription \n• \nEach table should have a primary key that uniquely identifies each row. If possible, \nyou should use an existing column for the primary key. \n• \nThe values of the primary keys should seldom, if ever, change. The values should \nalso be short and easy to enter correctly. \n• If a suitable column doesn't exist for a p1imary key, you can create an ID column \nthat is incremented by one for each new row as the primary key. \n• If two tables have a one-to-many relationship, you may need to add a foreign key \ncolumn to the table on the ''many'' side. The foreign key column must have the \nsame data type as the primary key colum11 it's related to. \n• If two tables have a many-to-many relationship, you'll need to define a linking \ntable to relate them. Then, each of the tables in the many-to-many relationship will \nhave a one-to-many relationship with the linking table. The linking table doesn't \nusually have a primary key. \n• \nIf two tables have a one-to-one relationship, they should be related by their primary \nkeys. This type of relationship is typically used to improve performance. Then, \ncolumns with large amounts of data can be stored in a separate table. \nHow to identify the primary and foreign keys",
          "pages": [
            333,
            334,
            335
          ],
          "relevance": {
            "score": 0.7,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "examples": {
          "text": "Section 3 \nDatabase design and impleme11,tation, \nThe third example in figure 10-5 illustrates two tables that have a one-to-one \nrelationship. With this type of relationship, both tables have the same primary \nkey, which 1neans that the information could be stored in a single table. This \ntype of relationship is often used when a table contains one or more columns \nwith large amounts of data. In this case, the Employee_Photos table contains a \nlarge binary column with a photo of each employee. Because this column is used \ninfrequently, storing it in a separate table will make operations on the Employees \ntable more efficient. Then, when this column is needed, it can be combined with \nthe columns in the Employees table using a join. \nHow to enforce the relationships between tables \nAlthough the primary keys and foreign keys indicate how the tables in a \ndatabase are related, the database management system doesn't always enforce \nthose relationships automatically. In that case, any of the operations shown in the \ntable at the top of figure 10-6 would violate the referential integrity of the tables. \nIf you deleted a row from a primary key table, for example, and the foreign key \ntable included rows related to that primary key, the referential integrity of the \ntwo tables would be destroyed. In that case, the rows in the foreign key table \nthat no longer have a related row in the primary key table would be orphaned. \nSimilar problems can occur when you insert a row into the foreign key table or \nupdate a pri1nary key or foreign key value. \nTo enforce those relationships and maintain the referential integrity of the \ntables, MySQL provides for declarative referential integrity. To use it, you \ndefine foreign key constraints that indicate how the referential integrity between \nthe tables is enforced. You'll learn more about defining foreign key constraints i11 \nthe next chapter. For now, just realize that these constraints can prevent all of the \noperations listed in this figure that violate referential integrity.\n\nHovv to design a database \nOperations that can violate referential integrity \nThis operation... \nViolates referential integrity if ... \nDelete a row from the primary key table \nThe foreign key table contains one or more rows \nrelated to the deleted row \nInsert a row in the foreign key table \nThe foreign key value doesn't have a matching \nprimary key value in the related table \nUpdate the value of a foreign key \nThe new foreign key value doesn't have a matching \nUpdate the value of a primary key \nrelated to the row that's changed \nDescription \n• \nReferential integrity means that the relationships between tables are maintained \ncorrectly. That means that a table with a foreign key doesn't have rows with foreign \nkey values that don't have matching primary key values in the related table. \n• \nIn MySQL, you can enforce referential integrity by using declarative referential \nintegrity. \n• \nTo use declarative t·eferential integrity (DRI), you define foreign key constraints. \nYou'll learn how to do that in the next chapter. \n• \nWhen you define foreign key constraints, you can specify how referential integrity \nis enforced when a row is deleted from the primary key table. The options are \nto return an error, to delete the related rows in the foreign key table, or to set the \nforeign key values in the related rows to null. \n• \nIf referential integrity isn't enforced and a row is deleted from the primary key \ntable that has related rows in the foreign key table, the rows in the foreign key table \nare said to be orphaned. \nHow to enforce the relationships between tables\n\nSection 3 \nDatabase design and impleme11,tation, \nHow normalization works \nThe next step in the design process is to review whether the data structure is \nnormalized. To do that, you look at how the data is separated into related tables. \nIf you follow the first four steps for designing a database that are presented in \nthis chapter, your database will already be partially normalized when you get to \nthis step. However, almost every design can be normalized further. \nfigure show some of the problems caused by an unnormalized data structure. \nIn the first table, you can see that each row represents an invoice. Because an \ninvoice can have one or more line items, however, the item_description column \nmust be repeated to provide for the maximum number of line items. But since \nmost invoices have fewer line items than the maximum, this can waste storage \nspace. \nIn the second table, each line item is stored in a separate row. That elimi-\nnates the problem caused by repeating the item_description column, but it \nintroduces a new problem: the vendor name and invoice number must be \nrepeated in each row. This, too, can cause storage problems, particularly if a \nrepeated column is large. In addition, it can cause maintenance problems if a \ncolumn contains a value that's likely to change. Then, when the value changes, \neach row that contains the value must be updated. And if a repeated value n1ust \nbe reentered for each new row, it would be easy for the value to vary from one \nrow to another. \nTo eliminate the problems cat1sed by data redundancy, you can normalize \nthe data structure. To do that, you apply the normal forms you '11 learn about \nlater in this chapter. As you'll see, there are a total of seven normal forms. \nHoweve1·, it's common to apply only the frrst three. The diagram in this figure, \nfor example, shows the accounts payable system in third normal form. Although \nit may not be obvious at this point how this reduces data redundancy, that will \nbecome clearer as you learn about the different normal forms.\n\nHovv to design a database \nA table that contains repeating columns \nvendor _name \nlnvoice_number \nit:em_desaipbon_ 1 \nitem_desoiptlon_2 \nitem_desaiption_3 \n► \nCahners Publishing \nAndroid ad \nMySQLad \nLibrary directory \nZylka Design \n97/552 \nCatalogs \nMySQL flyer \nUWII \nZylka Design \n97/ SSE \nCard revision \nHL'!l!I \nHtm!I \nA table that contains redundant data \nvendor name \nlnv01ce number \nitem_descrtption \n► \nCahners Publishing \nAndroid ad \nCahners Publishing \nMySQLad \nCahners Publishing \nLibrary directory \nZylka Design \n97/522 \nCatalogs \nZylka Design \n97/522 \nMySQL flyer \nZylka Design \n97/53E \nCard revision \n--\n.,,,. \n~ \n~ \nThe accounts payable system in third normal form \nvendors \nvendor id \nvendor name \nvendor address \nvendor_ city \nvendor state \nvendor_zip _code \nvendor_phone \nvendor contact first name \n-\nvendor contact last name \n-\ndefault terms id \n-\ndefault account no \n-\nDescription \n' \n• \n• \n1nvo1ces \ninvoice id \nvendor id \ninvoice number \ninvoice date \ninvoice total \npayment_ tota I \ncredit total \nterms id \ninvoice due date \n-\npayment_date \nterms \nterms id \nterms_ description \nterms_due_days \ninvoices line items \n-\n••----◄ invoice _id \n. \n. \n1nvo1ce_sequence \naccount no \nline item amount \n-\nline_item_ description \ngeneral_ledger_accounts \naccount no \naccount_ description \n• \nNormalization is a formal process you can use to separate the data in a data struc-\nture into related tables. Normalization reduces data redundancy, which can cause \nstorage and maintenance problems. \n• \nIn an unnormalized data structure, a table can contain information about two or \nmore entities. It can also contain repeating columns, columns that contain repeating \nvalues, and data that's repeated in two or more rows. \n• \nIn a normalized data structure, each table contains information about a single \nentity, and each piece of inforrnation is stored in exactly one place. \n• \nTo normalize a data structure, you apply the normal forms in sequence. Although \nthere are a total of seven normal forms, a data structure is typically considered \nnormalized if the first three nor1nal forms are applied. \nHow normalization works \n.\n\nSection 3 \nDatabase design and impleme11,tation, \nHow to identify the columns to be indexed \nThe last step in the design process is to identify the columns that shot1ld \nbe indexed. An index is a structure that provides for locating one or more rows \ndirectly. Without an index, a database management system has to perform a table \nscan, which involves searching through the entire table. \nJust as the index of a book has page numbers that direct you to a specific \nsubject, a database index has pointers that direct the system to a specific row. \nThis can speed performance not only when you're searching t·or rows based on a \nsearch condition, but also when you're joining data from tables. If a join is done \nbased on a primary key to foreign key relationship, for example, and an index \nis defined for the foreign key column, the database management system can use \nthat index to locate the rows for each primary key value. \nWhen you use MySQL, an index is automatically created for the primary \nand foreign keys in each table that you create. But you should consider creating \nindexes for other columns in some of the tables based on the guidelines at the \ntop of figure 10-8. \nTo start, you should index a column if it will be used frequently in search \nconditions or joins. The column should also contain mostly distinct values, and \nthe val11es in the column should be updated infrequently. If these conditions \naren't met, the overhead of maintaining the index will probably outweigh the \nadvantages of using it. \nWhen you create indexes, you should be aware that MySQL must update \nthe indexes whenever you add, update, or delete rows. Because that can affect \nperformance, you don't wa11t to define more indexes than you need. \nAs you identify the indexes for a table, keep in mind that, like a key, \nan index can consist of two or 1nore columns. This type of index is called a \ncomposite index.\n\nHovv to design a database \nWhen to create an index \n• \nWhen the column is used freqt1ently in search conditions or joins \n• \nWhen the column contains a large number of distinct values \n• \nWhen the column is updated infrequently \nDescription \n• \nMySQL automatically creates an index for primary and foreign keys. \n• \nAn index provides a way for a database management system to locate information \nmore quickly. When it uses an index, the database management syste1n can go \ndirectly to a specific row rather than having to search through all the rows until it \nfinds it. \n• \nIndexes speed performance when searching and joining tables. \n• \nYou can create composite indexes that include two or more columns. You should \nuse this type of index when the columns in the index are updated infrequently or \nwhen the index covers almost every search condition on the table. \n• \nBecause indexes must be updated each time you add, update, or delete a row, you \nshouldn't create more indexes than you need. \nHow to identify the columns to be indexed",
          "pages": [
            336,
            337,
            338,
            339,
            340,
            341
          ],
          "relevance": {
            "score": 0.7,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "commonMistakes": {
          "text": "Section 3 \nDatabase design and impleme11,tation, \nHow to nor111alize a data structure \nThe topics that follow describe the seven normal forms and teach you how to \napply the first three. As I said earlier, you apply these three forms to some extent \nin the first four database design steps, but these topics will give you more insight \ninto the process. Then, the last topic explains when and how to denormalize \na data structure. When you finish these topics, you' 11 have the basic skills for \ndesigning databases that are efficient and easy to use. \nThe seven normal forms \nthat the previous forms have already been applied. Before you can apply the \nthird normal form, for example, the design must already be in the second normal \nform. \nStrictly speaking, a data structure isn't normalized until it's in the fifth or \nsixth normal form. However, the normal forms past the third normal form are \napplied infrequently. Because of that, I won't present those forms in detail here. \nInstead, I'll just describe them briefly so you'll have an idea of how to apply \nthem if you need to. \nThe Boyce-Codd normal form can be used to eliminate transitive \ndependencies. With this type of dependency, one column depends on another \ncolumn, which depends on a third coltunn. To illustrate, consider the city, state, \nand zip code columns in the Vendors table. Here, a zip code identifies a city and \nstate, which means that the city and state are dependent on the zip code. The zip \ncode, in turn, is dependent on the vendor_id column. To eliminate this depen-\ndency, you cottld store the city and state values in a separate table that uses zip \ncode as its primary key. \nThe fourth normal form can be t1sed to eliminate multiple multivalued \ndependencies from a table. A multivalued dependency is one where a primary \nkey column has a one-to-many relationship with a non-key column. To illustrate, \nconsider the vendor contact phone number in the Vendors table. If you wanted \nto accommodate alternate phone nt1mbers, such as a cellular or home phone, \nyou could add extra columns for each type of number. However, this creates a \nmultivalued dependency between the phone numbers and the vendor_id. To be in \nfourth normal fonn, therefore, you'd need to store phone numbers in a separate \ntable that uses vendor_id as a foreign key. \nTo apply the fifth normal form, you continue to divide the tables of the \ndata structure into smaller tables until all redundancy has been removed. When \nfurther splitting would result in tables that couldn't be used to reconstruct the \noriginal table, the data structure is in fifth normal form. In this form, most tables \nconsist of little more than key columns with one or two data elements. \nThe domain-key normal form, sometimes called the sixth normal form, is \nonly of academic interest since no database system has implemented a way to \napply it. For this reason, even normalization purists might consider a database to \nbe normalized in fifth normal form.\n\nHovv to design a database \nThe seven normal forms \nNormal form \nDescription \nFirst (lNF) \nSecond (2NF) \nThird (3NF) \nBoyce-Codd (BCNF) \nFourth ( 4NF) \nFiftl1 (5NF) \nDomain-key (DK.NF) \nor \nSixth (6NF) \nThe value stored at the intersection of each row and column must be a scaJar \nvalue, and a table must not contain any repeating columns. \nEvery non-key column must depend on the entire primary key. \nEvery non-key column must depend only on the primary key. \nA non-key column can' t be dependent on another non-key colu1nn. This \nprevents transitive dependencies, where column A depends on column C and \ncolumn B depends on column C. Since both A and B depend on C, A and B \nshouJd be moved into another table with C as the key. \nA table must not have more than one ,nultivalued dependency, where the \nprimary key has a one-to-many relationslrip to non-key columns. This form \ngets rid of misleading many-to-many relationships. \nThe data structure is split into smaller and smaller tables until all redundancy \nhas been elinrinated. If further splitting would result in tables that couldn't be \njoined to recreate the original table, the structure is in fifth normal form. \nEvery constraint on the relationship is dependent only on key constraints \nand domain constraints, where a doma.in is the set of allowable values for a \ncolumn. This form prevents the insertion of any unacceptable data by \nenforcing constraints at the level of a relationship, rather than at the table or \ncolumn level. DKNF is less a design model than an abstract ''ultimate\" \nnormal form. \nThe benefits of normalization \n• \nSince a normalized database has more tables than an unnormalized database, and \nsince each table has an index on its primary key, the database has more indexes. \nThat makes data retrieval more efficient. \n• \nSince each table contains information about a single entity, each index has fewer \ncolumns (usually one) and fewer rows. That makes data retrieval and insert, update, \nand delete operations more efficient. \n• \nEach table has fewer indexes, which makes insert, update, and delete operations \nmore efficient. \n• \nData redundancy is minimized, which simplifies maintenance and reduces storage. \nDescription \n• \nEach normal form assumes that the design is already in the previous normal form. \n• \nA database is typically considered to be normalized if it is in third nor1nal form. \nThe other four forms are not commonly used and are not covered in detail in this \nbook. \nThe seven normal forms",
          "pages": [
            342,
            343
          ],
          "relevance": {
            "score": 0.8,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.0,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        }
      },
      "educational_notes": {
        "definition": "Altering tables is the process of changing an existing database table's structure, such as adding new columns, removing existing ones, or modifying column properties.",
        "explanation": "When designing a database, it's crucial to have well-structured tables that accurately represent your data. However, real-world requirements often change, necessitating alterations to these tables. Altering tables allows you to make these necessary changes without losing the integrity of your existing data. Here’s how it works and when to use it.",
        "key_points": [
          "Key point 1: Most important thing to remember is that altering tables can be done using SQL commands like ALTER TABLE.",
          "Key point 2: Critical detail about usage is understanding the specific command needed for each alteration, such as ADD, DROP, or MODIFY.",
          "Key point 3: Common pitfall to avoid is forgetting to back up your data before making alterations, which could lead to loss of information if something goes wrong.",
          "Key point 4: Best practice or tip is to always test ALTER TABLE commands on a backup copy of your database first to ensure they work as expected.",
          "Key point 5: How this connects to other concepts is that altering tables is closely related to database design and normalization, ensuring that the structure remains efficient and effective over time."
        ],
        "examples": [
          {
            "title": "Basic Usage",
            "code": "-- Adding a new column ALTER TABLE Vendors ADD COLUMN vendor_email VARCHAR(255);",
            "explanation": "This example demonstrates how to add a new column 'vendor_email' to the 'Vendors' table. It's useful when you need to store additional contact information for vendors.",
            "validation_note": "SQL auto-fixed: "
          },
          {
            "title": "Practical Example",
            "code": "-- Modifying an existing column ALTER TABLE Invoices MODIFY COLUMN invoice_total DECIMAL(10, 2);",
            "explanation": "This practical example shows how to change the data type of 'invoice_total' in the 'Invoices' table to a more precise decimal format. This is important for financial calculations.",
            "validation_note": "SQL auto-fixed: "
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Using the wrong command",
            "incorrect_code": "-- Incorrect command ALTER TABLE Vendors ADD vendor_phone;",
            "correct_code": "-- Correct command ALTER TABLE Vendors ADD COLUMN vendor_phone VARCHAR(15);",
            "explanation": "The mistake here is not specifying the data type for the new column. Always include the correct data type to ensure the column functions properly."
          }
        ],
        "practice": {
          "question": "Create a practical question that tests understanding of this concept",
          "solution": "Provide a clear solution with explanation"
        }
      },
      "llm_enhanced": true,
      "raw_text_preview": "Hovv to design a database \nPossible tables and columns for an accounts payable system \nVendors \nInvoices \nInvoice line items \nVendor name \nVendor address \nVendor city \nVendor state \nVendor zip code \nV",
      "content_relevance": {
        "score": 0.7,
        "sql_score": 1.0,
        "concept_score": 1.0,
        "non_sql_penalty": 0.1,
        "is_relevant": true,
        "analysis": "SQL content"
      }
    },
    "constraints-murach": {
      "id": "constraints-murach",
      "title": "Constraints",
      "definition": "PRIMARY KEY, FOREIGN KEY, UNIQUE, CHECK, and NOT NULL",
      "difficulty": "intermediate",
      "page_references": [
        345,
        346,
        347,
        348,
        349,
        350,
        351,
        352,
        353,
        354,
        355,
        356,
        357,
        358
      ],
      "sections": {
        "definition": {
          "text": "Hovv to design a database \nThe invoice data with a column that contains repeating values \nvendor _name \nlnvoice_number \nit:em_desaipbon \n► \nCahners Publishing \nAndroid ad, MySQL ad, Library directory \nZylka Design \n97/522 \nCatalogs, MySQL Flyer \nZylka Design \n97/ 5-n:3 \nCard revision \nThe invoice data with repeating columns \nvendor_name \ninvotce number \nitem_c:lesaiption_l \nitem_desaiption_2 \nltem_c:lescription_ 3 \n► Cahners Pubfishing \nAndroid ad \nMySQLad \nLibrary directory \nZylka Design \n97/552 \nCatalogs \nMySQL flyer \ncm,, \nZyfka Design \n97/ SSE \nCard revision \nIH~!I \nw•l!I \n= \n= \nThe invoice data in first normal form \nvendor _name \ninvoice_number \n,tern_ descnption \n► \nCahners Publishing \nAndroid ad \nCahners Publishlng \nMySQLad \nCahners Publishing \nLibrary directory \nZylka Design \n97/5-22 \nCatalogs \nZylka Design \n97/522 \nMySQL flyer \nZyikaDeslgn \n97/5338 \nCard revision \n= \nDescription \n• \nFor a table to be in first normal for1n, its columns must not contain repeating \nvalues. Instead, each column must contain a single, scalar value. In addition, the \ntable must not contain repeating columns that represent a set of values. \n• \nA table in first normal form often bas repeating valt1es in its rows. This can be \nresolved by applying the second normal form.\n\nSection 3 \nDatabase design and impleme11,tation, \nHow to apply the second normal form \nnormal form, every column in a table that isn't a key column must be dependent \non the entire primary key. This form only applies to tables that have composite \nprimary keys, which is often the case when you start with data that is completely \nunnormalized. The table at the top of this figure, for example, shows the invoice \ndata in first normal form after key columns have been added. In this case, the \nprimary key consists of the invoice_id and invoice_sequence columns. The \ninvoice_sequence column is needed to uniquely identify each line item for an \n• \n• \n1nvo1ce. \nNow, consider the three non-key columns shown in this table. Of these \nthree, only one, item_description, depends on the entire primary key. The other \ntwo, vendor_name and invoice_number, depend only on the invoice_id column. \nBecause of that, these columns should be moved to another table. The result is a \ndata st1-ucture like the second one shown in this figure. Here, all of the info1ma-\ntion related to an invoice is stored in the Invoices table, and all of the inf orma-\ntion related to an individual line item is stored in the Invoice Line Items table. \n-\nNotice that the relationship between these tables is based on the invoice_id \ncolumn. This colt1mn is the primary key of the Invoices table, and it's the foreign \nkey in the Invoice_Line_Items table that relates the rows in that table to the \nrows in the Invoices table. This column is also part of the primary key of the \nInvoice Line Items table. \nWhen you apply second nor1r1al form to a data structure, it eliminates some \nof the redundant row data in the tables. In this figure, for example, you can see \nthat the invoice number and vendor name are now included only once for each \ninvoice. In fu·st normal form, this information was included for each line item.\n\nHovv to design a database \nThe invoice data in first normal form with keys added \ninvoicejd \nvendor _name \ninvoice _number \ninvoice_sequence \nitem_desaiption \n► \nCahners Publishing \nAndroid ad \nCahners Pubishing \nMySQLad \nCahners Publishing \nl.Jbrary directory \nZylka Design \n97/522 \ncatalogs \nZylka Design \n97/522 \nMySQL flyer \nZylka Design \n97/5338 \nCard revision \n: \nThe invoice data in second normal form \nI \ninvoice_id \ninvoice _number \nvendor _name \n► \nCahners Publishing \n97/522 \nZylka Design \n97/5338 \nZylka Design \n' \ninvoice_id \n• \ninv01ce _sequence \nitem_description \n► \nAndroid ad \nMySQLad \nLibrary directcry \ncatalogs \nMySQL flyer \nCard revision \nDescription \n• \nFor a table to be in second nonnal form, every non-key column must depend on the \nentire primary key. If a column doesn't depend on the entire key, it indicates that \nthe table contains information for more than one entity. This can happen if the table \ncontains a composite primary key. \n• \nTo apply second normal form, you move columns that don't depend on the entire \nprimaiy key to another table and then establish a relationship between the two \ntables. \n• \nSecond normal form helps remove redundant row data, which can save storage \nspace, make maintenance easier, and reduce the chance of storing inconsistent data. \nHow to apply the second normal form \n.,\n\nSection 3 \nDatabase design and impleme11,tation, \nHow to apply the third normal form \nTo apply the third normal for111, you make sure that every non-key column \ndepends orily on the primary key. Figure 10-12 illustrates how you can apply \nthis form to the data structure for the accounts payable system. At the top of this \nfigure, you can see all of the columns in the Invoices and Invoice_Line_Items \ntables in second normal form. Then, you can see a list of questions that you \nmight ask about some of the columns in these tables when you apply third \nnormal form. \nFirst, does the vendor infom1ation depend only on the invoice_id column? \nAnother way to phrase this question is, ''Will the information for the same \nvendor change from one invoice to another?'' If the answer is no, the vendor \ninformation should be stored in a separate table. That way, can you be sure \nthat the vendor information for each invoice for a vendor will be the same. In \nadctition, you will reduce the redundancy of the data in the Invoices table. This is \nillustrated by the diagram in this figure that shows the accounts payable system \nin third normal form. Here, a Vendors table l1as been added to store the informa-\ntion for each vendor. This table is related to the Invoices table by the vendor_id \ncolumn, which has been added as a foreign key to the Invoices table. \nSecond, does the terms column depend only on the invoice_id column? The \nanswer to that question depends on how this column is used. In this case, I'll \nassume that this column is used not only to specify the terms for each invoice, \nbut also to specify the default terms for a vendor. Because of that, the terms \ninforn1ation could be stored in both the Vendors and the Invoices tables. To avoid \nredundancy, however, the information related to different terms can be stored in \na separate table, as illustrated by the Terms table in this figure. As you can see, \nthe primary key of this table is an auto increment column named terms_id. Then, \na foreign key column named default_terms_id has been added to the Vendors \ntable, and a foreign key column named terrns_id has been added to the Invoices \ntable. \nThird, does the account_no column depend only on the invoice_id column? \nAgain, that depends on how this column is used. In this case, it's used to \nspecify the general ledger account number for each line item, so it depends on \nthe invoice_id and the invoice_sequence columns. In other words, this column \nshould be stored in the lnvoice_Line_Items table. In addition, each vendor has a \ndefault account number, which should be stored in the Vendors table. Because of \nthat, another table named General_Ledger_Accounts has been added to store the \naccount numbers and account descriptions. Then, foreign key columns have been \nadded to the Vendors and Invoice Line Items tables to relate them to this table. \n-\nFourth, can the invoice_due_date column in the Invoices table and the \nline_item_amot1nt column in the Invoice_Line_Items table be derived from other \ndata in the database? If so, they depend on the columns that contain that data \nrather than on the primary key columns. In this case, the value of the \nline_item_amount column can always be calculated from the item_quantity \nand item_unit_price columns. Because of that, this column could be omitted. \nAlte1natively, you could omit the ite1n_quantity and item_unit_price columns",
          "pages": [
            345,
            346,
            347,
            348
          ],
          "relevance": {
            "score": 0.45,
            "sql_score": 1.0,
            "concept_score": 0.5,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "examples": {
          "text": "Hovv to design a database \nThe accounts payable system in second normal form \n• \n• \n1nvo1ces \ninvoice line items \n-\ninvoice id \n••--4\n◄ invoice id \nvendor name \nvendor address \nvendor_ city \nvendor state \nvendor_zip _ code \nvendor_phone \nvendor contact first name \n-\nvendor contact last name \n-\ninvoice number \ninvoice date \ninvoice total \npayment_total \ncredit total \nterms \ninvoice due date \n-\npayment_date \naccount no \nQuestions about the structure \n. \n. \n1nvo1ce_sequence \naccount no \nline _item_ description \nline _item_ quantity \nline _item_ unit_price \nline item amount \n-\n1. Does the vendor information (vendor_name, vendor_address, etc.) depend only \non the invoice id column? \n2. Does the terms column depend only on the invoice_id column? \n3. Does the account_no column depend only on the invoice_id column? \n4. Can the invoice due date and line item amount columns be derived from \nother data? \nThe accounts payable system in third normal form \nvendors \nvendor id \nvendor name \nvendor address \nvendor_city \nvendor state \nvendor_zip _code \nvendor_phone \nvendor contact first name \n-\nvendor contact last name \n-\ndefault terms id \n-\ndefault account no \n-\nDescription \n• \n• \n1nvo1ces \ninvoices line items \n-\ninvoice id \n••-----\n◄ invoice id \n-\nL...-4 vendor id \ninvoice number \ninvoice date \ninvoice total \npayment_ total \ncredit total \nterms id \ninvoice due date \n-\npayment_ date \nterms \nterms id \nterms_ description \nterms_ due_ days \n. \n. \n1nvo1ce_ sequence \n,--◄ account no \nline item amount \n-\nline _item_ description \ngeneral_ledger_accounts \naccount no \naccount_ description \n• \nFor a table to be in third normal form, every non-key column must depend only on \nthe primary key. \n• \nIf a column doesn't depend only on the primary key, it implies that the colu1nn is \nassigned to the wrong table or that it can be computed from other columns in the \ntable. A column that can be computed from other columns contains derived data. \nHow to apply the third normal form\n\nSection 3 \nDatabase design and impleme11,tation, \nand keep just the line_item_amount column. That's what I did in the data struc-\nture shown in this figure. The solution you choose, however, depends on how the \ndata will be used. \nIn contrast, although the invoice_due_date column could be calculated from \nthe invoice_date column in the Invoices table and the terms_due_days column \nin the related row of the Terms table, the system also allows this date to be \noverridden. Because of that, the invoice_due_date column should not be omitted. \nIf the system didn't allow this value to be overridden, however, this column \ncould be safely omitted. \nWhen and how to denormalize a data structure \nDenormalization is the deliberate deviation from the normal forms. Most \ndenormalization occurs beyond the third normal form. In contrast, the first three \nnormal forms are almost universally applied. \nTo illustrate when and how to denormalize a data structure, figure 10-13 \npresents the design of the accounts payable system in fifth normal form. Here, \nthe vendor zip codes are stored in a separate table that contains the city and \nstate for each zip code. In addition, the area codes are stored in a separate table. \nBecause of that, a query that retrieves vendor addresses and phone numbers \nwould require two joins. In contrast, if you left the city, state, and area code \ninformation in the Vendors table, no joins would be required, but the Vendors \ntable would be larger. \nIn general, you should denormalize based on the way the data will be used. \nIn this case, we'll seldom need to query phone numbers without the area code. \nLikewise, we'll seldo1n 11eed to query city and state without the zip code. For \nthese reasons, I've denormalized my design by eliminating the Zip_Codes and \nArea Codes tables. \nYou might also consider denormalizing a table if the data it contains \nis updated infrequently. In that case, redundant data isn't as likely to cause \nproblerns. \nFinally, you should consider including derived data in a table if that data is \nused ft·equently in search conditions. For example, if you frequently query the \nInvoices table based on invoice balances, you might consider including a column \nthat contains the balance due. That way, you won't have to calculate this value \neach time it's queried. Keep in mind, though, that if you store derived data, it's \npossible for it to deviate from the derived value. For this reason, you may need \nto protect the derived column so it can't be updated directly. Alternatively, you \ncould update the table periodically to reset the value of the derived column. \nBecause normalization eliminates the possibility of data redundancy errors \nand optimizes the use of storage, you should carefully consider when and how to \ndenormalize a data structure. In general, you should denormalize only when the \nincreased efficiency outweighs the potential for redundancy errors and storage \nproblems. Of course, your decision to denor1nalize should also be based on your \nknowledge of the real-world environment in which the system will be used. If \nyou've carefully analyzed the real-world environment as outlined in this chapter, \nyou'll have a good basis for making that decision.\n\nHovv to design a database \nThe accounts payable system in fifth normal form \nvendors \nvendor id \nvendor name \nvendor address \nvendor_zip_code \n,..... vendor area code id \n' \n-\nvendor_phone \nvendor contact first name \n-\nvendor contact last name \n-\ndefault terms id \n-\ndefault account no \n-\nzip_codes \nzip_codes \ncity \nstate \narea codes \narea code id \n-\narea code \nWhen to denormalize \n• \n• \n1nvo1ces \ninvoice line items \n-\ninvoice_id \n••----\n◄ invoice_id \nvendor id \ninvoice number \ninvoice date \ninvoice total \npayment_ tota I \ncredit total \n......--4 terms id \ninvoice due date \n-\npayment_ date \nterms \nterms id \nterms_description \nterms_due_days \n. \n. \n1nvo1ce_sequence \n~~ \naccount no \nline_item_qty \nline _item_ unit_price \n..... line_item_description_id \nline_item_descriptions \nline_item_description_id \nline_ item_ description \ngeneral_ledger_accounts \naccount no \naccount_ description \n• \nWhen a column from a joined table is used repeatedly in search criteria, you should \nconsider moving that column to the primary key table if it will eliminate the need \nfor a join. \n• \nIf a table is updated infrequently, you should consider denormalizing it to improve \nefficiency. Because the data remains relatively constant, you don't have to worry \nabout data redundancy errors once the initial data is entered and verified. \n• \nIncl11de columns with derived values when those values are used frequently in \nsearch conditions. If yo11 do that, you need to be sure that the column value is \nalways synchronized with the value of the columns it's derived from. \nDescription \n• \nData structures that are normalized to the fourth normal form and beyond typically \nrequire more joins than tables normalized to the third normal fo1m and can there-\nfore be less efficient. \n• \nMySQL statements that work with tables that are normalized to the fourth normal \nfor111 and beyond are typically more difficult to code and debug. \n• \nMost designers denormalize data structures to some extent, usually to the third \nnormal form. \n• \nDenormalization can result in larger tables, redundant data, and reduced \nperformance. \n• \nOnly denormalize when necessary. It is better to adhere to the normal forms unless \nit is clear that perfor111ance will be improved by deno1m alizing. \nWhen and how to denormalize a data structure\n\nSection 3 \nDatabase design and impleme11,tation, \nHow to use MySQL Workbench \nfor database design \nWhen you're ready to create a database diagram, it usually makes sense to \nuse a tool that's specifically designed for that purpose. Fortunately, dozens of \ntools for designing databases are available. This topic introduces you to one of \nthem: MySQL Workbench. \nMySQL Workbench makes it easy to create one or more database diagrams \nfrom an enhanced entity-relationship model (EER model). This model extends \nthe original entity-relationship model (ER mode[). In addition, you can create a \nvisual representation of an EER model by creating one or more EER diagrams \nfrom that model. \nWhen working with MySQL Workbench, you can generate an EER model \nfrom an existing MySQL database or SQL creation script. Conversely, you can \ngenerate a SQL creation script from an EER model. This makes it easy to imple-\nment your design when you're done with it. \nHow to open an existing EER model \nWhen you start MySQL Workbench, it displays the Welcome tab of the \nHome page. To work with EER models, you can display the Models tab that's \nshown in figure 10-14. Then, you can open an existing EER model that was \ncreated with MySQL Workbench. If you opened the model recently, it should \nbe displayed in the list of recently opened models. In this figure, for example, \ntwo models are shown in this list. One is named OM, and the other is named AP. \nThen, you can open the model by clicking on it. If the model you want to open \nisn't displayed in this list, you can click the @ icon to the right of the Models \nheading and use the resulting dialog box to select the ftle for the model. \nHow to create a new EER model \nIf you're designing a new database from scratch, you can create a model that \ndoesn't contain any tables. To do that, you can click the® icon to the right of \nthe Models heading. Then, you can add tables to the model as shown in the next \nfigure. \nIf you 're redesigning an existing database, you can start by creating a \nmodel from that database. To do that, you can click the 0 icon to the right of \nthe Models heading and select the ''Create EER Model from Database'' item. \nThen, you can use the resulting dialog boxes to connect to the server and select a \ndatabase. When you do, MySQL Workbench creates a model and a diagran1 that \nincludes all of the tables and columns of the selected database. \nIf you don't have access to the database but you have access to the script \nthat creates it, you can create a model from that script. To do that, you can click \nthe 0 icon to the right of the Models heading and select the ''Create EER Model \nfrom Script'' iten1. Then, you can use the resulting dialog box to select the script \nfile.\n\nHovv to design a database \nThe Models tab of the MySQL Workbench Home page \n■ \nMySQl. Workbench \nD \nX \nFile \nEdit \nView \nDatabase \nT DOis \nScripting \nHelp \nModels 0@ 0 \nom \nap \nc::I \nC;\\mur~ch\\mysql \nc::l \nC:\\mu~ch\\mysql \n_ \nom \nap \n12 Dec 18, 12:28 \n12 Dec 18, 10:48 \nDescription \n• \nMySQL Workbench allows you to create an enhanced entity-relationship 1nodel \n(EER niodel). This type of model extends the original entity-relationship model (ER \nmodel). \n• \nOnce you have created or opened an EER model, you can work with one or 1nore \nEER diagrams· that are associated with that model. \n• \nTo open a recently used existing EER model, click on the model in the list of \nmodels. \n• \nTo open any EER model, click the@) icon to the right of the Models heading, or \nselect the File➔Open Model item. Then, use the resulting dialog box to select the \nfile for the model. \n• \nTo create a new EER model that's blank, click the ® icon to the right of the Models \nheading, or select the File➔ New Model item. \n• \nTo create an EER model from an existing database, click the 0 icon to the right of \nthe Models heading, select the ''Create EER Model fi·om Database'' item, and use \nthe resulting dialog boxes to connect to the server and select the database. \n• \nTo create an EER model from a SQL creation script, click the 0 icon to the right of \nresulting dialog box to select the script file. \n• \nTo remove an existing model from the list of recently used models, right-click on \nthe model and select the ''Remove Model File from List'' item. \nHow to create and open an EER model\n\nSection 3 \nDatabase design and impleme11,tation, \nHow to work with an EER model \nthe MySQL Model tab for the AP database. From this tab, you can work with the \ntables of the database. \nTo edit one of these tables, you can double-click on it. When you do, \nMySQL Workbench displays a tab for the table at the bottom of the window. \nWithin this tab are additional tabs that you can use to modify the columns, \nindexes, and foreign keys for the table. For example, this figure shows the \nColumns tab for the Vendors table. From this tab, you can modify the names, \ndata types, and other attributes of the columns. You can also add a new column \nby entering the information for the column at the bottom of the table. And, you \ncan modify the name of the table. \nIf you want to add a table to the model, you can double-click on the Add \nTable icon. Then, you can edit the table to set its name, columns, indexes, and \nforeign keys. You'll learn more about how to do that in the next chapter. Or, if \nyou want to remove a table from the model, you can right-click on the table and \nselect the Delete i tern. \nSince you typically begin designing a database by creating the tables of the \ndatabase, this figt1re focL1ses on how to work with tables. However, you can use \nsimilar skills to work with other database objects that are stored in the model, \nsuch as views and stored programs. \nSince it's usually easier to work with a visual representation of the model, \nyou can open a diagram that corresponds with the model. As yot1'll see in the \nnext figure, this can make it easier to see the relationships between tables. When \nyou work with a diagram, some changes that you make affect the corresponding \nmodel. As a result, you can think of working with a diagram as a more visual \nway of working with the model. \nWhen you create or open a model, the diagram for the model is displayed \nby default. If you close the tab for the diagram, however, you can open it again \nby double-clicking on the name of the diagram. In this figure, for example, the \nmodel for the AP database contains a diagram named EER Diagram. For small \ndatabases, you may only need a single diagram like this. However, for larger \ndatabases, you may need to create multiple diagrams that provide ways to view \ndifferent parts of the database. To create a new diagram for the model, you can \ndouble-click the Add Diagram icon. Then, the diagram is given a name such as \nEER Diagram 1, EER Diagram 2, and so on. \nWhen you 're done creating your model, you can create a MySQL \ndatabase creation script from the diagram. To do that, you can select the \nFile➔ \nExport➔ Forward Engineer SQL CREATE Script item. Then, you can \nimplement your design by using MySQL Workbench to run the script. This \ncreates the database that corresponds to the model.\n\nHovv to design a database \nThe EER model for the AP database \n■ \nMySQl Workbench \nD \nX \nMySOL Model\" (ap.ln'Nb) \"' \nEER Dai,am \n>< \nRle \nEdit \nVtf!Nf \nArrange \nModel \nDatabase \nT cols \nScripting \nHelp \nIJ□ \nDescnllbot' Ea,toi \nvendcn: MySQL Table \nV \nMooel C>,et111eA \n¢ \n--' \nAdd Diagram \nEER CXagam \nY Physical Schemas \nTables ,.. .-,, \no Add Table \n~ \ntenns \nViews , \" tems \ngeneral_ledget _acco .•. J lnVOICe _archive \nvendor_cantac:ts \n::J vendm \n••• = \n::: = + -\nG \nlnVOiee_lne_ilef!\\$ \n:J Invoices \nV \n-----------------\nDescnpbon \n!;-\nTablcName: ~s \nSchema: \nap \nColurmNamc \nDatatype \nPK \ni'N \nUQ \nB \nl.l'l \n\"ZF \nAl \nG \nOefaJ~ \nType \nOefmion \nFla, \n< \n> \nUser T ypn \nHisll:lry \nReady \nDescription \nvcndor_td \nINT(ll) \nvendor_name \nVARCHAR(SO) \nvendor_addrcssl \nVARCHAR(SO) \nvendor _addri!5S2 \nVARCHAR(SO) \nC-OlumName: \nCllarsct/Colation: \nr \nO\"aa!U!t \n!.'L~t t'\"ol:3!!0<\\ \nComments: \n0 0 D D D D 0 \nD \n□ 0 \n□ D D □ □ \n□ D □ □ D □ D D \nNUU \n□ □ D □ □ □ □ D \nNULL \n-\n-\n-\n-\nData Type: \nOefaJt: \nStxnvc: \nVirtual \nStored \nNo-ttu \nl..hslQncd \nPmwy~y \n£lirwy \nAuto lncrenent \n~ated \nColumns \nIndeces \nForelgn Keys \nTriggers \nPart,tlomng \nOptions \nInserts \nPnvilegcs \n• \nAn EER model is a representation of the entities, or objects, of the database \nincluding the tables, views, and stored programs. \nUnique \nZero AI \n• \nTo edit a table, double-click on it. Then, use the tabs that appear across the bottom \nof the window to modify the table's columns, indexes, and foreign keys. \n• \nTo add a new table, double-click on the Add Table icon. Then, use the tab that \nappears to define the table. \n• \nTo delete a table, right-click on it and select the Delete item. \n• \nThe skills for working with tables also apply to other database objects such as \nviews and stored programs. \n• \nThe EER model typically includes at least one diagram named EER Diagram. \n• \nTo open a diagram, double-click on the name of the diagram. \n• \nTo create a new diagram, double-click on the Add Diagram icon or select the \nModel ➔ Add Diagram item. \nI\\ \nV \n• \nTo expott a database creation script from the model, select the File➔ \nExport➔ \nForward \nEngineer SQL CREATE Script item. \nHow to work with an EER model",
          "pages": [
            349,
            350,
            351,
            352,
            353,
            354,
            355
          ],
          "relevance": {
            "score": 0.45,
            "sql_score": 1.0,
            "concept_score": 0.5,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "commonMistakes": {
          "text": "Section 3 \nDatabase design and impleme11,tation, \nHow to work with an EER diagram \nWhen you open an EER diagram, it's displayed in a tab as shown in figure \n10-16. Here, you can see the diagram that's associated with the model for the \nAP database. This diagram shows the definitions of the columns in the tables as \nwell as the relationships between the tables. For example, it shows that there's a \none-to-many relationship between the Vendors and Invoices tables. \nTo edit a table, you can double-click on it. This displays a tab for the table \nthat works the same as the one you saw in the last figure. As you learned in that \nfigure, you can use this tab to make changes to the columns, indexes, and foreign \nkeys. \nTo add a table that exists in the model to the diagram, you can drag the table \nfrom the Catalog Tree pane onto the diagram. Or, if you want to create a new \ntable, you can click the Place a New Table button in the vertical toolbar to the \nleft of the diagram and then click on the diagram. This adds a new table to the \ndiagram and to the model. \nSince a diagram provides a visual representation of the relationships \nbetween tables, you often use it to define those relationships. To do that, you \ncan use the six relationship buttons at the bottom of the toolbar. The first five \nbuttons generate foreign keys for the table, so you can use these buttons when \nthe column for a foreign key doesn't exist yet. You can use the last relationship \nbutton if the foreign key column already exists in your diagram. For example, \nto create a relationship between the Vendors and Invoices tables, I clicked on \nthe last button (the Place a Relationship Using Existing Columns b11tton). Then, \nI clicked on the vendor_id column in the Invoices table to identify the foreign \nkey, and I clicked on the vendor_id column in the Vendors table to identify the \nprimary key. \nIn the next chapter, you'll learn more about the SQL statements that are \ngenerated by a tool like this. This will help you understand how to use MySQL \nWorkbench, and it will allow you to edit the SQL statements that are generated \nby your database design tools.\n\nHovv to design a database \nThe EER diagram for the AP database \n■ \nMySQl. Workbench \nD \nX \nMySOL Moder (ap.mwb) \nx \nEER l);agram ,.. \nFile \nEdit \nVi-\nArrange \nModel \nDatabase \nTools \nScripting \nHelp \n... ..,. \nflJ \n._ _ \n__,Is. lJ□ \nBiros Ee \nll aqram \nZoom: 1~ • ~ 0_ \n[I] o:J vendors \nI \nvendor Jd INT( 11) \n► vendor _nan e VAR01AR(SO) \n\" \n., \n) \n:J lnvoice_llne_ltems \nrnwocejd INT( 11) \n,a \nvendor _addro= 1 V ARCHAR(SO) \n> vendor _address2 V ARCHAR(SO) \n□ \nvendor _dty VAROiAR(SO) \nE) \n'# -.endor _stale 01AR(2) \n:J invoices \ninwocejd INT( 11 \n...endor Jd I NT( 11 \nlnvolce_number V \n) \nMCHAA(SO) \n,H -\nI \nlnvoice_date DAT \nI \nE \nMAl(9,2) \nI \nt invoice_lx>tal DEG \n. . \nlnvorce_:;equence INT( 11) \n• ao:ount_number INT(lll \nline_item_amount OEC!MAl(9,2) \nline_ltem _description V MCHAR(lOO \nCatalog T tee \n., \nap \n... I El \n•3' Tables \ntc:, \n-.endor _zip _code V MCHAR(20) \n) Yendor_phone VMCHAR(SO) \n-.endor _contactj ast_name V ARCHAR(SO) \nvendor _conlact_first_narn e VAR01M(SO) \ndefault_termsjd INT(U) \n~ \noenerel_ledoer_acc \nca, \n,. defaulLaccount_r,umber INT(l1) \n:] involce_archlve \n'l:l)I \nJ lnvolce line 1te115 \" \nO \n< \n> \n111:i ---\n.. \n-t'l:11 \nQMAL(9,2) \npa-.,m ent_lx>tz/ DE \ncredit_tolal DEQMA L(9,2) \nDATE \n♦ b!rm s _Id INT( 11) \nlnvoice_due_d.e \npa}'ffl ent_date DA JE \n____ f \nl -• \n► \n.. \n--\nl \n--1 \nI \nI \nI \nI \nI \nI \n:l: \nl \nI \nI \nI \nI \nI \nI \nI \n:I: \nC-alalog \nlayers \nUser Types \nl'I ~ \nOesa,pt,oo Eo,!t>r \n, \nl:n \nV \nI: I \nI \nI \nI '\"------ff \n:J ta,os \ntermsJd INT(l l) \nterm s_descrlptlon VAR01M(SO) \nterm s_due_days INT(l 1) \n:J gerwal_ledger_~nlS \" \naccount_number INT( ll) \naccount_descrlption V MCHAR( SO) \n<double-dick lo oveiwde multc>lec---.11 ~ \nDescnptior \nPropenies \n♦ ♦ ~ \n\" < \n.. \nSQt.. Edrtor closed \nDescription \n• \nAn EER diagram is a visual representation of an EER model. As a result, when you \nmodify the tables in the diagram, yot1 also modify the model. \n• \nTo add a table that already exists in the model to the diagram, drag the table from \nthe Catalog Tree window onto the diagram. \n• \nTo add a new table to the diagram, click the Place a New Table button in the \nvertical toolbar at the left edge of the diagram. Then, click on the diagram where \nyou want to add the table. \n• \nTo display the model for a table, double-click on the table. Then, a tab is displayed \nfor the table, and you can use the techniques you learned in the previous figure to \nedit the table. \n• \nTo define the relationship between two tables, click one of the relationship buttons \nin the vertical toolbar. Then, click on the column in each table that defines the \nrelationship. \n• \nTo edit or delete a relationship, right-click on the relationship icon and select the \nappropriate item. \n• \nTo remove a table from the diagram but keep it in the model, right-click on the \ntable and select the Remove Figure item. \n• \nTo remove a table from the diagram and delete it from the model, right-click on the \ntable and select the Delete item. \nHow to work with an EER diagram \n... \n>",
          "pages": [
            356,
            357
          ],
          "relevance": {
            "score": 0.37,
            "sql_score": 1.0,
            "concept_score": 0.33,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        }
      },
      "educational_notes": {
        "definition": "Constraints are rules that ensure data integrity and consistency within a database. They prevent invalid or duplicate data from being entered into tables.",
        "explanation": "Constraints are essential for maintaining the accuracy and reliability of your database. Think of them as quality control checks that ensure only valid data is stored. There are several types of constraints, including NOT NULL, UNIQUE, PRIMARY KEY, FOREIGN KEY, CHECK, and DEFAULT. Each serves a specific purpose in ensuring data consistency and completeness.",
        "key_points": [
          "NOT NULL: Ensures that a column cannot contain null values.",
          "UNIQUE: Ensures that all values in a column are distinct.",
          "PRIMARY KEY: Identifies each row uniquely within a table, must be NOT NULL and UNIQUE.",
          "FOREIGN KEY: Establishes a link between two tables, ensuring referential integrity.",
          "CHECK: Limits the range of values that can go into a column based on a condition.",
          "DEFAULT: Specifies a default value for a column if no value is provided."
        ],
        "examples": [
          {
            "title": "Basic Usage",
            "code": "-- Adding a NOT NULL constraint to a column ALTER TABLE employees ADD COLUMN email VARCHAR(255) NOT NULL;",
            "explanation": "This example adds a NOT NULL constraint to the 'email' column, ensuring that every employee must have an email address.",
            "validation_note": "SQL auto-fixed: "
          },
          {
            "title": "Practical Example",
            "code": "-- Adding a UNIQUE constraint to ensure no duplicate emails ALTER TABLE employees ADD CONSTRAINT unique_email UNIQUE (email);",
            "explanation": "This practical example ensures that all email addresses in the 'employees' table are unique, preventing duplicates.",
            "validation_note": "SQL auto-fixed: "
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Forgetting to specify NOT NULL when creating a column",
            "incorrect_code": "-- Incorrect SQL CREATE TABLE employees (id INT);",
            "correct_code": "-- Correct SQL CREATE TABLE employees (id INT NOT NULL);",
            "explanation": "This mistake can lead to null values in columns where they should not be allowed. Always specify NOT NULL when it's appropriate."
          },
          {
            "mistake": "Using UNIQUE instead of PRIMARY KEY for a column that needs to uniquely identify rows",
            "incorrect_code": "-- Incorrect SQL CREATE TABLE employees (id INT UNIQUE);",
            "correct_code": "-- Correct SQL CREATE TABLE employees (id INT PRIMARY KEY);",
            "explanation": "PRIMARY KEY is more than just UNIQUE; it also ensures NOT NULL. Use PRIMARY KEY when you need a column to uniquely identify rows."
          }
        ],
        "practice": {
          "question": "Create a table named 'products' with columns for product_id (primary key), name, and price. Ensure that the 'name' column cannot be null and must be unique.",
          "solution": "-- Solution\nCREATE TABLE products (\n    product_id INT PRIMARY KEY,\n    name VARCHAR(255) NOT NULL UNIQUE,\n    price DECIMAL(10, 2)\n);"
        }
      },
      "llm_enhanced": true,
      "raw_text_preview": "Hovv to design a database \nThe invoice data with a column that contains repeating values \nvendor _name \nlnvoice_number \nit:em_desaipbon \n► \nCahners Publishing \nAndroid ad, MySQL ad, Library directory ",
      "content_relevance": {
        "score": 0.45,
        "sql_score": 1.0,
        "concept_score": 0.5,
        "non_sql_penalty": 0.1,
        "is_relevant": true,
        "analysis": "SQL content"
      }
    },
    "views-murach": {
      "id": "views-murach",
      "title": "Views",
      "definition": "Creating and using views in MySQL",
      "difficulty": "intermediate",
      "page_references": [
        381,
        382,
        383,
        384,
        385,
        386,
        387,
        388,
        389,
        390,
        391,
        392,
        393,
        394,
        395,
        396
      ],
      "sections": {
        "definition": {
          "text": "How to create databases, tables, and indexes \nThe SQL script that creates the AP database \nCREATE TABLE \n( \n• \n• \ninvoices \ninvoice_ id \nvendor_ id \ninvoice_number \ninvoice_date \ninvoice_ total \npayment_ total \ncredit_ total \nINT \nPRIMARY KEY \n) ; \nterms_ id \nINT \nVARCHAR(SO) \nDATE \nDECIMAL(9,2) \nDECIMAL(9,2) \nDECIMAL(9,2) \nINT \ninvoice_due_date \nDATE \npayment_date \nDATE, \nCONSTRAINT invoices_ fk vendors \nFOREIGN KEY (vendor id) \nREFERENCES vendors (vendor_ id), \nCONSTRAINT invoices_ fk_terms \nFOREIGN KEY (terms_ id) \nREFERENCES terms (terms id) \nCREATE TABLE invoice line items \n( \ninvoice_ id \nINT \n• \n• \n1nvo1ce_sequence \nINT \nINT \nNOT \nNOT \nNOT \nNOT \nNOT \nNOT \nNOT \nNOT \naccount number \nline_ item_amount \nline_ item_description \nCONSTRAINT line_ items_pk \nDECIMAL(9,2) \nVARCHAR(lOO) \nNULL, \nNULL, \nNULL, \nNULL, \nNULL \nNULL \nNULL, \nNULL, \nNOT \nNOT \nNOT \nNOT \nNOT \nPRIMARY KEY (invoice_ id, invoice_sequence), \nCONSTRAINT line_ items_ fk_ invoices \nFOREIGN KEY (invoice id) \nREFERENCES invoices (invoice_ id), \nCONSTRAINT line_ items_ fk_acounts \nFOREIGN KEY (account number) \nNULL, \nNULL, \nNULL, \nNULL, \nNULL, \nAUTO_ INCREMENT, \nDEFAULT O, \nDEFAULT 0, \nREFERENCES general_ ledger_accounts (account number) \n) ; \n-- create an index \nCREATE INDEX invoices_ invoice date ix \nON invoices (invoice_date DESC); \nThe script used to create the AP database (part 2 of 2) \nPage2\n\nSection 3 \nDatabase design and impleme11,tation, \nHow to use MySQL Workbench \nSince you often use a script to create tables and other database objects, it's \nimportant to understand the DDL skills presented in this chapter. Once you \nunderstand these skills, it's easy to learn how to use a graphical user interface \nsuch as MySQL Workbench to work with database objects such as tables and \nindexes. For example, it's often useful to view these database objects before \nwriting the SELECT, INSERT, UPDATE, or DELETE statements that use them. \nHow to work with the columns of a table \nstart, you can view the column defmitions for a table by right-clicking on the \ntable in the Navigator window and selecting Alter Table to display the table in \nthe main window. Then, click on the Columns tab at the bottom of the window. \nFor example, this figure shows the columns for the Invoices table. Here, you \ncan see the name, data type, and other attributes of each column. For instance, \nyou can see that the invoice_id column is the primary key column and an auto \nincrement column. The payment_total and credit_total columns specify a default \nvalue of 0.00. And the pay1nent_date column allows null values and its default \nvalue is NULL. \nIf you need to add a new column, you can double-click below the last name \nin the Column Name column. Then, you can type in a name for the new column, \nand you can specify its attributes to the right of the column name. \nYou can also work with a new or existing column using the controls below \nthe list of columns. In this figure, for example, I've selected the invoice_id \ncolumn, so the information for that column is displayed below the column list. \nThis is useful if you aren't familiar with the abbreviations that are used for the \ncheck boxes in the column list, since these attributes are clearly identified by the \ncheck boxes below the list. You can also use the Charset and Collation drop-\ndown lists to change the character set and collation for some columns. You'll \nlearn more about that later in this chapter.\n\nHow to create databases, tables, and indexes \nThe column definitions for the Invoices table \n■ \nMySQl. Workbench \nD \nX \nLocal instance MySQL80 x \nFile \nEdit \nVtew \nQuery \nDatabase \nServeT \nTools \nScripting \nHelp \nN IV gato, \nQuay, \nil:4❖?ftlffll'1il-L ____________________ _ \nSOlEMAS \n~ IFllter abJeds \n., J ap \nT'al Tables \n► Iii general_ledg,r_accounts \n► i1 invoice_1rchlve \n► iii lnvolce_hne_items \n► ii Invoices \n► ii terms \n► Iii vendor_contacts \n► El vendors \nloJ Viev.-s \n'ell stored Procedures \nlc)l Functions \n► \nex \n► \nom \n.. \n=• \nAdminlstntlon \nSchemas \nlnformabon \nTab~ 1nll0lces \nColumns: \nin \n• . 1d \nnt{U) Al PK \nv~ id \nnt{ll) \nlnvoice_runber \nvarctw(SO) \ninvoice date \ndate \nnvoice_ liita! \ndeornel{9, 2l \npayment_tutal \n~9,2 \naedit_tutal \ndeo \n9,2 \nternts_id \nr,t{U) \nj \n,., \nV \nV \nTable Name: E._ \n_______ ___.I Schema: \nap \nOlarset/Collation: \nutft!mb4 \nv \nutfanb4_0900_ v \nEngine: [!maOB \nCooments: \nColumnName \n,nvoic,_ld \nvendor_icf \nlnvofce_number \ninvolce_d1te \nlnvoice_total \n< \nDatatype \nINT{ll) \nINT{l 1) \nVARCHAR(SO) \nDATE \nOECIMAL(9,2) \nCdl.lm Name: ,__l\n1nv_oice_1c1 _____ _. \nOlarsetft:;olaban: \nL \nDefault Cobb \n--~ \nC0!!1!lents: \nPK \n~ UQ \nLN \n1r \nE2l \nE2l □ □ □ □ \n□ E2l □ □ □ □ \n□ E2l □ □ □ □ \n□ E2l □ □ □ □ \n□ E2l □ □ □ □ \nData Type: IINT(ll) \nOefcNJt: \nSU>rage: \nVirtual \nE2l Pnmary Key \n□ \nBinary \nE2) Aull> Increment \nColumns \nIndexes \nForeign IC~~ \nTng11ers \nPartitioning \nOptiom \nAl \nG \nOefautft=xpresslon \nE2l □ \n□ □ \n□ □ \n□ □ \n□ □ \nStured \nE2l NotNul \n□ \nlhque \n□Unsigned D ZeroAII \n0 Gerle'ated \nV \n> \n--- .-1.,- Aat. \n\"4:ata \nObJ,c: Info \nSession \nRevert \nDescription \n• \nTo view the columns for a table, right-click on the table in the Navigator window, \nselect the Alter Table item, and click on the Columns tab. \n• \nTo rename a column, double-click on the column name and enter the new name. \n• \nTo change the data type for a column, click on the data type in the Datatype \ncolt1mn. Then, select a data type from the drop-down list that's displayed. \n• \nTo change the default value for a column, enter a new default valt1e in the Default \ncolumn. \n• \nTo change other attributes of the column, check or uncheck the attribute check \nboxes to the right of the column. \n• \nTo drop a column, right-click on the column name and select the Delete Selected \nitem. \n• \nTo move a column up or down, right-click on the column name and select the Move \nUp or Move Down item. You can also use the Up and Down keys on the keyboard. \n• \nTo add a new column, double-click in the Column Name column below the last \ncolumn and type in a new name. Then, specify the attributes for the new column. \n• \nTo apply the changes to the table, click the Apply button. To reverse the changes, \nclick the Revert button. \nHow to work with the columns of a table \ny\n\nSection 3 \nDatabase design and impleme11,tation, \nHow to work with the indexes of a table \nAlthough MySQL Workbench provides several ways to work with indexes, \none of the easiest is to right-click on the table in the Navigator window and \nselect the Alter Table command to display the table defmition. Then, you can \nclick on the Indexes tab to display the indexes of the table. For example, figure \n11-11 shows the indexes for the Invoices table. \nIn most cases, you'll use this tab to add indexes to a table. To do that, you \nstart by double-clicking below the last index name and entering the name of the \nnew index. Then, you can select the type of index you want to create, the column \nor columns you want to index, and the order for each column. To change or drop \nan index, you can use the skills presented in this figure.",
          "pages": [
            381,
            382,
            383,
            384
          ],
          "relevance": {
            "score": 0.37,
            "sql_score": 1.0,
            "concept_score": 0.33,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "examples": {
          "text": "How to create databases, tables, and indexes \nThe indexes for the Invoices table \n■ \nMySQl. Workbench \nD \nX \nLocal instance MySQLSO x \nFile \nEdit \nVtew \nQuery \nDatabase \nSefver \nTools \nScripting \nHelp \nfjl \n&il lil &l Bi!l rai ~ \nSCHEMAS \n~ IRter ol)Jccn \n• U ap \n• \nTables \n► II oenual_ledoer_accounts \n► i1 invoice_archive \n► iii ln,olce_hne_items \n► C Invoices \n► El turns \n► &l vendor_conta<ts \n► Cl vendors \nViews \n'cl'.l stored Procedures \n'cl Functions \n► \nex \n► \nom \n.. \n=• \nAdministration \nSchemas \nInformation \nColumns: = ~ \n~~i~j Al PK \nnvoke_runber \nvardw(SO) \ninvoic~ date. \ndare \nnvoice.Jiital \ndrotN,1{9,2) \npayment_total \ndeomal(9,2) \naedit_total \ndeomo1(9,2J \nte.rms_id \nnt(U) \n--- ~.., Aa ♦a .-.st. \nOb)ea Info \nS5SIOO \nDescription \nj \n,., \nV \nV \nQuery 1 \nil:1-:\\i& \nTable Name: F \nI Schema: \nap \nL-----------' \nOlarset/Collation: \nutfl!tnb4 \nv lutf8mb4_0900_ v \nEngine: \n[ lmoOB \nCooments: \nIndex Name \nTyi:,e \ntndexCoums--------\nPRIMARY \nPRIMARY \nmvo,ces_l'k_vendors \nINDEX \nlnvoices_fk_terms \nINDEX \nmvo1cesjnvoice_~. 1NOEX \nColumn \n;; \n0 ,nvoice_d \n0 veodor_ld \n0 lnvolce_number \n0 invoice_date \nl \n0 lnvoice_total \n0 payment_total \n0 credit_tota \n0 terms_ld \n0 involce_due_date \nD payment_date \n< \nColumns \nInd~ \nForeio11 Keys \nTnogers \nPartrtionlng \nOptioM \n~ l~ \nASC \nASC \nASC \nDESC \nASC \nASC \nASC \nASC \nASC \nASC \n> \nIndex Opbons \nStorage Type: \nKey Block Sae: lo \nParser: I \nV~: 1:21 \nIndex Comment \n• \nTo view the indexes for a table, right-click on the table in the Navigator window, \nselect the Alter Table item, and click on the Indexes tab. \n• \nTo rename an index, double-click on the name and enter the new name. \n• \nTo change the type of an index, click on the Type column. Then, select a type from \nthe drop-down list that appears. \nRevert \n• \nTo change the colu1nn that's indexed, select the index and then select its column in \nthe list of columns that appears. You can also change the sort order of the index by \nclicking in the Order column and then selecting ASC or DESC from the drop-down \nlist that appears. \n• \nTo drop an index, right-click on the index name and select the Delete Selected item. \n• \nTo add a new index, double-click below the last index name and type in a new \nname. Then, specify the type, column, and order for the index. \n• \nTo apply the changes to the table, click the Apply button. To reverse the changes, \nclick the Revert button. \nFigure 11 -11 \nHow to work with the indexes of a table \nV\n\nSection 3 \nDatabase design and impleme11,tation, \nHow to work with the foreign keys of a table \nTo work with the foreign keys of a table, you use the Foreign Keys tab. For \nexample, figure 11-12 shows the foreign keys for the Invoices table, and the \nforeign key named invoices_fk_terms is selected. Here, MySQL Workbench \nshows the table that's refe1·enced by the foreign key, the foreign key column, and \nthe column that's referenced by the foreign key. If you need to, you can change \nany of the information that defmes the foreign key as described in this figure. \nYou can also add new foreign keys, and you can drop existing keys.\n\nHow to create databases, tables, and indexes \nThe foreign keys for the Invoices table \n■ \nMySQl. Workbench \nD \nX \n1.oca1 IMlance MySOLSO x \nFile \nEdit \nVtew \nQuery \nDatabase \nServer \nTools \nScripting \nHelp \nouerv 1 \nil:1·\\Hftlffll,;i■iiL _____________________ _ \nSCHEMAS \n~ 1Ft11er abjects \nT J ap \nT \nTables \n► □ oeneral_ledoer_accounts \n► il invoice_archlve \n► Ii lnvolce_hne_1tems \n► 0 Invoice. \nj \n,.. \nTable Name: fi±es,___ _______ _,I Schema: \nap \nOiarsetjCollation: \nutft!tnb4 \nv lutf8mb4_0900_ v \n~: llmoOB \nV \nC«nments: \nQiunn \nRefereoced Cobl Foreign Key Options \n► Eil terms \n► Iii vendor_contaas \n► D vendors \nVlev.s \nForeq1 Key Name \nlnvolce~_fk_terrm \ninvoices _flc_ ve:ndcn \nReferenced Table \n·ap· : terms· \n· ap · : vendors· \nD invoice_id \nD vendor_id \nOn ~ate: \nRESTRICT \n-------=::::: \n'ell stored Procedures \n► \nex \n► \nom \n.. \n=• \nFunctions \nAdministration \nSchemas \nInform<lbon \nColumns: \n~~ \n~ \n~~~~ Al PK \nlnvoice_runber \nvardl.Y(SO) \ninvoice date \ndate \nrwoice_lotal \ndeomlll(9,fil \npayment_total \ndeomal(9,2 \naedit_total \ndeomal(9, \nterms_id \nnt(U) \n--- _,._ Aa ♦• \nris.,_ \nObjea Info \nSess-lon \nDescription \n.., \n.., \nD lnvolce_number \nD invoice_date \nD invo1ce_total \nD payme:nt_total \nD aed1t_total \n0 terms_id \nterms_id \nD invo1ce_due_date \nD payment_date \n< \n> < \nColumns \nlndexes \nFore19n Keys \nTnggl!TS \nPartitioning \nOptioro \nOn Delete: \nR.ESTRrCT \nD Slap In SQl gener-ation \nFor~ Kev Comme-tt ----\n> \n• \nTo view the foreign keys for a table, right-click on the table in the Navigator \nwindow, select the Alter Table item, and click on the Foreign Keys tab. \n• \nTo rename a foreign key, double-click on the name and enter the new name. \n• \nTo change the referenced table, click on the table name in the Referenced Table \ncolt1m.n and select a table from the drop-down }jst that appears. \n• \nTo change the colu1nn or referenced column for a foreign key, select the foreign key \nand then select the column or referenced column in the list that appears. \n• \nTo drop a foreign key, right-click on its name and select the Delete Selected item. \n• \nTo add a new foreign key, double-click below the last foreign key name and type in \na new name. Then, specify the referenced table, foreign key column, and referenced \ncolumn. \n• \nTo apply the changes to the table, click the Apply button. To reverse the changes, \nclick the Revert button. \nFigure 11 -12 \nHow to work with the foreign keys of a table\n\nSection 3 \nDatabase design and impleme11,tation, \nHow to work with character sets \nand collations \nSo far, this book has assumed that you're working with the default chai·acter \nset and collation for yoL1r MySQL server. In this topic, you'll learn more about \ncharacters sets and collations and why yoLI might want to use a character set or \ncollation that's different from the default. Then, you'll learn how to specify the \ncharacter set and collation for a database, a table, or even a column. \nAn introduction to character sets \nand collations \nWhen a column is defmed with a string type such as CHAR or VARCHAR, \nMySQL stores a numeric value for each character. Then, it uses a character set \nto map the numeric values to the characters of the string. \nused by MySQL. To start, it presents the default character set for MySQL 5.5 \nand earlier: the latinl character set. This character set uses one byte per character \nto provide for most characters in Western European languages. However, if you \nneed to store other characters, you can use the utf8mb3 or utf8mb4 character set. \nThe utf8mb3 character set is the default for MySQL 5.6 and 5.7, and the \nutf8mb4 character set is the default for MySQL 8.0 and later. Currently, MySQL \nrefers to the utf8mb3 character set with the alias utf8. However, the t1tf8mb3 \ncharacter set is deprecated and will be removed in a future release of MySQL. \nWhen that happens, t1tf8 will become an alias for the utf8mb4 character set. \nBecause of that, you should explicitly specify utf8mb4 if th,at's the character set \nyou want to use. \nThe advantage of the utf8mb4 character set is that it provides for all charac-\nters specified by the Unicode character set. This includes most characters from \nmost languages worldwide. As a result, it's appropriate when you 're going to be \nworking with a global application that needs to be able to store characters from \nmultiple languages. You can also use it to store chai·acters like emojis, which are \nbecoming more and more common. \nThe disadvantage of the utf8mb4 character set is that it can use up to four \nbytes per character. This forces MySQL to reserve four bytes per character for \neach character in the CHAR type. As a result, this can increase data storage \nrequirements for a database that makes extensive use of the CHAR type. \nFortunately, this typically isn't an issue. If it is, you can fix the issue by using the \nVARCHAR type instead of the CHAR type. \nEvery character set has a corresponding collation that determines how the \ncharacters within the set are sorted. For example, the latinl character set uses \nthe collation named latinl_swedish_ci by default, since MySQL was developed \nin Sweden. Here, the beginning of the name shows that it corresponds with the \nlatin 1 character set. In addition, the ci at the end shows that it is case-insensitive. \nThis means that MySQL sorts uppercase letters such as A and lowercase letters \nsuch as a at the same level, which is usually what you want.\n\nHow to create databases, tables, and indexes \nThree commonly used character sets \nName \nDescription \nlatinl \nThe latinl character set uses one byte per character to provide for most characters in \nWestern European languages. \nutf8mb3 \nThe utf8mb3 character set uses one to three bytes per character to provide for aJJ \ncharacters specified by the Unicode character set. This character set provides for most \ncharacters in most of the world's languages. \nutf8mb4 \nThe utf8mb4 character set uses one to four bytes per character to provide for all char-\nacters specified by the Unicode character set, plus additional characters like emojis. \nFour collations for the latin1 character set \nName \nDescription \nlatinl swedish ci \n-\nlatinl general ci \n-\nlatinl general cs \n-\nlatinl bin \nThe default collation for the latinl character set. \nA general purpose, case-insensitive collation. \nA general purpose, case-sensitive collation. \nThe binary collation for this character set. \nFour collations for the utf8mb3 character set \nName \nDescription \nutf8_general_ ci \nutf8 unicode ci \nutf8 spanish c i \n-\nutf8 bin \nThe default co]lation for the utf8mb3 (utf8) character set. \nA case-insensitive collation that provides for more correct so1ting. \nA case-insensitive collation for the Spanish language. \nThe binary col]atio11 for this character set. \nThree collations for the utf8mb4 character set \nName \nDescription \nut f8mb4 0 900 \n. \n. \nal. Cl. \n-\nutf8mb4 0900 as cs \nutf8mb4 bin \nDescription \nThe default collation for the utf8rnb4 character set. \nAn accent-sensitive, case-sensitive collatio.n. \nThe binary collation for this charactei- set. \n• \nThe character set that's used by a database, table, or column determines which \ncharacters can be stored and how many bytes are used to store the characters. \n• \nEvery character set has a corresponding collation that determines how the characters \nwithin the set are sorted. \n• If the name of a collation ends with ci, the collation is case-insensitive. If the name \nof a collation ends with cs, the collation is case-sensitive. \n• \nIf the name of a collation includes ai, the collation is accent-insensitive. If the name \nof a collation includes as, the collation is accent-sensitive. \n• If the name of a collation ends with bin, the collation is binary, which means that the \ncharacters are sorted according to the binary numbers that correspond to each character. \nAn introduction to character sets and collations\n\nSection 3 \nDatabase design and impleme11,tation, \nIf MySQL isn't sorting characters the way you want, you can use another \ncharacter set and collation. If you're using utf8mb3, for example, you can use the \nutf8_unicode_ci collation instead of the default of utf8_general_ci. This colla-\ntion provides more correct sorting, although it isn't as fast as utf8_general_ci. \nRemember, though, that the utf8mb3 character set is deprecated, so you \nshould use utf8mb4 instead for new development. In that case, the default colla-\ntion of utf8mb4_0900_ai_ci usually works the way you want. However, if you \nwant to use a case-sensitive sort, you can use a collation with a name that ends \nwith cs. Or, you can use a collation with a name that ends with bin, which stands \nfor binary. This sorts characters by their nu1neric values instead of by their \ncharacter values. Finally, if you want to use an accent-sensitive sort, you can use \na collation that includes as. \nHow to view character sets and collations \navailable on your MySQL server. To do that, you use the SHOW CHARSET \nstatement as shown in the first example. As the results of this statement show, the \nSHOW CHARSET statement displays information about each character set in \naddition to its name. \nYou can also use the SHOW CHARSET statement to view information \nabout a single character set. To do that, you can use a LIKE clause to identify the \ncharacter set as shown in the second example. \nThis figure also shows how to use the SHOW COLLATION statement to \nview information about collations. For instance, the third example in this figure \nshows how to view information about all the collations that are available on the \ncurrent server. In the rest1lt set that's returned by this statement, you can see \nsome of the collations for the utf8mb4 character set. \nIf you only want to view the collations for a specific character set, you can \nuse a LIKE clause with the % wildcard character. In this figure, for example, the \nsecond SHOW COLLATION statement shows the collations for the utf8mb4 \ncharacter set. \nThe next four examples in this figure show how to use the SHOW \nVARIABLES statement to view the default character set and collation for your \ncurrent server or database. In these examples, the LIKE clause is used to specify \nthe name of a variable. For example, to view the default character set for a \nserver, you use the character_set_server variable. \nYou can also view the character set and collation for all the tables in a \ndatabase. To do that, you can query the table named Tables in the database \nnamed Inf orrnation_Schema as shown in the last example. Here, the SELECT \nstatement returns the table name and table collation for each table in the AP \ndatabase. Since the name of the collation also identifies the character set, this \nindicates the character set for each table.\n\nHow to create databases, tables, and indexes \nHow to view all available character sets for a server \nSHOW CHARSET \nCharset \nDescription \nDefault collabon \nutf16 \nUTF-16 Unicode \nutf 16 _general_d \nutf16le \nUlF-16LE Unicode \nutf161e_general_d \nutf.32 \nUTF-32 Unicode \nutf32_general_d \nutf8 \nUTF-8 Unicode \nutf8_general_d \nutf8mb4 \nUTF-8 Unicode \nutf8mb4_0900_ai_ci \nHow to view a specific character set \nSHOW CHARSET LIKE 'utf8mb4' \nMaxlen \nHow to view all available collations for a server \nSHOW COLLATION \nCoftabon \nCharset \n1d \nDefault \nCompiled \nSortien \nPad_attribute \nutf8mb4_0900_ai_d \nutf8mb4 \nYes \nYes \nNO PAD \nutf8mb4_0900_as_d \nutf8mb4 \nYes \nNOPAD \nutf8mb4_0900_as_cs \nutf8mb4 \nYes \nNO PAD \nutf8mb4 bin \nutf8mb4 \nYes \nPAD SPACE \nutf8mb4 _croatian _d \nutf8mb4 \nYes \nPAD SPACE \nutf8mb4 cs 0900 al a \n- -\n- -\nutf8mb4 \nYes \nNO PAD \nutf8mb4_cs_0900_as_cs utf8mb4 \nYes \nNO PAD \nutf8mb4_czech_d \nutf8mb4 \nYes \nPAD SPACE \nutf8mb4_danish_d \nutf8mb4 \nYes \nPAD SPACE \nHow to view all available collations for a specific character set \nSHOW COLLATION LIKE 'utf8mb4%' \nHow to view the default character set for a server \nSHOW VARIABLES LIKE 'character_set_ server' \nHow to view the default collation for a server \nSHOW VARIABLES LIKE 'collation server• \nHow to view the default character set for a database \nSHOW VARIABLES LIKE 'character_ set_database' \nHow to view the default collation for a database \nSHOW VARIABLES LIKE 'collation_database' \n,. \ni .., \n,. \n--\n.., \nHow to view the character set and collation for all the tables in a database \nSELECT table_name, table_collation \nFROM information_ schema.tables \nWHERE table_ schema = •ap' \nTABLE_NAME \nTABLE_COLLATION \ninvoice _line j terns \nutf8mb4_0900 _ai_d \n. \n. \nutf8mb4 _0900 _ai_ci \n1nv01ces \nterms \nutf8mb4_0900_ai_o \nHow to view character sets and collations \n\"' \n\\I",
          "pages": [
            385,
            386,
            387,
            388,
            389,
            390,
            391
          ],
          "relevance": {
            "score": 0.37,
            "sql_score": 1.0,
            "concept_score": 0.33,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "commonMistakes": {
          "text": "Section 3 \nDatabase design and impleme11,tation, \nHow to specify a character set and a collation \nlevels: database, table, and column. In most cases, you want to specify the \ncharacter set and collation at the database level as shown in the first group of \nexamples. Then, all the columns in all of the tables that store string data are \ndefined with that character set and collation. If necessary, though, you can also \nset the character set and collation at the table or column level as shown by the \nsecond and third groups of examples. \nTo specify a character set or collation, you can use the CHARSET or \nCOLLATE clauses. For a new database or table, you can add these clauses to the \nCREATE statement for the database or table. For an existing database or table, \nyou can add these clauses to the ALTER statement for the database or table. \nMost of the examples in this figure use both the CHARSET and COLLATE \nclauses. This clearly shows the character set and collation that are being speci-\nfied. In most cases, though, you only need to use one clause or the other. That's \nbecause every character set has a default collation, and every collation has a \ncorresponding character set. As a result, if you omit the COLLATE clause, \nMySQL uses the default collation for the specified character set. And, if you \nomit the CHARSET claL1se, MySQL uses the character set that corresponds with \nthe specified collation. If you want to use a collation other than the default for a \ncharacter set, then, you can do that by coding the COLLATE clause without the \nCHARSET clause. \nYou can also use MySQL Workbench to change the character set and colla-\ntion for a table or column. To do that, you use the Columns tab that you saw \nin figure 11-10. To change the character set and collation for a table, you use \nthe Charset and Collation drop-down lists at the top of this tab. To change the \ncharacter set and collation for a column, you select the column and then use the \nCharset and Collation drop-down lists below the list of columns.\n\n37 4 \nSection 3 \nDatabase design and impleme11,tation, \nHow to work with storage engines \nA storage engine determines how MySQL stores data and which database \nfeatures are available to you. Unlike many other databases, MySQL provides \nseveral different storage engines that you can use, and each of these engines \nprovides slightly different feattu·es. \nAn introduction to storage engines \nengines: InnoDB and MyISAM. The InnoDB engine is the default engine for \nMySQL 5.5 and later. As a result, if you installed the software as described in \nappendix A or B of this book, you have been using the InnoDB engine so far. \nThis engine supports foreign keys as described earlier in this chapter. In addition, \nit supports transactions, which are desc1ibed in chapter 14. \nPrior to MySQL 5.5, the MyISAM engine was the default storage engine. As \na result, if you ever work on an older MySQL database, there's a good chance its \ntables use the MyISAM engine. This engine supports some features that weren't \nsupported by InnoDB tables until later releases of MySQL, including full-text \nsearches and spatial data types. However, the My ISAM engine doesn't support \nforeign keys, an important feature for maintaining referential integrity. \nAlthough this chapter doesn't cover the full-text search feature, you should \nknow that this feature makes it easier and faster to search string data using \nnatural language search strings. To use this feature, you create a special type of \nindex called a FULLTEXT index. Then, you can use full-text search features in \nyour SELECT statements. For more information about how this works, you can \nsearch the Internet. \nHow to view storage engines \nstart, it shows how to use the SHOW ENGINES statement to view all available \nstorage engines for the current server. In this fig1rre, for example, the result set \nshows that the InnoDB storage engine is the default storage engine for the server. \nIn addition, it shows that several other storage engines are available to the server. \nOf these, the My ISAM storage engine is the most significant since it was the \ndefault storage engine in earlier versions of MySQL. \nIf you want to qt1ickly view the default storage engine for the server, you \ncan use the SHOW VARIABLES statement shown in this figure. This statement \nreturns a single row that includes the name of the default storage engine. \nIf you want to view the storage engine that's used for all the tables \nin a database, you can use a SELECT statement to query the tables in the \nInformation_Schema database as shown in the last example. Here, the SELECT \nstatement displays the table name and storage engine for the tables in the AP \ndatabase. You can also display this information for all tables on the server by \nremoving the WHERE clause from this SELECT statement.",
          "pages": [
            392,
            393,
            394
          ],
          "relevance": {
            "score": 0.37,
            "sql_score": 1.0,
            "concept_score": 0.33,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        }
      },
      "educational_notes": {
        "definition": "A view is like a virtual table that presents data from one or more tables based on a query. It allows you to simplify complex queries and provide a consistent interface for accessing data.",
        "explanation": "Views are incredibly useful in database management because they help simplify complex queries and provide a consistent interface for accessing data. Imagine you have a large database with many tables, and you frequently need to retrieve specific information from these tables. Instead of writing the same complex query every time, you can create a view that encapsulates this query. This way, whenever you need the data, you simply query the view, which makes your work much easier and reduces the chance for errors.",
        "key_points": [
          "Key point 1: A view is a virtual table based on a query.",
          "Key point 2: Views simplify complex queries by encapsulating them in one place.",
          "Key point 3: Views provide a consistent interface for accessing data.",
          "Key point 4: Views can be used to hide the complexity of underlying tables.",
          "Key point 5: Views can be updated, just like regular tables."
        ],
        "examples": [
          {
            "title": "Basic Usage",
            "code": "-- Create a view that shows all invoices with their total amounts\nCREATE VIEW invoice_totals AS SELECT invoice_id, invoice_number, invoice_total FROM invoices;",
            "explanation": "This example creates a view named `invoice_totals` that combines the `invoice_id`, `invoice_number`, and `invoice_total` columns from the `invoices` table. Now, whenever you need to see all invoices with their total amounts, you can simply query the `invoice_totals` view instead of writing the full query each time."
          },
          {
            "title": "Practical Example",
            "code": "-- Query the view to get a list of all invoices with their total amounts\nSELECT * FROM invoice_totals;",
            "explanation": "This practical example shows how you can use the `invoice_totals` view to retrieve data. By querying the view, you don't need to remember or write the complex query that combines the necessary columns from the `invoices` table."
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Forgetting to include the AS keyword when creating a view",
            "incorrect_code": "-- Incorrect syntax\nCREATE VIEW invoice_totals SELECT invoice_id, invoice_number, invoice_total FROM invoices;",
            "correct_code": "-- Correct syntax\nCREATE VIEW invoice_totals AS SELECT invoice_id, invoice_number, invoice_total FROM invoices;",
            "explanation": "This mistake happens when someone tries to create a view without using the `AS` keyword. The correct syntax is to use `CREATE VIEW view_name AS SELECT columns FROM table;`. Remembering to include the `AS` keyword is crucial for defining the view correctly."
          }
        ],
        "practice": {
          "question": "Create a view that shows all customers who have made at least one purchase. The view should include the customer's name and email.",
          "solution": "-- Create a view named 'active_customers'\nCREATE VIEW active_customers AS SELECT c.customer_name, c.email FROM customers c JOIN orders o ON c.customer_id = o.customer_id;",
          "explanation": "This practice question asks you to create a view that combines data from the `customers` and `orders` tables. The view should include only those customers who have made at least one purchase. By creating this view, you can easily retrieve information about active customers without having to write complex joins every time."
        }
      },
      "llm_enhanced": true,
      "raw_text_preview": "How to create databases, tables, and indexes \nThe SQL script that creates the AP database \nCREATE TABLE \n( \n• \n• \ninvoices \ninvoice_ id \nvendor_ id \ninvoice_number \ninvoice_date \ninvoice_ total \npayme",
      "content_relevance": {
        "score": 0.37,
        "sql_score": 1.0,
        "concept_score": 0.33,
        "non_sql_penalty": 0.1,
        "is_relevant": true,
        "analysis": "SQL content"
      }
    },
    "stored-procedures": {
      "id": "stored-procedures",
      "title": "Stored Procedures",
      "definition": "Creating and using stored procedures in MySQL",
      "difficulty": "intermediate",
      "page_references": [
        401,
        402,
        403,
        404,
        405,
        406,
        407,
        408,
        409,
        410,
        411,
        412,
        413,
        414,
        415,
        416,
        417,
        418
      ],
      "sections": {
        "definition": {
          "text": "How to create views \nAs you've seen throughout this book, SELECT queries can be complicated, \nparticularly if they use multiple joins, subqueries, or complex functions. \nBecause of that, you may want to save the queries you use regularly. One way \nto do that is to store the statement in a script. Another way is to create a view. \nUnlike scripts, which are stored in files, views are stored as part of the \ndatabase. As a result, they can be used by SQL programmers and by custom \napplications that have access to the database. This provides some advantages \nover using tables directly. \nAn introduction to views .................................................... 382 \nHow views work ........................................................................................... 382 \nBenefits of using views ................................................................................. 384 \nHow to work with views ..................................................... 386 \nHow to c·reate a view .................................................................................... 386 \nHow to create an updatable view ................................................................. 390 \nHow to use the WITH CHECK OPTION clause ........................................ 392 \nHow to insert or delete rows through a view ............................................... 394 \nHow to alter or drop a view ......................................................................... 396 \nPerspective ......................................................................... 398\n\nSectio11 3 \nDatabaJ·e design tt12d i111ple111e11tation \nAn introduction to views \nBefore you learn the details for \\a.'orking \\\\rith vie\\\\'S. it's helpful to get a \ngeneral idea of how views \\vork. ln addition~ it' helpful to consider ome of the \nbenefits of ,,ie,vs o you can deternune wl1ether you want to use them. \nHow views work \nA i •iel1' i~ a SELECT statement that ·s stored in the database a!- a database \nobject To create a vie,a.r. )'OU use a CREATE VIEW staten1ent like the one hown \nin figure 12-l. This statement creates a view named Vendors_Min that retrie,·es \nthe vendor_nan1e9 endor_state. and \"'endor_phone columns from the Vendors \ntable. \nYou can think of a ,,iew as a virtual table that consists on))r of the row. and \ncolumns . pecified in its CREATE V]EW statement. The table or tables that \nare listed in the FROM clau. e are called the /Jase rab/e.s for the ,•ie\\V. ince the \n,,ie,1-, refer. back to the bru e tables, it doesn ,t store any data itself, and it alway. \nreflects the n10~ t current data in the bm e tables. \nTo use a view, you refer to it from another SQL . tatement. ln thi .. figure. \nfor example. the SELECT statement uses the Vendor. _Min ~riew in the FROrvl \nclau. e instead of a table. As a re. ult, this SELECT statement extracts its result \nset from the \\'irtual table that the vie\\\\r' repre. ents. ln thi case, all the rows for \nvendors in California are relrie\\•ed from the view. \nWhen you create a vie\\&.' like the one in this figure, the viev.r i updatable. As \na resull it' po. sible to u e the ,,ie\\\\' in an INSERT, \nPDATE, or DELETE tate-\nment. In this figure. for example, the UPDATE tatement u es the Vendors_Min \nvie\\\\' to update the vendor_phone colunm in the Vendors table for the specified \n, 1endor. \nTo drop a view. you can u .. e the DROP VIEW . tatement as ho\\\\.rn in this \nfigure. This \\.\\t'orks imilarly to tl1e DROP tatements for tables and indexes that \nyou learned about in the pre\\'ioru chapter. \nBecause a view i. stored a an object in a database. it can be u ed by atl}'One \nwho has appropriate pri\\•ilege . That may include user who ba\\·e acces to tl1e \ndatabase through applications thal provide for ad hoc querie. and report genera-\ntion. In addition. that ma)' include cu tom applications that are ,vritten specifi-\ncally to \\Vork ,vith the data in the database. In t·ac~ vie, \nare otten de igned to \nbe u ed \\ViU1 the e l}rpe. ot· application .\n\nHow to create views \nA CREATE VIEW statement for a view named Vendors Min \nCREATE VIEW vendors_min AS \nSELECT vendor_name, vendor_ state , vendor_phone \nFROM vendors \nThe virtual table that's represented by the view \nvendor _name \nvendor _state \nvendor _phone \n\"' \n► \nUS Postal Service \nWI \n(800) 555--1205 \nL \nNational Information Data Ctr \nDC \n{301) 555-8950 \nRegister of Copyrights \nDC \nG®!I \nJobtrak \nCA \n(800) 555-8ns \nNewbrige Book Clubs \nNJ \n(800) 555.-9980 \n(122 rows) \nA SELECT statement that uses the Vendors Min view \nSELECT * FROM vendors_min \nWHERE vendor state= 'CA' \nORDER BY vendor_name \nThe result set that's returned by the SELECT statement \nvendor _name \nvendor _state \nvendor_phone \n► \nAbbey Office Furnishings \nCA \n(559) 555-8300 \nAmerican Express \nCA \n(800) 555-3344 \nASC Signs \nCA \nHMII \nAzteklabel \nCA \n(714) 555-9000 \nBertelsmann Industry Svcs. Inc \nCA \n(805) 555-0584 \nBA Industries \nCA \n(559) 555-1551 \n( 75 rows ) \nAn UPDATE statement that uses a view to update the base table \nUPDATE vendors_min \nSET vendor_phone = '( 800) 555-3941' \nWHERE vendor_ name = 'Register of Copyrights' \nA statement that drops a view \nDROP VIEW vendors_min \nDescription \n• \nA view consists of a SELECT statement that's stored as an object in the database. \nThe tables referenced in the SELECT statement are called the base tables for the \n• \nview. \n• \nWhen you create a view, you can refer to the view anywhere you wo11ld normally \nuse a table in a SELECT, INSERT, UPDATE, or DELETE statement. \n• \nAlthough a view behaves like a virtual table, it doesn't store any data. Instead, a \nview always refers back to its base tables. \n• \nA view can also be referred to as a viewed table because it provides a view to the \nunderlying base tables. \nHow views work \nV \n'\n\nSection 3 \nDatabase design and impleme11,tation, \nBenefits of using views \ncan use views to limit the exposure of the tables in your database to external \nusers and applications. To illustrate, suppose a view refers to a table that you've \ndecided to divide into two tables. To accommodate this change, you simply \nmodify the view. In other words, you don't have to modify any statements that \nrefer to the view. That means that users who query the database using the view \ndon't have to be aware of the change in the database structure, and application \nprograms that use the view don't have to be modified. \nYou can also use views to restrict access to a database. To do that, you \ninclude just the columns and rows you want a user or an application to have \naccess to in the views. Then, you let the user or application access the data only \nthrough the views. For example, let's assume you have an Employees table that \nhas a salary column that contains information about each employee's salary. In \nthis case, you can create a view that doesn't include the salary column for the \nusers who need to view and maintain this table, but who shouldn't be able to \nview salai-ies. Then, you can create another view that includes the salary column \nfor the users who need to view and maintain salai-y information. \nIn addition, you can use views to hide the complexity of a SELECT state-\nment. For example, if you have a long and unwieldy SELECT statement that \njoins multiple tables, you can create a view for that statement. This makes it \neasier for you and other database users to work with this data. \nFinally, when yo11 create a view, you can allow data in the base table to be \nupdated through the view. To do that, you use INSERT, UPDATE, or DELETE \nstatements to work with the view.",
          "pages": [
            401,
            402,
            403,
            404
          ],
          "relevance": {
            "score": 0.8,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.0,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "examples": {
          "text": "How to create views \nSome of the benefits provided by views \nBenefit \nDescription \nDesign independence \nData security \nSimplified queries \nUpdatability \nDescription \nViews can limit the exposure of tables to external users and applications. \nAs a result, if the design of the tables changes, yo1.1 can modify the view \nas necessary so t1sers who query the view don't need to be aware of the \nchange, and applications that use the view don't need to be modified. \nViews can restrict access to the data in a table by using the SELECT \nclat1se to include only selected columns of a table or by using the \nWHERE clause to include 011ly selected rows in a table. \nViews can be used to hide the complexity of retrieval operations. Then, \nthe data can be retrieved using simple SELECT statements that specify a \nview in the FROM clause. \nWith certain restrictions, views can be used to update, insert, and delete \ndata fron1 a base table. \n• \nYou can create a view based on almost any SELECT statement. That means that \nyou can code views that join tables, summarize data, and use subqueries and \nfunctions. \nBenefits of using views\n\nSection 3 \nDatabase design and impleme11,tation, \nHow to work with views \nNow that you have a general understanding of how views work and of the \nbenefits that they provide, you 're ready to learn the details for working with \nthem. \nHow to create a view \na view. In its simplest form, you code the CREATE VIEW keywords, followed \nby the name of the view, followed by the AS keyword and the SELECT state-\nment that defines the view. In this figure, for instance, the first statement creates \na view named Vendors Phone List. This view includes four columns from the \n-\nVendors table for all vendors with invoices. \nIf you execute the first CREATE VIEW statement and a view with that name \ndoesn't already exist in the current database, MySQL adds the view and displays \na message to indicate that the statement was successful. However, if a view with \nthis name already exists, MySQL doesn't add the view and displays a message \nthat indicates that the name is already in use. In that case, you need to specify \na new name for the view, or you need to drop the view that's already using that \nname. \nWhen you code a CREATE VIEW statement, you can specify that you want \nto automatically drop a view that has the same name as the view that you're \ncreating. To do that, you can specify the OR REPLACE keywords after the \nCREATE keyword as shown in all of the examples in this figure except for the \nfirst. \nThe SELECT statement for a view can use most of the features of a normal \nSELECT statement. In this figure, for instance, the second example creates a \nview that joins data from two tables. Similarly, the third statement creates a view \nthat uses a LIMIT clause. \nBy default, the columns in a view are given the same names as the columns \nin the base tables. If a view contains a calculated column, however, you'll want \nto name that column just as you do in other SELECT statements. In addition, \nyou'll need to rename columns from different tables that have the same name. To \ndo that, you can code the column names in the CREATE VIEW clause as shown \nin the fourth example. Or, you can use the AS clause in the SELECT statement \nas shown in the fifth exainple. \nNote that if you use the technique shown in the fourth example, you have to \nassign names to all of the columns. By contrast, if you use the technique shown \nin the fifth example, you only have to assign names to the columns you need to \nrenrune. As a result, you'll typically want to use the technique presented in the \nfifth example.\n\nThe syntax of the CREATE VIEW statement \nCREATE [OR REPLACE] VIEW view_name \n[(column_alias_ l[, column_alias_ 2] ••• )] \nAS \nselect_statement \n[WITH CHECK OPTION] \nA view of vendors that have invoices \nCREATE VIEW vendors_phone_ list AS \nSELECT vendor_name, vendor_contact_ last_ name, \nvendor_contact_ first_name, vendor_phone \nFROM vendors \nHow to create views \nWHERE vendor_ id IN (SELECT DISTINCT vendor_ id FROM invoices) \nA view that uses a join \nCREATE OR REPLACE VIEW vendor_ invoices AS \nSELECT vendor_name, invoice_number, invoice_date, invoice_ total \nFROM vendors \nJOIN invoices ON vendors.vendor_id = invoices.vendor_ id \nA view that uses a LIMIT clause \nCREATE OR REPLACE VIEW topS_ invoice_totals AS \nSELECT vendor_ id, invoice_total \nFROM invoices \nORDER BY invoice_total DESC \nLIMIT 5 \nA view that names all of its columns in the CREATE VIEW clause \nCREATE OR REPLACE VIEW invoices_outstanding \n(invoice_nwnber, invoice_date, invoice_total, balance_due) \nAS \nSELECT invoice n11mher, invoice_date, invoice_total, \ninvoice_total - payment_total - credit_total \nFROM invoices \nWHERE invoice_total - payment_ total - credit_total > 0 \nA view that names just the calculated column in its SELECT clause \nCREATE OR REPLACE VIEW invoices_outstanding AS \nSELECT invoice_n11mher, invoice_date, invoice_total, \ninvoice_total - payment_total - credit_total AS balance_due \nFROM invoices \nWHERE invoice total - payment_ total - credit_total > 0 \nHow to create a view (part 1 of 2)\n\nSection 3 \nDatabase design and impleme11,tation, \nThe example in part 2 of figu1·e 12-3 creates a view that summarizes the \nrows in the Invoices table by vendor. This shows that a view can use agg1·egate \nfunctions and the GROUP BY clause to summarize data. In this case, the rows \nare grouped by vendor name, and a count of the invoices and the invoice total are \ncalculated for each vendor. \nWhen you create a view, the SELECT statement you code within the defini-\ntion of the view can refer to another view instead of a base table. In other words, \nviews can be nested. In theory, nested views can make it easier to present data to \nyour users. In practice, using nested views can make the dependencies between \ntables and views confusing, which can make your code difficult to maintain. As a \nresult, if you use nested views, you should use them careful! y.\n\nA view that summarizes invoices by vendor \nCREATE OR REPLACE VIEW invoice_ summary AS \nSELECT vendor_name, \nCOUNT(*) AS invoice_count, \nSUM(invoice_total) AS invoice_total_ sum \nFROM vendors \nHow to create views \nJOIN invoices ON vendors.vendor_ id = invoices.vendor_ id \nGROUP BY vendor_name \nDescription \n• \nYou use the CREATE VIEW statement to create a view. \n• If you include the OR REPLACE keywords, the CREATE VIEW statement will \nreplace any existing view that has the same name. Otherwise, you must specify a \nname that doesn't already exist for the view. \n• If you name the columns of a view in the CREATE VIEW clause, you have to name \nall of the columns. By contrast, if you name the columns in the SELECT clause, \nyou can name just the columns you need to rename. \n• \nYou can create a view that's based on another view rather than on a table. This is \nknown as a nested view. \nHow to create a view (part 2 of 2)\n\nSection 3 \nDatabase design and impleme11,tation, \nHow to create an updatable view \nOnce you create a view, you can refer to it in a SELECT statement. In \naddition, you may be able to refer to it in INSERT, UPDATE, and DELETE \nstatements to modify the data that's stored in an underlying table. To do that, the \nview must be updatable. Figure 12-4 lists the requirements for creating updat-\nable views. \nThe first two requirements have to do with what you can code in the select \nlist of the SELECT statement that defines the view. In particular, the select list \ncan't include the DISTINCT keyword or aggregate functions. In addition, the \nSELECT statement can't include a GROUP BY or HAVING clause, and two \nSELECT statements can't be joined by a union operation. \nThe CREATE VIEW statement in this figure creates a view that's updatable. \nAs a result, you can refer to it in an INSERT, UPDATE, or DELETE statement. \nFor example, you can use the frrst UPDATE statement shown in this figure to \nupdate the credit_total column in the Invoices base table. Note that to execute \nthis statement in MySQL Workbench, you will need to turn safe update mode off \nas described in chapter 5, since the WHERE clause doesn't refer to a primary or \nforeign key. \nHowever, you can't update any calculated columns that are used by the view. \nFor example, you can't use the second UPDATE statement shown in this figure \nto update the balance_due column that's calculated from the other columns in \nthe view. \nIn addition, when you update data through a view, you can only update the \ndata in a single base table at a time, even if the view refers to two or 1nore tables. \nIn this figure, for instance, the view includes data from two base tables: Vendors \nand Invoices. Because of that, you can code an UPDATE statement that updates \nthe data in the Vendors table or the data in the Invoices table, but not in both \ntables. For example, the first UPDATE statement only refers to columns in the \nInvoices table, so it's able to update data in that table.\n\nHow to create views \nRequirements for creating updatable views \n• \nThe select list can't include a DISTINCT clause. \n• \nThe select list can't include aggregate functions. \n• \nThe SELECT statement can't include a GROUP BY or HAVING clause. \n• \nThe view can' t include the UNION operator. \nA CREATE VIEW statement that creates an updatable view \nCREATE OR REPLACE VIEW balance_due_view AS \nSELECT vendor_name, invoice_n,,rnber, \ninvoice_ total, payment_ total, credit_ total, \ninvoice_ total - payment_ total - credit_ total AS balance_ due \nFROM vendors JOIN invoices ON vendors.vendor_ id = invoices.vendor_ id \nWHERE invoice_ total - payment_ total - credit_ total > 0 \nAn UPDATE statement that uses the view to update data \nUPDATE balance_ due_view \nSET credit total= 300 \nWHERE invoice_ number = '9982771' \nThe response from the system \n(1 row affected) \nAn UPDATE statement that attempts to use the view \nto update a calculated column \nUPDATE balance due view \n-\nSET balance_due = 0 \nWHERE invoice D1irnb11=tr = '9982771' \nThe response from the system \nError Code: 1348. Column 'balance due' is not updatable \nDescription \n• \nAn updatable view is a view that can be used in an INSERT, UPDATE, or DELETE \nstatement to update the data in the base table. If a view isn't updatable, it's called a \nread-only view. \n• \nTl1e requirements for coding updatable views are more restrictive than for coding \nread-only views. That's because MySQL must be able to unambiguously determine \nwhich base tables and columns are affected. \nHow to create an updatable view\n\nSection 3 \nDatabase design and impleme11,tation, \nHow to use the WITH CHECK OPTION clause \nCHECK OPTION clause to prevent an update if it causes the row to be excluded \nfrom the view. To start, the CREATE VIEW statement creates an updatable view \nnamed Vendor_Payment that joins data from the Vendors and Invoices tables and \nretrieves all invoices that have a balance due that's greater than or equal to zero. \nThen, the first UPDATE statement uses this view to modify the \npayment_date and payment_total columns for a specific invoice. This works \nbecause this UPDATE staten1ent doesn't exclude the row from the view. \nHowever, the second UPDATE statement causes the balance due to become \nless than zero. As a result, this statement fails due to the WITH CHECK \nOPTION clause, and an error is displayed. Since this can prevent users from \nstoring invalid data in a database, this clause can be useful in some situations.",
          "pages": [
            405,
            406,
            407,
            408,
            409,
            410,
            411,
            412
          ],
          "relevance": {
            "score": 0.7,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "commonMistakes": {
          "text": "How to create views \nAn updatable view that has a WITH CHECK OPTION clause \nCREATE OR REPLACE VIEW vendor_payment AS \nSELECT vendor_name, invoice_ number, invoice_date, payment_date, \ninvoice_ total, credit_total, payment_total \nFROM vendors JOIN invoices ON vendors.vendor_ id = invoices.vendor_ id \nWHERE invoice_total - payment_total - credit_total >= 0 \nWITH CHECK OPTION \nA SELECT statement that displays a row from the view \nSELECT* FROM vendor_payment \nWHERE invoice_ DtJmh~r = 'P-0608' \nThe result set \nvendor _name \n► \nMaDoy Lithographing Inc \ninvoice _number \nP-0608 \ninvoice date \npayment_date \n2018-0 7 _23;--ltml®1!1!i1 \ninvoice_total \n20551.18 \nAn UPDATE statement that updates the view \nUPDATE vendor_payment \nSET payment_total = 400.00, \npayment_date = '2018-08-01' \nWHERE invoice_ numher = 'P-0608' \nThe response from the system \n(1 row affected) \nThe same row data after the update \ncredit_total \n1200.00 \npayment_total \n0.00 \nvendor _name \ninvoice_number \ninvoice_date \npayment_date \ninvoice_total \ncredit_total \npayment_total \n► \nMaDoy Lithographing Inc \nP-0608 \n2018-07-23 \n2018-08-01 \n20551.18 \n1200. 00 \n.WO. 00 \nAn UPDATE statement that attempts to update the view \nUPDATE vendor_payment \nSET payment_ total = 30000.00, \npayment_date = '2018-08-01' \nWHERE invoice_number = 'P-0608'; \nThe response from the system \nError Code: 1369. CHECK OPTION failed 'ap.vendor_payment' \nDescription \n• If you don't include a WITH CHECK OPTION clause when you create a view, a \nchange you make through the view can cause the modified rows to no longer be \nincluded in the view. \n• If you specify a WITH CHECK OPTION clause when you create a view, an en·or \nwill occur if you try to modify a row in such a way that it would no longer be \nincluded in the view. \nHow to use the WITH CHECK OPTION clause\n\nSection 3 \nDatabase design and impleme11,tation, \nHow to insert or delete rows through a view \nIn the previous figures, you learned how to use a view to update data in the \nunderlying tables. Now, figure 12-6 shows how to use a view to insert or delete \ndata in an underlying table. In general, this works the same as it does when you \nwork directly with a table. However, due to table constraints, using a view to \ninsert or delete rows often results in errors like the ones shown in this figure. \nAs a result, it's generally more common to work directly with base tables when \ninserting or deleting rows. \nAt the top of this figure, you can see a CREATE VIEW statement for a view \nnamed ibm invoices. This view retrieves columns and rows from the Invoices \ntable for the vendor named IBM, which has a vendor_id of 34. Then, the \nINSERT statement that follows attempts to insert a row into the Invoices table \nthrough this view. \nThis insert operation fails, though, because the view and the INSERT state-\nment don't include all of the required columns for the Invoices table. In this case, \na value is required for other columns in the Invoices table, including the \nvendor_id and invoice_due_date columns. As a result, to use a view to insert \nrows, you must design a view that includes all required columns for the under-\n1 ying table. \nIn addition, an INSERT statement that uses a view can insert rows into only \none table. That's true even if the view is based on two or more tables and all of \nthe required columns for tl1ose tables are included in the view. In that case, you \ncould use a separate INSERT statement to insert rows into each table through the \n• \nview. \nThis figure also shows how to delete rows through a view. To do that, you \nuse a DELETE statement like the ones shown here. To start, the first DELETE \nstatement attempts to delete an invoice from the Invoices table through the \nibm_invoices view. However, this DELETE statement fails because the \nInvoice_Line_Items table contains rows related to the invoice. This causes an \nerror message like the one in this figure to be displayed. To get this DELETE \nstatement to work, you must frrst delete the related line items for the invoice. \nThis is illustrated by the last two DELETE statements in this figure.\n\nHow to create views \nA statement that creates an updatable view \nCREATE OR REPLACE VIEW ibm_invoices AS \nSELECT invoice_n11mh11=1r, invoice_date, invoice total \nFROM invoices \nWHERE vendor id= 34 \nThe contents of the view \ninvoice _number \n► \nQP58872 \nQ545443 \ninvoice date \ninvoice_ total \n2018-05-07 \n116.54 \n2018-06-09 \n1083. 58 \nAn INSERT statement that fails due to columns that don't have values \nINSERT INTO ihm_invoices \n(invoice_numher, invoice_date, invoice_total) \nVALUES \n( 'RA23988', '2018-07-31', 417 .34) \nThe response from the system \nError Code: 1423. Field of view •ap.ibm_invoices' underlying table doesn't \nhave a default value \nA DELETE statement that fails due to a foreign key constraint \nDELETE FROM ihm_invoices \nWHERE invoice_n11mhP.r = 'Q545443' \nThe response from the system \nError Code: 1451. Cannot delete or update a parent row: a foreign key \nconstraint fails ('ap'.'invoice_line_items', CONSTRAINT \n'line_ items_fk_invoices' FOREIGN KEY ( 'invoice_id' ) REFERENCES 'invoices' \n{ ' invoice id• ) ) \nTwo DELETE statements that succeed \nDELETE FROM invoice_ line_ items \nWHERE invoice_ id = (SELECT invoice_ id FROM \nWHERE invoice number= \nDELETE FROM ihm invoices \nWHERE invoice_n11mher = • QS45443'; \nThe response from the system \n(1 row affected) \nDescription \n• \n• \n1nvo1ces \n'Q545443'); \n• \nYou can use the INSERT statement to insert rows into a base table through a \nview. To do that, you name the view in the INSERT clause. Both the view and the \nINSERT statement must include all of the columns from the base table that require \na value. \n• \nIf the view names more than one base table, an INSERT statement can insert data \ninto only one of those tables. \n• \nYou can use the DELETE statement to delete rows from a base table through a \nview. To do that, you name the view in the DELETE clause. For this to work, the \nview must be based on a single table. \nHow to insert or delete rows through a view",
          "pages": [
            413,
            414,
            415
          ],
          "relevance": {
            "score": 0.7,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        }
      },
      "educational_notes": {
        "definition": "A stored procedure is a precompiled sequence of SQL statements that are stored in the database and can be executed by name.",
        "explanation": "Stored procedures are essential for several reasons:\n1. **Performance**: They reduce network traffic as they execute on the server side.\n2. **Security**: They limit what users can do, enhancing security by restricting access to underlying data.\n3. **Reusability**: Procedures can be called multiple times without rewriting code.\n4. **Maintenance**: Changes made in a procedure affect all calls to it, simplifying updates.",
        "key_points": [
          "A stored procedure is a collection of SQL statements that are compiled and stored on the database server.",
          "They enhance performance by reducing network traffic and executing on the server side.",
          "Stored procedures improve security by limiting user access to underlying data.",
          "They promote reusability, allowing multiple calls without rewriting code."
        ],
        "examples": [
          {
            "title": "Basic Usage",
            "code": "-- Create a simple stored procedure\nCREATE PROCEDURE GetEmployeeDetails (@empID INT)\nAS\nBEGIN\nSELECT * FROM Employees WHERE EmployeeID = @empID;\nEND;",
            "explanation": "This example demonstrates how to create a stored procedure that retrieves details of an employee based on their ID."
          },
          {
            "title": "Practical Example",
            "code": "-- Call the stored procedure EXEC GetEmployeeDetails 101;",
            "explanation": "This practical example shows how to execute the stored procedure created in the previous example.",
            "validation_note": "SQL auto-fixed: "
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Forgetting to declare parameters",
            "incorrect_code": "-- Incorrect: Missing parameter declaration\nCREATE PROCEDURE GetEmployeeDetails\nAS\nBEGIN\nSELECT * FROM Employees WHERE EmployeeID = @empID;\nEND;",
            "correct_code": "-- Correct: Declaring the parameter\nCREATE PROCEDURE GetEmployeeDetails (@empID INT)\nAS\nBEGIN\nSELECT * FROM Employees WHERE EmployeeID = @empID;\nEND;",
            "explanation": "This mistake occurs when creating a stored procedure without declaring parameters. Always ensure all necessary parameters are declared."
          }
        ],
        "practice": {
          "question": "Create a stored procedure that updates the salary of an employee based on their ID.",
          "solution": "-- Solution: Create and execute the stored procedure\nCREATE PROCEDURE UpdateEmployeeSalary (@empID INT, @newSalary DECIMAL(10,2))\nAS\nBEGIN\nUPDATE Employees SET Salary = @newSalary WHERE EmployeeID = @empID;\nEND;\n-- Execute the procedure\nEXEC UpdateEmployeeSalary 101, 5000.00;"
        }
      },
      "llm_enhanced": true,
      "raw_text_preview": "How to create views \nAs you've seen throughout this book, SELECT queries can be complicated, \nparticularly if they use multiple joins, subqueries, or complex functions. \nBecause of that, you may want ",
      "content_relevance": {
        "score": 0.7,
        "sql_score": 1.0,
        "concept_score": 1.0,
        "non_sql_penalty": 0.1,
        "is_relevant": true,
        "analysis": "SQL content"
      }
    },
    "functions-murach": {
      "id": "functions-murach",
      "title": "Stored Functions",
      "definition": "Creating user-defined functions in MySQL",
      "difficulty": "intermediate",
      "page_references": [
        417,
        418,
        419,
        420,
        421,
        422,
        423,
        424,
        425,
        426,
        427,
        428
      ],
      "sections": {
        "definition": {
          "text": "A statement that creates a view \nCREATE VIEW vendors_ sw AS \nSELECT* \nFROM vendors \nWHERE vendor state IN ( 'CA' 'AZ' 'NV' 'NM') \n, \n, \n, \nHow to create views \nA statement that replaces the view with a new view \nCREATE OR REPLACE VIEW vendors_ sw AS \nSELECT* \nFROM vendors \nWHERE vendor_state IN ('CA','AZ','NV','NM','UT', 'CO') \nA statement that drops the view \nDROP VIEW vendors_ sw \nDescription \n• \nTo alter a view, use the CREATE OR REPLACE VIEW statement to replace the \nexisting view with a new one. \n• \nTo delete a view from the database, use the DROP VIEW statement. \nHow to alter or drop a view\n\nSection 3 \nDatabase design and impleme11,tation, \nPerspective \nIn this chapter, you learned how to create and use views. As you've seen, \nviews provide a powerful and flexible way to predefine the data that can be \nretrieved from a database. By using them, you can restJ.ict the access to a \ndatabase while providing a consistent and simplified way for end t1sers and \napplication programs to access that data. \nTerms \n• \nview \nnested view \nupdatable view \nread-only view \nbase table \nviewed table \nExercises \n1. \nCreate a view named open_items that shows the invoices that haven't been \npaid. \nThis view should return four columns from the Vendors and Invoices tables: \nvendor_name, invoice_number, invoice_total, and balance_due \n(invoice_total - payment_total - credit_total). \nA row should only be returned when the balance due is greater than zero, and \nthe rows should be in sequence by vendor_name. \n2. \nWrite a SELECT statement that returns all of the columns in the open_items \nview that you created in exercise 1, with one row for each invoice that has a \nbalance due of $1000 or more. \n3. \nCreate a view named open_items_summary that returns one summary row for \neach vendor that has invoices that haven't been paid. \nEach row should include vendor_name, open_item_count (the number of \ninvoices with a balance due), and open_item_total (the total of the balance \ndue amounts) \nThe rows should be sorted by the open item totals in descending sequence. \n4. \nWrite a SELECT statement that returns just the first 5 rows from the \nopen_items_summary view that you created in exercise 3. \n5. \nCreate an updatable view named vendor_address that returns the vendor_id \ncolumn and all of the address columns for each vendor. \n6. \nWrite an UPDATE statement that changes the address for the 1·ow with a \nvendor ID of 4 so the suite number (Ste 260) is stored in the vendor_address2 \ncolumn instead of the vendor address 1 column. \n-\n\nStored program development \nThis section presents the essential skills for using MySQL to create stored \nprograms. These are the skills that will take your SQL capabilities to \nthe next level. In chapter 13, you'll learn the language basics for writing \nprocedural code within sto1·ed programs. In chapter 14, you '11 learn how \nto manage transactions and locking from within stored programs. In \nchapter 15, you'll learn how to create two types of stored programs: stored \nprocedures and functions. And in chapter 16, you'll learn how to create two \nmore types of stored programs: triggers and events.",
          "pages": [
            417,
            418,
            419,
            420
          ],
          "relevance": {
            "score": 0.55,
            "sql_score": 1.0,
            "concept_score": 0.5,
            "non_sql_penalty": 0.0,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "examples": {
          "text": "Language skills \nfor writing stored programs \nThis chapter presents the basic language skills that you need to write stored \nprograms. With the skills presented in this chapter, you'll be able to code \nstored programs that provide functionality similar to procedural programming \nlanguages like Python, PHP, Java, C++, C#, and Visual Basic. \nIf you have experience with another procedural language, you shouldn't \nhave any trouble with the skills presented in this chapter. However, you should \nknow that the programming power of MySQL is limited when compared to \nother languages. That's because MySQL is designed specifically to work with \nMySQL databases rather than as a general-purpose programming language. \nFor its intended use, however, MySQL is both powerful and flexible. \nAn introduction to stored programs ................................ 402 \nFour types of stored programs .................................................................... 402 \nA script that creates and calls a stored procedure ...................................... 402 \nA summary of statements for coding stored programs .............................. 404 \nHow to write procedural code ........................................... 406 \nHow to display data .................................................................................... 406 \nHow to declare and set variables ................................................................ 408 \nHow to code IF statements .......................................................................... 410 \nHow to code CASE statements .................................................................... 412 \nHow to code loops ....................................................................................... 414 \nHow to use a cursor ..................................................................................... 416 \nHow to declare a condition handJer ............................................................. 418 \nHow to use a condition handJer ................................................................... 420 \nHow to use multiple condition handlers ...................................................... 424 \nPerspective ......................................................................... 426\n\nSection 4 \nStored prvgram development \nAn introduction to stored progran,s \nMySQL provides for using standard SQL to write stored programs. Stored \nprograms can include procedural code that controls the flow of execution. \nFour types of stored programs \nin MySQL. A stored procedure can be called from an application that has access \nto the database. For example, a PHP application can call a stored procedure and \npass parameters to it. A stored function can be called from a SQL statement, \njust like the functions provided by MySQL that you learned about in chapter \n9. However, you can customize stored functions so they perform tasks that are \nspecific to your database. Stored procedures and stored functions are similar in \nmany ways and are also known as stored routines. \nTriggers and events don't need to be called. Instead, they execute automati-\ncally when something happens. A trigger executes when an INSERT, UPDATE, \nor DELETE statement is run against a specific table. And an event executes at a \nscheduled time. \nA script that creates and calls \na stored procedure \nThe script shown in figure 13-1 creates a stored procedure named test that \ndoesn't accept any parameters. Then, it calls this procedure to execute the state-\nments that are stored within it. This provides a way for you to experiment with \nthe procedural language features that are available from MySQL. That's why this \nscript is used throughout this chapter. \nThis script begins with the USE statement, which selects the AP database. \nThen, the DROP PROCEDURE IF EXISTS command drops the procedure \nnamed test if it already exists. This suppresses any error messages that would be \ndisplayed if you attempted to drop a procedure that didn't exist. \nThe DELIMITER statement changes the delimiter from the default delimiter \nof the semicolon(;) to two slashes(//). This is necessary because the semicolon \nis used within the CREATE PROCEDURE statement, and it allows you to use \ntwo front slashes(//) to identify the end of the CREATE PROCEDURE state-\nment. Although we use two front slashes as the delimiter in this book, it's also \ncommon to see two dollar signs ($$) or two semicolons (; ;) t1sed as the delimiter. \nThe CREATE PROCEDURE statement creates the procedure. To indicate \nthat this procedure doesn't accept any parameters, this code includes an empty \nset of parentheses after the procedure's name. \nThe code within the CREATE PROCEDURE statement is defined by a block \nof code that begins with the BEGIN keyword and ends with the END keyword. \nWithin this block of code, the DECLARE statement defines a variable named \nsum_balance_due_ var of the DECIMAL type. This data type corresponds to the\n\nLanguage skills for writing stored progra,ns \nFour types of stored programs \nType \nDescription \nStored procedure \nStored function \nCan be called from an appljcation that has access to the dalabase. \nTrigger \nEvent \nCan be called from a SQL statement. A stored function works much \nlike the functions provided by MySQL that are described in chapter 9. \nIs executed in response to an INSERT, UPDATE, or DELETE state-\nment on a specified table. \nls executed at a scbeduJed time. \nA script that creates and calls a stored procedure named test \nUSE ap; \nDROP PROCEDURE IF EXISTS test; \n-- Change statement delimiter from semicolon to double front slash \nDELIMITER // \nCREATE PROCEDURE test() \nBEGIN \nDECLARE sum_balance_ due_var DECIMAL (9, 2); \nSELECT SUM(invoice_total -\npayment_total - credit_total ) \nINTO sum_balance_ due_var \nFROM invoices \nWHERE vendor_id = 95; \nIF sum_balance_ due_var > 0 THEN \nSELECT CONCAT('Balance due: $', sum_balance_due_var) AS message; \nELSE \nSELECT 'Balance paid in full' AS message; \nEND IF; \nEND// \n-- Change statement delimiter from double front slash to semicolon \nDELIMITER; \nCALL test( ) ; \nThe response from the system \nmessage \n--;-f \nBalance paid in full \nDescription \n• \nA stored program consists of one or 1nore SQL statements stored in the database \nfor later use. \n• \nWithin a stored program, you can write procedural code that controls the flow of \nexecution. That inclt1des if/else constructs, loops, and error-handling code. \nAn introduction to stored programs\n\nSection 4 \nStored prvgram development \ndata types that are used for the invoice_total, payment_total, and credit_total \ncolumns of the Invoices table. Then, a SELECT statement sets the value that's \nstored in this variable. To do that, the SELECT statement returns a single value \nand includes an INTO clause that specifies the name of the variable. As a result, \nthe SELECT statement selects the value into the variable. \nAfter the first SELECT statement, the script uses an IF statement to test the \nvalue of the variable. If the variable is greater than zero, the statement in the \nTHEN clause uses a SELECT statement to return a result set that indicates the \nbalance that is due. Otherwise, the statement in the ELSE clause uses a SELECT \nstatement to return a result set that indicates that the balance is paid in full. \nAfter the stored procedure has been created, this script uses the DELIMTER \nstate1nent to change the delimiter back to the default deli1niter of a se1nicolon \n(;). Then, it uses a CALL statement to call the stored procedure. This executes \nthe code stored within the procedure. You'll learn 1nore about how the CALL \nstatement works in chapte1· 15. \nFor now, don't won)' if you don't understand the coding details for this \nscript. Instead, focus on the general ideas. Later in this chapter, you '11 leru·n the \ndetails that you need to use the procedural language that's provided by MySQL. \nThen, in chapter 15, you'll learn more about the details of creating stored \nprocedures. \nA summary of statements \nfor coding stored programs \nflow of execution within stored programs. These statements can be used to add \nfunctionality that's similar to the functionality provided by procedural languages. \nAfter the SQL statements for writing procedural code, this figure presents \none SQL statement that you're already familiar with that's commonly used \nwithin stored programs: the SELECT statement. When working with stored \nprograms, you can use the SELECT statement to return a result set to the calling \nprogram. This is often used to display messages that can help the programmer \ndevelop and debug a stored program. \nIn addition, you can use the SELECT staten1ent with an INTO clause to \nretrieve data from the database and store it in one or more variables. You saw \nan example of this in the previous figure, and you'll learn more about how this \nworks as you progress through this chapter.\n\nLanguage skills for writing stored progra,ns \nSQL statements for controlling the flow of execution \nKeywords \nDescription \nIF ... ELSEIF .. . ELSE \nCASE .. . WHEN .. . ELSE \nWHILE . .. DO ... LOOP \nREPEAT . . . UNTI L ... END REPEAT \nDECLARE CURSOR FOR \nDECLARE . .. HANDLER \nControls the flow of execution based on a condition. \nControls the flow of exect1tion based on a condition. \nRepeats statements while a condition is true. \nRepeats statements whj)e a condition is true. \nDefines a result set that can be processed by a loop. \nDefines a handler that's executed when a stored \nprogram encounters an error. \nA SQL statement used within stored programs \nStatement \nDescription \nSELECT \nDescription \nReturns a result set to the calling program. Or, \nretrieves data from the database and stores it \nso it can be processed by the stored program. \n• \nMySQL provides statements that can be used within scripts to add functionality \nsimilar to that provided by procedural programming languages. \nA summary of statements for working with stored programs\n\nSection 4 \nStored prvgram development \nHow to write procedural code \nNow that you have a general idea of how stored programs work, you 're \nready to learn the details for writing procedural code that's used within stored \nprograms. \nHow to display data \nAs you develop stored programs, you often need to display messages as \nshown in figure 13-3. This can help you make sure that the stored program \nis executing correctly, and it can help you debug your programs. To display \na message, you can use a SELECT statement. In this figure, for example, the \nstored procedure uses a SELECT statement to return a result set that contains a \nsingle row with a column named message that contains a string that says, ''This \nis a test.\" \nTo display more complex messages, you can code 1nore complex SELECT \nstatements. In the next figure, for example, you'll see a stored procedure that \nuses a SELECT statement that returns a result set with multiple values. Then, \nthe SELECT statement stores those values in variables so the variables can be \nfo1·matted and displayed. \nThis figure only shows the DELIMTER statement and the CREATE \nPROCEDURE statement that are necessary to create the stored procedure. \nBefore you execute these statements, you may need to select the appropriate \ndatabase and drop any procedures with the same name as shown in figure 13-1. \nSitnilarly, after you execute these statements, the stored procedure isn't executed \nuntil you call it as shown in figure 13-1.",
          "pages": [
            421,
            422,
            423,
            424,
            425,
            426
          ],
          "relevance": {
            "score": 0.7,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "commonMistakes": {
          "text": "Language skills for writing stored progra,ns \nA stored procedure that displays a message \nDELIMITER// \nCREATE PROCEDURE test() \nBEGIN \nSELECT 'This is a test.' AS message; \nEND// \nThe response from the system when the procedure is called \nmessage \n► \nThis is a test. \nDescription \n; \n• \nTo display a message from a stored program, you can use the SELECT statement to \nretu1n a result set. \nHow to display data\n\nSection 4 \nStored prvgram development \nHow to declare and set variables \nA variable stores a value that can change as the procedure executes. Figure \n13-4 shows how to declare and set variables. \nTo declare a variable, you code the DECLARE keyword followed by the \nvariable name and data type. In this figure, for example, the stored procedure \nbegins by declaring five variables. The data type for each variable corresponds to \nthe data type that's used for a column that's related to the variable. For example, \nthe first two variables are declared with the DECIMAL type. This is the same \ndata type that's used by the invoice_total column of the Invoices table. The third \nvariable also uses this data type, but with 4 decimal places instead of 2. The last \ntwo variables use the INT type, which matches the data type for the invoice_id \nand vendor_id columns. When specifying the data type for a variable, you can \nuse any of the data types that you can use when you specify the data type for a \ncolumn. \nOnce you declare a variable, you can assign a value to it using the SET \nstatement. To assign a literal value or the result of an expression, you can code \nthe assignment operator ( =) followed by the literal value or the expression. In \nthe script in this figure, for example, the frrst SET statement uses the assignment \noperator to assign a valt1e of 95 to the variable named vendor_id_ var. The second \nSET statement uses the assignment operator to assign the result of a calculation \nto the variable named percent_difference. \nYou can also use the DEFAULT keyword to assign a default value to a \nvariable when you declare it. Then, the default value is used if another value \nisn't assigned to the variable. For this to work, the default value must be a literal \nvalue, not an expression. To declare and assign a value to the vendor_id_ var \nvariable, for example, you could code a statement like this: \nDECLARE vendor_ i d_var INT DEFAULT 95; \nIf you want to assign a value that's returned by a SELECT statement to a \nvariable, you can add an INTO clause to a SELECT statement. In the script in \nthis figure, for example, the first SELECT statement uses the INTO clause to \nassign the tlu·ee values that are returned by the SELECT statement to the three \ncorresponding variables that are specified by the INTO clause. For this to work, \nthe SELECT statement must return one value for each of the variables that are \nspecified in the INTO clause. In addition, the data types for the colu1nns must be \ncompatible with the data types for the variables. \nTo review, the script in this figure uses five variables to calculate the percent \ndifference between the minimum and maximum invoices for a particular vendor. \nTo do that, this script uses the assignment operator to assign a value to two of the \nvariables. In addition, it uses the INTO clause of a SELECT statement to assign \nvalues to the other three variables. Finally, a SELECT statement displays the \nvalues of four of the variables. \nIn this figure, the script uses the equals sign ( =) as the assignment operator. \nHoweve1·, MySQL also allows you to use a colon plus the equals sign(:=) as the \nassignment operator. So, if you are reviewing another programmer's code, you \nmight see this operator.",
          "pages": [
            427,
            428
          ],
          "relevance": {
            "score": 0.45,
            "sql_score": 1.0,
            "concept_score": 0.5,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        }
      },
      "educational_notes": {
        "definition": "A stored function is a precompiled block of SQL code that performs a specific task and returns a single value. It allows you to encapsulate complex logic and reuse it throughout your database applications.",
        "explanation": "Stored functions are incredibly useful for performing calculations, data transformations, or any repetitive tasks within the database itself. They help in reducing network traffic by moving computation from the application layer to the database layer. Here’s how they work:\n\n1. **Creating a Stored Function**: You define a stored function using the `CREATE FUNCTION` statement. This involves specifying the function name, parameters (if any), and the SQL code that performs the task.\n2. **Calling a Stored Function**: Once created, you can call this function like any other SQL expression within your queries or procedures.\n3. **Benefits of Using Functions**: They improve performance by reducing the need to execute complex logic multiple times. They also enhance security by keeping sensitive business logic on the database server.",
        "key_points": [
          "A stored function is a precompiled block of SQL code that performs a specific task and returns a single value.",
          "They are useful for encapsulating complex logic, reducing network traffic, improving performance, and enhancing security.",
          "Stored functions can take parameters and return values, making them versatile for various database operations."
        ],
        "examples": [
          {
            "title": "Basic Usage",
            "code": "-- CREATE a function to calculate the total price including tax CREATE FUNCTION CalculateTotal(price DECIMAL(10,2), tax_rate DECIMAL(5,2)) RETURNS DECIMAL(10,2) DETERMINISTIC BEGIN DECLARE total DECIMAL(10,2); SET total = price * (1 + tax_rate / 100); RETURN total; END;",
            "explanation": "This example shows how to create a function that calculates the total price including tax. The function takes two parameters: `price` and `tax_rate`, and returns the calculated total.",
            "validation_note": "SQL auto-fixed: "
          },
          {
            "title": "Practical Example",
            "code": "-- Use the function in a query\nSELECT product_name, CalculateTotal(price, 10) AS total_price FROM products;",
            "explanation": "This practical example demonstrates how to use the `CalculateTotal` function in a SQL query to get the total price including tax for each product."
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Forgetting to declare the return type",
            "incorrect_code": "-- Incorrect: Missing RETURN TYPE CREATE FUNCTION CalculateTotal(price DECIMAL(10,2), tax_rate DECIMAL(5,2)) BEGIN DECLARE total DECIMAL(10,2); SET total = price * (1 + tax_rate / 100); END;",
            "correct_code": "-- Correct: Declared RETURN TYPE CREATE FUNCTION CalculateTotal(price DECIMAL(10,2), tax_rate DECIMAL(5,2)) RETURNS DECIMAL(10,2) BEGIN DECLARE total DECIMAL(10,2); SET total = price * (1 + tax_rate / 100); RETURN total; END;",
            "explanation": "The function must declare its return type using the `RETURNS` keyword. Missing this will cause a syntax error."
          }
        ],
        "practice": {
          "question": "Create a stored function that calculates the average salary for each department in the `employees` table.",
          "solution": "-- Solution\nCREATE FUNCTION AverageSalaryByDepartment(department_id INT)\nRETURNS DECIMAL(10,2)\nDETERMINISTIC\nBEGIN\n  DECLARE avg_salary DECIMAL(10,2);\n  SELECT AVG(salary) INTO avg_salary FROM employees WHERE department_id = department_id;\n  RETURN avg_salary;\nEND;"
        }
      },
      "llm_enhanced": true,
      "raw_text_preview": "A statement that creates a view \nCREATE VIEW vendors_ sw AS \nSELECT* \nFROM vendors \nWHERE vendor state IN ( 'CA' 'AZ' 'NV' 'NM') \n, \n, \n, \nHow to create views \nA statement that replaces the view with ",
      "content_relevance": {
        "score": 0.7,
        "sql_score": 1.0,
        "concept_score": 1.0,
        "non_sql_penalty": 0.1,
        "is_relevant": true,
        "analysis": "SQL content"
      }
    },
    "triggers": {
      "id": "triggers",
      "title": "Triggers",
      "definition": "Automatic actions on INSERT, UPDATE, DELETE",
      "difficulty": "advanced",
      "page_references": [
        429,
        430,
        431,
        432,
        433,
        434,
        435,
        436,
        437,
        438,
        439,
        440
      ],
      "sections": {
        "definition": {
          "text": "Language skills for writing stored progra,ns \nThe syntax for declaring a variable \nDECLARE variable_name data_type [DEFAULT literal_value]; \nThe syntax for setting a variable to a literal value or an expression \nSET variable_name = {literal_value lexpression}; \nThe syntax for setting a variable to a selected value \nSELECT column_ l[, column_ 2] ••• \nINTO variable_ name_ l[, variable_name_ 2] ••• \nA stored procedure that uses variables \nDELIMITER/ / \nCREATE PROCEDURE test() \nBEGIN \nDECLARE max_ invoice_total \nDECLARE min invoice total \n-\nDECLARE percent_difference \nDECLARE count_ invoice id \nDECLARE vendor id var \nSET vendor_ id_var = 95; \nDECIMAL (9,2); \nDECIMAL(9,2); \nDECIMAL (9,4); \nINT; \nINT; \nSELECT MAX(invoice_total), MIN(invoice_total), COUNT(invoice_ id) \nINTO max_ invoice_total, min_ invoice_total, count_ invoice_ id \nFROM invoices WHERE vendor_ id = vendor_ id_var; \nSET percent_difference = (max_ invoice_total - min_ invoice_total) / \nmin_ invoice_ total * 100; \nSELECT CONCAT('$', max_ invoice_total) AS 'Maximum invoice', \nCONCAT('$', min_ invoice_total) AS 'Minimum invoice•, \nCONCAT(' %', ROUND (percent_difference, 2 ) ) AS 'Percent difference', \ncount invoice id AS 'Number of invoices'; \nEND// \nThe response from the system when the procedure is called \nMaxmum \ninvoice \n► \n$46.21 \nDescription \nMinimum \ninvoice \nS16.33 \nPercent \ndifference \n%182.98 \nNumber of \ninvoices \n• \nA variable stores a value that can change as a stored program executes. \n.I \n• \nA variable must have a name that's different from the names of any columns used \nin any SELECT statement within the stored program. To distinguish a variable from \na column, you can add a suffix like ''_ var'' to the variable name. \nHow to declare and set variables\n\nSection 4 \nStored prvgram development \nHow to code IF statements \nstatements based on a value that's returned by a Boolean expression. A Boolean \nexpression is an expression that returns a true value or a false value. \nThe script in this figure uses an IF statement to test the value of a variable. \nThis variable contains the oldest invoice due date in the Invoices table. If this \ndue date is less than the current date, the Boolean expression evaluates to true, \nand the statement in the IF clause shows that outstanding invoices are overdue. \nIf the value is equal to the current date, the statement in the ELSEIF clause \nindicates that outstanding invoices are due today. If neither of these conditions \nis true, the oldest due date must be greater than the current date. As a result, the \nscript indicates that no invoices are overdue. \nIn this figure, the IF statement only contains one ELSEIF clause. However, \nyou can add as many ELSEIF clauses as you need. As a result, you can code \ndozens of these clauses if you need them. But if you don't need an ELSEIF \nclause, you don't have to code one. For example, it's common to code an IF \nstatement without an ELSEIF clause like this: \nIF first_ invoice_due_date < NOW() THEN \nSELECT 'Outstanding invoices are overdue!'; \nELSE \nSELECT 'No invoices are overdue.'; \nEND IF; \nSimilai·ly, the ELSE clause is optional. As a result, it's common to code an \nIF statement like this: \nEND IF; \nYou can also nest one IF statement within another like this: \nIF first_ invoice_due_date <= NOW() THEN \nIF first_ invoice_due_date = NOW() THEN \nSELECT \nI TODAY! I ; \nEND IF; \nEND IF; \nIn this case, the outer IF statement is executed when the oldest invoice due date \nis less than or equal to the current date. However, the nested IF statement is only \nexecuted when the oldest invoice due date is equal to the current date. In other \nwords, if the current date equals the oldest invoice due date, this code returns \ntwo result sets instead of one. As you'll see later in this chapter, you can also \nnest an IF statement within other types of statements such as loops.\n\nLanguage skills for writing stored progra,ns \nThe syntax of the IF statement \nIF boolean_expression THEN \nstatement_ l; \n[statement_ 2;] ... \n[ELSEIF boolean_expression THEN \nstatement_ !; \n[statement_2;] ... ] ... \n[ELSE \nstatement_ !; \n[statement_ 2;] ... ] \nEND IF; \nA stored procedure that uses an IF statement \nDELIMITER// \nCREATE PROCEDURE test() \nBEGIN \nDECLARE first invoice due date DATE; \nSELECT MIN(invoice_ due_date) \nINTO first_ invoice_ due_date \nFROM invoices \nWHERE invoice_ total -\npayment_total - credit_total > O; \nIF first_ invoice_due_ date < NOW() THEN \nSELECT •outstanding invoices are overdue!'; \nELSEIF first_ invoice_ due_ date = NOW() THEN \nSELECT •outstanding invoices are due today!'; \nELSE \nSELECT 'No invoices are overdue.'; \nEND IF; \nEND// \nThe response from the system when the procedure is called \nOutstanding invoices are overdue! \n-\n► \nDescription \n• \nYou can use an IF statement to execute one or more statements depending on one \nor more Boolean expressions. A Boolean express·ion is an expression that evaluates \nto true or false. \n• \nYou can nest an IF statement within another IF statement or within other SQL state-\nments such as the statements for coding loops. \n• \nYou can also code parentheses around the Boolean expressions in an IF statement \nlike this: \nIF (first_ invoice_ due_ date < NOW()) THEN \nYou may see other programmers use this technique. \nHow to code IF statements \n•••\n\nSection 4 \nStored prvgram development \nHow to code CASE statements \nIn chapter 9, you learned how to code a CASE expression within a SELECT \nstatement. A CASE expression like that usually runs faster than a CASE state-\nment that's coded within a stored program. As a result, if you can use a CASE \nexpression to solve the task at hand, you should. However, you may sometimes \nneed to use a CASE statement as shown in figure 13-6. \nThe script in this figure shows how to use a simple CASE statement to \nexecute one or more statements depending on a value that's returned by an \nexpression. To do that, you begin by coding the CASE keyword followed by an \nexpression that returns a value. In this script, the variable that's coded after the \nCASE statement returns an integer value that indicates the payment terms for an \n• \n• \n1nvo1ce. \nAfter the CASE clause, you can code one or more WHEN clauses that \ncontain the statement or statements that are executed for each of the values that \nmay be returned. In this example, the CASE statement includes three WHEN \nclauses for the values of 1, 2, and 3. Each of these clauses displays an appro-\npriate message. \nAfter the WHEN clauses, you can code an optional ELSE clause that's \nexecuted if the value that's returned doesn't match the values coded in any of the \nWHEN clauses. This works much like the ELSE clause that's available from the \nIF statement. \nAlthough this figure doesn't show an example of it, you can also use a \nsearched CASE statement to execute one or more statements depending on \none or more Boolean expressions. This works similarly to an IF statement. For \nexample, you can use a searched CASE statement to replace the IF statement in \nthe previous figure like this: \nCASE \nWHEN first_ invoice_due_date < NOW() THEN \nSELECT (•outstanding invoices are overdue!'); \nWHEN first_ invoice_due_date = NOW() THEN \nSELECT ('Outstanding invoices are due today!'); \nELSE \nSELECT ('No invoices are overdue.'); \nEND CASE; \nConversely, you can easily rewrite the simple CASE statement shown in this \nfigure as an IF statement. \nSo, when should you use an IF statement and when should you use a CASE \nstatement? Although this is largely a matter of personal preference, you usually \nshould try to use the statement that yields the code that's easiest to read and \nunderstand.",
          "pages": [
            429,
            430,
            431,
            432
          ],
          "relevance": {
            "score": 0.7,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "examples": {
          "text": "Language skills for writing stored progra,ns \nThe syntax of the simple CASE statement \nCASE expression \nWHEN expression_value_ l THEN \nstatement_ l; \n[statement_ 2;] ... \n[WHEN expression_value_ 2 THEN \nstatement_ l; \n[statement_2;] ... ] ... \n[ELSE \nstatement_ l; \n[statement_ 2;] ••• ] \nEND CASE; \nA stored procedure that uses a simple CASE statement \nDELIMITER// \nCREATE PROCEDURE test(} \nBEGIN \nDECLARE terms_ id_var INT; \nSELECT terms_id INTO terms_ id_ var \nFROM invoices WHERE invoice_ id = 4; \nCASE terms_ id_var \nWHEN 1 THEN \nSELECT 'Net due 10 days• AS Terms; \nWHEN 2 THEN \nSELECT 'Net due 20 days• AS Terms; \nWHEN 3 THEN \nSELECT 'Net due 30 days' AS Terms; \nELSE \nSELECT 'Net due more tha.n 3 0 days ' AS Terms; \nEND CASE; \nEND// \nThe response from the system when the procedure is called \nTerms \n► \nNet due 30 days \nThe syntax of a searched CASE statement \nCASE \nWHEN boolean_expression THEN \nstatement_ l; \n[statement_2;] ... \n[WHEN boolean_expression THEN \nstatement_ l; \n[statement_2;] ... ] ... \n[ELSE \nstatement_ l; \n[statement_2;] ... ] \nEND CASE; \nDescription \n• \nYou can use a simple CASE statement or a sea,·ched CASE statement to execute one \nor more statements depending on a value that's returned by an expression. \nHow to code CASE statements\n\nSection 4 \nStored prvgram development \nHow to code loops \nments while a condition is true. This figure stai·ts by showing how to use a \nWHILE loop to continue executing while a counter is within the specified range. \nIn the example, the stored procedure begins by declaring a counter variable \nnamed i that has a default value of 1. Then, it declares a string variable named s \nthat can store up to 400 characters and has a default value of an empty string. \nThe WHILE statement begins by declaring that the loop should continue \nwhile the counter variable is less than four. Since the second SET statement \nincreases the value of the counter vaiiable by 1 each time through the loop, \nthe loop is executed three times (when the counter is equal to 1, 2, and 3). As a \nresult, the first SET statement is executed three times. This statement appends \nsome string literals and the value of the counter variable to the string variable. \nAfter the loop fmishes executing, the SELECT statement displays the string \nvariable. This variable provides a string representation of the three values of the \ncounter variable. Altho11gh this doesn't accomplish anything useful, it clearly \nshows how a WHILE loop works and can be useful for debugging. \nThe next two examples show how to use different types of loops to get \nthe same result as the first example. Although the syntax for these loops isn't \npresented in this figure, you shouldn't have any trouble understanding how they \nwork if you understand how the WHILE loop works. \nBoth of these examples focus on the code for the loop. In other words, they \ndon't show the DELIMITER and CREATE PROCEDURE statements that were \nshown in the first example. In addition, they don't show the code that declares \nthe counter and string variables or the code that displays the string variable. \nHoweve1·, for these examples to run, they would need to include this code. \nThe second example shows how to use a REPEAT loop. In this example, the \nREPEAT loop continues to execute until a counter variable named i equals 4. \nThis works similarly to the WHILE loop, except that the Boolean expression is \ncoded at the end of the loop. As a result, a REPEAT loop always executes at least \nonce. Because of that, you should use a REPEAT loop if you want to execute the \ncode at least once, and you should use a WHILE loop if you don't want the code \nto execute at all in some cases. \nThe third example shows how to use a simple LOOP. Ironically, a simple \nLOOP is the most complex to code. To start, you must code a name that identi-\nfies the start and end of the loop. In this example, the loop is named testLoop. \nThen, you can use an IF statement to dete1mine when the loop should end. \nWithin this IF statement, you can use the LEAVE statement to jump to the end \nof the loop. On this statement, you name tl1e loop you want to leave. Although \nthis can be t1seful if you nest one loop within another loop, it's a lot of unneces-\nsary code for a loop that isn't nested. As a result, you'll typically want to use a \nWHILE loop or a REPEAT loop. \nIn the rare case that you need to jump to the beginning of a loop, you can use \nan ITERATE statement. This statement works like the LEAVE statement, except \nthat it jumps to the beginning of a loop instead of to the end of a loop.\n\nLanguage skills for writing stored progra,ns \nThe syntax of the WHILE loop \nWHILE boolean_expression DO \nstatement_ l; \n[statement_2;] ••• \nEND WHILE; \nA stored procedure that uses a WHILE loop \nDELIMITER / / \nCREATE PROCEDURE test( ) \nBEGIN \nDECLARE i INT DEFAULT 1; \nDECLARE s VARCHAR(400) DEFAULT \nWHILE i < 4 DO \nSET s = CONCAT(s, \nSET i = i + 1; \nEND WHILE; \nSELECT s AS message; \nEND/ / \nThe output for this code \nI message \n► fi=l I 1=2 11=3 I \nA REPEAT loop \nREPEAT \nI 1,' -\nI - , \n• \nI \n1., \nI \nI \n• , \nI \nI ) ; \nSET s = CONCAT ( s, Ii= I, i, I I I ) ; \nSET i = i + 1; \nUNTIL i = 4 \nEND REPEAT; \nA simple loop \ntestLoop: LOOP \nSET s = CONCAT(s, 'i=', i, ' I '); \nSET i = i + 1; \nIF i = 4 THEN \nLEAVE testLoop; \nEND IF; \nEND LOOP testLoop; \nDescription \n• \nTo execute a SQL statement repeatedly, you can use a loop. MySQL provides for \nthree types of loops: a WHILE loop, a REPEAT loop, and. a simple loop. \n• \nYou can use the LEAVE statement to go to the end of a loop. \n• \nYou can use the ITERATE statement to go to the beginning of a loop. \nHow to code loops\n\nSection 4 \nStored prvgram development \nHow to use a cursor \nBy default, SQL statements work with an entire result set rather than \nindividual rows. However, you may sometimes need to work with the data in \na result set one row at a time. To do that, you can use a cursor as described in \nIn this figure, the stored procedure begins by declaring four variables. \nNote that the third variable is assigned a default value of FALSE even though \nit's declared with the TINYINT type. As you learned in chapter 8, this works \nbecause the FALSE keyword is an alias for 0. Although many programmers use \n0 to represent a false value and 1 to represent a true value, this chapter uses the \nFALSE and TRUE keywords instead because they make the code easier to read. \nNext, this code declares a variable of the CURSOR type named \ninvoices_cursor. Within this declaration, this code uses a SELECT statement to \ndefine the result set for this cursor. This result set contains two columns from the \ninvoices table and all of the rows that have a balance due. \nAfte1· declaring the cursor, this code declares an error handler that's executed \nwhen no more rows are found in the result set for the cursor. This error handler \nsets the variable named row not found to a value of TRUE. Because the WHILE \nloop that follows executes only while the row_not_found variable is equal to \nFALSE, this causes the WHILE loop to stop executing. \nAfter declaring the error handler, this code uses the OPEN statement to open \nthe cursor. Then, it uses a WHILE loop to loop through each row in the cursor. \nThis WHILE loop continL1es until the row _not_f ound variable is set to TRUE by \nthe error handler. \nWithin the WHILE loop, the FETCH statement gets the column values from \nthe next 1·ow and stores them in the vaiiables that were declared earlier. Then, \nan IF statement checks whether the value of the invoice_total column for the \ncurrent row is greater than 1000. If it is, an UPDATE statement adds 10% of the \ninvoice_total column to the credit_total column for the row, and a SET statement \nincrements the count of the number of rows that have been updated. \nAfter the WHILE loop, this code closes the cursor. Finally, it uses a \nSELECT statement to display a count of the number of rows that have been \nupdated. \nBefore you use a cursor to work with individual rows in a result set, you \nshould consider other solutions. That's because standard database access is faster \nand uses fewer server resources than cursor-based access. For example, you \ncan accomplish the same update as the stored procedure in this figure with this \nUPDATE statement: \nUPDATE invoices \nSET credit_total = credit_total + (invoice_total * .1) \nWHERE invoice_total -\npayment_total - credit_total > 0 \nAND invoice_total > 1000 \nHowever, if you encounter a situation where it makes sense to use a cursor, the \nskills presented in this figure should help you do that.\n\nLanguage skills for writing stored progra,ns \nThe syntax \nDeclare a cursor \nDECLARE cursor_ name CURSOR FOR select_statement; \nDeclare an error handler for when no rows are found in the cursor \nDECLARE CONTINUE HANDLER FOR NOT FOUND handler_ statement; \nOpen the cursor \nOPEN cursor_name; \nGet column values from the row and store them in a series of variables \nFETCH cursor_name INTO variablel[, variable2] [, variable3] .•. ; \nClose the cursor \nCLOSE cursor_name; \nA stored procedure that uses a cursor \nDELIMITER// \nCREATE PROCEDURE test() \nBEGIN \nDECLARE invoice_ id_var \nDECLARE invoice total var \n-\nDECLARE row_not_ found \nDECLARE update_count \nINT; \nDECIMAL(9,2); \nTINYINT DEFAULT \nINT DEFAULT O; \nDECLARE invoices_cursor CURSOR FOR \nFALSE; \nSELECT invoice_ id, invoice_total \nFROM invoices \nWHERE invoice_total - payment_total - credit total> O; \nDECLARE CONTINUE HANDLER FOR NOT FOUND \nSET row_not_ found = TRUE; \nOPEN invoices_cursor; \nWHILE row_not_ found = FALSE DO \nFETCH invoices_cursor INTO invoice_ id_var, invoice_total_var; \nIF invoice_ total_var > 1000 THEN \nUPDATE invoices \nSET credit_total = credit_total + (invoice total* .1) \nWHERE invoice id= invoice_ id_var; \nSET update_count = update_ count + 1; \nEND IF; \nEND WHILE; \nCLOSE invoices_cursor; \nSELECT CONCAT{update_count, ' row(s) updated.'); \nEND// \nThe response from the system when the procedure is called \nCONCAT(update_count, 'ro•N(s) updated.) -\n► \n2 row(s) updated. \nHow to use a cursor \nI\n\nSection 4 \nStored prvgram development \nHow to declare a condition handler \nBefore you declare a condition handler, you need to be familiar with the \nMySQL error codes and named conditions that are defined by MySQL. Figure \n13-9 begins by listing five of the thousands of MySQL error codes. These error \ncodes should give you an idea of the types of errors MySQL provides for. \nEach of these error codes corresponds with a SQLSTATE code that's part of \nthe ANSI standard. However, the MySQL codes are typically more useful since \nthey're more specific. For example, the last four MySQL error codes all cor1·e-\nspond with a SQLSTATE code of 23000. \nIn general, you only need to handle these errors when you encounter them \nduring testing. However, if you're interested in viewing a list of all the error \ncodes, you'll find them in the MySQL Reference Manual. \nThe second table in this figure lists the three built-in named conditions \nMySQL provides. To start, it provides the NOT FOUND condition that was used \nin the stored procedure in figure 13-8. This condition corresponds with MySQL \nerror code 1329 and SQLSTATE code 02000. \nIn addition, MySQL provides the SQLEXCEPTION and SQLWARNING \nconditions. The SQLEXCEPTION condition provides a way for you to \nhandle all errors, even ones that yoLt did not encounter during testing. The \nSQLWARNING condition works like the SQLEXCEPTION condition, but it \nallows you to catch warnings and errors instead of just errors. \nThis figure also shows how to use the DECLARE ... HANDLER statement \nto handle the errors that may occur in your stored programs. In MySQL, this is \nrefe1red to as a condition handler. In othe1· languages, this is referred to as an \nerror handler or exception handler. \nThe three examples in this figure show how to declare condition handlers for \na MySQL error code, a SQLSTATE code, and a named condition. All three of \nthese condition handlers use the CONTINUE keyword, which causes the stored \nprogram to continue executing at the statement after the statement that caused \nthe error to occur. If that's not what you want, you can use the EXIT keyword to \ncontinue execution after the cun·ent block of code. You'll see an example of that \nin the next figure. \nIn most cases, you can use the MySQL error codes and the built-in named \nconditions to handle the exceptions that you encounter. In some cases, though, \nyou may want to create your own named conditions. Although this doesn't \nprovide any new capabilities, it can sometimes improve the readability of your \ncode. For more info1mation about creating your own named conditions, you can \nsearch the MySQL Reference Manual for info1mation about the DECLARE ... \nCONDITION statement.",
          "pages": [
            433,
            434,
            435,
            436,
            437,
            438
          ],
          "relevance": {
            "score": 0.7,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "commonMistakes": {
          "text": "Language skills for writing stored progra,ns \nCommonly used MySQL error codes \nError \nSQLSTATE \ncode \ncode \nDescription \n2 3000 \n2 3000 \nOccurs when a program attempts to fetch data from a \nrow that doesn't exist. \nOccurs when a program attempts to store duplicate \nvalues in a column that has a unique constraint. \nOccurs when a program attempts to insert a NULL \nvalue into a column that doesn't accept NULL values. \nOccurs when a pro grain attempts to add or update a \nchild row but can't because of a foreign key constraint. \nOccurs when a program atten1pts to delete or update a \nparent row but can't because of a foreign key constraint. \nBuilt-in named conditions \nNamed condition \nDescription \nNOT FOUND \nSQLEXCEPTION \nSQLWARNING \nOccurs when a progran1 attempts to use a FETCH statement \nor a SELECT statement to retrieve data and no data is found. \nOccurs when any error condition other than the NOT FOUND \ncondition occtrrs. \ncondition occurs or when any warning messages occur. \nThe syntax for declaring a condition handler \nDECLARE {CONTINUE jEXIT} HANDLER \nFOR {mysql_error_ codelSQLSTATE sqlstate_ code lnamed_condition} \nhandl er_ ac tions; \nHow to declare a condition handler for a MySQL error code \nDECLARE CONTINUE HANDLER FOR 1329 \nSET r ow_ not_ found = TRUE \nHow to declare a condition handler for a SQLSTATE code \nDECLARE CONTINUE HANDLER FOR SQLSTATE '02000' \nSET row not found= TRUE \nHow to declare a condition handler for a named condition \nDECLARE CONTINUE HANDLER FOR NOT FOUND \nSET row_not_ found = TRUE \nDescription \n• \nYou can use the DECLARE ... HANDLER statement to declare a handler for errors \nthat may occur. In MySQL, this is refe1Ted to as a condition handler. \n• \nTo continue execution when an error occurs, use the CONTINUE keyword. To exit \nthe current block of code when an error occurs, use the EXIT keyword. \n• \nFor a complete list of the MySQL erro1· codes and their corresponding SQLSTATE \ncodes, you can search the MySQL Reference Manual for ''Server error codes''. \nHow to declare a condition handler\n\nSection 4 \nStored prvgram development \nHow to use a condition handler \nNow that you know how to declare a condition handler, figure 13-10 shows \nhow to use a condition handler. To help you understand the difference between \na stored program that handles errors and one that doesn't, the first stored \nprocedure shows what happens when an error occurs and the procedure doesn't \nhandle errors. Here, the INSERT statement attempts to insert a duplicate value \n(''Cash'') into a column (account_description) that has been defined with a \nunique constraint. Because the error condition this causes isn't handled, MySQL \ndisplays an error message like the one that's shown. This message identifies \nthe error code (1062), and it displays a description of the error that helps you \nidentify the cause of the error. \nAlthough an error message like this can be helpful as you develop a stored \nprocedure, it isn't helpful to the end user of an application. As a result, you often \nwant to handle exceptions before you put your stored programs into production. \nSince the most specific way to handle an error is to use a MySQL e1Tor code, \nyou usually want to declare a condition handler for the error code that's occur-\nring. Then, you can handle this error by executing the appropriate code. Often, \nthat just means displaying a more user-friendly message. However, you can also \nperform other error-handling tasks such as writing information about the error to \na log table or rolling back a transaction. \nThe second stored procedure handles the error that occurs. To do that, it \nbegins by declaring a variable named duplicate_entry _for_key of the TINYINT \ntype and setting its default value to FALSE. Then, it declares a handler for error \ncode 1062. This handler uses the CONTINUE keyword to allow the procedure \nto continue executing when the error is encountered. However, it also uses a SET \nstatement to set the value of the duplicate_entry _for_key variable to TRUE. As \na result, the IF statement can test the value of this variable and handle the error \nwhen it occurs. In this figure, this code just handles the error by displaying a \nmessage that indicates that the row was not inserted because of a duplicate key. \nTo test this procedure, you can change the values in the INSERT statement. \nIf you run the statement as shown in this figure, for example, the error with \ncode 1062 occurs and the stored procedure returns the result set shown in this \nfigure. However, if you enter valid values, this procedure returns a result set that \nindicates that one row was inserted.",
          "pages": [
            439,
            440
          ],
          "relevance": {
            "score": 0.7,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        }
      },
      "educational_notes": {
        "definition": "A trigger is a special type of stored procedure that automatically executes when a specific event occurs on a table, such as INSERT, UPDATE, or DELETE. It helps maintain data integrity and enforce business rules directly within the database.",
        "explanation": "Triggers are incredibly useful for maintaining the consistency and accuracy of your data without having to write complex application logic. They allow you to perform actions automatically whenever certain events happen on a table. For example, if you want to ensure that every time a new record is inserted into an 'orders' table, the total amount is calculated and stored in another column, you can create a trigger for this purpose.",
        "key_points": [
          "Triggers are automatically executed based on specific events (INSERT, UPDATE, DELETE) on a table.",
          "They help maintain data integrity by enforcing rules directly within the database.",
          "Common uses include updating timestamp columns, maintaining audit trails, and ensuring referential integrity."
        ],
        "examples": [
          {
            "title": "Basic Trigger Example",
            "code": "-- CREATE a trigger that updates the 'last_modified' column whenever any row in the 'employees' TABLE is updated. CREATE TRIGGER update_last_modified BEFORE UPDATE ON employees FOR EACH ROW BEGIN SET NEW.last_modified = NOW(); END;",
            "explanation": "This example shows how to create a trigger that automatically updates the 'last_modified' column with the current timestamp every time an employee record is updated.",
            "validation_note": "SQL auto-fixed: "
          },
          {
            "title": "Practical Example",
            "code": "-- CREATE a trigger that inserts a new row into an 'audit_log' TABLE whenever a new product is added to the 'products' TABLE. CREATE TRIGGER log_product_addition AFTER INSERT ON products FOR EACH ROW BEGIN INSERT INTO audit_log (action, product_id, action_date) VALUES ('Added', NEW.product_id, NOW()); END;",
            "explanation": "This practical example demonstrates how a trigger can be used to maintain an audit log of all changes made to the 'products' table.",
            "validation_note": "SQL auto-fixed: "
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Forgetting to specify the correct timing (BEFORE, AFTER) for the trigger.",
            "incorrect_code": "-- Incorrect trigger creation CREATE TRIGGER incorrect_trigger ON employees FOR EACH ROW BEGIN SET NEW.last_modified = NOW(); END;",
            "correct_code": "-- Correct trigger creation CREATE TRIGGER update_last_modified AFTER UPDATE ON employees FOR EACH ROW BEGIN SET NEW.last_modified = NOW(); END;",
            "explanation": "Triggers must specify when they should be executed (BEFORE or AFTER the event). Forgetting this can lead to unexpected behavior."
          }
        ],
        "practice": {
          "question": "Create a trigger that automatically updates the 'total_amount' column in the 'orders' table whenever any row is updated.",
          "solution": "-- Solution\nCREATE TRIGGER update_total_amount\nBEFORE UPDATE ON orders\nFOR EACH ROW\nBEGIN\nSET NEW.total_amount = NEW.quantity * NEW.price;\nEND;"
        }
      },
      "llm_enhanced": true,
      "raw_text_preview": "Language skills for writing stored progra,ns \nThe syntax for declaring a variable \nDECLARE variable_name data_type [DEFAULT literal_value]; \nThe syntax for setting a variable to a literal value or an ",
      "content_relevance": {
        "score": 0.7,
        "sql_score": 1.0,
        "concept_score": 1.0,
        "non_sql_penalty": 0.1,
        "is_relevant": true,
        "analysis": "SQL content"
      }
    },
    "events": {
      "id": "events",
      "title": "Events",
      "definition": "Scheduled tasks in MySQL",
      "difficulty": "advanced",
      "page_references": [
        441,
        442,
        443,
        444,
        445,
        446,
        447,
        448,
        449,
        450,
        451,
        452
      ],
      "sections": {
        "definition": {
          "text": "Language skills for writing stored progra,ns \nA stored procedure that doesn't handle errors \nDELIMITER// \nCREATE PROCEDURE test() \nBEGIN \nINSERT INTO general_ ledger_ accounts VALUES (130, 'Cash'); \nSELECT '1 row was inserted.'; \nEND// \nThe response from the system \nError Code: 1062. Duplicate entry 'Cash' for key 'account_description' \nA stored procedure that uses a CONTINUE handler to handle an error \nDELIMITER// \nCREATE PROCEDURE test() \nBEGIN \nDECLARE duplicate_entry_ for_key TINYINT DEFAULT FALSE; \nDECLARE CONTINUE HANDLER FOR 1062 \nSET duplicate_entry_ for_key = TRUE; \nINSERT INTO general_ ledger_accounts VALUES (130, 'Cash'); \nIF duplicate_entry_ for_key = TRUE THEN \nSELECT 'Row was not inserted - duplicate key encountered.' AS message; \nELSE \nSELECT '1 row was inserted.' AS message; \nEND IF; \nEND// \nThe response from the system \nmessage \n► \nRow was not inserted - duplicate key encountered. \nHow to use a condition handler (part 1 of 2)\n\nSection 4 \nStored prvgram development \nThe first stored procedure in part 2 shows how to exit the current block \nof code as soon as an error occurs. To start, this stored procedure begins by \ndeclaring a variable named duplicate_entry _for_key just like the stored proce-\ndure in part 1. Then, it uses the BEGIN and END keywords to nest a block of \ncode within the block of code for the procedu1·e. Within the nested block of code, \nthe frrst statement declares a condition handler for the MySQL error with a code \nof 1062. This handler uses the EXIT keyword to indicate that it should exit the \nblock of code when this error occurs. Then, the second statement executes the \nINSERT statement that may cause the error. If no error occurs, the third state-\nment in the block displays a message that indicates that the row was inserted. \nIf an error occurs, however, the duplicate_entry _for_key variable is set to \nTRUE. In addition, code execution exits the block of code and jumps to the IF \nstatement that's coded after the block. This statement displays a message that \nindicates that the row was not inserted because of a duplicate key. \nSo, when should you use a CONTINUE handler and when should you use an \nEXIT handler? 111 general, it's a matter of personal preference. However, if you \nwant to allow MySQL to attempt to execute statements in a block of code even \nafter it encounters an error, you should use a CONTINUE handler. On the other \nhand, if allowing MySQL to continue to execute statements in the block causes \nproblems, you should use an EXIT handler. \nThe last stored procedure in this figure shows how to use a named condition \nto handle the error that occurs when a row can't be inserted. In this case, the \nstored procedure uses the SQLEXCEPTION condition. When this condition \noccurs, the stored procedure displays a message that indicates that the row was \nnot inserted because of a SQL exception. \nWhen handling the SQLEXCEPTION condition, many programmers \nmake the mistake of displaying a generic message like this: ''An unexpected \nerror occurred.\" Although this message is user-friendly, it doesn't provide any \ninformation that can help a programmer find and fix the error. As a result, it's \noften better not to handle this exception at all. In that case, the stored procedure \ndisplays an error as shown in the first example in part 1 of this figure.\n\nLanguage skills for writing stored progra,ns \nA stored procedure that uses an EXIT handler to handle an error \nDELIMITER// \nCREATE PROCEDURE test() \nBEGIN \nDECLARE duplicate_entry_ for_key TINYINT DEFAULT FALSE; \nBEGIN \nDECLARE EXIT HANDLER FOR 1062 \nSET duplicate_entry_ for_key = TRUE; \nINSERT INTO general_ ledger_accounts VALUES (130, 'Cash'); \nSELECT '1 row was inserted.' AS message; \nEND; \nIF duplicate_entry_ for_key = TRUE THEN \nSELECT 'Row was not inserted - duplicate key encountered.' AS message; \nEND IF; \nEND// \nThe response from the system \nmessage \n' \n► \nRow was not inserted -duplicate key encountered. \nA stored procedure that uses a named condition to handle all errors \nDELIMITER// \nCREATE PROCEDURE test() \nBEGIN \nDECLARE sql_ error TINYINT DEFAULT FALSE; \nBEGIN \nDECLARE EXIT HANDLER FOR SQLEXCEPTION \nSET sql_ error = TRUE; \nINSERT INTO general_ ledger_ accounts VALUES (130, 'Cash'); \nSELECT \n1 1 row was inserted.' AS message; \nEND; \nIF sql_error = TRUE THEN \nSELECT 'Row was not inserted -\nSQL exception encountered.' AS message; \nEND IF; \nEND// \nThe response from the system \nmessage \n► I Row was not inserted SQl exception encountered. \nDescription \n• \nIf you want MySQL to exit the current block of code as soon as it encounters an \nerror, use an EXIT handler. \nHow to use a condition handler (part 2 of 2)\n\nSection 4 \nStored prvgram development \nHow to use multiple condition handlers \nWhen coding a stored program, it's common to declare multiple condi-\ntion handlers as shown in figure 13-11. If you do that, the most specific error \nhandlers are executed first, and the least specific error handlers are executed last. \nThe stored procedure in this figure begins by declaiing three variables that \nare used to indicate whether an error condition has occun·ed. Here, all three \nvariables are set to a default value of FALSE. \nAfter declaring these three variables, this stored procedure defines a block \nof code. Within this block, the first three statements declare three condition \nhandlers that correspond with the three variables. These handlers all exit the \nblock of code if the specified en·or occurs. Of these handlers, the first two are \nspecific to MySQL error codes 1062 and 1048, but the third is a general handler \nthat catches any other errors that may occur. \nAfter the block of code, an IF statement examines the variables that are set \nby the condition handlers. Then, it executes the appropriate code. For the first \ntwo variables, this code displays a t1ser-friendly message that's appropriate for \nthe corresponding MySQL error code. For the third variable, this code displays \ninformation about the unanticipated error that occurred. In other words, if \nMySQL error code 1062 or 1048 occurs, this code displays a t1ser-friendly \nerror that includes information about the error that's useful to the progi·ammer. \nOtherwise, it displays a user-friendly en·or message that includes information \nthat's less useful to the programmer. \nIf you run the stored procedure shown in this figure, it returns a result set \nlike the one that's shown. In this case, the row wasn't inserted because the \nfirst column contained an illegal NULL value. To test for other errors, you can \nchange the valt1es in the INSERT statement. For example, if you enter a third \ncolumn with a value of 'xx', the stored procedure executes the condition handler \nfor the SQLEXCEPTION condition.",
          "pages": [
            441,
            442,
            443,
            444
          ],
          "relevance": {
            "score": 0.7,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "examples": {
          "text": "Language skills for writing stored progra,ns \nA stored procedure that uses multiple condition handlers \nDELIMITER// \nCREATE PROCEDURE test() \nBEGIN \nDECLARE duplicate_entry_ for_key TINYINT DEFAULT FALSE; \nDECLARE colwnn_cannot_be_null \nTINYINT DEFAULT FALSE; \nDECLARE sql_exception \nTINYINT DEFAULT FALSE; \nBEGIN \nDECLARE E.XIT HANDLER FOR 1062 \nSET duplicate_ entry_ for_key = TRUE; \nDECLARE EXIT HANDLER FOR 1048 \nSET colwnn_cannot_be_null = TRUE; \nDECLARE EXIT HANDLER FOR SQLEXCEPTION \nSET sql_ exception = TRUE; \nINSERT INTO general_ ledger_ accounts VALUES (NULL, 'Test'); \nSELECT '1 row was inserted.' AS message; \nEND; \nIF duplicate_entry_ for_key = TRUE THEN \nSELECT 'Row was not inserted - duplicate key encountered.' AS message; \nELSEIF column_cannot_be_null = TRUE THEN \nSELECT 'Row was not inserted - colwnn cannot be null.' AS message; \nELSEIF sql_exception = TRUE THEN \nSELECT 'Row was not inserted -\nSQL exception encountered.' AS message; \nEND IF; \nEND// \nThe response from the system \nmessage \n·---\n► \nRow was not inserted -column cannot be null. \nDescription \n• \nYou can declare multiple condition handlers for a single stored program. If you do \nthat, the most specific error handlers are executed first and the least specific error \nhandlers are executed last. \n• \nThe MySQL en·or codes and the NOT FOUND condition identify specific errors. \nThe SQLSTATE codes identify less specific ANSI-standard errors. And the \nSQLEXCEPTION and SQLWARNING conditions identify general errors. \nHow to use multiple condition handlers\n\nSection 4 \nStored prvgram development \nPerspective \nIn this chapter, you were introduced to stored programs, and you learned \nhow to use MySQL to write procedural code. In the next three chapters, you'll \nlearn more about writing stored programs. In chapter 14, you '11 leam how to \nmanage transactions and locking. In chapter 15, you'll learn how to code stored \nprocedures and functions. And in chapter 16, you'll learn bow to code triggers \nand events. \nTerms \nstored program \nstored procedure \nstored function \nstored routine \ntrigger \nevent \nblock of code \nvariable \nBoolean expression \nnested statement \nsimple CASE statem.ent \nExercises \nsearched CASE statement \nloop \nWHILE loop \nREPEAT loop \nsimple LOOP \ncounter \ncursor \ncondition handler \nerror handler \nexception handler \nnained condition \nEach of the scripts that you create in the following exercises should use the \nsame general structure as the script presented in figure 13-1. \n1. \nWrite a script that creates and calls a stored procedure named test. This \nstored procedure should declare a vaiiable and set it to the count of all rows \nin the Invoices table that have a balance due that's greater than or equal to \n$5,000. Then, the stored procedure should display a result set that displays the \nvai·iable in a message like this: \n3 invoices exceed $5,000. \n2. \nprocedure should use two variables to store ( 1) the count of all of the invoices \nin the Invoices table that have a balance due and (2) the sum of the balances \ndue for all of those invoices. If that total balance due is greater than or equal \nto $30,000, the stored procedure should display a result set that displays the \nvalues of both variables. Otherwise, the procedure should display a result set \nthat displays a message like this: \nTotal balance due is less than $30,000. \n3. \ndure should calculate the factorial for the number 10. (To calculate a factorial, \nyou multiply an integer by every positive integer less than itself.) Then, it \nshould display a string that includes the factorial like this: \nThe factorial of 10 is: 3,628,800.\n\nLanguage skills for writing stored progra,ns \n4. \nWrite a script that creates and calls a stored procedure named test. This proce-\ndure should create a cursor for a result set that consists of the vendor_name, \ninvoice_number, and balance_due columns for each invoice with a balance \ndue that's greater than or equal to $5,000. The rows in this result set should \nbe sorted in descending sequence by balance due. Then, the procedure should \ndisplay a string variable that includes the balance due, invoice number, and \nvendor name for each invoice so it looks something like this: \n16896.06IP-0608IMalloy Lithographing Inc//9878.4SI0-2436IMalloy \nLithographing Inc// \nHere, each column is separated by a pipe character (I) and each row is \nseparated by two front slashes (/ /). \n5. \nprocedure should attempt to update the invoice_due_date column so it's equal \nto NULL for the invoice with an invoice ID of 1. If the update is successful, \nthe procedure should display this message: \n1 row was updated. \nIf the update is unsuccessful, the procedure should display this message: \nRow was not updated -\ncolumn cannot be null. \n6. \ndure should identify all of the prime numbers less than 100. (A prime number \nis an integer that can't be divided by another integer other than I and itself.) \nThen, it should display a string variable that includes the prime numbers like \nthis: \nI 3 \nI s I 1 \nI 11 I 13 \nI 11 \nI 19 \nI 23 \nI 29 \nI 31 1--· \nHint: To get this to work, you will need to nest one loop within ariother loop. \nIn addition, you will need to code an IF statement within the inner loop. \n7. \nEnhance your script for exercise 4 so it shows the invoice data in three groups \nbased on the balance due amount with these headings: \n$20,000 or More \n$10,000 to $20,000 \n$5,000 to $10,000 \nWhen you're done, the string variable that's returned should be in this format: \n$20,000 or More: $10,000 to $20,000: 16896.06IP-0608IMalloy \nLithographing Inc//$5,000 to $10,000: 9878.4Sj0-2436IMalloy \nLithographing Inc// \nTo accomplish this, you can loop through the cursor three times by opening \nand closing the cursor for each loop. Hint: For each group of invoices, you \ncan code a separate block of code that contains an EXIT handler for the NOT \nFOUND condition.\n\nHow to use transactions \nand locking \nIf you've been working with MySQL on your own computer, you've been the \nonly user of your database. In the real world, though, a database may be used \nby thousands of users at the same time. Then, what happens when two users \ntry to update the same data at the same time? In this cha.pter, you'll learn how \nMySQL handles this situation. But first, you'll learn how to combine multiple \nSQL statements into a single logical unit of work known as a transaction. \nHow to work with transactions ......................................... 430 \nHow to commit and rollback transactions ................................................... 430 \nHow to work with save points ...................................................................... 432 \nHow to work with concurrency and locking .................... 434 \nHow concurrency and locking are related ................................................... 434 \nThe four concurrency problems that locks can prevent .............................. 436 \nHow to set the transaction isolation level .................................................... 438 \nHow to Jock selected rows .......................................................................... 440 \nHow to prevent deadlocks ............................................................................ 442 \nPerspective ......................................................................... 444\n\nSection 4 \nStored prvgram development \nHow to work with transactions \nA transaction is a group of SQL statements that you combine into a single \nlogical unit of work. By combining SQL statements like this, you can prevent \ncertain kinds of database errors. \nBefore you begin using MySQL to work with transactions, you should \nrealize that some storage engines don't st1pport transactions. In particular, the \nMyISAM storage engine doesn't support transactions. As a result, the skills \npresented in this topic only apply to storage engines such as InnoDB that support \ntransactions. \nHow to commit and rollback transactions \nBy default, a MySQL session uses autocommit mode, which automatically \ncommits INSERT, UPDATE, and DELETE statements immediately after you \nexecute them. So far in this book, we have assumed that you have been using \nautocommit mode. If that's not what you want, though, you can use transactions \nto control when changes are committed. \nSince transactions are often coded within stored procedures, figure 14-1 \npresents a stored procedure na1ned test that contains three INSERT statements \nthat are coded as a transaction. To start, this stored procedure declares a variable \nnamed sql_error and sets it to FALSE to indicate that no SQL error has occurred. \nThen, the second DECLARE statement creates a condition handler that sets the \nsql_error variable to TRUE if a SQL error occurs. \nThe START TRANSACTION statement identifies the start of the transac-\ntion, which temporarily turns off autocommit mode. Then, the first INSERT \nstatement adds a new invoice to the Invoices table. Next, two mo1·e INSERT \nstatements add the line items for the invoice to the Invoice_Line_Items table. \nAfter the INSERT staten1ents, an IF statement uses the sql_error vaiiable to \ncheck whether an error occurred when executing any of the INSERT statements. \nIf a SQL error did not occur, this code uses the COMMIT statement to commit \nthe changes to the database, which makes the c.hanges permanent. Otherwise, the \nROLLBACK statement rolls back the changes, which cancels them. \nTo understand why this is necessary, suppose that each of these INSERT \nstatements is committed to the database immediately after it's executed. Then, \nwhat will happen if the third INSERT stateme.nt fails? In that case, the Invoices \nand Invoice_Line_Items tables won't match. Specifically, the sum of the \nline_item_amount columns in the lnvoice_Line_Items table won't be equal to \nthe invoice_total column in the Invoices table. In other words, the integrity of the \ndata won't be maintained. \nSimilarly, consider the example of a transfer between a checking and a \nsavings account in a banking system. In that case, one update reduces the \nbalance in the checking account and another update increases the balance in the \nsavings account. Then, if one of these updates fails, the customer either gains or \nloses the amount of the transaction. But here again, treating the two updates as a \nsingle transaction solves this problem. Usually, that's what you want.",
          "pages": [
            445,
            446,
            447,
            448,
            449,
            450
          ],
          "relevance": {
            "score": 0.7,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "commonMistakes": {
          "text": "How to use transactions and locking \nA stored procedure that runs three INSERT statements as a transaction \nDELIMITER// \nCREATE PROCEDURE test(} \nBEGIN \nDECLARE sql_ error TINYINT DEFAULT FALSE; \nDECLARE CONTINUE HANDLER FOR SQLEXCEPTION \nSET sql_ error = TRUE; \nSTART TRANSACTION; \nINSERT INTO invoices \nVALUES ( 115, 34, • ZXA-080 •, • 2018-01-18', \n14092. 59, 0, 0, 3, '2018-04-18', NULL}; \nINSERT INTO invoice_ line_ items \nVALUES (115, 1, 160, 4447.23, 'HW upgrade'); \nVALUES (115, 2, 167, 9645.36, 'OS upgrade'); \nIF sql_error = FALSE THEN \nCOMMIT; \nSELECT 'The transaction was committed.'; \nELSE \nROLLBACK; \nSELECT 'The transaction was rolled back.'; \nEND IF; \nEND// \nWhen to use transactions \n• \nWhen you code two or more INSERT, UPDATE, or DELETE statements that affect \nrelated data. \n• \nWhen you move rows from one table to another table by using INSERT and \nDELETE statements. \n• \nWhenever the failure of an INSERT, UPDATE, or DELETE statement would \nviolate data integrity. \nDescription \n• \nBy default, MySQL runs in autocommit mode, which automatically commits \nchanges to the database immediately after each INSERT, UPDATE, or DELETE \nstatement is executed. If that's not what you want, you can group statements into a \nlogical unit of work called a transaction. \n• \nTo start a transaction, code the START TRANSACTION statement. This turns off \nautocommit mode until the staten1ents in the transaction are committed or rolled \nback. To com,nit the changes, code a COMMIT statement. To roll back the changes, \nuse a ROLLBACK statement. \n• \nMySQL automatically commits changes after a DDL statement such as a CREATE \nTABLE statement. As a result, you shouldn't code a DDL statement within a \ntransaction unless you want to comm.it the changes and end the transaction. \nHow to commit and roll back transactions\n\nSection 4 \nStored prvgram development \nHow to work with save points \nThe script in figure 14-2 shows how to use the SAVEPOINT statement to \nidentify one or more save points within a transaction. Here, a SA VEPOINT \nstatement is used to identify a save point before each of the three INSERT state-\nments that are included in the script. As a result, the script includes three save \npoints. \nThis script also shows how to use the ROLLBACK TO SAVEPOINT \nstatement to roll back all or part of a transaction. Here, the three ROLLBACK \nTO SA VEPOINT statements rollback the transaction to each of the three save \npoints. The frrst statement rolls back to the point before the second line item was \ninserted. The second statement rolls back to the point before the frrst line item \nwas inserted. And the third statement rolls back to the point before the invoice \nwas inserted. \nAt this point, the script calls the COMMIT statement to commit any changes \nthat have been made. However, the three ROLLBACK TO SAVEPOINT state-\nments have rolled back all three INSERT statements, so this doesn't commit any \nchanges to the database. To verify this, you can use a SELECT statement to view \nthe rows in the Invoices and Invoice Line Items tables that have an invoice id \n-\nof 115. \nIn general, save points are used when a transaction contains so many state-\n1nents that rolling back the entire transaction would be inefficient. In that case, \nan application can roll back to the last save point before an error occun·ed. \nThen, the appropriate processing can be done from there. For most applications, \nthough, you won't need to use save points. \nIn most cases, a transaction and its save points are coded within a stored \nprocedure as shown in figure 14-1. In this figure, though, the transaction and its \nstatements are coded in a script. Although this isn't a realistic example, it does \nshow how save points work, so you should be able to use them if you ever need \nto. In addition, this example shows that you can use the statements for working \nwith transactions within a script, which is sometimes helpful when working with \ndatabase creation scripts like the ones described in chapter 11.",
          "pages": [
            451,
            452
          ],
          "relevance": {
            "score": 0.7,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        }
      },
      "educational_notes": {
        "definition": "Events are special types of triggers that automatically execute when a specific event occurs within a database. They help automate tasks and maintain data integrity without requiring manual intervention.",
        "explanation": "Events are crucial for automating routine tasks in databases, such as backups, archiving old data, or sending notifications. Here’s how they work and when to use them:\n\n1. **What problem do events solve?** Events help automate repetitive tasks that would otherwise require manual intervention, saving time and reducing errors.\n\n2. **How do they work?** An event is defined with a schedule (like daily, weekly) and a SQL statement or stored procedure to execute. When the scheduled time arrives, the database runs the specified task automatically.\n\n3. **When to use them?** Use events for tasks that need to run at regular intervals, such as cleaning up old data, sending periodic reports, or performing backups.\n\n4. **Key things to remember:** Always test your event before deploying it in a production environment. Ensure the SQL statement is correct and won’t cause unintended side effects.",
        "key_points": [
          "Events automate routine tasks without manual intervention.",
          "They are defined with a schedule and an action (SQL statement or stored procedure).",
          "Test events thoroughly before deployment to avoid issues.",
          "Use events for tasks that need regular execution, like backups or data cleanup."
        ],
        "examples": [
          {
            "title": "Basic Usage",
            "code": "-- Create a simple event to delete old records daily\nCREATE EVENT delete_old_records\nON SCHEDULE EVERY 1 DAY\nDO DELETE FROM old_data WHERE date < DATE_SUB(CURDATE(), INTERVAL 30 DAY);",
            "explanation": "This example creates an event that deletes records from the `old_data` table every day, keeping only the last 30 days of data."
          },
          {
            "title": "Practical Example",
            "code": "-- Schedule a weekly report generation CREATE EVENT generate_weekly_report ON SCHEDULE EVERY 1 WEEK STARTS '2024-01-01' DO CALL generate_report();",
            "explanation": "This practical example schedules a stored procedure `generate_report` to run every week starting from January 1, 2024.",
            "validation_note": "SQL auto-fixed: "
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Forgetting to test the event before deployment.",
            "incorrect_code": "-- Incorrectly scheduled event without testing\nCREATE EVENT delete_old_records\nON SCHEDULE EVERY 1 DAY\nDO DELETE FROM old_data WHERE date < DATE_SUB(CURDATE(), INTERVAL 30 DAY);",
            "correct_code": "-- Correctly scheduled and tested event\nCREATE EVENT delete_old_records\nON SCHEDULE EVERY 1 DAY\nDO BEGIN\n    -- Test the SQL statement first\n    SELECT * FROM old_data WHERE date < DATE_SUB(CURDATE(), INTERVAL 30 DAY);\n    DELETE FROM old_data WHERE date < DATE_SUB(CURDATE(), INTERVAL 30 DAY);\nEND;",
            "explanation": "Always test your event with a small subset of data before deploying it to ensure it works as expected."
          }
        ],
        "practice": {
          "question": "Create an event that runs every Monday at 8 AM to update the status of all orders in the `orders` table to 'Processed'.",
          "solution": "-- Solution\nCREATE EVENT process_orders_daily\nON SCHEDULE EVERY 1 WEEK DAYOFWEEK = 2 STARTS '2024-01-07'\nDO UPDATE orders SET status = 'Processed';\n-- Explanation: This event updates the status of all orders to 'Processed' every Monday at 8 AM."
        }
      },
      "llm_enhanced": true,
      "raw_text_preview": "Language skills for writing stored progra,ns \nA stored procedure that doesn't handle errors \nDELIMITER// \nCREATE PROCEDURE test() \nBEGIN \nINSERT INTO general_ ledger_ accounts VALUES (130, 'Cash'); \nS",
      "content_relevance": {
        "score": 0.7,
        "sql_score": 1.0,
        "concept_score": 1.0,
        "non_sql_penalty": 0.1,
        "is_relevant": true,
        "analysis": "SQL content"
      }
    },
    "transactions-murach": {
      "id": "transactions-murach",
      "title": "Transactions",
      "definition": "ACID properties, COMMIT, ROLLBACK, and savepoints",
      "difficulty": "intermediate",
      "page_references": [
        457,
        458,
        459,
        460,
        461,
        462,
        463,
        464,
        465,
        466,
        467,
        468,
        469,
        470,
        471,
        472
      ],
      "sections": {
        "definition": {
          "text": "How to use transactions and locking \nThe four types of concurrency problems \nProblem \nDescription \nLosl updates \nDirty reads \nNonrepeatable reads \nPhantom reads \nDescription \nOccur when two transactions select the same row a11d then update the row \nbased on the values originally selected. Since each transaction is unaware \nof the other, the later update overwrites the earlier update. \nOccur when a transaction selects data that l1asn 't been committed by \nanother transaction. For example, transaction A cha11ges a row. Tra11saction \nB then selects the changed row before transaction A commits the change. \nIf transaction A then rolls back the change, transaction B has selected data \nthat doesn't exist in the database. \nOccur when two SELECT statements tl1at try to get the same data get \ndifferent values because another transaction has updated the data in the \ntime between the two statements. For example, transaction A selects a row. \nTransaction B then updates the row. When transaction A selects the same \nrow again, the data is different. \nOccur when you perlor1n an update or delete on a set of rows at the same \ntime that another transaction is pe1fo1ming an insert or delete that affects \none or more rows in that same set of rows. For exa1nple, transaction A \nupdates the payment total for each invoice that has a balance due, but trans-\naction B inserts a new, unpaid, invoice while transaction A is still running. \nAfter transaction A finisl1es, there is still an invoice with a balance due. \n• \nIn a large system with many users, you should expect for these ki11ds of problems \nto occur. In general, you don't need to take any action except to anticipate the \nproblem. In many cases, if the SQL statement is resubmitted, the problem goes \naway. \n• \nOn some systems, if two transactions overwrite each other, the validity of the \ndatabase is compromised and resubmitting one of the transactions won't eliminate \nthe problem. If you 're working on such a system, you must anticipate these concur-\nrency problems and account for them in your code. \n• \nIf one of these problems could affect the data integrity of your system, you can \nchange the default locking behavior by setting the transaction isolation level as \nshown in the next figure. \nThe four concurrency problems that locks can prevent\n\nSection 4 \nStored prvgram development \nHow to set the transaction isolation level \nThe simplest way to prevent concurrency problems is to change the default \nlocking behavior. To do that, you use the SET TRANSACTION ISOLATION \nLEVEL statement shown in figure 14-5 to set the transaction isolation level. By \ndefault, this statement sets the isolation level for the next new transaction in the \ncurrent session. If you want to set the isolation level for all the transactions in a \nsession, though, you can include the SESSION keyword. And if you want to set \nthe isolation level for all sessions, you can include the GLOBAL keyword. The \nexamples in this figure illustrate how this works. \nThis figure also lists the four transaction isolation levels that MySQL \nprovides and shows which concurrency problems they prevent or allow. For \nexample, if you use the SERIALIZABLE option, all four concurrency problems \nwill be prevented. \nWhen you set the isolation level to SERIALIZABLE, each transaction is \ncompletely isolated from every other transaction and concurrency is severely \nrestricted. The server does this by locking each resource, preventing other \ntransactions from accessing it. Since each transaction must wait for the previous \ntransaction to commit, the transactions are executed serially, one after another. \nSince the SERIALIZABLE level eliminates all concurrency problems, you \nmay think that this is always the best option. However, this option requires more \noverhead to manage all of the locks, so the access time for each transaction is \nincreased. For some systems, this may cause significant performance problems. \nAs a result, you typically want to use the SERIALIZABLE isolation level only \nfor situations in which phantom reads aren't acceptable. \nThe lowest isolation level is READ UNCOMMITTED, which allows all \nfour of the concurrency problems to occur. It does this by performing SELECT \nqueries without setting any locks and without honoring any existing locks. Since \nthis means that yom· SELECT statements will always execute immediately, this \nsetting p1·ovides the best performance. Since other t1·ansactions can retrieve and \nmodify the same data, however, this setting can't prevent concurrency problems. \nThe READ COMMITTED isolation level prevents transactions from \nseeing data that has been changed by other transactions but not committed. This \nprevents dirty reads, but allows for other types of concurrency problems. \nThe default isolation level for MySQL is REPEATABLE READ. With \nthis level, rows read by a transaction will be read consistently within the same \ntransaction. To accomplish that, the server places locks on all the data used by \nthe transaction that prevent other users from updating the data. \nThe REPEATABLE READ level allows more concurrency than the \nSERIALIZABLE level but less tha11 the READ COMMITTED level. As you \nmight expect, then, it results in faster performance than SERIALIZABLE and \npermits fewer concurrency problems than READ COMMITTED. In 1nost situa-\ntions, then, the default isolation level of REPEATABLE READ is acceptable.\n\nHow to use transactions and locking \nThe concurrency problems prevented by each transaction isolation level \nDirty \nreads \nLost \nNonrepeatable \nPhantom \nIsolation level \nupdates \nreads \nreads \nREAD UNCOMMITTED \nREAD COMMITTED \nREPEATABLE READ \nSERIALIZABLE \nAllows \nAllows \nPrevents \nAllows \nPrevents \nPrevents \nPrevents \nPrevents \nAllows \nAllows \nPrevents \nPrevents \nAllows \nAllows \nAllows \nPrevents \nThe syntax of the SET TRANSACTION ISOLATION LEVEL statement \nSET {GLOBAL ISESSION} TRANSACTION ISOLATION LEVEL \n{READ UNCOMMITTED IREAD COMMITTED IREPEATABLE READISERIALI ZABLE} \nSet the transaction isolation level to SERIALIZABLE \nfor the next transaction \nSET TRANSACTION ISOLATION LEVEL SERIALIZABLE \nSet the transaction isolation level to READ UNCOMMITTED \nfor the current session \nSET SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED \nSet the transaction isolation level to READ COMMITTED for all sessions \nSET GLOBAL TRANSACTION ISOLATION LEVEL READ COMMITTED \nDescription \n• \nThe transaction isolation level controls the degree to which transactions are isolated \nfrom one another. At the more restrictive isolation levels, concurrency problems are \nreduced or eliminated. However, at the least restrictive levels, performance is enhanced. \n• \nTo change the transaction isolation level, you use the SET TRANSACTION \nISOLATION LEVEL statement. \n• If you include the GLOBAL keyword, the isolation level is set globally for all new \ntransactions in all sessions. If you include the SESSION keyword, the isolation level \nis set for all new transactions in the current session. If you omit both GLOBAL and \nSESSION, the isolation level is set for the next new transaction in the current session. \n• \nThe default transaction isolation level is REPEATABLE READ. This level places \nlocks on all data that's used in a transaction, preventing other users fro1n updating that \ndata. However, thls isolation level still allows inserts, so phantom reads can occur. \n• \nThe READ UNCOMMITTED isolation level doesn't set any locks and ignores \nlocks that are already held. This level results in the highest possible performance \nfor your query, but at the risk of every kind of concurrency problem. For this \nreason, you should only use this level for data that is rarely updated. \n• \nThe READ COMMITTED isolation level locks data that has been changed but not \ncommitted. This prevents dirty reads but allows all other types of concurrency problems. \n• \nThe SERIALIZABLE isolation level places a lock on all data that's used in a \ntransaction. Since each transaction must wait for the previous transaction to commit, \nthe transactions are handled in sequence. This is the most restrictive isolation level. \nHow to set the transaction isolation level\n\nSection 4 \nStored prvgram development \nHow to lock selected rows \nIn some cases, the default isolation level of REPEATABLE READ doesn't \nwork the way you want. For example, suppose you want to code a transaction \nthat selects data and then inserts or updates data in related tables. In that case, \nbecause a SELECT statement doesn't lock the data it retrieves by default, \nanother transaction could update or delete the rows read by the first transaction \nbefore that transaction is done modifying the related tables. \nTo solve this type of problem, MySQL provides two ways to lock the rows \nreturned by a SELECT statement. First, you can add a FOR SHARE clause \n(LOCK IN SHARE MODE with MySQL 5.7 and earlier) to the end of a \nSELECT statement. This locks the selected rows so other transactions can read \nthem but can't modify them until your transaction commjts. Second, you can \nadd a FOR UPDATE clause to the end of a SELECT statement. This locks the \nselected rows and any associated indexes just like an UPDATE statement does. \nThen, other transactions can't read or modify these rows until your transaction \ncommits. \nWhen you use the FOR SHARE clause, the SELECT statement waits if it \nencounters rows that have been locked for update by another statement such as \nan UPDATE, DELETE, or SELECT ... FOR UPDATE statement. That way, it \ncan read the most current data. However, the FOR SHARE clause doesn't wait \nfor rows that have been locked for share. On the other hand, the FOR UPDATE \nclause wruts for rows that have been locked for share or for update. Because \nof this, the FOR SHARE clause provides better perforrnance than the FOR \nUPDATE clause. As a result, you should use the FOR SHARE clause if you \ndon't need to prevent other transactions from reading the same rows. \nWith MySQL 8.0 and later, you can also keep your transactions from \nwaiting for locks to be released. To do that, you can add the NO WAIT or SKIP \nLOCKED option to the end of a FOR SHARE or FOR UPDATE clause. The \nNO WAIT option causes the statement to immediately retur·n an error that the \ndeveloper can handle. The SKIP LOCKED option skips any rows that have been \nlocked and returns the rest. \nSHARE and FOR UPDATE clauses of a SELECT statement work. To start, \ntransaction A executes a SELECT statement that uses the FOR SHARE clause \nto lock the row in the Sales_Reps table that has a rep_id value of 2. At this point, \nno other transactions can modify this row until transaction A completes. This \nmakes sure that transaction A can modify the data in a child table before any \nother transaction can update or delete the corresponding row in the parent table. \nIn transaction B, the SELECT statement includes the FOR UPDATE clause. \nAs a result, it attempts to lock 4 rows for update. If transaction A still has a lock \non one of these rows, though, transaction B waits for that lock to be released. \nOnce transaction A completes, the SELECT statement in transaction B is \nexecuted. This returns four rows with rep_id values of 1, 2, 3, and 4.",
          "pages": [
            457,
            458,
            459,
            460
          ],
          "relevance": {
            "score": 0.4,
            "sql_score": 1.0,
            "concept_score": 0.6,
            "non_sql_penalty": 0.2,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "examples": {
          "text": "How to use transactions and locking \nFour transactions that show how to work with locking reads \nTransaction A \n-- Execute each statement one at a time. \n- - Al tern.ate with Transactions B, C, and D as described. \nSTART TRANSACTION; \n-- lock row with rep_ id of 2 in parent table ----\nSELECT* FROM sales_ reps WHERE rep_ id = 2 FOR SHARE; \nTransaction B waits for transaction A to finish \nTransaction C returns an error immediately \n-- Transaction D skips the locked row and returns the other rows imm.ediately \n-- insert row with rep_ id of 2 into child table \nINSERT INTO sales_ totals (rep_ id, sales_year, sales_ total) \nVALUES (2, 2019, 138193.69); \nCOMMIT; \n-- Transaction B executes now \nTransaction B - use a second connection for these statements! \nSTART TRANSACTION; \nSELECT * FROM sales_reps WHERE rep_id < 5 FOR UPDATE'; \nCOMMIT; \nTransaction C - use a second connection for these statements! \nSTART TRANSACTION; \nSELECT* FROM sales_ reps WHERE rep_ id < 5 FOR UPDATE NOWAI ; \nCOMMIT; \nTransaction D - use a second connection for these statements! \nSTART TRANSACTION; \nSELECT* FROM sales_reps WHERE rep_ id < 5 ~ OR UPDATE SKIP LOCKED; \nCOMMIT; \nDescription \n• \nIf you add the FOR SHARE clause to the end of a SELECT statement, the selected rows \nare locked so other transactions can read those rows but can't modify them until the \ntransaction commits. \n• \nIf you add the FOR UPDATE clause to the end of a SELECT statement, the selected \nrows and any associated indexes are locked so other transactions can't read or modify \nthem until the transaction commits. This works the same as the locks for an UPDATE \nstatement. \n• \nIf a SELECT ... FOR SHARE statement attempts to read any rows that have been locked \nfor update by another transaction, it waits until that transaction commits so it can use the \nmost current values. \n• \nIf a SELECT ... FOR UPDATE statement attempts to read any rows that have been \nlocked for share or for update by another transaction, it waits until that transaction \ncommits so it can use the most current values. \n• \nWhen the NOWAIT option is included on a FOR SHARE or FOR UPDATE clause, the \nstatement doesn't wait for a lock to be released. Instead, it returns an error immediately. \nThis allows a developer to handle the error instead of waiting for the lock to release. \n• \nWhen the SKIP LOCKED option is included on a FOR SHARE or FOR UPDATE \nclause, the statement doesn't wait for a lock to be released. Instead, it skips the locked \nrows and returns any rows that are not locked. \nHow to lock selected rows\n\nSection 4 \nStored prvgram development \nTransaction C works like transaction B, except that it includes the NO WAIT \noption. As a result, if transaction A still has a lock on any rows selected by trans-\naction C, running its SELECT statement causes an error to occur immediately. \nThis allows a developer to handle the error instead of having to wait for the lock \nto be released. \nTransaction D also works like transaction B, except that it includes the \nSKIP LOCKED option. As a result, if transaction A still has a lock on any rows \nselected by transaction D, its SELECT statement executes but skips any locked \nrows. In this example, it skips the row with a rep_id value of 2 and returns three \nrows that have rep_id values of 1, 3, and 4. \nHow to prevent deadlocks \nA deadlock occurs when neither of two transactions can be com1nitted \nbecause each has a lock on a resource needed by the other transaction. This \nis illustrated by the banking transactions in figure 14-7. Here, transaction A \nupdates the savings account first and then the checking account, while transac-\ntion B updates the checkiI1g account first and then the savings account. \nNow, suppose that the first statement in transaction A locks the savings \naccount, and the first statement in transaction Blocks the checking account. At \nthat point, a deadlock occurs because transaction A needs the savings account \nand transaction B needs the checking account, but both are locked. Eventually, \none of the transactions has to be rolled back so the other can proceed, and the \nloser is known as a deadlock victim. \nTo prevent deadlocks, you can use the four techniques that are presented in \nthis figure. First, you shouldn't leave transactions open any longer than is neces-\nsary. That's because the longer a transaction remains open and uncommitted, \nthe more likely it is that another transaction will need to work with that same \nresource. \nSo, when you're coding transactions, make sure to include the appropriate \nCOMMIT and ROLLBACK statements. In addition, don't code statements that \ntake a long time to execute between the START TRANSACTION statement that \nstarts the transaction and the COMMIT or ROLLBACK statement that finishes \nthe transaction. \nSecond, you shouldn't use a higher isolation level than you need. That's \nbecat1se the higher you set the isolation level, the more likely it is that two \ntransactions will be unable to work with the same resource at the same time. \nThird, you should schedule transactions that modify a large number of rows \nto 1·un when no other transactions, or only a small number of other transactions, \nwill be running. That way, it's less likely that the transactions will try to change \nthe same rows at the same time. \nFinally, you should consider how the SQL statements you write could cause \na deadlock. To prevent the situation that's illustrated in this figure, for example, \nyou should always update related accounts in the same sequence.\n\nHow to use transactions and locking \nDon't allow transactions to remain open for very long \n• \nKeep transactions short. \n• \nKeep SELECT statements outside of the transaction except when absolutely \nnecessary. \n• \nNever code requests for user input during a transaction. \nDon't use a transaction isolation level higher than necessary \n• \nThe default level of REPEATABLE READ is usually acceptable, but you should \nconsider changing to READ COMMITTED if deadlocks becon1e a problem. \n• \nReserve the use of the SERIALIZABLE level for short transactions that make \nchanges to data where integrity is vital. \nMake large changes when you can be assured of nearly exclusive access \n• If you need to change millions of rows in an active table, don't do so during hours \nof peak usage. \n• If possible, give yourself exclusive access to the database before making large \nchanges. \nTake locking behavior into consideration when coding your transactions \n• If you need to code two or more transactions that update the same resources, code \nthe updates in the same order in each transaction. \nUPDATE statements that illustrate deadlocking \nTransaction A \nSTART TRANSACTION; \nUPDATE savings SET balance= balance - transfer_amount; \nUPDATE checking SET balance= balance + transfer_amount ; \nCOMMIT; \nTransaction B (possible deadlock) \nSTART TRANSACTION; \nUPDATE checking SET balance = balance -\nt r ansf er_ amount ; \nUPDATE savings SET balance= balance+ transfer_ amount; \nCOMMIT; \nTransaction B (prevents deadlocks) \nSTART TRANSACTION; \nUPDATE savings SET balance = balance+ transfer_ amount; \nt ransfer_ amount ; \nCOMMI T; \nDescription \n• \nA deadlock occurs when neither of two transactions can be committed because \neach transaction has a lock on a resource needed by the other transaction. \nHow to prevent deadlocks\n\nSection 4 \nStored prvgram development \nPerspective \nIn this chapter, you learned the ways that MySQL protects your data from \nthe problems that can occur on a real-world system. Since the failure of one \nor more related SQL statements can violate data integrity, you learned how \nto prevent these problems by grouping the statements into transactions. SiI1ce \nmultiple transactions can simultaneously modify the same data, you learned \nhow to prevent concurrency problems by setting the transaction isolation level \nto change the default locking behavior. And since changing the isolation level \ncan increase the chances of deadlocks, you learned defensive programming \ntechniques to prevent deadlocks. \nTerms \ntransaction \ncommit a transaction \nroll back a transaction \nsave point \nconcurrency \nlocking \nlost update \nExercises \ndirty read \nnonrepeatable read \nphantom read \ntransaction isolation level \ndeadlock \ndeadlock victim \n1. \nWrite a script that creates and calls a stored procedure named test. This \nprocedure should include a set of three SQL statements coded as a transaction \nto reflect the following change: United Parcel Service has been purchased by \nFederal Express Co1-poration and the new company is named FedUP. Rename \none of the vendors and delete the other after updating the vendor_id column \nin the Invoices table. \nIf these statements execute successfully, commit the changes. Otherwise, roll \nback the changes. \n2. \nprocedure sho11ld include a set of two SQL statements coded as a transaction \nto delete the row with an invoice ID of 114 from the Invoices table. To do this, \nyou must first delete all line items for that invoice from the \nInvoice Line Items table. \n-\nback the changes.\n\nHow to create \nstored procedures \nand functions \nIn chapter 13, you learned how to create a stored procedure that didn't accept \nany parameters. Now, you'll learn how to create stored procedures that accept \nparameters. In addition, you'll learn how to code stored functions. \nAs you'll see, stored procedures allow you to store procedural logic such \nas data validation in a central location. In addition, they provide a powerful \nway to control how users are allowed to access the database. \nHow to code stored procedures ....................................... 446 \nHow to create and call a stored procedure ................................................. 446 \nHow to code input and output parameters .................................................. 448 \nHow to set a default value for a para1neter .................................................. 450 \nHow to validate parameters and raise errors ............................................... 452 \nA stored procedure that inserts a row .......................................................... 454 \nHow to work with user variables ................................................................. 458 \nHow to work with dynamic SQL ................................................................ 460 \nHow to drop a stored procedure .................................................................. 462 \nHow to code stored functions ........................................... 464 \nHow to create and call a function ............................................................... 464 \nHow to use function characteristics ............................................................ 466 \nA function that calculates balance due ....................................................... 468 \nHow to drop a function ................................................................................ 470 \nHow to use Workbench with procedures \nand functions ...................................................................... 472 \nHow to view and edit stored routines .......................................................... 472 \nHow to create stored routines ...................................................................... 472 \nHow to drop stored routines ........................................................................ 472 \nPerspective ......................................................................... 474\n\nSection 4 \nStored prvgram development \nHow to code stored procedures \nA stored procedure, which can also be referred to as a sproc or just a proce-\ndure, is a database object that contains procedural SQL code. You can use stored \nprocedures to modify the data that's stored within a database. For example, \nyou can use a stored procedure to execute an INSERT, UPDATE, or DELETE \nstatement. \nHow to create and call a stored procedure \nto create a stored procedure. To start, you code the CREATE PROCEDURE \nkeywords followed by the name of the procedure. In this figure, for example, \nthe statement creates a procedure named update_invoices_credit_total. This \nname clearly indicates that the procedure updates the credit_total column of the \ninvoices table. \nAfter the name of the procedure, you code a set of parentheses. Within \nthe parentheses, you can code one or more pa,·ameters for the procedure. A \nparameter is typically used to pass a value to the stored procedure from a calling \nprogram. \nIf a procedure accepts more than one parameter, you must use commas to \nseparate the parameters. When you declare a parameter, you code the name of \nthe parameter followed by its data type. In this figure, for example, the proce-\ndure accepts two parameters. The first parameter is named invoice_id_param \nwith a data type of INT, and the second parameter is named credit_total_param \nwith a data type of DECIMAL. \nAfter the parentheses, you code a block of statements. This block is identi-\nfied by the BEGIN and END keywords. Within the block, you can code most \nSQL statements including the ones for writing procedural code presented in \nchapter 13 and the ones for working with transactions presented in chapter 14. \nWhen you run the CREATE PROCEDURE statement, MySQL compiles the \ncode for the procedure and stores the compiled code in the database. As part of \nthis process, MySQL's compiler checks the syntax of the code within the proce-\ndure. If you've made a coding e1Tor, the system 1·esponds with an appropriate \nmessage and the procedure isn't created. \nYou can execute, or call, a stored procedure by using the CALL statement. \nIn this figure, for example, the CALL statement calls the procedure that was \ncreated in the first example. This statement passes one value for each of the \nparameters that are defined by the procedure. Here, the first parameter is a literal \nvalue that specifies the invoice ID, and the second parameter is a literal value \nthat identifies the new amount for the credit total. \nWhen you use the CALL statement, you must pass parameters by position. \nIn other words, you must code the parameters in the same order as they are \ncoded in the CREATE PROCEDURE statement. \nIn chapter 18, you will learn how to grant INSERT, UPDATE, and DELETE \nprivileges to specific users. However, if you want to have more fine-grained \ncontrol over the privileges that you grant to users, you can create stored proce-\n\nHow to create stored prvcedures and functions \nThe syntax of the CREATE PROCEDURE statement \nCREATE PROCEDURE procedure_ name \n( \n[parameter_name_ l data_type] \n[, parameter_name_ 2 data_type] ... \n) \nsql_block \nA script that creates a stored procedure that updates a table \nDELIMITER / / \nCREATE PROCEDURE update_ invoices_credit_total \n( \ninvoice_ id_param \ncredit_total_param \n) \nBEGIN \nINT, \nDECIMAL(9,2) \nDECLARE sql_ error TINYINT DEFAULT FALSE; \nDECLARE CONTINUE HANDLER FOR SQLEXCEPTION \nSET sql_error = TRUE; \nSTART TRANSACTION; \nUPDATE invoices \nSET credit_total = credit_total_param \nWHERE invoice id= invoice_ id_param; \nIF sql_error = FALSE THEN \nCOMMIT; \nELSE \nROLLBACK; \nEND IF; \nEND// \nA statement that calls the stored procedure \nCALL update_ invoic es_credit_total (56, 300 ) ; \nDescription \n• \nYou use the CREATE PROCEDURE statement to create a stored procedure. A \nstored procedure is an executable database object that contains procedural SQL \ncode. A stored procedure can also be called a sp,vc or a procedure. \n• \nYou can use parameters to pass one or more values from the calling program to the \nstored procedure or fron1 the procedure to the calling program. For more infor1na-\ntion on working with parameters, see figures 15-2 and 15-3. \n• \nTo declare a parameter within a stored procedure, you code the name of the param-\neter followed by its data type. If you declare two or more parameters, you separate \nthe parameters with commas. \n• \nYou can use the CALL statement to call a procedure. When a procedure accepts \nparameters, you pass them to the procedure by coding them within the parentheses \nthat follow the procedure name, and by separating the parameters with commas. \nHow to create and call a stored procedure",
          "pages": [
            461,
            462,
            463,
            464,
            465,
            466,
            467
          ],
          "relevance": {
            "score": 0.6,
            "sql_score": 1.0,
            "concept_score": 0.8,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "commonMistakes": {
          "text": "Section 4 \nStored prvgram development \n<lures that perform all of the types of data manipulation that you want to allow \nwithin your database. Then, you can grant privileges to execute these stored \nprocedures. For systems where security is critical, this can be an excellent way \nto prevent both accidental errors and malicious damage to your data. \nHow to code input and output parameters \nprocedure. An input parameter is passed to the stored procedure from the \ncalling program. You can explicitly identify an input parameter by coding the \nIN keyword before the name of the parameter. In this figure, for example, the \nfust two parameters are identified as input parameters. However, if you omit this \nkeyword, the parameter is assumed to be an input parameter. In figure 15-1, for \nexample, both parameters are input parameters. \nWithin a procedure, you can use input parameters like variables. However, \nyou can't change the value of the parameter. In this figure, for example, the \nprocedure uses the fust parameter within an UPDATE statement to specify the \ninvoice ID for the invoice row to be updated. \nAn output parameter is returned to the calling program from the stored \nprocedure. To code an output parameter, you must explicitly identify the param-\neter by coding the OUT keyword before the name of the parameter. In this \nfigure, for example, the third paran1eter is an output parameter. If the UPDATE \nstatement executes successfully, a SET statement stores a value of 1 in the \noutput parameter. Otherwise, a SET statement stores a value of O in the output \nparameter. Either way, the value of the output parameter is retw11ed to the calling \nprogram when the procedure finishes. \nTo show how a calling program works, this figure includes a script that calls \nthe procedure. Here, initial values are supplied for the two input parameters. \nThen, a variable named @row_count is supplied for the output parameter. This \nvariable is a special type of variable known as a user variable. A user va1iable \nis a global variable that's available to the user for the rest of the current session. \nYou'll learn more about t1ser variables later in this chapter. \nAfter the procedure executes, the value of the ot1tput parameter is stored in \nthe @row _count variable. Then, the calling program can access this variable. In \nthis figure, for example, the script uses a SELECT statement to display the value \nof the variable. However, it could also use an IF statement to check the value of \nthe variable and perform an appropriate action. \nIn addition to input and output parameters, MySQL provides for a parameter \nthat can be used for both input and output. An input/output parameter stores an \ninitial value that's passed in from the calling program like an input parameter. \nHowever, the procedure can change this value and retu111 it to a calling program \nlike an output parameter. To identify an input/output parameter, you must code \nthe INOUT .keyword before the name of the parameter. Although this can be \nuseft1l in some situations, it can also be confusing. As a result, it often makes \nsense to avoid the use of inpt1t/output parameters.\n\nHow to create stored prvcedures and functions \nThe syntax for declaring input and output parameters \n[INIOUTIINOUT] parameter_ name data_ type \nA stored procedure that uses input and output parameters \nDELIMITER// \nCREATE PROCEDURE update_ invoices_credit_ total \n( \nIN \ninvoice_ id_param \nIN \ncredit_ total_param \nOUT update_ count \n) \nBEGIN \nINT, \nDECIMAL(9,2}, \nINT \nDECLARE sql_ error TINYINT DEFAULT FALSE; \nDECLARE CONTINUE HANDLER FOR SQLEXCEPTION \nSET sql_ error = TRUE; \nSTART TRANSACTION; \nUPDATE invoices \nSET credit total= credit_ total_param \nWHERE invoice id= invoice_ id_param; \nIF sql_ error = FALSE THEN \nSET update_count = 1; \nCOMMIT; \nELSE \nSET update_ count = O; \nROLLBACK; \nEND IF; \nEND// \nA script that calls the stored procedure and uses the output parameter \nCALL update_ invoices_credit_ tota1(56, 200, @row_ count); \nSELECT CONCAT('row count: ', @row_ count} AS update_ count; \nDescription \n• \nInput parameters accept values that are passed from the calling program. These \nvalues cannot be changed by the body of the stored procedure. By default, param-\neters ai·e defined as input parameters. As a result, the IN keyword is optional for \nidentifying input parameters. \n• \nOutput para,neters store values that are passed back to the calling progra1n. These \nvalues must be set by the body of the stored procedure. To identify an output \nparameter, yot1 must code the OUT keyword. \n• \nInput/output parameters can store an initial value that's passed from the calling \nprogram. However, the body of the stored procedure can change this parameter. To \nidentify an input/output parameter, you must code the INOUT keyword. \n• \nWhen you work with output parameters or input/output parameters, the calling \nprogram typically passes a user variable to the parameter list. For more information \nabout t1ser variables, see figure 15-6. \nHow to code input and output parameters\n\nSection 4 \nStored prvgram development \nHow to set a default value for a parameter \nif a null value is passed for the parameter. Then, the default value can be used \ninstead of the null value. \nIn this figure, the stored procedure sets a default value for the second param-\neter, which contains the credit total to be assigned to the credit_total column for \nan invoice. To do that, it uses an IF statement to check if the parameter contains \na null value. If it does, the value of the parameter is set to 100. \nThe two CALL statements in this figure show two ways that you can provide \nvalues to the stored procedure. Here, the first CALL statement supplies a value \nfor each parameter. As a result, the credit total for the invoice is set to 200. In \ncontrast, the second CALL statement supplies a value of NULL for the second \nparameter. In that case, the credit total for the invoice is set to the default value \nof 100. \nWhen you set default values for one or more parameters, it usually makes \nsense to code these parameters at the end of the parameter list. That way, when \nyou call the stored procedure, you can code all the non-null values first.",
          "pages": [
            468,
            469,
            470
          ],
          "relevance": {
            "score": 0.5,
            "sql_score": 1.0,
            "concept_score": 0.6,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        }
      },
      "educational_notes": {
        "definition": "Transactions are sequences of database operations that must either complete successfully together or fail as a whole. They ensure data integrity and consistency by preventing concurrent modifications from interfering with each other.",
        "explanation": "Transactions help solve concurrency problems in databases, ensuring that multiple users can access and modify the same data without causing conflicts. Here’s how they work:\n1. **Isolation**: Transactions are isolated from one another, meaning changes made during a transaction do not affect others until it is completed.\n2. **Atomicity**: Each transaction is treated as a single unit of work that either completes successfully or fails entirely.\n3. **Consistency**: A transaction must leave the database in a consistent state before and after its execution.\n4. **Durability**: Once a transaction is committed, its changes are permanent, even if the system crashes afterward.\n\nTransactions are crucial for maintaining data integrity in large systems with multiple users.",
        "key_points": [
          "Key point 1: Transactions prevent concurrent modifications from interfering with each other.",
          "Key point 2: Atomicity ensures that transactions either complete successfully or fail entirely.",
          "Key point 3: Consistency maintains the database's integrity before and after transaction execution.",
          "Key point 4: Durability makes sure changes are permanent even if the system crashes.",
          "Key point 5: Choosing the right isolation level balances data integrity with performance."
        ],
        "examples": [
          {
            "title": "Basic Usage",
            "code": "-- Start a transaction BEGIN; UPDATE accounts SET balance = balance - 100 WHERE account_id = 1; UPDATE accounts SET balance = balance + 100 WHERE account_id = 2; COMMIT;",
            "explanation": "This example demonstrates how to start a transaction, perform two updates, and commit the changes. If any part of the transaction fails, it can be rolled back using ROLLBACK.",
            "validation_note": "SQL auto-fixed: "
          },
          {
            "title": "Practical Example",
            "code": "-- Transfer money between accounts BEGIN; UPDATE accounts SET balance = balance - 100 WHERE account_id = 1; UPDATE accounts SET balance = balance + 100 WHERE account_id = 2; COMMIT;",
            "explanation": "This practical example shows a real-world scenario where money is transferred between two accounts. The transaction ensures that both updates are successful or neither happens, maintaining the integrity of the financial data.",
            "validation_note": "SQL auto-fixed: "
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Forgetting to commit or rollback",
            "incorrect_code": "-- Incorrect: No commit OR rollback BEGIN; UPDATE accounts SET balance = balance - 100 WHERE account_id = 1;",
            "correct_code": "-- Correct: Commit the transaction BEGIN; UPDATE accounts SET balance = balance - 100 WHERE account_id = 1; COMMIT;",
            "explanation": "Mistakes happen when a transaction is not properly committed or rolled back, leading to partial changes that can cause inconsistencies."
          }
        ],
        "practice": {
          "question": "Write a SQL transaction to update the inventory of two products. If either product's stock goes below zero, roll back the transaction.",
          "solution": "-- Solution: Use a transaction with conditional logic\nBEGIN;\nUPDATE inventory SET stock = stock - 10 WHERE product_id = 1;\nUPDATE inventory SET stock = stock - 5 WHERE product_id = 2;\nIF (SELECT stock FROM inventory WHERE product_id = 1) < 0 OR (SELECT stock FROM inventory WHERE product_id = 2) < 0 THEN\n    ROLLBACK;\nELSE\n    COMMIT;\nEND IF;",
          "explanation": "This solution demonstrates how to use a transaction with conditional logic to ensure that the inventory update is only committed if both products have sufficient stock. If not, it rolls back the changes."
        }
      },
      "llm_enhanced": true,
      "raw_text_preview": "How to use transactions and locking \nThe four types of concurrency problems \nProblem \nDescription \nLosl updates \nDirty reads \nNonrepeatable reads \nPhantom reads \nDescription \nOccur when two transactio",
      "content_relevance": {
        "score": 0.5,
        "sql_score": 1.0,
        "concept_score": 0.8,
        "non_sql_penalty": 0.2,
        "is_relevant": true,
        "analysis": "SQL content"
      }
    },
    "isolation-levels-murach": {
      "id": "isolation-levels-murach",
      "title": "Transaction Isolation Levels",
      "definition": "READ UNCOMMITTED, READ COMMITTED, REPEATABLE READ, SERIALIZABLE",
      "difficulty": "advanced",
      "page_references": [
        471,
        472,
        473,
        474,
        475,
        476,
        477,
        478,
        479,
        480,
        481,
        482
      ],
      "sections": {
        "definition": {
          "text": "How to create stored prvcedures and functions \nA CREATE PROCEDURE statement that provides a default value \nDELIMITER// \nCREATE PROCEDURE update_ invoices_credit_total \n( \ninvoice_ id_param \nINT, \ncredit_ total_param \nDECIMAL(9,2) \n) \nBEGIN \nDECLARE sql_error TINYINT DEFAULT FALSE; \nDECLARE CONTINUE HANDLER FOR SQLEXCEPTION \nSET sql_error = TRUE; \n-- Set default values for NULL values \nIF credit_ total_param IS NULL THEN \nSET credit_ total_param = 100; \nEND IF; \nSTART TRANSACTION; \nUPDATE invoices \nSET credit_total = credit_ total_param \nWHERE invoice id= invoice_ id_param; \nIF sql_ error = FALSE THEN \nCOMMIT; \nELSE \nROLLBACK; \nEND IF; \nEND// \nA statement that calls the stored procedure \nCALL update_ invoices_credit_total(56, 200); \nAnother statement that calls the stored procedure \nCALL update_ invoices_credit_total(56, NULL); \nDescription \n• \nYou can provide a default value for a parameter so that if the calling program \npasses a null value for the parameter, the default value is used instead. \n• \nTo set a default value for a parameter, you can use an IF statement to check if the \nparameter contains a null value. If it does, you can assign a default value to the \nparameter. \n• \nIt's a good programming practice to code your CREATE PROCEDURE statements \nso they list parameters that require values first, fallowed by parameters that allow \nnull values. \nHow to set a default value for a parameter\n\nSection 4 \nStored prvgram development \nHow to validate parameters and raise errors \nWithin a stored procedure, it's generally considered a good practice to \nprevent errors by checking the parameters before they 're used to make sure \nthey're valid. This is often refe1Ted to as data validation. Then, if the data isn't \nvalid, you can execute code that makes it valid, or you can raise an error, which \nreturns the error to the calling program. \nthat are available from MySQL. To do that, you code the SIGNAL statement \nfollowed by the SQLSTATE keyword, followed by a SQLSTATE code. Then, \nyou can optionally include a SET statement that sets a message and MySQL \nerror code for the error. \nIn this figure, for example, the IF statement checks whether the value of the \nsecond parameter is less than zero. If it is, the SIGNAL statement raises an error \nwith a SQLSTATE code of 22003, a MySQL code of 1264, and a message that \nindicates that the credit total column must be greater than or equal to 0. These \nSQLSTATE and MySQL codes are commonly used to validate parameters since \nthey are used to indicate that the value is out of range for the column. \nIf the calling program doesn't catch this error, the system displays an error \nmessage. In this figure, for example, the CALL statement passes a negative \nvalue to the second parameter, which causes the error to be raised. As a result, \nthe system displays an error 1nessage that contains the MySQL error code and \nmessage specified by the SIGNAL statement. Since this error code and message \naccurately describe the error, the programmer or user of the calling program \nshould be able to identify and fix the problem. \nOn the other hand, if the calling program catches this error, it can include \ncode that handles the en·or. For example, the calling program can handle the \nerror by printing a user-friendly message and asking the user to input data again.\n\nHow to create stored prvcedures and functions \nThe syntax of the SIGNAL statement \nSIGNAL SQLSTATE [VALUE] sqlstate_value \n[SET MESSAGE_ TEXT = message [, MYSQL_ERRNO = mysql_ error_ number]] \nA stored procedure that raises a predefined exception \nDELIMITER// \nCREATE PROCEDURE update_ invoices_credit_total \n( \ninvoice_ id_param \nINT, \ncredit_ total_param \nDECIMAL(9,2) \n) \nBEGIN \n-- Validate paramater values \nIF credit_ total_param < 0 THEN \nSIGNAL SQLSTATE \n1 22003 1 \nSET MESSAGE_ TEXT = \n'The credit_total col11mn. must be greater than or equal to 0. ', \nMYSQL_ERRNO = 1146; \nELSEIF credit_ total_param >= 1000 THEN \nSIGNAL SQLSTATE \n1 22003 1 \nSET MESSAGE_ TEXT = \n'The credit total column must be less than 1000.', \nMYSQL_ERRNO = 1146; \nEND IF; \n-- Set default values for parameters \nIF credit_ total_param IS NULL THEN \nSET credit_ total_param = 100; \nEND IF; \nUPDATE invoices \nSET credit_total = credit_ total_param \nWHERE invoice_ id = invoice_ id__param; \nEND// \nA statement that calls the procedure \nCALL update_ invoices_credit_ total(S6, -100); \nThe response from the system \nError Code: 1146. \nThe credit_total column must be greater than or equal to 0. \nDescription \n• \nIt's generally considered a good practice to validate the data within a stored proce-\ndure before using the data. This is referred to as data validation. \n• \nThe SIGNAL statement raises an error. When you raise an error, you must specify \na SQLSTATE code as specified in chapter 13. In addition, you can optionally \nspecify an error message or MySQL error number. \n• \nWhen you raise an error, MySQL returns the error to the caller in the same way that \nit returns errors that are raised by the database engine. Then, the calling program \ncan handle the error. \nHow to validate parameters and raise errors\n\nSection 4 \nStored prvgram development \nA stored procedure that inserts a row \ninvoices table. This should give you a better idea of how you can use stored \nprocedures. \nThis procedU1·e uses six parameters that correspond to six of the colunms in \nthe Invoices table. All of these parameters are input parameters, and each param-\neter is assigned the same data type as the matching column in the Invoices table. \nAs a result, if the calling program passes a value that can't be converted to the \nproper data type, an error will be raised when the procedure is called. \nNone of these parameters corresponds with the invoice_id column since \nthat column is an auto increment column. Similarly, the stored procedure sets \na default value for the last two parameters. As a result, if the calling program \nprovides a null value for these parameters, the procedure automatically sets a \ndefault value for them. \nThe body of the procedure begins by declaring three variables. Of these \nvariables, the first two have data types that correspond to coltunns in the invoices \ntable. However, the third one uses the INT data type to store the number of days \nbefore the invoice is due. \nAll three of these variables have a suffix of''_ var'' while all of the param-\neters defined earlier have a suffix of ''_paran1''. This 1nakes it easy to tell the \ndifference between the pru:ameters that are passed to the procedure from the \ncalling program and the variables that are used within the procedure. \nAfter the variables are declared, the procedure begins by using an IF state-\n1nent to check the value of the parameter for the invoice_total column to see if \nit is less than zero. If so, the procedure uses the SIGNAL statement to raise an \nerror with an appropriate error code and message. This statement exits the stored \nprocedure and returns the error to the calling program. Similarly, the ELSEIF \nclause checks whether this parameter is greater than one million. If so, it raises \nan appropriate error. Although this figure only uses this IF statement to check \nfor two conditions, it's common to code a series of IF statements like this one to \nprovide more extensive data validation. \nNext, another IF statement is used to check the terms_id parameter for a \nnull value. If the parameter is null, a SELECT statement gets the value of the \ndefault terms id column for the vendor and stores it in the terms id variable. If \n-\nthis parameter isn't null, the value of the terrr1s_id parameter is assigned to the \nterms id variable. \nThe next IF statement is similar. It checks the value of the parameter for the \ninvoice_due_date column for a null value. If the parameter is nt1ll, a SELECT \nstatement uses the value of the terms_id variable to get the number of days \nuntil the invoice is due from the terms table, and it stores this value in the \nterms_due_days variable. Then, it calculates a due date for the invoice by using \nthe DATE_ADD function to add the number of days to the invoice date. If the \ninvoice_due_date parameter isn't null, though, this code sets the \ninvoice_due_date variable to the value that's stored in the parameter.",
          "pages": [
            471,
            472,
            473,
            474
          ],
          "relevance": {
            "score": 0.6,
            "sql_score": 1.0,
            "concept_score": 0.6,
            "non_sql_penalty": 0.0,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "examples": {
          "text": "How to create stored prvcedures and functions \nA stored procedure that validates the data in a new invoice \nDELIMITER// \nCREATE PROCEDURE insert_ invoice \n( \nvendor_id_param \ninvoice_ number_param \ninvoice_date_param \ninvoice_ total_param \nterms_id_param \ninvoice_due_date_param \nINT, \nVARCHAR(SO), \nDATE, \nDECIMAL(9,2), \nINT, \n) \nBEGIN \nDECLARE terms id var \nDATE \nDECLARE invoice_due_date_var \nDECLARE terms_due_days_var \n-- Validate paramater values \nINT; \nDATE; \nINT; \nIF invoice_total_param < 0 THEN \nSIGNAL SQLSTATE '22003' \nSET MESSAGE_TEXT = \n'The invoice total column must be a positive number.', \nMYSQL_ERRNO = 1264; \nELSEIF invoice_total_param >= 1000000 THEN \nSIGNAL SQLSTATE \n1 22003 1 \nSET MESSAGE_ TEXT = \n'The invoice_total column must be less than 1,000,000. 1 , \nMYSQL_ ERRNO = 1264; \nEND IF; \n-- Set default values for param~ters \nIF terms_ id_param IS NULL THEN \nSELECT default_ terms_ id INTO terms id var \nFROM vendors WHERE vendor_ id = vendor_ id_param; \nELSE \nSET terms_ id_var = terms_ id_param; \nEND IF; \nIF invoice_due_date_param IS NULL THEN \nSELECT terms_due_days INTO terms_due_days_var \nFROM terms WHERE terms_ id = terms_ id_var; \nSELECT DATE_ADD(invoice_ date_param, INTERVAL terms_due_days_var DAY) \nINTO invoice_due_date_var; \nELSE \nSET invoice_due_date_var = invoice_due_date_param; \nEND IF; \nINSERT INTO invoices \n(vendor_ id, invoice_nwnber, invoice_date, \ninvoice_ total, terms_id, invoice_due_date) \nVALUES (vendor_ id_param, invoice_number_param, invoice_date_param, \ninvoice_total_param, terms_ id_var, invoice_due_date_var); \nEND// \nA stored procedure that inserts a row (part 1 of 2)\n\nSection 4 \nStored prvgram development \nAfter the values have been set for the variables for the terms id and \ninvoice_due_date columns, this procedure executes an INSERT statement. If this \nstatement executes successfully, the row is inserted into the database. \nIn most cases, a stored procedure like this is called from an application \nprogram. However, to test a procedure before it's used by an application \nprogram, you can use CALL statements like the ones in part 2 of figure 15-5. \nThe first two CALL statements provide valid values that successfully insert \na new row. Of these statements, the frrst supplies non-null values for all of the \nparameters for the procedure. The second supplies non-null values for the first \nfour parameters, but not for the last two. This shows that the frrst four parameters \nare the only parameters that require non-null values. \nThe third CALL state1nent provides a negative nwnber for the invoice total \nparameter. As a result, this CALL statement causes the stored procedure to raise \nan error. Since the CALL statement doesn't handle this error, an error message \nlike the one shown in this figW\"e is displayed. However, if you call the stored \nprocedure from another stored procedure or from an application, you can include \ncode that handles the error.\n\nHow to create stored prvcedures and functions \nTwo statements that call the stored procedure \nCALL insert_ invoice ( 34, 'ZXA-080', '2018-01-18', 14092. 59, \n3, '2018-03-18'); \nCALL insert_ invoice ( 34, 'ZXA-082', '2018-01-18', 14092. 59, \nNULL, NULL); \nThe message from the system for a successful insert \n1 row(s) affected \nA statement that raises an error \nCALL insert_ invoice(34, 'ZXA-080', '2018-01-18', -14092.59, \nNULL, NULL) ; \nThe message from the system when a validation error occurs \nError Code: 1264. The invoice_ total col11mn must be a positive number. \nDescription \n• If the data for each of the columns of the row is valid, the procedru·e executes an \nINSERT statement to insert the row. Otherwise, the procedure or database engine \nraises an error and exits the procedure. \n• If an application program calls this procedure, it can handle any errors that are \nraised by the procedure or by the database engine. \nA stored procedure that inserts a row (part 2 of 2)\n\nSection 4 \nStored prvgram development \nHow to work with user variables \nIn figure 15-2, you learned how to store the value of an output parameter in a \nuser variable. Now, you'll learn more about working with user variables. \nA user variable is a special type of MySQL variable that's globally available \nto the current user. However, a user variable is only available as long as the user \nremains connected to the server and is released when the user disconnects. In \naddition, a user variable is only available to the current user and cannot be seen \nor accessed by other users. \nSince a user variable is globally available to the current user, multiple stored \nprograms can share the variable. In figure 15-6, for instance, the stored program \nnamed set_global_count sets the user variable named @count to a specified INT \nvalue. Then, the stored procedure named incrernent_global_count increments the \n@count variable by a value of 1. To set the value of this user variable, both of \nthese stored procedures use the SET statement. \nNote that these procedures don't need to include a DECLARE statement for \nthe user variable to declare its data type. That's because a user variable can store \nvarious data types including string, numeric, and date/time types. As a result, \nyou can declare or access a user variable anywhere just by coding an at sign(@) \nfollowed by the name of the variable. \nAlthough user variables are often used within stored programs, you can also \naccess user variables outside of stored programs. Then, you can use standard \nSQL statements such as the SELECT statement to work with them. In this \nfigure, for instance, the SELECT statement displays the value of the @count \nvariable a.fter it has been set and incremented by the two CALL statements. You \ncan also use the SET statement outside of a stored program to set the value of a \nuser variable.\n\nHow to create stored prvcedures and functions \nThe syntax for setting a user variable \nSET @variable_name = expression \nTwo stored procedures that work with the same user variable \nDELIMITER // \nCREATE PROCEDURE set_global_ count \n( \ncount var :INT \n) \nBEGIN \nSET @count= count_var; \nEND/ / \nCREATE PROCEDURE increment_ global_ count( ) \nBEGIN \nSET @count= @count+ 1; \nEND// \nTwo statements that call these stored procedures \nCALL set_ global_ count(lOO); \nCALL increment_global_ count(); \nA SELECT statement that directly accesses the user variable \nSELECT @count AS count_var \ncount_var \n► \n10 1 \nDescription \n• \nA user variable is a special type of MySQL variable that's globally available to the \ncurrent user. \n• \nA user variable is only available to the cun·ent user ai1d cannot be seen or accessed \nby other users. \n• \nA user variable is available as long as the user remains connected to the server, but \nit is released when the user disconnects. \n• \nA user variable can store various data types including string, numeric, and \ndate/time types. However, you don' t have to declare a data type for a user vaiiable. \nI \nI \n• \nA user variable is available from statements coded both inside and outside of stored \nprograms. \nHow to work with user variables\n\nSection 4 \nStored prvgram development \nHow to work with dynamic SQL \nyou to use procedu1·al code to build and execute a SQL statement that depends \non parameters that aren't known until runtime. To do that, you can build a string \nthat contains the SQL statement. Then, you can use the PREPARE, EXECUTE, \nand DEALLOCATE PREPARE statements to execute the statement contained in \nthe string. \nDynamic SQL is often used to build co1nplex WHERE clauses that depend \non multiple search conditions that may or may not be specified by the user. In \nthis figure, for instance, the code creates a stored procedure named \nselect_invoices that allows the user to specify two parameters: (1) the minimum \ninvoice date and (2) the minimum invoice total. However, if tl1e user specifies a \nnull value for a parameter, the stored procedure doesn't include that parameter in \nthe search condition. \nTo start, the stored procedure declares two string variables that can hold up \nto 200 characters. Then, it sets the variable named select_clause to a SELECT \nclause that selects four columns from the Invoices table, and it sets the variable \nnamed where_clause to a WHERE clause that doesn't include any search \nconditions. \nAfter setting the variables, a series of IF statements creates the WHERE \nclause depending on the values of the pru.·ameters. The first IF statement checks \nwhether the first parameter contains a non-null value. If it does, the IF statement \nadds a search condition to the WHERE clause like this: \nWHERE invoice_date > \n1min_ invoice_date_param 1 \nNote that the parameter is enclosed in single quotes since it contains a date \nvalue. \nThe second IF statement checks whether the second parameter contains a \nnon-null value. If it does, a nested IF statement checks whether the string for \nthe WHERE clause has already had a search condition appended to it. In that \ncase, it appends the AND keyword to the WHERE clause to create a compound \ncondition. Then, a SET statement adds a search condition to the WHERE clause. \nAt this point, the WHERE clause may contain a compound search condition, a \nsingle search condition, or no search condition at all. \nThe third IF statement checks if a search condition has been added to the \nWHERE clause. If it hasn't, the user variable named @dynamic_sql is assigned \nthe value of the SELECT clause. Otherwise, it is assigned a concatenation of \nthe SELECT clause and the WHERE clause. At this point, the @dynamic_sql \nvariable contains the dynamically generated SELECT statement. \nThe PREPARE statement prepares a statement from the string that's stored \nin the @dynamic_sql variable. For this to work, the string that contains the state-\nment must be stored in a user variable. That way, MySQL can access it outside \nof the stored program and prepare it to be executed. \nAfter MySQL prepares the statement, the EXECUTE statement executes \nthe prepared statement. This returns a rest1lt set for the dynamically generated \nSELECT statement to the user. Finally, the DEALLOCATE PREPARE state-\nment releases the prepared statement. Once a prepared statement is released, it \ncan no longer be executed.",
          "pages": [
            475,
            476,
            477,
            478,
            479,
            480
          ],
          "relevance": {
            "score": 0.2,
            "sql_score": 1.0,
            "concept_score": 0.0,
            "non_sql_penalty": 0.1,
            "is_relevant": false,
            "analysis": "SQL content"
          }
        },
        "commonMistakes": {
          "text": "How to create stored prvcedures and functions \nA stored procedure that uses dynamic SQL \nDELIMITER// \nCREATE PROCEDURE select_ invoices \n( \nmin_ invoice_date_param \nmin_ invoice_total_param \n) \nBEGIN \nDATE, \nDECIMAL(9,2) \nDECLARE select clause VARCHAR(200); \nDECLARE where_clause \nVARCHAR(200); \nSET select_clause = \"SELECT invoice_ id, invoice_ nwnber, \ninvoice_date, invoice total \nFROM invoices \n11 ; \nSET where clause= \n\"WHERE\"; \nIF min_invoice_date_param IS NOT NULL THEN \nSET where_clause = CONCAT(where_clause, \n\"invoice date> '\", min_invoice_date_param, \"'\"); \nEND IF; \nIF min_ invoice_ total_param IS NOT NULL THEN \nIF where clause!= \"WHERE \nIt THEN \nSET where_clause = CONCAT(where_clause, \"AND\"); \nEND IF; \n\"invoice_total > \", min_ invoice_total_param}; \nEND IF; \nIF where_clause =\"WHERE\" THEN \nSET @dynamic_ sql = select_clause; \nELSE \nSET @dynamic_ sql = CONCAT(select_ clause, where_clause); \nEND IF; \nPREPARE select invoices statement \nFROM @dynamic_ sql; \nEXECUTE select_ invoices_ statement; \nDEALLOCATE PREPARE select_ invoices_statement; \nEND// \nA @dynamic_sql variable at runtime with parameters inserted \nSELECT invoice_ id, invoice_ nwnber, invoice_date, invoice_total \nFROM invoices \nWHERE invoice date> '2018-07-25' AND invoice_total > 100 \nDescription \n• \nYou can use a stored routine to build a string variable that contains a SQL \nstatement. Then, you can use the PREPARE, EXECUTE, and DEALLOCATE \nPREPARE statements to execute the statement contained in the string. This is \nknown as dynamic SQL. \nHow to work with dynamic SOL\n\nSection 4 \nStored prvgram development \nHow to drop a stored procedure \nthe DROP PROCEDURE keywords followed by the name of the procedure. \nIn this figure, the first example uses the CREATE PROCEDURE statement to \ncreate a procedure named clear_invoices_credit_total. Then, the second example \nuses the DROP PROCEDURE statement to drop that procedure. \nIf you attempt to drop a stored procedure that doesn't exist, MySQL returns \nan error. To prevent this error, you can add the optional IF EXISTS keywords \nto the DROP PROCEDURE statement as shown by the third example. Then, \nMySQL only attempts to drop the stored procedure if it exists. \nIf you drop a table or view used by a procedure, you should be sure to drop \nthe procedure as well. If you don't, the procedure can still be called by any user \nor program that has been granted the appropriate privileges. Then, an error will \noccur because the table or view that the procedure depends on no longer exists.",
          "pages": [
            481,
            482
          ],
          "relevance": {
            "score": 0.3,
            "sql_score": 1.0,
            "concept_score": 0.0,
            "non_sql_penalty": 0.0,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        }
      },
      "educational_notes": {
        "definition": "Transaction isolation levels determine how transactions interact with each other and with data changes made by other transactions. They ensure data consistency and prevent anomalies like dirty reads, non-repeatable reads, and phantom reads.",
        "explanation": "In a database system, multiple users can access the same data simultaneously, which can lead to conflicts if not managed properly. Transaction isolation levels help manage these conflicts by controlling how transactions see and modify data. The four main isolation levels are: READ UNCOMMITTED, READ COMMITTED, REPEATABLE READ, and SERIALIZABLE. Each level offers a different balance between performance and data consistency.",
        "key_points": [
          "READ UNCOMMITTED allows dirty reads, where a transaction can read uncommitted changes made by other transactions.",
          "READ COMMITTED prevents dirty reads but allows non-repeatable reads, where a transaction might see different results when reading the same data twice.",
          "REPEATABLE READ ensures that a transaction sees the same data multiple times during its execution, preventing both dirty and non-repeatable reads. However, it can still allow phantom reads.",
          "SERIALIZABLE provides the highest level of isolation, ensuring that transactions are executed in a serialized manner, which prevents all types of anomalies but at the cost of performance."
        ],
        "examples": [
          {
            "title": "Basic Usage",
            "code": "-- Set transaction isolation level to REPEATABLE READ SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;",
            "explanation": "This example demonstrates how to set the transaction isolation level in SQL. Setting it to REPEATABLE READ ensures that a transaction sees the same data multiple times during its execution.",
            "validation_note": "SQL auto-fixed: "
          },
          {
            "title": "Practical Example",
            "code": "-- Start a transaction START TRANSACTION; -- UPDATE a record UPDATE employees SET salary = 5000 WHERE employee_id = 101; -- Commit the transaction COMMIT;",
            "explanation": "This practical example shows how to use transaction isolation levels in a real-world scenario. It starts a transaction, updates an employee's salary, and commits the changes.",
            "validation_note": "SQL auto-fixed: "
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Not setting the isolation level",
            "incorrect_code": "-- No isolation level set\nSELECT * FROM employees;",
            "correct_code": "-- Set isolation level to READ COMMITTED\nSET TRANSACTION ISOLATION LEVEL READ COMMITTED;\n-- Then perform operations\nSELECT * FROM employees;",
            "explanation": "Failing to set an isolation level can lead to inconsistent data readings. Always ensure that the appropriate isolation level is set for your transactions."
          }
        ],
        "practice": {
          "question": "Which isolation level provides the highest level of data consistency and prevents all types of anomalies?",
          "solution": "The SERIALIZABLE isolation level provides the highest level of data consistency and prevents all types of anomalies by ensuring that transactions are executed in a serialized manner. However, it can significantly impact performance."
        }
      },
      "llm_enhanced": true,
      "raw_text_preview": "How to create stored prvcedures and functions \nA CREATE PROCEDURE statement that provides a default value \nDELIMITER// \nCREATE PROCEDURE update_ invoices_credit_total \n( \ninvoice_ id_param \nINT, \ncred",
      "content_relevance": {
        "score": 0.5,
        "sql_score": 1.0,
        "concept_score": 0.6,
        "non_sql_penalty": 0.1,
        "is_relevant": true,
        "analysis": "SQL content"
      }
    },
    "user-management": {
      "id": "user-management",
      "title": "User Management",
      "definition": "Creating users, granting privileges, and roles",
      "difficulty": "intermediate",
      "page_references": [
        487,
        488,
        489,
        490,
        491,
        492,
        493,
        494,
        495,
        496,
        497,
        498,
        499,
        500,
        501,
        502
      ],
      "sections": {
        "definition": {
          "text": "How to create stored prvcedures and functions \nSome of the characteristics for a MySQL function \nCharacteristic \nDescription \nDETERMINISTIC \nNOT DETERMI NISTIC \nREADS SQL DATA \nMODIFIES SQL DATA \nCONTAINS SQL \nNO SQL \nIndicates that the function produces the same results given the same \ninput values. \nIndicates that the function does not produce the same results given \nthe same inpt1t values. This is the default. \nIndicates that the function contains one or more SQL statem.ents \nst1ch as SELECT statements that read data from a database but no \nstatements that write data. \nIndicates that the function contains SQL statements such as INSERT, \nUPDATE, and DELETE statements tl1at write data to a database. \nsuch as SET statements that don't read from or write to a database. \nThis is the default. \nIndicates that the function doesn't contain SQL statements. \nA function that gets a random number \nDELIMITER // \nCREATE FUNCTION rand_ i nt () \nRETURNS INT \nNOT DETERMINISTIC \nNO SQL \nBEGIN \nRETURN ROUND (RAND () * 1000); \nEND// \nA SELECT statement that uses the function \nSELECT rand_ int () AS random_number; \nI random_number \n► l3LS \nDescription \n• \nIf binary logging is enabled, which it is by default with MySQL 8.0, each function \nmust include the DETERMINISTIC, NO SQL, or READS SQL DATA characteristic. \nTo override this requirement, you can set the log_bin_trust_function_creators system \nvariable to 1 (ON). For more information on working with system variables, see \nchapter 17. \n• \nThe binary log contains a record of all the changes that have been made to the \ncontents of a database. It can be used for replication between two servers. \n• \nUnless you code the DETERMINISTIC keyword, a function is considered to be \nnon-dete1·ministic. This affects the type of information that's stored in the binary log. \n• \nIt's more common to use a stored procedure rather than a function to modify a database. \nHow to use function characteristics\n\nSection 4 \nStored prvgram development \nA function that calculates balance due \nTo do that, this function accepts a parameter that contains an invoice ID value. \nThen, the body of the function calculates the balance due, stores the result of the \ncalculation in a variable named balance_due_ var, and uses the RETURN state-\nment to return that value. \nThe SELECT statement in this figure uses this function to return the balance \ndue for the specified invoice ID value. Note that calling the function like this: \nget_balance_ due(invoice_ id) AS balance_ due \nhas the same effect as performing a calculation like this: \ninvoice_total -\npayment_total - credit_total AS balance_ due \nHowever, using a function has two advantages. First, the code is shorter, which \nmakes it easier to type. Second, the code for calculating the balance due is stored \nin a single location. As a result, if the formula for calculating the balance due \nchanges, you only need to change it in one location.\n\nHow to create stored prvcedures and functions \nA function that calculates balance due \nDELIMITER // \nCREATE FUNCTION get_balance_ due \n( \ninvoice_id_pararn INT \n) \nRETURNS DECIMAL(9,2 ) \nDETERMINISTIC READS SQL DATA \nBEGIN \nDECLARE balance_ due_var DECIMAL(9,2); \nSELECT invoice_total - payment_total - credit_total \nINTO balance_ due_var \nFROM invoices \nWHERE invoice_ id = invoice_ id_param; \nRETURN balance_ due_var; \nEND// \nA statement that calls the function \nSELECT vendor_ id, invoice_ n11mbAr, \nget_balance_due (invoice_ id) AS balance_ due \nFROM invoices \nWHERE vendor_ id = 37 \nThe response from the system \nvendor id \ninvoice _number \nbalance due \n-\n► \n0.00 \n0.00 \n224.00 \nDescription \n• \nThis function accepts a single parameter that specifies the ID for an invoice, and it \nreturns the balance due for that invoice.\n\nSection 4 \nStored prvgram development \nHow to drop a function \nFUNCTION keywords followed by the name of the function. This is illustrated \nby the third example in this figure. In addition, the fourth example illustrates \nhow you can add the IF EXISTS keywords to check if a function exists before \ndropping it. \nTo start, though, the first example presents another function named \nget_sum_balance_due. This function uses the aggregate SUM function described \nin chapter 5 to return the sum of the total balance due for the specified vendor. \nWhat's interesting here is that this function calls the get_balance_due function \npresented in the previous figure. In other words, this function ''depends'' on the \nget_balance_due function. \nThen, the second example shows a SELECT statement that uses the \nget_sum_balance_due function. This statement gets the invoice number and \nbalance due for each invoice for the vendor with an ID of 37. In addition, it gets \nthe total balance due for that vendor. \nLike stored procedures, functions depend on underlying database objects \nsuch as tables and views as well as other procedures and functions. Because \nof that, if you drop a database object that a function depends on, the function \nwon't work properly. For example, if you drop the get_balance_due function, \nthe get_sum_balance_due function won't work. As a result, yo11 should avoid \ndropping any database objects that other database objects depend on.",
          "pages": [
            487,
            488,
            489,
            490
          ],
          "relevance": {
            "score": 0.7,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "examples": {
          "text": "How to create stored prvcedures and functions \nThe syntax of the DROP FUNCTION statement \nDROP FUNCTION [IF EXISTS] function_name \nA statement that creates a function \nDELIMITER // \nCREATE FUNCTION get_ swn_balance_due \n( \nvendor_ id_pararn INT \n) \nRETURNS DECIMAL(9,2) \nDETERMINISTIC READS SQL DATA \nBEGIN \nDECLARE swn_ balance_ due_var DECIMAL(9,2); \nSELECT SUM(get_balance_due(invoice_ id}) \nINTO swn_balance_due_var \nFROM invoices \nWHERE vendor_ id = vendor_ id_param; \nRETURN swn_balance_ due_var; \nEND// \nA statement that calls the function \nSELECT vendor_ id, invoice_ nwnber, \nget_balance_due (invoice_ id) AS balance_ due, \nget_ swn_balance_ due (vendor_ id) AS swn_bala.nce_due \nFROM invoices \nWHERE vendor_ id = 37; \nThe response from the system \nvendor_ld \ninvoice number \nbalance_due \nsum_balance_due \n► \n547.q81328 \n0.00 \n224.00 \n0.00 \n224.00 \n224.00 \n224.00 \nA statement that drops the function \nDROP FUNCTION get_ swn_ balance_ due; \nA statement that drops the function only if it exists \nDROP FUNCTION IF EXISTS get_ swn_balance_ due; \nDescription \n• \nTo delete a function from the database, use the DROP FUNCTION statement. If \nyou want to check whether the function exists before you drop it, add the optional \nIF EXISTS keywords. \n• \nThe function in this figure uses the get_balance_due function that's presented in the \nprevious figure. As a result, if you drop the get_balance_due function, the function \nin this figure won't work. \nHow to drop a function\n\nSection 4 \nStored prvgram development \nHow to use Workbench \nwith procedures and functions \nMySQL Workbench provides some basic features for worlang with stored \nprocedures and functions. Figure 15-13 describes these features. Collectively, \nstored procedures and functions are sometimes referred to as stored routines. \nHow to view and edit stored routines \nTo start, this figure shows how to use MySQL Workbench to view stored \nprocedures and functions. To do that, you can connect to the server and then \nexpand the Stored Procedures or Functions node for the appropriate database. In \nthis figure, for example, I have expanded the Stored ProcedUI·es and Functions \nnodes for the AP database so you can see all of the procedures and functions that \nwere presented in this chapter. \nAfter you display the stored procedures or functions for a database, you \ncan view the code for a procedure or function by right-clicking on its name and \nselecting the appropriate Alter item. Then, MySQL Workbench displays the \nprocedure or function in a tab as shown in this figure. This may come in handy if \nyou need to work with stored procedures or functions that were created by other \nprogrammers and you don't l1nderstand what they do. It may also come in handy \nif you need to modify one of these stored procedures or functions. \nHow to create stored routines \nYou can use MySQL Workbench to help you get started writing scripts that \ncreate stored procedures and functions. To do that, you can right-click on the \nStored Procedures or Functions node and then select the appropriate Create \nitem. When you do, Workbench generates some basic code for the procedure or \nfunction that includes a DELIMITER statement, a CREATE PROCEDURE or \nCREATE FUNCTION statement, and BEGIN and END keywords. Then, you \ncan modify this code as necessary and add the code that's specific to the stored \nprocedure or function. \nAfter yot1 create a stored procedure or function, it won't appear in the \nNavigator window right away. To display it, you can refresh the Navigator \nwil1dow. The easiest way to do that is to click the Refresh button near the upper \nright corner of the Navigator window. \nHow to drop stored routines \nOnce a stored procedure or ft1nction is displayed in the Navigator window, \nyou can drop it by 1ight-clicking on it and selecting the appropriate Drop item. \nThen, you can use the resulting dialog box to confirm the drop.\n\nHow to create stored prvcedures and functions \nA stored procedure displayed in MySQL Workbench \n■ \nMySQL Workbench \nLocal mstance MySQLBO \nFile \nEdit \nV.= \n01Je1'{ \nDatabase \nServl!f \nTools \nScnpling \nHelp \nNav19at0f \nSCl1£MAS \na. 1 Ftier ob)eCs \n., J ap \nName: \nDOI.: \n,. \nQ l ~ O.lj[l~ \n□ \n► \nTables \n1 • - CREATE DEFINER=·root·@·localhost· PROCEDURE ·insert_invoice' ( \n[ \n► \nViews \n., \nStored Procedures \n0 set_global_coirt \nD selec:t_lnvolcz:s \nCJ lnsert_invoice \n~ increment_global_count \nD test \nupdate_ln \n., \nFunctions \nfO get_balan \nf() get_sum_ \nf() get_ vend, \n► \nar \nAdm,nistrllbon \nSchem \nCopy to aipboard \n► \n► \nvendor_id_param \nINT, \ninvoice_number_param \nVARCHAR( \n), \ninvoice_date_parani \nDATE, \ninvoice_tot al_parani \nOEOMAL( , ), \nterms_id_paran, \nINT, \ninvoice_due_date_param DATE \n) \n- BEGIN \nDECLARE t enas id var \nDECLARE invoi ce_due_date_var \nDECLARE tenas_due_days_var \nINTJ \nDATE; \nINT; \nIF invoice_total_param < \nTHEN \nSIGNAL SQLSTATE '22083 \nSend to SQL EditOf \nCrea!e Stored Procedure \nAlter S!ored Procedure. \n[)fop Stored Procedure. \nRefresh All \nSET MESSAGE_TEXT = The invoice_total col~ 111Jst ~ a posi1 \nWormatton \nProcedure: test \nMYSQL_ERRNO = \n; \nELSEIF invoice_total_par11.111 >~ \n~iOO THEN \nSIGNAL SQLSTATE \n22003' \nSET MESSAGE TEXT = • The invoice total colu,nn eust be less ti \n-\nMYSQL_ERRNO = \n, \nEND IF; \n,,. \n< \nRoutine \nObject Info \nSession \nApply \nDescription \n• \nTo view the stored procedures and functions for a database, you can expand the \nnode for the database. Then, you can expand the Stored Procedures 01· Functions \nnode. \n• \nTo view the code for an existing procedure or function, right-click on its name and \nselect the appropriate Alter item. \n• \nTo create a new stored procedure, right-click on the Stored Procedures node and \nselect the Create Stored Procedure item. \n• \nTo create a new function, right-click on the Functions node and select the Create \nFunction item. \n• \nAfter you create a new procedure or function, you can refresh the Navigator \nwindow to include it in the list of stored procedures or functions. To do that, click \nthe Refresh button near the upper right corner of the Navigator window. \n• \nTo drop a procedure or function, right-click on its name and select the Drop item. \nThen, use the resulting dialog box to confir1r1 the drop. \n• \nYou can use the SHOW PROCEDURE STATUS and SHOW FUNCTION STATUS \nstatements to display information about the stored procedures and functions on a \nserver. For more information, see the MySQL Reference Manual. \nHow to create, view, and drop stored procedures and functions \n> \nRevet \nX \nV\n\nSection 4 \nStored prvgram development \nPerspective \nIn this chapter, you learned how to create two types of stored programs: \nprocedures and functions. The focus of this chapter has been on the skills that \nSQL developers typically need for working with procedures and functions. \nHowever, you should know that there's a lot more to coding procedures and \nfunctions than what this chapter has shown. With this chapter as background, \nthough, you should be able to learn whatever else you need on your own. \nTerms \nstored procedure \nsproc \nprocedure \nparameter \ncompiling a procedure \ncalling a procedure \npassing parameters by position \ninput parameter \noutput parameter \ninput/output parameter \nuser variable \ndata validation \n• \n• \nraising an error \ndynamic SQL \nstored function \nfunction \nscalar function\n\nHow to create stored prvcedures and functions \nExercises \n1. \nWrite a script that creates and calls a stored procedure named \ninsert_glaccount. First, code a statement that creates a procedure that adds a \nnew row to the General_Ledger_Accounts table in the AP schema. To do that, \nthis procedure should have two parameters, one for each of the two columns \nin this table. Then, code a CALL statement that tests this procedure. (Note \nthat this table doesn't allow dttplicate account descriptions.) \n2. \nWrite a script that creates and calls a stored function named \ntest_glaccounts_description. First, create a function that tests whether an \naccount description is already in the General_Ledger_Accounts table. To do \nthat, this function should accept one parameter for the account description, \nand it should return a value of 1 if the account description is in the table or \n0 if it isn't. (Note: If a SELECT statement doesn't return any data, it raises a \nNOT FOUND condition that your function ca.n handle.) \n3. \nModify the script that you created in exercise 1 so it creates and calls a stored \nprocedure named insert_glaccot1nt_ with_test. This procedt1re should t1se the \nfunction that you created in exercise 2 to test whether the account description \nis a duplicate before it issues the INSERT statement. If the account descrip-\ntion is a duplicate, this procedure should raise an error with a SQLSTATE \ncode of 23000, a MySQL code of 1062, and a message that says ''Duplicate \naccount description.\" \n4. \nFirst, code a statement that creates a procedure that adds a new row to the \nTerms table in the AP schema. To do that, this procedure should have two \nparameters: one for the ter1ns_due_days column and another for the \nterms_description column. \nIf the value for the description column is nt1ll, the stored procedure should be \nable to create a default value for the description column based on the value of \nthe due days column. For example, for a due days column of 120, the descrip-\ntion column should have a default value of ''Net due 120 days''. Then, code a \nCALL statement that tests this procedure.\n\nHow to create triggers \nand events \nNow that you've learned bow to work with stored procedures and functions, \nyou're ready to learn about two more types of stored programs: triggers and \nevents. Triggers can be executed before or after an INSERT, UPDATE, or \nDELETE statement is executed on a table. As a result, they provide a powerful \nway to enforce data consistency, log changes to the database, and implement \nbusiness rules. Events can be executed at a schedt1led time. As a result, they \nprovide a convenient way to automatically perform any task that needs to be \nrun regularly, such as scheduled maintenance of tables. \nHow to work with triggers .................................................. 478 \nHow to create a BEFORE trigger ................................................................ 478 \nHow to use a trigger to enforce data consistency ....................................... 480 \nHow to create an AFTER trigger ................................................................ 482 \nHow to view or drop triggers ...................................................................... 484 \nHow to work with events .................................................... 486 \nHow to turn the event scheduler on or off ................................................... 486 \nHow to create an event ................................................................................. 486 \nHow to view, alter, or drop events ............................................................... 488 \nPerspective ......................................................................... 490",
          "pages": [
            491,
            492,
            493,
            494,
            495,
            496,
            497
          ],
          "relevance": {
            "score": 0.7,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "commonMistakes": {
          "text": "Section 4 \nStored prvgram development \nHow to work with triggers \nA trigger is a named database object that is executed, or fired, automatically \nwhen a particular type of SQL statement is executed. When using MySQL, a \ntrigger is fired when an INSERT, UPDATE, or DELETE statement is executed \non a table. \nHow to create a BEFORE trigger \nstart, you code the CREATE TRIGGER keywords followed by the name of the \ntrigger. In this figure, for instance, the first example creates a trigger named \nvendors_before_update. This name indicates that the trigger is associated with \nthe Vendors table and that it is fired before an update. This chapter uses a similar \nnaming convention for the other triggers. \nAfter the name of the trigger, you code the BEFORE or AFTER keyword to \nindicate when the trigger is fired. Then, you identify the statement that causes \nthe trigger to fire. Next, yoL1 code an ON clause that identifies the name of \nthe table. In this figure, for instance, the first example creates a trigger that's \nexecuted before any UPDATE statements on the Vendors table. \nAlthough each trigger is associated with a single table, with MySQL 5.7 and \nlater, you can code multiple BEFORE and AFTER triggers for the same event \non the same table. Since this can be confusing to manage and debug, however, \nI recommend you have no more than one BEFORE and one AFTER trigger for \neach event. \nAfter the ON clause, you code the FOR EACH ROW clause. This clause \nindicates that the trigger is a row-level trigger that fires for each row that's \nmodified. For example, an UPDATE statement that updates five rows would cause \nthe trigger to be executed five times, once for each row. Although some databases \nsupport other types of triggers, MySQL only supports row-level triggers. \nWithin the body of a trigger, you can use the NEW keyword to work with \nthe new values in a row that's being inserted or updated. In this figure, for \nexample, the NEW keyword gets and sets the value for the vendor_state column \nof the new row. If you try to use this keyword with a row that's being deleted, \nyou'll get an error since this row doesn't have any new values. \nYou can also use the OLD keyword to work with the old values in a row \nthat's being updated or deleted. You can't use this keyword with a row that's \nbeing inserted, though, since a new row doesn't have any old values. \nThe body of a trigger typically contains a block of code that's identified \nby the BEGIN and END keywords. In this figure, for example, the body of \nthe trigger contains a block of code with a single statement that updates the \nvendor_state column so state codes are always stored with uppercase letters. \nTo accomplish that, this statement uses the UPPER function to convert the new \nvalue for the vendor_state column to uppercase.\n\nHow to create triggers and events \nThe syntax of the CREATE TRIGGER statement \nCREATE TRIGGER trigger_name \n{BEFOREIAFTER} {INSERTjUPDATEIDELETE} ON table_ name \nFOR EACH ROW \ntrigger_body \nA CREATE TRIGGER statement that corrects mixed-case state names \nDELIMITER// \nCREATE TRIGGER vendors_before_ update \nBEFORE UPDATE ON vendors \nFOR EACH ROW \nBEGIN \nSET NEW.vendor_ state = UPPER(NEW.vendor_ state); \nEND// \nAn UPDATE statement that fires the trigger \nUPDATE vendors \nSET vendor_ state = 'wi' \nWHERE vendor id= 1 \nA SELECT statement that shows the new row \nSELECT vendor_name, vendor_state \nFROM vendors \nWHERE vendor_ id = 1 \nvendor _name \nvendor _state \n,_ \n► \nUS Postal Service \nWI \nDescription \n• \nA trigger is a named database object that executes, or fires, in response to an \nINSERT, UPDATE, or DELETE statement. \n• \nYou can fire a trigger before or after an INSERT, UPDATE, or DELETE statement \nis executed on a table. \n• \nYou must specify a FOR EACH ROW clause. This creates a row-level trigger that \nfires once for each row that's modified. \n• \nYou can use the OLD and NEW keywords to get and set the values for the columns \nthat are stored in the old row and the new row. \nHow to create a BEFORE trigger \nI \nI\n\nSection 4 \nStored prvgram development \nSince the body of this trigger executes a single statement, it could also be \ncoded without specifying a block of code like this: \nCREATE TRIGGER vendors_before_update \nBEFORE UPDATE ON vendors \nFOR EACH ROW \nSET NEW.vendor_ state = UPPER(NEW.vendor_ state); \nThe advantage of not specifying a block of code is that you don't have to change \nthe delimiter or identify the start and end of the block of code. The disadvantage \nis that it's more difficult to add statements to the trigger if you later decide that \nyou want the trigger to do more work. \nAlthough it's not mentioned in chapter 15, stored procedures and functions \nthat execute a single statement can also be coded without specifying a block of \ncode. If you look back at figure 15-8, for example, you'll see a stored procedure \nwhose body consists of a single UPDATE statement. Because of that, the body \nof this procedure could be rewritten without specifying a block of code. In 1nost \ncases, though, you'll want to code the body of a stored procedure or function \nwithin a block. \nHow to use a trigger to enforce data consistency \nTriggers are commonly used to enforce data consistency. For example, \nthe sum of line item amounts for an invoice in the Invoice Line Items table \n-\nshould always be equal to the corresponding invoice total amount in the Invoices \ntable. Unfortunately, you can't enforce this rule using a constraint on either \nthe Invoices table or the Invoice_Line_Items table. However, you can use a \ntrigger like the one in figure 16-2 to enforce this rule when an invoice amount is \nupdated. \nThe trigger shown here fires before an UPDATE statement attempts to \nupdate the invoice_total column in the Invoices table. When this trigger fires, \nit checks if the sum of the line items is equal to the invoice total. If it isn't, the \ntrigger raises an e1Tor with an SQLSTATE code of ''HYOOO'', which indicates \na general error. Then, the application tl1at issued the UPDATE statement can \nhandle the error. \nAlthough this example isn't entirely realistic, you can use triggers like this \nto enforce business rules or to verify data consistency. Since you can program \na trigger to accommodate many situations, triggers are more flexible than \nconstraints.",
          "pages": [
            498,
            499,
            500
          ],
          "relevance": {
            "score": 0.7,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        }
      },
      "educational_notes": {
        "definition": "A stored procedure or function is a precompiled block of SQL code that can be executed by its name. They help organize complex operations and make database interactions more efficient and secure.",
        "explanation": "Stored procedures and functions are essential tools for managing and manipulating data in a database. They solve the problem of repetitive tasks by allowing you to write a set of instructions once and execute them multiple times. Here’s how they work:\n1. **Definition**: You define a stored procedure or function with a name, parameters (if any), and SQL code that performs specific operations.\n2. **Execution**: Once defined, you can call this procedure or function by its name, passing the required parameters if any. This execution is handled by the database server, which optimizes performance.\n3. **Usage**: They are particularly useful for tasks like data validation, complex calculations, and batch processing. For example, calculating a balance due based on invoice details.\n4. **Key Points**:\n   - **Determinism**: Functions must be deterministic or non-deterministic (default). Deterministic functions always return the same result for the same input, which is crucial for binary logging.\n   - **Security**: Stored procedures can enhance security by limiting what users can do directly on the database. They also help prevent SQL injection attacks.\n   - **Performance**: By precompiling and caching SQL code, stored procedures can improve performance compared to executing dynamic SQL statements repeatedly.\n   - **Maintenance**: Changes made in a single location (the procedure or function) affect all places where it is called, reducing the risk of errors.",
        "key_points": [
          "Stored procedures and functions are precompiled blocks of SQL code that can be executed by their name.",
          "They help organize complex operations, make database interactions more efficient, and enhance security.",
          "Functions must be deterministic or non-deterministic (default). Deterministic functions always return the same result for the same input.",
          "Stored procedures can improve performance compared to executing dynamic SQL statements repeatedly.",
          "Changes made in a single location affect all places where it is called, reducing the risk of errors."
        ],
        "examples": [
          {
            "title": "Basic Usage",
            "code": "DELIMITER //\nCREATE FUNCTION rand_int ()\nRETURNS INT\nNOT DETERMINISTIC\nNO SQL\nBEGIN\nRETURN ROUND (RAND () * 1000);\nEND//\nSELECT rand_int () AS random_number;",
            "explanation": "This example creates a function that returns a random integer between 0 and 1000. It then calls this function to get a random number."
          },
          {
            "title": "Practical Example",
            "code": "DELIMITER //\nCREATE FUNCTION get_balance_due (invoice_id_param INT)\nRETURNS DECIMAL(9,2)\nDETERMINISTIC READS SQL DATA\nBEGIN\nDECLARE balance_due_var DECIMAL(9,2);\nSELECT invoice_total - payment_total - credit_total INTO balance_due_var FROM invoices WHERE invoice_id = invoice_id_param;\nRETURN balance_due_var;\nEND//\nSELECT vendor_id, invoice_number, get_balance_due(invoice_id) AS balance_due FROM invoices WHERE vendor_id = 37;",
            "explanation": "This practical example creates a function to calculate the balance due for a given invoice ID. It then selects vendor ID, invoice number, and the calculated balance due from the invoices table where the vendor ID is 37."
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Forgetting to declare variables",
            "incorrect_code": "DELIMITER //\nCREATE FUNCTION get_balance_due (invoice_id_param INT)\nRETURNS DECIMAL(9,2)\nDETERMINISTIC READS SQL DATA\nBEGIN\nSELECT invoice_total - payment_total - credit_total INTO balance_due_var FROM invoices WHERE invoice_id = invoice_id_param;\nRETURN balance_due_var;\nEND//",
            "correct_code": "DELIMITER //\nCREATE FUNCTION get_balance_due (invoice_id_param INT)\nRETURNS DECIMAL(9,2)\nDETERMINISTIC READS SQL DATA\nBEGIN\nDECLARE balance_due_var DECIMAL(9,2);\nSELECT invoice_total - payment_total - credit_total INTO balance_due_var FROM invoices WHERE invoice_id = invoice_id_param;\nRETURN balance_due_var;\nEND//",
            "explanation": "This mistake occurs when you forget to declare the variable before using it. Always declare all variables used in your function."
          }
        ],
        "practice": {
          "question": "Create a stored procedure that calculates the total sales for each product category.",
          "solution": "DELIMITER //\nCREATE PROCEDURE get_total_sales_by_category()\nBEGIN\nSELECT category, SUM(sales) AS total_sales FROM products GROUP BY category;\nEND//\ncall get_total_sales_by_category();"
        }
      },
      "llm_enhanced": true,
      "raw_text_preview": "How to create stored prvcedures and functions \nSome of the characteristics for a MySQL function \nCharacteristic \nDescription \nDETERMINISTIC \nNOT DETERMI NISTIC \nREADS SQL DATA \nMODIFIES SQL DATA \nCONT",
      "content_relevance": {
        "score": 0.6,
        "sql_score": 1.0,
        "concept_score": 1.0,
        "non_sql_penalty": 0.2,
        "is_relevant": true,
        "analysis": "SQL content"
      }
    },
    "backup-restore": {
      "id": "backup-restore",
      "title": "Backup and Restore",
      "definition": "Database backup strategies and restoration procedures",
      "difficulty": "intermediate",
      "page_references": [
        505,
        506,
        507,
        508,
        509,
        510,
        511,
        512,
        513,
        514,
        515,
        516,
        517,
        518,
        519,
        520
      ],
      "sections": {
        "definition": {
          "text": "How to create triggers and events \nA statement that lists all triggers in the current database \nSHOW TRIGGERS \nA statement that lists all triggers in the specified database \nSHOW TRIGGERS IN ap \nJ Tr19ger \nEvent \nTable \nStatement \nTtming \nCreated \n► j involces_after _insert \nINSERT \ninvoices \nBEGIN \nINSERT INTO invoices_audit VALUES ... \nBEGIN DEa.ARE sum_line_jtem_amou,t DEO ... \nBEGIN \nINSERT INTO invoices_audlt VALUES •.• \nBEGIN SET NEW. vendor _state = UPPER{NEW •... \nAFTER \n2018-12-28 ll: \ninvoices _befure_upda te \nUPDATE \nInvoices \nBEFORE \n2018-12-28 11: \ninvolces_after _delete \nDaETE \nInvoices \nAFTER \n2018-12-28 11: \nvendors _before _update \nUPDATE \nvendors \nBEFORE \n2018-12-28 11: \n< \n> \nA statement that lists all triggers in a database that begin with ''ven'' \nSHOW TRIGGERS IN ap LIKE 'ven%' \nTrigger \nEvent \nTable \nStatement \nTuning \nCreated \n► \nvendors_before_update \nUPDATE \nvendors \nBEGIN SET NE¥J.vendor_state = UPPER{NEW .... BEFORE \n2018-12-28 11: \nA statement that drops a trigger \nDROP TRIGGER vendors_before_update \nA statement that drops a trigger only if it exists \nDROP TRIGGER IF EXISTS vendors_before_update \nDescription \n• \nTo view triggers, use the SHOW TRIGGERS statement. To filter the result set \nthat's returned, include an IN clause or a LIKE clat1se. \n• \nTo drop a trigger, use the DROP TRIGGER statement. To be sure a trigger exists \nbefore it's dropped, include the IF EXISTS keywords. \nHow to view or drop triggers \n>\n\nSection 4 \nStored prvgram development \nHow to work with events \nAn event, or scheduled event, is a named database object that executes, or \nfires, according to the event scheduler. With MySQL 8.0 and later, the event \nscheduler is on by default. As a result, if you don't need to use events, you \nshould turn the event scheduler off to save system resources. Conversely, the \nevent scheduler is off by default with MySQL 5.7 and earlier. If you want to use \nthe event scheduler with one of those releases, then, you need to turn it on. \nHow to turn the event scheduler on or off \nTo do that, you can use the SHOW VARIABLES statement to view the variable \nnamed event_scheduler. Then, if the event scheduler isn't on, you'll need to tum \nit on before you can work with events. To do that, you can use the SET statement \nto set the value of the event scheduler variable to ON. \nHere, the ON keyword is a synonym for the INT value of 1. Conversely, \nthe OFF keyword is a synonym for the INT value of 0. Since the ON and OFF \nkeywords are easier to read than I and 0, this chapter uses these keywords. \nHowever, if you 're using an older version of MySQL, you may need to use the \nINT values. \nWhen you use a SET statement to change the event_scheduler variable \nas shown in this figure, the change only applies until the server is restarted. \nHowever, if you want to make this change permanent, you can change this \nvariable in MySQL's configuration ftle as described in the next chapter. \nHow to create an event \nan event. You can use this statement to create a one-time event that occurs only \nonce or a recitrring event that repeats at a regular interval. \nThe first CREATE EVENT statement in this figure creates a one-time event \nnamed one_time_delete_audit_rows. To do that, this trigger uses the AT keyword \nto specify that the event should be executed one month from the current date \nand time. Then, it uses the DO keyword to identify the statements that the event \nshould execute. Here, the statements include the BEGIN and END keywords that \nidentify a block of code. Within that block, a single DELETE statement deletes \nall rows from the Invoices_Audit table that are more than one month old. \nLike the code for a trigger, the code for an event doesn't have to be coded \nwithin a block if it consists of a single statement. In this case, then, the event \ncould have been coded like this: \nCREATE EVENT one_time_delete_audit_rows \nON SCHEDULE AT NOW () + INTERVAL 1 MONTH \nDO DELETE FROM invoices_audit \nWHERE action_date < NOW{) -\nINTERVAL 1 MONTH; \nThis bas the same advantage and disadvantage as it does with a trigger.\n\nHow to create triggers and events \nA statement that checks if the event scheduler is on \nSHOW VARIABLES LIKE 'event_scheduler' \nI Variable name \nValue \n'► l event_~eduler \nON \nA statement that turns the event scheduler on \nSET GLOBAL event_ scheduler = ON \nThe syntax of the CREATE EVENT statement \nCREATE EVENT event_name \nON SCHEDULE \n{AT timestamp I EVERY interval [STARTS timestamp] [ENDS timestamp]} \nDO event_body \nA CREATE EVENT statement that executes only once \nDELIMITER// \nCREATE EVENT one time_delete_audit_rows \nON SC.HEDULE AT NOW ( ) + INTERVAL 1 MONTH \nDO BEGIN \nDELETE FROM invoices_audit WHERE action_date < NOW() -\nINTERVAL 1 MONTH; \nEND// \nA CREATE EVENT statement that executes every month \nCREATE EVENT monthly_delete_audit_ rows \nON SCHEDULE EVERY 1 MONTH \nSTARTS '2018-06-01' \nDO BEGIN \nINTERVAL 1 MONTH; \nEND// \nDescription \n• \nAn event, or scheduled event, is a named database object that executes, or fires, \naccording to the event scheduler. \n• \nBefore you begin working with events, you need to be sure that the event scheduler \nis on. With MySQL 8.0 and later, it's on by default. With MySQL 5.7 and earlier, \nit's off by default. \n• \nTo check the status of the event scheduler, you can use the SHOW VARIABLES \nstatement to view the variable named event scheduler. \n• \nTo turn the event scheduler on or off, you can use the SET statement to set the \nvalue of the event_scheduler variable to ON or OFF. Here, the ON and OFF \nkeywords are synonyms for the INT values of 1 and 0. \n• \nAn event can be a one-time event that occurs once or a recurring event that occurs \nregularly at a specified interval. \nHow to create an event\n\nSection 4 \nStored prvgram development \nThe second CREATE EVENT statement in figure 16-5 creates a recurring \nevent named monthly _delete_audit_rows. This statement works much like the \nfu·st statement, except that it uses the EVERY keyword to specify that the event \nshould be executed every month, and it uses the STARTS keyword to specify a \nstarting date of midnight on June 1, 2018. As a result, at the end of every month, \nthis event deletes all audit rows that are more than 1 month old. \nThe CREATE EVENT statement uses the date/time intervals that work with \ndate functions. As a result, you can use the INTERVAL keyword along with \nother keywords such as MINUTE, HOUR, DAY, WEEK, MONTH, and YEAR \nto specify a time. For more information, please see chapter 9. \nHow to view, alter, or drop events \nThe skills that you learned for viewing and dropping triggers are similar \nto the skills that you use to view and drop events. As a result, once you learn \nhow to view and drop triggers, you shouldn't have much trouble viewing and \ndropping events. For instance, the frrst three examples in figure 16-6 show how \nto use the SHOW EVENTS statement to view events, and the last two examples \nshow how to use the DROP EVENT statement to drop an event. \nWhen working with events, you can also use the ALTER EVENT statement \nto temporarily enable or disable an event or to rename an event. For instance, \nthe fou1th exa111ple in this fig01·e shows how to use the ALTER EVENT state-\nment to disable an event. To do that, you code the ALTER EVENT keywords, \nfollowed by the name of the event and the DISABLE keyword. Then, the fifth \nexample shows how to use the ENABLE keyword to enable an event that has \nbeen disabled. Finally, the sixth exainple shows how to use the RENAME TO \nkeywords to rename an event.",
          "pages": [
            505,
            506,
            507,
            508
          ],
          "relevance": {
            "score": 0.7,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "examples": {
          "text": "How to create triggers and events \nA statement that lists all events on the server \nSHOW EVENTS \nA statement that lists all events in a database \nSHOW EVENTS IN ap \nName \n► \nap \nmonthly _delete_audit_rows \nap \none_time_delete_audit_rows \n< \nDefiner \nroot#iocalhost \nroot@localhost \nTme \nzone \nSrSIEM \nSYSIEM \nType \nREOJRRING \nONETIME \nExeaJte at \n2019-01-2812:06:25 \nInterval \nvalue \nOW!t \nInterval \nfield \nMONTH \nlit9!1 \n> \nA statement that lists all events in a database that begin with ''mon'' \nSHOW EVENTS IN ap LIKE \n1mon%1 \nDb \nName \nDefiner \n► \nap \nmonthly _delete_audit_rows \nroot@u>calhost \n< \nTime \nzone \nSYS I EM \nA statement that disables an event \nType \nRECURRING \nExecute at \nIUU!i \nALTER EVENT monthly_delete_audit_ rows DISABLE \nA statement that enables an event \nALTER EVENT monthly_delete_audit_ rows ENABLE \nA statement that renames an event \nInterval \nvalue \nInterval \nfield \nMONTH \nStarts \n2018-06 \n> \nALTER EVENT one_time_delete audit_ rows RENAME TO one_time_delete_ audits \nA statement that drops an event \nDROP EVENT mont hly_delete_audit_ rows \nA statement that drops an event only if it exists \nDROP EVENT IF EXISTS monthly_delete_audit_rows \nDescription \n• \nTo view events, use the SHOW EVENTS statement. To filter the result set that's \nreturned, include an IN clause or a LIKE clause. \n• \nTo enable or disable an event, use the ALTER EVENT statement with the ENABLE \nor DISABLE keyword. \n• \nTo rename an event, use the ALTER EVENT statement with the RENAME TO \nkeywords, followed by the new name. \n• \nTo drop an event, use the DROP EVENT statement. To be sure an event exists \nbefore it's dropped, include the IF EXISTS keywords. \nHow to view, alter, or drop events\n\nSection 4 \nStored prvgram development \nPerspective \nIn this chapter, you learned how to use triggers to perform tasks that would \nbe difficult or impossible to perforn1 with other features like constraints. At this \npoint, you should be able to create and use triggers that enforce data consis-\ntency, implement business rules, and log changes to the database. In addition, \nyou should be able to use events to automatically perform tasks according to a \nschedule. \nAlthough this is more than the typical SQL developer needs to know, this \ngives you the perspective that you need when you encounter triggers that have \nbeen created by others. This also provides the background that you need for \nlearning more about triggers on your own. \nTerms \ntrigger \nfire a trigger \nrow-level nigger \nevent \nscheduled event \nfire an event \nevent scheduler \none-time event \nrecurring event \nExercises \n1. \nOpen the trigger named invoices_before_update that was shown in figure \n16-2. Then, modify it so it also raises an error whenever the payment total \nplus the credit total becomes larger than the invoice total in a row. Then, test \nthis trigger with an appropriate UPDATE statement. \n2. \nCreate a trigger named invoices_after_update. This trigger should insert \nthe old data about the invoice into the Invoices Audit table after the row is \nupdated. Then, test this trigger with an appropriate UPDATE statement. If the \nInvoices_Audit table doesn't exist, you can use the code shown in figure 16-3 \nto create it. \n3. \nCheck whether the event scheduler is turned on. If it isn't, code a statement \nthat turns it on. Then, create an event that inserts a test row that contains test \nvalues into the Invoices_Audit table every minute. To make sure that this \nevent has been created, code a SHOW EVENTS statement that views this \nevent and a SELECT statement that views the data that's inserted into the \nInvoices_Audit table. Once you're sure this event is working correctly, code a \nDROP EVENT statement that drops the event.\n\nDatabase administration \nIf you want to become a database administrator, this section should get you \nstarted. Although it doesn't show you everything there is to know about \ndatabase administration, it does get you started by presenting the skills you \nneed to be the database administrator for a MySQL database that runs on \na single server. This should be enough for many types of projects, such as \na database that's used by a medium-sized website or a database that's used \nfor a departmental system. \nIn chapter 17, you'll get an overview of database administration. In \naddition, you'll learn some practical skills that you can use to monitor \nand configure a server and work with its logs. In chapter 18, you'll learn \nhow to secure a database and work with user accounts. Finally, in chapter \n19, you'll learn how to back up and restore a database. At this point, you \nshould have a solid foundation in database administration.\n\nAn introduction \nto database administration \nThis chapter begins by presenting an overview of database administration, \nincluding the responsibilities of a database administrator and the various types \nof files that are used by a database. Then, this chapter presents some practical \nskills that you can use to get started with database administration. These skills \ninclude monitoring the server, configt1ring the server, and working with the \nserver's logs. \nDatabase administration concepts ................................... 494 \nDatabase administrator responsibilities ...................................................... 494 \nTypes of database _files ................................................................................. 496 \nTypes of log fiJes .......................................................................................... 496 \nHow to monitor the server ................................................. 498 \nHow to view the server status ...................................................................... 498 \nHow to view and kill processes .................................................................. 500 \nHow to view the status vaJ·iable ................................................................. 502 \nHow to view the system variables .............................................................. 504 \nHow to configure the server .............................................. 506 \nHow to set system variables using MySQL Workbench ............................ 506 \nHow to set system variables using a text ecLitor ........................................... 508 \nHow to set system variables using the SET statement ................................ 510 \nHow to work with logging .................................................. 512 \nHow to enable and disable logging .............................................................. 512 \nHow to configure logging ............................................................................ 514 \nHow to view text-based logs ........................................................................ 516 \nHow to manage logs ...................................................................................... 518 \nPerspective ......................................................................... 520\n\nSection 5 \nDatabase administration \nDatabase ad111inistration concepts \nBefore you leain practical skills for administering a database, it helps to \nunderstand some general concepts. To start, you should have a clear under-\nstanding of the responsibilities of a database administrator. In addition, you \nshould understand the types of files that are used by MySQL. \nDatabase administrator responsibilities \nA database administrator (DBA) has many responsibilities that vary \ndepending on the database. These responsibilities are summarized in figure 17-1. \nFor most databases, the DBA designs and creates the database as described in \nchapters 10 through 12. Then, the OBA should secure the database as described \nin chapter 18. And, of course, the DBA should make sure that the database is \nbacked up regularly so it can be restored LIP to the current point in time if neces-\nsary as described in chapter 19. \nWhen a database goes into production, the DBA is responsible for \nmonitoring the server to 1nake sure it can handle its workload. If necessary, \nthe DBA may need to configure the server to fix a problem or to get it to work \n1nore efficiently. To help with these tasks, the DBA may need to review logs to \nmonitor database performance or to identify problems such as queries that run \nslowly. These skills are described in this chapter. \nA database might also be administered by multiple people. For example, \nlarge mission-critical databases might be designed and created by a specialist \nbefore it's handed over to a11other DBA who is responsible for 1nonitoring it. \nOr, if the database is hosted remotely, one DBA at the remote site might be \nresponsible for certain administrative tasks while another DBA might be able to \nperform other administrative tasks remotely. \nThis chapter and the next two chapters focus on the skills that a DBA needs \nto administer a database that's running on a single server. However, it makes \nsense to run some databases on multiple servers. For example, you can often \nimprove the performance of a large database by running the MySQL server on \nmultiple machines and then running the database on each machine. Then, you \ncan use database replication to synchronize the databases so a.ny change made to \none database is automatically propagated to the other databases. To do this, you \ncan identify one server as the master and the other servers as the slaves.\n\nAn. introduction to database administration \nDatabase administrator responsibilities \nMaintenance \nMonitor the server \nConfigure the server \nMaintain log files \nDesign \nDesign the database \nCreate the database \nSecurity \nMaintain user accounts \nSecure the server and its databases \nBackup \nBackup the database regularly \nRestore the database if necessary \nMigrate data to another server if necessary \nMiscellaneous \nStart or stop the server when necessary \nOptimize the server \nUpdate software when necessary \nEnable and manage replication if necessary \nDescription \n• \nA database administrator (DBA) has many responsibilities that vary depending on \nthe database. \n• \nChapter 2 describes how to start and stop the server. \n• \nChapters 10 through 12 describe the skills that a OBA typically uses to design and \ncreate databases. \n• \nChapters 17 through 19 focus on the skills that a OBA needs to administer a \ndatabase that's running on a single server. \n• \nDatabase replication involves setting up two or more MySQL servers, usually \nrunning on different machines, where one server is the master and the other servers \nare the slaves. Then, any changes made to databases on one server are auto1nati-\ncall y propagated to the databases on the other servers.",
          "pages": [
            509,
            510,
            511,
            512,
            513,
            514,
            515
          ],
          "relevance": {
            "score": 0.7,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.1,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        },
        "commonMistakes": {
          "text": "Section 5 \nDatabase administration \nTypes of database files \nincluding configuration files, data files, and log files. To start, MySQL reads a \nconfiguration file when it starts. For Windows, this file is named my.ini and is \nusually stored in the parent directory of the data directory (MySQL 5.6 and later) \nor the base directory (MySQL 5.5 and earlier). For macOS and Unix/Linux, this \nfile is named my.cnf and is usually stored in the /private/etc or /etc directory. \nMySQL's data directory contains subdirectories and files that MySQL \nuses to store the data for its databases. Here, each subdirectory corresponds to \na database. For example, the AP database is stored within a directory named \nAP. Within a subdirectory, the files correspond to the tables and other objects \nof the database. The table files differ depending on the release of MySQL and \nwhether the tables are InnoDB or My ISAM. For example, InnoDB uses two \nfiles per table with MySQL 5.7 and earlier (.frm and .ibd) and one file per table \nwith MySQL 8.0 and later (.ibd). However, MyISAM uses three files per table \nwith MySQL 5.7 and earlier (.frm, .myd, and .myi) and two files per table with \nMySQL 8.0 and later (.myd and .myi). In addition to subdirectories, the data \ndirectory may contain log files that contain information that's written by the \nserver. \nBy default, MySQL's data directory is hidden. To view this diI·ectory with \nWindows, you need to change the settings for the Explorer so it shows hidden \nfiles, folders, and drives. To view this directory with macOS, you can start a \nTerminal window and execute these two commands: \nde f aults write com. apple . f inder AppleShowAllFile s YES \nkillall Finder \nTo hide these files, you can execute these two commands again but specify a \nvalue of NO in the first command instead of YES. \nTypes of log files \ncan create. To start, a general log contains a record of client connections, SQL \nstate1nents received from the clients, and other information. This file is useful \nfor monitoring the server. An error log contains messages about server startup \nand sht1tdown as well as error messages. This file is useful for troubleshooting \nproblems with starting or stopping the server. And a slow query log contains a \nlist of SQL statements that take a long time to execute. This file is useful for \nidentifying queries that need to be rewritten to optimize database performance. \nA binary log consists of an index file and a series of numbered binary files. \nThe index ftle contains a list of the binary ftles, and the binary ftles contain a \nrecord of the changes that have been made to the database. This log can be used \nwith backups to restore a database after a crash. It can also be used to enable \nreplication between a master server and a slave server. \nLike a binary log, a relay log consists of an index file and a series of \nnumbered binary files. These files are used on a slave server to relay any changes \nthat have been made on the master server to the slave server. This log is only \nnecessary when you 're using replication.\n\nAn. introduction to database administration \nTypes of database files \nFile type \nDescription \nConfiguration \nData \nLog \nFiles that contain configttration options that the MySQL server uses \nto set its defaults when it starts. For Windows, this file is named \nmy.ini. For macOS and Unix/Linux, this file is named my.cnf. For \nmore information, see figures 17-7 through 17-9. \nFiles that define the tables, indexes, and other database objects. \nThese files also store any data that's used by the database objects. \nInnoDB uses two files per table with MySQL 5.7 and earlier (.frm \nand ibd) and one file per table with MySQL 8.0 and later (.ibd). \nMy ISAM uses three files per table with MySQL 5.7 and earlier \n(.frm, .myd, and .myi) and two files per table with MySQL 8.0 and \nlater (.myd and .myi). Other files are used for other database objects \nsuch as views and triggers. \nFiles that contain information that's written (logged) by the data-\nbase server. You can configtire your server to turn these files on or \noff and to control how they work. For more information, see figures \n17-10 through 17-13. \nTypes of log files \nLog type \nDescription \nGe11eral \nError \nSlow query \nBinary \nRelay \nA text file that contain.s a record of client connections, SQL statements \nreceived from the clients, and other inf 01mation. \nA text file that contains messages about server startup and shutdown \nand error messages. \nA text file that contains SQL statements that take a long tin1e to execute. \nOne or more binary files that contain a record of changes that have been \nmade to the database. This log can be t1sed with backups to restore a \ndatabase after a crash. This log can also be used to enable replication \nbetween a m.aster server and a slave server. \nOne or more binary files that are used on a slave machine to relay any \nchanges that have been made on the master machine. This log is only \nnecessary when you're using replication. \nThe base and data directories for Windows \nC: \\ Progr am Files\\MySQL\\ MySQL Server 8. 0 \nC: \\ ProgramData \\MySQL\\ MySQL Server 8.0 \\ Data \nThe base and data directories for macOS and Unix/Linux \nu s r/l ocal/mysql / \nusr/loc al / my sql/da t a \nDescription \n• \nThe database server uses several types of files including configuration files, data \nfiles, and log files. \n• \nBy default, MySQL's data directory is hidden. As a result, you need to be able to \nview hidden files to see this directory. \nTypes of database and log files",
          "pages": [
            516,
            517
          ],
          "relevance": {
            "score": 0.8,
            "sql_score": 1.0,
            "concept_score": 1.0,
            "non_sql_penalty": 0.0,
            "is_relevant": true,
            "analysis": "SQL content"
          }
        }
      },
      "educational_notes": {
        "definition": "Backup and restore are processes used to save copies of databases and recover them when needed. This ensures data safety and availability.",
        "explanation": "Database backups are crucial for protecting against data loss due to hardware failures, software errors, or malicious attacks. A backup creates a copy of the database at a specific point in time. When a restore is performed, this backup is used to recreate the database state. This process helps maintain business continuity and data integrity.",
        "key_points": [
          "Backups are essential for data safety and recovery.",
          "Restoring from backups allows you to recover your database to a previous state if needed.",
          "Regular backups help in minimizing data loss during disasters or accidental deletions."
        ],
        "examples": [
          {
            "title": "Basic Backup",
            "code": "-- SQL command to CREATE a backup of the 'mydatabase' database mysqldump -u username -p mydatabase > mydatabase_backup.sql;",
            "explanation": "This example demonstrates how to use the mysqldump utility to create a backup of a database. The backup file is saved in the current directory.",
            "validation_note": "SQL auto-fixed: "
          },
          {
            "title": "Practical Example",
            "code": "-- SQL command to restore 'mydatabase' from a backup\nmysql -u username -p mydatabase < mydatabase_backup.sql;",
            "explanation": "This example shows how to restore a database using the mysqldump utility. The database is restored from the previously created backup file."
          }
        ],
        "common_mistakes": [
          {
            "mistake": "Forgetting to include the database name in the backup command",
            "incorrect_code": "-- Incorrect backup command mysqldump -u username -p > mydatabase_backup.sql;",
            "correct_code": "-- Correct backup command mysqldump -u username -p mydatabase > mydatabase_backup.sql;",
            "explanation": "This mistake can lead to an incomplete backup. Always specify the database name in the mysqldump command."
          }
        ],
        "practice": {
          "question": "How would you create a backup of a database named 'sales' using mysqldump?",
          "solution": "The correct SQL command is: mysqldump -u username -p sales > sales_backup.sql. This command will prompt for the password and then create a backup of the 'sales' database, saving it as 'sales_backup.sql'."
        }
      },
      "llm_enhanced": true,
      "raw_text_preview": "How to create triggers and events \nA statement that lists all triggers in the current database \nSHOW TRIGGERS \nA statement that lists all triggers in the specified database \nSHOW TRIGGERS IN ap \nJ Tr1",
      "content_relevance": {
        "score": 0.7,
        "sql_score": 1.0,
        "concept_score": 1.0,
        "non_sql_penalty": 0.1,
        "is_relevant": true,
        "analysis": "SQL content"
      }
    }
  }
}